var _N=Object.defineProperty;var vN=(t,e,n)=>e in t?_N(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var M0=(t,e,n)=>vN(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();function ET(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var TT={exports:{}},Tf={},IT={exports:{}},Me={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mc=Symbol.for("react.element"),wN=Symbol.for("react.portal"),bN=Symbol.for("react.fragment"),xN=Symbol.for("react.strict_mode"),EN=Symbol.for("react.profiler"),TN=Symbol.for("react.provider"),IN=Symbol.for("react.context"),$N=Symbol.for("react.forward_ref"),kN=Symbol.for("react.suspense"),SN=Symbol.for("react.memo"),CN=Symbol.for("react.lazy"),L0=Symbol.iterator;function AN(t){return t===null||typeof t!="object"?null:(t=L0&&t[L0]||t["@@iterator"],typeof t=="function"?t:null)}var $T={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},kT=Object.assign,ST={};function Jo(t,e,n){this.props=t,this.context=e,this.refs=ST,this.updater=n||$T}Jo.prototype.isReactComponent={};Jo.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Jo.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function CT(){}CT.prototype=Jo.prototype;function Hy(t,e,n){this.props=t,this.context=e,this.refs=ST,this.updater=n||$T}var Gy=Hy.prototype=new CT;Gy.constructor=Hy;kT(Gy,Jo.prototype);Gy.isPureReactComponent=!0;var z0=Array.isArray,AT=Object.prototype.hasOwnProperty,Ky={current:null},RT={key:!0,ref:!0,__self:!0,__source:!0};function NT(t,e,n){var r,i={},s=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(s=""+e.key),e)AT.call(e,r)&&!RT.hasOwnProperty(r)&&(i[r]=e[r]);var o=arguments.length-2;if(o===1)i.children=n;else if(1<o){for(var l=Array(o),u=0;u<o;u++)l[u]=arguments[u+2];i.children=l}if(t&&t.defaultProps)for(r in o=t.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return{$$typeof:mc,type:t,key:s,ref:a,props:i,_owner:Ky.current}}function RN(t,e){return{$$typeof:mc,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Qy(t){return typeof t=="object"&&t!==null&&t.$$typeof===mc}function NN(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var V0=/\/+/g;function Ip(t,e){return typeof t=="object"&&t!==null&&t.key!=null?NN(""+t.key):e.toString(36)}function eh(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case mc:case wN:a=!0}}if(a)return a=t,i=i(a),t=r===""?"."+Ip(a,0):r,z0(i)?(n="",t!=null&&(n=t.replace(V0,"$&/")+"/"),eh(i,e,n,"",function(u){return u})):i!=null&&(Qy(i)&&(i=RN(i,n+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(V0,"$&/")+"/")+t)),e.push(i)),1;if(a=0,r=r===""?".":r+":",z0(t))for(var o=0;o<t.length;o++){s=t[o];var l=r+Ip(s,o);a+=eh(s,e,n,l,i)}else if(l=AN(t),typeof l=="function")for(t=l.call(t),o=0;!(s=t.next()).done;)s=s.value,l=r+Ip(s,o++),a+=eh(s,e,n,l,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function fd(t,e,n){if(t==null)return t;var r=[],i=0;return eh(t,r,"","",function(s){return e.call(n,s,i++)}),r}function PN(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var fn={current:null},th={transition:null},ON={ReactCurrentDispatcher:fn,ReactCurrentBatchConfig:th,ReactCurrentOwner:Ky};function PT(){throw Error("act(...) is not supported in production builds of React.")}Me.Children={map:fd,forEach:function(t,e,n){fd(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return fd(t,function(){e++}),e},toArray:function(t){return fd(t,function(e){return e})||[]},only:function(t){if(!Qy(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Me.Component=Jo;Me.Fragment=bN;Me.Profiler=EN;Me.PureComponent=Hy;Me.StrictMode=xN;Me.Suspense=kN;Me.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ON;Me.act=PT;Me.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=kT({},t.props),i=t.key,s=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,a=Ky.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var o=t.type.defaultProps;for(l in e)AT.call(e,l)&&!RT.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){o=Array(l);for(var u=0;u<l;u++)o[u]=arguments[u+2];r.children=o}return{$$typeof:mc,type:t.type,key:i,ref:s,props:r,_owner:a}};Me.createContext=function(t){return t={$$typeof:IN,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:TN,_context:t},t.Consumer=t};Me.createElement=NT;Me.createFactory=function(t){var e=NT.bind(null,t);return e.type=t,e};Me.createRef=function(){return{current:null}};Me.forwardRef=function(t){return{$$typeof:$N,render:t}};Me.isValidElement=Qy;Me.lazy=function(t){return{$$typeof:CN,_payload:{_status:-1,_result:t},_init:PN}};Me.memo=function(t,e){return{$$typeof:SN,type:t,compare:e===void 0?null:e}};Me.startTransition=function(t){var e=th.transition;th.transition={};try{t()}finally{th.transition=e}};Me.unstable_act=PT;Me.useCallback=function(t,e){return fn.current.useCallback(t,e)};Me.useContext=function(t){return fn.current.useContext(t)};Me.useDebugValue=function(){};Me.useDeferredValue=function(t){return fn.current.useDeferredValue(t)};Me.useEffect=function(t,e){return fn.current.useEffect(t,e)};Me.useId=function(){return fn.current.useId()};Me.useImperativeHandle=function(t,e,n){return fn.current.useImperativeHandle(t,e,n)};Me.useInsertionEffect=function(t,e){return fn.current.useInsertionEffect(t,e)};Me.useLayoutEffect=function(t,e){return fn.current.useLayoutEffect(t,e)};Me.useMemo=function(t,e){return fn.current.useMemo(t,e)};Me.useReducer=function(t,e,n){return fn.current.useReducer(t,e,n)};Me.useRef=function(t){return fn.current.useRef(t)};Me.useState=function(t){return fn.current.useState(t)};Me.useSyncExternalStore=function(t,e,n){return fn.current.useSyncExternalStore(t,e,n)};Me.useTransition=function(){return fn.current.useTransition()};Me.version="18.3.1";IT.exports=Me;var ve=IT.exports;const OT=ET(ve);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DN=ve,MN=Symbol.for("react.element"),LN=Symbol.for("react.fragment"),zN=Object.prototype.hasOwnProperty,VN=DN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,jN={key:!0,ref:!0,__self:!0,__source:!0};function DT(t,e,n){var r,i={},s=null,a=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)zN.call(e,r)&&!jN.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:MN,type:t,key:s,ref:a,props:i,_owner:VN.current}}Tf.Fragment=LN;Tf.jsx=DT;Tf.jsxs=DT;TT.exports=Tf;var E=TT.exports,cg={},MT={exports:{}},Vn={},LT={exports:{}},zT={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(K,B){var F=K.length;K.push(B);e:for(;0<F;){var U=F-1>>>1,G=K[U];if(0<i(G,B))K[U]=B,K[F]=G,F=U;else break e}}function n(K){return K.length===0?null:K[0]}function r(K){if(K.length===0)return null;var B=K[0],F=K.pop();if(F!==B){K[0]=F;e:for(var U=0,G=K.length,q=G>>>1;U<q;){var Y=2*(U+1)-1,ae=K[Y],Ee=Y+1,Q=K[Ee];if(0>i(ae,F))Ee<G&&0>i(Q,ae)?(K[U]=Q,K[Ee]=F,U=Ee):(K[U]=ae,K[Y]=F,U=Y);else if(Ee<G&&0>i(Q,F))K[U]=Q,K[Ee]=F,U=Ee;else break e}}return B}function i(K,B){var F=K.sortIndex-B.sortIndex;return F!==0?F:K.id-B.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();t.unstable_now=function(){return a.now()-o}}var l=[],u=[],h=1,f=null,p=3,g=!1,_=!1,x=!1,$=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function I(K){for(var B=n(u);B!==null;){if(B.callback===null)r(u);else if(B.startTime<=K)r(u),B.sortIndex=B.expirationTime,e(l,B);else break;B=n(u)}}function R(K){if(x=!1,I(K),!_)if(n(l)!==null)_=!0,ue(M);else{var B=n(u);B!==null&&pe(R,B.startTime-K)}}function M(K,B){_=!1,x&&(x=!1,w(k),k=-1),g=!0;var F=p;try{for(I(B),f=n(l);f!==null&&(!(f.expirationTime>B)||K&&!D());){var U=f.callback;if(typeof U=="function"){f.callback=null,p=f.priorityLevel;var G=U(f.expirationTime<=B);B=t.unstable_now(),typeof G=="function"?f.callback=G:f===n(l)&&r(l),I(B)}else r(l);f=n(l)}if(f!==null)var q=!0;else{var Y=n(u);Y!==null&&pe(R,Y.startTime-B),q=!1}return q}finally{f=null,p=F,g=!1}}var j=!1,C=null,k=-1,P=5,A=-1;function D(){return!(t.unstable_now()-A<P)}function z(){if(C!==null){var K=t.unstable_now();A=K;var B=!0;try{B=C(!0,K)}finally{B?O():(j=!1,C=null)}}else j=!1}var O;if(typeof y=="function")O=function(){y(z)};else if(typeof MessageChannel<"u"){var ce=new MessageChannel,de=ce.port2;ce.port1.onmessage=z,O=function(){de.postMessage(null)}}else O=function(){$(z,0)};function ue(K){C=K,j||(j=!0,O())}function pe(K,B){k=$(function(){K(t.unstable_now())},B)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(K){K.callback=null},t.unstable_continueExecution=function(){_||g||(_=!0,ue(M))},t.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<K?Math.floor(1e3/K):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(K){switch(p){case 1:case 2:case 3:var B=3;break;default:B=p}var F=p;p=B;try{return K()}finally{p=F}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(K,B){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var F=p;p=K;try{return B()}finally{p=F}},t.unstable_scheduleCallback=function(K,B,F){var U=t.unstable_now();switch(typeof F=="object"&&F!==null?(F=F.delay,F=typeof F=="number"&&0<F?U+F:U):F=U,K){case 1:var G=-1;break;case 2:G=250;break;case 5:G=1073741823;break;case 4:G=1e4;break;default:G=5e3}return G=F+G,K={id:h++,callback:B,priorityLevel:K,startTime:F,expirationTime:G,sortIndex:-1},F>U?(K.sortIndex=F,e(u,K),n(l)===null&&K===n(u)&&(x?(w(k),k=-1):x=!0,pe(R,F-U))):(K.sortIndex=G,e(l,K),_||g||(_=!0,ue(M))),K},t.unstable_shouldYield=D,t.unstable_wrapCallback=function(K){var B=p;return function(){var F=p;p=B;try{return K.apply(this,arguments)}finally{p=F}}}})(zT);LT.exports=zT;var UN=LT.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BN=ve,zn=UN;function le(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var VT=new Set,Vu={};function Ca(t,e){Oo(t,e),Oo(t+"Capture",e)}function Oo(t,e){for(Vu[t]=e,t=0;t<e.length;t++)VT.add(e[t])}var wi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),dg=Object.prototype.hasOwnProperty,FN=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,j0={},U0={};function WN(t){return dg.call(U0,t)?!0:dg.call(j0,t)?!1:FN.test(t)?U0[t]=!0:(j0[t]=!0,!1)}function qN(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function HN(t,e,n,r){if(e===null||typeof e>"u"||qN(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function pn(t,e,n,r,i,s,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=a}var Kt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Kt[t]=new pn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Kt[e]=new pn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Kt[t]=new pn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Kt[t]=new pn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Kt[t]=new pn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Kt[t]=new pn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Kt[t]=new pn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Kt[t]=new pn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Kt[t]=new pn(t,5,!1,t.toLowerCase(),null,!1,!1)});var Yy=/[\-:]([a-z])/g;function Jy(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Yy,Jy);Kt[e]=new pn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Yy,Jy);Kt[e]=new pn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Yy,Jy);Kt[e]=new pn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Kt[t]=new pn(t,1,!1,t.toLowerCase(),null,!1,!1)});Kt.xlinkHref=new pn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Kt[t]=new pn(t,1,!1,t.toLowerCase(),null,!0,!0)});function Xy(t,e,n,r){var i=Kt.hasOwnProperty(e)?Kt[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(HN(e,n,i,r)&&(n=null),r||i===null?WN(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Ci=BN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,pd=Symbol.for("react.element"),ao=Symbol.for("react.portal"),oo=Symbol.for("react.fragment"),Zy=Symbol.for("react.strict_mode"),hg=Symbol.for("react.profiler"),jT=Symbol.for("react.provider"),UT=Symbol.for("react.context"),e_=Symbol.for("react.forward_ref"),fg=Symbol.for("react.suspense"),pg=Symbol.for("react.suspense_list"),t_=Symbol.for("react.memo"),Fi=Symbol.for("react.lazy"),BT=Symbol.for("react.offscreen"),B0=Symbol.iterator;function Ll(t){return t===null||typeof t!="object"?null:(t=B0&&t[B0]||t["@@iterator"],typeof t=="function"?t:null)}var mt=Object.assign,$p;function iu(t){if($p===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);$p=e&&e[1]||""}return`
`+$p+t}var kp=!1;function Sp(t,e){if(!t||kp)return"";kp=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var i=u.stack.split(`
`),s=r.stack.split(`
`),a=i.length-1,o=s.length-1;1<=a&&0<=o&&i[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(i[a]!==s[o]){if(a!==1||o!==1)do if(a--,o--,0>o||i[a]!==s[o]){var l=`
`+i[a].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=a&&0<=o);break}}}finally{kp=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?iu(t):""}function GN(t){switch(t.tag){case 5:return iu(t.type);case 16:return iu("Lazy");case 13:return iu("Suspense");case 19:return iu("SuspenseList");case 0:case 2:case 15:return t=Sp(t.type,!1),t;case 11:return t=Sp(t.type.render,!1),t;case 1:return t=Sp(t.type,!0),t;default:return""}}function mg(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case oo:return"Fragment";case ao:return"Portal";case hg:return"Profiler";case Zy:return"StrictMode";case fg:return"Suspense";case pg:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case UT:return(t.displayName||"Context")+".Consumer";case jT:return(t._context.displayName||"Context")+".Provider";case e_:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case t_:return e=t.displayName||null,e!==null?e:mg(t.type)||"Memo";case Fi:e=t._payload,t=t._init;try{return mg(t(e))}catch{}}return null}function KN(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return mg(e);case 8:return e===Zy?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function hs(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function FT(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function QN(t){var e=FT(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(a){r=""+a,s.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function md(t){t._valueTracker||(t._valueTracker=QN(t))}function WT(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=FT(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Th(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function gg(t,e){var n=e.checked;return mt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function F0(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=hs(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function qT(t,e){e=e.checked,e!=null&&Xy(t,"checked",e,!1)}function yg(t,e){qT(t,e);var n=hs(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?_g(t,e.type,n):e.hasOwnProperty("defaultValue")&&_g(t,e.type,hs(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function W0(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function _g(t,e,n){(e!=="number"||Th(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var su=Array.isArray;function xo(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+hs(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function vg(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(le(91));return mt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function q0(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(le(92));if(su(n)){if(1<n.length)throw Error(le(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:hs(n)}}function HT(t,e){var n=hs(e.value),r=hs(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function H0(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function GT(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function wg(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?GT(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var gd,KT=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(gd=gd||document.createElement("div"),gd.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=gd.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function ju(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var wu={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},YN=["Webkit","ms","Moz","O"];Object.keys(wu).forEach(function(t){YN.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),wu[e]=wu[t]})});function QT(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||wu.hasOwnProperty(t)&&wu[t]?(""+e).trim():e+"px"}function YT(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=QT(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var JN=mt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function bg(t,e){if(e){if(JN[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(le(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(le(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(le(61))}if(e.style!=null&&typeof e.style!="object")throw Error(le(62))}}function xg(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Eg=null;function n_(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Tg=null,Eo=null,To=null;function G0(t){if(t=_c(t)){if(typeof Tg!="function")throw Error(le(280));var e=t.stateNode;e&&(e=Cf(e),Tg(t.stateNode,t.type,e))}}function JT(t){Eo?To?To.push(t):To=[t]:Eo=t}function XT(){if(Eo){var t=Eo,e=To;if(To=Eo=null,G0(t),e)for(t=0;t<e.length;t++)G0(e[t])}}function ZT(t,e){return t(e)}function eI(){}var Cp=!1;function tI(t,e,n){if(Cp)return t(e,n);Cp=!0;try{return ZT(t,e,n)}finally{Cp=!1,(Eo!==null||To!==null)&&(eI(),XT())}}function Uu(t,e){var n=t.stateNode;if(n===null)return null;var r=Cf(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(le(231,e,typeof n));return n}var Ig=!1;if(wi)try{var zl={};Object.defineProperty(zl,"passive",{get:function(){Ig=!0}}),window.addEventListener("test",zl,zl),window.removeEventListener("test",zl,zl)}catch{Ig=!1}function XN(t,e,n,r,i,s,a,o,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(h){this.onError(h)}}var bu=!1,Ih=null,$h=!1,$g=null,ZN={onError:function(t){bu=!0,Ih=t}};function eP(t,e,n,r,i,s,a,o,l){bu=!1,Ih=null,XN.apply(ZN,arguments)}function tP(t,e,n,r,i,s,a,o,l){if(eP.apply(this,arguments),bu){if(bu){var u=Ih;bu=!1,Ih=null}else throw Error(le(198));$h||($h=!0,$g=u)}}function Aa(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function nI(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function K0(t){if(Aa(t)!==t)throw Error(le(188))}function nP(t){var e=t.alternate;if(!e){if(e=Aa(t),e===null)throw Error(le(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return K0(i),t;if(s===r)return K0(i),e;s=s.sibling}throw Error(le(188))}if(n.return!==r.return)n=i,r=s;else{for(var a=!1,o=i.child;o;){if(o===n){a=!0,n=i,r=s;break}if(o===r){a=!0,r=i,n=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===n){a=!0,n=s,r=i;break}if(o===r){a=!0,r=s,n=i;break}o=o.sibling}if(!a)throw Error(le(189))}}if(n.alternate!==r)throw Error(le(190))}if(n.tag!==3)throw Error(le(188));return n.stateNode.current===n?t:e}function rI(t){return t=nP(t),t!==null?iI(t):null}function iI(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=iI(t);if(e!==null)return e;t=t.sibling}return null}var sI=zn.unstable_scheduleCallback,Q0=zn.unstable_cancelCallback,rP=zn.unstable_shouldYield,iP=zn.unstable_requestPaint,xt=zn.unstable_now,sP=zn.unstable_getCurrentPriorityLevel,r_=zn.unstable_ImmediatePriority,aI=zn.unstable_UserBlockingPriority,kh=zn.unstable_NormalPriority,aP=zn.unstable_LowPriority,oI=zn.unstable_IdlePriority,If=null,Br=null;function oP(t){if(Br&&typeof Br.onCommitFiberRoot=="function")try{Br.onCommitFiberRoot(If,t,void 0,(t.current.flags&128)===128)}catch{}}var vr=Math.clz32?Math.clz32:cP,lP=Math.log,uP=Math.LN2;function cP(t){return t>>>=0,t===0?32:31-(lP(t)/uP|0)|0}var yd=64,_d=4194304;function au(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Sh(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,a=n&268435455;if(a!==0){var o=a&~i;o!==0?r=au(o):(s&=a,s!==0&&(r=au(s)))}else a=n&~i,a!==0?r=au(a):s!==0&&(r=au(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-vr(e),i=1<<n,r|=t[n],e&=~i;return r}function dP(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function hP(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var a=31-vr(s),o=1<<a,l=i[a];l===-1?(!(o&n)||o&r)&&(i[a]=dP(o,e)):l<=e&&(t.expiredLanes|=o),s&=~o}}function kg(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function lI(){var t=yd;return yd<<=1,!(yd&4194240)&&(yd=64),t}function Ap(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function gc(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-vr(e),t[e]=n}function fP(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-vr(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function i_(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-vr(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var Je=0;function uI(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var cI,s_,dI,hI,fI,Sg=!1,vd=[],es=null,ts=null,ns=null,Bu=new Map,Fu=new Map,qi=[],pP="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Y0(t,e){switch(t){case"focusin":case"focusout":es=null;break;case"dragenter":case"dragleave":ts=null;break;case"mouseover":case"mouseout":ns=null;break;case"pointerover":case"pointerout":Bu.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Fu.delete(e.pointerId)}}function Vl(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=_c(e),e!==null&&s_(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function mP(t,e,n,r,i){switch(e){case"focusin":return es=Vl(es,t,e,n,r,i),!0;case"dragenter":return ts=Vl(ts,t,e,n,r,i),!0;case"mouseover":return ns=Vl(ns,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return Bu.set(s,Vl(Bu.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Fu.set(s,Vl(Fu.get(s)||null,t,e,n,r,i)),!0}return!1}function pI(t){var e=sa(t.target);if(e!==null){var n=Aa(e);if(n!==null){if(e=n.tag,e===13){if(e=nI(n),e!==null){t.blockedOn=e,fI(t.priority,function(){dI(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function nh(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Cg(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Eg=r,n.target.dispatchEvent(r),Eg=null}else return e=_c(n),e!==null&&s_(e),t.blockedOn=n,!1;e.shift()}return!0}function J0(t,e,n){nh(t)&&n.delete(e)}function gP(){Sg=!1,es!==null&&nh(es)&&(es=null),ts!==null&&nh(ts)&&(ts=null),ns!==null&&nh(ns)&&(ns=null),Bu.forEach(J0),Fu.forEach(J0)}function jl(t,e){t.blockedOn===e&&(t.blockedOn=null,Sg||(Sg=!0,zn.unstable_scheduleCallback(zn.unstable_NormalPriority,gP)))}function Wu(t){function e(i){return jl(i,t)}if(0<vd.length){jl(vd[0],t);for(var n=1;n<vd.length;n++){var r=vd[n];r.blockedOn===t&&(r.blockedOn=null)}}for(es!==null&&jl(es,t),ts!==null&&jl(ts,t),ns!==null&&jl(ns,t),Bu.forEach(e),Fu.forEach(e),n=0;n<qi.length;n++)r=qi[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<qi.length&&(n=qi[0],n.blockedOn===null);)pI(n),n.blockedOn===null&&qi.shift()}var Io=Ci.ReactCurrentBatchConfig,Ch=!0;function yP(t,e,n,r){var i=Je,s=Io.transition;Io.transition=null;try{Je=1,a_(t,e,n,r)}finally{Je=i,Io.transition=s}}function _P(t,e,n,r){var i=Je,s=Io.transition;Io.transition=null;try{Je=4,a_(t,e,n,r)}finally{Je=i,Io.transition=s}}function a_(t,e,n,r){if(Ch){var i=Cg(t,e,n,r);if(i===null)jp(t,e,r,Ah,n),Y0(t,r);else if(mP(i,t,e,n,r))r.stopPropagation();else if(Y0(t,r),e&4&&-1<pP.indexOf(t)){for(;i!==null;){var s=_c(i);if(s!==null&&cI(s),s=Cg(t,e,n,r),s===null&&jp(t,e,r,Ah,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else jp(t,e,r,null,n)}}var Ah=null;function Cg(t,e,n,r){if(Ah=null,t=n_(r),t=sa(t),t!==null)if(e=Aa(t),e===null)t=null;else if(n=e.tag,n===13){if(t=nI(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ah=t,null}function mI(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(sP()){case r_:return 1;case aI:return 4;case kh:case aP:return 16;case oI:return 536870912;default:return 16}default:return 16}}var Ji=null,o_=null,rh=null;function gI(){if(rh)return rh;var t,e=o_,n=e.length,r,i="value"in Ji?Ji.value:Ji.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var a=n-t;for(r=1;r<=a&&e[n-r]===i[s-r];r++);return rh=i.slice(t,1<r?1-r:void 0)}function ih(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function wd(){return!0}function X0(){return!1}function jn(t){function e(n,r,i,s,a){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in t)t.hasOwnProperty(o)&&(n=t[o],this[o]=n?n(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?wd:X0,this.isPropagationStopped=X0,this}return mt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=wd)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=wd)},persist:function(){},isPersistent:wd}),e}var Xo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},l_=jn(Xo),yc=mt({},Xo,{view:0,detail:0}),vP=jn(yc),Rp,Np,Ul,$f=mt({},yc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:u_,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ul&&(Ul&&t.type==="mousemove"?(Rp=t.screenX-Ul.screenX,Np=t.screenY-Ul.screenY):Np=Rp=0,Ul=t),Rp)},movementY:function(t){return"movementY"in t?t.movementY:Np}}),Z0=jn($f),wP=mt({},$f,{dataTransfer:0}),bP=jn(wP),xP=mt({},yc,{relatedTarget:0}),Pp=jn(xP),EP=mt({},Xo,{animationName:0,elapsedTime:0,pseudoElement:0}),TP=jn(EP),IP=mt({},Xo,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),$P=jn(IP),kP=mt({},Xo,{data:0}),ew=jn(kP),SP={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},CP={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},AP={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function RP(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=AP[t])?!!e[t]:!1}function u_(){return RP}var NP=mt({},yc,{key:function(t){if(t.key){var e=SP[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=ih(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?CP[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:u_,charCode:function(t){return t.type==="keypress"?ih(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?ih(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),PP=jn(NP),OP=mt({},$f,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),tw=jn(OP),DP=mt({},yc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:u_}),MP=jn(DP),LP=mt({},Xo,{propertyName:0,elapsedTime:0,pseudoElement:0}),zP=jn(LP),VP=mt({},$f,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),jP=jn(VP),UP=[9,13,27,32],c_=wi&&"CompositionEvent"in window,xu=null;wi&&"documentMode"in document&&(xu=document.documentMode);var BP=wi&&"TextEvent"in window&&!xu,yI=wi&&(!c_||xu&&8<xu&&11>=xu),nw=" ",rw=!1;function _I(t,e){switch(t){case"keyup":return UP.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function vI(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var lo=!1;function FP(t,e){switch(t){case"compositionend":return vI(e);case"keypress":return e.which!==32?null:(rw=!0,nw);case"textInput":return t=e.data,t===nw&&rw?null:t;default:return null}}function WP(t,e){if(lo)return t==="compositionend"||!c_&&_I(t,e)?(t=gI(),rh=o_=Ji=null,lo=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return yI&&e.locale!=="ko"?null:e.data;default:return null}}var qP={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function iw(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!qP[t.type]:e==="textarea"}function wI(t,e,n,r){JT(r),e=Rh(e,"onChange"),0<e.length&&(n=new l_("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Eu=null,qu=null;function HP(t){RI(t,0)}function kf(t){var e=ho(t);if(WT(e))return t}function GP(t,e){if(t==="change")return e}var bI=!1;if(wi){var Op;if(wi){var Dp="oninput"in document;if(!Dp){var sw=document.createElement("div");sw.setAttribute("oninput","return;"),Dp=typeof sw.oninput=="function"}Op=Dp}else Op=!1;bI=Op&&(!document.documentMode||9<document.documentMode)}function aw(){Eu&&(Eu.detachEvent("onpropertychange",xI),qu=Eu=null)}function xI(t){if(t.propertyName==="value"&&kf(qu)){var e=[];wI(e,qu,t,n_(t)),tI(HP,e)}}function KP(t,e,n){t==="focusin"?(aw(),Eu=e,qu=n,Eu.attachEvent("onpropertychange",xI)):t==="focusout"&&aw()}function QP(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return kf(qu)}function YP(t,e){if(t==="click")return kf(e)}function JP(t,e){if(t==="input"||t==="change")return kf(e)}function XP(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Tr=typeof Object.is=="function"?Object.is:XP;function Hu(t,e){if(Tr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!dg.call(e,i)||!Tr(t[i],e[i]))return!1}return!0}function ow(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function lw(t,e){var n=ow(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=ow(n)}}function EI(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?EI(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function TI(){for(var t=window,e=Th();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Th(t.document)}return e}function d_(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function ZP(t){var e=TI(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&EI(n.ownerDocument.documentElement,n)){if(r!==null&&d_(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=lw(n,s);var a=lw(n,r);i&&a&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var e4=wi&&"documentMode"in document&&11>=document.documentMode,uo=null,Ag=null,Tu=null,Rg=!1;function uw(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Rg||uo==null||uo!==Th(r)||(r=uo,"selectionStart"in r&&d_(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Tu&&Hu(Tu,r)||(Tu=r,r=Rh(Ag,"onSelect"),0<r.length&&(e=new l_("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=uo)))}function bd(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var co={animationend:bd("Animation","AnimationEnd"),animationiteration:bd("Animation","AnimationIteration"),animationstart:bd("Animation","AnimationStart"),transitionend:bd("Transition","TransitionEnd")},Mp={},II={};wi&&(II=document.createElement("div").style,"AnimationEvent"in window||(delete co.animationend.animation,delete co.animationiteration.animation,delete co.animationstart.animation),"TransitionEvent"in window||delete co.transitionend.transition);function Sf(t){if(Mp[t])return Mp[t];if(!co[t])return t;var e=co[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in II)return Mp[t]=e[n];return t}var $I=Sf("animationend"),kI=Sf("animationiteration"),SI=Sf("animationstart"),CI=Sf("transitionend"),AI=new Map,cw="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xs(t,e){AI.set(t,e),Ca(e,[t])}for(var Lp=0;Lp<cw.length;Lp++){var zp=cw[Lp],t4=zp.toLowerCase(),n4=zp[0].toUpperCase()+zp.slice(1);xs(t4,"on"+n4)}xs($I,"onAnimationEnd");xs(kI,"onAnimationIteration");xs(SI,"onAnimationStart");xs("dblclick","onDoubleClick");xs("focusin","onFocus");xs("focusout","onBlur");xs(CI,"onTransitionEnd");Oo("onMouseEnter",["mouseout","mouseover"]);Oo("onMouseLeave",["mouseout","mouseover"]);Oo("onPointerEnter",["pointerout","pointerover"]);Oo("onPointerLeave",["pointerout","pointerover"]);Ca("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ca("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ca("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ca("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ca("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ca("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ou="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),r4=new Set("cancel close invalid load scroll toggle".split(" ").concat(ou));function dw(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,tP(r,e,void 0,t),t.currentTarget=null}function RI(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==s&&i.isPropagationStopped())break e;dw(i,o,u),s=l}else for(a=0;a<r.length;a++){if(o=r[a],l=o.instance,u=o.currentTarget,o=o.listener,l!==s&&i.isPropagationStopped())break e;dw(i,o,u),s=l}}}if($h)throw t=$g,$h=!1,$g=null,t}function ot(t,e){var n=e[Mg];n===void 0&&(n=e[Mg]=new Set);var r=t+"__bubble";n.has(r)||(NI(e,t,2,!1),n.add(r))}function Vp(t,e,n){var r=0;e&&(r|=4),NI(n,t,r,e)}var xd="_reactListening"+Math.random().toString(36).slice(2);function Gu(t){if(!t[xd]){t[xd]=!0,VT.forEach(function(n){n!=="selectionchange"&&(r4.has(n)||Vp(n,!1,t),Vp(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[xd]||(e[xd]=!0,Vp("selectionchange",!1,e))}}function NI(t,e,n,r){switch(mI(e)){case 1:var i=yP;break;case 4:i=_P;break;default:i=a_}n=i.bind(null,e,n,t),i=void 0,!Ig||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function jp(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var o=r.stateNode.containerInfo;if(o===i||o.nodeType===8&&o.parentNode===i)break;if(a===4)for(a=r.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;a=a.return}for(;o!==null;){if(a=sa(o),a===null)return;if(l=a.tag,l===5||l===6){r=s=a;continue e}o=o.parentNode}}r=r.return}tI(function(){var u=s,h=n_(n),f=[];e:{var p=AI.get(t);if(p!==void 0){var g=l_,_=t;switch(t){case"keypress":if(ih(n)===0)break e;case"keydown":case"keyup":g=PP;break;case"focusin":_="focus",g=Pp;break;case"focusout":_="blur",g=Pp;break;case"beforeblur":case"afterblur":g=Pp;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":g=Z0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":g=bP;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":g=MP;break;case $I:case kI:case SI:g=TP;break;case CI:g=zP;break;case"scroll":g=vP;break;case"wheel":g=jP;break;case"copy":case"cut":case"paste":g=$P;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":g=tw}var x=(e&4)!==0,$=!x&&t==="scroll",w=x?p!==null?p+"Capture":null:p;x=[];for(var y=u,I;y!==null;){I=y;var R=I.stateNode;if(I.tag===5&&R!==null&&(I=R,w!==null&&(R=Uu(y,w),R!=null&&x.push(Ku(y,R,I)))),$)break;y=y.return}0<x.length&&(p=new g(p,_,null,n,h),f.push({event:p,listeners:x}))}}if(!(e&7)){e:{if(p=t==="mouseover"||t==="pointerover",g=t==="mouseout"||t==="pointerout",p&&n!==Eg&&(_=n.relatedTarget||n.fromElement)&&(sa(_)||_[bi]))break e;if((g||p)&&(p=h.window===h?h:(p=h.ownerDocument)?p.defaultView||p.parentWindow:window,g?(_=n.relatedTarget||n.toElement,g=u,_=_?sa(_):null,_!==null&&($=Aa(_),_!==$||_.tag!==5&&_.tag!==6)&&(_=null)):(g=null,_=u),g!==_)){if(x=Z0,R="onMouseLeave",w="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(x=tw,R="onPointerLeave",w="onPointerEnter",y="pointer"),$=g==null?p:ho(g),I=_==null?p:ho(_),p=new x(R,y+"leave",g,n,h),p.target=$,p.relatedTarget=I,R=null,sa(h)===u&&(x=new x(w,y+"enter",_,n,h),x.target=I,x.relatedTarget=$,R=x),$=R,g&&_)t:{for(x=g,w=_,y=0,I=x;I;I=Za(I))y++;for(I=0,R=w;R;R=Za(R))I++;for(;0<y-I;)x=Za(x),y--;for(;0<I-y;)w=Za(w),I--;for(;y--;){if(x===w||w!==null&&x===w.alternate)break t;x=Za(x),w=Za(w)}x=null}else x=null;g!==null&&hw(f,p,g,x,!1),_!==null&&$!==null&&hw(f,$,_,x,!0)}}e:{if(p=u?ho(u):window,g=p.nodeName&&p.nodeName.toLowerCase(),g==="select"||g==="input"&&p.type==="file")var M=GP;else if(iw(p))if(bI)M=JP;else{M=QP;var j=KP}else(g=p.nodeName)&&g.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(M=YP);if(M&&(M=M(t,u))){wI(f,M,n,h);break e}j&&j(t,p,u),t==="focusout"&&(j=p._wrapperState)&&j.controlled&&p.type==="number"&&_g(p,"number",p.value)}switch(j=u?ho(u):window,t){case"focusin":(iw(j)||j.contentEditable==="true")&&(uo=j,Ag=u,Tu=null);break;case"focusout":Tu=Ag=uo=null;break;case"mousedown":Rg=!0;break;case"contextmenu":case"mouseup":case"dragend":Rg=!1,uw(f,n,h);break;case"selectionchange":if(e4)break;case"keydown":case"keyup":uw(f,n,h)}var C;if(c_)e:{switch(t){case"compositionstart":var k="onCompositionStart";break e;case"compositionend":k="onCompositionEnd";break e;case"compositionupdate":k="onCompositionUpdate";break e}k=void 0}else lo?_I(t,n)&&(k="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(k="onCompositionStart");k&&(yI&&n.locale!=="ko"&&(lo||k!=="onCompositionStart"?k==="onCompositionEnd"&&lo&&(C=gI()):(Ji=h,o_="value"in Ji?Ji.value:Ji.textContent,lo=!0)),j=Rh(u,k),0<j.length&&(k=new ew(k,t,null,n,h),f.push({event:k,listeners:j}),C?k.data=C:(C=vI(n),C!==null&&(k.data=C)))),(C=BP?FP(t,n):WP(t,n))&&(u=Rh(u,"onBeforeInput"),0<u.length&&(h=new ew("onBeforeInput","beforeinput",null,n,h),f.push({event:h,listeners:u}),h.data=C))}RI(f,e)})}function Ku(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Rh(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Uu(t,n),s!=null&&r.unshift(Ku(t,s,i)),s=Uu(t,e),s!=null&&r.push(Ku(t,s,i))),t=t.return}return r}function Za(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function hw(t,e,n,r,i){for(var s=e._reactName,a=[];n!==null&&n!==r;){var o=n,l=o.alternate,u=o.stateNode;if(l!==null&&l===r)break;o.tag===5&&u!==null&&(o=u,i?(l=Uu(n,s),l!=null&&a.unshift(Ku(n,l,o))):i||(l=Uu(n,s),l!=null&&a.push(Ku(n,l,o)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var i4=/\r\n?/g,s4=/\u0000|\uFFFD/g;function fw(t){return(typeof t=="string"?t:""+t).replace(i4,`
`).replace(s4,"")}function Ed(t,e,n){if(e=fw(e),fw(t)!==e&&n)throw Error(le(425))}function Nh(){}var Ng=null,Pg=null;function Og(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Dg=typeof setTimeout=="function"?setTimeout:void 0,a4=typeof clearTimeout=="function"?clearTimeout:void 0,pw=typeof Promise=="function"?Promise:void 0,o4=typeof queueMicrotask=="function"?queueMicrotask:typeof pw<"u"?function(t){return pw.resolve(null).then(t).catch(l4)}:Dg;function l4(t){setTimeout(function(){throw t})}function Up(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),Wu(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Wu(e)}function rs(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function mw(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Zo=Math.random().toString(36).slice(2),Ur="__reactFiber$"+Zo,Qu="__reactProps$"+Zo,bi="__reactContainer$"+Zo,Mg="__reactEvents$"+Zo,u4="__reactListeners$"+Zo,c4="__reactHandles$"+Zo;function sa(t){var e=t[Ur];if(e)return e;for(var n=t.parentNode;n;){if(e=n[bi]||n[Ur]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=mw(t);t!==null;){if(n=t[Ur])return n;t=mw(t)}return e}t=n,n=t.parentNode}return null}function _c(t){return t=t[Ur]||t[bi],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ho(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(le(33))}function Cf(t){return t[Qu]||null}var Lg=[],fo=-1;function Es(t){return{current:t}}function ut(t){0>fo||(t.current=Lg[fo],Lg[fo]=null,fo--)}function at(t,e){fo++,Lg[fo]=t.current,t.current=e}var fs={},an=Es(fs),Tn=Es(!1),pa=fs;function Do(t,e){var n=t.type.contextTypes;if(!n)return fs;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function In(t){return t=t.childContextTypes,t!=null}function Ph(){ut(Tn),ut(an)}function gw(t,e,n){if(an.current!==fs)throw Error(le(168));at(an,e),at(Tn,n)}function PI(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(le(108,KN(t)||"Unknown",i));return mt({},n,r)}function Oh(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||fs,pa=an.current,at(an,t),at(Tn,Tn.current),!0}function yw(t,e,n){var r=t.stateNode;if(!r)throw Error(le(169));n?(t=PI(t,e,pa),r.__reactInternalMemoizedMergedChildContext=t,ut(Tn),ut(an),at(an,t)):ut(Tn),at(Tn,n)}var di=null,Af=!1,Bp=!1;function OI(t){di===null?di=[t]:di.push(t)}function d4(t){Af=!0,OI(t)}function Ts(){if(!Bp&&di!==null){Bp=!0;var t=0,e=Je;try{var n=di;for(Je=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}di=null,Af=!1}catch(i){throw di!==null&&(di=di.slice(t+1)),sI(r_,Ts),i}finally{Je=e,Bp=!1}}return null}var po=[],mo=0,Dh=null,Mh=0,Wn=[],qn=0,ma=null,fi=1,pi="";function Zs(t,e){po[mo++]=Mh,po[mo++]=Dh,Dh=t,Mh=e}function DI(t,e,n){Wn[qn++]=fi,Wn[qn++]=pi,Wn[qn++]=ma,ma=t;var r=fi;t=pi;var i=32-vr(r)-1;r&=~(1<<i),n+=1;var s=32-vr(e)+i;if(30<s){var a=i-i%5;s=(r&(1<<a)-1).toString(32),r>>=a,i-=a,fi=1<<32-vr(e)+i|n<<i|r,pi=s+t}else fi=1<<s|n<<i|r,pi=t}function h_(t){t.return!==null&&(Zs(t,1),DI(t,1,0))}function f_(t){for(;t===Dh;)Dh=po[--mo],po[mo]=null,Mh=po[--mo],po[mo]=null;for(;t===ma;)ma=Wn[--qn],Wn[qn]=null,pi=Wn[--qn],Wn[qn]=null,fi=Wn[--qn],Wn[qn]=null}var Mn=null,On=null,dt=!1,pr=null;function MI(t,e){var n=Gn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function _w(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Mn=t,On=rs(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Mn=t,On=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=ma!==null?{id:fi,overflow:pi}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Gn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Mn=t,On=null,!0):!1;default:return!1}}function zg(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Vg(t){if(dt){var e=On;if(e){var n=e;if(!_w(t,e)){if(zg(t))throw Error(le(418));e=rs(n.nextSibling);var r=Mn;e&&_w(t,e)?MI(r,n):(t.flags=t.flags&-4097|2,dt=!1,Mn=t)}}else{if(zg(t))throw Error(le(418));t.flags=t.flags&-4097|2,dt=!1,Mn=t}}}function vw(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Mn=t}function Td(t){if(t!==Mn)return!1;if(!dt)return vw(t),dt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Og(t.type,t.memoizedProps)),e&&(e=On)){if(zg(t))throw LI(),Error(le(418));for(;e;)MI(t,e),e=rs(e.nextSibling)}if(vw(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(le(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){On=rs(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}On=null}}else On=Mn?rs(t.stateNode.nextSibling):null;return!0}function LI(){for(var t=On;t;)t=rs(t.nextSibling)}function Mo(){On=Mn=null,dt=!1}function p_(t){pr===null?pr=[t]:pr.push(t)}var h4=Ci.ReactCurrentBatchConfig;function Bl(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(le(309));var r=n.stateNode}if(!r)throw Error(le(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(a){var o=i.refs;a===null?delete o[s]:o[s]=a},e._stringRef=s,e)}if(typeof t!="string")throw Error(le(284));if(!n._owner)throw Error(le(290,t))}return t}function Id(t,e){throw t=Object.prototype.toString.call(e),Error(le(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function ww(t){var e=t._init;return e(t._payload)}function zI(t){function e(w,y){if(t){var I=w.deletions;I===null?(w.deletions=[y],w.flags|=16):I.push(y)}}function n(w,y){if(!t)return null;for(;y!==null;)e(w,y),y=y.sibling;return null}function r(w,y){for(w=new Map;y!==null;)y.key!==null?w.set(y.key,y):w.set(y.index,y),y=y.sibling;return w}function i(w,y){return w=os(w,y),w.index=0,w.sibling=null,w}function s(w,y,I){return w.index=I,t?(I=w.alternate,I!==null?(I=I.index,I<y?(w.flags|=2,y):I):(w.flags|=2,y)):(w.flags|=1048576,y)}function a(w){return t&&w.alternate===null&&(w.flags|=2),w}function o(w,y,I,R){return y===null||y.tag!==6?(y=Qp(I,w.mode,R),y.return=w,y):(y=i(y,I),y.return=w,y)}function l(w,y,I,R){var M=I.type;return M===oo?h(w,y,I.props.children,R,I.key):y!==null&&(y.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===Fi&&ww(M)===y.type)?(R=i(y,I.props),R.ref=Bl(w,y,I),R.return=w,R):(R=dh(I.type,I.key,I.props,null,w.mode,R),R.ref=Bl(w,y,I),R.return=w,R)}function u(w,y,I,R){return y===null||y.tag!==4||y.stateNode.containerInfo!==I.containerInfo||y.stateNode.implementation!==I.implementation?(y=Yp(I,w.mode,R),y.return=w,y):(y=i(y,I.children||[]),y.return=w,y)}function h(w,y,I,R,M){return y===null||y.tag!==7?(y=ca(I,w.mode,R,M),y.return=w,y):(y=i(y,I),y.return=w,y)}function f(w,y,I){if(typeof y=="string"&&y!==""||typeof y=="number")return y=Qp(""+y,w.mode,I),y.return=w,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case pd:return I=dh(y.type,y.key,y.props,null,w.mode,I),I.ref=Bl(w,null,y),I.return=w,I;case ao:return y=Yp(y,w.mode,I),y.return=w,y;case Fi:var R=y._init;return f(w,R(y._payload),I)}if(su(y)||Ll(y))return y=ca(y,w.mode,I,null),y.return=w,y;Id(w,y)}return null}function p(w,y,I,R){var M=y!==null?y.key:null;if(typeof I=="string"&&I!==""||typeof I=="number")return M!==null?null:o(w,y,""+I,R);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case pd:return I.key===M?l(w,y,I,R):null;case ao:return I.key===M?u(w,y,I,R):null;case Fi:return M=I._init,p(w,y,M(I._payload),R)}if(su(I)||Ll(I))return M!==null?null:h(w,y,I,R,null);Id(w,I)}return null}function g(w,y,I,R,M){if(typeof R=="string"&&R!==""||typeof R=="number")return w=w.get(I)||null,o(y,w,""+R,M);if(typeof R=="object"&&R!==null){switch(R.$$typeof){case pd:return w=w.get(R.key===null?I:R.key)||null,l(y,w,R,M);case ao:return w=w.get(R.key===null?I:R.key)||null,u(y,w,R,M);case Fi:var j=R._init;return g(w,y,I,j(R._payload),M)}if(su(R)||Ll(R))return w=w.get(I)||null,h(y,w,R,M,null);Id(y,R)}return null}function _(w,y,I,R){for(var M=null,j=null,C=y,k=y=0,P=null;C!==null&&k<I.length;k++){C.index>k?(P=C,C=null):P=C.sibling;var A=p(w,C,I[k],R);if(A===null){C===null&&(C=P);break}t&&C&&A.alternate===null&&e(w,C),y=s(A,y,k),j===null?M=A:j.sibling=A,j=A,C=P}if(k===I.length)return n(w,C),dt&&Zs(w,k),M;if(C===null){for(;k<I.length;k++)C=f(w,I[k],R),C!==null&&(y=s(C,y,k),j===null?M=C:j.sibling=C,j=C);return dt&&Zs(w,k),M}for(C=r(w,C);k<I.length;k++)P=g(C,w,k,I[k],R),P!==null&&(t&&P.alternate!==null&&C.delete(P.key===null?k:P.key),y=s(P,y,k),j===null?M=P:j.sibling=P,j=P);return t&&C.forEach(function(D){return e(w,D)}),dt&&Zs(w,k),M}function x(w,y,I,R){var M=Ll(I);if(typeof M!="function")throw Error(le(150));if(I=M.call(I),I==null)throw Error(le(151));for(var j=M=null,C=y,k=y=0,P=null,A=I.next();C!==null&&!A.done;k++,A=I.next()){C.index>k?(P=C,C=null):P=C.sibling;var D=p(w,C,A.value,R);if(D===null){C===null&&(C=P);break}t&&C&&D.alternate===null&&e(w,C),y=s(D,y,k),j===null?M=D:j.sibling=D,j=D,C=P}if(A.done)return n(w,C),dt&&Zs(w,k),M;if(C===null){for(;!A.done;k++,A=I.next())A=f(w,A.value,R),A!==null&&(y=s(A,y,k),j===null?M=A:j.sibling=A,j=A);return dt&&Zs(w,k),M}for(C=r(w,C);!A.done;k++,A=I.next())A=g(C,w,k,A.value,R),A!==null&&(t&&A.alternate!==null&&C.delete(A.key===null?k:A.key),y=s(A,y,k),j===null?M=A:j.sibling=A,j=A);return t&&C.forEach(function(z){return e(w,z)}),dt&&Zs(w,k),M}function $(w,y,I,R){if(typeof I=="object"&&I!==null&&I.type===oo&&I.key===null&&(I=I.props.children),typeof I=="object"&&I!==null){switch(I.$$typeof){case pd:e:{for(var M=I.key,j=y;j!==null;){if(j.key===M){if(M=I.type,M===oo){if(j.tag===7){n(w,j.sibling),y=i(j,I.props.children),y.return=w,w=y;break e}}else if(j.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===Fi&&ww(M)===j.type){n(w,j.sibling),y=i(j,I.props),y.ref=Bl(w,j,I),y.return=w,w=y;break e}n(w,j);break}else e(w,j);j=j.sibling}I.type===oo?(y=ca(I.props.children,w.mode,R,I.key),y.return=w,w=y):(R=dh(I.type,I.key,I.props,null,w.mode,R),R.ref=Bl(w,y,I),R.return=w,w=R)}return a(w);case ao:e:{for(j=I.key;y!==null;){if(y.key===j)if(y.tag===4&&y.stateNode.containerInfo===I.containerInfo&&y.stateNode.implementation===I.implementation){n(w,y.sibling),y=i(y,I.children||[]),y.return=w,w=y;break e}else{n(w,y);break}else e(w,y);y=y.sibling}y=Yp(I,w.mode,R),y.return=w,w=y}return a(w);case Fi:return j=I._init,$(w,y,j(I._payload),R)}if(su(I))return _(w,y,I,R);if(Ll(I))return x(w,y,I,R);Id(w,I)}return typeof I=="string"&&I!==""||typeof I=="number"?(I=""+I,y!==null&&y.tag===6?(n(w,y.sibling),y=i(y,I),y.return=w,w=y):(n(w,y),y=Qp(I,w.mode,R),y.return=w,w=y),a(w)):n(w,y)}return $}var Lo=zI(!0),VI=zI(!1),Lh=Es(null),zh=null,go=null,m_=null;function g_(){m_=go=zh=null}function y_(t){var e=Lh.current;ut(Lh),t._currentValue=e}function jg(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function $o(t,e){zh=t,m_=go=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(En=!0),t.firstContext=null)}function Qn(t){var e=t._currentValue;if(m_!==t)if(t={context:t,memoizedValue:e,next:null},go===null){if(zh===null)throw Error(le(308));go=t,zh.dependencies={lanes:0,firstContext:t}}else go=go.next=t;return e}var aa=null;function __(t){aa===null?aa=[t]:aa.push(t)}function jI(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,__(e)):(n.next=i.next,i.next=n),e.interleaved=n,xi(t,r)}function xi(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Wi=!1;function v_(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function UI(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function yi(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function is(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,We&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,xi(t,n)}return i=r.interleaved,i===null?(e.next=e,__(r)):(e.next=i.next,i.next=e),r.interleaved=e,xi(t,n)}function sh(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,i_(t,n)}}function bw(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=a:s=s.next=a,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Vh(t,e,n,r){var i=t.updateQueue;Wi=!1;var s=i.firstBaseUpdate,a=i.lastBaseUpdate,o=i.shared.pending;if(o!==null){i.shared.pending=null;var l=o,u=l.next;l.next=null,a===null?s=u:a.next=u,a=l;var h=t.alternate;h!==null&&(h=h.updateQueue,o=h.lastBaseUpdate,o!==a&&(o===null?h.firstBaseUpdate=u:o.next=u,h.lastBaseUpdate=l))}if(s!==null){var f=i.baseState;a=0,h=u=l=null,o=s;do{var p=o.lane,g=o.eventTime;if((r&p)===p){h!==null&&(h=h.next={eventTime:g,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var _=t,x=o;switch(p=e,g=n,x.tag){case 1:if(_=x.payload,typeof _=="function"){f=_.call(g,f,p);break e}f=_;break e;case 3:_.flags=_.flags&-65537|128;case 0:if(_=x.payload,p=typeof _=="function"?_.call(g,f,p):_,p==null)break e;f=mt({},f,p);break e;case 2:Wi=!0}}o.callback!==null&&o.lane!==0&&(t.flags|=64,p=i.effects,p===null?i.effects=[o]:p.push(o))}else g={eventTime:g,lane:p,tag:o.tag,payload:o.payload,callback:o.callback,next:null},h===null?(u=h=g,l=f):h=h.next=g,a|=p;if(o=o.next,o===null){if(o=i.shared.pending,o===null)break;p=o,o=p.next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}while(!0);if(h===null&&(l=f),i.baseState=l,i.firstBaseUpdate=u,i.lastBaseUpdate=h,e=i.shared.interleaved,e!==null){i=e;do a|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);ya|=a,t.lanes=a,t.memoizedState=f}}function xw(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(le(191,i));i.call(r)}}}var vc={},Fr=Es(vc),Yu=Es(vc),Ju=Es(vc);function oa(t){if(t===vc)throw Error(le(174));return t}function w_(t,e){switch(at(Ju,e),at(Yu,t),at(Fr,vc),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:wg(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=wg(e,t)}ut(Fr),at(Fr,e)}function zo(){ut(Fr),ut(Yu),ut(Ju)}function BI(t){oa(Ju.current);var e=oa(Fr.current),n=wg(e,t.type);e!==n&&(at(Yu,t),at(Fr,n))}function b_(t){Yu.current===t&&(ut(Fr),ut(Yu))}var ft=Es(0);function jh(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Fp=[];function x_(){for(var t=0;t<Fp.length;t++)Fp[t]._workInProgressVersionPrimary=null;Fp.length=0}var ah=Ci.ReactCurrentDispatcher,Wp=Ci.ReactCurrentBatchConfig,ga=0,pt=null,Nt=null,Bt=null,Uh=!1,Iu=!1,Xu=0,f4=0;function Xt(){throw Error(le(321))}function E_(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Tr(t[n],e[n]))return!1;return!0}function T_(t,e,n,r,i,s){if(ga=s,pt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ah.current=t===null||t.memoizedState===null?y4:_4,t=n(r,i),Iu){s=0;do{if(Iu=!1,Xu=0,25<=s)throw Error(le(301));s+=1,Bt=Nt=null,e.updateQueue=null,ah.current=v4,t=n(r,i)}while(Iu)}if(ah.current=Bh,e=Nt!==null&&Nt.next!==null,ga=0,Bt=Nt=pt=null,Uh=!1,e)throw Error(le(300));return t}function I_(){var t=Xu!==0;return Xu=0,t}function Vr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Bt===null?pt.memoizedState=Bt=t:Bt=Bt.next=t,Bt}function Yn(){if(Nt===null){var t=pt.alternate;t=t!==null?t.memoizedState:null}else t=Nt.next;var e=Bt===null?pt.memoizedState:Bt.next;if(e!==null)Bt=e,Nt=t;else{if(t===null)throw Error(le(310));Nt=t,t={memoizedState:Nt.memoizedState,baseState:Nt.baseState,baseQueue:Nt.baseQueue,queue:Nt.queue,next:null},Bt===null?pt.memoizedState=Bt=t:Bt=Bt.next=t}return Bt}function Zu(t,e){return typeof e=="function"?e(t):e}function qp(t){var e=Yn(),n=e.queue;if(n===null)throw Error(le(311));n.lastRenderedReducer=t;var r=Nt,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var a=i.next;i.next=s.next,s.next=a}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var o=a=null,l=null,u=s;do{var h=u.lane;if((ga&h)===h)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var f={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(o=l=f,a=r):l=l.next=f,pt.lanes|=h,ya|=h}u=u.next}while(u!==null&&u!==s);l===null?a=r:l.next=o,Tr(r,e.memoizedState)||(En=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,pt.lanes|=s,ya|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Hp(t){var e=Yn(),n=e.queue;if(n===null)throw Error(le(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var a=i=i.next;do s=t(s,a.action),a=a.next;while(a!==i);Tr(s,e.memoizedState)||(En=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function FI(){}function WI(t,e){var n=pt,r=Yn(),i=e(),s=!Tr(r.memoizedState,i);if(s&&(r.memoizedState=i,En=!0),r=r.queue,$_(GI.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||Bt!==null&&Bt.memoizedState.tag&1){if(n.flags|=2048,ec(9,HI.bind(null,n,r,i,e),void 0,null),Ft===null)throw Error(le(349));ga&30||qI(n,e,i)}return i}function qI(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=pt.updateQueue,e===null?(e={lastEffect:null,stores:null},pt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function HI(t,e,n,r){e.value=n,e.getSnapshot=r,KI(e)&&QI(t)}function GI(t,e,n){return n(function(){KI(e)&&QI(t)})}function KI(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Tr(t,n)}catch{return!0}}function QI(t){var e=xi(t,1);e!==null&&wr(e,t,1,-1)}function Ew(t){var e=Vr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Zu,lastRenderedState:t},e.queue=t,t=t.dispatch=g4.bind(null,pt,t),[e.memoizedState,t]}function ec(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=pt.updateQueue,e===null?(e={lastEffect:null,stores:null},pt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function YI(){return Yn().memoizedState}function oh(t,e,n,r){var i=Vr();pt.flags|=t,i.memoizedState=ec(1|e,n,void 0,r===void 0?null:r)}function Rf(t,e,n,r){var i=Yn();r=r===void 0?null:r;var s=void 0;if(Nt!==null){var a=Nt.memoizedState;if(s=a.destroy,r!==null&&E_(r,a.deps)){i.memoizedState=ec(e,n,s,r);return}}pt.flags|=t,i.memoizedState=ec(1|e,n,s,r)}function Tw(t,e){return oh(8390656,8,t,e)}function $_(t,e){return Rf(2048,8,t,e)}function JI(t,e){return Rf(4,2,t,e)}function XI(t,e){return Rf(4,4,t,e)}function ZI(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function e$(t,e,n){return n=n!=null?n.concat([t]):null,Rf(4,4,ZI.bind(null,e,t),n)}function k_(){}function t$(t,e){var n=Yn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&E_(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function n$(t,e){var n=Yn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&E_(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function r$(t,e,n){return ga&21?(Tr(n,e)||(n=lI(),pt.lanes|=n,ya|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,En=!0),t.memoizedState=n)}function p4(t,e){var n=Je;Je=n!==0&&4>n?n:4,t(!0);var r=Wp.transition;Wp.transition={};try{t(!1),e()}finally{Je=n,Wp.transition=r}}function i$(){return Yn().memoizedState}function m4(t,e,n){var r=as(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},s$(t))a$(e,n);else if(n=jI(t,e,n,r),n!==null){var i=hn();wr(n,t,r,i),o$(n,e,r)}}function g4(t,e,n){var r=as(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(s$(t))a$(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var a=e.lastRenderedState,o=s(a,n);if(i.hasEagerState=!0,i.eagerState=o,Tr(o,a)){var l=e.interleaved;l===null?(i.next=i,__(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}n=jI(t,e,i,r),n!==null&&(i=hn(),wr(n,t,r,i),o$(n,e,r))}}function s$(t){var e=t.alternate;return t===pt||e!==null&&e===pt}function a$(t,e){Iu=Uh=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function o$(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,i_(t,n)}}var Bh={readContext:Qn,useCallback:Xt,useContext:Xt,useEffect:Xt,useImperativeHandle:Xt,useInsertionEffect:Xt,useLayoutEffect:Xt,useMemo:Xt,useReducer:Xt,useRef:Xt,useState:Xt,useDebugValue:Xt,useDeferredValue:Xt,useTransition:Xt,useMutableSource:Xt,useSyncExternalStore:Xt,useId:Xt,unstable_isNewReconciler:!1},y4={readContext:Qn,useCallback:function(t,e){return Vr().memoizedState=[t,e===void 0?null:e],t},useContext:Qn,useEffect:Tw,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,oh(4194308,4,ZI.bind(null,e,t),n)},useLayoutEffect:function(t,e){return oh(4194308,4,t,e)},useInsertionEffect:function(t,e){return oh(4,2,t,e)},useMemo:function(t,e){var n=Vr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Vr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=m4.bind(null,pt,t),[r.memoizedState,t]},useRef:function(t){var e=Vr();return t={current:t},e.memoizedState=t},useState:Ew,useDebugValue:k_,useDeferredValue:function(t){return Vr().memoizedState=t},useTransition:function(){var t=Ew(!1),e=t[0];return t=p4.bind(null,t[1]),Vr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=pt,i=Vr();if(dt){if(n===void 0)throw Error(le(407));n=n()}else{if(n=e(),Ft===null)throw Error(le(349));ga&30||qI(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,Tw(GI.bind(null,r,s,t),[t]),r.flags|=2048,ec(9,HI.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=Vr(),e=Ft.identifierPrefix;if(dt){var n=pi,r=fi;n=(r&~(1<<32-vr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Xu++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=f4++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},_4={readContext:Qn,useCallback:t$,useContext:Qn,useEffect:$_,useImperativeHandle:e$,useInsertionEffect:JI,useLayoutEffect:XI,useMemo:n$,useReducer:qp,useRef:YI,useState:function(){return qp(Zu)},useDebugValue:k_,useDeferredValue:function(t){var e=Yn();return r$(e,Nt.memoizedState,t)},useTransition:function(){var t=qp(Zu)[0],e=Yn().memoizedState;return[t,e]},useMutableSource:FI,useSyncExternalStore:WI,useId:i$,unstable_isNewReconciler:!1},v4={readContext:Qn,useCallback:t$,useContext:Qn,useEffect:$_,useImperativeHandle:e$,useInsertionEffect:JI,useLayoutEffect:XI,useMemo:n$,useReducer:Hp,useRef:YI,useState:function(){return Hp(Zu)},useDebugValue:k_,useDeferredValue:function(t){var e=Yn();return Nt===null?e.memoizedState=t:r$(e,Nt.memoizedState,t)},useTransition:function(){var t=Hp(Zu)[0],e=Yn().memoizedState;return[t,e]},useMutableSource:FI,useSyncExternalStore:WI,useId:i$,unstable_isNewReconciler:!1};function hr(t,e){if(t&&t.defaultProps){e=mt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Ug(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:mt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Nf={isMounted:function(t){return(t=t._reactInternals)?Aa(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=hn(),i=as(t),s=yi(r,i);s.payload=e,n!=null&&(s.callback=n),e=is(t,s,i),e!==null&&(wr(e,t,i,r),sh(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=hn(),i=as(t),s=yi(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=is(t,s,i),e!==null&&(wr(e,t,i,r),sh(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=hn(),r=as(t),i=yi(n,r);i.tag=2,e!=null&&(i.callback=e),e=is(t,i,r),e!==null&&(wr(e,t,r,n),sh(e,t,r))}};function Iw(t,e,n,r,i,s,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,a):e.prototype&&e.prototype.isPureReactComponent?!Hu(n,r)||!Hu(i,s):!0}function l$(t,e,n){var r=!1,i=fs,s=e.contextType;return typeof s=="object"&&s!==null?s=Qn(s):(i=In(e)?pa:an.current,r=e.contextTypes,s=(r=r!=null)?Do(t,i):fs),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Nf,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function $w(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Nf.enqueueReplaceState(e,e.state,null)}function Bg(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},v_(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Qn(s):(s=In(e)?pa:an.current,i.context=Do(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Ug(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Nf.enqueueReplaceState(i,i.state,null),Vh(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function Vo(t,e){try{var n="",r=e;do n+=GN(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function Gp(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Fg(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var w4=typeof WeakMap=="function"?WeakMap:Map;function u$(t,e,n){n=yi(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Wh||(Wh=!0,Zg=r),Fg(t,e)},n}function c$(t,e,n){n=yi(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){Fg(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){Fg(t,e),typeof r!="function"&&(ss===null?ss=new Set([this]):ss.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}function kw(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new w4;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=O4.bind(null,t,e,n),e.then(t,t))}function Sw(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Cw(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=yi(-1,1),e.tag=2,is(n,e,1))),n.lanes|=1),t)}var b4=Ci.ReactCurrentOwner,En=!1;function dn(t,e,n,r){e.child=t===null?VI(e,null,n,r):Lo(e,t.child,n,r)}function Aw(t,e,n,r,i){n=n.render;var s=e.ref;return $o(e,i),r=T_(t,e,n,r,s,i),n=I_(),t!==null&&!En?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Ei(t,e,i)):(dt&&n&&h_(e),e.flags|=1,dn(t,e,r,i),e.child)}function Rw(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!D_(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,d$(t,e,s,r,i)):(t=dh(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var a=s.memoizedProps;if(n=n.compare,n=n!==null?n:Hu,n(a,r)&&t.ref===e.ref)return Ei(t,e,i)}return e.flags|=1,t=os(s,r),t.ref=e.ref,t.return=e,e.child=t}function d$(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(Hu(s,r)&&t.ref===e.ref)if(En=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(En=!0);else return e.lanes=t.lanes,Ei(t,e,i)}return Wg(t,e,n,r,i)}function h$(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},at(_o,Rn),Rn|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,at(_o,Rn),Rn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,at(_o,Rn),Rn|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,at(_o,Rn),Rn|=r;return dn(t,e,i,n),e.child}function f$(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Wg(t,e,n,r,i){var s=In(n)?pa:an.current;return s=Do(e,s),$o(e,i),n=T_(t,e,n,r,s,i),r=I_(),t!==null&&!En?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Ei(t,e,i)):(dt&&r&&h_(e),e.flags|=1,dn(t,e,n,i),e.child)}function Nw(t,e,n,r,i){if(In(n)){var s=!0;Oh(e)}else s=!1;if($o(e,i),e.stateNode===null)lh(t,e),l$(e,n,r),Bg(e,n,r,i),r=!0;else if(t===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,u=n.contextType;typeof u=="object"&&u!==null?u=Qn(u):(u=In(n)?pa:an.current,u=Do(e,u));var h=n.getDerivedStateFromProps,f=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function";f||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==r||l!==u)&&$w(e,a,r,u),Wi=!1;var p=e.memoizedState;a.state=p,Vh(e,r,a,i),l=e.memoizedState,o!==r||p!==l||Tn.current||Wi?(typeof h=="function"&&(Ug(e,n,h,r),l=e.memoizedState),(o=Wi||Iw(e,n,o,r,p,l,u))?(f||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),a.props=r,a.state=l,a.context=u,r=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,UI(t,e),o=e.memoizedProps,u=e.type===e.elementType?o:hr(e.type,o),a.props=u,f=e.pendingProps,p=a.context,l=n.contextType,typeof l=="object"&&l!==null?l=Qn(l):(l=In(n)?pa:an.current,l=Do(e,l));var g=n.getDerivedStateFromProps;(h=typeof g=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==f||p!==l)&&$w(e,a,r,l),Wi=!1,p=e.memoizedState,a.state=p,Vh(e,r,a,i);var _=e.memoizedState;o!==f||p!==_||Tn.current||Wi?(typeof g=="function"&&(Ug(e,n,g,r),_=e.memoizedState),(u=Wi||Iw(e,n,u,r,p,_,l)||!1)?(h||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,_,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,_,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=_),a.props=r,a.state=_,a.context=l,r=u):(typeof a.componentDidUpdate!="function"||o===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),r=!1)}return qg(t,e,n,r,s,i)}function qg(t,e,n,r,i,s){f$(t,e);var a=(e.flags&128)!==0;if(!r&&!a)return i&&yw(e,n,!1),Ei(t,e,s);r=e.stateNode,b4.current=e;var o=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&a?(e.child=Lo(e,t.child,null,s),e.child=Lo(e,null,o,s)):dn(t,e,o,s),e.memoizedState=r.state,i&&yw(e,n,!0),e.child}function p$(t){var e=t.stateNode;e.pendingContext?gw(t,e.pendingContext,e.pendingContext!==e.context):e.context&&gw(t,e.context,!1),w_(t,e.containerInfo)}function Pw(t,e,n,r,i){return Mo(),p_(i),e.flags|=256,dn(t,e,n,r),e.child}var Hg={dehydrated:null,treeContext:null,retryLane:0};function Gg(t){return{baseLanes:t,cachePool:null,transitions:null}}function m$(t,e,n){var r=e.pendingProps,i=ft.current,s=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=t!==null&&t.memoizedState===null?!1:(i&2)!==0),o?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),at(ft,i&1),t===null)return Vg(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,t=r.fallback,s?(r=e.mode,s=e.child,a={mode:"hidden",children:a},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=Df(a,r,0,null),t=ca(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Gg(n),e.memoizedState=Hg,t):S_(e,a));if(i=t.memoizedState,i!==null&&(o=i.dehydrated,o!==null))return x4(t,e,a,r,o,i,n);if(s){s=r.fallback,a=e.mode,i=t.child,o=i.sibling;var l={mode:"hidden",children:r.children};return!(a&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=os(i,l),r.subtreeFlags=i.subtreeFlags&14680064),o!==null?s=os(o,s):(s=ca(s,a,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,a=t.child.memoizedState,a=a===null?Gg(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=t.childLanes&~n,e.memoizedState=Hg,r}return s=t.child,t=s.sibling,r=os(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function S_(t,e){return e=Df({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function $d(t,e,n,r){return r!==null&&p_(r),Lo(e,t.child,null,n),t=S_(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function x4(t,e,n,r,i,s,a){if(n)return e.flags&256?(e.flags&=-257,r=Gp(Error(le(422))),$d(t,e,a,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=Df({mode:"visible",children:r.children},i,0,null),s=ca(s,i,a,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&Lo(e,t.child,null,a),e.child.memoizedState=Gg(a),e.memoizedState=Hg,s);if(!(e.mode&1))return $d(t,e,a,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var o=r.dgst;return r=o,s=Error(le(419)),r=Gp(s,r,void 0),$d(t,e,a,r)}if(o=(a&t.childLanes)!==0,En||o){if(r=Ft,r!==null){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|a)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,xi(t,i),wr(r,t,i,-1))}return O_(),r=Gp(Error(le(421))),$d(t,e,a,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=D4.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,On=rs(i.nextSibling),Mn=e,dt=!0,pr=null,t!==null&&(Wn[qn++]=fi,Wn[qn++]=pi,Wn[qn++]=ma,fi=t.id,pi=t.overflow,ma=e),e=S_(e,r.children),e.flags|=4096,e)}function Ow(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),jg(t.return,e,n)}function Kp(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function g$(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(dn(t,e,r.children,n),r=ft.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Ow(t,n,e);else if(t.tag===19)Ow(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(at(ft,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&jh(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),Kp(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&jh(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}Kp(e,!0,n,null,s);break;case"together":Kp(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function lh(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Ei(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),ya|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(le(153));if(e.child!==null){for(t=e.child,n=os(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=os(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function E4(t,e,n){switch(e.tag){case 3:p$(e),Mo();break;case 5:BI(e);break;case 1:In(e.type)&&Oh(e);break;case 4:w_(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;at(Lh,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(at(ft,ft.current&1),e.flags|=128,null):n&e.child.childLanes?m$(t,e,n):(at(ft,ft.current&1),t=Ei(t,e,n),t!==null?t.sibling:null);at(ft,ft.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return g$(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),at(ft,ft.current),r)break;return null;case 22:case 23:return e.lanes=0,h$(t,e,n)}return Ei(t,e,n)}var y$,Kg,_$,v$;y$=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Kg=function(){};_$=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,oa(Fr.current);var s=null;switch(n){case"input":i=gg(t,i),r=gg(t,r),s=[];break;case"select":i=mt({},i,{value:void 0}),r=mt({},r,{value:void 0}),s=[];break;case"textarea":i=vg(t,i),r=vg(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Nh)}bg(n,r);var a;n=null;for(u in i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var o=i[u];for(a in o)o.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Vu.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var l=r[u];if(o=i!=null?i[u]:void 0,r.hasOwnProperty(u)&&l!==o&&(l!=null||o!=null))if(u==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(n||(n={}),n[a]=l[a])}else n||(s||(s=[]),s.push(u,n)),n=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(s=s||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Vu.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&ot("scroll",t),s||o===l||(s=[])):(s=s||[]).push(u,l))}n&&(s=s||[]).push("style",n);var u=s;(e.updateQueue=u)&&(e.flags|=4)}};v$=function(t,e,n,r){n!==r&&(e.flags|=4)};function Fl(t,e){if(!dt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Zt(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function T4(t,e,n){var r=e.pendingProps;switch(f_(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Zt(e),null;case 1:return In(e.type)&&Ph(),Zt(e),null;case 3:return r=e.stateNode,zo(),ut(Tn),ut(an),x_(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Td(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,pr!==null&&(ny(pr),pr=null))),Kg(t,e),Zt(e),null;case 5:b_(e);var i=oa(Ju.current);if(n=e.type,t!==null&&e.stateNode!=null)_$(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(le(166));return Zt(e),null}if(t=oa(Fr.current),Td(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[Ur]=e,r[Qu]=s,t=(e.mode&1)!==0,n){case"dialog":ot("cancel",r),ot("close",r);break;case"iframe":case"object":case"embed":ot("load",r);break;case"video":case"audio":for(i=0;i<ou.length;i++)ot(ou[i],r);break;case"source":ot("error",r);break;case"img":case"image":case"link":ot("error",r),ot("load",r);break;case"details":ot("toggle",r);break;case"input":F0(r,s),ot("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},ot("invalid",r);break;case"textarea":q0(r,s),ot("invalid",r)}bg(n,s),i=null;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];a==="children"?typeof o=="string"?r.textContent!==o&&(s.suppressHydrationWarning!==!0&&Ed(r.textContent,o,t),i=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(s.suppressHydrationWarning!==!0&&Ed(r.textContent,o,t),i=["children",""+o]):Vu.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&ot("scroll",r)}switch(n){case"input":md(r),W0(r,s,!0);break;case"textarea":md(r),H0(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=Nh)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=GT(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=a.createElement(n,{is:r.is}):(t=a.createElement(n),n==="select"&&(a=t,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):t=a.createElementNS(t,n),t[Ur]=e,t[Qu]=r,y$(t,e,!1,!1),e.stateNode=t;e:{switch(a=xg(n,r),n){case"dialog":ot("cancel",t),ot("close",t),i=r;break;case"iframe":case"object":case"embed":ot("load",t),i=r;break;case"video":case"audio":for(i=0;i<ou.length;i++)ot(ou[i],t);i=r;break;case"source":ot("error",t),i=r;break;case"img":case"image":case"link":ot("error",t),ot("load",t),i=r;break;case"details":ot("toggle",t),i=r;break;case"input":F0(t,r),i=gg(t,r),ot("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=mt({},r,{value:void 0}),ot("invalid",t);break;case"textarea":q0(t,r),i=vg(t,r),ot("invalid",t);break;default:i=r}bg(n,i),o=i;for(s in o)if(o.hasOwnProperty(s)){var l=o[s];s==="style"?YT(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&KT(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&ju(t,l):typeof l=="number"&&ju(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Vu.hasOwnProperty(s)?l!=null&&s==="onScroll"&&ot("scroll",t):l!=null&&Xy(t,s,l,a))}switch(n){case"input":md(t),W0(t,r,!1);break;case"textarea":md(t),H0(t);break;case"option":r.value!=null&&t.setAttribute("value",""+hs(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?xo(t,!!r.multiple,s,!1):r.defaultValue!=null&&xo(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Nh)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Zt(e),null;case 6:if(t&&e.stateNode!=null)v$(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(le(166));if(n=oa(Ju.current),oa(Fr.current),Td(e)){if(r=e.stateNode,n=e.memoizedProps,r[Ur]=e,(s=r.nodeValue!==n)&&(t=Mn,t!==null))switch(t.tag){case 3:Ed(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Ed(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Ur]=e,e.stateNode=r}return Zt(e),null;case 13:if(ut(ft),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(dt&&On!==null&&e.mode&1&&!(e.flags&128))LI(),Mo(),e.flags|=98560,s=!1;else if(s=Td(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(le(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(le(317));s[Ur]=e}else Mo(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Zt(e),s=!1}else pr!==null&&(ny(pr),pr=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||ft.current&1?Pt===0&&(Pt=3):O_())),e.updateQueue!==null&&(e.flags|=4),Zt(e),null);case 4:return zo(),Kg(t,e),t===null&&Gu(e.stateNode.containerInfo),Zt(e),null;case 10:return y_(e.type._context),Zt(e),null;case 17:return In(e.type)&&Ph(),Zt(e),null;case 19:if(ut(ft),s=e.memoizedState,s===null)return Zt(e),null;if(r=(e.flags&128)!==0,a=s.rendering,a===null)if(r)Fl(s,!1);else{if(Pt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=jh(t),a!==null){for(e.flags|=128,Fl(s,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,t=a.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return at(ft,ft.current&1|2),e.child}t=t.sibling}s.tail!==null&&xt()>jo&&(e.flags|=128,r=!0,Fl(s,!1),e.lanes=4194304)}else{if(!r)if(t=jh(a),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Fl(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!dt)return Zt(e),null}else 2*xt()-s.renderingStartTime>jo&&n!==1073741824&&(e.flags|=128,r=!0,Fl(s,!1),e.lanes=4194304);s.isBackwards?(a.sibling=e.child,e.child=a):(n=s.last,n!==null?n.sibling=a:e.child=a,s.last=a)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=xt(),e.sibling=null,n=ft.current,at(ft,r?n&1|2:n&1),e):(Zt(e),null);case 22:case 23:return P_(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Rn&1073741824&&(Zt(e),e.subtreeFlags&6&&(e.flags|=8192)):Zt(e),null;case 24:return null;case 25:return null}throw Error(le(156,e.tag))}function I4(t,e){switch(f_(e),e.tag){case 1:return In(e.type)&&Ph(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return zo(),ut(Tn),ut(an),x_(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return b_(e),null;case 13:if(ut(ft),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(le(340));Mo()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ut(ft),null;case 4:return zo(),null;case 10:return y_(e.type._context),null;case 22:case 23:return P_(),null;case 24:return null;default:return null}}var kd=!1,rn=!1,$4=typeof WeakSet=="function"?WeakSet:Set,_e=null;function yo(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){_t(t,e,r)}else n.current=null}function Qg(t,e,n){try{n()}catch(r){_t(t,e,r)}}var Dw=!1;function k4(t,e){if(Ng=Ch,t=TI(),d_(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var a=0,o=-1,l=-1,u=0,h=0,f=t,p=null;t:for(;;){for(var g;f!==n||i!==0&&f.nodeType!==3||(o=a+i),f!==s||r!==0&&f.nodeType!==3||(l=a+r),f.nodeType===3&&(a+=f.nodeValue.length),(g=f.firstChild)!==null;)p=f,f=g;for(;;){if(f===t)break t;if(p===n&&++u===i&&(o=a),p===s&&++h===r&&(l=a),(g=f.nextSibling)!==null)break;f=p,p=f.parentNode}f=g}n=o===-1||l===-1?null:{start:o,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Pg={focusedElem:t,selectionRange:n},Ch=!1,_e=e;_e!==null;)if(e=_e,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,_e=t;else for(;_e!==null;){e=_e;try{var _=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(_!==null){var x=_.memoizedProps,$=_.memoizedState,w=e.stateNode,y=w.getSnapshotBeforeUpdate(e.elementType===e.type?x:hr(e.type,x),$);w.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var I=e.stateNode.containerInfo;I.nodeType===1?I.textContent="":I.nodeType===9&&I.documentElement&&I.removeChild(I.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(le(163))}}catch(R){_t(e,e.return,R)}if(t=e.sibling,t!==null){t.return=e.return,_e=t;break}_e=e.return}return _=Dw,Dw=!1,_}function $u(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&Qg(e,n,s)}i=i.next}while(i!==r)}}function Pf(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Yg(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function w$(t){var e=t.alternate;e!==null&&(t.alternate=null,w$(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Ur],delete e[Qu],delete e[Mg],delete e[u4],delete e[c4])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function b$(t){return t.tag===5||t.tag===3||t.tag===4}function Mw(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||b$(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Jg(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Nh));else if(r!==4&&(t=t.child,t!==null))for(Jg(t,e,n),t=t.sibling;t!==null;)Jg(t,e,n),t=t.sibling}function Xg(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Xg(t,e,n),t=t.sibling;t!==null;)Xg(t,e,n),t=t.sibling}var Wt=null,fr=!1;function zi(t,e,n){for(n=n.child;n!==null;)x$(t,e,n),n=n.sibling}function x$(t,e,n){if(Br&&typeof Br.onCommitFiberUnmount=="function")try{Br.onCommitFiberUnmount(If,n)}catch{}switch(n.tag){case 5:rn||yo(n,e);case 6:var r=Wt,i=fr;Wt=null,zi(t,e,n),Wt=r,fr=i,Wt!==null&&(fr?(t=Wt,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Wt.removeChild(n.stateNode));break;case 18:Wt!==null&&(fr?(t=Wt,n=n.stateNode,t.nodeType===8?Up(t.parentNode,n):t.nodeType===1&&Up(t,n),Wu(t)):Up(Wt,n.stateNode));break;case 4:r=Wt,i=fr,Wt=n.stateNode.containerInfo,fr=!0,zi(t,e,n),Wt=r,fr=i;break;case 0:case 11:case 14:case 15:if(!rn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&Qg(n,e,a),i=i.next}while(i!==r)}zi(t,e,n);break;case 1:if(!rn&&(yo(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(o){_t(n,e,o)}zi(t,e,n);break;case 21:zi(t,e,n);break;case 22:n.mode&1?(rn=(r=rn)||n.memoizedState!==null,zi(t,e,n),rn=r):zi(t,e,n);break;default:zi(t,e,n)}}function Lw(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new $4),e.forEach(function(r){var i=M4.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function sr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:Wt=o.stateNode,fr=!1;break e;case 3:Wt=o.stateNode.containerInfo,fr=!0;break e;case 4:Wt=o.stateNode.containerInfo,fr=!0;break e}o=o.return}if(Wt===null)throw Error(le(160));x$(s,a,i),Wt=null,fr=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(u){_t(i,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)E$(e,t),e=e.sibling}function E$(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(sr(e,t),Mr(t),r&4){try{$u(3,t,t.return),Pf(3,t)}catch(x){_t(t,t.return,x)}try{$u(5,t,t.return)}catch(x){_t(t,t.return,x)}}break;case 1:sr(e,t),Mr(t),r&512&&n!==null&&yo(n,n.return);break;case 5:if(sr(e,t),Mr(t),r&512&&n!==null&&yo(n,n.return),t.flags&32){var i=t.stateNode;try{ju(i,"")}catch(x){_t(t,t.return,x)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,a=n!==null?n.memoizedProps:s,o=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{o==="input"&&s.type==="radio"&&s.name!=null&&qT(i,s),xg(o,a);var u=xg(o,s);for(a=0;a<l.length;a+=2){var h=l[a],f=l[a+1];h==="style"?YT(i,f):h==="dangerouslySetInnerHTML"?KT(i,f):h==="children"?ju(i,f):Xy(i,h,f,u)}switch(o){case"input":yg(i,s);break;case"textarea":HT(i,s);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var g=s.value;g!=null?xo(i,!!s.multiple,g,!1):p!==!!s.multiple&&(s.defaultValue!=null?xo(i,!!s.multiple,s.defaultValue,!0):xo(i,!!s.multiple,s.multiple?[]:"",!1))}i[Qu]=s}catch(x){_t(t,t.return,x)}}break;case 6:if(sr(e,t),Mr(t),r&4){if(t.stateNode===null)throw Error(le(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(x){_t(t,t.return,x)}}break;case 3:if(sr(e,t),Mr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Wu(e.containerInfo)}catch(x){_t(t,t.return,x)}break;case 4:sr(e,t),Mr(t);break;case 13:sr(e,t),Mr(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(R_=xt())),r&4&&Lw(t);break;case 22:if(h=n!==null&&n.memoizedState!==null,t.mode&1?(rn=(u=rn)||h,sr(e,t),rn=u):sr(e,t),Mr(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!h&&t.mode&1)for(_e=t,h=t.child;h!==null;){for(f=_e=h;_e!==null;){switch(p=_e,g=p.child,p.tag){case 0:case 11:case 14:case 15:$u(4,p,p.return);break;case 1:yo(p,p.return);var _=p.stateNode;if(typeof _.componentWillUnmount=="function"){r=p,n=p.return;try{e=r,_.props=e.memoizedProps,_.state=e.memoizedState,_.componentWillUnmount()}catch(x){_t(r,n,x)}}break;case 5:yo(p,p.return);break;case 22:if(p.memoizedState!==null){Vw(f);continue}}g!==null?(g.return=p,_e=g):Vw(f)}h=h.sibling}e:for(h=null,f=t;;){if(f.tag===5){if(h===null){h=f;try{i=f.stateNode,u?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(o=f.stateNode,l=f.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=QT("display",a))}catch(x){_t(t,t.return,x)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(x){_t(t,t.return,x)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:sr(e,t),Mr(t),r&4&&Lw(t);break;case 21:break;default:sr(e,t),Mr(t)}}function Mr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(b$(n)){var r=n;break e}n=n.return}throw Error(le(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(ju(i,""),r.flags&=-33);var s=Mw(t);Xg(t,s,i);break;case 3:case 4:var a=r.stateNode.containerInfo,o=Mw(t);Jg(t,o,a);break;default:throw Error(le(161))}}catch(l){_t(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function S4(t,e,n){_e=t,T$(t)}function T$(t,e,n){for(var r=(t.mode&1)!==0;_e!==null;){var i=_e,s=i.child;if(i.tag===22&&r){var a=i.memoizedState!==null||kd;if(!a){var o=i.alternate,l=o!==null&&o.memoizedState!==null||rn;o=kd;var u=rn;if(kd=a,(rn=l)&&!u)for(_e=i;_e!==null;)a=_e,l=a.child,a.tag===22&&a.memoizedState!==null?jw(i):l!==null?(l.return=a,_e=l):jw(i);for(;s!==null;)_e=s,T$(s),s=s.sibling;_e=i,kd=o,rn=u}zw(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,_e=s):zw(t)}}function zw(t){for(;_e!==null;){var e=_e;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:rn||Pf(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!rn)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:hr(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&xw(e,s,r);break;case 3:var a=e.updateQueue;if(a!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}xw(e,a,n)}break;case 5:var o=e.stateNode;if(n===null&&e.flags&4){n=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&Wu(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(le(163))}rn||e.flags&512&&Yg(e)}catch(p){_t(e,e.return,p)}}if(e===t){_e=null;break}if(n=e.sibling,n!==null){n.return=e.return,_e=n;break}_e=e.return}}function Vw(t){for(;_e!==null;){var e=_e;if(e===t){_e=null;break}var n=e.sibling;if(n!==null){n.return=e.return,_e=n;break}_e=e.return}}function jw(t){for(;_e!==null;){var e=_e;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Pf(4,e)}catch(l){_t(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){_t(e,i,l)}}var s=e.return;try{Yg(e)}catch(l){_t(e,s,l)}break;case 5:var a=e.return;try{Yg(e)}catch(l){_t(e,a,l)}}}catch(l){_t(e,e.return,l)}if(e===t){_e=null;break}var o=e.sibling;if(o!==null){o.return=e.return,_e=o;break}_e=e.return}}var C4=Math.ceil,Fh=Ci.ReactCurrentDispatcher,C_=Ci.ReactCurrentOwner,Kn=Ci.ReactCurrentBatchConfig,We=0,Ft=null,kt=null,Gt=0,Rn=0,_o=Es(0),Pt=0,tc=null,ya=0,Of=0,A_=0,ku=null,bn=null,R_=0,jo=1/0,ci=null,Wh=!1,Zg=null,ss=null,Sd=!1,Xi=null,qh=0,Su=0,ey=null,uh=-1,ch=0;function hn(){return We&6?xt():uh!==-1?uh:uh=xt()}function as(t){return t.mode&1?We&2&&Gt!==0?Gt&-Gt:h4.transition!==null?(ch===0&&(ch=lI()),ch):(t=Je,t!==0||(t=window.event,t=t===void 0?16:mI(t.type)),t):1}function wr(t,e,n,r){if(50<Su)throw Su=0,ey=null,Error(le(185));gc(t,n,r),(!(We&2)||t!==Ft)&&(t===Ft&&(!(We&2)&&(Of|=n),Pt===4&&Hi(t,Gt)),$n(t,r),n===1&&We===0&&!(e.mode&1)&&(jo=xt()+500,Af&&Ts()))}function $n(t,e){var n=t.callbackNode;hP(t,e);var r=Sh(t,t===Ft?Gt:0);if(r===0)n!==null&&Q0(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Q0(n),e===1)t.tag===0?d4(Uw.bind(null,t)):OI(Uw.bind(null,t)),o4(function(){!(We&6)&&Ts()}),n=null;else{switch(uI(r)){case 1:n=r_;break;case 4:n=aI;break;case 16:n=kh;break;case 536870912:n=oI;break;default:n=kh}n=N$(n,I$.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function I$(t,e){if(uh=-1,ch=0,We&6)throw Error(le(327));var n=t.callbackNode;if(ko()&&t.callbackNode!==n)return null;var r=Sh(t,t===Ft?Gt:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Hh(t,r);else{e=r;var i=We;We|=2;var s=k$();(Ft!==t||Gt!==e)&&(ci=null,jo=xt()+500,ua(t,e));do try{N4();break}catch(o){$$(t,o)}while(!0);g_(),Fh.current=s,We=i,kt!==null?e=0:(Ft=null,Gt=0,e=Pt)}if(e!==0){if(e===2&&(i=kg(t),i!==0&&(r=i,e=ty(t,i))),e===1)throw n=tc,ua(t,0),Hi(t,r),$n(t,xt()),n;if(e===6)Hi(t,r);else{if(i=t.current.alternate,!(r&30)&&!A4(i)&&(e=Hh(t,r),e===2&&(s=kg(t),s!==0&&(r=s,e=ty(t,s))),e===1))throw n=tc,ua(t,0),Hi(t,r),$n(t,xt()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(le(345));case 2:ea(t,bn,ci);break;case 3:if(Hi(t,r),(r&130023424)===r&&(e=R_+500-xt(),10<e)){if(Sh(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){hn(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=Dg(ea.bind(null,t,bn,ci),e);break}ea(t,bn,ci);break;case 4:if(Hi(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var a=31-vr(r);s=1<<a,a=e[a],a>i&&(i=a),r&=~s}if(r=i,r=xt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*C4(r/1960))-r,10<r){t.timeoutHandle=Dg(ea.bind(null,t,bn,ci),r);break}ea(t,bn,ci);break;case 5:ea(t,bn,ci);break;default:throw Error(le(329))}}}return $n(t,xt()),t.callbackNode===n?I$.bind(null,t):null}function ty(t,e){var n=ku;return t.current.memoizedState.isDehydrated&&(ua(t,e).flags|=256),t=Hh(t,e),t!==2&&(e=bn,bn=n,e!==null&&ny(e)),t}function ny(t){bn===null?bn=t:bn.push.apply(bn,t)}function A4(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!Tr(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Hi(t,e){for(e&=~A_,e&=~Of,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-vr(e),r=1<<n;t[n]=-1,e&=~r}}function Uw(t){if(We&6)throw Error(le(327));ko();var e=Sh(t,0);if(!(e&1))return $n(t,xt()),null;var n=Hh(t,e);if(t.tag!==0&&n===2){var r=kg(t);r!==0&&(e=r,n=ty(t,r))}if(n===1)throw n=tc,ua(t,0),Hi(t,e),$n(t,xt()),n;if(n===6)throw Error(le(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ea(t,bn,ci),$n(t,xt()),null}function N_(t,e){var n=We;We|=1;try{return t(e)}finally{We=n,We===0&&(jo=xt()+500,Af&&Ts())}}function _a(t){Xi!==null&&Xi.tag===0&&!(We&6)&&ko();var e=We;We|=1;var n=Kn.transition,r=Je;try{if(Kn.transition=null,Je=1,t)return t()}finally{Je=r,Kn.transition=n,We=e,!(We&6)&&Ts()}}function P_(){Rn=_o.current,ut(_o)}function ua(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,a4(n)),kt!==null)for(n=kt.return;n!==null;){var r=n;switch(f_(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Ph();break;case 3:zo(),ut(Tn),ut(an),x_();break;case 5:b_(r);break;case 4:zo();break;case 13:ut(ft);break;case 19:ut(ft);break;case 10:y_(r.type._context);break;case 22:case 23:P_()}n=n.return}if(Ft=t,kt=t=os(t.current,null),Gt=Rn=e,Pt=0,tc=null,A_=Of=ya=0,bn=ku=null,aa!==null){for(e=0;e<aa.length;e++)if(n=aa[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var a=s.next;s.next=i,r.next=a}n.pending=r}aa=null}return t}function $$(t,e){do{var n=kt;try{if(g_(),ah.current=Bh,Uh){for(var r=pt.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Uh=!1}if(ga=0,Bt=Nt=pt=null,Iu=!1,Xu=0,C_.current=null,n===null||n.return===null){Pt=1,tc=e,kt=null;break}e:{var s=t,a=n.return,o=n,l=e;if(e=Gt,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,h=o,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var g=Sw(a);if(g!==null){g.flags&=-257,Cw(g,a,o,s,e),g.mode&1&&kw(s,u,e),e=g,l=u;var _=e.updateQueue;if(_===null){var x=new Set;x.add(l),e.updateQueue=x}else _.add(l);break e}else{if(!(e&1)){kw(s,u,e),O_();break e}l=Error(le(426))}}else if(dt&&o.mode&1){var $=Sw(a);if($!==null){!($.flags&65536)&&($.flags|=256),Cw($,a,o,s,e),p_(Vo(l,o));break e}}s=l=Vo(l,o),Pt!==4&&(Pt=2),ku===null?ku=[s]:ku.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var w=u$(s,l,e);bw(s,w);break e;case 1:o=l;var y=s.type,I=s.stateNode;if(!(s.flags&128)&&(typeof y.getDerivedStateFromError=="function"||I!==null&&typeof I.componentDidCatch=="function"&&(ss===null||!ss.has(I)))){s.flags|=65536,e&=-e,s.lanes|=e;var R=c$(s,o,e);bw(s,R);break e}}s=s.return}while(s!==null)}C$(n)}catch(M){e=M,kt===n&&n!==null&&(kt=n=n.return);continue}break}while(!0)}function k$(){var t=Fh.current;return Fh.current=Bh,t===null?Bh:t}function O_(){(Pt===0||Pt===3||Pt===2)&&(Pt=4),Ft===null||!(ya&268435455)&&!(Of&268435455)||Hi(Ft,Gt)}function Hh(t,e){var n=We;We|=2;var r=k$();(Ft!==t||Gt!==e)&&(ci=null,ua(t,e));do try{R4();break}catch(i){$$(t,i)}while(!0);if(g_(),We=n,Fh.current=r,kt!==null)throw Error(le(261));return Ft=null,Gt=0,Pt}function R4(){for(;kt!==null;)S$(kt)}function N4(){for(;kt!==null&&!rP();)S$(kt)}function S$(t){var e=R$(t.alternate,t,Rn);t.memoizedProps=t.pendingProps,e===null?C$(t):kt=e,C_.current=null}function C$(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=I4(n,e),n!==null){n.flags&=32767,kt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Pt=6,kt=null;return}}else if(n=T4(n,e,Rn),n!==null){kt=n;return}if(e=e.sibling,e!==null){kt=e;return}kt=e=t}while(e!==null);Pt===0&&(Pt=5)}function ea(t,e,n){var r=Je,i=Kn.transition;try{Kn.transition=null,Je=1,P4(t,e,n,r)}finally{Kn.transition=i,Je=r}return null}function P4(t,e,n,r){do ko();while(Xi!==null);if(We&6)throw Error(le(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(le(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(fP(t,s),t===Ft&&(kt=Ft=null,Gt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Sd||(Sd=!0,N$(kh,function(){return ko(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=Kn.transition,Kn.transition=null;var a=Je;Je=1;var o=We;We|=4,C_.current=null,k4(t,n),E$(n,t),ZP(Pg),Ch=!!Ng,Pg=Ng=null,t.current=n,S4(n),iP(),We=o,Je=a,Kn.transition=s}else t.current=n;if(Sd&&(Sd=!1,Xi=t,qh=i),s=t.pendingLanes,s===0&&(ss=null),oP(n.stateNode),$n(t,xt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Wh)throw Wh=!1,t=Zg,Zg=null,t;return qh&1&&t.tag!==0&&ko(),s=t.pendingLanes,s&1?t===ey?Su++:(Su=0,ey=t):Su=0,Ts(),null}function ko(){if(Xi!==null){var t=uI(qh),e=Kn.transition,n=Je;try{if(Kn.transition=null,Je=16>t?16:t,Xi===null)var r=!1;else{if(t=Xi,Xi=null,qh=0,We&6)throw Error(le(331));var i=We;for(We|=4,_e=t.current;_e!==null;){var s=_e,a=s.child;if(_e.flags&16){var o=s.deletions;if(o!==null){for(var l=0;l<o.length;l++){var u=o[l];for(_e=u;_e!==null;){var h=_e;switch(h.tag){case 0:case 11:case 15:$u(8,h,s)}var f=h.child;if(f!==null)f.return=h,_e=f;else for(;_e!==null;){h=_e;var p=h.sibling,g=h.return;if(w$(h),h===u){_e=null;break}if(p!==null){p.return=g,_e=p;break}_e=g}}}var _=s.alternate;if(_!==null){var x=_.child;if(x!==null){_.child=null;do{var $=x.sibling;x.sibling=null,x=$}while(x!==null)}}_e=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,_e=a;else e:for(;_e!==null;){if(s=_e,s.flags&2048)switch(s.tag){case 0:case 11:case 15:$u(9,s,s.return)}var w=s.sibling;if(w!==null){w.return=s.return,_e=w;break e}_e=s.return}}var y=t.current;for(_e=y;_e!==null;){a=_e;var I=a.child;if(a.subtreeFlags&2064&&I!==null)I.return=a,_e=I;else e:for(a=y;_e!==null;){if(o=_e,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:Pf(9,o)}}catch(M){_t(o,o.return,M)}if(o===a){_e=null;break e}var R=o.sibling;if(R!==null){R.return=o.return,_e=R;break e}_e=o.return}}if(We=i,Ts(),Br&&typeof Br.onPostCommitFiberRoot=="function")try{Br.onPostCommitFiberRoot(If,t)}catch{}r=!0}return r}finally{Je=n,Kn.transition=e}}return!1}function Bw(t,e,n){e=Vo(n,e),e=u$(t,e,1),t=is(t,e,1),e=hn(),t!==null&&(gc(t,1,e),$n(t,e))}function _t(t,e,n){if(t.tag===3)Bw(t,t,n);else for(;e!==null;){if(e.tag===3){Bw(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(ss===null||!ss.has(r))){t=Vo(n,t),t=c$(e,t,1),e=is(e,t,1),t=hn(),e!==null&&(gc(e,1,t),$n(e,t));break}}e=e.return}}function O4(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=hn(),t.pingedLanes|=t.suspendedLanes&n,Ft===t&&(Gt&n)===n&&(Pt===4||Pt===3&&(Gt&130023424)===Gt&&500>xt()-R_?ua(t,0):A_|=n),$n(t,e)}function A$(t,e){e===0&&(t.mode&1?(e=_d,_d<<=1,!(_d&130023424)&&(_d=4194304)):e=1);var n=hn();t=xi(t,e),t!==null&&(gc(t,e,n),$n(t,n))}function D4(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),A$(t,n)}function M4(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(le(314))}r!==null&&r.delete(e),A$(t,n)}var R$;R$=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Tn.current)En=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return En=!1,E4(t,e,n);En=!!(t.flags&131072)}else En=!1,dt&&e.flags&1048576&&DI(e,Mh,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;lh(t,e),t=e.pendingProps;var i=Do(e,an.current);$o(e,n),i=T_(null,e,r,t,i,n);var s=I_();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,In(r)?(s=!0,Oh(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,v_(e),i.updater=Nf,e.stateNode=i,i._reactInternals=e,Bg(e,r,t,n),e=qg(null,e,r,!0,s,n)):(e.tag=0,dt&&s&&h_(e),dn(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(lh(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=z4(r),t=hr(r,t),i){case 0:e=Wg(null,e,r,t,n);break e;case 1:e=Nw(null,e,r,t,n);break e;case 11:e=Aw(null,e,r,t,n);break e;case 14:e=Rw(null,e,r,hr(r.type,t),n);break e}throw Error(le(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:hr(r,i),Wg(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:hr(r,i),Nw(t,e,r,i,n);case 3:e:{if(p$(e),t===null)throw Error(le(387));r=e.pendingProps,s=e.memoizedState,i=s.element,UI(t,e),Vh(e,r,null,n);var a=e.memoizedState;if(r=a.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Vo(Error(le(423)),e),e=Pw(t,e,r,n,i);break e}else if(r!==i){i=Vo(Error(le(424)),e),e=Pw(t,e,r,n,i);break e}else for(On=rs(e.stateNode.containerInfo.firstChild),Mn=e,dt=!0,pr=null,n=VI(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Mo(),r===i){e=Ei(t,e,n);break e}dn(t,e,r,n)}e=e.child}return e;case 5:return BI(e),t===null&&Vg(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,a=i.children,Og(r,i)?a=null:s!==null&&Og(r,s)&&(e.flags|=32),f$(t,e),dn(t,e,a,n),e.child;case 6:return t===null&&Vg(e),null;case 13:return m$(t,e,n);case 4:return w_(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Lo(e,null,r,n):dn(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:hr(r,i),Aw(t,e,r,i,n);case 7:return dn(t,e,e.pendingProps,n),e.child;case 8:return dn(t,e,e.pendingProps.children,n),e.child;case 12:return dn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,a=i.value,at(Lh,r._currentValue),r._currentValue=a,s!==null)if(Tr(s.value,a)){if(s.children===i.children&&!Tn.current){e=Ei(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var o=s.dependencies;if(o!==null){a=s.child;for(var l=o.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=yi(-1,n&-n),l.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?l.next=l:(l.next=h.next,h.next=l),u.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),jg(s.return,n,e),o.lanes|=n;break}l=l.next}}else if(s.tag===10)a=s.type===e.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(le(341));a.lanes|=n,o=a.alternate,o!==null&&(o.lanes|=n),jg(a,n,e),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===e){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}dn(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,$o(e,n),i=Qn(i),r=r(i),e.flags|=1,dn(t,e,r,n),e.child;case 14:return r=e.type,i=hr(r,e.pendingProps),i=hr(r.type,i),Rw(t,e,r,i,n);case 15:return d$(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:hr(r,i),lh(t,e),e.tag=1,In(r)?(t=!0,Oh(e)):t=!1,$o(e,n),l$(e,r,i),Bg(e,r,i,n),qg(null,e,r,!0,t,n);case 19:return g$(t,e,n);case 22:return h$(t,e,n)}throw Error(le(156,e.tag))};function N$(t,e){return sI(t,e)}function L4(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Gn(t,e,n,r){return new L4(t,e,n,r)}function D_(t){return t=t.prototype,!(!t||!t.isReactComponent)}function z4(t){if(typeof t=="function")return D_(t)?1:0;if(t!=null){if(t=t.$$typeof,t===e_)return 11;if(t===t_)return 14}return 2}function os(t,e){var n=t.alternate;return n===null?(n=Gn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function dh(t,e,n,r,i,s){var a=2;if(r=t,typeof t=="function")D_(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case oo:return ca(n.children,i,s,e);case Zy:a=8,i|=8;break;case hg:return t=Gn(12,n,e,i|2),t.elementType=hg,t.lanes=s,t;case fg:return t=Gn(13,n,e,i),t.elementType=fg,t.lanes=s,t;case pg:return t=Gn(19,n,e,i),t.elementType=pg,t.lanes=s,t;case BT:return Df(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case jT:a=10;break e;case UT:a=9;break e;case e_:a=11;break e;case t_:a=14;break e;case Fi:a=16,r=null;break e}throw Error(le(130,t==null?t:typeof t,""))}return e=Gn(a,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function ca(t,e,n,r){return t=Gn(7,t,r,e),t.lanes=n,t}function Df(t,e,n,r){return t=Gn(22,t,r,e),t.elementType=BT,t.lanes=n,t.stateNode={isHidden:!1},t}function Qp(t,e,n){return t=Gn(6,t,null,e),t.lanes=n,t}function Yp(t,e,n){return e=Gn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function V4(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ap(0),this.expirationTimes=Ap(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ap(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function M_(t,e,n,r,i,s,a,o,l){return t=new V4(t,e,n,o,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Gn(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},v_(s),t}function j4(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ao,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function P$(t){if(!t)return fs;t=t._reactInternals;e:{if(Aa(t)!==t||t.tag!==1)throw Error(le(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(In(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(le(171))}if(t.tag===1){var n=t.type;if(In(n))return PI(t,n,e)}return e}function O$(t,e,n,r,i,s,a,o,l){return t=M_(n,r,!0,t,i,s,a,o,l),t.context=P$(null),n=t.current,r=hn(),i=as(n),s=yi(r,i),s.callback=e??null,is(n,s,i),t.current.lanes=i,gc(t,i,r),$n(t,r),t}function Mf(t,e,n,r){var i=e.current,s=hn(),a=as(i);return n=P$(n),e.context===null?e.context=n:e.pendingContext=n,e=yi(s,a),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=is(i,e,a),t!==null&&(wr(t,i,a,s),sh(t,i,a)),a}function Gh(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Fw(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function L_(t,e){Fw(t,e),(t=t.alternate)&&Fw(t,e)}function U4(){return null}var D$=typeof reportError=="function"?reportError:function(t){console.error(t)};function z_(t){this._internalRoot=t}Lf.prototype.render=z_.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(le(409));Mf(t,e,null,null)};Lf.prototype.unmount=z_.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;_a(function(){Mf(null,t,null,null)}),e[bi]=null}};function Lf(t){this._internalRoot=t}Lf.prototype.unstable_scheduleHydration=function(t){if(t){var e=hI();t={blockedOn:null,target:t,priority:e};for(var n=0;n<qi.length&&e!==0&&e<qi[n].priority;n++);qi.splice(n,0,t),n===0&&pI(t)}};function V_(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function zf(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Ww(){}function B4(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var u=Gh(a);s.call(u)}}var a=O$(e,r,t,0,null,!1,!1,"",Ww);return t._reactRootContainer=a,t[bi]=a.current,Gu(t.nodeType===8?t.parentNode:t),_a(),a}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var o=r;r=function(){var u=Gh(l);o.call(u)}}var l=M_(t,0,!1,null,null,!1,!1,"",Ww);return t._reactRootContainer=l,t[bi]=l.current,Gu(t.nodeType===8?t.parentNode:t),_a(function(){Mf(e,l,n,r)}),l}function Vf(t,e,n,r,i){var s=n._reactRootContainer;if(s){var a=s;if(typeof i=="function"){var o=i;i=function(){var l=Gh(a);o.call(l)}}Mf(e,a,t,i)}else a=B4(n,e,t,i,r);return Gh(a)}cI=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=au(e.pendingLanes);n!==0&&(i_(e,n|1),$n(e,xt()),!(We&6)&&(jo=xt()+500,Ts()))}break;case 13:_a(function(){var r=xi(t,1);if(r!==null){var i=hn();wr(r,t,1,i)}}),L_(t,1)}};s_=function(t){if(t.tag===13){var e=xi(t,134217728);if(e!==null){var n=hn();wr(e,t,134217728,n)}L_(t,134217728)}};dI=function(t){if(t.tag===13){var e=as(t),n=xi(t,e);if(n!==null){var r=hn();wr(n,t,e,r)}L_(t,e)}};hI=function(){return Je};fI=function(t,e){var n=Je;try{return Je=t,e()}finally{Je=n}};Tg=function(t,e,n){switch(e){case"input":if(yg(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=Cf(r);if(!i)throw Error(le(90));WT(r),yg(r,i)}}}break;case"textarea":HT(t,n);break;case"select":e=n.value,e!=null&&xo(t,!!n.multiple,e,!1)}};ZT=N_;eI=_a;var F4={usingClientEntryPoint:!1,Events:[_c,ho,Cf,JT,XT,N_]},Wl={findFiberByHostInstance:sa,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},W4={bundleType:Wl.bundleType,version:Wl.version,rendererPackageName:Wl.rendererPackageName,rendererConfig:Wl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ci.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=rI(t),t===null?null:t.stateNode},findFiberByHostInstance:Wl.findFiberByHostInstance||U4,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Cd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Cd.isDisabled&&Cd.supportsFiber)try{If=Cd.inject(W4),Br=Cd}catch{}}Vn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=F4;Vn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!V_(e))throw Error(le(200));return j4(t,e,null,n)};Vn.createRoot=function(t,e){if(!V_(t))throw Error(le(299));var n=!1,r="",i=D$;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=M_(t,1,!1,null,null,n,!1,r,i),t[bi]=e.current,Gu(t.nodeType===8?t.parentNode:t),new z_(e)};Vn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(le(188)):(t=Object.keys(t).join(","),Error(le(268,t)));return t=rI(e),t=t===null?null:t.stateNode,t};Vn.flushSync=function(t){return _a(t)};Vn.hydrate=function(t,e,n){if(!zf(e))throw Error(le(200));return Vf(null,t,e,!0,n)};Vn.hydrateRoot=function(t,e,n){if(!V_(t))throw Error(le(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",a=D$;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),e=O$(e,null,t,1,n??null,i,!1,s,a),t[bi]=e.current,Gu(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new Lf(e)};Vn.render=function(t,e,n){if(!zf(e))throw Error(le(200));return Vf(null,t,e,!1,n)};Vn.unmountComponentAtNode=function(t){if(!zf(t))throw Error(le(40));return t._reactRootContainer?(_a(function(){Vf(null,null,t,!1,function(){t._reactRootContainer=null,t[bi]=null})}),!0):!1};Vn.unstable_batchedUpdates=N_;Vn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!zf(n))throw Error(le(200));if(t==null||t._reactInternals===void 0)throw Error(le(38));return Vf(t,e,n,!1,r)};Vn.version="18.3.1-next-f1338f8080-20240426";function M$(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(M$)}catch(t){console.error(t)}}M$(),MT.exports=Vn;var q4=MT.exports,qw=q4;cg.createRoot=qw.createRoot,cg.hydrateRoot=qw.hydrateRoot;const H4="modulepreload",G4=function(t,e){return new URL(t,e).href},Hw={},L$=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){const a=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(n.map(u=>{if(u=G4(u,r),u in Hw)return;Hw[u]=!0;const h=u.endsWith(".css"),f=h?'[rel="stylesheet"]':"";if(!!r)for(let _=a.length-1;_>=0;_--){const x=a[_];if(x.href===u&&(!h||x.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${f}`))return;const g=document.createElement("link");if(g.rel=h?"stylesheet":H4,h||(g.as="script"),g.crossOrigin="",g.href=u,l&&g.setAttribute("nonce",l),document.head.appendChild(g),h)return new Promise((_,x)=>{g.addEventListener("load",_),g.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return i.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return e().catch(s)})},K4=({onLogin:t})=>{const[e,n]=ve.useState(!0),[r,i]=ve.useState(""),[s,a]=ve.useState(""),[o,l]=ve.useState(""),[u,h]=ve.useState(!1),[f,p]=ve.useState(!1),g=async _=>{if(_.preventDefault(),l(""),!r.includes("@")){l("Please enter a valid email address.");return}if(s.length<6){l("Password must be at least 6 characters long.");return}h(!0);try{const{api:x}=await L$(async()=>{const{api:w}=await Promise.resolve().then(()=>W6);return{api:w}},void 0,import.meta.url);let $;e?$=await x.login(r,s):$=await x.register(r,s),$.success?t($.user,!e):l($.error||"Authentication failed")}catch(x){console.error("Authentication error:",x),l("Network error. Please try again.")}finally{h(!1)}};return E.jsxs("div",{className:"login-container",children:[E.jsxs("div",{className:"login-card fade-in",children:[E.jsxs("div",{className:"logo-section",children:[E.jsx("img",{src:"app_logo.jpg",alt:"BloodFit Logo",className:"app-logo"}),E.jsx("h1",{children:"Blood & Fit"}),E.jsx("p",{children:"Your personal health companion"})]}),E.jsxs("form",{onSubmit:g,className:"login-form",children:[E.jsxs("div",{className:"form-group",children:[E.jsx("label",{htmlFor:"email",children:"Email Address"}),E.jsx("input",{type:"email",id:"email",className:"input-field",placeholder:"hello@example.com",value:r,onChange:_=>i(_.target.value),required:!0})]}),E.jsxs("div",{className:"form-group",children:[E.jsx("label",{htmlFor:"password",children:"Password"}),E.jsxs("div",{className:"password-wrapper",children:[E.jsx("input",{type:f?"text":"password",id:"password",className:"input-field",placeholder:"",value:s,onChange:_=>a(_.target.value),required:!0}),E.jsx("button",{type:"button",className:"toggle-password",onClick:()=>p(!f),children:f?"Hide":"Show"})]}),e&&E.jsx("div",{className:"forgot-password",children:E.jsx("span",{onClick:()=>alert("Reset link sent to email!"),children:"Forgot Password?"})})]}),o&&E.jsx("div",{className:"error-box fade-in",children:E.jsxs("span",{children:[" ",o]})}),E.jsx("button",{type:"submit",className:"btn-primary",disabled:u,children:u?E.jsx("span",{className:"spinner"}):e?"Login":"Sign Up"})]}),E.jsxs("p",{className:"footer-text",children:[e?"Don't have an account? ":"Already have an account? ",E.jsx("span",{className:"link",onClick:()=>{n(!e),l("")},children:e?"Sign up":"Login"})]})]}),E.jsx("style",{children:`
        .login-container {
          min-height: 100vh;
          display: flex;
          align-items: center;
          justify-content: center;
          padding: var(--spacing-md);
          background: linear-gradient(135deg, #fff1f2 0%, #fff 100%);
        }
        
        .login-card {
           width: 100%;
           max-width: 400px;
           background: rgba(255, 255, 255, 0.9);
           backdrop-filter: blur(10px);
           padding: var(--spacing-xl);
           border-radius: 24px;
           box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
           text-align: center;
           border: 1px solid rgba(255,255,255,0.5);
        }

        .logo-section {
          margin-bottom: var(--spacing-xl);
        }

        .app-logo {
          width: 80px;
          height: 80px;
          object-fit: contain;
          margin-bottom: var(--spacing-md);
          border-radius: 20px; /* Softer edges */
          box-shadow: var(--shadow-md);
        }

        .logo-section h1 {
          font-size: 24px;
          color: var(--color-text-main);
          margin-bottom: 5px;
          font-weight: 800;
        }

        .logo-section p {
          color: var(--color-text-secondary);
          font-size: 14px;
        }

        .login-form {
          display: flex;
          flex-direction: column;
          gap: 20px;
        }

        .form-group {
          text-align: left;
        }

        .form-group label {
          display: block;
          margin-bottom: 8px;
          font-weight: 600;
          color: var(--color-text-main);
          font-size: 13px;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-md);
            font-size: 14px;
            transition: all 0.2s;
        }
        .input-field:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);
        }

        .password-wrapper {
            position: relative;
        }
        .toggle-password {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            font-size: 12px;
            color: var(--color-primary);
            font-weight: 600;
            cursor: pointer;
        }

        .btn-primary {
          width: 100%;
          padding: 12px;
          background: var(--color-primary);
          color: white;
          border: none;
          border-radius: var(--radius-md);
          font-weight: 600;
          font-size: 14px;
          cursor: pointer;
          transition: background 0.2s;
        }
        .btn-primary:active { transform: scale(0.98); }

        .error-box {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #ef4444;
            padding: 10px;
            border-radius: var(--radius-md);
            font-size: 12px;
            text-align: left;
            display: flex; gap: 8px;
        }

        .footer-text {
          margin-top: 25px;
          font-size: 13px;
          color: var(--color-text-secondary);
        }

        .link {
          color: var(--color-primary);
          font-weight: 600;
          cursor: pointer;
        }
        .link:hover { text-decoration: underline; }

        .spinner {
          width: 20px;
          height: 20px;
          border: 2px solid rgba(255,255,255,0.3);
          border-radius: 50%;
          border-top-color: white;
          animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        .fade-in {
          animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
          to { opacity: 1; transform: translateY(0); }
        }
        
        .forgot-password {
            text-align: right;
            margin-top: 8px;
            font-size: 12px;
        }
        .forgot-password span {
            color: var(--color-primary);
            cursor: pointer;
            font-weight: 500;
        }
      `})]})},Q4=()=>{};var Gw={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z$=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},Y4=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=t[n++],a=t[n++],o=t[n++],l=((i&7)<<18|(s&63)<<12|(a&63)<<6|o&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const s=t[n++],a=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|a&63)}}return e.join("")},V$={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const s=t[i],a=i+1<t.length,o=a?t[i+1]:0,l=i+2<t.length,u=l?t[i+2]:0,h=s>>2,f=(s&3)<<4|o>>4;let p=(o&15)<<2|u>>6,g=u&63;l||(g=64,a||(p=64)),r.push(n[h],n[f],n[p],n[g])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(z$(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):Y4(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const s=n[t.charAt(i++)],o=i<t.length?n[t.charAt(i)]:0;++i;const u=i<t.length?n[t.charAt(i)]:64;++i;const f=i<t.length?n[t.charAt(i)]:64;if(++i,s==null||o==null||u==null||f==null)throw new J4;const p=s<<2|o>>4;if(r.push(p),u!==64){const g=o<<4&240|u>>2;if(r.push(g),f!==64){const _=u<<6&192|f;r.push(_)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class J4 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const X4=function(t){const e=z$(t);return V$.encodeByteArray(e,!0)},Kh=function(t){return X4(t).replace(/\./g,"")},j$=function(t){try{return V$.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z4(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eO=()=>Z4().__FIREBASE_DEFAULTS__,tO=()=>{if(typeof process>"u"||typeof Gw>"u")return;const t=Gw.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},nO=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&j$(t[1]);return e&&JSON.parse(e)},jf=()=>{try{return Q4()||eO()||tO()||nO()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},U$=t=>{var e,n;return(n=(e=jf())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},B$=t=>{const e=U$(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},F$=()=>{var t;return(t=jf())==null?void 0:t.config},W$=t=>{var e;return(e=jf())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rO{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ra(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function j_(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q$(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...t};return[Kh(JSON.stringify(n)),Kh(JSON.stringify(a)),""].join(".")}const Cu={};function iO(){const t={prod:[],emulator:[]};for(const e of Object.keys(Cu))Cu[e]?t.emulator.push(e):t.prod.push(e);return t}function sO(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let Kw=!1;function U_(t,e){if(typeof window>"u"||typeof document>"u"||!Ra(window.location.host)||Cu[t]===e||Cu[t]||Kw)return;Cu[t]=e;function n(p){return`__firebase__banner__${p}`}const r="__firebase__banner",s=iO().prod.length>0;function a(){const p=document.getElementById(r);p&&p.remove()}function o(p){p.style.display="flex",p.style.background="#7faaf0",p.style.position="fixed",p.style.bottom="5px",p.style.left="5px",p.style.padding=".5em",p.style.borderRadius="5px",p.style.alignItems="center"}function l(p,g){p.setAttribute("width","24"),p.setAttribute("id",g),p.setAttribute("height","24"),p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("fill","none"),p.style.marginLeft="-6px"}function u(){const p=document.createElement("span");return p.style.cursor="pointer",p.style.marginLeft="16px",p.style.fontSize="24px",p.innerHTML=" &times;",p.onclick=()=>{Kw=!0,a()},p}function h(p,g){p.setAttribute("id",g),p.innerText="Learn more",p.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",p.setAttribute("target","__blank"),p.style.paddingLeft="5px",p.style.textDecoration="underline"}function f(){const p=sO(r),g=n("text"),_=document.getElementById(g)||document.createElement("span"),x=n("learnmore"),$=document.getElementById(x)||document.createElement("a"),w=n("preprendIcon"),y=document.getElementById(w)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.created){const I=p.element;o(I),h($,x);const R=u();l(y,w),I.append(y,_,$,R),document.body.appendChild(I)}s?(_.innerText="Preview backend disconnected.",y.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(y.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,_.innerText="Preview backend running in this workspace."),_.setAttribute("id",g)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function on(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function aO(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(on())}function oO(){var e;const t=(e=jf())==null?void 0:e.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function lO(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function uO(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function cO(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function dO(){const t=on();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function hO(){return!oO()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function fO(){try{return typeof indexedDB=="object"}catch{return!1}}function pO(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var s;e(((s=i.error)==null?void 0:s.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mO="FirebaseError";class ei extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=mO,Object.setPrototypeOf(this,ei.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,wc.prototype.create)}}class wc{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,s=this.errors[e],a=s?gO(s,r):"Error",o=`${this.serviceName}: ${a} (${i}).`;return new ei(i,o,r)}}function gO(t,e){return t.replace(yO,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const yO=/\{\$([^}]+)}/g;function _O(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function va(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const s=t[i],a=e[i];if(Qw(s)&&Qw(a)){if(!va(s,a))return!1}else if(s!==a)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function Qw(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bc(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function lu(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function uu(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function vO(t,e){const n=new wO(t,e);return n.subscribe.bind(n)}class wO{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");bO(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=Jp),i.error===void 0&&(i.error=Jp),i.complete===void 0&&(i.complete=Jp);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function bO(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Jp(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mt(t){return t&&t._delegate?t._delegate:t}class ps{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ta="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xO{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new rO;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(TO(e))try{this.getOrInitializeService({instanceIdentifier:ta})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=ta){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ta){return this.instances.has(e)}getOptions(e=ta){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[s,a]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(s);r===o&&a.resolve(i)}return i}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:EO(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ta){return this.component?this.component.multipleInstances?e:ta:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function EO(t){return t===ta?void 0:t}function TO(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IO{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new xO(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Le;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Le||(Le={}));const $O={debug:Le.DEBUG,verbose:Le.VERBOSE,info:Le.INFO,warn:Le.WARN,error:Le.ERROR,silent:Le.SILENT},kO=Le.INFO,SO={[Le.DEBUG]:"log",[Le.VERBOSE]:"log",[Le.INFO]:"info",[Le.WARN]:"warn",[Le.ERROR]:"error"},CO=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=SO[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class B_{constructor(e){this.name=e,this._logLevel=kO,this._logHandler=CO,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Le))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?$O[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Le.DEBUG,...e),this._logHandler(this,Le.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Le.VERBOSE,...e),this._logHandler(this,Le.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Le.INFO,...e),this._logHandler(this,Le.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Le.WARN,...e),this._logHandler(this,Le.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Le.ERROR,...e),this._logHandler(this,Le.ERROR,...e)}}const AO=(t,e)=>e.some(n=>t instanceof n);let Yw,Jw;function RO(){return Yw||(Yw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function NO(){return Jw||(Jw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const H$=new WeakMap,ry=new WeakMap,G$=new WeakMap,Xp=new WeakMap,F_=new WeakMap;function PO(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",a)},s=()=>{n(ls(t.result)),i()},a=()=>{r(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",a)});return e.then(n=>{n instanceof IDBCursor&&H$.set(n,t)}).catch(()=>{}),F_.set(e,t),e}function OO(t){if(ry.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",a),t.removeEventListener("abort",a)},s=()=>{n(),i()},a=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",a),t.addEventListener("abort",a)});ry.set(t,e)}let iy={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return ry.get(t);if(e==="objectStoreNames")return t.objectStoreNames||G$.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ls(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function DO(t){iy=t(iy)}function MO(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Zp(this),e,...n);return G$.set(r,e.sort?e.sort():[e]),ls(r)}:NO().includes(t)?function(...e){return t.apply(Zp(this),e),ls(H$.get(this))}:function(...e){return ls(t.apply(Zp(this),e))}}function LO(t){return typeof t=="function"?MO(t):(t instanceof IDBTransaction&&OO(t),AO(t,RO())?new Proxy(t,iy):t)}function ls(t){if(t instanceof IDBRequest)return PO(t);if(Xp.has(t))return Xp.get(t);const e=LO(t);return e!==t&&(Xp.set(t,e),F_.set(e,t)),e}const Zp=t=>F_.get(t);function zO(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(t,e),o=ls(a);return r&&a.addEventListener("upgradeneeded",l=>{r(ls(a.result),l.oldVersion,l.newVersion,ls(a.transaction),l)}),n&&a.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),o.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),o}const VO=["get","getKey","getAll","getAllKeys","count"],jO=["put","add","delete","clear"],em=new Map;function Xw(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(em.get(e))return em.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=jO.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||VO.includes(n)))return;const s=async function(a,...o){const l=this.transaction(a,i?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(o.shift())),(await Promise.all([u[n](...o),i&&l.done]))[0]};return em.set(e,s),s}DO(t=>({...t,get:(e,n,r)=>Xw(e,n)||t.get(e,n,r),has:(e,n)=>!!Xw(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UO{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(BO(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function BO(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const sy="@firebase/app",Zw="0.14.7";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ti=new B_("@firebase/app"),FO="@firebase/app-compat",WO="@firebase/analytics-compat",qO="@firebase/analytics",HO="@firebase/app-check-compat",GO="@firebase/app-check",KO="@firebase/auth",QO="@firebase/auth-compat",YO="@firebase/database",JO="@firebase/data-connect",XO="@firebase/database-compat",ZO="@firebase/functions",eD="@firebase/functions-compat",tD="@firebase/installations",nD="@firebase/installations-compat",rD="@firebase/messaging",iD="@firebase/messaging-compat",sD="@firebase/performance",aD="@firebase/performance-compat",oD="@firebase/remote-config",lD="@firebase/remote-config-compat",uD="@firebase/storage",cD="@firebase/storage-compat",dD="@firebase/firestore",hD="@firebase/ai",fD="@firebase/firestore-compat",pD="firebase",mD="12.8.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ay="[DEFAULT]",gD={[sy]:"fire-core",[FO]:"fire-core-compat",[qO]:"fire-analytics",[WO]:"fire-analytics-compat",[GO]:"fire-app-check",[HO]:"fire-app-check-compat",[KO]:"fire-auth",[QO]:"fire-auth-compat",[YO]:"fire-rtdb",[JO]:"fire-data-connect",[XO]:"fire-rtdb-compat",[ZO]:"fire-fn",[eD]:"fire-fn-compat",[tD]:"fire-iid",[nD]:"fire-iid-compat",[rD]:"fire-fcm",[iD]:"fire-fcm-compat",[sD]:"fire-perf",[aD]:"fire-perf-compat",[oD]:"fire-rc",[lD]:"fire-rc-compat",[uD]:"fire-gcs",[cD]:"fire-gcs-compat",[dD]:"fire-fst",[fD]:"fire-fst-compat",[hD]:"fire-vertex","fire-js":"fire-js",[pD]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qh=new Map,yD=new Map,oy=new Map;function e1(t,e){try{t.container.addComponent(e)}catch(n){Ti.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function wa(t){const e=t.name;if(oy.has(e))return Ti.debug(`There were multiple attempts to register component ${e}.`),!1;oy.set(e,t);for(const n of Qh.values())e1(n,t);for(const n of yD.values())e1(n,t);return!0}function Uf(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Pn(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _D={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},us=new wc("app","Firebase",_D);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vD{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ps("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw us.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Na=mD;function K$(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:ay,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw us.create("bad-app-name",{appName:String(i)});if(n||(n=F$()),!n)throw us.create("no-options");const s=Qh.get(i);if(s){if(va(n,s.options)&&va(r,s.config))return s;throw us.create("duplicate-app",{appName:i})}const a=new IO(i);for(const l of oy.values())a.addComponent(l);const o=new vD(n,r,a);return Qh.set(i,o),o}function W_(t=ay){const e=Qh.get(t);if(!e&&t===ay&&F$())return K$();if(!e)throw us.create("no-app",{appName:t});return e}function Wr(t,e,n){let r=gD[t]??t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),s=e.match(/\s|\//);if(i||s){const a=[`Unable to register library "${r}" with version "${e}":`];i&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&a.push("and"),s&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ti.warn(a.join(" "));return}wa(new ps(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wD="firebase-heartbeat-database",bD=1,nc="firebase-heartbeat-store";let tm=null;function Q$(){return tm||(tm=zO(wD,bD,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(nc)}catch(n){console.warn(n)}}}}).catch(t=>{throw us.create("idb-open",{originalErrorMessage:t.message})})),tm}async function xD(t){try{const n=(await Q$()).transaction(nc),r=await n.objectStore(nc).get(Y$(t));return await n.done,r}catch(e){if(e instanceof ei)Ti.warn(e.message);else{const n=us.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Ti.warn(n.message)}}}async function t1(t,e){try{const r=(await Q$()).transaction(nc,"readwrite");await r.objectStore(nc).put(e,Y$(t)),await r.done}catch(n){if(n instanceof ei)Ti.warn(n.message);else{const r=us.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Ti.warn(r.message)}}}function Y$(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ED=1024,TD=30;class ID{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new kD(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=n1();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats.length>TD){const a=SD(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Ti.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=n1(),{heartbeatsToSend:r,unsentEntries:i}=$D(this._heartbeatsCache.heartbeats),s=Kh(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(n){return Ti.warn(n),""}}}function n1(){return new Date().toISOString().substring(0,10)}function $D(t,e=ED){const n=[];let r=t.slice();for(const i of t){const s=n.find(a=>a.agent===i.agent);if(s){if(s.dates.push(i.date),r1(n)>e){s.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),r1(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class kD{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return fO()?pO().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await xD(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return t1(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return t1(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function r1(t){return Kh(JSON.stringify({version:2,heartbeats:t})).length}function SD(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CD(t){wa(new ps("platform-logger",e=>new UO(e),"PRIVATE")),wa(new ps("heartbeat",e=>new ID(e),"PRIVATE")),Wr(sy,Zw,t),Wr(sy,Zw,"esm2020"),Wr("fire-js","")}CD("");function J$(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const AD=J$,X$=new wc("auth","Firebase",J$());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yh=new B_("@firebase/auth");function RD(t,...e){Yh.logLevel<=Le.WARN&&Yh.warn(`Auth (${Na}): ${t}`,...e)}function hh(t,...e){Yh.logLevel<=Le.ERROR&&Yh.error(`Auth (${Na}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ir(t,...e){throw q_(t,...e)}function qr(t,...e){return q_(t,...e)}function Z$(t,e,n){const r={...AD(),[e]:n};return new wc("auth","Firebase",r).create(e,{appName:t.name})}function _i(t){return Z$(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function q_(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return X$.create(t,...e)}function ke(t,e,...n){if(!t)throw q_(e,...n)}function mi(t){const e="INTERNAL ASSERTION FAILED: "+t;throw hh(e),new Error(e)}function Ii(t,e){t||mi(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ly(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function ND(){return i1()==="http:"||i1()==="https:"}function i1(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PD(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(ND()||uO()||"connection"in navigator)?navigator.onLine:!0}function OD(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc{constructor(e,n){this.shortDelay=e,this.longDelay=n,Ii(n>e,"Short delay should be less than long delay!"),this.isMobile=aO()||cO()}get(){return PD()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H_(t,e){Ii(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ek{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;mi("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;mi("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;mi("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DD={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MD=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],LD=new xc(3e4,6e4);function Is(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function $s(t,e,n,r,i={}){return tk(t,i,async()=>{let s={},a={};r&&(e==="GET"?a=r:s={body:JSON.stringify(r)});const o=bc({key:t.config.apiKey,...a}).slice(1),l=await t._getAdditionalHeaders();l["Content-Type"]="application/json",t.languageCode&&(l["X-Firebase-Locale"]=t.languageCode);const u={method:e,headers:l,...s};return lO()||(u.referrerPolicy="no-referrer"),t.emulatorConfig&&Ra(t.emulatorConfig.host)&&(u.credentials="include"),ek.fetch()(await nk(t,t.config.apiHost,n,o),u)})}async function tk(t,e,n){t._canInitEmulator=!1;const r={...DD,...e};try{const i=new VD(t),s=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const a=await s.json();if("needConfirmation"in a)throw Ad(t,"account-exists-with-different-credential",a);if(s.ok&&!("errorMessage"in a))return a;{const o=s.ok?a.errorMessage:a.error.message,[l,u]=o.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ad(t,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw Ad(t,"email-already-in-use",a);if(l==="USER_DISABLED")throw Ad(t,"user-disabled",a);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw Z$(t,h,u);Ir(t,h)}}catch(i){if(i instanceof ei)throw i;Ir(t,"network-request-failed",{message:String(i)})}}async function Ec(t,e,n,r,i={}){const s=await $s(t,e,n,r,i);return"mfaPendingCredential"in s&&Ir(t,"multi-factor-auth-required",{_serverResponse:s}),s}async function nk(t,e,n,r){const i=`${e}${n}?${r}`,s=t,a=s.config.emulator?H_(t.config,i):`${t.config.apiScheme}://${i}`;return MD.includes(n)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(a).toString():a}function zD(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class VD{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(qr(this.auth,"network-request-failed")),LD.get())})}}function Ad(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=qr(t,e,r);return i.customData._tokenResponse=n,i}function s1(t){return t!==void 0&&t.enterprise!==void 0}class jD{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return zD(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function UD(t,e){return $s(t,"GET","/v2/recaptchaConfig",Is(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BD(t,e){return $s(t,"POST","/v1/accounts:delete",e)}async function Jh(t,e){return $s(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Au(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function FD(t,e=!1){const n=Mt(t),r=await n.getIdToken(e),i=G_(r);ke(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s=typeof i.firebase=="object"?i.firebase:void 0,a=s==null?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:Au(nm(i.auth_time)),issuedAtTime:Au(nm(i.iat)),expirationTime:Au(nm(i.exp)),signInProvider:a||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function nm(t){return Number(t)*1e3}function G_(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return hh("JWT malformed, contained fewer than 3 sections"),null;try{const i=j$(n);return i?JSON.parse(i):(hh("Failed to decode base64 JWT payload"),null)}catch(i){return hh("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function a1(t){const e=G_(t);return ke(e,"internal-error"),ke(typeof e.exp<"u","internal-error"),ke(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rc(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof ei&&WD(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function WD({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qD{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uy{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Au(this.lastLoginAt),this.creationTime=Au(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xh(t){var f;const e=t.auth,n=await t.getIdToken(),r=await rc(t,Jh(e,{idToken:n}));ke(r==null?void 0:r.users.length,e,"internal-error");const i=r.users[0];t._notifyReloadListener(i);const s=(f=i.providerUserInfo)!=null&&f.length?rk(i.providerUserInfo):[],a=GD(t.providerData,s),o=t.isAnonymous,l=!(t.email&&i.passwordHash)&&!(a!=null&&a.length),u=o?l:!1,h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new uy(i.createdAt,i.lastLoginAt),isAnonymous:u};Object.assign(t,h)}async function HD(t){const e=Mt(t);await Xh(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function GD(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function rk(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KD(t,e){const n=await tk(t,{},async()=>{const r=bc({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=t.config,a=await nk(t,i,"/v1/token",`key=${s}`),o=await t._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:o,body:r};return t.emulatorConfig&&Ra(t.emulatorConfig.host)&&(l.credentials="include"),ek.fetch()(a,l)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function QD(t,e){return $s(t,"POST","/v2/accounts:revokeToken",Is(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class So{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ke(e.idToken,"internal-error"),ke(typeof e.idToken<"u","internal-error"),ke(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):a1(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){ke(e.length!==0,"internal-error");const n=a1(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(ke(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:i,expiresIn:s}=await KD(e,n);this.updateTokensAndExpiration(r,i,Number(s))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:i,expirationTime:s}=n,a=new So;return r&&(ke(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(ke(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),s&&(ke(typeof s=="number","internal-error",{appName:e}),a.expirationTime=s),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new So,this.toJSON())}_performRefresh(){return mi("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vi(t,e){ke(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class yr{constructor({uid:e,auth:n,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new qD(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new uy(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await rc(this,this.stsTokenManager.getToken(this.auth,e));return ke(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return FD(this,e)}reload(){return HD(this)}_assign(e){this!==e&&(ke(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new yr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){ke(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await Xh(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Pn(this.auth.app))return Promise.reject(_i(this.auth));const e=await this.getIdToken();return await rc(this,BD(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,i=n.email??void 0,s=n.phoneNumber??void 0,a=n.photoURL??void 0,o=n.tenantId??void 0,l=n._redirectEventId??void 0,u=n.createdAt??void 0,h=n.lastLoginAt??void 0,{uid:f,emailVerified:p,isAnonymous:g,providerData:_,stsTokenManager:x}=n;ke(f&&x,e,"internal-error");const $=So.fromJSON(this.name,x);ke(typeof f=="string",e,"internal-error"),Vi(r,e.name),Vi(i,e.name),ke(typeof p=="boolean",e,"internal-error"),ke(typeof g=="boolean",e,"internal-error"),Vi(s,e.name),Vi(a,e.name),Vi(o,e.name),Vi(l,e.name),Vi(u,e.name),Vi(h,e.name);const w=new yr({uid:f,auth:e,email:i,emailVerified:p,displayName:r,isAnonymous:g,photoURL:a,phoneNumber:s,tenantId:o,stsTokenManager:$,createdAt:u,lastLoginAt:h});return _&&Array.isArray(_)&&(w.providerData=_.map(y=>({...y}))),l&&(w._redirectEventId=l),w}static async _fromIdTokenResponse(e,n,r=!1){const i=new So;i.updateFromServerResponse(n);const s=new yr({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await Xh(s),s}static async _fromGetAccountInfoResponse(e,n,r){const i=n.users[0];ke(i.localId!==void 0,"internal-error");const s=i.providerUserInfo!==void 0?rk(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!(s!=null&&s.length),o=new So;o.updateFromIdToken(r);const l=new yr({uid:i.localId,auth:e,stsTokenManager:o,isAnonymous:a}),u={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new uy(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(s!=null&&s.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o1=new Map;function gi(t){Ii(t instanceof Function,"Expected a class definition");let e=o1.get(t);return e?(Ii(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,o1.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ik{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}ik.type="NONE";const l1=ik;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fh(t,e,n){return`firebase:${t}:${e}:${n}`}class Co{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:i,name:s}=this.auth;this.fullUserKey=fh(this.userKey,i.apiKey,s),this.fullPersistenceKey=fh("persistence",i.apiKey,s),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await Jh(this.auth,{idToken:e}).catch(()=>{});return n?yr._fromGetAccountInfoResponse(this.auth,n,e):null}return yr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Co(gi(l1),e,r);const i=(await Promise.all(n.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let s=i[0]||gi(l1);const a=fh(r,e.config.apiKey,e.name);let o=null;for(const u of n)try{const h=await u._get(a);if(h){let f;if(typeof h=="string"){const p=await Jh(e,{idToken:h}).catch(()=>{});if(!p)break;f=await yr._fromGetAccountInfoResponse(e,p,h)}else f=yr._fromJSON(e,h);u!==s&&(o=f),s=u;break}}catch{}const l=i.filter(u=>u._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new Co(s,e,r):(s=l[0],o&&await s._set(a,o.toJSON()),await Promise.all(n.map(async u=>{if(u!==s)try{await u._remove(a)}catch{}})),new Co(s,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u1(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(lk(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(sk(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(ck(e))return"Blackberry";if(dk(e))return"Webos";if(ak(e))return"Safari";if((e.includes("chrome/")||ok(e))&&!e.includes("edge/"))return"Chrome";if(uk(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function sk(t=on()){return/firefox\//i.test(t)}function ak(t=on()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function ok(t=on()){return/crios\//i.test(t)}function lk(t=on()){return/iemobile/i.test(t)}function uk(t=on()){return/android/i.test(t)}function ck(t=on()){return/blackberry/i.test(t)}function dk(t=on()){return/webos/i.test(t)}function K_(t=on()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function YD(t=on()){var e;return K_(t)&&!!((e=window.navigator)!=null&&e.standalone)}function JD(){return dO()&&document.documentMode===10}function hk(t=on()){return K_(t)||uk(t)||dk(t)||ck(t)||/windows phone/i.test(t)||lk(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fk(t,e=[]){let n;switch(t){case"Browser":n=u1(on());break;case"Worker":n=`${u1(on())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Na}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XD{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=s=>new Promise((a,o)=>{try{const l=e(s);a(l)}catch(l){o(l)}});r.onAbort=n,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZD(t,e={}){return $s(t,"GET","/v2/passwordPolicy",Is(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eM=6;class tM{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??eM,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nM{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new c1(this),this.idTokenSubscription=new c1(this),this.beforeStateQueue=new XD(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=X$,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=gi(n)),this._initializationPromise=this.queue(async()=>{var r,i,s;if(!this._deleted&&(this.persistenceManager=await Co.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((i=this._popupRedirectResolver)!=null&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((s=this.currentUser)==null?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Jh(this,{idToken:e}),r=await yr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var s;if(Pn(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(o,o))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(s=this.redirectUser)==null?void 0:s._redirectEventId,o=r==null?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);(!a||a===o)&&(l!=null&&l.user)&&(r=l.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(a){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return ke(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Xh(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=OD()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Pn(this.app))return Promise.reject(_i(this));const n=e?Mt(e):null;return n&&ke(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&ke(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Pn(this.app)?Promise.reject(_i(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Pn(this.app)?Promise.reject(_i(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(gi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await ZD(this),n=new tM(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new wc("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await QD(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&gi(e)||this._popupRedirectResolver;ke(n,this,"argument-error"),this.redirectPersistenceManager=await Co.create(this,[gi(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};const s=typeof n=="function"?n:n.next.bind(n);let a=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(ke(o,this,"internal-error"),o.then(()=>{a||s(this.currentUser)}),typeof n=="function"){const l=e.addObserver(n,r,i);return()=>{a=!0,l()}}else{const l=e.addObserver(n);return()=>{a=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ke(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=fk(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var i;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((i=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:i.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(Pn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&RD(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Pa(t){return Mt(t)}class c1{constructor(e){this.auth=e,this.observer=null,this.addObserver=vO(n=>this.observer=n)}get next(){return ke(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function rM(t){Bf=t}function pk(t){return Bf.loadJS(t)}function iM(){return Bf.recaptchaEnterpriseScript}function sM(){return Bf.gapiScript}function aM(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class oM{constructor(){this.enterprise=new lM}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class lM{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const uM="recaptcha-enterprise",mk="NO_RECAPTCHA";class cM{constructor(e){this.type=uM,this.auth=Pa(e)}async verify(e="verify",n=!1){async function r(s){if(!n){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise(async(a,o)=>{UD(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)o(new Error("recaptcha Enterprise site key undefined"));else{const u=new jD(l);return s.tenantId==null?s._agentRecaptchaConfig=u:s._tenantRecaptchaConfigs[s.tenantId]=u,a(u.siteKey)}}).catch(l=>{o(l)})})}function i(s,a,o){const l=window.grecaptcha;s1(l)?l.enterprise.ready(()=>{l.enterprise.execute(s,{action:e}).then(u=>{a(u)}).catch(()=>{a(mk)})}):o(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new oM().execute("siteKey",{action:"verify"}):new Promise((s,a)=>{r(this.auth).then(o=>{if(!n&&s1(window.grecaptcha))i(o,s,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let l=iM();l.length!==0&&(l+=o),pk(l).then(()=>{i(o,s,a)}).catch(u=>{a(u)})}}).catch(o=>{a(o)})})}}async function d1(t,e,n,r=!1,i=!1){const s=new cM(t);let a;if(i)a=mk;else try{a=await s.verify(n)}catch{a=await s.verify(n,!0)}const o={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in o){const l=o.phoneEnrollmentInfo.phoneNumber,u=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const l=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return r?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function cy(t,e,n,r,i){var s;if((s=t._getRecaptchaConfig())!=null&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await d1(t,e,n,n==="getOobCode");return r(t,a)}else return r(t,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await d1(t,e,n,n==="getOobCode");return r(t,o)}else return Promise.reject(a)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dM(t,e){const n=Uf(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),s=n.getOptions();if(va(s,e??{}))return i;Ir(i,"already-initialized")}return n.initialize({options:e})}function hM(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(gi);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function fM(t,e,n){const r=Pa(t);ke(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,s=gk(e),{host:a,port:o}=pM(e),l=o===null?"":`:${o}`,u={url:`${s}//${a}${l}/`},h=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){ke(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),ke(va(u,r.config.emulator)&&va(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,Ra(a)?(j_(`${s}//${a}${l}`),U_("Auth",!0)):mM()}function gk(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function pM(t){const e=gk(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const s=i[1];return{host:s,port:h1(r.substr(s.length+1))}}else{const[s,a]=r.split(":");return{host:s,port:h1(a)}}}function h1(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function mM(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q_{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return mi("not implemented")}_getIdTokenResponse(e){return mi("not implemented")}_linkToIdToken(e,n){return mi("not implemented")}_getReauthenticationResolver(e){return mi("not implemented")}}async function gM(t,e){return $s(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yM(t,e){return Ec(t,"POST","/v1/accounts:signInWithPassword",Is(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _M(t,e){return Ec(t,"POST","/v1/accounts:signInWithEmailLink",Is(t,e))}async function vM(t,e){return Ec(t,"POST","/v1/accounts:signInWithEmailLink",Is(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ic extends Q_{constructor(e,n,r,i=null){super("password",r),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new ic(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new ic(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return cy(e,n,"signInWithPassword",yM);case"emailLink":return _M(e,{email:this._email,oobCode:this._password});default:Ir(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return cy(e,r,"signUpPassword",gM);case"emailLink":return vM(e,{idToken:n,email:this._email,oobCode:this._password});default:Ir(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ao(t,e){return Ec(t,"POST","/v1/accounts:signInWithIdp",Is(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wM="http://localhost";class ba extends Q_{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new ba(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Ir("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...s}=n;if(!r||!i)return null;const a=new ba(r,i);return a.idToken=s.idToken||void 0,a.accessToken=s.accessToken||void 0,a.secret=s.secret,a.nonce=s.nonce,a.pendingToken=s.pendingToken||null,a}_getIdTokenResponse(e){const n=this.buildRequest();return Ao(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Ao(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Ao(e,n)}buildRequest(){const e={requestUri:wM,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=bc(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bM(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function xM(t){const e=lu(uu(t)).link,n=e?lu(uu(e)).deep_link_id:null,r=lu(uu(t)).deep_link_id;return(r?lu(uu(r)).link:null)||r||n||e||t}class Y_{constructor(e){const n=lu(uu(e)),r=n.apiKey??null,i=n.oobCode??null,s=bM(n.mode??null);ke(r&&i&&s,"argument-error"),this.apiKey=r,this.operation=s,this.code=i,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=xM(e);try{return new Y_(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class el{constructor(){this.providerId=el.PROVIDER_ID}static credential(e,n){return ic._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=Y_.parseLink(n);return ke(r,"argument-error"),ic._fromEmailAndCode(e,r.code,r.tenantId)}}el.PROVIDER_ID="password";el.EMAIL_PASSWORD_SIGN_IN_METHOD="password";el.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yk{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tc extends yk{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gi extends Tc{constructor(){super("facebook.com")}static credential(e){return ba._fromParams({providerId:Gi.PROVIDER_ID,signInMethod:Gi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Gi.credentialFromTaggedObject(e)}static credentialFromError(e){return Gi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Gi.credential(e.oauthAccessToken)}catch{return null}}}Gi.FACEBOOK_SIGN_IN_METHOD="facebook.com";Gi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ki extends Tc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return ba._fromParams({providerId:Ki.PROVIDER_ID,signInMethod:Ki.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Ki.credentialFromTaggedObject(e)}static credentialFromError(e){return Ki.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Ki.credential(n,r)}catch{return null}}}Ki.GOOGLE_SIGN_IN_METHOD="google.com";Ki.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qi extends Tc{constructor(){super("github.com")}static credential(e){return ba._fromParams({providerId:Qi.PROVIDER_ID,signInMethod:Qi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Qi.credentialFromTaggedObject(e)}static credentialFromError(e){return Qi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Qi.credential(e.oauthAccessToken)}catch{return null}}}Qi.GITHUB_SIGN_IN_METHOD="github.com";Qi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yi extends Tc{constructor(){super("twitter.com")}static credential(e,n){return ba._fromParams({providerId:Yi.PROVIDER_ID,signInMethod:Yi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Yi.credentialFromTaggedObject(e)}static credentialFromError(e){return Yi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Yi.credential(n,r)}catch{return null}}}Yi.TWITTER_SIGN_IN_METHOD="twitter.com";Yi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EM(t,e){return Ec(t,"POST","/v1/accounts:signUp",Is(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,i=!1){const s=await yr._fromIdTokenResponse(e,r,i),a=f1(r);return new xa({user:s,providerId:a,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const i=f1(r);return new xa({user:e,providerId:i,_tokenResponse:r,operationType:n})}}function f1(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zh extends ei{constructor(e,n,r,i){super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,Zh.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new Zh(e,n,r,i)}}function _k(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Zh._fromErrorAndOperation(t,s,e,r):s})}async function TM(t,e,n=!1){const r=await rc(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return xa._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IM(t,e,n=!1){const{auth:r}=t;if(Pn(r.app))return Promise.reject(_i(r));const i="reauthenticate";try{const s=await rc(t,_k(r,i,e,t),n);ke(s.idToken,r,"internal-error");const a=G_(s.idToken);ke(a,r,"internal-error");const{sub:o}=a;return ke(t.uid===o,r,"user-mismatch"),xa._forOperation(t,i,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&Ir(r,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vk(t,e,n=!1){if(Pn(t.app))return Promise.reject(_i(t));const r="signIn",i=await _k(t,r,e),s=await xa._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(s.user),s}async function $M(t,e){return vk(Pa(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wk(t){const e=Pa(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function kM(t,e,n){if(Pn(t.app))return Promise.reject(_i(t));const r=Pa(t),a=await cy(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",EM).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&wk(t),l}),o=await xa._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(o.user),o}function SM(t,e,n){return Pn(t.app)?Promise.reject(_i(t)):$M(Mt(t),el.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&wk(t),r})}function CM(t,e,n,r){return Mt(t).onIdTokenChanged(e,n,r)}function AM(t,e,n){return Mt(t).beforeAuthStateChanged(e,n)}function RM(t,e,n,r){return Mt(t).onAuthStateChanged(e,n,r)}function NM(t){return Mt(t).signOut()}const ef="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bk{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(ef,"1"),this.storage.removeItem(ef),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PM=1e3,OM=10;class xk extends bk{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=hk(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),i=this.localCache[n];r!==i&&e(n,i,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((a,o,l)=>{this.notifyListeners(a,l)});return}const r=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const a=this.storage.getItem(r);!n&&this.localCache[r]===a||this.notifyListeners(r,a)},s=this.storage.getItem(r);JD()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,OM):i()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},PM)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}xk.type="LOCAL";const DM=xk;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ek extends bk{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}Ek.type="SESSION";const Tk=Ek;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MM(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ff{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const r=new Ff(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:i,data:s}=n.data,a=this.handlersMap[i];if(!(a!=null&&a.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const o=Array.from(a).map(async u=>u(n.origin,s)),l=await MM(o);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:l})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Ff.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J_(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LM{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,a;return new Promise((o,l)=>{const u=J_("",20);i.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);a={messageChannel:i,onMessage(f){const p=f;if(p.data.eventId===u)switch(p.data.status){case"ack":clearTimeout(h),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),o(p.data.response);break;default:clearTimeout(h),clearTimeout(s),l(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:u,data:n},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hr(){return window}function zM(t){Hr().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ik(){return typeof Hr().WorkerGlobalScope<"u"&&typeof Hr().importScripts=="function"}async function VM(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function jM(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function UM(){return Ik()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $k="firebaseLocalStorageDb",BM=1,tf="firebaseLocalStorage",kk="fbase_key";class Ic{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Wf(t,e){return t.transaction([tf],e?"readwrite":"readonly").objectStore(tf)}function FM(){const t=indexedDB.deleteDatabase($k);return new Ic(t).toPromise()}function dy(){const t=indexedDB.open($k,BM);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(tf,{keyPath:kk})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(tf)?e(r):(r.close(),await FM(),e(await dy()))})})}async function p1(t,e,n){const r=Wf(t,!0).put({[kk]:e,value:n});return new Ic(r).toPromise()}async function WM(t,e){const n=Wf(t,!1).get(e),r=await new Ic(n).toPromise();return r===void 0?null:r.value}function m1(t,e){const n=Wf(t,!0).delete(e);return new Ic(n).toPromise()}const qM=800,HM=3;class Sk{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await dy(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>HM)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ik()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ff._getInstance(UM()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await VM(),!this.activeServiceWorker)return;this.sender=new LM(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||jM()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await dy();return await p1(e,ef,"1"),await m1(e,ef),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>p1(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>WM(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>m1(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const s=Wf(i,!1).getAll();return new Ic(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:s}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),qM)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Sk.type="LOCAL";const GM=Sk;new xc(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KM(t,e){return e?gi(e):(ke(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X_ extends Q_{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ao(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Ao(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Ao(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function QM(t){return vk(t.auth,new X_(t),t.bypassAuthState)}function YM(t){const{auth:e,user:n}=t;return ke(n,e,"internal-error"),IM(n,new X_(t),t.bypassAuthState)}async function JM(t){const{auth:e,user:n}=t;return ke(n,e,"internal-error"),TM(n,new X_(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ck{constructor(e,n,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:i,tenantId:s,error:a,type:o}=e;if(a){this.reject(a);return}const l={auth:this.auth,requestUri:n,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return QM;case"linkViaPopup":case"linkViaRedirect":return JM;case"reauthViaPopup":case"reauthViaRedirect":return YM;default:Ir(this.auth,"internal-error")}}resolve(e){Ii(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ii(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XM=new xc(2e3,1e4);class vo extends Ck{constructor(e,n,r,i,s){super(e,n,i,s),this.provider=r,this.authWindow=null,this.pollId=null,vo.currentPopupAction&&vo.currentPopupAction.cancel(),vo.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ke(e,this.auth,"internal-error"),e}async onExecution(){Ii(this.filter.length===1,"Popup operations only handle one event");const e=J_();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(qr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(qr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,vo.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(qr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,XM.get())};e()}}vo.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZM="pendingRedirect",ph=new Map;class eL extends Ck{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=ph.get(this.auth._key());if(!e){try{const r=await tL(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}ph.set(this.auth._key(),e)}return this.bypassAuthState||ph.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function tL(t,e){const n=iL(e),r=rL(t);if(!await r._isAvailable())return!1;const i=await r._get(n)==="true";return await r._remove(n),i}function nL(t,e){ph.set(t._key(),e)}function rL(t){return gi(t._redirectPersistence)}function iL(t){return fh(ZM,t.config.apiKey,t.name)}async function sL(t,e,n=!1){if(Pn(t.app))return Promise.reject(_i(t));const r=Pa(t),i=KM(r,e),a=await new eL(r,i,n).execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aL=10*60*1e3;class oL{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!lL(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!Ak(e)){const i=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError(qr(this.auth,i))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=aL&&this.cachedEventUids.clear(),this.cachedEventUids.has(g1(e))}saveEventToCache(e){this.cachedEventUids.add(g1(e)),this.lastProcessedEventTime=Date.now()}}function g1(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function Ak({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function lL(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ak(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uL(t,e={}){return $s(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cL=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,dL=/^https?/;async function hL(t){if(t.config.emulator)return;const{authorizedDomains:e}=await uL(t);for(const n of e)try{if(fL(n))return}catch{}Ir(t,"unauthorized-domain")}function fL(t){const e=ly(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const a=new URL(t);return a.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&a.hostname===r}if(!dL.test(n))return!1;if(cL.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pL=new xc(3e4,6e4);function y1(){const t=Hr().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function mL(t){return new Promise((e,n)=>{var i,s,a;function r(){y1(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{y1(),n(qr(t,"network-request-failed"))},timeout:pL.get()})}if((s=(i=Hr().gapi)==null?void 0:i.iframes)!=null&&s.Iframe)e(gapi.iframes.getContext());else if((a=Hr().gapi)!=null&&a.load)r();else{const o=aM("iframefcb");return Hr()[o]=()=>{gapi.load?r():n(qr(t,"network-request-failed"))},pk(`${sM()}?onload=${o}`).catch(l=>n(l))}}).catch(e=>{throw mh=null,e})}let mh=null;function gL(t){return mh=mh||mL(t),mh}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yL=new xc(5e3,15e3),_L="__/auth/iframe",vL="emulator/auth/iframe",wL={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},bL=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function xL(t){const e=t.config;ke(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?H_(e,vL):`https://${t.config.authDomain}/${_L}`,r={apiKey:e.apiKey,appName:t.name,v:Na},i=bL.get(t.config.apiHost);i&&(r.eid=i);const s=t._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${bc(r).slice(1)}`}async function EL(t){const e=await gL(t),n=Hr().gapi;return ke(n,t,"internal-error"),e.open({where:document.body,url:xL(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:wL,dontclear:!0},r=>new Promise(async(i,s)=>{await r.restyle({setHideOnLeave:!1});const a=qr(t,"network-request-failed"),o=Hr().setTimeout(()=>{s(a)},yL.get());function l(){Hr().clearTimeout(o),i(r)}r.ping(l).then(l,()=>{s(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TL={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},IL=500,$L=600,kL="_blank",SL="http://localhost";class _1{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function CL(t,e,n,r=IL,i=$L){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const l={...TL,width:r.toString(),height:i.toString(),top:s,left:a},u=on().toLowerCase();n&&(o=ok(u)?kL:n),sk(u)&&(e=e||SL,l.scrollbars="yes");const h=Object.entries(l).reduce((p,[g,_])=>`${p}${g}=${_},`,"");if(YD(u)&&o!=="_self")return AL(e||"",o),new _1(null);const f=window.open(e||"",o,h);ke(f,t,"popup-blocked");try{f.focus()}catch{}return new _1(f)}function AL(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RL="__/auth/handler",NL="emulator/auth/handler",PL=encodeURIComponent("fac");async function v1(t,e,n,r,i,s){ke(t.config.authDomain,t,"auth-domain-config-required"),ke(t.config.apiKey,t,"invalid-api-key");const a={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Na,eventId:i};if(e instanceof yk){e.setDefaultLanguage(t.languageCode),a.providerId=e.providerId||"",_O(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries({}))a[h]=f}if(e instanceof Tc){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(a.scopes=h.join(","))}t.tenantId&&(a.tid=t.tenantId);const o=a;for(const h of Object.keys(o))o[h]===void 0&&delete o[h];const l=await t._getAppCheckToken(),u=l?`#${PL}=${encodeURIComponent(l)}`:"";return`${OL(t)}?${bc(o).slice(1)}${u}`}function OL({config:t}){return t.emulator?H_(t,NL):`https://${t.authDomain}/${RL}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rm="webStorageSupport";class DL{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Tk,this._completeRedirectFn=sL,this._overrideRedirectResult=nL}async _openPopup(e,n,r,i){var a;Ii((a=this.eventManagers[e._key()])==null?void 0:a.manager,"_initialize() not called before _openPopup()");const s=await v1(e,n,r,ly(),i);return CL(e,s,J_())}async _openRedirect(e,n,r,i){await this._originValidation(e);const s=await v1(e,n,r,ly(),i);return zM(s),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:s}=this.eventManagers[n];return i?Promise.resolve(i):(Ii(s,"If manager is not set, promise should be"),s)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await EL(e),r=new oL(e);return n.register("authEvent",i=>(ke(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(rm,{type:rm},i=>{var a;const s=(a=i==null?void 0:i[0])==null?void 0:a[rm];s!==void 0&&n(!!s),Ir(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=hL(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return hk()||ak()||K_()}}const ML=DL;var w1="@firebase/auth",b1="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LL{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){ke(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zL(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function VL(t){wa(new ps("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=r.options;ke(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:a,authDomain:o,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:fk(t)},u=new nM(r,i,s,l);return hM(u,n),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),wa(new ps("auth-internal",e=>{const n=Pa(e.getProvider("auth").getImmediate());return(r=>new LL(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Wr(w1,b1,zL(t)),Wr(w1,b1,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jL=5*60,UL=W$("authIdTokenMaxAge")||jL;let x1=null;const BL=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>UL)return;const i=n==null?void 0:n.token;x1!==i&&(x1=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function FL(t=W_()){const e=Uf(t,"auth");if(e.isInitialized())return e.getImmediate();const n=dM(t,{popupRedirectResolver:ML,persistence:[GM,DM,Tk]}),r=W$("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(r,location.origin);if(location.origin===s.origin){const a=BL(s.toString());AM(n,a,()=>a(n.currentUser)),CM(n,o=>a(o))}}const i=U$("auth");return i&&fM(n,`http://${i}`),n}function WL(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}rM({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const s=qr("internal-error");s.customData=i,n(s)},r.type="text/javascript",r.charset="UTF-8",WL().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});VL("Browser");var qL="firebase",HL="12.8.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Wr(qL,HL,"app");var E1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var cs,Rk;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(C,k){function P(){}P.prototype=k.prototype,C.F=k.prototype,C.prototype=new P,C.prototype.constructor=C,C.D=function(A,D,z){for(var O=Array(arguments.length-2),ce=2;ce<arguments.length;ce++)O[ce-2]=arguments[ce];return k.prototype[D].apply(A,O)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(C,k,P){P||(P=0);const A=Array(16);if(typeof k=="string")for(var D=0;D<16;++D)A[D]=k.charCodeAt(P++)|k.charCodeAt(P++)<<8|k.charCodeAt(P++)<<16|k.charCodeAt(P++)<<24;else for(D=0;D<16;++D)A[D]=k[P++]|k[P++]<<8|k[P++]<<16|k[P++]<<24;k=C.g[0],P=C.g[1],D=C.g[2];let z=C.g[3],O;O=k+(z^P&(D^z))+A[0]+3614090360&4294967295,k=P+(O<<7&4294967295|O>>>25),O=z+(D^k&(P^D))+A[1]+3905402710&4294967295,z=k+(O<<12&4294967295|O>>>20),O=D+(P^z&(k^P))+A[2]+606105819&4294967295,D=z+(O<<17&4294967295|O>>>15),O=P+(k^D&(z^k))+A[3]+3250441966&4294967295,P=D+(O<<22&4294967295|O>>>10),O=k+(z^P&(D^z))+A[4]+4118548399&4294967295,k=P+(O<<7&4294967295|O>>>25),O=z+(D^k&(P^D))+A[5]+1200080426&4294967295,z=k+(O<<12&4294967295|O>>>20),O=D+(P^z&(k^P))+A[6]+2821735955&4294967295,D=z+(O<<17&4294967295|O>>>15),O=P+(k^D&(z^k))+A[7]+4249261313&4294967295,P=D+(O<<22&4294967295|O>>>10),O=k+(z^P&(D^z))+A[8]+1770035416&4294967295,k=P+(O<<7&4294967295|O>>>25),O=z+(D^k&(P^D))+A[9]+2336552879&4294967295,z=k+(O<<12&4294967295|O>>>20),O=D+(P^z&(k^P))+A[10]+4294925233&4294967295,D=z+(O<<17&4294967295|O>>>15),O=P+(k^D&(z^k))+A[11]+2304563134&4294967295,P=D+(O<<22&4294967295|O>>>10),O=k+(z^P&(D^z))+A[12]+1804603682&4294967295,k=P+(O<<7&4294967295|O>>>25),O=z+(D^k&(P^D))+A[13]+4254626195&4294967295,z=k+(O<<12&4294967295|O>>>20),O=D+(P^z&(k^P))+A[14]+2792965006&4294967295,D=z+(O<<17&4294967295|O>>>15),O=P+(k^D&(z^k))+A[15]+1236535329&4294967295,P=D+(O<<22&4294967295|O>>>10),O=k+(D^z&(P^D))+A[1]+4129170786&4294967295,k=P+(O<<5&4294967295|O>>>27),O=z+(P^D&(k^P))+A[6]+3225465664&4294967295,z=k+(O<<9&4294967295|O>>>23),O=D+(k^P&(z^k))+A[11]+643717713&4294967295,D=z+(O<<14&4294967295|O>>>18),O=P+(z^k&(D^z))+A[0]+3921069994&4294967295,P=D+(O<<20&4294967295|O>>>12),O=k+(D^z&(P^D))+A[5]+3593408605&4294967295,k=P+(O<<5&4294967295|O>>>27),O=z+(P^D&(k^P))+A[10]+38016083&4294967295,z=k+(O<<9&4294967295|O>>>23),O=D+(k^P&(z^k))+A[15]+3634488961&4294967295,D=z+(O<<14&4294967295|O>>>18),O=P+(z^k&(D^z))+A[4]+3889429448&4294967295,P=D+(O<<20&4294967295|O>>>12),O=k+(D^z&(P^D))+A[9]+568446438&4294967295,k=P+(O<<5&4294967295|O>>>27),O=z+(P^D&(k^P))+A[14]+3275163606&4294967295,z=k+(O<<9&4294967295|O>>>23),O=D+(k^P&(z^k))+A[3]+4107603335&4294967295,D=z+(O<<14&4294967295|O>>>18),O=P+(z^k&(D^z))+A[8]+1163531501&4294967295,P=D+(O<<20&4294967295|O>>>12),O=k+(D^z&(P^D))+A[13]+2850285829&4294967295,k=P+(O<<5&4294967295|O>>>27),O=z+(P^D&(k^P))+A[2]+4243563512&4294967295,z=k+(O<<9&4294967295|O>>>23),O=D+(k^P&(z^k))+A[7]+1735328473&4294967295,D=z+(O<<14&4294967295|O>>>18),O=P+(z^k&(D^z))+A[12]+2368359562&4294967295,P=D+(O<<20&4294967295|O>>>12),O=k+(P^D^z)+A[5]+4294588738&4294967295,k=P+(O<<4&4294967295|O>>>28),O=z+(k^P^D)+A[8]+2272392833&4294967295,z=k+(O<<11&4294967295|O>>>21),O=D+(z^k^P)+A[11]+1839030562&4294967295,D=z+(O<<16&4294967295|O>>>16),O=P+(D^z^k)+A[14]+4259657740&4294967295,P=D+(O<<23&4294967295|O>>>9),O=k+(P^D^z)+A[1]+2763975236&4294967295,k=P+(O<<4&4294967295|O>>>28),O=z+(k^P^D)+A[4]+1272893353&4294967295,z=k+(O<<11&4294967295|O>>>21),O=D+(z^k^P)+A[7]+4139469664&4294967295,D=z+(O<<16&4294967295|O>>>16),O=P+(D^z^k)+A[10]+3200236656&4294967295,P=D+(O<<23&4294967295|O>>>9),O=k+(P^D^z)+A[13]+681279174&4294967295,k=P+(O<<4&4294967295|O>>>28),O=z+(k^P^D)+A[0]+3936430074&4294967295,z=k+(O<<11&4294967295|O>>>21),O=D+(z^k^P)+A[3]+3572445317&4294967295,D=z+(O<<16&4294967295|O>>>16),O=P+(D^z^k)+A[6]+76029189&4294967295,P=D+(O<<23&4294967295|O>>>9),O=k+(P^D^z)+A[9]+3654602809&4294967295,k=P+(O<<4&4294967295|O>>>28),O=z+(k^P^D)+A[12]+3873151461&4294967295,z=k+(O<<11&4294967295|O>>>21),O=D+(z^k^P)+A[15]+530742520&4294967295,D=z+(O<<16&4294967295|O>>>16),O=P+(D^z^k)+A[2]+3299628645&4294967295,P=D+(O<<23&4294967295|O>>>9),O=k+(D^(P|~z))+A[0]+4096336452&4294967295,k=P+(O<<6&4294967295|O>>>26),O=z+(P^(k|~D))+A[7]+1126891415&4294967295,z=k+(O<<10&4294967295|O>>>22),O=D+(k^(z|~P))+A[14]+2878612391&4294967295,D=z+(O<<15&4294967295|O>>>17),O=P+(z^(D|~k))+A[5]+4237533241&4294967295,P=D+(O<<21&4294967295|O>>>11),O=k+(D^(P|~z))+A[12]+1700485571&4294967295,k=P+(O<<6&4294967295|O>>>26),O=z+(P^(k|~D))+A[3]+2399980690&4294967295,z=k+(O<<10&4294967295|O>>>22),O=D+(k^(z|~P))+A[10]+4293915773&4294967295,D=z+(O<<15&4294967295|O>>>17),O=P+(z^(D|~k))+A[1]+2240044497&4294967295,P=D+(O<<21&4294967295|O>>>11),O=k+(D^(P|~z))+A[8]+1873313359&4294967295,k=P+(O<<6&4294967295|O>>>26),O=z+(P^(k|~D))+A[15]+4264355552&4294967295,z=k+(O<<10&4294967295|O>>>22),O=D+(k^(z|~P))+A[6]+2734768916&4294967295,D=z+(O<<15&4294967295|O>>>17),O=P+(z^(D|~k))+A[13]+1309151649&4294967295,P=D+(O<<21&4294967295|O>>>11),O=k+(D^(P|~z))+A[4]+4149444226&4294967295,k=P+(O<<6&4294967295|O>>>26),O=z+(P^(k|~D))+A[11]+3174756917&4294967295,z=k+(O<<10&4294967295|O>>>22),O=D+(k^(z|~P))+A[2]+718787259&4294967295,D=z+(O<<15&4294967295|O>>>17),O=P+(z^(D|~k))+A[9]+3951481745&4294967295,C.g[0]=C.g[0]+k&4294967295,C.g[1]=C.g[1]+(D+(O<<21&4294967295|O>>>11))&4294967295,C.g[2]=C.g[2]+D&4294967295,C.g[3]=C.g[3]+z&4294967295}r.prototype.v=function(C,k){k===void 0&&(k=C.length);const P=k-this.blockSize,A=this.C;let D=this.h,z=0;for(;z<k;){if(D==0)for(;z<=P;)i(this,C,z),z+=this.blockSize;if(typeof C=="string"){for(;z<k;)if(A[D++]=C.charCodeAt(z++),D==this.blockSize){i(this,A),D=0;break}}else for(;z<k;)if(A[D++]=C[z++],D==this.blockSize){i(this,A),D=0;break}}this.h=D,this.o+=k},r.prototype.A=function(){var C=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);C[0]=128;for(var k=1;k<C.length-8;++k)C[k]=0;k=this.o*8;for(var P=C.length-8;P<C.length;++P)C[P]=k&255,k/=256;for(this.v(C),C=Array(16),k=0,P=0;P<4;++P)for(let A=0;A<32;A+=8)C[k++]=this.g[P]>>>A&255;return C};function s(C,k){var P=o;return Object.prototype.hasOwnProperty.call(P,C)?P[C]:P[C]=k(C)}function a(C,k){this.h=k;const P=[];let A=!0;for(let D=C.length-1;D>=0;D--){const z=C[D]|0;A&&z==k||(P[D]=z,A=!1)}this.g=P}var o={};function l(C){return-128<=C&&C<128?s(C,function(k){return new a([k|0],k<0?-1:0)}):new a([C|0],C<0?-1:0)}function u(C){if(isNaN(C)||!isFinite(C))return f;if(C<0)return $(u(-C));const k=[];let P=1;for(let A=0;C>=P;A++)k[A]=C/P|0,P*=4294967296;return new a(k,0)}function h(C,k){if(C.length==0)throw Error("number format error: empty string");if(k=k||10,k<2||36<k)throw Error("radix out of range: "+k);if(C.charAt(0)=="-")return $(h(C.substring(1),k));if(C.indexOf("-")>=0)throw Error('number format error: interior "-" character');const P=u(Math.pow(k,8));let A=f;for(let z=0;z<C.length;z+=8){var D=Math.min(8,C.length-z);const O=parseInt(C.substring(z,z+D),k);D<8?(D=u(Math.pow(k,D)),A=A.j(D).add(u(O))):(A=A.j(P),A=A.add(u(O)))}return A}var f=l(0),p=l(1),g=l(16777216);t=a.prototype,t.m=function(){if(x(this))return-$(this).m();let C=0,k=1;for(let P=0;P<this.g.length;P++){const A=this.i(P);C+=(A>=0?A:4294967296+A)*k,k*=4294967296}return C},t.toString=function(C){if(C=C||10,C<2||36<C)throw Error("radix out of range: "+C);if(_(this))return"0";if(x(this))return"-"+$(this).toString(C);const k=u(Math.pow(C,6));var P=this;let A="";for(;;){const D=R(P,k).g;P=w(P,D.j(k));let z=((P.g.length>0?P.g[0]:P.h)>>>0).toString(C);if(P=D,_(P))return z+A;for(;z.length<6;)z="0"+z;A=z+A}},t.i=function(C){return C<0?0:C<this.g.length?this.g[C]:this.h};function _(C){if(C.h!=0)return!1;for(let k=0;k<C.g.length;k++)if(C.g[k]!=0)return!1;return!0}function x(C){return C.h==-1}t.l=function(C){return C=w(this,C),x(C)?-1:_(C)?0:1};function $(C){const k=C.g.length,P=[];for(let A=0;A<k;A++)P[A]=~C.g[A];return new a(P,~C.h).add(p)}t.abs=function(){return x(this)?$(this):this},t.add=function(C){const k=Math.max(this.g.length,C.g.length),P=[];let A=0;for(let D=0;D<=k;D++){let z=A+(this.i(D)&65535)+(C.i(D)&65535),O=(z>>>16)+(this.i(D)>>>16)+(C.i(D)>>>16);A=O>>>16,z&=65535,O&=65535,P[D]=O<<16|z}return new a(P,P[P.length-1]&-2147483648?-1:0)};function w(C,k){return C.add($(k))}t.j=function(C){if(_(this)||_(C))return f;if(x(this))return x(C)?$(this).j($(C)):$($(this).j(C));if(x(C))return $(this.j($(C)));if(this.l(g)<0&&C.l(g)<0)return u(this.m()*C.m());const k=this.g.length+C.g.length,P=[];for(var A=0;A<2*k;A++)P[A]=0;for(A=0;A<this.g.length;A++)for(let D=0;D<C.g.length;D++){const z=this.i(A)>>>16,O=this.i(A)&65535,ce=C.i(D)>>>16,de=C.i(D)&65535;P[2*A+2*D]+=O*de,y(P,2*A+2*D),P[2*A+2*D+1]+=z*de,y(P,2*A+2*D+1),P[2*A+2*D+1]+=O*ce,y(P,2*A+2*D+1),P[2*A+2*D+2]+=z*ce,y(P,2*A+2*D+2)}for(C=0;C<k;C++)P[C]=P[2*C+1]<<16|P[2*C];for(C=k;C<2*k;C++)P[C]=0;return new a(P,0)};function y(C,k){for(;(C[k]&65535)!=C[k];)C[k+1]+=C[k]>>>16,C[k]&=65535,k++}function I(C,k){this.g=C,this.h=k}function R(C,k){if(_(k))throw Error("division by zero");if(_(C))return new I(f,f);if(x(C))return k=R($(C),k),new I($(k.g),$(k.h));if(x(k))return k=R(C,$(k)),new I($(k.g),k.h);if(C.g.length>30){if(x(C)||x(k))throw Error("slowDivide_ only works with positive integers.");for(var P=p,A=k;A.l(C)<=0;)P=M(P),A=M(A);var D=j(P,1),z=j(A,1);for(A=j(A,2),P=j(P,2);!_(A);){var O=z.add(A);O.l(C)<=0&&(D=D.add(P),z=O),A=j(A,1),P=j(P,1)}return k=w(C,D.j(k)),new I(D,k)}for(D=f;C.l(k)>=0;){for(P=Math.max(1,Math.floor(C.m()/k.m())),A=Math.ceil(Math.log(P)/Math.LN2),A=A<=48?1:Math.pow(2,A-48),z=u(P),O=z.j(k);x(O)||O.l(C)>0;)P-=A,z=u(P),O=z.j(k);_(z)&&(z=p),D=D.add(z),C=w(C,O)}return new I(D,C)}t.B=function(C){return R(this,C).h},t.and=function(C){const k=Math.max(this.g.length,C.g.length),P=[];for(let A=0;A<k;A++)P[A]=this.i(A)&C.i(A);return new a(P,this.h&C.h)},t.or=function(C){const k=Math.max(this.g.length,C.g.length),P=[];for(let A=0;A<k;A++)P[A]=this.i(A)|C.i(A);return new a(P,this.h|C.h)},t.xor=function(C){const k=Math.max(this.g.length,C.g.length),P=[];for(let A=0;A<k;A++)P[A]=this.i(A)^C.i(A);return new a(P,this.h^C.h)};function M(C){const k=C.g.length+1,P=[];for(let A=0;A<k;A++)P[A]=C.i(A)<<1|C.i(A-1)>>>31;return new a(P,C.h)}function j(C,k){const P=k>>5;k%=32;const A=C.g.length-P,D=[];for(let z=0;z<A;z++)D[z]=k>0?C.i(z+P)>>>k|C.i(z+P+1)<<32-k:C.i(z+P);return new a(D,C.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,Rk=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=u,a.fromString=h,cs=a}).apply(typeof E1<"u"?E1:typeof self<"u"?self:typeof window<"u"?window:{});var Rd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Nk,cu,Pk,gh,hy,Ok,Dk,Mk;(function(){var t,e=Object.defineProperty;function n(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof Rd=="object"&&Rd];for(var v=0;v<c.length;++v){var S=c[v];if(S&&S.Math==Math)return S}throw Error("Cannot find global object")}var r=n(this);function i(c,v){if(v)e:{var S=r;c=c.split(".");for(var L=0;L<c.length-1;L++){var H=c[L];if(!(H in S))break e;S=S[H]}c=c[c.length-1],L=S[c],v=v(L),v!=L&&v!=null&&e(S,c,{configurable:!0,writable:!0,value:v})}}i("Symbol.dispose",function(c){return c||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(c){return c||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(c){return c||function(v){var S=[],L;for(L in v)Object.prototype.hasOwnProperty.call(v,L)&&S.push([L,v[L]]);return S}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var s=s||{},a=this||self;function o(c){var v=typeof c;return v=="object"&&c!=null||v=="function"}function l(c,v,S){return c.call.apply(c.bind,arguments)}function u(c,v,S){return u=l,u.apply(null,arguments)}function h(c,v){var S=Array.prototype.slice.call(arguments,1);return function(){var L=S.slice();return L.push.apply(L,arguments),c.apply(this,L)}}function f(c,v){function S(){}S.prototype=v.prototype,c.Z=v.prototype,c.prototype=new S,c.prototype.constructor=c,c.Ob=function(L,H,Z){for(var he=Array(arguments.length-2),Oe=2;Oe<arguments.length;Oe++)he[Oe-2]=arguments[Oe];return v.prototype[H].apply(L,he)}}var p=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?c=>c&&AsyncContext.Snapshot.wrap(c):c=>c;function g(c){const v=c.length;if(v>0){const S=Array(v);for(let L=0;L<v;L++)S[L]=c[L];return S}return[]}function _(c,v){for(let L=1;L<arguments.length;L++){const H=arguments[L];var S=typeof H;if(S=S!="object"?S:H?Array.isArray(H)?"array":S:"null",S=="array"||S=="object"&&typeof H.length=="number"){S=c.length||0;const Z=H.length||0;c.length=S+Z;for(let he=0;he<Z;he++)c[S+he]=H[he]}else c.push(H)}}class x{constructor(v,S){this.i=v,this.j=S,this.h=0,this.g=null}get(){let v;return this.h>0?(this.h--,v=this.g,this.g=v.next,v.next=null):v=this.i(),v}}function $(c){a.setTimeout(()=>{throw c},0)}function w(){var c=C;let v=null;return c.g&&(v=c.g,c.g=c.g.next,c.g||(c.h=null),v.next=null),v}class y{constructor(){this.h=this.g=null}add(v,S){const L=I.get();L.set(v,S),this.h?this.h.next=L:this.g=L,this.h=L}}var I=new x(()=>new R,c=>c.reset());class R{constructor(){this.next=this.g=this.h=null}set(v,S){this.h=v,this.g=S,this.next=null}reset(){this.next=this.g=this.h=null}}let M,j=!1,C=new y,k=()=>{const c=Promise.resolve(void 0);M=()=>{c.then(P)}};function P(){for(var c;c=w();){try{c.h.call(c.g)}catch(S){$(S)}var v=I;v.j(c),v.h<100&&(v.h++,c.next=v.g,v.g=c)}j=!1}function A(){this.u=this.u,this.C=this.C}A.prototype.u=!1,A.prototype.dispose=function(){this.u||(this.u=!0,this.N())},A.prototype[Symbol.dispose]=function(){this.dispose()},A.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function D(c,v){this.type=c,this.g=this.target=v,this.defaultPrevented=!1}D.prototype.h=function(){this.defaultPrevented=!0};var z=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var c=!1,v=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const S=()=>{};a.addEventListener("test",S,v),a.removeEventListener("test",S,v)}catch{}return c}();function O(c){return/^[\s\xa0]*$/.test(c)}function ce(c,v){D.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c&&this.init(c,v)}f(ce,D),ce.prototype.init=function(c,v){const S=this.type=c.type,L=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;this.target=c.target||c.srcElement,this.g=v,v=c.relatedTarget,v||(S=="mouseover"?v=c.fromElement:S=="mouseout"&&(v=c.toElement)),this.relatedTarget=v,L?(this.clientX=L.clientX!==void 0?L.clientX:L.pageX,this.clientY=L.clientY!==void 0?L.clientY:L.pageY,this.screenX=L.screenX||0,this.screenY=L.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=c.pointerType,this.state=c.state,this.i=c,c.defaultPrevented&&ce.Z.h.call(this)},ce.prototype.h=function(){ce.Z.h.call(this);const c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var de="closure_listenable_"+(Math.random()*1e6|0),ue=0;function pe(c,v,S,L,H){this.listener=c,this.proxy=null,this.src=v,this.type=S,this.capture=!!L,this.ha=H,this.key=++ue,this.da=this.fa=!1}function K(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function B(c,v,S){for(const L in c)v.call(S,c[L],L,c)}function F(c,v){for(const S in c)v.call(void 0,c[S],S,c)}function U(c){const v={};for(const S in c)v[S]=c[S];return v}const G="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function q(c,v){let S,L;for(let H=1;H<arguments.length;H++){L=arguments[H];for(S in L)c[S]=L[S];for(let Z=0;Z<G.length;Z++)S=G[Z],Object.prototype.hasOwnProperty.call(L,S)&&(c[S]=L[S])}}function Y(c){this.src=c,this.g={},this.h=0}Y.prototype.add=function(c,v,S,L,H){const Z=c.toString();c=this.g[Z],c||(c=this.g[Z]=[],this.h++);const he=Ee(c,v,L,H);return he>-1?(v=c[he],S||(v.fa=!1)):(v=new pe(v,this.src,Z,!!L,H),v.fa=S,c.push(v)),v};function ae(c,v){const S=v.type;if(S in c.g){var L=c.g[S],H=Array.prototype.indexOf.call(L,v,void 0),Z;(Z=H>=0)&&Array.prototype.splice.call(L,H,1),Z&&(K(v),c.g[S].length==0&&(delete c.g[S],c.h--))}}function Ee(c,v,S,L){for(let H=0;H<c.length;++H){const Z=c[H];if(!Z.da&&Z.listener==v&&Z.capture==!!S&&Z.ha==L)return H}return-1}var Q="closure_lm_"+(Math.random()*1e6|0),be={};function rt(c,v,S,L,H){if(Array.isArray(v)){for(let Z=0;Z<v.length;Z++)rt(c,v[Z],S,L,H);return null}return S=Zn(S),c&&c[de]?c.J(v,S,o(L)?!!L.capture:!1,H):et(c,v,S,!1,L,H)}function et(c,v,S,L,H,Z){if(!v)throw Error("Invalid event type");const he=o(H)?!!H.capture:!!H;let Oe=Xn(c);if(Oe||(c[Q]=Oe=new Y(c)),S=Oe.add(v,S,L,he,Z),S.proxy)return S;if(L=vt(),S.proxy=L,L.src=c,L.listener=S,c.addEventListener)z||(H=he),H===void 0&&(H=!1),c.addEventListener(v.toString(),L,H);else if(c.attachEvent)c.attachEvent(Yt(v.toString()),L);else if(c.addListener&&c.removeListener)c.addListener(L);else throw Error("addEventListener and attachEvent are unavailable.");return S}function vt(){function c(S){return v.call(c.src,c.listener,S)}const v=ni;return c}function je(c,v,S,L,H){if(Array.isArray(v))for(var Z=0;Z<v.length;Z++)je(c,v[Z],S,L,H);else L=o(L)?!!L.capture:!!L,S=Zn(S),c&&c[de]?(c=c.i,Z=String(v).toString(),Z in c.g&&(v=c.g[Z],S=Ee(v,S,L,H),S>-1&&(K(v[S]),Array.prototype.splice.call(v,S,1),v.length==0&&(delete c.g[Z],c.h--)))):c&&(c=Xn(c))&&(v=c.g[v.toString()],c=-1,v&&(c=Ee(v,S,L,H)),(S=c>-1?v[c]:null)&&Xe(S))}function Xe(c){if(typeof c!="number"&&c&&!c.da){var v=c.src;if(v&&v[de])ae(v.i,c);else{var S=c.type,L=c.proxy;v.removeEventListener?v.removeEventListener(S,L,c.capture):v.detachEvent?v.detachEvent(Yt(S),L):v.addListener&&v.removeListener&&v.removeListener(L),(S=Xn(v))?(ae(S,c),S.h==0&&(S.src=null,v[Q]=null)):K(c)}}}function Yt(c){return c in be?be[c]:be[c]="on"+c}function ni(c,v){if(c.da)c=!0;else{v=new ce(v,this);const S=c.listener,L=c.ha||c.src;c.fa&&Xe(c),c=S.call(L,v)}return c}function Xn(c){return c=c[Q],c instanceof Y?c:null}var Va="__closure_events_fn_"+(Math.random()*1e9>>>0);function Zn(c){return typeof c=="function"?c:(c[Va]||(c[Va]=function(v){return c.handleEvent(v)}),c[Va])}function At(){A.call(this),this.i=new Y(this),this.M=this,this.G=null}f(At,A),At.prototype[de]=!0,At.prototype.removeEventListener=function(c,v,S,L){je(this,c,v,S,L)};function Rt(c,v){var S,L=c.G;if(L)for(S=[];L;L=L.G)S.push(L);if(c=c.M,L=v.type||v,typeof v=="string")v=new D(v,c);else if(v instanceof D)v.target=v.target||c;else{var H=v;v=new D(L,c),q(v,H)}H=!0;let Z,he;if(S)for(he=S.length-1;he>=0;he--)Z=v.g=S[he],H=As(Z,L,!0,v)&&H;if(Z=v.g=c,H=As(Z,L,!0,v)&&H,H=As(Z,L,!1,v)&&H,S)for(he=0;he<S.length;he++)Z=v.g=S[he],H=As(Z,L,!1,v)&&H}At.prototype.N=function(){if(At.Z.N.call(this),this.i){var c=this.i;for(const v in c.g){const S=c.g[v];for(let L=0;L<S.length;L++)K(S[L]);delete c.g[v],c.h--}}this.G=null},At.prototype.J=function(c,v,S,L){return this.i.add(String(c),v,!1,S,L)},At.prototype.K=function(c,v,S,L){return this.i.add(String(c),v,!0,S,L)};function As(c,v,S,L){if(v=c.i.g[String(v)],!v)return!0;v=v.concat();let H=!0;for(let Z=0;Z<v.length;++Z){const he=v[Z];if(he&&!he.da&&he.capture==S){const Oe=he.listener,wt=he.ha||he.src;he.fa&&ae(c.i,he),H=Oe.call(wt,L)!==!1&&H}}return H&&!L.defaultPrevented}function ul(c,v){if(typeof c!="function")if(c&&typeof c.handleEvent=="function")c=u(c.handleEvent,c);else throw Error("Invalid listener argument");return Number(v)>2147483647?-1:a.setTimeout(c,v||0)}function cl(c){c.g=ul(()=>{c.g=null,c.i&&(c.i=!1,cl(c))},c.l);const v=c.h;c.h=null,c.m.apply(null,v)}class kr extends A{constructor(v,S){super(),this.m=v,this.l=S,this.h=null,this.i=!1,this.g=null}j(v){this.h=arguments,this.g?this.i=!0:cl(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ge(c){A.call(this),this.h=c,this.g={}}f(Ge,A);var ja=[];function dl(c){B(c.g,function(v,S){this.g.hasOwnProperty(S)&&Xe(v)},c),c.g={}}Ge.prototype.N=function(){Ge.Z.N.call(this),dl(this)},Ge.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Rs=a.JSON.stringify,Sr=a.JSON.parse,Ns=class{stringify(c){return a.JSON.stringify(c,void 0)}parse(c){return a.JSON.parse(c,void 0)}};function hl(){}function Cr(){}var Ri={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Ua(){D.call(this,"d")}f(Ua,D);function Ba(){D.call(this,"c")}f(Ba,D);var Ar={},Nc=null;function Fa(){return Nc=Nc||new At}Ar.Ia="serverreachability";function Pc(c){D.call(this,Ar.Ia,c)}f(Pc,D);function Ps(c){const v=Fa();Rt(v,new Pc(v))}Ar.STAT_EVENT="statevent";function fl(c,v){D.call(this,Ar.STAT_EVENT,c),this.stat=v}f(fl,D);function Lt(c){const v=Fa();Rt(v,new fl(v,c))}Ar.Ja="timingevent";function pl(c,v){D.call(this,Ar.Ja,c),this.size=v}f(pl,D);function Ni(c,v){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){c()},v)}function tt(){this.g=!0}tt.prototype.ua=function(){this.g=!1};function Oc(c,v,S,L,H,Z){c.info(function(){if(c.g)if(Z){var he="",Oe=Z.split("&");for(let Ye=0;Ye<Oe.length;Ye++){var wt=Oe[Ye].split("=");if(wt.length>1){const Tt=wt[0];wt=wt[1];const Bn=Tt.split("_");he=Bn.length>=2&&Bn[1]=="type"?he+(Tt+"="+wt+"&"):he+(Tt+"=redacted&")}}}else he=null;else he=Z;return"XMLHTTP REQ ("+L+") [attempt "+H+"]: "+v+`
`+S+`
`+he})}function Dc(c,v,S,L,H,Z,he){c.info(function(){return"XMLHTTP RESP ("+L+") [ attempt "+H+"]: "+v+`
`+S+`
`+Z+" "+he})}function ri(c,v,S,L){c.info(function(){return"XMLHTTP TEXT ("+v+"): "+Lc(c,S)+(L?" "+L:"")})}function Mc(c,v){c.info(function(){return"TIMEOUT: "+v})}tt.prototype.info=function(){};function Lc(c,v){if(!c.g)return v;if(!v)return null;try{const Z=JSON.parse(v);if(Z){for(c=0;c<Z.length;c++)if(Array.isArray(Z[c])){var S=Z[c];if(!(S.length<2)){var L=S[1];if(Array.isArray(L)&&!(L.length<1)){var H=L[0];if(H!="noop"&&H!="stop"&&H!="close")for(let he=1;he<L.length;he++)L[he]=""}}}}return Rs(Z)}catch{return v}}var Os={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},ml={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},gl;function Wa(){}f(Wa,hl),Wa.prototype.g=function(){return new XMLHttpRequest},gl=new Wa;function Pi(c){return encodeURIComponent(String(c))}function zc(c){var v=1;c=c.split(":");const S=[];for(;v>0&&c.length;)S.push(c.shift()),v--;return c.length&&S.push(c.join(":")),S}function er(c,v,S,L){this.j=c,this.i=v,this.l=S,this.S=L||1,this.V=new Ge(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new yl}function yl(){this.i=null,this.g="",this.h=!1}var _l={},vl={};function mn(c,v,S){c.M=1,c.A=Ga(gn(v)),c.u=S,c.R=!0,qa(c,null)}function qa(c,v){c.F=Date.now(),Ds(c),c.B=gn(c.A);var S=c.B,L=c.S;Array.isArray(L)||(L=[String(L)]),Hc(S.i,"t",L),c.C=0,S=c.j.L,c.h=new yl,c.g=Nl(c.j,S?v:null,!c.u),c.P>0&&(c.O=new kr(u(c.Y,c,c.g),c.P)),v=c.V,S=c.g,L=c.ba;var H="readystatechange";Array.isArray(H)||(H&&(ja[0]=H.toString()),H=ja);for(let Z=0;Z<H.length;Z++){const he=rt(S,H[Z],L||v.handleEvent,!1,v.h||v);if(!he)break;v.g[he.key]=he}v=c.J?U(c.J):{},c.u?(c.v||(c.v="POST"),v["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.B,c.v,c.u,v)):(c.v="GET",c.g.ea(c.B,c.v,null,v)),Ps(),Oc(c.i,c.v,c.B,c.l,c.S,c.u)}er.prototype.ba=function(c){c=c.target;const v=this.O;v&&Pr(c)==3?v.j():this.Y(c)},er.prototype.Y=function(c){try{if(c==this.g)e:{const Oe=Pr(this.g),wt=this.g.ya(),Ye=this.g.ca();if(!(Oe<3)&&(Oe!=3||this.g&&(this.h.h||this.g.la()||Zc(this.g)))){this.K||Oe!=4||wt==7||(wt==8||Ye<=0?Ps(3):Ps(2)),Un(this);var v=this.g.ca();this.X=v;var S=wl(this);if(this.o=v==200,Dc(this.i,this.v,this.B,this.l,this.S,Oe,v),this.o){if(this.U&&!this.L){t:{if(this.g){var L,H=this.g;if((L=H.g?H.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!O(L)){var Z=L;break t}}Z=null}if(c=Z)ri(this.i,this.l,c,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,kn(this,c);else{this.o=!1,this.m=3,Lt(12),nr(this),Ms(this);break e}}if(this.R){c=!0;let Tt;for(;!this.K&&this.C<S.length;)if(Tt=tr(this,S),Tt==vl){Oe==4&&(this.m=4,Lt(14),c=!1),ri(this.i,this.l,null,"[Incomplete Response]");break}else if(Tt==_l){this.m=4,Lt(15),ri(this.i,this.l,S,"[Invalid Chunk]"),c=!1;break}else ri(this.i,this.l,Tt,null),kn(this,Tt);if(ii(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Oe!=4||S.length!=0||this.h.h||(this.m=1,Lt(16),c=!1),this.o=this.o&&c,!c)ri(this.i,this.l,S,"[Invalid Chunked Response]"),nr(this),Ms(this);else if(S.length>0&&!this.W){this.W=!0;var he=this.j;he.g==this&&he.aa&&!he.P&&(he.j.info("Great, no buffering proxy detected. Bytes received: "+S.length),Cl(he),he.P=!0,Lt(11))}}else ri(this.i,this.l,S,null),kn(this,S);Oe==4&&nr(this),this.o&&!this.K&&(Oe==4?Al(this.j,this):(this.o=!1,Ds(this)))}else ed(this.g),v==400&&S.indexOf("Unknown SID")>0?(this.m=3,Lt(12)):(this.m=0,Lt(13)),nr(this),Ms(this)}}}catch{}finally{}};function wl(c){if(!ii(c))return c.g.la();const v=Zc(c.g);if(v==="")return"";let S="";const L=v.length,H=Pr(c.g)==4;if(!c.h.i){if(typeof TextDecoder>"u")return nr(c),Ms(c),"";c.h.i=new a.TextDecoder}for(let Z=0;Z<L;Z++)c.h.h=!0,S+=c.h.i.decode(v[Z],{stream:!(H&&Z==L-1)});return v.length=0,c.h.g+=S,c.C=0,c.h.g}function ii(c){return c.g?c.v=="GET"&&c.M!=2&&c.j.Aa:!1}function tr(c,v){var S=c.C,L=v.indexOf(`
`,S);return L==-1?vl:(S=Number(v.substring(S,L)),isNaN(S)?_l:(L+=1,L+S>v.length?vl:(v=v.slice(L,L+S),c.C=L+S,v)))}er.prototype.cancel=function(){this.K=!0,nr(this)};function Ds(c){c.T=Date.now()+c.H,Vc(c,c.H)}function Vc(c,v){if(c.D!=null)throw Error("WatchDog timer not null");c.D=Ni(u(c.aa,c),v)}function Un(c){c.D&&(a.clearTimeout(c.D),c.D=null)}er.prototype.aa=function(){this.D=null;const c=Date.now();c-this.T>=0?(Mc(this.i,this.B),this.M!=2&&(Ps(),Lt(17)),nr(this),this.m=2,Ms(this)):Vc(this,this.T-c)};function Ms(c){c.j.I==0||c.K||Al(c.j,c)}function nr(c){Un(c);var v=c.O;v&&typeof v.dispose=="function"&&v.dispose(),c.O=null,dl(c.V),c.g&&(v=c.g,c.g=null,v.abort(),v.dispose())}function kn(c,v){try{var S=c.j;if(S.I!=0&&(S.g==c||xl(S.h,c))){if(!c.L&&xl(S.h,c)&&S.I==3){try{var L=S.Ba.g.parse(v)}catch{L=null}if(Array.isArray(L)&&L.length==3){var H=L;if(H[0]==0){e:if(!S.v){if(S.g)if(S.g.F+3e3<c.F)Ja(S),Qa(S);else break e;Sl(S),Lt(18)}}else S.xa=H[1],0<S.xa-S.K&&H[2]<37500&&S.F&&S.A==0&&!S.C&&(S.C=Ni(u(S.Va,S),6e3));Ha(S.h)<=1&&S.ta&&(S.ta=void 0)}else Or(S,11)}else if((c.L||S.g==c)&&Ja(S),!O(v))for(H=S.Ba.g.parse(v),v=0;v<H.length;v++){let Ye=H[v];const Tt=Ye[0];if(!(Tt<=S.K))if(S.K=Tt,Ye=Ye[1],S.I==2)if(Ye[0]=="c"){S.M=Ye[1],S.ba=Ye[2];const Bn=Ye[3];Bn!=null&&(S.ka=Bn,S.j.info("VER="+S.ka));const Fn=Ye[4];Fn!=null&&(S.za=Fn,S.j.info("SVER="+S.za));const _n=Ye[5];_n!=null&&typeof _n=="number"&&_n>0&&(L=1.5*_n,S.O=L,S.j.info("backChannelRequestTimeoutMs_="+L)),L=S;const ir=c.g;if(ir){const Xa=ir.g?ir.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Xa){var Z=L.h;Z.g||Xa.indexOf("spdy")==-1&&Xa.indexOf("quic")==-1&&Xa.indexOf("h2")==-1||(Z.j=Z.l,Z.g=new Set,Z.h&&(El(Z,Z.h),Z.h=null))}if(L.G){const Dl=ir.g?ir.g.getResponseHeader("X-HTTP-Session-Id"):null;Dl&&(L.wa=Dl,nt(L.J,L.G,Dl))}}S.I=3,S.l&&S.l.ra(),S.aa&&(S.T=Date.now()-c.F,S.j.info("Handshake RTT: "+S.T+"ms")),L=S;var he=c;if(L.na=ld(L,L.L?L.ba:null,L.W),he.L){jc(L.h,he);var Oe=he,wt=L.O;wt&&(Oe.H=wt),Oe.D&&(Un(Oe),Ds(Oe)),L.g=he}else sd(L);S.i.length>0&&Ya(S)}else Ye[0]!="stop"&&Ye[0]!="close"||Or(S,7);else S.I==3&&(Ye[0]=="stop"||Ye[0]=="close"?Ye[0]=="stop"?Or(S,7):kl(S):Ye[0]!="noop"&&S.l&&S.l.qa(Ye),S.A=0)}}Ps(4)}catch{}}var bl=class{constructor(c,v){this.g=c,this.map=v}};function zt(c){this.l=c||10,a.PerformanceNavigationTiming?(c=a.performance.getEntriesByType("navigation"),c=c.length>0&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function ln(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function Ha(c){return c.h?1:c.g?c.g.size:0}function xl(c,v){return c.h?c.h==v:c.g?c.g.has(v):!1}function El(c,v){c.g?c.g.add(v):c.h=v}function jc(c,v){c.h&&c.h==v?c.h=null:c.g&&c.g.has(v)&&c.g.delete(v)}zt.prototype.cancel=function(){if(this.i=Uc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function Uc(c){if(c.h!=null)return c.i.concat(c.h.G);if(c.g!=null&&c.g.size!==0){let v=c.i;for(const S of c.g.values())v=v.concat(S.G);return v}return g(c.i)}var Bc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function lp(c,v){if(c){c=c.split("&");for(let S=0;S<c.length;S++){const L=c[S].indexOf("=");let H,Z=null;L>=0?(H=c[S].substring(0,L),Z=c[S].substring(L+1)):H=c[S],v(H,Z?decodeURIComponent(Z.replace(/\+/g," ")):"")}}}function Jt(c){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let v;c instanceof Jt?(this.l=c.l,Ls(this,c.j),this.o=c.o,this.g=c.g,Oi(this,c.u),this.h=c.h,Tl(this,Gc(c.i)),this.m=c.m):c&&(v=String(c).match(Bc))?(this.l=!1,Ls(this,v[1]||"",!0),this.o=zs(v[2]||""),this.g=zs(v[3]||"",!0),Oi(this,v[4]),this.h=zs(v[5]||"",!0),Tl(this,v[6]||"",!0),this.m=zs(v[7]||"")):(this.l=!1,this.i=new Rr(null,this.l))}Jt.prototype.toString=function(){const c=[];var v=this.j;v&&c.push(Vs(v,Fc,!0),":");var S=this.g;return(S||v=="file")&&(c.push("//"),(v=this.o)&&c.push(Vs(v,Fc,!0),"@"),c.push(Pi(S).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),S=this.u,S!=null&&c.push(":",String(S))),(S=this.h)&&(this.g&&S.charAt(0)!="/"&&c.push("/"),c.push(Vs(S,S.charAt(0)=="/"?dp:cp,!0))),(S=this.i.toString())&&c.push("?",S),(S=this.m)&&c.push("#",Vs(S,$l)),c.join("")},Jt.prototype.resolve=function(c){const v=gn(this);let S=!!c.j;S?Ls(v,c.j):S=!!c.o,S?v.o=c.o:S=!!c.g,S?v.g=c.g:S=c.u!=null;var L=c.h;if(S)Oi(v,c.u);else if(S=!!c.h){if(L.charAt(0)!="/")if(this.g&&!this.h)L="/"+L;else{var H=v.h.lastIndexOf("/");H!=-1&&(L=v.h.slice(0,H+1)+L)}if(H=L,H==".."||H==".")L="";else if(H.indexOf("./")!=-1||H.indexOf("/.")!=-1){L=H.lastIndexOf("/",0)==0,H=H.split("/");const Z=[];for(let he=0;he<H.length;){const Oe=H[he++];Oe=="."?L&&he==H.length&&Z.push(""):Oe==".."?((Z.length>1||Z.length==1&&Z[0]!="")&&Z.pop(),L&&he==H.length&&Z.push("")):(Z.push(Oe),L=!0)}L=Z.join("/")}else L=H}return S?v.h=L:S=c.i.toString()!=="",S?Tl(v,Gc(c.i)):S=!!c.m,S&&(v.m=c.m),v};function gn(c){return new Jt(c)}function Ls(c,v,S){c.j=S?zs(v,!0):v,c.j&&(c.j=c.j.replace(/:$/,""))}function Oi(c,v){if(v){if(v=Number(v),isNaN(v)||v<0)throw Error("Bad port number "+v);c.u=v}else c.u=null}function Tl(c,v,S){v instanceof Rr?(c.i=v,Kc(c.i,c.l)):(S||(v=Vs(v,Il)),c.i=new Rr(v,c.l))}function nt(c,v,S){c.i.set(v,S)}function Ga(c){return nt(c,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),c}function zs(c,v){return c?v?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function Vs(c,v,S){return typeof c=="string"?(c=encodeURI(c).replace(v,up),S&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function up(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var Fc=/[#\/\?@]/g,cp=/[#\?:]/g,dp=/[#\?]/g,Il=/[#\?@]/g,$l=/#/g;function Rr(c,v){this.h=this.g=null,this.i=c||null,this.j=!!v}function si(c){c.g||(c.g=new Map,c.h=0,c.i&&lp(c.i,function(v,S){c.add(decodeURIComponent(v.replace(/\+/g," ")),S)}))}t=Rr.prototype,t.add=function(c,v){si(this),this.i=null,c=rr(this,c);let S=this.g.get(c);return S||this.g.set(c,S=[]),S.push(v),this.h+=1,this};function Ka(c,v){si(c),v=rr(c,v),c.g.has(v)&&(c.i=null,c.h-=c.g.get(v).length,c.g.delete(v))}function Wc(c,v){return si(c),v=rr(c,v),c.g.has(v)}t.forEach=function(c,v){si(this),this.g.forEach(function(S,L){S.forEach(function(H){c.call(v,H,L,this)},this)},this)};function qc(c,v){si(c);let S=[];if(typeof v=="string")Wc(c,v)&&(S=S.concat(c.g.get(rr(c,v))));else for(c=Array.from(c.g.values()),v=0;v<c.length;v++)S=S.concat(c[v]);return S}t.set=function(c,v){return si(this),this.i=null,c=rr(this,c),Wc(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[v]),this.h+=1,this},t.get=function(c,v){return c?(c=qc(this,c),c.length>0?String(c[0]):v):v};function Hc(c,v,S){Ka(c,v),S.length>0&&(c.i=null,c.g.set(rr(c,v),g(S)),c.h+=S.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],v=Array.from(this.g.keys());for(let L=0;L<v.length;L++){var S=v[L];const H=Pi(S);S=qc(this,S);for(let Z=0;Z<S.length;Z++){let he=H;S[Z]!==""&&(he+="="+Pi(S[Z])),c.push(he)}}return this.i=c.join("&")};function Gc(c){const v=new Rr;return v.i=c.i,c.g&&(v.g=new Map(c.g),v.h=c.h),v}function rr(c,v){return v=String(v),c.j&&(v=v.toLowerCase()),v}function Kc(c,v){v&&!c.j&&(si(c),c.i=null,c.g.forEach(function(S,L){const H=L.toLowerCase();L!=H&&(Ka(this,L),Hc(this,H,S))},c)),c.j=v}function hp(c,v){const S=new tt;if(a.Image){const L=new Image;L.onload=h(Sn,S,"TestLoadImage: loaded",!0,v,L),L.onerror=h(Sn,S,"TestLoadImage: error",!1,v,L),L.onabort=h(Sn,S,"TestLoadImage: abort",!1,v,L),L.ontimeout=h(Sn,S,"TestLoadImage: timeout",!1,v,L),a.setTimeout(function(){L.ontimeout&&L.ontimeout()},1e4),L.src=c}else v(!1)}function fp(c,v){const S=new tt,L=new AbortController,H=setTimeout(()=>{L.abort(),Sn(S,"TestPingServer: timeout",!1,v)},1e4);fetch(c,{signal:L.signal}).then(Z=>{clearTimeout(H),Z.ok?Sn(S,"TestPingServer: ok",!0,v):Sn(S,"TestPingServer: server error",!1,v)}).catch(()=>{clearTimeout(H),Sn(S,"TestPingServer: error",!1,v)})}function Sn(c,v,S,L,H){try{H&&(H.onload=null,H.onerror=null,H.onabort=null,H.ontimeout=null),L(S)}catch{}}function Nr(){this.g=new Ns}function yn(c){this.i=c.Sb||null,this.h=c.ab||!1}f(yn,hl),yn.prototype.g=function(){return new js(this.i,this.h)};function js(c,v){At.call(this),this.H=c,this.o=v,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}f(js,At),t=js.prototype,t.open=function(c,v){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=c,this.D=v,this.readyState=1,Mi(this)},t.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const v={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};c&&(v.body=c),(this.H||a).fetch(new Request(this.D,v)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Di(this)),this.readyState=0},t.Pa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,Mi(this)),this.g&&(this.readyState=3,Mi(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Us(this)}else c.text().then(this.Oa.bind(this),this.ga.bind(this))};function Us(c){c.j.read().then(c.Ma.bind(c)).catch(c.ga.bind(c))}t.Ma=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var v=c.value?c.value:new Uint8Array(0);(v=this.B.decode(v,{stream:!c.done}))&&(this.response=this.responseText+=v)}c.done?Di(this):Mi(this),this.readyState==3&&Us(this)}},t.Oa=function(c){this.g&&(this.response=this.responseText=c,Di(this))},t.Na=function(c){this.g&&(this.response=c,Di(this))},t.ga=function(){this.g&&Di(this)};function Di(c){c.readyState=4,c.l=null,c.j=null,c.B=null,Mi(c)}t.setRequestHeader=function(c,v){this.A.append(c,v)},t.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],v=this.h.entries();for(var S=v.next();!S.done;)S=S.value,c.push(S[0]+": "+S[1]),S=v.next();return c.join(`\r
`)};function Mi(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(js.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function Qc(c){let v="";return B(c,function(S,L){v+=L,v+=":",v+=S,v+=`\r
`}),v}function Bs(c,v,S){e:{for(L in S){var L=!1;break e}L=!0}L||(S=Qc(S),typeof c=="string"?S!=null&&Pi(S):nt(c,v,S))}function ct(c){At.call(this),this.headers=new Map,this.L=c||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}f(ct,At);var Yc=/^https?$/i,pp=["POST","PUT"];t=ct.prototype,t.Fa=function(c){this.H=c},t.ea=function(c,v,S,L){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);v=v?v.toUpperCase():"GET",this.D=c,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():gl.g(),this.g.onreadystatechange=p(u(this.Ca,this));try{this.B=!0,this.g.open(v,String(c),!0),this.B=!1}catch(Z){Fs(this,Z);return}if(c=S||"",S=new Map(this.headers),L)if(Object.getPrototypeOf(L)===Object.prototype)for(var H in L)S.set(H,L[H]);else if(typeof L.keys=="function"&&typeof L.get=="function")for(const Z of L.keys())S.set(Z,L.get(Z));else throw Error("Unknown input type for opt_headers: "+String(L));L=Array.from(S.keys()).find(Z=>Z.toLowerCase()=="content-type"),H=a.FormData&&c instanceof a.FormData,!(Array.prototype.indexOf.call(pp,v,void 0)>=0)||L||H||S.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Z,he]of S)this.g.setRequestHeader(Z,he);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(c),this.v=!1}catch(Z){Fs(this,Z)}};function Fs(c,v){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=v,c.o=5,Jc(c),ai(c)}function Jc(c){c.A||(c.A=!0,Rt(c,"complete"),Rt(c,"error"))}t.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=c||7,Rt(this,"complete"),Rt(this,"abort"),ai(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ai(this,!0)),ct.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?Xc(this):this.Xa())},t.Xa=function(){Xc(this)};function Xc(c){if(c.h&&typeof s<"u"){if(c.v&&Pr(c)==4)setTimeout(c.Ca.bind(c),0);else if(Rt(c,"readystatechange"),Pr(c)==4){c.h=!1;try{const Z=c.ca();e:switch(Z){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var v=!0;break e;default:v=!1}var S;if(!(S=v)){var L;if(L=Z===0){let he=String(c.D).match(Bc)[1]||null;!he&&a.self&&a.self.location&&(he=a.self.location.protocol.slice(0,-1)),L=!Yc.test(he?he.toLowerCase():"")}S=L}if(S)Rt(c,"complete"),Rt(c,"success");else{c.o=6;try{var H=Pr(c)>2?c.g.statusText:""}catch{H=""}c.l=H+" ["+c.ca()+"]",Jc(c)}}finally{ai(c)}}}}function ai(c,v){if(c.g){c.m&&(clearTimeout(c.m),c.m=null);const S=c.g;c.g=null,v||Rt(c,"ready");try{S.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function Pr(c){return c.g?c.g.readyState:0}t.ca=function(){try{return Pr(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(c){if(this.g){var v=this.g.responseText;return c&&v.indexOf(c)==0&&(v=v.substring(c.length)),Sr(v)}};function Zc(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.F){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function ed(c){const v={};c=(c.g&&Pr(c)>=2&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let L=0;L<c.length;L++){if(O(c[L]))continue;var S=zc(c[L]);const H=S[0];if(S=S[1],typeof S!="string")continue;S=S.trim();const Z=v[H]||[];v[H]=Z,Z.push(S)}F(v,function(L){return L.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ws(c,v,S){return S&&S.internalChannelParams&&S.internalChannelParams[c]||v}function td(c){this.za=0,this.i=[],this.j=new tt,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ws("failFast",!1,c),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ws("baseRetryDelayMs",5e3,c),this.Za=Ws("retryDelaySeedMs",1e4,c),this.Ta=Ws("forwardChannelMaxRetries",2,c),this.va=Ws("forwardChannelRequestTimeoutMs",2e4,c),this.ma=c&&c.xmlHttpFactory||void 0,this.Ua=c&&c.Rb||void 0,this.Aa=c&&c.useFetchStreams||!1,this.O=void 0,this.L=c&&c.supportsCrossDomainXhr||!1,this.M="",this.h=new zt(c&&c.concurrentRequestLimit),this.Ba=new Nr,this.S=c&&c.fastHandshake||!1,this.R=c&&c.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=c&&c.Pb||!1,c&&c.ua&&this.j.ua(),c&&c.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&c&&c.detectBufferingProxy||!1,this.ia=void 0,c&&c.longPollingTimeout&&c.longPollingTimeout>0&&(this.ia=c.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=td.prototype,t.ka=8,t.I=1,t.connect=function(c,v,S,L){Lt(0),this.W=c,this.H=v||{},S&&L!==void 0&&(this.H.OSID=S,this.H.OAID=L),this.F=this.X,this.J=ld(this,null,this.W),Ya(this)};function kl(c){if(nd(c),c.I==3){var v=c.V++,S=gn(c.J);if(nt(S,"SID",c.M),nt(S,"RID",v),nt(S,"TYPE","terminate"),qs(c,S),v=new er(c,c.j,v),v.M=2,v.A=Ga(gn(S)),S=!1,a.navigator&&a.navigator.sendBeacon)try{S=a.navigator.sendBeacon(v.A.toString(),"")}catch{}!S&&a.Image&&(new Image().src=v.A,S=!0),S||(v.g=Nl(v.j,null),v.g.ea(v.A)),v.F=Date.now(),Ds(v)}od(c)}function Qa(c){c.g&&(Cl(c),c.g.cancel(),c.g=null)}function nd(c){Qa(c),c.v&&(a.clearTimeout(c.v),c.v=null),Ja(c),c.h.cancel(),c.m&&(typeof c.m=="number"&&a.clearTimeout(c.m),c.m=null)}function Ya(c){if(!ln(c.h)&&!c.m){c.m=!0;var v=c.Ea;M||k(),j||(M(),j=!0),C.add(v,c),c.D=0}}function mp(c,v){return Ha(c.h)>=c.h.j-(c.m?1:0)?!1:c.m?(c.i=v.G.concat(c.i),!0):c.I==1||c.I==2||c.D>=(c.Sa?0:c.Ta)?!1:(c.m=Ni(u(c.Ea,c,v),Rl(c,c.D)),c.D++,!0)}t.Ea=function(c){if(this.m)if(this.m=null,this.I==1){if(!c){this.V=Math.floor(Math.random()*1e5),c=this.V++;const H=new er(this,this.j,c);let Z=this.o;if(this.U&&(Z?(Z=U(Z),q(Z,this.U)):Z=this.U),this.u!==null||this.R||(H.J=Z,Z=null),this.S)e:{for(var v=0,S=0;S<this.i.length;S++){t:{var L=this.i[S];if("__data__"in L.map&&(L=L.map.__data__,typeof L=="string")){L=L.length;break t}L=void 0}if(L===void 0)break;if(v+=L,v>4096){v=S;break e}if(v===4096||S===this.i.length-1){v=S+1;break e}}v=1e3}else v=1e3;v=id(this,H,v),S=gn(this.J),nt(S,"RID",c),nt(S,"CVER",22),this.G&&nt(S,"X-HTTP-Session-Id",this.G),qs(this,S),Z&&(this.R?v="headers="+Pi(Qc(Z))+"&"+v:this.u&&Bs(S,this.u,Z)),El(this.h,H),this.Ra&&nt(S,"TYPE","init"),this.S?(nt(S,"$req",v),nt(S,"SID","null"),H.U=!0,mn(H,S,null)):mn(H,S,v),this.I=2}}else this.I==3&&(c?rd(this,c):this.i.length==0||ln(this.h)||rd(this))};function rd(c,v){var S;v?S=v.l:S=c.V++;const L=gn(c.J);nt(L,"SID",c.M),nt(L,"RID",S),nt(L,"AID",c.K),qs(c,L),c.u&&c.o&&Bs(L,c.u,c.o),S=new er(c,c.j,S,c.D+1),c.u===null&&(S.J=c.o),v&&(c.i=v.G.concat(c.i)),v=id(c,S,1e3),S.H=Math.round(c.va*.5)+Math.round(c.va*.5*Math.random()),El(c.h,S),mn(S,L,v)}function qs(c,v){c.H&&B(c.H,function(S,L){nt(v,L,S)}),c.l&&B({},function(S,L){nt(v,L,S)})}function id(c,v,S){S=Math.min(c.i.length,S);const L=c.l?u(c.l.Ka,c.l,c):null;e:{var H=c.i;let Oe=-1;for(;;){const wt=["count="+S];Oe==-1?S>0?(Oe=H[0].g,wt.push("ofs="+Oe)):Oe=0:wt.push("ofs="+Oe);let Ye=!0;for(let Tt=0;Tt<S;Tt++){var Z=H[Tt].g;const Bn=H[Tt].map;if(Z-=Oe,Z<0)Oe=Math.max(0,H[Tt].g-100),Ye=!1;else try{Z="req"+Z+"_"||"";try{var he=Bn instanceof Map?Bn:Object.entries(Bn);for(const[Fn,_n]of he){let ir=_n;o(_n)&&(ir=Rs(_n)),wt.push(Z+Fn+"="+encodeURIComponent(ir))}}catch(Fn){throw wt.push(Z+"type="+encodeURIComponent("_badmap")),Fn}}catch{L&&L(Bn)}}if(Ye){he=wt.join("&");break e}}he=void 0}return c=c.i.splice(0,S),v.G=c,he}function sd(c){if(!c.g&&!c.v){c.Y=1;var v=c.Da;M||k(),j||(M(),j=!0),C.add(v,c),c.A=0}}function Sl(c){return c.g||c.v||c.A>=3?!1:(c.Y++,c.v=Ni(u(c.Da,c),Rl(c,c.A)),c.A++,!0)}t.Da=function(){if(this.v=null,ad(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var c=4*this.T;this.j.info("BP detection timer enabled: "+c),this.B=Ni(u(this.Wa,this),c)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Lt(10),Qa(this),ad(this))};function Cl(c){c.B!=null&&(a.clearTimeout(c.B),c.B=null)}function ad(c){c.g=new er(c,c.j,"rpc",c.Y),c.u===null&&(c.g.J=c.o),c.g.P=0;var v=gn(c.na);nt(v,"RID","rpc"),nt(v,"SID",c.M),nt(v,"AID",c.K),nt(v,"CI",c.F?"0":"1"),!c.F&&c.ia&&nt(v,"TO",c.ia),nt(v,"TYPE","xmlhttp"),qs(c,v),c.u&&c.o&&Bs(v,c.u,c.o),c.O&&(c.g.H=c.O);var S=c.g;c=c.ba,S.M=1,S.A=Ga(gn(v)),S.u=null,S.R=!0,qa(S,c)}t.Va=function(){this.C!=null&&(this.C=null,Qa(this),Sl(this),Lt(19))};function Ja(c){c.C!=null&&(a.clearTimeout(c.C),c.C=null)}function Al(c,v){var S=null;if(c.g==v){Ja(c),Cl(c),c.g=null;var L=2}else if(xl(c.h,v))S=v.G,jc(c.h,v),L=1;else return;if(c.I!=0){if(v.o)if(L==1){S=v.u?v.u.length:0,v=Date.now()-v.F;var H=c.D;L=Fa(),Rt(L,new pl(L,S)),Ya(c)}else sd(c);else if(H=v.m,H==3||H==0&&v.X>0||!(L==1&&mp(c,v)||L==2&&Sl(c)))switch(S&&S.length>0&&(v=c.h,v.i=v.i.concat(S)),H){case 1:Or(c,5);break;case 4:Or(c,10);break;case 3:Or(c,6);break;default:Or(c,2)}}}function Rl(c,v){let S=c.Qa+Math.floor(Math.random()*c.Za);return c.isActive()||(S*=2),S*v}function Or(c,v){if(c.j.info("Error code "+v),v==2){var S=u(c.bb,c),L=c.Ua;const H=!L;L=new Jt(L||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Ls(L,"https"),Ga(L),H?hp(L.toString(),S):fp(L.toString(),S)}else Lt(2);c.I=0,c.l&&c.l.pa(v),od(c),nd(c)}t.bb=function(c){c?(this.j.info("Successfully pinged google.com"),Lt(2)):(this.j.info("Failed to ping google.com"),Lt(1))};function od(c){if(c.I=0,c.ja=[],c.l){const v=Uc(c.h);(v.length!=0||c.i.length!=0)&&(_(c.ja,v),_(c.ja,c.i),c.h.i.length=0,g(c.i),c.i.length=0),c.l.oa()}}function ld(c,v,S){var L=S instanceof Jt?gn(S):new Jt(S);if(L.g!="")v&&(L.g=v+"."+L.g),Oi(L,L.u);else{var H=a.location;L=H.protocol,v=v?v+"."+H.hostname:H.hostname,H=+H.port;const Z=new Jt(null);L&&Ls(Z,L),v&&(Z.g=v),H&&Oi(Z,H),S&&(Z.h=S),L=Z}return S=c.G,v=c.wa,S&&v&&nt(L,S,v),nt(L,"VER",c.ka),qs(c,L),L}function Nl(c,v,S){if(v&&!c.L)throw Error("Can't create secondary domain capable XhrIo object.");return v=c.Aa&&!c.ma?new ct(new yn({ab:S})):new ct(c.ma),v.Fa(c.L),v}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Pl(){}t=Pl.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function Dr(){}Dr.prototype.g=function(c,v){return new un(c,v)};function un(c,v){At.call(this),this.g=new td(v),this.l=c,this.h=v&&v.messageUrlParams||null,c=v&&v.messageHeaders||null,v&&v.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=v&&v.initMessageHeaders||null,v&&v.messageContentType&&(c?c["X-WebChannel-Content-Type"]=v.messageContentType:c={"X-WebChannel-Content-Type":v.messageContentType}),v&&v.sa&&(c?c["X-WebChannel-Client-Profile"]=v.sa:c={"X-WebChannel-Client-Profile":v.sa}),this.g.U=c,(c=v&&v.Qb)&&!O(c)&&(this.g.u=c),this.A=v&&v.supportsCrossDomainXhr||!1,this.v=v&&v.sendRawJson||!1,(v=v&&v.httpSessionIdParam)&&!O(v)&&(this.g.G=v,c=this.h,c!==null&&v in c&&(c=this.h,v in c&&delete c[v])),this.j=new Li(this)}f(un,At),un.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},un.prototype.close=function(){kl(this.g)},un.prototype.o=function(c){var v=this.g;if(typeof c=="string"){var S={};S.__data__=c,c=S}else this.v&&(S={},S.__data__=Rs(c),c=S);v.i.push(new bl(v.Ya++,c)),v.I==3&&Ya(v)},un.prototype.N=function(){this.g.l=null,delete this.j,kl(this.g),delete this.g,un.Z.N.call(this)};function Ol(c){Ua.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var v=c.__sm__;if(v){e:{for(const S in v){c=S;break e}c=void 0}(this.i=c)&&(c=this.i,v=v!==null&&c in v?v[c]:void 0),this.data=v}else this.data=c}f(Ol,Ua);function ud(){Ba.call(this),this.status=1}f(ud,Ba);function Li(c){this.g=c}f(Li,Pl),Li.prototype.ra=function(){Rt(this.g,"a")},Li.prototype.qa=function(c){Rt(this.g,new Ol(c))},Li.prototype.pa=function(c){Rt(this.g,new ud)},Li.prototype.oa=function(){Rt(this.g,"b")},Dr.prototype.createWebChannel=Dr.prototype.g,un.prototype.send=un.prototype.o,un.prototype.open=un.prototype.m,un.prototype.close=un.prototype.close,Mk=function(){return new Dr},Dk=function(){return Fa()},Ok=Ar,hy={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Os.NO_ERROR=0,Os.TIMEOUT=8,Os.HTTP_ERROR=6,gh=Os,ml.COMPLETE="complete",Pk=ml,Cr.EventType=Ri,Ri.OPEN="a",Ri.CLOSE="b",Ri.ERROR="c",Ri.MESSAGE="d",At.prototype.listen=At.prototype.J,cu=Cr,ct.prototype.listenOnce=ct.prototype.K,ct.prototype.getLastError=ct.prototype.Ha,ct.prototype.getLastErrorCode=ct.prototype.ya,ct.prototype.getStatus=ct.prototype.ca,ct.prototype.getResponseJson=ct.prototype.La,ct.prototype.getResponseText=ct.prototype.la,ct.prototype.send=ct.prototype.ea,ct.prototype.setWithCredentials=ct.prototype.Fa,Nk=ct}).apply(typeof Rd<"u"?Rd:typeof self<"u"?self:typeof window<"u"?window:{});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nn=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};nn.UNAUTHENTICATED=new nn(null),nn.GOOGLE_CREDENTIALS=new nn("google-credentials-uid"),nn.FIRST_PARTY=new nn("first-party-uid"),nn.MOCK_USER=new nn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tl="12.8.0";function GL(t){tl=t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ea=new B_("@firebase/firestore");function no(){return Ea.logLevel}function me(t,...e){if(Ea.logLevel<=Le.DEBUG){const n=e.map(Z_);Ea.debug(`Firestore (${tl}): ${t}`,...n)}}function $i(t,...e){if(Ea.logLevel<=Le.ERROR){const n=e.map(Z_);Ea.error(`Firestore (${tl}): ${t}`,...n)}}function Uo(t,...e){if(Ea.logLevel<=Le.WARN){const n=e.map(Z_);Ea.warn(`Firestore (${tl}): ${t}`,...n)}}function Z_(t){if(typeof t=="string")return t;try{return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Se(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,Lk(t,r,n)}function Lk(t,e,n){let r=`FIRESTORE (${tl}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw $i(r),new Error(r)}function Qe(t,e,n,r){let i="Unexpected state";typeof n=="string"?i=n:r=n,t||Lk(e,i,r)}function Ne(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ne={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class fe extends ei{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vi{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zk{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class KL{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(nn.UNAUTHENTICATED))}shutdown(){}}class QL{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class YL{constructor(e){this.t=e,this.currentUser=nn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Qe(this.o===void 0,42304);let r=this.i;const i=l=>this.i!==r?(r=this.i,n(l)):Promise.resolve();let s=new vi;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new vi,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const l=s;e.enqueueRetryable(async()=>{await l.promise,await i(this.currentUser)})},o=l=>{me("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>o(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?o(l):(me("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new vi)}},0),a()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(me("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Qe(typeof r.accessToken=="string",31837,{l:r}),new zk(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Qe(e===null||typeof e=="string",2055,{h:e}),new nn(e)}}class JL{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=nn.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class XL{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new JL(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable(()=>n(nn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class T1{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ZL{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Pn(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){Qe(this.o===void 0,3512);const r=s=>{s.error!=null&&me("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.m;return this.m=s.token,me("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?n(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{me("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?i(s):me("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new T1(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Qe(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new T1(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ez(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ev{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=ez(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<n&&(r+=e.charAt(i[s]%62))}return r}}function ze(t,e){return t<e?-1:t>e?1:0}function fy(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const i=t.charAt(r),s=e.charAt(r);if(i!==s)return im(i)===im(s)?ze(i,s):im(i)?1:-1}return ze(t.length,e.length)}const tz=55296,nz=57343;function im(t){const e=t.charCodeAt(0);return e>=tz&&e<=nz}function Bo(t,e,n){return t.length===e.length&&t.every((r,i)=>n(r,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I1="__name__";class jr{constructor(e,n,r){n===void 0?n=0:n>e.length&&Se(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Se(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return jr.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof jr?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const s=jr.compareSegments(e.get(i),n.get(i));if(s!==0)return s}return ze(e.length,n.length)}static compareSegments(e,n){const r=jr.isNumericId(e),i=jr.isNumericId(n);return r&&!i?-1:!r&&i?1:r&&i?jr.extractNumericId(e).compare(jr.extractNumericId(n)):fy(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return cs.fromString(e.substring(4,e.length-2))}}class st extends jr{construct(e,n,r){return new st(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new fe(ne.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(i=>i.length>0))}return new st(n)}static emptyPath(){return new st([])}}const rz=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ht extends jr{construct(e,n,r){return new Ht(e,n,r)}static isValidIdentifier(e){return rz.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ht.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===I1}static keyField(){return new Ht([I1])}static fromServerFormat(e){const n=[];let r="",i=0;const s=()=>{if(r.length===0)throw new fe(ne.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let a=!1;for(;i<e.length;){const o=e[i];if(o==="\\"){if(i+1===e.length)throw new fe(ne.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new fe(ne.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else o==="`"?(a=!a,i++):o!=="."||a?(r+=o,i++):(s(),i++)}if(s(),a)throw new fe(ne.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ht(n)}static emptyPath(){return new Ht([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Te{constructor(e){this.path=e}static fromPath(e){return new Te(st.fromString(e))}static fromName(e){return new Te(st.fromString(e).popFirst(5))}static empty(){return new Te(st.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&st.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return st.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Te(new st(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vk(t,e,n){if(!n)throw new fe(ne.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function iz(t,e,n,r){if(e===!0&&r===!0)throw new fe(ne.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function $1(t){if(!Te.isDocumentKey(t))throw new fe(ne.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function k1(t){if(Te.isDocumentKey(t))throw new fe(ne.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function jk(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function qf(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Se(12329,{type:typeof t})}function Yr(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new fe(ne.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=qf(t);throw new fe(ne.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ct(t,e){const n={typeString:t};return e&&(n.value=e),n}function $c(t,e){if(!jk(t))throw new fe(ne.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const a=t[r];if(i&&typeof a!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&a!==s.value){n=`Expected '${r}' field to equal '${s.value}'`;break}}if(n)throw new fe(ne.INVALID_ARGUMENT,n);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S1=-62135596800,C1=1e6;class lt{static now(){return lt.fromMillis(Date.now())}static fromDate(e){return lt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*C1);return new lt(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new fe(ne.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new fe(ne.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<S1)throw new fe(ne.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new fe(ne.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/C1}_compareTo(e){return this.seconds===e.seconds?ze(this.nanoseconds,e.nanoseconds):ze(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:lt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if($c(e,lt._jsonSchema))return new lt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-S1;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}lt._jsonSchemaVersion="firestore/timestamp/1.0",lt._jsonSchema={type:Ct("string",lt._jsonSchemaVersion),seconds:Ct("number"),nanoseconds:Ct("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Re{static fromTimestamp(e){return new Re(e)}static min(){return new Re(new lt(0,0))}static max(){return new Re(new lt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sc=-1;function sz(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=Re.fromTimestamp(r===1e9?new lt(n+1,0):new lt(n,r));return new ms(i,Te.empty(),e)}function az(t){return new ms(t.readTime,t.key,sc)}class ms{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new ms(Re.min(),Te.empty(),sc)}static max(){return new ms(Re.max(),Te.empty(),sc)}}function oz(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=Te.comparator(t.documentKey,e.documentKey),n!==0?n:ze(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lz="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class uz{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nl(t){if(t.code!==ne.FAILED_PRECONDITION||t.message!==lz)throw t;me("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ie{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Se(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new ie((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(n,s).next(r,i)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof ie?n:ie.resolve(n)}catch(n){return ie.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):ie.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):ie.reject(n)}static resolve(e){return new ie((n,r)=>{n(e)})}static reject(e){return new ie((n,r)=>{r(e)})}static waitFor(e){return new ie((n,r)=>{let i=0,s=0,a=!1;e.forEach(o=>{++i,o.next(()=>{++s,a&&s===i&&n()},l=>r(l))}),a=!0,s===i&&n()})}static or(e){let n=ie.resolve(!1);for(const r of e)n=n.next(i=>i?ie.resolve(i):r());return n}static forEach(e,n){const r=[];return e.forEach((i,s)=>{r.push(n.call(this,i,s))}),this.waitFor(r)}static mapArray(e,n){return new ie((r,i)=>{const s=e.length,a=new Array(s);let o=0;for(let l=0;l<s;l++){const u=l;n(e[u]).next(h=>{a[u]=h,++o,o===s&&r(a)},h=>i(h))}})}static doWhile(e,n){return new ie((r,i)=>{const s=()=>{e()===!0?n().next(()=>{s()},i):r()};s()})}}function cz(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function rl(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hf{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Hf.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tv=-1;function Gf(t){return t==null}function nf(t){return t===0&&1/t==-1/0}function dz(t){return typeof t=="number"&&Number.isInteger(t)&&!nf(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uk="";function hz(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=A1(e)),e=fz(t.get(n),e);return A1(e)}function fz(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const s=t.charAt(i);switch(s){case"\0":n+="";break;case Uk:n+="";break;default:n+=s}}return n}function A1(t){return t+Uk+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R1(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ks(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Bk(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gt{constructor(e,n){this.comparator=e,this.root=n||qt.EMPTY}insert(e,n){return new gt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,qt.BLACK,null,null))}remove(e){return new gt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,qt.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Nd(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Nd(this.root,e,this.comparator,!1)}getReverseIterator(){return new Nd(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Nd(this.root,e,this.comparator,!0)}}class Nd{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=n?r(e.key,n):1,n&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class qt{constructor(e,n,r,i,s){this.key=e,this.value=n,this.color=r??qt.RED,this.left=i??qt.EMPTY,this.right=s??qt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,s){return new qt(e??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,n,r),null):s===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return qt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return qt.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,qt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,qt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Se(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Se(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Se(27949);return e+(this.isRed()?0:1)}}qt.EMPTY=null,qt.RED=!0,qt.BLACK=!1;qt.EMPTY=new class{constructor(){this.size=0}get key(){throw Se(57766)}get value(){throw Se(16141)}get color(){throw Se(16727)}get left(){throw Se(29726)}get right(){throw Se(36894)}copy(e,n,r,i,s){return this}insert(e,n,r){return new qt(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(e){this.comparator=e,this.data=new gt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new N1(this.data.getIterator())}getIteratorFrom(e){return new N1(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof Ot)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new Ot(this.comparator);return n.data=e,n}}class N1{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dn{constructor(e){this.fields=e,e.sort(Ht.comparator)}static empty(){return new Dn([])}unionWith(e){let n=new Ot(Ht.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Dn(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Bo(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fk extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qt{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Fk("Invalid base64 string: "+s):s}}(e);return new Qt(n)}static fromUint8Array(e){const n=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new Qt(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ze(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Qt.EMPTY_BYTE_STRING=new Qt("");const pz=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function gs(t){if(Qe(!!t,39018),typeof t=="string"){let e=0;const n=pz.exec(t);if(Qe(!!n,46558,{timestamp:t}),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:bt(t.seconds),nanos:bt(t.nanos)}}function bt(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function ys(t){return typeof t=="string"?Qt.fromBase64String(t):Qt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wk="server_timestamp",qk="__type__",Hk="__previous_value__",Gk="__local_write_time__";function nv(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[qk])==null?void 0:r.stringValue)===Wk}function Kf(t){const e=t.mapValue.fields[Hk];return nv(e)?Kf(e):e}function ac(t){const e=gs(t.mapValue.fields[Gk].timestampValue);return new lt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mz{constructor(e,n,r,i,s,a,o,l,u,h,f){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=o,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=h,this.apiKey=f}}const rf="(default)";class oc{constructor(e,n){this.projectId=e,this.database=n||rf}static empty(){return new oc("","")}get isDefaultDatabase(){return this.database===rf}isEqual(e){return e instanceof oc&&e.projectId===this.projectId&&e.database===this.database}}function gz(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new fe(ne.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new oc(t.options.projectId,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kk="__type__",yz="__max__",Pd={mapValue:{}},Qk="__vector__",sf="value";function _s(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?nv(t)?4:vz(t)?9007199254740991:_z(t)?10:11:Se(28295,{value:t})}function Jr(t,e){if(t===e)return!0;const n=_s(t);if(n!==_s(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ac(t).isEqual(ac(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=gs(i.timestampValue),o=gs(s.timestampValue);return a.seconds===o.seconds&&a.nanos===o.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(i,s){return ys(i.bytesValue).isEqual(ys(s.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(i,s){return bt(i.geoPointValue.latitude)===bt(s.geoPointValue.latitude)&&bt(i.geoPointValue.longitude)===bt(s.geoPointValue.longitude)}(t,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return bt(i.integerValue)===bt(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=bt(i.doubleValue),o=bt(s.doubleValue);return a===o?nf(a)===nf(o):isNaN(a)&&isNaN(o)}return!1}(t,e);case 9:return Bo(t.arrayValue.values||[],e.arrayValue.values||[],Jr);case 10:case 11:return function(i,s){const a=i.mapValue.fields||{},o=s.mapValue.fields||{};if(R1(a)!==R1(o))return!1;for(const l in a)if(a.hasOwnProperty(l)&&(o[l]===void 0||!Jr(a[l],o[l])))return!1;return!0}(t,e);default:return Se(52216,{left:t})}}function lc(t,e){return(t.values||[]).find(n=>Jr(n,e))!==void 0}function Fo(t,e){if(t===e)return 0;const n=_s(t),r=_s(e);if(n!==r)return ze(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ze(t.booleanValue,e.booleanValue);case 2:return function(s,a){const o=bt(s.integerValue||s.doubleValue),l=bt(a.integerValue||a.doubleValue);return o<l?-1:o>l?1:o===l?0:isNaN(o)?isNaN(l)?0:-1:1}(t,e);case 3:return P1(t.timestampValue,e.timestampValue);case 4:return P1(ac(t),ac(e));case 5:return fy(t.stringValue,e.stringValue);case 6:return function(s,a){const o=ys(s),l=ys(a);return o.compareTo(l)}(t.bytesValue,e.bytesValue);case 7:return function(s,a){const o=s.split("/"),l=a.split("/");for(let u=0;u<o.length&&u<l.length;u++){const h=ze(o[u],l[u]);if(h!==0)return h}return ze(o.length,l.length)}(t.referenceValue,e.referenceValue);case 8:return function(s,a){const o=ze(bt(s.latitude),bt(a.latitude));return o!==0?o:ze(bt(s.longitude),bt(a.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return O1(t.arrayValue,e.arrayValue);case 10:return function(s,a){var p,g,_,x;const o=s.fields||{},l=a.fields||{},u=(p=o[sf])==null?void 0:p.arrayValue,h=(g=l[sf])==null?void 0:g.arrayValue,f=ze(((_=u==null?void 0:u.values)==null?void 0:_.length)||0,((x=h==null?void 0:h.values)==null?void 0:x.length)||0);return f!==0?f:O1(u,h)}(t.mapValue,e.mapValue);case 11:return function(s,a){if(s===Pd.mapValue&&a===Pd.mapValue)return 0;if(s===Pd.mapValue)return 1;if(a===Pd.mapValue)return-1;const o=s.fields||{},l=Object.keys(o),u=a.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const p=fy(l[f],h[f]);if(p!==0)return p;const g=Fo(o[l[f]],u[h[f]]);if(g!==0)return g}return ze(l.length,h.length)}(t.mapValue,e.mapValue);default:throw Se(23264,{he:n})}}function P1(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return ze(t,e);const n=gs(t),r=gs(e),i=ze(n.seconds,r.seconds);return i!==0?i:ze(n.nanos,r.nanos)}function O1(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const s=Fo(n[i],r[i]);if(s)return s}return ze(n.length,r.length)}function Wo(t){return py(t)}function py(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=gs(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return ys(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return Te.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",i=!0;for(const s of n.values||[])i?i=!1:r+=",",r+=py(s);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let i="{",s=!0;for(const a of r)s?s=!1:i+=",",i+=`${a}:${py(n.fields[a])}`;return i+"}"}(t.mapValue):Se(61005,{value:t})}function yh(t){switch(_s(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Kf(t);return e?16+yh(e):16;case 5:return 2*t.stringValue.length;case 6:return ys(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,s)=>i+yh(s),0)}(t.arrayValue);case 10:case 11:return function(r){let i=0;return ks(r.fields,(s,a)=>{i+=s.length+yh(a)}),i}(t.mapValue);default:throw Se(13486,{value:t})}}function D1(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function my(t){return!!t&&"integerValue"in t}function rv(t){return!!t&&"arrayValue"in t}function M1(t){return!!t&&"nullValue"in t}function L1(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function _h(t){return!!t&&"mapValue"in t}function _z(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[Kk])==null?void 0:r.stringValue)===Qk}function Ru(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return ks(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=Ru(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Ru(t.arrayValue.values[n]);return e}return{...t}}function vz(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===yz}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xn{constructor(e){this.value=e}static empty(){return new xn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!_h(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ru(n)}setAll(e){let n=Ht.emptyPath(),r={},i=[];e.forEach((a,o)=>{if(!n.isImmediateParentOf(o)){const l=this.getFieldsMap(n);this.applyChanges(l,r,i),r={},i=[],n=o.popLast()}a?r[o.lastSegment()]=Ru(a):i.push(o.lastSegment())});const s=this.getFieldsMap(n);this.applyChanges(s,r,i)}delete(e){const n=this.field(e.popLast());_h(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Jr(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];_h(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){ks(n,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new xn(Ru(this.value))}}function Yk(t){const e=[];return ks(t.fields,(n,r)=>{const i=new Ht([n]);if(_h(r)){const s=Yk(r.mapValue).fields;if(s.length===0)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)}),new Dn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sn{constructor(e,n,r,i,s,a,o){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=o}static newInvalidDocument(e){return new sn(e,0,Re.min(),Re.min(),Re.min(),xn.empty(),0)}static newFoundDocument(e,n,r,i){return new sn(e,1,n,Re.min(),r,i,0)}static newNoDocument(e,n){return new sn(e,2,n,Re.min(),Re.min(),xn.empty(),0)}static newUnknownDocument(e,n){return new sn(e,3,n,Re.min(),Re.min(),xn.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Re.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=xn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=xn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Re.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof sn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new sn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class af{constructor(e,n){this.position=e,this.inclusive=n}}function z1(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],a=t.position[i];if(s.field.isKeyField()?r=Te.comparator(Te.fromName(a.referenceValue),n.key):r=Fo(a,n.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function V1(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Jr(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uc{constructor(e,n="asc"){this.field=e,this.dir=n}}function wz(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jk{}class St extends Jk{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new xz(e,n,r):n==="array-contains"?new Iz(e,r):n==="in"?new $z(e,r):n==="not-in"?new kz(e,r):n==="array-contains-any"?new Sz(e,r):new St(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new Ez(e,r):new Tz(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Fo(n,this.value)):n!==null&&_s(this.value)===_s(n)&&this.matchesComparison(Fo(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Se(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class $r extends Jk{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new $r(e,n)}matches(e){return Xk(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Xk(t){return t.op==="and"}function Zk(t){return bz(t)&&Xk(t)}function bz(t){for(const e of t.filters)if(e instanceof $r)return!1;return!0}function gy(t){if(t instanceof St)return t.field.canonicalString()+t.op.toString()+Wo(t.value);if(Zk(t))return t.filters.map(e=>gy(e)).join(",");{const e=t.filters.map(n=>gy(n)).join(",");return`${t.op}(${e})`}}function eS(t,e){return t instanceof St?function(r,i){return i instanceof St&&r.op===i.op&&r.field.isEqual(i.field)&&Jr(r.value,i.value)}(t,e):t instanceof $r?function(r,i){return i instanceof $r&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,a,o)=>s&&eS(a,i.filters[o]),!0):!1}(t,e):void Se(19439)}function tS(t){return t instanceof St?function(n){return`${n.field.canonicalString()} ${n.op} ${Wo(n.value)}`}(t):t instanceof $r?function(n){return n.op.toString()+" {"+n.getFilters().map(tS).join(" ,")+"}"}(t):"Filter"}class xz extends St{constructor(e,n,r){super(e,n,r),this.key=Te.fromName(r.referenceValue)}matches(e){const n=Te.comparator(e.key,this.key);return this.matchesComparison(n)}}class Ez extends St{constructor(e,n){super(e,"in",n),this.keys=nS("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class Tz extends St{constructor(e,n){super(e,"not-in",n),this.keys=nS("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function nS(t,e){var n;return(((n=e.arrayValue)==null?void 0:n.values)||[]).map(r=>Te.fromName(r.referenceValue))}class Iz extends St{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return rv(n)&&lc(n.arrayValue,this.value)}}class $z extends St{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&lc(this.value.arrayValue,n)}}class kz extends St{constructor(e,n){super(e,"not-in",n)}matches(e){if(lc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!lc(this.value.arrayValue,n)}}class Sz extends St{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!rv(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>lc(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cz{constructor(e,n=null,r=[],i=[],s=null,a=null,o=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=o,this.Te=null}}function j1(t,e=null,n=[],r=[],i=null,s=null,a=null){return new Cz(t,e,n,r,i,s,a)}function iv(t){const e=Ne(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>gy(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Gf(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>Wo(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>Wo(r)).join(",")),e.Te=n}return e.Te}function sv(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!wz(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!eS(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!V1(t.startAt,e.startAt)&&V1(t.endAt,e.endAt)}function yy(t){return Te.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class il{constructor(e,n=null,r=[],i=[],s=null,a="F",o=null,l=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=o,this.endAt=l,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function Az(t,e,n,r,i,s,a,o){return new il(t,e,n,r,i,s,a,o)}function av(t){return new il(t)}function U1(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function Rz(t){return Te.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}function rS(t){return t.collectionGroup!==null}function Nu(t){const e=Ne(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const s of e.explicitOrderBy)e.Ie.push(s),n.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let o=new Ot(Ht.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(o=o.add(u.field))})}),o})(e).forEach(s=>{n.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new uc(s,r))}),n.has(Ht.keyField().canonicalString())||e.Ie.push(new uc(Ht.keyField(),r))}return e.Ie}function Gr(t){const e=Ne(t);return e.Ee||(e.Ee=Nz(e,Nu(t))),e.Ee}function Nz(t,e){if(t.limitType==="F")return j1(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(i=>{const s=i.dir==="desc"?"asc":"desc";return new uc(i.field,s)});const n=t.endAt?new af(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new af(t.startAt.position,t.startAt.inclusive):null;return j1(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function _y(t,e){const n=t.filters.concat([e]);return new il(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Pz(t,e){const n=t.explicitOrderBy.concat([e]);return new il(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}function vy(t,e,n){return new il(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Qf(t,e){return sv(Gr(t),Gr(e))&&t.limitType===e.limitType}function iS(t){return`${iv(Gr(t))}|lt:${t.limitType}`}function ro(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(i=>tS(i)).join(", ")}]`),Gf(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(i=>Wo(i)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(i=>Wo(i)).join(",")),`Target(${r})`}(Gr(t))}; limitType=${t.limitType})`}function Yf(t,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):Te.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(t,e)&&function(r,i){for(const s of Nu(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(t,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(t,e)&&function(r,i){return!(r.startAt&&!function(a,o,l){const u=z1(a,o,l);return a.inclusive?u<=0:u<0}(r.startAt,Nu(r),i)||r.endAt&&!function(a,o,l){const u=z1(a,o,l);return a.inclusive?u>=0:u>0}(r.endAt,Nu(r),i))}(t,e)}function Oz(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function sS(t){return(e,n)=>{let r=!1;for(const i of Nu(t)){const s=Dz(i,e,n);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function Dz(t,e,n){const r=t.field.isKeyField()?Te.comparator(e.key,n.key):function(s,a,o){const l=a.data.field(s),u=o.data.field(s);return l!==null&&u!==null?Fo(l,u):Se(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Se(19790,{direction:t.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oa{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){ks(this.inner,(n,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return Bk(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mz=new gt(Te.comparator);function ki(){return Mz}const aS=new gt(Te.comparator);function du(...t){let e=aS;for(const n of t)e=e.insert(n.key,n);return e}function oS(t){let e=aS;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function la(){return Pu()}function lS(){return Pu()}function Pu(){return new Oa(t=>t.toString(),(t,e)=>t.isEqual(e))}const Lz=new gt(Te.comparator),zz=new Ot(Te.comparator);function Ve(...t){let e=zz;for(const n of t)e=e.add(n);return e}const Vz=new Ot(ze);function jz(){return Vz}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ov(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:nf(e)?"-0":e}}function uS(t){return{integerValue:""+t}}function Uz(t,e){return dz(e)?uS(e):ov(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jf{constructor(){this._=void 0}}function Bz(t,e,n){return t instanceof cc?function(i,s){const a={fields:{[qk]:{stringValue:Wk},[Gk]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&nv(s)&&(s=Kf(s)),s&&(a.fields[Hk]=s),{mapValue:a}}(n,e):t instanceof dc?dS(t,e):t instanceof hc?hS(t,e):function(i,s){const a=cS(i,s),o=B1(a)+B1(i.Ae);return my(a)&&my(i.Ae)?uS(o):ov(i.serializer,o)}(t,e)}function Fz(t,e,n){return t instanceof dc?dS(t,e):t instanceof hc?hS(t,e):n}function cS(t,e){return t instanceof of?function(r){return my(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}class cc extends Jf{}class dc extends Jf{constructor(e){super(),this.elements=e}}function dS(t,e){const n=fS(e);for(const r of t.elements)n.some(i=>Jr(i,r))||n.push(r);return{arrayValue:{values:n}}}class hc extends Jf{constructor(e){super(),this.elements=e}}function hS(t,e){let n=fS(e);for(const r of t.elements)n=n.filter(i=>!Jr(i,r));return{arrayValue:{values:n}}}class of extends Jf{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function B1(t){return bt(t.integerValue||t.doubleValue)}function fS(t){return rv(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wz{constructor(e,n){this.field=e,this.transform=n}}function qz(t,e){return t.field.isEqual(e.field)&&function(r,i){return r instanceof dc&&i instanceof dc||r instanceof hc&&i instanceof hc?Bo(r.elements,i.elements,Jr):r instanceof of&&i instanceof of?Jr(r.Ae,i.Ae):r instanceof cc&&i instanceof cc}(t.transform,e.transform)}class Hz{constructor(e,n){this.version=e,this.transformResults=n}}class br{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new br}static exists(e){return new br(void 0,e)}static updateTime(e){return new br(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function vh(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Xf{}function pS(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new gS(t.key,br.none()):new kc(t.key,t.data,br.none());{const n=t.data,r=xn.empty();let i=new Ot(Ht.comparator);for(let s of e.fields)if(!i.has(s)){let a=n.field(s);a===null&&s.length>1&&(s=s.popLast(),a=n.field(s)),a===null?r.delete(s):r.set(s,a),i=i.add(s)}return new Ss(t.key,r,new Dn(i.toArray()),br.none())}}function Gz(t,e,n){t instanceof kc?function(i,s,a){const o=i.value.clone(),l=W1(i.fieldTransforms,s,a.transformResults);o.setAll(l),s.convertToFoundDocument(a.version,o).setHasCommittedMutations()}(t,e,n):t instanceof Ss?function(i,s,a){if(!vh(i.precondition,s))return void s.convertToUnknownDocument(a.version);const o=W1(i.fieldTransforms,s,a.transformResults),l=s.data;l.setAll(mS(i)),l.setAll(o),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(t,e,n):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,n)}function Ou(t,e,n,r){return t instanceof kc?function(s,a,o,l){if(!vh(s.precondition,a))return o;const u=s.value.clone(),h=q1(s.fieldTransforms,l,a);return u.setAll(h),a.convertToFoundDocument(a.version,u).setHasLocalMutations(),null}(t,e,n,r):t instanceof Ss?function(s,a,o,l){if(!vh(s.precondition,a))return o;const u=q1(s.fieldTransforms,l,a),h=a.data;return h.setAll(mS(s)),h.setAll(u),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),o===null?null:o.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(f=>f.field))}(t,e,n,r):function(s,a,o){return vh(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):o}(t,e,n)}function Kz(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),s=cS(r.transform,i||null);s!=null&&(n===null&&(n=xn.empty()),n.set(r.field,s))}return n||null}function F1(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Bo(r,i,(s,a)=>qz(s,a))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class kc extends Xf{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Ss extends Xf{constructor(e,n,r,i,s=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function mS(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function W1(t,e,n){const r=new Map;Qe(t.length===n.length,32656,{Ve:n.length,de:t.length});for(let i=0;i<n.length;i++){const s=t[i],a=s.transform,o=e.data.field(s.field);r.set(s.field,Fz(a,o,n[i]))}return r}function q1(t,e,n){const r=new Map;for(const i of t){const s=i.transform,a=n.data.field(i.field);r.set(i.field,Bz(s,a,e))}return r}class gS extends Xf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Qz extends Xf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yz{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&Gz(s,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Ou(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Ou(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=lS();return this.mutations.forEach(i=>{const s=e.get(i.key),a=s.overlayedDocument;let o=this.applyToLocalView(a,s.mutatedFields);o=n.has(i.key)?null:o;const l=pS(a,o);l!==null&&r.set(i.key,l),a.isValidDocument()||a.convertToNoDocument(Re.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Ve())}isEqual(e){return this.batchId===e.batchId&&Bo(this.mutations,e.mutations,(n,r)=>F1(n,r))&&Bo(this.baseMutations,e.baseMutations,(n,r)=>F1(n,r))}}class lv{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){Qe(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=function(){return Lz}();const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new lv(e,n,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jz{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xz{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $t,Ue;function Zz(t){switch(t){case ne.OK:return Se(64938);case ne.CANCELLED:case ne.UNKNOWN:case ne.DEADLINE_EXCEEDED:case ne.RESOURCE_EXHAUSTED:case ne.INTERNAL:case ne.UNAVAILABLE:case ne.UNAUTHENTICATED:return!1;case ne.INVALID_ARGUMENT:case ne.NOT_FOUND:case ne.ALREADY_EXISTS:case ne.PERMISSION_DENIED:case ne.FAILED_PRECONDITION:case ne.ABORTED:case ne.OUT_OF_RANGE:case ne.UNIMPLEMENTED:case ne.DATA_LOSS:return!0;default:return Se(15467,{code:t})}}function yS(t){if(t===void 0)return $i("GRPC error has no .code"),ne.UNKNOWN;switch(t){case $t.OK:return ne.OK;case $t.CANCELLED:return ne.CANCELLED;case $t.UNKNOWN:return ne.UNKNOWN;case $t.DEADLINE_EXCEEDED:return ne.DEADLINE_EXCEEDED;case $t.RESOURCE_EXHAUSTED:return ne.RESOURCE_EXHAUSTED;case $t.INTERNAL:return ne.INTERNAL;case $t.UNAVAILABLE:return ne.UNAVAILABLE;case $t.UNAUTHENTICATED:return ne.UNAUTHENTICATED;case $t.INVALID_ARGUMENT:return ne.INVALID_ARGUMENT;case $t.NOT_FOUND:return ne.NOT_FOUND;case $t.ALREADY_EXISTS:return ne.ALREADY_EXISTS;case $t.PERMISSION_DENIED:return ne.PERMISSION_DENIED;case $t.FAILED_PRECONDITION:return ne.FAILED_PRECONDITION;case $t.ABORTED:return ne.ABORTED;case $t.OUT_OF_RANGE:return ne.OUT_OF_RANGE;case $t.UNIMPLEMENTED:return ne.UNIMPLEMENTED;case $t.DATA_LOSS:return ne.DATA_LOSS;default:return Se(39323,{code:t})}}(Ue=$t||($t={}))[Ue.OK=0]="OK",Ue[Ue.CANCELLED=1]="CANCELLED",Ue[Ue.UNKNOWN=2]="UNKNOWN",Ue[Ue.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ue[Ue.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ue[Ue.NOT_FOUND=5]="NOT_FOUND",Ue[Ue.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ue[Ue.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ue[Ue.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ue[Ue.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ue[Ue.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ue[Ue.ABORTED=10]="ABORTED",Ue[Ue.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ue[Ue.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ue[Ue.INTERNAL=13]="INTERNAL",Ue[Ue.UNAVAILABLE=14]="UNAVAILABLE",Ue[Ue.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eV(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tV=new cs([4294967295,4294967295],0);function H1(t){const e=eV().encode(t),n=new Rk;return n.update(e),new Uint8Array(n.digest())}function G1(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new cs([n,r],0),new cs([i,s],0)]}class uv{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new hu(`Invalid padding: ${n}`);if(r<0)throw new hu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new hu(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new hu(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=cs.fromNumber(this.ge)}ye(e,n,r){let i=e.add(n.multiply(cs.fromNumber(r)));return i.compare(tV)===1&&(i=new cs([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=H1(e),[r,i]=G1(n);for(let s=0;s<this.hashCount;s++){const a=this.ye(r,i,s);if(!this.we(a))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new uv(s,i,n);return r.forEach(o=>a.insert(o)),a}insert(e){if(this.ge===0)return;const n=H1(e),[r,i]=G1(n);for(let s=0;s<this.hashCount;s++){const a=this.ye(r,i,s);this.be(a)}}be(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class hu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zf{constructor(e,n,r,i,s){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,Sc.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new Zf(Re.min(),i,new gt(ze),ki(),Ve())}}class Sc{constructor(e,n,r,i,s){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new Sc(r,n,Ve(),Ve(),Ve())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wh{constructor(e,n,r,i){this.Se=e,this.removedTargetIds=n,this.key=r,this.De=i}}class _S{constructor(e,n){this.targetId=e,this.Ce=n}}class vS{constructor(e,n,r=Qt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class K1{constructor(){this.ve=0,this.Fe=Q1(),this.Me=Qt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Ve(),n=Ve(),r=Ve();return this.Fe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:Se(38017,{changeType:s})}}),new Sc(this.Me,this.xe,e,n,r)}Ke(){this.Oe=!1,this.Fe=Q1()}qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,Qe(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class nV{constructor(e){this.Ge=e,this.ze=new Map,this.je=ki(),this.He=Od(),this.Je=Od(),this.Ze=new gt(ze)}Xe(e){for(const n of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:Se(56790,{state:e.state})}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach((r,i)=>{this.rt(i)&&n(i)})}st(e){const n=e.targetId,r=e.Ce.count,i=this.ot(n);if(i){const s=i.target;if(yy(s))if(r===0){const a=new Te(s.path);this.et(n,a,sn.newNoDocument(a,Re.min()))}else Qe(r===1,20013,{expectedCount:r});else{const a=this._t(n);if(a!==r){const o=this.ut(e),l=o?this.ct(o,e,a):1;if(l!==0){this.it(n);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(n,u)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=n;let a,o;try{a=ys(r).toUint8Array()}catch(l){if(l instanceof Fk)return Uo("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{o=new uv(a,i,s)}catch(l){return Uo(l instanceof hu?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return o.ge===0?null:o}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let i=0;return r.forEach(s=>{const a=this.Ge.ht(),o=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(o)||(this.et(n,s,null),i++)}),i}Tt(e){const n=new Map;this.ze.forEach((s,a)=>{const o=this.ot(a);if(o){if(s.current&&yy(o.target)){const l=new Te(o.target.path);this.It(l).has(a)||this.Et(a,l)||this.et(a,l,sn.newNoDocument(l,e))}s.Be&&(n.set(a,s.ke()),s.Ke())}});let r=Ve();this.Je.forEach((s,a)=>{let o=!0;a.forEachWhile(l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(o=!1,!1)}),o&&(r=r.add(s))}),this.je.forEach((s,a)=>a.setReadTime(e));const i=new Zf(e,n,this.Ze,this.je,r);return this.je=ki(),this.He=Od(),this.Je=Od(),this.Ze=new gt(ze),i}Ye(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).qe(n.key,r),this.je=this.je.insert(n.key,n),this.He=this.He.insert(n.key,this.It(n.key).add(e)),this.Je=this.Je.insert(n.key,this.Rt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,n)?i.qe(n,1):i.Ue(n),this.Je=this.Je.insert(n,this.Rt(n).delete(e)),this.Je=this.Je.insert(n,this.Rt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let n=this.ze.get(e);return n||(n=new K1,this.ze.set(e,n)),n}Rt(e){let n=this.Je.get(e);return n||(n=new Ot(ze),this.Je=this.Je.insert(e,n)),n}It(e){let n=this.He.get(e);return n||(n=new Ot(ze),this.He=this.He.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||me("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new K1),this.Ge.getRemoteKeysForTarget(e).forEach(n=>{this.et(e,n,null)})}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function Od(){return new gt(Te.comparator)}function Q1(){return new gt(Te.comparator)}const rV={asc:"ASCENDING",desc:"DESCENDING"},iV={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},sV={and:"AND",or:"OR"};class aV{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function wy(t,e){return t.useProto3Json||Gf(e)?e:{value:e}}function lf(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function wS(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function oV(t,e){return lf(t,e.toTimestamp())}function Kr(t){return Qe(!!t,49232),Re.fromTimestamp(function(n){const r=gs(n);return new lt(r.seconds,r.nanos)}(t))}function cv(t,e){return by(t,e).canonicalString()}function by(t,e){const n=function(i){return new st(["projects",i.projectId,"databases",i.database])}(t).child("documents");return e===void 0?n:n.child(e)}function bS(t){const e=st.fromString(t);return Qe($S(e),10190,{key:e.toString()}),e}function xy(t,e){return cv(t.databaseId,e.path)}function sm(t,e){const n=bS(e);if(n.get(1)!==t.databaseId.projectId)throw new fe(ne.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new fe(ne.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Te(ES(n))}function xS(t,e){return cv(t.databaseId,e)}function lV(t){const e=bS(t);return e.length===4?st.emptyPath():ES(e)}function Ey(t){return new st(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ES(t){return Qe(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function Y1(t,e,n){return{name:xy(t,e),fields:n.value.mapValue.fields}}function uV(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:Se(39313,{state:u})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(u,h){return u.useProto3Json?(Qe(h===void 0||typeof h=="string",58123),Qt.fromBase64String(h||"")):(Qe(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),Qt.fromUint8Array(h||new Uint8Array))}(t,e.targetChange.resumeToken),a=e.targetChange.cause,o=a&&function(u){const h=u.code===void 0?ne.UNKNOWN:yS(u.code);return new fe(h,u.message||"")}(a);n=new vS(r,i,s,o||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=sm(t,r.document.name),s=Kr(r.document.updateTime),a=r.document.createTime?Kr(r.document.createTime):Re.min(),o=new xn({mapValue:{fields:r.document.fields}}),l=sn.newFoundDocument(i,s,a,o),u=r.targetIds||[],h=r.removedTargetIds||[];n=new wh(u,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=sm(t,r.document),s=r.readTime?Kr(r.readTime):Re.min(),a=sn.newNoDocument(i,s),o=r.removedTargetIds||[];n=new wh([],o,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=sm(t,r.document),s=r.removedTargetIds||[];n=new wh([],s,i,null)}else{if(!("filter"in e))return Se(11601,{Vt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:s}=r,a=new Xz(i,s),o=r.targetId;n=new _S(o,a)}}return n}function cV(t,e){let n;if(e instanceof kc)n={update:Y1(t,e.key,e.value)};else if(e instanceof gS)n={delete:xy(t,e.key)};else if(e instanceof Ss)n={update:Y1(t,e.key,e.data),updateMask:vV(e.fieldMask)};else{if(!(e instanceof Qz))return Se(16599,{dt:e.type});n={verify:xy(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(s,a){const o=a.transform;if(o instanceof cc)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof dc)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof hc)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof of)return{fieldPath:a.field.canonicalString(),increment:o.Ae};throw Se(20930,{transform:a.transform})}(0,r))),e.precondition.isNone||(n.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:oV(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:Se(27497)}(t,e.precondition)),n}function dV(t,e){return t&&t.length>0?(Qe(e!==void 0,14353),t.map(n=>function(i,s){let a=i.updateTime?Kr(i.updateTime):Kr(s);return a.isEqual(Re.min())&&(a=Kr(s)),new Hz(a,i.transformResults||[])}(n,e))):[]}function hV(t,e){return{documents:[xS(t,e.path)]}}function fV(t,e){const n={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=xS(t,i);const s=function(u){if(u.length!==0)return IS($r.create(u,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const a=function(u){if(u.length!==0)return u.map(h=>function(p){return{field:io(p.field),direction:gV(p.dir)}}(h))}(e.orderBy);a&&(n.structuredQuery.orderBy=a);const o=wy(t,e.limit);return o!==null&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ft:n,parent:i}}function pV(t){let e=lV(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Qe(r===1,65062);const h=n.from[0];h.allDescendants?i=h.collectionId:e=e.child(h.collectionId)}let s=[];n.where&&(s=function(f){const p=TS(f);return p instanceof $r&&Zk(p)?p.getFilters():[p]}(n.where));let a=[];n.orderBy&&(a=function(f){return f.map(p=>function(_){return new uc(so(_.field),function($){switch($){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(_.direction))}(p))}(n.orderBy));let o=null;n.limit&&(o=function(f){let p;return p=typeof f=="object"?f.value:f,Gf(p)?null:p}(n.limit));let l=null;n.startAt&&(l=function(f){const p=!!f.before,g=f.values||[];return new af(g,p)}(n.startAt));let u=null;return n.endAt&&(u=function(f){const p=!f.before,g=f.values||[];return new af(g,p)}(n.endAt)),Az(e,i,a,s,o,"F",l,u)}function mV(t,e){const n=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Se(28987,{purpose:i})}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function TS(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=so(n.unaryFilter.field);return St.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=so(n.unaryFilter.field);return St.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=so(n.unaryFilter.field);return St.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=so(n.unaryFilter.field);return St.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Se(61313);default:return Se(60726)}}(t):t.fieldFilter!==void 0?function(n){return St.create(so(n.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Se(58110);default:return Se(50506)}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return $r.create(n.compositeFilter.filters.map(r=>TS(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Se(1026)}}(n.compositeFilter.op))}(t):Se(30097,{filter:t})}function gV(t){return rV[t]}function yV(t){return iV[t]}function _V(t){return sV[t]}function io(t){return{fieldPath:t.canonicalString()}}function so(t){return Ht.fromServerFormat(t.fieldPath)}function IS(t){return t instanceof St?function(n){if(n.op==="=="){if(L1(n.value))return{unaryFilter:{field:io(n.field),op:"IS_NAN"}};if(M1(n.value))return{unaryFilter:{field:io(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(L1(n.value))return{unaryFilter:{field:io(n.field),op:"IS_NOT_NAN"}};if(M1(n.value))return{unaryFilter:{field:io(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:io(n.field),op:yV(n.op),value:n.value}}}(t):t instanceof $r?function(n){const r=n.getFilters().map(i=>IS(i));return r.length===1?r[0]:{compositeFilter:{op:_V(n.op),filters:r}}}(t):Se(54877,{filter:t})}function vV(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function $S(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}function kS(t){return!!t&&typeof t._toProto=="function"&&t._protoValueType==="ProtoValue"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zi{constructor(e,n,r,i,s=Re.min(),a=Re.min(),o=Qt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=o,this.expectedCount=l}withSequenceNumber(e){return new Zi(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new Zi(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Zi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Zi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wV{constructor(e){this.yt=e}}function bV(t){const e=pV({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?vy(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xV{constructor(){this.Sn=new EV}addToCollectionParentIndex(e,n){return this.Sn.add(n),ie.resolve()}getCollectionParents(e,n){return ie.resolve(this.Sn.getEntries(n))}addFieldIndex(e,n){return ie.resolve()}deleteFieldIndex(e,n){return ie.resolve()}deleteAllFieldIndexes(e){return ie.resolve()}createTargetIndexes(e,n){return ie.resolve()}getDocumentsMatchingTarget(e,n){return ie.resolve(null)}getIndexType(e,n){return ie.resolve(0)}getFieldIndexes(e,n){return ie.resolve([])}getNextCollectionGroupToUpdate(e){return ie.resolve(null)}getMinOffset(e,n){return ie.resolve(ms.min())}getMinOffsetFromCollectionGroup(e,n){return ie.resolve(ms.min())}updateCollectionGroup(e,n,r){return ie.resolve()}updateIndexEntries(e,n){return ie.resolve()}}class EV{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new Ot(st.comparator),s=!i.has(r);return this.index[n]=i.add(r),s}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Ot(st.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J1={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},SS=41943040;class wn{static withCacheSize(e){return new wn(e,wn.DEFAULT_COLLECTION_PERCENTILE,wn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */wn.DEFAULT_COLLECTION_PERCENTILE=10,wn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,wn.DEFAULT=new wn(SS,wn.DEFAULT_COLLECTION_PERCENTILE,wn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),wn.DISABLED=new wn(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qo{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new qo(0)}static ar(){return new qo(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X1="LruGarbageCollector",TV=1048576;function Z1([t,e],[n,r]){const i=ze(t,n);return i===0?ze(e,r):i}class IV{constructor(e){this.Pr=e,this.buffer=new Ot(Z1),this.Tr=0}Ir(){return++this.Tr}Er(e){const n=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();Z1(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class $V{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){me(X1,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){rl(n)?me(X1,"Ignoring IndexedDB error during garbage collection: ",n):await nl(n)}await this.Ar(3e5)})}}class kV{constructor(e,n){this.Vr=e,this.params=n}calculateTargetCount(e,n){return this.Vr.dr(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return ie.resolve(Hf.ce);const r=new IV(n);return this.Vr.forEachTarget(e,i=>r.Er(i.sequenceNumber)).next(()=>this.Vr.mr(e,i=>r.Er(i))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.Vr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.Vr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(me("LruGarbageCollector","Garbage collection skipped; disabled"),ie.resolve(J1)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(me("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),J1):this.gr(e,n))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,n){let r,i,s,a,o,l,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(me("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),i=this.params.maximumSequenceNumbersToCollect):i=f,a=Date.now(),this.nthSequenceNumber(e,i))).next(f=>(r=f,o=Date.now(),this.removeTargets(e,r,n))).next(f=>(s=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(u=Date.now(),no()<=Le.DEBUG&&me("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-h}ms
	Determined least recently used ${i} in `+(o-a)+`ms
	Removed ${s} targets in `+(l-o)+`ms
	Removed ${f} documents in `+(u-l)+`ms
Total Duration: ${u-h}ms`),ie.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:f})))}}function SV(t,e){return new kV(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CV{constructor(){this.changes=new Oa(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,sn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?ie.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AV{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RV{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,n))).next(i=>(r!==null&&Ou(r.mutation,i,Dn.empty(),lt.now()),i))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Ve()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Ve()){const i=la();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,r).next(s=>{let a=du();return s.forEach((o,l)=>{a=a.insert(o,l.overlayedDocument)}),a}))}getOverlayedDocuments(e,n){const r=la();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Ve()))}populateOverlays(e,n,r){const i=[];return r.forEach(s=>{n.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,o)=>{n.set(a,o)})})}computeViews(e,n,r,i){let s=ki();const a=Pu(),o=function(){return Pu()}();return n.forEach((l,u)=>{const h=r.get(u.key);i.has(u.key)&&(h===void 0||h.mutation instanceof Ss)?s=s.insert(u.key,u):h!==void 0?(a.set(u.key,h.mutation.getFieldMask()),Ou(h.mutation,u,h.mutation.getFieldMask(),lt.now())):a.set(u.key,Dn.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((u,h)=>a.set(u,h)),n.forEach((u,h)=>o.set(u,new AV(h,a.get(u)??null))),o))}recalculateAndSaveOverlays(e,n){const r=Pu();let i=new gt((a,o)=>a-o),s=Ve();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(a=>{for(const o of a)o.keys().forEach(l=>{const u=n.get(l);if(u===null)return;let h=r.get(l)||Dn.empty();h=o.applyToLocalView(u,h),r.set(l,h);const f=(i.get(o.batchId)||Ve()).add(l);i=i.insert(o.batchId,f)})}).next(()=>{const a=[],o=i.getReverseIterator();for(;o.hasNext();){const l=o.getNext(),u=l.key,h=l.value,f=lS();h.forEach(p=>{if(!s.has(p)){const g=pS(n.get(p),r.get(p));g!==null&&f.set(p,g),s=s.add(p)}}),a.push(this.documentOverlayCache.saveOverlays(e,u,f))}return ie.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,i){return Rz(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):rS(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next(s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-s.size):ie.resolve(la());let o=sc,l=s;return a.next(u=>ie.forEach(u,(h,f)=>(o<f.largestBatchId&&(o=f.largestBatchId),s.get(h)?ie.resolve():this.remoteDocumentCache.getEntry(e,h).next(p=>{l=l.insert(h,p)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,l,u,Ve())).next(h=>({batchId:o,changes:oS(h)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Te(n)).next(r=>{let i=du();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const s=n.collectionGroup;let a=du();return this.indexManager.getCollectionParents(e,s).next(o=>ie.forEach(o,l=>{const u=function(f,p){return new il(p,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(n,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,r,i).next(h=>{h.forEach((f,p)=>{a=a.insert(f,p)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,n,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,s,i))).next(a=>{s.forEach((l,u)=>{const h=u.getKey();a.get(h)===null&&(a=a.insert(h,sn.newInvalidDocument(h)))});let o=du();return a.forEach((l,u)=>{const h=s.get(l);h!==void 0&&Ou(h.mutation,u,Dn.empty(),lt.now()),Yf(n,u)&&(o=o.insert(l,u))}),o})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NV{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,n){return ie.resolve(this.Nr.get(n))}saveBundleMetadata(e,n){return this.Nr.set(n.id,function(i){return{id:i.id,version:i.version,createTime:Kr(i.createTime)}}(n)),ie.resolve()}getNamedQuery(e,n){return ie.resolve(this.Br.get(n))}saveNamedQuery(e,n){return this.Br.set(n.name,function(i){return{name:i.name,query:bV(i.bundledQuery),readTime:Kr(i.readTime)}}(n)),ie.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PV{constructor(){this.overlays=new gt(Te.comparator),this.Lr=new Map}getOverlay(e,n){return ie.resolve(this.overlays.get(n))}getOverlays(e,n){const r=la();return ie.forEach(n,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((i,s)=>{this.bt(e,n,s)}),ie.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.Lr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Lr.delete(r)),ie.resolve()}getOverlaysForCollection(e,n,r){const i=la(),s=n.length+1,a=new Te(n.child("")),o=this.overlays.getIteratorFrom(a);for(;o.hasNext();){const l=o.getNext().value,u=l.getKey();if(!n.isPrefixOf(u.path))break;u.path.length===s&&l.largestBatchId>r&&i.set(l.getKey(),l)}return ie.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let s=new gt((u,h)=>u-h);const a=this.overlays.getIterator();for(;a.hasNext();){const u=a.getNext().value;if(u.getKey().getCollectionGroup()===n&&u.largestBatchId>r){let h=s.get(u.largestBatchId);h===null&&(h=la(),s=s.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const o=la(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,h)=>o.set(u,h)),!(o.size()>=i)););return ie.resolve(o)}bt(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const a=this.Lr.get(i.largestBatchId).delete(r.key);this.Lr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Jz(n,r));let s=this.Lr.get(n);s===void 0&&(s=Ve(),this.Lr.set(n,s)),this.Lr.set(n,s.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OV{constructor(){this.sessionToken=Qt.EMPTY_BYTE_STRING}getSessionToken(e){return ie.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,ie.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dv{constructor(){this.kr=new Ot(Ut.Kr),this.qr=new Ot(Ut.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,n){const r=new Ut(e,n);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Wr(new Ut(e,n))}Qr(e,n){e.forEach(r=>this.removeReference(r,n))}Gr(e){const n=new Te(new st([])),r=new Ut(n,e),i=new Ut(n,e+1),s=[];return this.qr.forEachInRange([r,i],a=>{this.Wr(a),s.push(a.key)}),s}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const n=new Te(new st([])),r=new Ut(n,e),i=new Ut(n,e+1);let s=Ve();return this.qr.forEachInRange([r,i],a=>{s=s.add(a.key)}),s}containsKey(e){const n=new Ut(e,0),r=this.kr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Ut{constructor(e,n){this.key=e,this.Hr=n}static Kr(e,n){return Te.comparator(e.key,n.key)||ze(e.Hr,n.Hr)}static Ur(e,n){return ze(e.Hr,n.Hr)||Te.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DV{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Yn=1,this.Jr=new Ot(Ut.Kr)}checkEmpty(e){return ie.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const s=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Yz(s,n,r,i);this.mutationQueue.push(a);for(const o of i)this.Jr=this.Jr.add(new Ut(o.key,s)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return ie.resolve(a)}lookupMutationBatch(e,n){return ie.resolve(this.Zr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.Xr(r),s=i<0?0:i;return ie.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return ie.resolve(this.mutationQueue.length===0?tv:this.Yn-1)}getAllMutationBatches(e){return ie.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Ut(n,0),i=new Ut(n,Number.POSITIVE_INFINITY),s=[];return this.Jr.forEachInRange([r,i],a=>{const o=this.Zr(a.Hr);s.push(o)}),ie.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Ot(ze);return n.forEach(i=>{const s=new Ut(i,0),a=new Ut(i,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([s,a],o=>{r=r.add(o.Hr)})}),ie.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let s=r;Te.isDocumentKey(s)||(s=s.child(""));const a=new Ut(new Te(s),0);let o=new Ot(ze);return this.Jr.forEachWhile(l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===i&&(o=o.add(l.Hr)),!0)},a),ie.resolve(this.Yr(o))}Yr(e){const n=[];return e.forEach(r=>{const i=this.Zr(r);i!==null&&n.push(i)}),n}removeMutationBatch(e,n){Qe(this.ei(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Jr;return ie.forEach(n.mutations,i=>{const s=new Ut(i.key,n.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Jr=r})}nr(e){}containsKey(e,n){const r=new Ut(n,0),i=this.Jr.firstAfterOrEqual(r);return ie.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,ie.resolve()}ei(e,n){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const n=this.Xr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MV{constructor(e){this.ti=e,this.docs=function(){return new gt(Te.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),s=i?i.size:0,a=this.ti(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return ie.resolve(r?r.document.mutableCopy():sn.newInvalidDocument(n))}getEntries(e,n){let r=ki();return n.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():sn.newInvalidDocument(i))}),ie.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let s=ki();const a=n.path,o=new Te(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(o);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!a.isPrefixOf(u.path))break;u.path.length>a.length+1||oz(az(h),r)<=0||(i.has(h.key)||Yf(n,h))&&(s=s.insert(h.key,h.mutableCopy()))}return ie.resolve(s)}getAllFromCollectionGroup(e,n,r,i){Se(9500)}ni(e,n){return ie.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new LV(this)}getSize(e){return ie.resolve(this.size)}}class LV extends CV{constructor(e){super(),this.Mr=e}applyChanges(e){const n=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?n.push(this.Mr.addEntry(e,i)):this.Mr.removeEntry(r)}),ie.waitFor(n)}getFromCache(e,n){return this.Mr.getEntry(e,n)}getAllFromCache(e,n){return this.Mr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zV{constructor(e){this.persistence=e,this.ri=new Oa(n=>iv(n),sv),this.lastRemoteSnapshotVersion=Re.min(),this.highestTargetId=0,this.ii=0,this.si=new dv,this.targetCount=0,this.oi=qo._r()}forEachTarget(e,n){return this.ri.forEach((r,i)=>n(i)),ie.resolve()}getLastRemoteSnapshotVersion(e){return ie.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ie.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),ie.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.ii&&(this.ii=n),ie.resolve()}lr(e){this.ri.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.oi=new qo(n),this.highestTargetId=n),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,n){return this.lr(n),this.targetCount+=1,ie.resolve()}updateTargetData(e,n){return this.lr(n),ie.resolve()}removeTargetData(e,n){return this.ri.delete(n.target),this.si.Gr(n.targetId),this.targetCount-=1,ie.resolve()}removeTargets(e,n,r){let i=0;const s=[];return this.ri.forEach((a,o)=>{o.sequenceNumber<=n&&r.get(o.targetId)===null&&(this.ri.delete(a),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),i++)}),ie.waitFor(s).next(()=>i)}getTargetCount(e){return ie.resolve(this.targetCount)}getTargetData(e,n){const r=this.ri.get(n)||null;return ie.resolve(r)}addMatchingKeys(e,n,r){return this.si.$r(n,r),ie.resolve()}removeMatchingKeys(e,n,r){this.si.Qr(n,r);const i=this.persistence.referenceDelegate,s=[];return i&&n.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),ie.waitFor(s)}removeMatchingKeysForTargetId(e,n){return this.si.Gr(n),ie.resolve()}getMatchingKeysForTargetId(e,n){const r=this.si.jr(n);return ie.resolve(r)}containsKey(e,n){return ie.resolve(this.si.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CS{constructor(e,n){this._i={},this.overlays={},this.ai=new Hf(0),this.ui=!1,this.ui=!0,this.ci=new OV,this.referenceDelegate=e(this),this.li=new zV(this),this.indexManager=new xV,this.remoteDocumentCache=function(i){return new MV(i)}(r=>this.referenceDelegate.hi(r)),this.serializer=new wV(n),this.Pi=new NV(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new PV,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this._i[e.toKey()];return r||(r=new DV(n,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,n,r){me("MemoryPersistence","Starting transaction:",e);const i=new VV(this.ai.next());return this.referenceDelegate.Ti(),r(i).next(s=>this.referenceDelegate.Ii(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ei(e,n){return ie.or(Object.values(this._i).map(r=>()=>r.containsKey(e,n)))}}class VV extends uz{constructor(e){super(),this.currentSequenceNumber=e}}class hv{constructor(e){this.persistence=e,this.Ri=new dv,this.Ai=null}static Vi(e){return new hv(e)}get di(){if(this.Ai)return this.Ai;throw Se(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.di.delete(r.toString()),ie.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.di.add(r.toString()),ie.resolve()}markPotentiallyOrphaned(e,n){return this.di.add(n.toString()),ie.resolve()}removeTarget(e,n){this.Ri.Gr(n.targetId).forEach(i=>this.di.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(i=>{i.forEach(s=>this.di.add(s.toString()))}).next(()=>r.removeTargetData(e,n))}Ti(){this.Ai=new Set}Ii(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ie.forEach(this.di,r=>{const i=Te.fromPath(r);return this.mi(e,i).next(s=>{s||n.removeEntry(i,Re.min())})}).next(()=>(this.Ai=null,n.apply(e)))}updateLimboDocument(e,n){return this.mi(e,n).next(r=>{r?this.di.delete(n.toString()):this.di.add(n.toString())})}hi(e){return 0}mi(e,n){return ie.or([()=>ie.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ei(e,n)])}}class uf{constructor(e,n){this.persistence=e,this.fi=new Oa(r=>hz(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=SV(this,n)}static Vi(e,n){return new uf(e,n)}Ti(){}Ii(e){return ie.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}dr(e){const n=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>n.next(i=>r+i))}pr(e){let n=0;return this.mr(e,r=>{n++}).next(()=>n)}mr(e,n){return ie.forEach(this.fi,(r,i)=>this.wr(e,r,i).next(s=>s?ie.resolve():n(i)))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ni(e,a=>this.wr(e,a,n).next(o=>{o||(r++,s.removeEntry(a,Re.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,n){return this.fi.set(n,e.currentSequenceNumber),ie.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.fi.set(r,e.currentSequenceNumber),ie.resolve()}removeReference(e,n,r){return this.fi.set(r,e.currentSequenceNumber),ie.resolve()}updateLimboDocument(e,n){return this.fi.set(n,e.currentSequenceNumber),ie.resolve()}hi(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=yh(e.data.value)),n}wr(e,n,r){return ie.or([()=>this.persistence.Ei(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.fi.get(n);return ie.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fv{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.Ts=r,this.Is=i}static Es(e,n){let r=Ve(),i=Ve();for(const s of n.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new fv(e,n.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jV{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UV{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=function(){return hO()?8:cz(on())>0?6:4}()}initialize(e,n){this.fs=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,i){const s={result:null};return this.gs(e,n).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ps(e,n,i,r).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new jV;return this.ys(e,n,a).next(o=>{if(s.result=o,this.As)return this.ws(e,n,a,o.size)})}).next(()=>s.result)}ws(e,n,r,i){return r.documentReadCount<this.Vs?(no()<=Le.DEBUG&&me("QueryEngine","SDK will not create cache indexes for query:",ro(n),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),ie.resolve()):(no()<=Le.DEBUG&&me("QueryEngine","Query:",ro(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.ds*i?(no()<=Le.DEBUG&&me("QueryEngine","The SDK decides to create cache indexes for query:",ro(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Gr(n))):ie.resolve())}gs(e,n){if(U1(n))return ie.resolve(null);let r=Gr(n);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=vy(n,null,"F"),r=Gr(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const a=Ve(...s);return this.fs.getDocuments(e,a).next(o=>this.indexManager.getMinOffset(e,r).next(l=>{const u=this.bs(n,o);return this.Ss(n,u,a,l.readTime)?this.gs(e,vy(n,null,"F")):this.Ds(e,u,n,l)}))})))}ps(e,n,r,i){return U1(n)||i.isEqual(Re.min())?ie.resolve(null):this.fs.getDocuments(e,r).next(s=>{const a=this.bs(n,s);return this.Ss(n,a,r,i)?ie.resolve(null):(no()<=Le.DEBUG&&me("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ro(n)),this.Ds(e,a,n,sz(i,sc)).next(o=>o))})}bs(e,n){let r=new Ot(sS(e));return n.forEach((i,s)=>{Yf(e,s)&&(r=r.add(s))}),r}Ss(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const s=e.limitType==="F"?n.last():n.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ys(e,n,r){return no()<=Le.DEBUG&&me("QueryEngine","Using full collection scan to execute query:",ro(n)),this.fs.getDocumentsMatchingQuery(e,n,ms.min(),r)}Ds(e,n,r,i){return this.fs.getDocumentsMatchingQuery(e,r,i).next(s=>(n.forEach(a=>{s=s.insert(a.key,a)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pv="LocalStore",BV=3e8;class FV{constructor(e,n,r,i){this.persistence=e,this.Cs=n,this.serializer=i,this.vs=new gt(ze),this.Fs=new Oa(s=>iv(s),sv),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new RV(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.vs))}}function WV(t,e,n,r){return new FV(t,e,n,r)}async function AS(t,e){const n=Ne(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,n.Os(e),n.mutationQueue.getAllMutationBatches(r))).next(s=>{const a=[],o=[];let l=Ve();for(const u of i){a.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}for(const u of s){o.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}return n.localDocuments.getDocuments(r,l).next(u=>({Ns:u,removedBatchIds:a,addedBatchIds:o}))})})}function qV(t,e){const n=Ne(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=n.xs.newChangeBuffer({trackRemovals:!0});return function(o,l,u,h){const f=u.batch,p=f.keys();let g=ie.resolve();return p.forEach(_=>{g=g.next(()=>h.getEntry(l,_)).next(x=>{const $=u.docVersions.get(_);Qe($!==null,48541),x.version.compareTo($)<0&&(f.applyToRemoteDocument(x,u),x.isValidDocument()&&(x.setReadTime(u.commitVersion),h.addEntry(x)))})}),g.next(()=>o.mutationQueue.removeMutationBatch(l,f))}(n,r,e,s).next(()=>s.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(o){let l=Ve();for(let u=0;u<o.mutationResults.length;++u)o.mutationResults[u].transformResults.length>0&&(l=l.add(o.batch.mutations[u].key));return l}(e))).next(()=>n.localDocuments.getDocuments(r,i))})}function RS(t){const e=Ne(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.li.getLastRemoteSnapshotVersion(n))}function HV(t,e){const n=Ne(t),r=e.snapshotVersion;let i=n.vs;return n.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=n.xs.newChangeBuffer({trackRemovals:!0});i=n.vs;const o=[];e.targetChanges.forEach((h,f)=>{const p=i.get(f);if(!p)return;o.push(n.li.removeMatchingKeys(s,h.removedDocuments,f).next(()=>n.li.addMatchingKeys(s,h.addedDocuments,f)));let g=p.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(f)!==null?g=g.withResumeToken(Qt.EMPTY_BYTE_STRING,Re.min()).withLastLimboFreeSnapshotVersion(Re.min()):h.resumeToken.approximateByteSize()>0&&(g=g.withResumeToken(h.resumeToken,r)),i=i.insert(f,g),function(x,$,w){return x.resumeToken.approximateByteSize()===0||$.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=BV?!0:w.addedDocuments.size+w.modifiedDocuments.size+w.removedDocuments.size>0}(p,g,h)&&o.push(n.li.updateTargetData(s,g))});let l=ki(),u=Ve();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(s,h))}),o.push(GV(s,a,e.documentUpdates).next(h=>{l=h.Bs,u=h.Ls})),!r.isEqual(Re.min())){const h=n.li.getLastRemoteSnapshotVersion(s).next(f=>n.li.setTargetsMetadata(s,s.currentSequenceNumber,r));o.push(h)}return ie.waitFor(o).next(()=>a.apply(s)).next(()=>n.localDocuments.getLocalViewOfDocuments(s,l,u)).next(()=>l)}).then(s=>(n.vs=i,s))}function GV(t,e,n){let r=Ve(),i=Ve();return n.forEach(s=>r=r.add(s)),e.getEntries(t,r).next(s=>{let a=ki();return n.forEach((o,l)=>{const u=s.get(o);l.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(o)),l.isNoDocument()&&l.version.isEqual(Re.min())?(e.removeEntry(o,l.readTime),a=a.insert(o,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),a=a.insert(o,l)):me(pv,"Ignoring outdated watch update for ",o,". Current version:",u.version," Watch version:",l.version)}),{Bs:a,Ls:i}})}function KV(t,e){const n=Ne(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=tv),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function QV(t,e){const n=Ne(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return n.li.getTargetData(r,e).next(s=>s?(i=s,ie.resolve(i)):n.li.allocateTargetId(r).next(a=>(i=new Zi(e,a,"TargetPurposeListen",r.currentSequenceNumber),n.li.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=n.vs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.vs=n.vs.insert(r.targetId,r),n.Fs.set(e,r.targetId)),r})}async function Ty(t,e,n){const r=Ne(t),i=r.vs.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,a=>r.persistence.referenceDelegate.removeTarget(a,i))}catch(a){if(!rl(a))throw a;me(pv,`Failed to update sequence numbers for target ${e}: ${a}`)}r.vs=r.vs.remove(e),r.Fs.delete(i.target)}function eb(t,e,n){const r=Ne(t);let i=Re.min(),s=Ve();return r.persistence.runTransaction("Execute query","readwrite",a=>function(l,u,h){const f=Ne(l),p=f.Fs.get(h);return p!==void 0?ie.resolve(f.vs.get(p)):f.li.getTargetData(u,h)}(r,a,Gr(e)).next(o=>{if(o)return i=o.lastLimboFreeSnapshotVersion,r.li.getMatchingKeysForTargetId(a,o.targetId).next(l=>{s=l})}).next(()=>r.Cs.getDocumentsMatchingQuery(a,e,n?i:Re.min(),n?s:Ve())).next(o=>(YV(r,Oz(e),o),{documents:o,ks:s})))}function YV(t,e,n){let r=t.Ms.get(e)||Re.min();n.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),t.Ms.set(e,r)}class tb{constructor(){this.activeTargetIds=jz()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class JV{constructor(){this.vo=new tb,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,n,r){this.Fo[e]=n}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new tb,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XV{Mo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nb="ConnectivityMonitor";class rb{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){me(nb,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){me(nb,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Dd=null;function Iy(){return Dd===null?Dd=function(){return 268435456+Math.round(2147483648*Math.random())}():Dd++,"0x"+Dd.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const am="RestConnection",ZV={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class ej{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.qo=n+"://"+e.host,this.Uo=`projects/${r}/databases/${i}`,this.$o=this.databaseId.database===rf?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Wo(e,n,r,i,s){const a=Iy(),o=this.Qo(e,n.toUriEncodedString());me(am,`Sending RPC '${e}' ${a}:`,o,r);const l={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(l,i,s);const{host:u}=new URL(o),h=Ra(u);return this.zo(e,o,l,r,h).then(f=>(me(am,`Received RPC '${e}' ${a}: `,f),f),f=>{throw Uo(am,`RPC '${e}' ${a} failed with error: `,f,"url: ",o,"request:",r),f})}jo(e,n,r,i,s,a){return this.Wo(e,n,r,i,s)}Go(e,n,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+tl}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}Qo(e,n){const r=ZV[e];let i=`${this.qo}/v1/${n}:${r}`;return this.databaseInfo.apiKey&&(i=`${i}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),i}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tj{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const en="WebChannelConnection",ql=(t,e,n)=>{t.listen(e,r=>{try{n(r)}catch(i){setTimeout(()=>{throw i},0)}})};class Ro extends ej{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!Ro.c_){const e=Dk();ql(e,Ok.STAT_EVENT,n=>{n.stat===hy.PROXY?me(en,"STAT_EVENT: detected buffering proxy"):n.stat===hy.NOPROXY&&me(en,"STAT_EVENT: detected no buffering proxy")}),Ro.c_=!0}}zo(e,n,r,i,s){const a=Iy();return new Promise((o,l)=>{const u=new Nk;u.setWithCredentials(!0),u.listenOnce(Pk.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case gh.NO_ERROR:const f=u.getResponseJson();me(en,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(f)),o(f);break;case gh.TIMEOUT:me(en,`RPC '${e}' ${a} timed out`),l(new fe(ne.DEADLINE_EXCEEDED,"Request time out"));break;case gh.HTTP_ERROR:const p=u.getStatus();if(me(en,`RPC '${e}' ${a} failed with status:`,p,"response text:",u.getResponseText()),p>0){let g=u.getResponseJson();Array.isArray(g)&&(g=g[0]);const _=g==null?void 0:g.error;if(_&&_.status&&_.message){const x=function(w){const y=w.toLowerCase().replace(/_/g,"-");return Object.values(ne).indexOf(y)>=0?y:ne.UNKNOWN}(_.status);l(new fe(x,_.message))}else l(new fe(ne.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new fe(ne.UNAVAILABLE,"Connection failed."));break;default:Se(9055,{l_:e,streamId:a,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{me(en,`RPC '${e}' ${a} completed.`)}});const h=JSON.stringify(i);me(en,`RPC '${e}' ${a} sending request:`,i),u.send(n,"POST",h,r,15)})}T_(e,n,r){const i=Iy(),s=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Go(o.initMessageHeaders,n,r),o.encodeInitMessageHeaders=!0;const u=s.join("");me(en,`Creating RPC '${e}' stream ${i}: ${u}`,o);const h=a.createWebChannel(u,o);this.I_(h);let f=!1,p=!1;const g=new tj({Ho:_=>{p?me(en,`Not sending because RPC '${e}' stream ${i} is closed:`,_):(f||(me(en,`Opening RPC '${e}' stream ${i} transport.`),h.open(),f=!0),me(en,`RPC '${e}' stream ${i} sending:`,_),h.send(_))},Jo:()=>h.close()});return ql(h,cu.EventType.OPEN,()=>{p||(me(en,`RPC '${e}' stream ${i} transport opened.`),g.i_())}),ql(h,cu.EventType.CLOSE,()=>{p||(p=!0,me(en,`RPC '${e}' stream ${i} transport closed`),g.o_(),this.E_(h))}),ql(h,cu.EventType.ERROR,_=>{p||(p=!0,Uo(en,`RPC '${e}' stream ${i} transport errored. Name:`,_.name,"Message:",_.message),g.o_(new fe(ne.UNAVAILABLE,"The operation could not be completed")))}),ql(h,cu.EventType.MESSAGE,_=>{var x;if(!p){const $=_.data[0];Qe(!!$,16349);const w=$,y=(w==null?void 0:w.error)||((x=w[0])==null?void 0:x.error);if(y){me(en,`RPC '${e}' stream ${i} received error:`,y);const I=y.status;let R=function(C){const k=$t[C];if(k!==void 0)return yS(k)}(I),M=y.message;R===void 0&&(R=ne.INTERNAL,M="Unknown error status: "+I+" with message "+y.message),p=!0,g.o_(new fe(R,M)),h.close()}else me(en,`RPC '${e}' stream ${i} received:`,$),g.__($)}}),Ro.u_(),setTimeout(()=>{g.s_()},0),g}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(n=>n===e)}Go(e,n,r){super.Go(e,n,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return Mk()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nj(t){return new Ro(t)}function om(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ep(t){return new aV(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ro.c_=!1;class NS{constructor(e,n,r=1e3,i=1.5,s=6e4){this.Ci=e,this.timerId=n,this.R_=r,this.A_=i,this.V_=s,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const n=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,n-r);i>0&&me("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.d_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ib="PersistentStream";class PS{constructor(e,n,r,i,s,a,o,l){this.Ci=e,this.b_=r,this.S_=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=o,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new NS(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===ne.RESOURCE_EXHAUSTED?($i(n.toString()),$i("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===ne.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(n)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.D_===n&&this.G_(r,i)},r=>{e(()=>{const i=new fe(ne.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)})})}G_(e,n){const r=this.Q_(this.D_);this.stream=this.j_(e,n),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.Yo(()=>{r(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(i=>{r(()=>this.z_(i))}),this.stream.onMessage(i=>{r(()=>++this.F_==1?this.H_(i):this.onNext(i))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return me(ib,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return n=>{this.Ci.enqueueAndForget(()=>this.D_===e?n():(me(ib,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class rj extends PS{constructor(e,n,r,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,a),this.serializer=s}j_(e,n){return this.connection.T_("Listen",e,n)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=uV(this.serializer,e),r=function(s){if(!("targetChange"in s))return Re.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?Re.min():a.readTime?Kr(a.readTime):Re.min()}(e);return this.listener.J_(n,r)}Z_(e){const n={};n.database=Ey(this.serializer),n.addTarget=function(s,a){let o;const l=a.target;if(o=yy(l)?{documents:hV(s,l)}:{query:fV(s,l).ft},o.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){o.resumeToken=wS(s,a.resumeToken);const u=wy(s,a.expectedCount);u!==null&&(o.expectedCount=u)}else if(a.snapshotVersion.compareTo(Re.min())>0){o.readTime=lf(s,a.snapshotVersion.toTimestamp());const u=wy(s,a.expectedCount);u!==null&&(o.expectedCount=u)}return o}(this.serializer,e);const r=mV(this.serializer,e);r&&(n.labels=r),this.K_(n)}X_(e){const n={};n.database=Ey(this.serializer),n.removeTarget=e,this.K_(n)}}class ij extends PS{constructor(e,n,r,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,a),this.serializer=s}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}H_(e){return Qe(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Qe(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Qe(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=dV(e.writeResults,e.commitTime),r=Kr(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=Ey(this.serializer),this.K_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>cV(this.serializer,r))};this.K_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sj{}class aj extends sj{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new fe(ne.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Wo(e,by(n,r),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===ne.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new fe(ne.UNKNOWN,s.toString())})}jo(e,n,r,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.jo(e,by(n,r),i,a,o,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===ne.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new fe(ne.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}function oj(t,e,n,r){return new aj(t,e,n,r)}class lj{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?($i(n),this.aa=!1):me("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ta="RemoteStore";class uj{constructor(e,n,r,i,s){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=s,this.Aa.Mo(a=>{r.enqueueAndForget(async()=>{Da(this)&&(me(Ta,"Restarting streams for network reachability change."),await async function(l){const u=Ne(l);u.Ea.add(4),await Cc(u),u.Va.set("Unknown"),u.Ea.delete(4),await tp(u)}(this))})}),this.Va=new lj(r,i)}}async function tp(t){if(Da(t))for(const e of t.Ra)await e(!0)}async function Cc(t){for(const e of t.Ra)await e(!1)}function OS(t,e){const n=Ne(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),_v(n)?yv(n):sl(n).O_()&&gv(n,e))}function mv(t,e){const n=Ne(t),r=sl(n);n.Ia.delete(e),r.O_()&&DS(n,e),n.Ia.size===0&&(r.O_()?r.L_():Da(n)&&n.Va.set("Unknown"))}function gv(t,e){if(t.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Re.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}sl(t).Z_(e)}function DS(t,e){t.da.$e(e),sl(t).X_(e)}function yv(t){t.da=new nV({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),sl(t).start(),t.Va.ua()}function _v(t){return Da(t)&&!sl(t).x_()&&t.Ia.size>0}function Da(t){return Ne(t).Ea.size===0}function MS(t){t.da=void 0}async function cj(t){t.Va.set("Online")}async function dj(t){t.Ia.forEach((e,n)=>{gv(t,e)})}async function hj(t,e){MS(t),_v(t)?(t.Va.ha(e),yv(t)):t.Va.set("Unknown")}async function fj(t,e,n){if(t.Va.set("Online"),e instanceof vS&&e.state===2&&e.cause)try{await async function(i,s){const a=s.cause;for(const o of s.targetIds)i.Ia.has(o)&&(await i.remoteSyncer.rejectListen(o,a),i.Ia.delete(o),i.da.removeTarget(o))}(t,e)}catch(r){me(Ta,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await cf(t,r)}else if(e instanceof wh?t.da.Xe(e):e instanceof _S?t.da.st(e):t.da.tt(e),!n.isEqual(Re.min()))try{const r=await RS(t.localStore);n.compareTo(r)>=0&&await function(s,a){const o=s.da.Tt(a);return o.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const h=s.Ia.get(u);h&&s.Ia.set(u,h.withResumeToken(l.resumeToken,a))}}),o.targetMismatches.forEach((l,u)=>{const h=s.Ia.get(l);if(!h)return;s.Ia.set(l,h.withResumeToken(Qt.EMPTY_BYTE_STRING,h.snapshotVersion)),DS(s,l);const f=new Zi(h.target,l,u,h.sequenceNumber);gv(s,f)}),s.remoteSyncer.applyRemoteEvent(o)}(t,n)}catch(r){me(Ta,"Failed to raise snapshot:",r),await cf(t,r)}}async function cf(t,e,n){if(!rl(e))throw e;t.Ea.add(1),await Cc(t),t.Va.set("Offline"),n||(n=()=>RS(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{me(Ta,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await tp(t)})}function LS(t,e){return e().catch(n=>cf(t,n,e))}async function np(t){const e=Ne(t),n=vs(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:tv;for(;pj(e);)try{const i=await KV(e.localStore,r);if(i===null){e.Ta.length===0&&n.L_();break}r=i.batchId,mj(e,i)}catch(i){await cf(e,i)}zS(e)&&VS(e)}function pj(t){return Da(t)&&t.Ta.length<10}function mj(t,e){t.Ta.push(e);const n=vs(t);n.O_()&&n.Y_&&n.ea(e.mutations)}function zS(t){return Da(t)&&!vs(t).x_()&&t.Ta.length>0}function VS(t){vs(t).start()}async function gj(t){vs(t).ra()}async function yj(t){const e=vs(t);for(const n of t.Ta)e.ea(n.mutations)}async function _j(t,e,n){const r=t.Ta.shift(),i=lv.from(r,e,n);await LS(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),await np(t)}async function vj(t,e){e&&vs(t).Y_&&await async function(r,i){if(function(a){return Zz(a)&&a!==ne.ABORTED}(i.code)){const s=r.Ta.shift();vs(r).B_(),await LS(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),await np(r)}}(t,e),zS(t)&&VS(t)}async function sb(t,e){const n=Ne(t);n.asyncQueue.verifyOperationInProgress(),me(Ta,"RemoteStore received new credentials");const r=Da(n);n.Ea.add(3),await Cc(n),r&&n.Va.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await tp(n)}async function wj(t,e){const n=Ne(t);e?(n.Ea.delete(2),await tp(n)):e||(n.Ea.add(2),await Cc(n),n.Va.set("Unknown"))}function sl(t){return t.ma||(t.ma=function(n,r,i){const s=Ne(n);return s.sa(),new rj(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(t.datastore,t.asyncQueue,{Zo:cj.bind(null,t),Yo:dj.bind(null,t),t_:hj.bind(null,t),J_:fj.bind(null,t)}),t.Ra.push(async e=>{e?(t.ma.B_(),_v(t)?yv(t):t.Va.set("Unknown")):(await t.ma.stop(),MS(t))})),t.ma}function vs(t){return t.fa||(t.fa=function(n,r,i){const s=Ne(n);return s.sa(),new ij(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(t.datastore,t.asyncQueue,{Zo:()=>Promise.resolve(),Yo:gj.bind(null,t),t_:vj.bind(null,t),ta:yj.bind(null,t),na:_j.bind(null,t)}),t.Ra.push(async e=>{e?(t.fa.B_(),await np(t)):(await t.fa.stop(),t.Ta.length>0&&(me(Ta,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))})),t.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vv{constructor(e,n,r,i,s){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new vi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,s){const a=Date.now()+r,o=new vv(e,n,a,i,s);return o.start(r),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new fe(ne.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function wv(t,e){if($i("AsyncQueue",`${e}: ${t}`),rl(t))return new fe(ne.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class No{static emptySet(e){return new No(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||Te.comparator(n.key,r.key):(n,r)=>Te.comparator(n.key,r.key),this.keyedMap=du(),this.sortedSet=new gt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof No)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new No;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ab{constructor(){this.ga=new gt(Te.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Se(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal((n,r)=>{e.push(r)}),e}}class Ho{constructor(e,n,r,i,s,a,o,l,u){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=o,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,n,r,i,s){const a=[];return n.forEach(o=>{a.push({type:0,doc:o})}),new Ho(e,n,No.emptySet(n),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Qf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bj{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class xj{constructor(){this.queries=ob(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const i=Ne(n),s=i.queries;i.queries=ob(),s.forEach((a,o)=>{for(const l of o.ba)l.onError(r)})})(this,new fe(ne.ABORTED,"Firestore shutting down"))}}function ob(){return new Oa(t=>iS(t),Qf)}async function jS(t,e){const n=Ne(t);let r=3;const i=e.query;let s=n.queries.get(i);s?!s.Sa()&&e.Da()&&(r=2):(s=new bj,r=e.Da()?0:1);try{switch(r){case 0:s.wa=await n.onListen(i,!0);break;case 1:s.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(a){const o=wv(a,`Initialization of query '${ro(e.query)}' failed`);return void e.onError(o)}n.queries.set(i,s),s.ba.push(e),e.va(n.onlineState),s.wa&&e.Fa(s.wa)&&bv(n)}async function US(t,e){const n=Ne(t),r=e.query;let i=3;const s=n.queries.get(r);if(s){const a=s.ba.indexOf(e);a>=0&&(s.ba.splice(a,1),s.ba.length===0?i=e.Da()?0:1:!s.Sa()&&e.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function Ej(t,e){const n=Ne(t);let r=!1;for(const i of e){const s=i.query,a=n.queries.get(s);if(a){for(const o of a.ba)o.Fa(i)&&(r=!0);a.wa=i}}r&&bv(n)}function Tj(t,e,n){const r=Ne(t),i=r.queries.get(e);if(i)for(const s of i.ba)s.onError(n);r.queries.delete(e)}function bv(t){t.Ca.forEach(e=>{e.next()})}var $y,lb;(lb=$y||($y={})).Ma="default",lb.Cache="cache";class BS{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new Ho(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.Ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=Ho.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==$y.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FS{constructor(e){this.key=e}}class WS{constructor(e){this.key=e}}class Ij{constructor(e,n){this.query=e,this.Za=n,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=Ve(),this.mutatedKeys=Ve(),this.eu=sS(e),this.tu=new No(this.eu)}get nu(){return this.Za}ru(e,n){const r=n?n.iu:new ab,i=n?n.tu:this.tu;let s=n?n.mutatedKeys:this.mutatedKeys,a=i,o=!1;const l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,u=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((h,f)=>{const p=i.get(h),g=Yf(this.query,f)?f:null,_=!!p&&this.mutatedKeys.has(p.key),x=!!g&&(g.hasLocalMutations||this.mutatedKeys.has(g.key)&&g.hasCommittedMutations);let $=!1;p&&g?p.data.isEqual(g.data)?_!==x&&(r.track({type:3,doc:g}),$=!0):this.su(p,g)||(r.track({type:2,doc:g}),$=!0,(l&&this.eu(g,l)>0||u&&this.eu(g,u)<0)&&(o=!0)):!p&&g?(r.track({type:0,doc:g}),$=!0):p&&!g&&(r.track({type:1,doc:p}),$=!0,(l||u)&&(o=!0)),$&&(g?(a=a.add(g),s=x?s.add(h):s.delete(h)):(a=a.delete(h),s=s.delete(h)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const h=this.query.limitType==="F"?a.last():a.first();a=a.delete(h.key),s=s.delete(h.key),r.track({type:1,doc:h})}return{tu:a,iu:r,Ss:o,mutatedKeys:s}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){const s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort((h,f)=>function(g,_){const x=$=>{switch($){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Se(20277,{Vt:$})}};return x(g)-x(_)}(h.type,f.type)||this.eu(h.doc,f.doc)),this.ou(r),i=i??!1;const o=n&&!i?this._u():[],l=this.Ya.size===0&&this.current&&!i?1:0,u=l!==this.Xa;return this.Xa=l,a.length!==0||u?{snapshot:new Ho(this.query,e.tu,s,a,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new ab,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(n=>this.Za=this.Za.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Za=this.Za.delete(n)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=Ve(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Ya=this.Ya.add(r.key))});const n=[];return e.forEach(r=>{this.Ya.has(r)||n.push(new WS(r))}),this.Ya.forEach(r=>{e.has(r)||n.push(new FS(r))}),n}cu(e){this.Za=e.ks,this.Ya=Ve();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return Ho.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const xv="SyncEngine";class $j{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class kj{constructor(e){this.key=e,this.hu=!1}}class Sj{constructor(e,n,r,i,s,a){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Oa(o=>iS(o),Qf),this.Iu=new Map,this.Eu=new Set,this.Ru=new gt(Te.comparator),this.Au=new Map,this.Vu=new dv,this.du={},this.mu=new Map,this.fu=qo.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Cj(t,e,n=!0){const r=YS(t);let i;const s=r.Tu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=await qS(r,e,n,!0),i}async function Aj(t,e){const n=YS(t);await qS(n,e,!0,!1)}async function qS(t,e,n,r){const i=await QV(t.localStore,Gr(e)),s=i.targetId,a=t.sharedClientState.addLocalQueryTarget(s,n);let o;return r&&(o=await Rj(t,e,s,a==="current",i.resumeToken)),t.isPrimaryClient&&n&&OS(t.remoteStore,i),o}async function Rj(t,e,n,r,i){t.pu=(f,p,g)=>async function(x,$,w,y){let I=$.view.ru(w);I.Ss&&(I=await eb(x.localStore,$.query,!1).then(({documents:C})=>$.view.ru(C,I)));const R=y&&y.targetChanges.get($.targetId),M=y&&y.targetMismatches.get($.targetId)!=null,j=$.view.applyChanges(I,x.isPrimaryClient,R,M);return cb(x,$.targetId,j.au),j.snapshot}(t,f,p,g);const s=await eb(t.localStore,e,!0),a=new Ij(e,s.ks),o=a.ru(s.documents),l=Sc.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),u=a.applyChanges(o,t.isPrimaryClient,l);cb(t,n,u.au);const h=new $j(e,n,a);return t.Tu.set(e,h),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),u.snapshot}async function Nj(t,e,n){const r=Ne(t),i=r.Tu.get(e),s=r.Iu.get(i.targetId);if(s.length>1)return r.Iu.set(i.targetId,s.filter(a=>!Qf(a,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Ty(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&mv(r.remoteStore,i.targetId),ky(r,i.targetId)}).catch(nl)):(ky(r,i.targetId),await Ty(r.localStore,i.targetId,!0))}async function Pj(t,e){const n=Ne(t),r=n.Tu.get(e),i=n.Iu.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),mv(n.remoteStore,r.targetId))}async function Oj(t,e,n){const r=Uj(t);try{const i=await function(a,o){const l=Ne(a),u=lt.now(),h=o.reduce((g,_)=>g.add(_.key),Ve());let f,p;return l.persistence.runTransaction("Locally write mutations","readwrite",g=>{let _=ki(),x=Ve();return l.xs.getEntries(g,h).next($=>{_=$,_.forEach((w,y)=>{y.isValidDocument()||(x=x.add(w))})}).next(()=>l.localDocuments.getOverlayedDocuments(g,_)).next($=>{f=$;const w=[];for(const y of o){const I=Kz(y,f.get(y.key).overlayedDocument);I!=null&&w.push(new Ss(y.key,I,Yk(I.value.mapValue),br.exists(!0)))}return l.mutationQueue.addMutationBatch(g,u,w,o)}).next($=>{p=$;const w=$.applyToLocalDocumentSet(f,x);return l.documentOverlayCache.saveOverlays(g,$.batchId,w)})}).then(()=>({batchId:p.batchId,changes:oS(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,o,l){let u=a.du[a.currentUser.toKey()];u||(u=new gt(ze)),u=u.insert(o,l),a.du[a.currentUser.toKey()]=u}(r,i.batchId,n),await Ac(r,i.changes),await np(r.remoteStore)}catch(i){const s=wv(i,"Failed to persist write");n.reject(s)}}async function HS(t,e){const n=Ne(t);try{const r=await HV(n.localStore,e);e.targetChanges.forEach((i,s)=>{const a=n.Au.get(s);a&&(Qe(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.hu=!0:i.modifiedDocuments.size>0?Qe(a.hu,14607):i.removedDocuments.size>0&&(Qe(a.hu,42227),a.hu=!1))}),await Ac(n,r,e)}catch(r){await nl(r)}}function ub(t,e,n){const r=Ne(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.Tu.forEach((s,a)=>{const o=a.view.va(e);o.snapshot&&i.push(o.snapshot)}),function(a,o){const l=Ne(a);l.onlineState=o;let u=!1;l.queries.forEach((h,f)=>{for(const p of f.ba)p.va(o)&&(u=!0)}),u&&bv(l)}(r.eventManager,e),i.length&&r.Pu.J_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Dj(t,e,n){const r=Ne(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Au.get(e),s=i&&i.key;if(s){let a=new gt(Te.comparator);a=a.insert(s,sn.newNoDocument(s,Re.min()));const o=Ve().add(s),l=new Zf(Re.min(),new Map,new gt(ze),a,o);await HS(r,l),r.Ru=r.Ru.remove(s),r.Au.delete(e),Ev(r)}else await Ty(r.localStore,e,!1).then(()=>ky(r,e,n)).catch(nl)}async function Mj(t,e){const n=Ne(t),r=e.batch.batchId;try{const i=await qV(n.localStore,e);KS(n,r,null),GS(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Ac(n,i)}catch(i){await nl(i)}}async function Lj(t,e,n){const r=Ne(t);try{const i=await function(a,o){const l=Ne(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return l.mutationQueue.lookupMutationBatch(u,o).next(f=>(Qe(f!==null,37113),h=f.keys(),l.mutationQueue.removeMutationBatch(u,f))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,o)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h)).next(()=>l.localDocuments.getDocuments(u,h))})}(r.localStore,e);KS(r,e,n),GS(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Ac(r,i)}catch(i){await nl(i)}}function GS(t,e){(t.mu.get(e)||[]).forEach(n=>{n.resolve()}),t.mu.delete(e)}function KS(t,e,n){const r=Ne(t);let i=r.du[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(n?s.reject(n):s.resolve(),i=i.remove(e)),r.du[r.currentUser.toKey()]=i}}function ky(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Vu.Gr(e).forEach(r=>{t.Vu.containsKey(r)||QS(t,r)})}function QS(t,e){t.Eu.delete(e.path.canonicalString());const n=t.Ru.get(e);n!==null&&(mv(t.remoteStore,n),t.Ru=t.Ru.remove(e),t.Au.delete(n),Ev(t))}function cb(t,e,n){for(const r of n)r instanceof FS?(t.Vu.addReference(r.key,e),zj(t,r)):r instanceof WS?(me(xv,"Document no longer in limbo: "+r.key),t.Vu.removeReference(r.key,e),t.Vu.containsKey(r.key)||QS(t,r.key)):Se(19791,{wu:r})}function zj(t,e){const n=e.key,r=n.path.canonicalString();t.Ru.get(n)||t.Eu.has(r)||(me(xv,"New document in limbo: "+n),t.Eu.add(r),Ev(t))}function Ev(t){for(;t.Eu.size>0&&t.Ru.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new Te(st.fromString(e)),r=t.fu.next();t.Au.set(r,new kj(n)),t.Ru=t.Ru.insert(n,r),OS(t.remoteStore,new Zi(Gr(av(n.path)),r,"TargetPurposeLimboResolution",Hf.ce))}}async function Ac(t,e,n){const r=Ne(t),i=[],s=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach((o,l)=>{a.push(r.pu(l,e,n).then(u=>{var h;if((u||n)&&r.isPrimaryClient){const f=u?!u.fromCache:(h=n==null?void 0:n.targetChanges.get(l.targetId))==null?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(u){i.push(u);const f=fv.Es(l.targetId,u);s.push(f)}}))}),await Promise.all(a),r.Pu.J_(i),await async function(l,u){const h=Ne(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>ie.forEach(u,p=>ie.forEach(p.Ts,g=>h.persistence.referenceDelegate.addReference(f,p.targetId,g)).next(()=>ie.forEach(p.Is,g=>h.persistence.referenceDelegate.removeReference(f,p.targetId,g)))))}catch(f){if(!rl(f))throw f;me(pv,"Failed to update sequence numbers: "+f)}for(const f of u){const p=f.targetId;if(!f.fromCache){const g=h.vs.get(p),_=g.snapshotVersion,x=g.withLastLimboFreeSnapshotVersion(_);h.vs=h.vs.insert(p,x)}}}(r.localStore,s))}async function Vj(t,e){const n=Ne(t);if(!n.currentUser.isEqual(e)){me(xv,"User change. New user:",e.toKey());const r=await AS(n.localStore,e);n.currentUser=e,function(s,a){s.mu.forEach(o=>{o.forEach(l=>{l.reject(new fe(ne.CANCELLED,a))})}),s.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Ac(n,r.Ns)}}function jj(t,e){const n=Ne(t),r=n.Au.get(e);if(r&&r.hu)return Ve().add(r.key);{let i=Ve();const s=n.Iu.get(e);if(!s)return i;for(const a of s){const o=n.Tu.get(a);i=i.unionWith(o.view.nu)}return i}}function YS(t){const e=Ne(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=HS.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=jj.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Dj.bind(null,e),e.Pu.J_=Ej.bind(null,e.eventManager),e.Pu.yu=Tj.bind(null,e.eventManager),e}function Uj(t){const e=Ne(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Mj.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Lj.bind(null,e),e}class df{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ep(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return WV(this.persistence,new UV,e.initialUser,this.serializer)}Cu(e){return new CS(hv.Vi,this.serializer)}Du(e){return new JV}async terminate(){var e,n;(e=this.gcScheduler)==null||e.stop(),(n=this.indexBackfillerScheduler)==null||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}df.provider={build:()=>new df};class Bj extends df{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){Qe(this.persistence.referenceDelegate instanceof uf,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new $V(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?wn.withCacheSize(this.cacheSizeBytes):wn.DEFAULT;return new CS(r=>uf.Vi(r,n),this.serializer)}}class Sy{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>ub(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Vj.bind(null,this.syncEngine),await wj(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new xj}()}createDatastore(e){const n=ep(e.databaseInfo.databaseId),r=nj(e.databaseInfo);return oj(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,i,s,a,o){return new uj(r,i,s,a,o)}(this.localStore,this.datastore,e.asyncQueue,n=>ub(this.syncEngine,n,0),function(){return rb.v()?new rb:new XV}())}createSyncEngine(e,n){return function(i,s,a,o,l,u,h){const f=new Sj(i,s,a,o,l,u);return h&&(f.gu=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(i){const s=Ne(i);me(Ta,"RemoteStore shutting down."),s.Ea.add(5),await Cc(s),s.Aa.shutdown(),s.Va.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(n=this.eventManager)==null||n.terminate()}}Sy.provider={build:()=>new Sy};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JS{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):$i("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ws="FirestoreClient";class Fj{constructor(e,n,r,i,s){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this._databaseInfo=i,this.user=nn.UNAUTHENTICATED,this.clientId=ev.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,async a=>{me(ws,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(me(ws,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new vi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=wv(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function lm(t,e){t.asyncQueue.verifyOperationInProgress(),me(ws,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async i=>{r.isEqual(i)||(await AS(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function db(t,e){t.asyncQueue.verifyOperationInProgress();const n=await Wj(t);me(ws,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>sb(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,i)=>sb(e.remoteStore,i)),t._onlineComponents=e}async function Wj(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){me(ws,"Using user provided OfflineComponentProvider");try{await lm(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(i){return i.name==="FirebaseError"?i.code===ne.FAILED_PRECONDITION||i.code===ne.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(n))throw n;Uo("Error using user provided cache. Falling back to memory cache: "+n),await lm(t,new df)}}else me(ws,"Using default OfflineComponentProvider"),await lm(t,new Bj(void 0));return t._offlineComponents}async function XS(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(me(ws,"Using user provided OnlineComponentProvider"),await db(t,t._uninitializedComponentsProvider._online)):(me(ws,"Using default OnlineComponentProvider"),await db(t,new Sy))),t._onlineComponents}function qj(t){return XS(t).then(e=>e.syncEngine)}async function ZS(t){const e=await XS(t),n=e.eventManager;return n.onListen=Cj.bind(null,e.syncEngine),n.onUnlisten=Nj.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=Aj.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=Pj.bind(null,e.syncEngine),n}function Hj(t,e,n={}){const r=new vi;return t.asyncQueue.enqueueAndForget(async()=>function(s,a,o,l,u){const h=new JS({next:p=>{h.Nu(),a.enqueueAndForget(()=>US(s,f));const g=p.docs.has(o);!g&&p.fromCache?u.reject(new fe(ne.UNAVAILABLE,"Failed to get document because the client is offline.")):g&&p.fromCache&&l&&l.source==="server"?u.reject(new fe(ne.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(p)},error:p=>u.reject(p)}),f=new BS(av(o.path),h,{includeMetadataChanges:!0,Ka:!0});return jS(s,f)}(await ZS(t),t.asyncQueue,e,n,r)),r.promise}function Gj(t,e,n={}){const r=new vi;return t.asyncQueue.enqueueAndForget(async()=>function(s,a,o,l,u){const h=new JS({next:p=>{h.Nu(),a.enqueueAndForget(()=>US(s,f)),p.fromCache&&l.source==="server"?u.reject(new fe(ne.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(p)},error:p=>u.reject(p)}),f=new BS(o,h,{includeMetadataChanges:!0,Ka:!0});return jS(s,f)}(await ZS(t),t.asyncQueue,e,n,r)),r.promise}function Kj(t,e){const n=new vi;return t.asyncQueue.enqueueAndForget(async()=>Oj(await qj(t),e,n)),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eC(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qj="ComponentProvider",hb=new Map;function Yj(t,e,n,r,i){return new mz(t,e,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,eC(i.experimentalLongPollingOptions),i.useFetchStreams,i.isUsingEmulator,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tC="firestore.googleapis.com",fb=!0;class pb{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new fe(ne.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=tC,this.ssl=fb}else this.host=e.host,this.ssl=e.ssl??fb;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=SS;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<TV)throw new fe(ne.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}iz("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=eC(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new fe(ne.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new fe(ne.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new fe(ne.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class rp{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new pb({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new fe(ne.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new fe(ne.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new pb(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new KL;switch(r.type){case"firstParty":return new XL(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new fe(ne.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=hb.get(n);r&&(me(Qj,"Removing Datastore"),hb.delete(n),r.terminate())}(this),Promise.resolve()}}function Jj(t,e,n,r={}){var u;t=Yr(t,rp);const i=Ra(e),s=t._getSettings(),a={...s,emulatorOptions:t._getEmulatorOptions()},o=`${e}:${n}`;i&&(j_(`https://${o}`),U_("Firestore",!0)),s.host!==tC&&s.host!==o&&Uo("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...s,host:o,ssl:i,emulatorOptions:r};if(!va(l,a)&&(t._setSettings(l),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=nn.MOCK_USER;else{h=q$(r.mockUserToken,(u=t._app)==null?void 0:u.options.projectId);const p=r.mockUserToken.sub||r.mockUserToken.user_id;if(!p)throw new fe(ne.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new nn(p)}t._authCredentials=new QL(new zk(h,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ma{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ma(this.firestore,e,this._query)}}class Et{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ds(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Et(this.firestore,e,this._key)}toJSON(){return{type:Et._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if($c(n,Et._jsonSchema))return new Et(e,r||null,new Te(st.fromString(n.referencePath)))}}Et._jsonSchemaVersion="firestore/documentReference/1.0",Et._jsonSchema={type:Ct("string",Et._jsonSchemaVersion),referencePath:Ct("string")};class ds extends Ma{constructor(e,n,r){super(e,n,av(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Et(this.firestore,null,new Te(e))}withConverter(e){return new ds(this.firestore,e,this._path)}}function eo(t,e,...n){if(t=Mt(t),Vk("collection","path",e),t instanceof rp){const r=st.fromString(e,...n);return k1(r),new ds(t,null,r)}{if(!(t instanceof Et||t instanceof ds))throw new fe(ne.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(st.fromString(e,...n));return k1(r),new ds(t.firestore,null,r)}}function fu(t,e,...n){if(t=Mt(t),arguments.length===1&&(e=ev.newId()),Vk("doc","path",e),t instanceof rp){const r=st.fromString(e,...n);return $1(r),new Et(t,null,new Te(r))}{if(!(t instanceof Et||t instanceof ds))throw new fe(ne.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(st.fromString(e,...n));return $1(r),new Et(t.firestore,t instanceof ds?t.converter:null,new Te(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mb="AsyncQueue";class gb{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new NS(this,"async_queue_retry"),this._c=()=>{const r=om();r&&me(mb,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=om();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=om();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const n=new vi;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!rl(e))throw e;me(mb,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const n=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,$i("INTERNAL UNHANDLED ERROR: ",yb(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const i=vv.createAndSchedule(this,e,n,r,s=>this.hc(s));return this.tc.push(i),i}uc(){this.nc&&Se(47125,{Pc:yb(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function yb(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class al extends rp{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new gb,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new gb(e),this._firestoreClient=void 0,await e}}}function Xj(t,e){const n=typeof t=="object"?t:W_(),r=typeof t=="string"?t:rf,i=Uf(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=B$("firestore");s&&Jj(i,...s)}return i}function Tv(t){if(t._terminated)throw new fe(ne.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||Zj(t),t._firestoreClient}function Zj(t){var r,i,s,a;const e=t._freezeSettings(),n=Yj(t._databaseId,((r=t._app)==null?void 0:r.options.appId)||"",t._persistenceKey,(i=t._app)==null?void 0:i.options.apiKey,e);t._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((a=e.localCache)!=null&&a._onlineComponentProvider)&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new Fj(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&function(l){const u=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(u),_online:u}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Hn(Qt.fromBase64String(e))}catch(n){throw new fe(ne.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Hn(Qt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Hn._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if($c(e,Hn._jsonSchema))return Hn.fromBase64String(e.bytes)}}Hn._jsonSchemaVersion="firestore/bytes/1.0",Hn._jsonSchema={type:Ct("string",Hn._jsonSchemaVersion),bytes:Ct("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iv{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new fe(ne.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ht(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ip{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qr{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new fe(ne.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new fe(ne.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ze(this._lat,e._lat)||ze(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Qr._jsonSchemaVersion}}static fromJSON(e){if($c(e,Qr._jsonSchema))return new Qr(e.latitude,e.longitude)}}Qr._jsonSchemaVersion="firestore/geoPoint/1.0",Qr._jsonSchema={type:Ct("string",Qr._jsonSchemaVersion),latitude:Ct("number"),longitude:Ct("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xr{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:xr._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if($c(e,xr._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(n=>typeof n=="number"))return new xr(e.vectorValues);throw new fe(ne.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}xr._jsonSchemaVersion="firestore/vectorValue/1.0",xr._jsonSchema={type:Ct("string",xr._jsonSchemaVersion),vectorValues:Ct("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e6=/^__.*__$/;class t6{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Ss(e,this.data,this.fieldMask,n,this.fieldTransforms):new kc(e,this.data,n,this.fieldTransforms)}}class nC{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Ss(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function rC(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Se(40011,{dataSource:t})}}class $v{constructor(e,n,r,i,s,a){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new $v({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var i;const n=(i=this.path)==null?void 0:i.child(e),r=this.contextWith({path:n,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){var i;const n=(i=this.path)==null?void 0:i.child(e),r=this.contextWith({path:n,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return hf(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(rC(this.dataSource)&&e6.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class n6{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||ep(e)}createContext(e,n,r,i=!1){return new $v({dataSource:e,methodName:n,targetDoc:r,path:Ht.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function sp(t){const e=t._freezeSettings(),n=ep(t._databaseId);return new n6(t._databaseId,!!e.ignoreUndefinedProperties,n)}function iC(t,e,n,r,i,s={}){const a=t.createContext(s.merge||s.mergeFields?2:0,e,n,i);Sv("Data must be an object, but it was:",a,r);const o=sC(r,a);let l,u;if(s.merge)l=new Dn(a.fieldMask),u=a.fieldTransforms;else if(s.mergeFields){const h=[];for(const f of s.mergeFields){const p=Go(e,f,n);if(!a.contains(p))throw new fe(ne.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);lC(h,p)||h.push(p)}l=new Dn(h),u=a.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,u=a.fieldTransforms;return new t6(new xn(o),l,u)}class ap extends ip{_toFieldTransform(e){if(e.dataSource!==2)throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ap}}class kv extends ip{_toFieldTransform(e){return new Wz(e.path,new cc)}isEqual(e){return e instanceof kv}}function r6(t,e,n,r){const i=t.createContext(1,e,n);Sv("Data must be an object, but it was:",i,r);const s=[],a=xn.empty();ks(r,(l,u)=>{const h=oC(e,l,n);u=Mt(u);const f=i.childContextForFieldPath(h);if(u instanceof ap)s.push(h);else{const p=Rc(u,f);p!=null&&(s.push(h),a.set(h,p))}});const o=new Dn(s);return new nC(a,o,i.fieldTransforms)}function i6(t,e,n,r,i,s){const a=t.createContext(1,e,n),o=[Go(e,r,n)],l=[i];if(s.length%2!=0)throw new fe(ne.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<s.length;p+=2)o.push(Go(e,s[p])),l.push(s[p+1]);const u=[],h=xn.empty();for(let p=o.length-1;p>=0;--p)if(!lC(u,o[p])){const g=o[p];let _=l[p];_=Mt(_);const x=a.childContextForFieldPath(g);if(_ instanceof ap)u.push(g);else{const $=Rc(_,x);$!=null&&(u.push(g),h.set(g,$))}}const f=new Dn(u);return new nC(h,f,a.fieldTransforms)}function s6(t,e,n,r=!1){return Rc(n,t.createContext(r?4:3,e))}function Rc(t,e){if(aC(t=Mt(t)))return Sv("Unsupported field value:",e,t),sC(t,e);if(t instanceof ip)return function(r,i){if(!rC(i.dataSource))throw i.createError(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.createError(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return function(r,i){const s=[];let a=0;for(const o of r){let l=Rc(o,i.childContextForArray(a));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}}(t,e)}return function(r,i){if((r=Mt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Uz(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=lt.fromDate(r);return{timestampValue:lf(i.serializer,s)}}if(r instanceof lt){const s=new lt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:lf(i.serializer,s)}}if(r instanceof Qr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Hn)return{bytesValue:wS(i.serializer,r._byteString)};if(r instanceof Et){const s=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(s))throw i.createError(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:cv(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof xr)return function(a,o){const l=a instanceof xr?a.toArray():a;return{mapValue:{fields:{[Kk]:{stringValue:Qk},[sf]:{arrayValue:{values:l.map(h=>{if(typeof h!="number")throw o.createError("VectorValues must only contain numeric values.");return ov(o.serializer,h)})}}}}}}(r,i);if(kS(r))return r._toProto(i.serializer);throw i.createError(`Unsupported field value: ${qf(r)}`)}(t,e)}function sC(t,e){const n={};return Bk(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ks(t,(r,i)=>{const s=Rc(i,e.childContextForField(r));s!=null&&(n[r]=s)}),{mapValue:{fields:n}}}function aC(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof lt||t instanceof Qr||t instanceof Hn||t instanceof Et||t instanceof ip||t instanceof xr||kS(t))}function Sv(t,e,n){if(!aC(n)||!jk(n)){const r=qf(n);throw r==="an object"?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function Go(t,e,n){if((e=Mt(e))instanceof Iv)return e._internalPath;if(typeof e=="string")return oC(t,e);throw hf("Field path arguments must be of type string or ",t,!1,void 0,n)}const a6=new RegExp("[~\\*/\\[\\]]");function oC(t,e,n){if(e.search(a6)>=0)throw hf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Iv(...e.split("."))._internalPath}catch{throw hf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function hf(t,e,n,r,i){const s=r&&!r.isEmpty(),a=i!==void 0;let o=`Function ${e}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new fe(ne.INVALID_ARGUMENT,o+t+l)}function lC(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o6{convertValue(e,n="none"){switch(_s(e)){case 0:return null;case 1:return e.booleanValue;case 2:return bt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(ys(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Se(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return ks(e,(i,s)=>{r[i]=this.convertValue(s,n)}),r}convertVectorValue(e){var r,i,s;const n=(s=(i=(r=e.fields)==null?void 0:r[sf].arrayValue)==null?void 0:i.values)==null?void 0:s.map(a=>bt(a.doubleValue));return new xr(n)}convertGeoPoint(e){return new Qr(bt(e.latitude),bt(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Kf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(ac(e));default:return null}}convertTimestamp(e){const n=gs(e);return new lt(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=st.fromString(e);Qe($S(r),9688,{name:e});const i=new oc(r.get(1),r.get(3)),s=new Te(r.popFirst(5));return i.isEqual(n)||$i(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),s}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uC extends o6{constructor(e){super(),this.firestore=e}convertBytes(e){return new Hn(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Et(this.firestore,null,n)}}function Hl(){return new kv("serverTimestamp")}const _b="@firebase/firestore",vb="4.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cC{constructor(e,n,r,i,s){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Et(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new l6(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){var e;return((e=this._document)==null?void 0:e.data.clone().value.mapValue.fields)??void 0}get(e){if(this._document){const n=this._document.data.field(Go("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class l6 extends cC{data(){return super.data()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u6(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new fe(ne.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Cv{}class dC extends Cv{}function wb(t,e,...n){let r=[];e instanceof Cv&&r.push(e),r=r.concat(n),function(s){const a=s.filter(l=>l instanceof Rv).length,o=s.filter(l=>l instanceof Av).length;if(a>1||a>0&&o>0)throw new fe(ne.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)t=i._apply(t);return t}class Av extends dC{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new Av(e,n,r)}_apply(e){const n=this._parse(e);return hC(e._query,n),new Ma(e.firestore,e.converter,_y(e._query,n))}_parse(e){const n=sp(e.firestore);return function(s,a,o,l,u,h,f){let p;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new fe(ne.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){Eb(f,h);const _=[];for(const x of f)_.push(xb(l,s,x));p={arrayValue:{values:_}}}else p=xb(l,s,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||Eb(f,h),p=s6(o,a,f,h==="in"||h==="not-in");return St.create(u,h,p)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}class Rv extends Cv{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new Rv(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:$r.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(i,s){let a=i;const o=s.getFlattenedFilters();for(const l of o)hC(a,l),a=_y(a,l)}(e._query,n),new Ma(e.firestore,e.converter,_y(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Nv extends dC{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new Nv(e,n)}_apply(e){const n=function(i,s,a){if(i.startAt!==null)throw new fe(ne.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new fe(ne.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new uc(s,a)}(e._query,this._field,this._direction);return new Ma(e.firestore,e.converter,Pz(e._query,n))}}function bb(t,e="asc"){const n=e,r=Go("orderBy",t);return Nv._create(r,n)}function xb(t,e,n){if(typeof(n=Mt(n))=="string"){if(n==="")throw new fe(ne.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!rS(e)&&n.indexOf("/")!==-1)throw new fe(ne.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(st.fromString(n));if(!Te.isDocumentKey(r))throw new fe(ne.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return D1(t,new Te(r))}if(n instanceof Et)return D1(t,n._key);throw new fe(ne.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${qf(n)}.`)}function Eb(t,e){if(!Array.isArray(t)||t.length===0)throw new fe(ne.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function hC(t,e){const n=function(i,s){for(const a of i)for(const o of a.getFlattenedFilters())if(s.indexOf(o.op)>=0)return o.op;return null}(t.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new fe(ne.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new fe(ne.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}function fC(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class pu{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class da extends cC{constructor(e,n,r,i,s,a){super(e,n,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new bh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(Go("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new fe(ne.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=da._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}da._jsonSchemaVersion="firestore/documentSnapshot/1.0",da._jsonSchema={type:Ct("string",da._jsonSchemaVersion),bundleSource:Ct("string","DocumentSnapshot"),bundleName:Ct("string"),bundle:Ct("string")};class bh extends da{data(e={}){return super.data(e)}}class Po{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new pu(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new bh(this._firestore,this._userDataWriter,r.key,r,new pu(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new fe(ne.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(o=>{const l=new bh(i._firestore,i._userDataWriter,o.doc.key,o.doc,new pu(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter);return o.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(o=>s||o.type!==3).map(o=>{const l=new bh(i._firestore,i._userDataWriter,o.doc.key,o.doc,new pu(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter);let u=-1,h=-1;return o.type!==0&&(u=a.indexOf(o.doc.key),a=a.delete(o.doc.key)),o.type!==1&&(a=a.add(o.doc),h=a.indexOf(o.doc.key)),{type:c6(o.type),doc:l,oldIndex:u,newIndex:h}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new fe(ne.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Po._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=ev.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(n.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function c6(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Se(61501,{type:t})}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Po._jsonSchemaVersion="firestore/querySnapshot/1.0",Po._jsonSchema={type:Ct("string",Po._jsonSchemaVersion),bundleSource:Ct("string","QuerySnapshot"),bundleName:Ct("string"),bundle:Ct("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d6(t){t=Yr(t,Et);const e=Yr(t.firestore,al),n=Tv(e);return Hj(n,t._key).then(r=>f6(e,t,r))}function Md(t){t=Yr(t,Ma);const e=Yr(t.firestore,al),n=Tv(e),r=new uC(e);return u6(t._query),Gj(n,t._query).then(i=>new Po(e,r,t,i))}function Tb(t,e,n){t=Yr(t,Et);const r=Yr(t.firestore,al),i=fC(t.converter,e,n),s=sp(r);return Pv(r,[iC(s,"setDoc",t._key,i,t.converter!==null,n).toMutation(t._key,br.none())])}function h6(t,e,n,...r){t=Yr(t,Et);const i=Yr(t.firestore,al),s=sp(i);let a;return a=typeof(e=Mt(e))=="string"||e instanceof Iv?i6(s,"updateDoc",t._key,e,n,r):r6(s,"updateDoc",t._key,e),Pv(i,[a.toMutation(t._key,br.exists(!0))])}function Ib(t,e){const n=Yr(t.firestore,al),r=fu(t),i=fC(t.converter,e),s=sp(t.firestore);return Pv(n,[iC(s,"addDoc",r._key,i,t.converter!==null,{}).toMutation(r._key,br.exists(!1))]).then(()=>r)}function Pv(t,e){const n=Tv(t);return Kj(n,e)}function f6(t,e,n){const r=n.docs.get(e._key),i=new uC(t);return new da(t,i,e._key,r,new pu(n.hasPendingWrites,n.fromCache),e.converter)}(function(e,n=!0){GL(Na),wa(new ps("firestore",(r,{instanceIdentifier:i,options:s})=>{const a=r.getProvider("app").getImmediate(),o=new al(new YL(r.getProvider("auth-internal")),new ZL(a,r.getProvider("app-check-internal")),gz(a,i),a);return s={useFetchStreams:n,...s},o._setSettings(s),o},"PUBLIC").setMultipleInstances(!0)),Wr(_b,vb,e),Wr(_b,vb,"esm2020")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pC="firebasestorage.googleapis.com",p6="storageBucket",m6=2*60*1e3,g6=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ti extends ei{constructor(e,n,r=0){super(um(e),`Firebase Storage: ${n} (${um(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,ti.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return um(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Xr;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Xr||(Xr={}));function um(t){return"storage/"+t}function y6(){const t="An unknown error occurred, please check the error payload for server response.";return new ti(Xr.UNKNOWN,t)}function _6(){return new ti(Xr.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function v6(){return new ti(Xr.CANCELED,"User canceled the upload/download.")}function w6(t){return new ti(Xr.INVALID_URL,"Invalid URL '"+t+"'.")}function b6(t){return new ti(Xr.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function $b(t){return new ti(Xr.INVALID_ARGUMENT,t)}function mC(){return new ti(Xr.APP_DELETED,"The Firebase app was deleted.")}function x6(t){return new ti(Xr.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _r{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let r;try{r=_r.makeFromUrl(e,n)}catch{return new _r(e,"")}if(r.path==="")return r;throw b6(e)}static makeFromUrl(e,n){let r=null;const i="([A-Za-z0-9.\\-_]+)";function s(R){R.path.charAt(R.path.length-1)==="/"&&(R.path_=R.path_.slice(0,-1))}const a="(/(.*))?$",o=new RegExp("^gs://"+i+a,"i"),l={bucket:1,path:3};function u(R){R.path_=decodeURIComponent(R.path)}const h="v[A-Za-z0-9_]+",f=n.replace(/[.]/g,"\\."),p="(/([^?#]*).*)?$",g=new RegExp(`^https?://${f}/${h}/b/${i}/o${p}`,"i"),_={bucket:1,path:3},x=n===pC?"(?:storage.googleapis.com|storage.cloud.google.com)":n,$="([^?#]*)",w=new RegExp(`^https?://${x}/${i}/${$}`,"i"),I=[{regex:o,indices:l,postModify:s},{regex:g,indices:_,postModify:u},{regex:w,indices:{bucket:1,path:2},postModify:u}];for(let R=0;R<I.length;R++){const M=I[R],j=M.regex.exec(e);if(j){const C=j[M.indices.bucket];let k=j[M.indices.path];k||(k=""),r=new _r(C,k),M.postModify(r);break}}if(r==null)throw w6(e);return r}}class E6{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T6(t,e,n){let r=1,i=null,s=null,a=!1,o=0;function l(){return o===2}let u=!1;function h(...$){u||(u=!0,e.apply(null,$))}function f($){i=setTimeout(()=>{i=null,t(g,l())},$)}function p(){s&&clearTimeout(s)}function g($,...w){if(u){p();return}if($){p(),h.call(null,$,...w);return}if(l()||a){p(),h.call(null,$,...w);return}r<64&&(r*=2);let I;o===1?(o=2,I=0):I=(r+Math.random())*1e3,f(I)}let _=!1;function x($){_||(_=!0,p(),!u&&(i!==null?($||(o=2),clearTimeout(i),f(0)):$||(o=1)))}return f(0),s=setTimeout(()=>{a=!0,x(!0)},n),x}function I6(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $6(t){return t!==void 0}function kb(t,e,n,r){if(r<e)throw $b(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw $b(`Invalid value for '${t}'. Expected ${n} or less.`)}function k6(t){const e=encodeURIComponent;let n="?";for(const r in t)if(t.hasOwnProperty(r)){const i=e(r)+"="+e(t[r]);n=n+i+"&"}return n=n.slice(0,-1),n}var ff;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(ff||(ff={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S6(t,e){const n=t>=500&&t<600,i=[408,429].indexOf(t)!==-1,s=e.indexOf(t)!==-1;return n||i||s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C6{constructor(e,n,r,i,s,a,o,l,u,h,f,p=!0,g=!1){this.url_=e,this.method_=n,this.headers_=r,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=a,this.callback_=o,this.errorCallback_=l,this.timeout_=u,this.progressCallback_=h,this.connectionFactory_=f,this.retry=p,this.isUsingEmulator=g,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((_,x)=>{this.resolve_=_,this.reject_=x,this.start_()})}start_(){const e=(r,i)=>{if(i){r(!1,new Ld(!1,null,!0));return}const s=this.connectionFactory_();this.pendingConnection_=s;const a=o=>{const l=o.loaded,u=o.lengthComputable?o.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,u)};this.progressCallback_!==null&&s.addUploadProgressListener(a),s.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(a),this.pendingConnection_=null;const o=s.getErrorCode()===ff.NO_ERROR,l=s.getStatus();if(!o||S6(l,this.additionalRetryCodes_)&&this.retry){const h=s.getErrorCode()===ff.ABORT;r(!1,new Ld(!1,null,h));return}const u=this.successCodes_.indexOf(l)!==-1;r(!0,new Ld(u,s))})},n=(r,i)=>{const s=this.resolve_,a=this.reject_,o=i.connection;if(i.wasSuccessCode)try{const l=this.callback_(o,o.getResponse());$6(l)?s(l):s()}catch(l){a(l)}else if(o!==null){const l=y6();l.serverResponse=o.getErrorText(),this.errorCallback_?a(this.errorCallback_(o,l)):a(l)}else if(i.canceled){const l=this.appDelete_?mC():v6();a(l)}else{const l=_6();a(l)}};this.canceled_?n(!1,new Ld(!1,null,!0)):this.backoffId_=T6(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&I6(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Ld{constructor(e,n,r){this.wasSuccessCode=e,this.connection=n,this.canceled=!!r}}function A6(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function R6(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function N6(t,e){e&&(t["X-Firebase-GMPID"]=e)}function P6(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function O6(t,e,n,r,i,s,a=!0,o=!1){const l=k6(t.urlParams),u=t.url+l,h=Object.assign({},t.headers);return N6(h,e),A6(h,n),R6(h,s),P6(h,r),new C6(u,t.method,h,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i,a,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D6(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function M6(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf{constructor(e,n){this._service=e,n instanceof _r?this._location=n:this._location=_r.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new pf(e,n)}get root(){const e=new _r(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return M6(this._location.path)}get storage(){return this._service}get parent(){const e=D6(this._location.path);if(e===null)return null;const n=new _r(this._location.bucket,e);return new pf(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw x6(e)}}function Sb(t,e){const n=e==null?void 0:e[p6];return n==null?null:_r.makeFromBucketSpec(n,t)}function L6(t,e,n,r={}){t.host=`${e}:${n}`;const i=Ra(e);i&&(j_(`https://${t.host}/b`),U_("Storage",!0)),t._isUsingEmulator=!0,t._protocol=i?"https":"http";const{mockUserToken:s}=r;s&&(t._overrideAuthToken=typeof s=="string"?s:q$(s,t.app.options.projectId))}class z6{constructor(e,n,r,i,s,a=!1){this.app=e,this._authProvider=n,this._appCheckProvider=r,this._url=i,this._firebaseVersion=s,this._isUsingEmulator=a,this._bucket=null,this._host=pC,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=m6,this._maxUploadRetryTime=g6,this._requests=new Set,i!=null?this._bucket=_r.makeFromBucketSpec(i,this._host):this._bucket=Sb(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=_r.makeFromBucketSpec(this._url,e):this._bucket=Sb(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){kb("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){kb("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){if(Pn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new pf(this,e)}_makeRequest(e,n,r,i,s=!0){if(this._deleted)return new E6(mC());{const a=O6(e,this._appId,r,i,n,this._firebaseVersion,s,this._isUsingEmulator);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}async makeRequestWithTokens(e,n){const[r,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,r,i).getPromise()}}const Cb="@firebase/storage",Ab="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gC="storage";function V6(t=W_(),e){t=Mt(t);const r=Uf(t,gC).getImmediate({identifier:e}),i=B$("storage");return i&&j6(r,...i),r}function j6(t,e,n,r={}){L6(t,e,n,r)}function U6(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),i=t.getProvider("app-check-internal");return new z6(n,r,i,e,Na)}function B6(){wa(new ps(gC,U6,"PUBLIC").setMultipleInstances(!0)),Wr(Cb,Ab,""),Wr(Cb,Ab,"esm2020")}B6();const F6={apiKey:"AIzaSyCRNLyBkav2ZbMNj9MakHKDdSzeabgFSTI",authDomain:"blood-fitness-app.firebaseapp.com",projectId:"blood-fitness-app",storageBucket:"blood-fitness-app.firebasestorage.app",messagingSenderId:"142443201042",appId:"1:142443201042:web:a962a38c46816d632b8ecb"},Ov=K$(F6),Gs=FL(Ov),Lr=Xj(Ov);V6(Ov);const cm={async saveProfile(t,e){try{const n=fu(Lr,"users",t);return await Tb(n,{...e,updatedAt:Hl()},{merge:!0}),{success:!0}}catch(n){throw console.error("Error saving profile:",n),n}},async getProfile(t){try{const e=fu(Lr,"users",t),n=await d6(e);return n.exists()?{success:!0,profile:{id:n.id,...n.data()}}:{success:!1,error:"Profile not found"}}catch(e){throw console.error("Error getting profile:",e),e}},async updateProfile(t,e){try{const n=fu(Lr,"users",t);return await h6(n,{...e,updatedAt:Hl()}),{success:!0}}catch(n){throw console.error("Error updating profile:",n),n}},async saveBloodReport(t,e){try{const n=eo(Lr,`users/${t}/bloodReports`);return{success:!0,reportId:(await Ib(n,{...e,uploadDate:Hl()})).id}}catch(n){throw console.error("Error saving blood report:",n),n}},async getBloodReports(t){try{const e=eo(Lr,`users/${t}/bloodReports`),n=wb(e,bb("uploadDate","desc")),r=await Md(n),i=[];return r.forEach(s=>{i.push({id:s.id,...s.data()})}),{success:!0,reports:i}}catch(e){throw console.error("Error getting blood reports:",e),e}},async savePrediction(t,e,n){try{const r=fu(Lr,`users/${t}/bloodReports/${e}/predictions`,"latest");return await Tb(r,{...n,predictionDate:Hl()}),{success:!0}}catch(r){throw console.error("Error saving prediction:",r),r}},async getPredictionHistory(t){try{const e=eo(Lr,`users/${t}/bloodReports`),n=await Md(e),r=[];for(const i of n.docs){const s=eo(Lr,`users/${t}/bloodReports/${i.id}/predictions`);(await Md(s)).forEach(o=>{r.push({reportId:i.id,...o.data()})})}return{success:!0,predictions:r}}catch(e){throw console.error("Error getting predictions:",e),e}},async saveWeightLog(t,e){try{const n=eo(Lr,`users/${t}/weightLogs`);return await Ib(n,{...e,timestamp:Hl()}),{success:!0}}catch(n){throw console.error("Error saving weight log:",n),n}},async getWeightLogs(t){try{const e=eo(Lr,`users/${t}/weightLogs`),n=wb(e,bb("timestamp","asc")),r=await Md(n),i=[];return r.forEach(s=>{i.push({id:s.id,...s.data()})}),{success:!0,logs:i}}catch(e){throw console.error("Error getting weight logs:",e),e}}},mu={async register(t,e){try{const r=(await kM(Gs,t,e)).user;return await cm.saveProfile(r.uid,{email:r.email,name:t.split("@")[0],createdAt:new Date}),{success:!0,user:{email:r.email,id:r.uid}}}catch(n){return console.error("Registration error:",n),{success:!1,error:n.message||"Registration failed"}}},async login(t,e){try{const r=(await SM(Gs,t,e)).user;return{success:!0,user:{email:r.email,id:r.uid}}}catch(n){return console.error("Login error:",n),{success:!1,error:n.code==="auth/invalid-credential"?"Invalid email or password":n.message}}},async logout(){try{return await NM(Gs),{success:!0}}catch(t){return console.error("Logout error:",t),{success:!1,error:t.message}}},async getProfile(){try{const t=Gs.currentUser;return t?await cm.getProfile(t.uid):{success:!1,error:"No user logged in"}}catch(t){return console.error("Error getting profile:",t),{success:!1,error:t.message}}},async updateProfile(t){try{const e=Gs.currentUser;return e?(await cm.saveProfile(e.uid,t),{success:!0,message:"Profile updated"}):{success:!1,error:"No user logged in"}}catch(e){return console.error("Error updating profile:",e),{success:!1,error:e.message}}},getCurrentUser(){return Gs.currentUser},onAuthStateChange(t){return RM(Gs,t)}},W6=Object.freeze(Object.defineProperty({__proto__:null,api:mu},Symbol.toStringTag,{value:"Module"})),q6=({onComplete:t})=>{const[e,n]=ve.useState({name:"",age:"",gender:"male",weight:"",heightCm:"",heightFt:"",heightIn:""}),r=a=>{const{name:o,value:l}=a.target;n(u=>({...u,[o]:l}))},i=(a,o)=>Math.round(parseInt(a||0)*30.48+parseInt(o||0)*2.54),s=a=>{if(a.preventDefault(),!e.name||!e.age||!e.weight)return;const o={...e,heightCm:e.heightCm||i(e.heightFt,e.heightIn)};t(o)};return E.jsxs("div",{className:"profile-container fade-in",children:[E.jsxs("div",{className:"card profile-card",children:[E.jsxs("div",{className:"header",children:[E.jsx("h2",{children:"Let's know you better"}),E.jsx("p",{children:"Enter your details for personalized health insights."})]}),E.jsxs("form",{onSubmit:s,children:[E.jsxs("div",{className:"form-group",children:[E.jsx("label",{children:"Full Name"}),E.jsx("input",{type:"text",name:"name",className:"input-field",placeholder:"Your Name",value:e.name,onChange:r,required:!0})]}),E.jsxs("div",{className:"row",children:[E.jsxs("div",{className:"form-group",children:[E.jsx("label",{children:"Age"}),E.jsx("input",{type:"number",name:"age",className:"input-field",placeholder:"25",value:e.age,onChange:r,required:!0})]}),E.jsxs("div",{className:"form-group",children:[E.jsx("label",{children:"Gender"}),E.jsxs("select",{name:"gender",className:"input-field",value:e.gender,onChange:r,children:[E.jsx("option",{value:"male",children:"Male"}),E.jsx("option",{value:"female",children:"Female"}),E.jsx("option",{value:"other",children:"Other"})]})]})]}),E.jsxs("div",{className:"form-group",children:[E.jsx("label",{children:"Weight (kg)"}),E.jsx("input",{type:"number",name:"weight",className:"input-field",placeholder:"70.5",value:e.weight,onChange:r,step:"0.1",required:!0})]}),E.jsxs("div",{className:"height-section",children:[E.jsx("label",{children:"Height"}),E.jsx("div",{className:"tabs"}),E.jsxs("div",{className:"row",children:[E.jsxs("div",{className:"form-group",children:[E.jsx("label",{className:"sub-label",children:"CM"}),E.jsx("input",{type:"number",name:"heightCm",className:"input-field",placeholder:"175",value:e.heightCm,onChange:r})]}),E.jsx("div",{className:"or-divider",children:"OR"}),E.jsxs("div",{className:"form-group",children:[E.jsx("label",{className:"sub-label",children:"Feet"}),E.jsx("input",{type:"number",name:"heightFt",className:"input-field",placeholder:"5",value:e.heightFt,onChange:r})]}),E.jsxs("div",{className:"form-group",children:[E.jsx("label",{className:"sub-label",children:"Inches"}),E.jsx("input",{type:"number",name:"heightIn",className:"input-field",placeholder:"9",value:e.heightIn,onChange:r})]})]})]}),E.jsx("button",{type:"submit",className:"btn-primary",style:{marginTop:"2rem"},children:"Continue"})]})]}),E.jsx("style",{children:`
        .profile-container {
          padding: var(--spacing-md);
          min-height: 100vh;
          background-color: var(--color-background);
          display: flex;
          align-items: center;
          justify-content: center;
        }
        .profile-card {
           width: 100%;
           max-width: 450px;
        }
        .header {
          margin-bottom: var(--spacing-xl);
          text-align: center;
        }
        .header h2 {
          color: var(--color-text-main);
          margin-bottom: var(--spacing-xs);
        }
        .header p {
          color: var(--color-text-secondary);
          font-size: var(--font-size-sm);
        }
        .row {
          display: flex;
          gap: var(--spacing-md);
        }
        .row .form-group {
          flex: 1;
        }
        .form-group {
          margin-bottom: var(--spacing-md);
        }
        .form-group label {
          display: block;
          margin-bottom: var(--spacing-xs);
          font-size: var(--font-size-sm);
          font-weight: 500;
          color: var(--color-text-secondary);
        }
        .sub-label {
          font-size: var(--font-size-xs) !important;
          color: var(--color-text-muted) !important;
        }
        .or-divider {
          display: flex;
          align-items: center;
          font-size: var(--font-size-xs);
          color: var(--color-text-muted);
          font-weight: bold;
        }
        .height-section {
           background: #f1f5f9;
           padding: var(--spacing-md);
           border-radius: var(--radius-md);
        }
        .fade-in {
          animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
      `})]})};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var H6={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G6=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),He=(t,e)=>{const n=ve.forwardRef(({color:r="currentColor",size:i=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:o="",children:l,...u},h)=>ve.createElement("svg",{ref:h,...H6,width:i,height:i,stroke:r,strokeWidth:a?Number(s)*24/Number(i):s,className:["lucide",`lucide-${G6(t)}`,o].join(" "),...u},[...e.map(([f,p])=>ve.createElement(f,p)),...Array.isArray(l)?l:[l]]));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yC=He("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _C=He("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K6=He("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q6=He("Apple",[["path",{d:"M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z",key:"3s7exb"}],["path",{d:"M10 2c1 .5 2 2 2 5",key:"fcco2y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y6=He("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rb=He("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J6=He("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X6=He("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z6=He("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e5=He("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Si=He("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nb=He("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t5=He("Dumbbell",[["path",{d:"m6.5 6.5 11 11",key:"f7oqzb"}],["path",{d:"m21 21-1-1",key:"cpc6if"}],["path",{d:"m3 3 1 1",key:"d3rpuf"}],["path",{d:"m18 22 4-4",key:"1e32o6"}],["path",{d:"m2 6 4-4",key:"189tqz"}],["path",{d:"m3 10 7-7",key:"1bxui2"}],["path",{d:"m14 21 7-7",key:"16x78n"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n5=He("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dv=He("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pb=He("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vC=He("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r5=He("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i5=He("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s5=He("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a5=He("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o5=He("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l5=He("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u5=He("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c5=He("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d5=He("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h5=He("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f5=He("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wC=He("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bC=He("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Du=He("Utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"1ogz0v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p5=He("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m5=He("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),g5=({user:t,onClose:e,onLogout:n,onNavigate:r})=>{const[i,s]=ve.useState("health"),[a,o]=ve.useState(!1),[l,u]=ve.useState({name:t.name||"",age:t.age||"",gender:t.gender||"Male",height:t.height||"",weight:t.weight||"",bloodGroup:t.bloodGroup||"",diseases:t.diseases||"",allergies:t.allergies||"",notes:t.notes||""}),[h,f]=ve.useState([]);ve.useEffect(()=>{const $=localStorage.getItem(`profile_${t.email}`);$&&u({...l,...JSON.parse($)});const w=t.email?`reports_${t.email}`:"blood_reports",y=JSON.parse(localStorage.getItem(w)||"[]");f(y)},[t.email]);const p=()=>{localStorage.setItem(`profile_${t.email}`,JSON.stringify(l)),o(!1),alert("Profile saved successfully!")},g=$=>{if(!window.confirm("Are you sure you want to delete this report?"))return;const w=[...h];w.splice($,1),f(w);const y=t.email?`reports_${t.email}`:"blood_reports";localStorage.setItem(y,JSON.stringify(w))},x=(()=>{if(!l.height||!l.weight)return null;const $=l.height/100;return(l.weight/($*$)).toFixed(1)})();return E.jsxs("div",{className:"profile-dashboard fixed-fullscreen",children:[E.jsxs("div",{className:"profile-header",children:[E.jsx("button",{onClick:e,className:"p-back-btn",children:E.jsx(Si,{size:24})}),E.jsx("h3",{children:"My Profile"}),E.jsx("button",{onClick:n,className:"p-logout",children:"Logout"})]}),E.jsxs("div",{className:"p-hero",children:[E.jsx("div",{className:"p-avatar",children:E.jsx(bC,{size:40,color:"white"})}),E.jsx("h2",{children:l.name||"User"}),E.jsxs("div",{className:"p-badges",children:[x&&E.jsxs("span",{className:"p-badge",children:["BMI: ",x]}),l.bloodGroup&&E.jsx("span",{className:"p-badge red",children:l.bloodGroup})]})]}),E.jsxs("div",{className:"p-tabs",children:[E.jsx("button",{className:`p-tab ${i==="health"?"active":""}`,onClick:()=>s("health"),children:"Health Profile"}),E.jsx("button",{className:`p-tab ${i==="reports"?"active":""}`,onClick:()=>s("reports"),children:"Reports"})]}),E.jsxs("div",{className:"p-content",children:[i==="health"&&E.jsxs("div",{className:"tab-pane fade-in",children:[E.jsxs("div",{className:"pane-header",children:[E.jsx("h4",{children:"Personal & Medical Data"}),!a&&E.jsx("button",{className:"edit-toggle",onClick:()=>o(!0),children:"Edit"})]}),E.jsxs("div",{className:"form-grid",style:{marginBottom:"20px"},children:[E.jsxs("div",{className:"field",children:[E.jsx("label",{children:"Age"}),E.jsx("input",{type:"number",disabled:!a,value:l.age,onChange:$=>u({...l,age:$.target.value})})]}),E.jsxs("div",{className:"field",children:[E.jsx("label",{children:"Blood Group"}),E.jsxs("select",{disabled:!a,value:l.bloodGroup,onChange:$=>u({...l,bloodGroup:$.target.value}),children:[E.jsx("option",{value:"",children:"Select"}),E.jsx("option",{children:"A+"}),E.jsx("option",{children:"A-"}),E.jsx("option",{children:"B+"}),E.jsx("option",{children:"B-"}),E.jsx("option",{children:"O+"}),E.jsx("option",{children:"O-"}),E.jsx("option",{children:"AB+"}),E.jsx("option",{children:"AB-"})]})]}),E.jsxs("div",{className:"field",children:[E.jsx("label",{children:"Weight (kg)"}),E.jsx("input",{type:"number",disabled:!a,value:l.weight,onChange:$=>u({...l,weight:$.target.value})})]}),E.jsxs("div",{className:"field",children:[E.jsx("label",{children:"Height (cm)"}),E.jsx("input",{type:"number",disabled:!a,value:l.height,onChange:$=>u({...l,height:$.target.value})})]})]}),E.jsxs("div",{className:"health-form",children:[E.jsx("label",{children:"Existing Conditions (Diseases)"}),E.jsx("textarea",{disabled:!a,placeholder:"e.g. Diabetes, Hypertension...",value:l.diseases,onChange:$=>u({...l,diseases:$.target.value})}),E.jsx("label",{children:"Allergies"}),E.jsx("textarea",{disabled:!a,placeholder:"e.g. Peanuts, Penicillin...",value:l.allergies,onChange:$=>u({...l,allergies:$.target.value})}),E.jsx("label",{children:"Health Notes"}),E.jsx("textarea",{className:"large-text",disabled:!a,placeholder:"Write your fitness goals here...",value:l.notes,onChange:$=>u({...l,notes:$.target.value})})]}),a&&E.jsxs("button",{className:"save-btn",onClick:p,children:[E.jsx(a5,{size:18})," Save Health Data"]}),E.jsxs("div",{className:"milestones-preview",style:{marginTop:"20px",cursor:"pointer"},onClick:()=>r("weightprogress"),children:[E.jsxs("div",{className:"pane-header",style:{marginBottom:"10px"},children:[E.jsx("h5",{children:"Weight Tracker"}),E.jsx("span",{style:{fontSize:"12px",color:"var(--color-primary)"},children:"View Graph "})]}),E.jsx("p",{style:{fontSize:"12px",color:"#64748b"},children:"Track your weight journey over time."})]})]}),i==="reports"&&E.jsxs("div",{className:"tab-pane fade-in",children:[E.jsx("h4",{children:"Recent Blood Reports"}),h.length===0?E.jsx("p",{className:"empty-state",children:"No reports uploaded yet."}):E.jsx("div",{className:"reports-list",children:h.map(($,w)=>E.jsxs("div",{className:"report-item",children:[E.jsx("div",{className:"r-icon",children:E.jsx(Dv,{size:20})}),E.jsxs("div",{className:"r-info",children:[E.jsx("span",{className:"r-date",children:$.date}),E.jsxs("span",{className:"r-summary",children:[$.results.length," Parameters Analyzed"]})]}),E.jsxs("div",{className:"r-actions-row",children:[E.jsx("button",{className:"icon-btn-small",onClick:()=>r("blood",$),title:"View Detail",children:E.jsx(n5,{size:16,color:"var(--color-primary)"})}),E.jsx("button",{className:"icon-btn-small delete",onClick:()=>g(w),title:"Delete",children:E.jsx(d5,{size:16,color:"#ef4444"})})]})]},w))})]})]}),E.jsx("style",{children:`
                .fixed-fullscreen {
                    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                    background: #f8fafc; z-index: 2000;
                    overflow-y: auto;
                    font-family: var(--font-family-body);
                }
                .profile-header {
                    display: flex; justify-content: space-between; align-items: center;
                    padding: 20px; background: white;
                }
                .profile-header h3 { margin: 0; font-size: 18px; }
                .p-back-btn { background: none; font-size: 24px; padding: 0; }
                .p-logout { color: #ef4444; background: none; font-weight: 600; font-size: 14px; }

                .p-hero {
                    background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
                    color: white; padding: 30px; text-align: center;
                    border-radius: 0 0 30px 30px; margin-bottom: 20px;
                    box-shadow: 0 10px 30px rgba(230, 57, 70, 0.2);
                }
                .p-avatar {
                    width: 80px; height: 80px; background: rgba(255,255,255,0.2);
                    border-radius: 50%; margin: 0 auto 15px;
                    display: flex; align-items: center; justify-content: center;
                    backdrop-filter: blur(5px); border: 2px solid rgba(255,255,255,0.4);
                }
                .p-badges { display: flex; justify-content: center; gap: 10px; margin-top: 10px; }
                .p-badge { background: rgba(0,0,0,0.2); padding: 4px 12px; border-radius: 99px; font-size: 12px; font-weight: 600; }
                .p-badge.red { background: #fee2e2; color: #991b1b; }

                .p-tabs {
                    display: flex; padding: 0 20px; gap: 10px; border-bottom: 1px solid #e2e8f0;
                }
                .p-tab {
                    flex: 1; padding: 12px; background: none; border-bottom: 3px solid transparent;
                    color: #64748b; font-weight: 600; font-size: 14px;
                }
                .p-tab.active { border-color: var(--color-primary); color: var(--color-primary); }

                .p-content { padding: 20px; }
                .tab-pane { animation: fadeIn 0.3s ease; }
                .pane-header { display: flex; justify-content: space-between; margin-bottom: 20px; align-items: center; }
                .edit-toggle { color: var(--color-primary); font-size: 14px; font-weight: 600; background: none; }

                .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
                .field label { display: block; font-size: 12px; color: #64748b; margin-bottom: 5px; }
                .field input, .field select {
                    width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px;
                    background: white; font-weight: 500;
                }
                .field input:disabled { background: #f1f5f9; color: #94a3b8; }

                .health-form label { display: block; font-size: 13px; font-weight: 600; margin-top: 15px; margin-bottom: 5px; }
                .health-form textarea {
                    width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 12px;
                    font-family: inherit; resize: none; height: 60px;
                }
                .health-form textarea.large-text { height: 100px; }

                .save-btn {
                    width: 100%; background: var(--color-primary); color: white;
                    padding: 14px; border-radius: 12px; margin-top: 25px;
                    font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px;
                    box-shadow: 0 4px 12px rgba(230, 57, 70, 0.2);
                }

                .reports-list { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
                .report-item {
                    background: white; padding: 15px; border-radius: 12px;
                    display: flex; align-items: center; gap: 15px;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
                }
                .r-icon {
                    width: 40px; height: 40px; background: #eff6ff; color: #3b82f6;
                    border-radius: 50%; display: flex; align-items: center; justify-content: center;
                }
                .r-info { flex: 1; display: flex; flex-direction: column; }
                .r-date { font-weight: 600; font-size: 14px; }
                .r-summary { font-size: 12px; color: #64748b; }
                .r-actions-row { display: flex; gap: 8px; }
                .icon-btn-small { 
                    background: #f1f5f9; border: none; padding: 6px; border-radius: 6px; 
                    cursor: pointer; display: flex; align-items: center; justify-content: center;
                }
                .icon-btn-small:hover { background: #e2e8f0; }
                .icon-btn-small.delete:hover { background: #fee2e2; }

                .export-btn {
                     width: 100%; margin-top: 20px; padding: 12px;
                     border: 1px dashed #cbd5e1; background: white; color: #475569;
                     border-radius: 12px; display: flex; justify-content: center; gap: 8px;
                     align-items: center;
                }

                .milestones-preview { margin-top: 30px; padding: 15px; background: #fff7ed; border-radius: 12px; }
                .milestone-badges { display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; }
                .m-badge { background: white; padding: 5px 10px; border-radius: 8px; font-size: 12px; font-weight: 600; color: #c2410c; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

                .fade-in { animation: fadeIn 0.4s ease; }
                @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
            `})]})},y5=({userName:t,userProfile:e,onNavigate:n,onLogout:r})=>{const[i,s]=ve.useState(!1);if(i)return E.jsx(g5,{user:e||{name:t,email:"user@example.com"},onClose:()=>s(!1),onLogout:r,onNavigate:n});const a=[{id:"blood",title:"Blood Evaluation",desc:"Analyze reports & get insights",icon:E.jsx(Dv,{size:24}),color:"#4361EE",bg:"#F0F4FF"},{id:"diet",title:"Specialized Diet",desc:"Meals based on Blood Report",icon:E.jsx(Q6,{size:24}),color:"#10B981",bg:"#ECFDF5"},{id:"bmi",title:"BMI Calculator",desc:"Check your health risk & vitals",icon:E.jsx(J6,{size:24}),color:"var(--color-primary)",bg:"#FFF0F1"},{id:"fitness",title:"Fitness Helper",desc:"Diet plans & weight goals",icon:E.jsx(Du,{size:24}),color:"#2A9D8F",bg:"#EDF7F6"},{id:"homeworkout",title:"Home Workout",desc:"8 Basic exercises & calories",icon:E.jsx(t5,{size:24}),color:"#FF6B6B",bg:"#FFF0F1"},{id:"chat",title:"AI Health Bot",desc:"Ask questions & get advice",icon:E.jsx(r5,{size:24}),color:"#7209B7",bg:"#F3E8FF"}];return E.jsxs("div",{className:"dashboard-container fade-in",children:[E.jsxs("header",{className:"dash-header",children:[E.jsx("div",{className:"avatar",onClick:()=>s(!0),style:{cursor:"pointer"},children:t?t.charAt(0).toUpperCase():"U"}),E.jsxs("div",{className:"welcome-text",children:[E.jsx("p",{children:"Welcome back,"}),E.jsx("h3",{children:t||"User"})]})]}),E.jsx("div",{className:"stats-preview",children:E.jsxs("div",{className:"stat-card",children:[E.jsx("h4",{children:"Stay Hydrated! "}),E.jsx("p",{children:"Drink 8 glasses of water today."})]})}),E.jsx("div",{className:"options-grid",children:a.map(o=>E.jsxs("button",{className:"option-card",onClick:()=>n(o.id),style:{"--hover-color":o.color},children:[E.jsx("div",{className:"icon-box",style:{color:o.color,backgroundColor:o.bg},children:o.icon}),E.jsxs("div",{className:"text-box",children:[E.jsx("h4",{children:o.title}),E.jsx("p",{children:o.desc})]}),E.jsx("div",{className:"arrow",children:""})]},o.id))}),E.jsx("style",{children:`
        .dashboard-container {
          padding: var(--spacing-md);
          padding-bottom: 80px; /* Space for bottom nav if added */
        }
        
        .dash-header {
          display: flex;
          align-items: center;
          gap: var(--spacing-md);
          margin-bottom: var(--spacing-xl);
        }

        .avatar {
          width: 50px;
          height: 50px;
          background: var(--color-primary);
          color: white;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
          font-size: var(--font-size-lg);
          box-shadow: var(--shadow-md);
        }

        .welcome-text {
          flex: 1;
        }

        .welcome-text p {
          color: var(--color-text-secondary);
          font-size: var(--font-size-xs);
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }

        .welcome-text h3 {
          color: var(--color-text-main);
        }

        .notif-btn {
          background: white;
          padding: 10px;
          border-radius: 50%;
          box-shadow: var(--shadow-sm);
          position: relative;
        }

        .badge {
          position: absolute;
          top: 8px;
          right: 8px;
          width: 8px;
          height: 8px;
          background: var(--color-danger);
          border-radius: 50%;
          border: 1px solid white;
        }

        .stats-preview {
          margin-bottom: var(--spacing-xl);
        }

        .stat-card {
           background: linear-gradient(135deg, #4CC9F0 0%, #4361EE 100%);
           color: white;
           padding: var(--spacing-lg);
           border-radius: var(--radius-lg);
           box-shadow: var(--shadow-md);
        }

        .options-grid {
          display: flex;
          flex-direction: column;
          gap: var(--spacing-md);
        }

        .option-card {
          display: flex;
          align-items: center;
          gap: var(--spacing-md);
          background: white;
          padding: var(--spacing-md);
          border-radius: var(--radius-lg);
          border: 1px solid rgba(0,0,0,0.04);
          box-shadow: var(--shadow-sm);
          text-align: left;
          width: 100%;
          transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .option-card:hover { /* Desktop hover */
           transform: translateY(-2px);
           box-shadow: var(--shadow-md);
           border-color: var(--hover-color);
        }

        .option-card:active {
           transform: scale(0.98);
        }

        .icon-box {
          width: 50px;
          height: 50px;
          border-radius: var(--radius-md);
          display: flex;
          align-items: center;
          justify-content: center;
          flex-shrink: 0;
        }

        .text-box {
          flex: 1;
        }

        .text-box h4 {
           margin-bottom: 2px;
           color: var(--color-text-main);
        }

        .text-box p {
           font-size: var(--font-size-xs);
           color: var(--color-text-secondary);
        }

        .arrow {
          color: var(--color-text-muted);
          font-weight: bold;
        }
      `})]})},_5=({userProfile:t,onBack:e})=>{const[n,r]=ve.useState("metric"),[i,s]=ve.useState(""),[a,o]=ve.useState(""),[l,u]=ve.useState(""),[h,f]=ve.useState(""),[p,g]=ve.useState("male"),[_,x]=ve.useState("sedentary"),[$,w]=ve.useState(null),[y,I]=ve.useState(""),[R,M]=ve.useState(""),[j,C]=ve.useState("");ve.useEffect(()=>{t&&(t.height&&s(t.height),t.weight&&u(t.weight),t.age&&f(t.age),t.gender&&g(t.gender.toLowerCase()))},[t]);const k=()=>{let A=0,D=0;if(n==="metric"){if(!i||!l)return;A=parseFloat(i)/100,D=parseFloat(l)}else{if(!i||!l)return;A=(parseFloat(i)*12+(parseFloat(a)||0))*.0254,D=parseFloat(l)*.453592}if(A<=0||D<=0)return;const z=parseFloat((D/(A*A)).toFixed(1));w(z);let O="",ce="",de="";z<18.5?(O="Underweight",ce="var(--color-accent)",de="You may need to increase your calorie intake. Focus on nutrient-dense foods."):z<24.9?(O="Normal Weight",ce="var(--color-success)",de="Great job! You have a healthy body weight. Maintain it with balanced diet and exercise."):z<29.9?(O="Overweight",ce="var(--color-warning)",de="Try to incorporate more cardio and monitor portion sizes to reach a healthier range."):(O="Obese",ce="var(--color-danger)",de="It is recommended to consult a healthcare provider for a personalized weight management plan."),I({label:O,color:ce}),C(de);const pe=A/.0254-60;let K=0;p==="male"?K=52+1.9*Math.max(0,pe):K=49+1.7*Math.max(0,pe),M(`${K.toFixed(1)} - ${(K*1.1).toFixed(1)} kg`)},P=()=>{w(null),s(""),u(""),f("")};return E.jsxs("div",{className:"advanced-bmi-container fade-in",children:[E.jsxs("div",{className:"bmi-header",children:[E.jsx("button",{onClick:e,className:"btn-icon",children:E.jsx(Si,{size:24})}),E.jsx("h2",{children:"Advanced BMI Calculator"}),E.jsx("div",{style:{width:24}})," "]}),E.jsxs("div",{className:"calculator-grid",children:[E.jsxs("div",{className:"card input-card",children:[E.jsxs("div",{className:"toggle-row",children:[E.jsx("button",{className:`toggle-btn ${n==="metric"?"active":""}`,onClick:()=>r("metric"),children:"Metric (cm/kg)"}),E.jsx("button",{className:`toggle-btn ${n==="imperial"?"active":""}`,onClick:()=>r("imperial"),children:"Imperial (ft/lbs)"})]}),E.jsxs("div",{className:"form-row",children:[E.jsxs("div",{className:"form-group",children:[E.jsx("label",{children:"Gender"}),E.jsxs("select",{value:p,onChange:A=>g(A.target.value),children:[E.jsx("option",{value:"male",children:"Male"}),E.jsx("option",{value:"female",children:"Female"})]})]}),E.jsxs("div",{className:"form-group",children:[E.jsx("label",{children:"Age (years)"}),E.jsx("input",{type:"number",value:h,onChange:A=>f(A.target.value),placeholder:"25"})]})]}),E.jsxs("div",{className:"form-row",children:[E.jsxs("div",{className:"form-group",children:[E.jsx("label",{children:n==="metric"?"Height (cm)":"Height (ft)"}),E.jsx("input",{type:"number",value:i,onChange:A=>s(A.target.value),placeholder:n==="metric"?"175":"5"})]}),n==="imperial"&&E.jsxs("div",{className:"form-group",children:[E.jsx("label",{children:"Inches"}),E.jsx("input",{type:"number",value:a,onChange:A=>o(A.target.value),placeholder:"10"})]}),E.jsxs("div",{className:"form-group",children:[E.jsx("label",{children:n==="metric"?"Weight (kg)":"Weight (lbs)"}),E.jsx("input",{type:"number",value:l,onChange:A=>u(A.target.value),placeholder:n==="metric"?"70":"150"})]})]}),E.jsxs("div",{className:"form-group",children:[E.jsx("label",{children:"Activity Level"}),E.jsxs("select",{value:_,onChange:A=>x(A.target.value),children:[E.jsx("option",{value:"sedentary",children:"Sedentary (Little or no exercise)"}),E.jsx("option",{value:"light",children:"Lightly active (1-3 days/week)"}),E.jsx("option",{value:"moderate",children:"Moderately active (3-5 days/week)"}),E.jsx("option",{value:"active",children:"Very active (6-7 days/week)"})]})]}),E.jsxs("div",{className:"action-row",children:[E.jsx("button",{className:"reset-btn",onClick:P,children:E.jsx(s5,{size:18})}),E.jsx("button",{className:"calculate-btn",onClick:k,children:"Calculate BMI"})]})]}),$&&E.jsxs("div",{className:"card result-card fade-in",children:[E.jsxs("div",{className:"result-header",children:[E.jsx("h3",{children:"Your Result"}),E.jsx("div",{className:"bmi-badge",style:{backgroundColor:y.color},children:y.label})]}),E.jsxs("div",{className:"bmi-display",children:[E.jsx("span",{className:"bmi-number",style:{color:y.color},children:$}),E.jsx("span",{className:"bmi-label",children:"BMI Score"})]}),E.jsxs("div",{className:"progress-bar-container",children:[E.jsx("div",{className:"progress-track"}),E.jsx("div",{className:"progress-fill",style:{width:`${Math.min(Math.max($/40*100,0),100)}%`,backgroundColor:y.color}}),E.jsxs("div",{className:"markers",children:[E.jsx("span",{style:{left:"46%"},children:"18.5"}),E.jsx("span",{style:{left:"62.5%"},children:"25"}),E.jsx("span",{style:{left:"75%"},children:"30"})]})]}),E.jsxs("div",{className:"health-insight",children:[E.jsxs("div",{className:"insight-item",children:[E.jsx(yC,{size:20,className:"icon"}),E.jsxs("div",{children:[E.jsx("h4",{children:"Ideal Weight"}),E.jsx("p",{children:R})]})]}),E.jsxs("div",{className:"insight-item",children:[E.jsx(vC,{size:20,className:"icon"}),E.jsxs("div",{children:[E.jsx("h4",{children:"Health Tip"}),E.jsx("p",{children:j})]})]})]})]})]}),E.jsx("style",{children:`
                .advanced-bmi-container {
                    padding: 20px;
                    max-width: 600px;
                    margin: 0 auto;
                }
                .bmi-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 25px;
                }
                .btn-icon { background: none; color: var(--color-text-main); padding: 0; }
                
                .toggle-row {
                    display: flex;
                    background: #f1f5f9;
                    border-radius: 12px;
                    padding: 4px;
                    margin-bottom: 20px;
                }
                .toggle-btn {
                    flex: 1;
                    padding: 10px;
                    border-radius: 8px;
                    background: transparent;
                    color: #64748b;
                    font-weight: 600;
                    font-size: 14px;
                    transition: all 0.2s;
                }
                .toggle-btn.active {
                    background: white;
                    color: var(--color-primary);
                    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                }

                .form-row {
                    display: flex;
                    gap: 15px;
                    margin-bottom: 15px;
                }
                .form-group { flex: 1; }
                .form-group label {
                    display: block;
                    font-size: 13px;
                    font-weight: 600;
                    color: #475569;
                    margin-bottom: 6px;
                }
                .form-group input, .form-group select {
                    width: 100%;
                    padding: 12px;
                    border: 1px solid #e2e8f0;
                    border-radius: 10px;
                    font-size: 16px;
                    background: #fff;
                    transition: border-color 0.2s;
                }
                .form-group input:focus, .form-group select:focus {
                    outline: none;
                    border-color: var(--color-primary);
                }

                .action-row {
                    display: flex;
                    gap: 10px;
                    margin-top: 25px;
                }
                .reset-btn {
                    width: 48px;
                    background: #f1f5f9;
                    color: #64748b;
                    border-radius: 12px;
                    display: flex; align-items: center; justify-content: center;
                }
                .calculate-btn {
                    flex: 1;
                    background: var(--color-primary);
                    color: white;
                    padding: 14px;
                    border-radius: 12px;
                    font-weight: 600;
                    font-size: 16px;
                    box-shadow: 0 4px 12px rgba(230, 57, 70, 0.25);
                }
                .calculate-btn:active { transform: scale(0.98); }

                /* Result Card Styles */
                .result-card {
                    margin-top: 25px;
                    border: 1px solid #e2e8f0;
                }
                .result-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    border-bottom: 1px solid #f1f5f9;
                    padding-bottom: 15px;
                    margin-bottom: 20px;
                }
                .bmi-badge {
                    padding: 6px 12px;
                    border-radius: 99px;
                    color: white;
                    font-size: 12px;
                    font-weight: 700;
                    text-transform: uppercase;
                }
                
                .bmi-display {
                    text-align: center;
                    margin-bottom: 25px;
                }
                .bmi-number {
                    display: block;
                    font-size: 4rem;
                    font-weight: 800;
                    line-height: 1;
                }
                .bmi-label {
                    color: #94a3b8;
                    font-size: 14px;
                    font-weight: 500;
                }

                .progress-bar-container {
                    position: relative;
                    height: 12px;
                    background: #f1f5f9;
                    border-radius: 99px;
                    margin-bottom: 30px;
                }
                .progress-fill {
                    height: 100%;
                    border-radius: 99px;
                    transition: width 1s ease-out;
                }
                .markers {
                    position: absolute;
                    top: 15px;
                    left: 0;
                    width: 100%;
                    height: 20px;
                }
                .markers span {
                    position: absolute;
                    transform: translateX(-50%);
                    font-size: 10px;
                    color: #94a3b8;
                    font-weight: 600;
                }
                .markers span::before {
                    content: '';
                    position: absolute;
                    top: -15px;
                    left: 50%;
                    width: 2px;
                    height: 12px;
                    background: white;
                    transform: translateX(-50%);
                }

                .health-insight {
                    background: #f8fafc;
                    border-radius: 12px;
                    padding: 15px;
                    display: flex;
                    flex-direction: column;
                    gap: 15px;
                }
                .insight-item {
                    display: flex;
                    gap: 15px;
                    align-items: flex-start;
                }
                .insight-item .icon {
                    color: var(--color-primary);
                    margin-top: 2px;
                }
                .insight-item h4 {
                    font-size: 14px;
                    margin-bottom: 4px;
                    color: var(--color-text-main);
                }
                .insight-item p {
                    font-size: 13px;
                    color: #64748b;
                    line-height: 1.4;
                }

                .fade-in { animation: fadeIn 0.4s ease-out; }
                @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
            `})]})};var v5={exports:{}};(function(t){var e=function(n){var r=Object.prototype,i=r.hasOwnProperty,s=Object.defineProperty||function(B,F,U){B[F]=U.value},a,o=typeof Symbol=="function"?Symbol:{},l=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",h=o.toStringTag||"@@toStringTag";function f(B,F,U){return Object.defineProperty(B,F,{value:U,enumerable:!0,configurable:!0,writable:!0}),B[F]}try{f({},"")}catch{f=function(F,U,G){return F[U]=G}}function p(B,F,U,G){var q=F&&F.prototype instanceof I?F:I,Y=Object.create(q.prototype),ae=new ue(G||[]);return s(Y,"_invoke",{value:z(B,U,ae)}),Y}n.wrap=p;function g(B,F,U){try{return{type:"normal",arg:B.call(F,U)}}catch(G){return{type:"throw",arg:G}}}var _="suspendedStart",x="suspendedYield",$="executing",w="completed",y={};function I(){}function R(){}function M(){}var j={};f(j,l,function(){return this});var C=Object.getPrototypeOf,k=C&&C(C(pe([])));k&&k!==r&&i.call(k,l)&&(j=k);var P=M.prototype=I.prototype=Object.create(j);R.prototype=M,s(P,"constructor",{value:M,configurable:!0}),s(M,"constructor",{value:R,configurable:!0}),R.displayName=f(M,h,"GeneratorFunction");function A(B){["next","throw","return"].forEach(function(F){f(B,F,function(U){return this._invoke(F,U)})})}n.isGeneratorFunction=function(B){var F=typeof B=="function"&&B.constructor;return F?F===R||(F.displayName||F.name)==="GeneratorFunction":!1},n.mark=function(B){return Object.setPrototypeOf?Object.setPrototypeOf(B,M):(B.__proto__=M,f(B,h,"GeneratorFunction")),B.prototype=Object.create(P),B},n.awrap=function(B){return{__await:B}};function D(B,F){function U(Y,ae,Ee,Q){var be=g(B[Y],B,ae);if(be.type==="throw")Q(be.arg);else{var rt=be.arg,et=rt.value;return et&&typeof et=="object"&&i.call(et,"__await")?F.resolve(et.__await).then(function(vt){U("next",vt,Ee,Q)},function(vt){U("throw",vt,Ee,Q)}):F.resolve(et).then(function(vt){rt.value=vt,Ee(rt)},function(vt){return U("throw",vt,Ee,Q)})}}var G;function q(Y,ae){function Ee(){return new F(function(Q,be){U(Y,ae,Q,be)})}return G=G?G.then(Ee,Ee):Ee()}s(this,"_invoke",{value:q})}A(D.prototype),f(D.prototype,u,function(){return this}),n.AsyncIterator=D,n.async=function(B,F,U,G,q){q===void 0&&(q=Promise);var Y=new D(p(B,F,U,G),q);return n.isGeneratorFunction(F)?Y:Y.next().then(function(ae){return ae.done?ae.value:Y.next()})};function z(B,F,U){var G=_;return function(Y,ae){if(G===$)throw new Error("Generator is already running");if(G===w){if(Y==="throw")throw ae;return K()}for(U.method=Y,U.arg=ae;;){var Ee=U.delegate;if(Ee){var Q=O(Ee,U);if(Q){if(Q===y)continue;return Q}}if(U.method==="next")U.sent=U._sent=U.arg;else if(U.method==="throw"){if(G===_)throw G=w,U.arg;U.dispatchException(U.arg)}else U.method==="return"&&U.abrupt("return",U.arg);G=$;var be=g(B,F,U);if(be.type==="normal"){if(G=U.done?w:x,be.arg===y)continue;return{value:be.arg,done:U.done}}else be.type==="throw"&&(G=w,U.method="throw",U.arg=be.arg)}}}function O(B,F){var U=F.method,G=B.iterator[U];if(G===a)return F.delegate=null,U==="throw"&&B.iterator.return&&(F.method="return",F.arg=a,O(B,F),F.method==="throw")||U!=="return"&&(F.method="throw",F.arg=new TypeError("The iterator does not provide a '"+U+"' method")),y;var q=g(G,B.iterator,F.arg);if(q.type==="throw")return F.method="throw",F.arg=q.arg,F.delegate=null,y;var Y=q.arg;if(!Y)return F.method="throw",F.arg=new TypeError("iterator result is not an object"),F.delegate=null,y;if(Y.done)F[B.resultName]=Y.value,F.next=B.nextLoc,F.method!=="return"&&(F.method="next",F.arg=a);else return Y;return F.delegate=null,y}A(P),f(P,h,"Generator"),f(P,l,function(){return this}),f(P,"toString",function(){return"[object Generator]"});function ce(B){var F={tryLoc:B[0]};1 in B&&(F.catchLoc=B[1]),2 in B&&(F.finallyLoc=B[2],F.afterLoc=B[3]),this.tryEntries.push(F)}function de(B){var F=B.completion||{};F.type="normal",delete F.arg,B.completion=F}function ue(B){this.tryEntries=[{tryLoc:"root"}],B.forEach(ce,this),this.reset(!0)}n.keys=function(B){var F=Object(B),U=[];for(var G in F)U.push(G);return U.reverse(),function q(){for(;U.length;){var Y=U.pop();if(Y in F)return q.value=Y,q.done=!1,q}return q.done=!0,q}};function pe(B){if(B){var F=B[l];if(F)return F.call(B);if(typeof B.next=="function")return B;if(!isNaN(B.length)){var U=-1,G=function q(){for(;++U<B.length;)if(i.call(B,U))return q.value=B[U],q.done=!1,q;return q.value=a,q.done=!0,q};return G.next=G}}return{next:K}}n.values=pe;function K(){return{value:a,done:!0}}return ue.prototype={constructor:ue,reset:function(B){if(this.prev=0,this.next=0,this.sent=this._sent=a,this.done=!1,this.delegate=null,this.method="next",this.arg=a,this.tryEntries.forEach(de),!B)for(var F in this)F.charAt(0)==="t"&&i.call(this,F)&&!isNaN(+F.slice(1))&&(this[F]=a)},stop:function(){this.done=!0;var B=this.tryEntries[0],F=B.completion;if(F.type==="throw")throw F.arg;return this.rval},dispatchException:function(B){if(this.done)throw B;var F=this;function U(Q,be){return Y.type="throw",Y.arg=B,F.next=Q,be&&(F.method="next",F.arg=a),!!be}for(var G=this.tryEntries.length-1;G>=0;--G){var q=this.tryEntries[G],Y=q.completion;if(q.tryLoc==="root")return U("end");if(q.tryLoc<=this.prev){var ae=i.call(q,"catchLoc"),Ee=i.call(q,"finallyLoc");if(ae&&Ee){if(this.prev<q.catchLoc)return U(q.catchLoc,!0);if(this.prev<q.finallyLoc)return U(q.finallyLoc)}else if(ae){if(this.prev<q.catchLoc)return U(q.catchLoc,!0)}else if(Ee){if(this.prev<q.finallyLoc)return U(q.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(B,F){for(var U=this.tryEntries.length-1;U>=0;--U){var G=this.tryEntries[U];if(G.tryLoc<=this.prev&&i.call(G,"finallyLoc")&&this.prev<G.finallyLoc){var q=G;break}}q&&(B==="break"||B==="continue")&&q.tryLoc<=F&&F<=q.finallyLoc&&(q=null);var Y=q?q.completion:{};return Y.type=B,Y.arg=F,q?(this.method="next",this.next=q.finallyLoc,y):this.complete(Y)},complete:function(B,F){if(B.type==="throw")throw B.arg;return B.type==="break"||B.type==="continue"?this.next=B.arg:B.type==="return"?(this.rval=this.arg=B.arg,this.method="return",this.next="end"):B.type==="normal"&&F&&(this.next=F),y},finish:function(B){for(var F=this.tryEntries.length-1;F>=0;--F){var U=this.tryEntries[F];if(U.finallyLoc===B)return this.complete(U.completion,U.afterLoc),de(U),y}},catch:function(B){for(var F=this.tryEntries.length-1;F>=0;--F){var U=this.tryEntries[F];if(U.tryLoc===B){var G=U.completion;if(G.type==="throw"){var q=G.arg;de(U)}return q}}throw new Error("illegal catch attempt")},delegateYield:function(B,F,U){return this.delegate={iterator:pe(B),resultName:F,nextLoc:U},this.method==="next"&&(this.arg=a),y}},n}(t.exports);try{regeneratorRuntime=e}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})(v5);var Mv=(t,e)=>`${t}-${e}-${Math.random().toString(16).slice(3,8)}`;const w5=Mv;let Ob=0;var xC=({id:t,action:e,payload:n={}})=>{let r=t;return typeof r>"u"&&(r=w5("Job",Ob),Ob+=1),{id:r,action:e,payload:n}},ol={};let Lv=!1;ol.logging=Lv;ol.setLogging=t=>{Lv=t};ol.log=(...t)=>Lv?console.log.apply(void 0,t):null;const b5=xC,{log:zd}=ol,x5=Mv;let Db=0;var E5=()=>{const t=x5("Scheduler",Db),e={},n={};let r=[];Db+=1;const i=()=>r.length,s=()=>Object.keys(e).length,a=()=>{if(r.length!==0){const f=Object.keys(e);for(let p=0;p<f.length;p+=1)if(typeof n[f[p]]>"u"){r[0](e[f[p]]);break}}},o=(f,p)=>new Promise((g,_)=>{const x=b5({action:f,payload:p});r.push(async $=>{r.shift(),n[$.id]=x;try{g(await $[f].apply(void 0,[...p,x.id]))}catch(w){_(w)}finally{delete n[$.id],a()}}),zd(`[${t}]: Add ${x.id} to JobQueue`),zd(`[${t}]: JobQueue length=${r.length}`),a()});return{addWorker:f=>(e[f.id]=f,zd(`[${t}]: Add ${f.id}`),zd(`[${t}]: Number of workers=${s()}`),a(),f.id),addJob:async(f,...p)=>{if(s()===0)throw Error(`[${t}]: You need to have at least one worker before adding jobs`);return o(f,p)},terminate:async()=>{Object.keys(e).forEach(async f=>{await e[f].terminate()}),r=[]},getQueueLen:i,getNumWorkers:s}};function T5(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}function I5(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}var $5=I5;const k5=$5;var S5=t=>{const e={};return typeof WorkerGlobalScope<"u"?e.type="webworker":k5()?e.type="electron":typeof document=="object"?e.type="browser":typeof process=="object"&&typeof T5=="function"&&(e.type="node"),typeof t>"u"?e:e[t]};const C5=S5("type")==="browser",A5=C5?t=>new URL(t,window.location.href).href:t=>t;var R5=t=>{const e={...t};return["corePath","workerPath","langPath"].forEach(n=>{t[n]&&(e[n]=A5(e[n]))}),e},N5=t=>{const e=[],n=[],r=[],i=[],s=[];return t.blocks&&t.blocks.forEach(a=>{a.paragraphs.forEach(o=>{o.lines.forEach(l=>{l.words.forEach(u=>{u.symbols.forEach(h=>{s.push({...h,page:t,block:a,paragraph:o,line:l,word:u})}),i.push({...u,page:t,block:a,paragraph:o,line:l})}),r.push({...l,page:t,block:a,paragraph:o})}),n.push({...o,page:t,block:a})}),e.push({...a,page:t})}),{...t,blocks:e,paragraphs:n,lines:r,words:i,symbols:s}},EC={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const P5="5.1.1",O5={version:P5};var D5={workerBlobURL:!0,logger:()=>{}};const M5=O5.version,L5=D5;var z5={...L5,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${M5}/dist/worker.min.js`},V5=({workerPath:t,workerBlobURL:e})=>{let n;if(Blob&&URL&&e){const r=new Blob([`importScripts("${t}");`],{type:"application/javascript"});n=new Worker(URL.createObjectURL(r))}else n=new Worker(t);return n},j5=t=>{t.terminate()},U5=(t,e)=>{t.onmessage=({data:n})=>{e(n)}},B5=async(t,e)=>{t.postMessage(e)};const dm=t=>new Promise((e,n)=>{const r=new FileReader;r.onload=()=>{e(r.result)},r.onerror=({target:{error:{code:i}}})=>{n(Error(`File could not be read! Code=${i}`))},r.readAsArrayBuffer(t)}),Cy=async t=>{let e=t;if(typeof t>"u")return"undefined";if(typeof t=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(t)?e=atob(t.split(",")[1]).split("").map(n=>n.charCodeAt(0)):e=await(await fetch(t)).arrayBuffer();else if(typeof HTMLElement<"u"&&t instanceof HTMLElement)t.tagName==="IMG"&&(e=await Cy(t.src)),t.tagName==="VIDEO"&&(e=await Cy(t.poster)),t.tagName==="CANVAS"&&await new Promise(n=>{t.toBlob(async r=>{e=await dm(r),n()})});else if(typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas){const n=await t.convertToBlob();e=await dm(n)}else(t instanceof File||t instanceof Blob)&&(e=await dm(t));return new Uint8Array(e)};var F5=Cy;const W5=z5,q5=V5,H5=j5,G5=U5,K5=B5,Q5=F5;var Y5={defaultOptions:W5,spawnWorker:q5,terminateWorker:H5,onMessage:G5,send:K5,loadImage:Q5};const J5=R5,X5=N5,ar=xC,{log:Mb}=ol,Z5=Mv,Ks=EC,{defaultOptions:eU,spawnWorker:tU,terminateWorker:nU,onMessage:rU,loadImage:Lb,send:iU}=Y5;let zb=0;var TC=async(t="eng",e=Ks.LSTM_ONLY,n={},r={})=>{const i=Z5("Worker",zb),{logger:s,errorHandler:a,...o}=J5({...eU,...n}),l={},u={},h=typeof t=="string"?t.split("+"):t;let f=e,p=r;const g=[Ks.DEFAULT,Ks.LSTM_ONLY].includes(e)&&!o.legacyCore;let _,x;const $=new Promise((q,Y)=>{x=q,_=Y}),w=q=>{_(q.message)};let y=tU(o);y.onerror=w,zb+=1;const I=(q,Y)=>{l[q]=Y},R=(q,Y)=>{u[q]=Y},M=({id:q,action:Y,payload:ae})=>new Promise((Ee,Q)=>{Mb(`[${i}]: Start ${q}, action=${Y}`);const be=`${Y}-${q}`;I(be,Ee),R(be,Q),iU(y,{workerId:i,jobId:q,action:Y,payload:ae})}),j=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),C=q=>M(ar({id:q,action:"load",payload:{options:{lstmOnly:g,corePath:o.corePath,logging:o.logging}}})),k=(q,Y,ae)=>M(ar({id:ae,action:"FS",payload:{method:"writeFile",args:[q,Y]}})),P=(q,Y)=>M(ar({id:Y,action:"FS",payload:{method:"readFile",args:[q,{encoding:"utf8"}]}})),A=(q,Y)=>M(ar({id:Y,action:"FS",payload:{method:"unlink",args:[q]}})),D=(q,Y,ae)=>M(ar({id:ae,action:"FS",payload:{method:q,args:Y}})),z=()=>console.warn("`loadLanguage` is depreciated and should be removed from code (workers now come with language pre-loaded)"),O=(q,Y)=>M(ar({id:Y,action:"loadLanguage",payload:{langs:q,options:{langPath:o.langPath,dataPath:o.dataPath,cachePath:o.cachePath,cacheMethod:o.cacheMethod,gzip:o.gzip,lstmOnly:[Ks.DEFAULT,Ks.LSTM_ONLY].includes(f)&&!o.legacyLang}}})),ce=()=>console.warn("`initialize` is depreciated and should be removed from code (workers now come pre-initialized)"),de=(q,Y,ae,Ee)=>M(ar({id:Ee,action:"initialize",payload:{langs:q,oem:Y,config:ae}})),ue=(q="eng",Y,ae,Ee)=>{if(g&&[Ks.TESSERACT_ONLY,Ks.TESSERACT_LSTM_COMBINED].includes(Y))throw Error("Legacy model requested but code missing.");const Q=Y||f;f=Q;const be=ae||p;p=be;const et=(typeof q=="string"?q.split("+"):q).filter(vt=>!h.includes(vt));return h.push(...et),et.length>0?O(et,Ee).then(()=>de(q,Q,be,Ee)):de(q,Q,be,Ee)},pe=(q={},Y)=>M(ar({id:Y,action:"setParameters",payload:{params:q}})),K=async(q,Y={},ae={blocks:!0,text:!0,hocr:!0,tsv:!0},Ee)=>M(ar({id:Ee,action:"recognize",payload:{image:await Lb(q),options:Y,output:ae}})),B=(q="Tesseract OCR Result",Y=!1,ae)=>(console.log("`getPDF` function is depreciated. `recognize` option `savePDF` should be used instead."),M(ar({id:ae,action:"getPDF",payload:{title:q,textonly:Y}}))),F=async(q,Y)=>{if(g)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return M(ar({id:Y,action:"detect",payload:{image:await Lb(q)}}))},U=async()=>(y!==null&&(nU(y),y=null),Promise.resolve());rU(y,({workerId:q,jobId:Y,status:ae,action:Ee,data:Q})=>{const be=`${Ee}-${Y}`;if(ae==="resolve"){Mb(`[${q}]: Complete ${Y}`);let rt=Q;Ee==="recognize"?rt=X5(Q):Ee==="getPDF"&&(rt=Array.from({...Q,length:Object.keys(Q).length})),l[be]({jobId:Y,data:rt})}else if(ae==="reject")if(u[be](Q),Ee==="load"&&_(Q),a)a(Q);else throw Error(Q);else ae==="progress"&&s({...Q,userJobId:Y})});const G={id:i,worker:y,setResolve:I,setReject:R,load:j,writeText:k,readText:P,removeFile:A,FS:D,loadLanguage:z,initialize:ce,reinitialize:ue,setParameters:pe,recognize:K,getPDF:B,detect:F,terminate:U};return C().then(()=>O(t)).then(()=>de(t,e,r)).then(()=>x(G)).catch(()=>{}),$};const IC=TC,sU=async(t,e,n)=>{const r=await IC(e,1,n);return r.recognize(t).finally(async()=>{await r.terminate()})},aU=async(t,e)=>{const n=await IC("osd",0,e);return n.detect(t).finally(async()=>{await n.terminate()})};var oU={recognize:sU,detect:aU},lU={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},uU={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"};const cU=E5,dU=TC,hU=oU,fU=lU,pU=EC,mU=uU,{setLogging:gU}=ol;var yU={languages:fU,OEM:pU,PSM:mU,createScheduler:cU,createWorker:dU,setLogging:gU,...hU};const $C=ET(yU),Vb={hemoglobin:["hemoglobin","haemoglobin","hb","hgb"],rbc_count:["rbc count","total rbc","red blood cells","erythrocyte count"],total_count:["total leucocyte count","tlc","wbc count","white blood cells","total count"],platelet_count:["platelet count","platelet","plt"],hematocrit:["hematocrit","hct","pcv","packed cell volume"],mcv:["mcv","mean corpuscular volume"],mch:["mch","mean corpuscular hemoglobin"],mchc:["mchc","mean corpuscular hemoglobin concentration"],rdw:["rdw","red cell distribution width"],neutrophil:["neutrophils","polymorphs","neutrophil"],lymphocyte:["lymphocytes","lymphocyte"],monocyte:["monocytes","monocyte"],eosinophil:["eosinophils","eosinophil"],basophil:["basophils","basophil"],reticulocyte_count:["reticulocyte count","retic count"],esr:["esr","erythrocyte sedimentation rate"],absolute_neutrophil_count:["absolute neutrophil count","anc"],bun:["blood urea nitrogen","bun"],creatinine:["serum creatinine","creatinine"],uric_acid:["serum uric acid","uric acid"],bun_creatinine_ratio:["bun/creatinine ratio","bun/creat ratio"],egfr:["egfr","estimated glomerular filtration rate"],urine_ph:["urine ph"],urine_specific_gravity:["urine specific gravity"],bilirubin_total:["total bilirubin","bilirubin total"],bilirubin_direct:["direct bilirubin","conjugated bilirubin"],bilirubin_indirect:["indirect bilirubin","unconjugated bilirubin"],sgot:["sgot","ast","aspartate aminotransferase"],sgpt:["sgpt","alt","alanine aminotransferase"],alkaline_phosphatase:["alkaline phosphatase","alp"],total_protein:["total protein","serum protein"],albumin:["albumin"],globulin:["globulin"],ag_ratio:["a/g ratio","albumin/globulin ratio"],ggt:["gamma gt","ggt","gamma-glutamyl transferase"],ldh:["ldh","lactate dehydrogenase"],ammonia:["ammonia"],sodium:["sodium","na+","serum sodium"],potassium:["potassium","k+","serum potassium"],chloride:["chloride","cl-","serum chloride"],bicarbonate:["bicarbonate","hco3","co2 content"],calcium:["calcium","total calcium"],ionized_calcium:["ionized calcium"],phosphorus:["phosphorus","phosphate","po4"],magnesium:["magnesium"],anion_gap:["anion gap"],glucose_fasting:["glucose fasting","fasting glucose","fbs","fasting blood sugar"],glucose_pp:["glucose pp","ppbs","post prandial"],glucose_random:["random glucose","rbs"],hba1c:["hba1c","glycated hemoglobin","glycosylated hemoglobin"],insulin:["insulin fasting","fasting insulin"],c_peptide:["c-peptide"],cholesterol:["total cholesterol","serum cholesterol"],hdl_cholesterol:["hdl cholesterol","hdl"],ldl_cholesterol:["ldl cholesterol","ldl"],triglycerides:["triglycerides"],vldl:["vldl"],ldl_hdl_ratio:["ldl/hdl ratio"],chol_hdl_ratio:["total cholesterol/hdl ratio","chol/hdl"],non_hdl_cholesterol:["non-hdl cholesterol"],tsh:["thyroid stimulating hormone","tsh","thyrotropin"],t3:["triiodothyronine","total t3","t3"],t4:["thyroxine","total t4","t4"],free_t3:["free t3","ft3"],free_t4:["free t4","ft4"],anti_tpo:["anti-tpo","thyroid peroxidase antibody"],vitamin_b12:["vitamin b12","cobalamin"],vitamin_d:["vitamin d","25-oh vitamin d","total vitamin d"],folate:["folate","folic acid"],testosterone:["testosterone","total testosterone"],estradiol:["estradiol","e2"],progesterone:["progesterone"],cortisol:["cortisol"],prolactin:["prolactin"],ferritin:["ferritin"],iron:["serum iron","iron"],tibc:["tibc","total iron binding capacity"],crp:["crp","c-reactive protein"],hs_crp:["hs-crp","high sensitivity crp"],troponin_i:["troponin i"],troponin_t:["troponin t"],ck_total:["ck","cpk","creatine kinase"],ck_mb:["ck-mb"]},Mu={hemoglobin:{min:13,max:17,unit:"g/dL",foods:["Spinach","Red Meat","Beetroot"],impact:{low:"Fatigue, low stamina. Focus on endurance cautiously.",high:"Dehydration risk. Hydrate well."}},rbc_count:{min:4.5,max:5.9,unit:"mil/L",foods:["Iron-rich foods","B12"],impact:{}},total_count:{min:4e3,max:11e3,unit:"/L",foods:["Vitamin C","Garlic"],impact:{low:"Low immunity. Avoid growing crowds/gyms.",high:"Body fighting infection. Rest."}},platelet_count:{min:1.5,max:4.5,unit:"Lakh/L",foods:["Papaya Leaf"],impact:{low:"Bleeding risk. Avoid contact sports."}},hematocrit:{min:38,max:50,unit:"%",foods:["Iron","Water"],impact:{}},mcv:{min:80,max:100,unit:"fL",foods:["B12","Folate"],impact:{low:"Microcytic anemia risk.",high:"Macrocytic (B12 deficiency) risk."}},mch:{min:27,max:33,unit:"pg",foods:[],impact:{}},mchc:{min:32,max:36,unit:"g/dL",foods:[],impact:{}},rdw:{min:11.5,max:14.5,unit:"%",foods:[],impact:{}},neutrophil:{min:40,max:75,unit:"%",foods:[],impact:{high:"Bacterial infection likely. Rest."}},lymphocyte:{min:20,max:45,unit:"%",foods:[],impact:{high:"Viral infection likely. Rest."}},monocyte:{min:2,max:10,unit:"%",foods:[],impact:{}},eosinophil:{min:1,max:6,unit:"%",foods:[],impact:{high:"Allergy or parasite. Monitor breathing."}},basophil:{min:0,max:1,unit:"%",foods:[],impact:{}},esr:{min:0,max:20,unit:"mm/hr",foods:["Anti-inflammatory","Turmeric"],impact:{high:"High Inflammation. Focus on recovery, light stretching."}},bun:{min:7,max:20,unit:"mg/dL",foods:["Low Protein","Water"],impact:{high:"Kidney load high. Hydrate."}},creatinine:{min:.6,max:1.3,unit:"mg/dL",foods:["Less Red Meat","Cucumber"],impact:{high:"Kidney stress. Avoid creatine supplements."}},uric_acid:{min:3.5,max:7.2,unit:"mg/dL",foods:["Cherries","No Alcohol"],impact:{high:"Gout risk. Avoid high-impact jumping."}},egfr:{min:90,max:150,unit:"mL/min",foods:[],impact:{low:"Kidney functionality concern. Consult doctor."}},bilirubin_total:{min:.3,max:1.2,unit:"mg/dL",foods:["Radish","Lemon"],impact:{high:"Jaundice risk. No heavy lifting."}},sgot:{min:10,max:40,unit:"U/L",foods:["Liver Detox"],impact:{high:"Liver/Muscle stress. Take rest days."}},sgpt:{min:7,max:56,unit:"U/L",foods:["Whole grains"],impact:{high:"Liver enzyme elevation. Avoid alcohol/painkillers."}},alkaline_phosphatase:{min:44,max:147,unit:"U/L",foods:[],impact:{}},total_protein:{min:6.3,max:8.2,unit:"g/dL",foods:["Lean Protein"],impact:{}},albumin:{min:3.5,max:5,unit:"g/dL",foods:[],impact:{}},sodium:{min:135,max:145,unit:"mmol/L",foods:["Balanced Salt"],impact:{low:"Hyponatremia risk. Salt intake needed.",high:"Dehydration."}},potassium:{min:3.5,max:5.1,unit:"mmol/L",foods:["Banana","Coconut Water"],impact:{low:"Cramp risk. Electrolytes needed.",high:"Heart rhythm risk. Medical attention."}},calcium:{min:8.5,max:10.5,unit:"mg/dL",foods:["Milk","Yogurt"],impact:{low:"Bone weakness. Resistance train carefully."}},magnesium:{min:1.7,max:2.4,unit:"mg/dL",foods:["Nuts","Seeds"],impact:{low:"Muscle twitching/cramps."}},glucose_fasting:{min:70,max:100,unit:"mg/dL",foods:["Fiber","Low GI"],impact:{high:"Diabetes risk. Cardio recommended."}},glucose_pp:{min:70,max:140,unit:"mg/dL",foods:["Vegetables"],impact:{high:"Insulin resistance."}},hba1c:{min:4,max:5.6,unit:"%",foods:["Low Carb"],impact:{high:"Long term sugar control poor."}},insulin:{min:2,max:25,unit:"IU/mL",foods:[],impact:{}},cholesterol:{min:0,max:200,unit:"mg/dL",foods:["Oats","Garlic"],impact:{high:"Cardiac risk. Steady state cardio."}},hdl_cholesterol:{min:40,max:100,unit:"mg/dL",foods:["Nuts","Fish"],impact:{low:"Good cholesterol low. Needs exercise."}},ldl_cholesterol:{min:0,max:100,unit:"mg/dL",foods:["Fiber"],impact:{high:"Bad cholesterol. Diet control needed."}},triglycerides:{min:0,max:150,unit:"mg/dL",foods:["No Sugar","Fish Oil"],impact:{high:"Metabolic syndrome risk."}},tsh:{min:.4,max:4,unit:"IU/mL",foods:[],impact:{high:"Hypothyroid (Slow metabolism).",low:"Hyperthyroid (Fast HR)."}},t3:{min:80,max:200,unit:"ng/dL",foods:[],impact:{}},t4:{min:5,max:12,unit:"g/dL",foods:[],impact:{}},vitamin_b12:{min:200,max:900,unit:"pg/mL",foods:["Meat","Eggs","Supplements"],impact:{low:"Nerve health/Energy low."}},vitamin_d:{min:30,max:100,unit:"ng/mL",foods:["Sunlight","Mushrooms","Supplements"],impact:{low:"Bone density/Immunity risk."}},testosterone:{min:300,max:1e3,unit:"ng/dL",foods:["Zinc","Strength Training"],impact:{low:"Muscle loss, fatigue."}},cortisol:{min:5,max:25,unit:"g/dL",foods:["Ashwagandha","Sleep"],impact:{high:"High stress. Reduce intensity."}},ferritin:{min:20,max:300,unit:"ng/mL",foods:[],impact:{low:"Iron stores low."}},iron:{min:60,max:170,unit:"g/dL",foods:["Spinach"],impact:{low:"Anemia."}},crp:{min:0,max:10,unit:"mg/L",foods:["Anti-inflammatory"],impact:{high:"Systemic inflammation."}},hs_crp:{min:0,max:1,unit:"mg/L",foods:[],impact:{high:"Cardiac risk marker."}},troponin_i:{min:0,max:.04,unit:"ng/mL",foods:[],impact:{high:"CRITICAL: Heart muscle damage. ER immediately."}},ck_total:{min:20,max:200,unit:"U/L",foods:[],impact:{high:"Muscle breakdown (could be hard training or rhabdo)."}}},kC=t=>{const e=[];return Object.keys(t).forEach(n=>{const r=parseFloat(t[n]);!Mu[n]||isNaN(r)||(n==="hemoglobin"&&r<11&&e.push({condition:"Anemia",risk:"High",color:"#ef4444",advice:"Consult doctor for iron supplements."}),n==="glucose_fasting"&&r>126||n==="hba1c"&&r>6.5?e.push({condition:"Diabetes",risk:"High",color:"#ef4444",advice:"Manage sugar intake strictly."}):(n==="glucose_fasting"&&r>100||n==="hba1c">5.7)&&e.push({condition:"Pre-Diabetes",risk:"Medium",color:"#f59e0b",advice:"Lifestyle changes needed."}),n==="creatinine"&&r>1.4&&e.push({condition:"Renal Insufficiency Risk",risk:"High",color:"#ef4444",advice:"Kidney function concern."}),n==="troponin_i"&&r>.04&&e.push({condition:"Myocardial Injury Risk",risk:"CRITICAL",color:"#b91c1c",advice:"Seek immediate medical attention."}),n==="hs_crp"&&r>3&&e.push({condition:"High Cardiovascular Risk",risk:"High",color:"#ef4444",advice:"Inflammation marker high."}),n==="vitamin_d"&&r<20&&e.push({condition:"Vitamin D Deficiency",risk:"Medium",color:"#f59e0b",advice:"Supplementation recommended."}),n==="tsh"&&r>5&&e.push({condition:"Hypothyroidism Risk",risk:"Medium",color:"#f59e0b",advice:"Metabolism might be slow."}))}),e},SC=(t,e=[])=>{const n=[],r=[];Object.keys(t).forEach(s=>{var h,f;const a=parseFloat(t[s]),o=Mu[s];if(!o)return;let l="Normal";a<o.min&&(l="Low"),a>o.max&&(l="High");const u=l==="Low"?(h=o.impact)==null?void 0:h.low:l==="High"?(f=o.impact)==null?void 0:f.high:null;l!=="Normal"&&r.push({parameter:s,status:l,foods:o.foods,fitnessImpact:u}),n.push({parameter:s,value:a,unit:o.unit,range:`${o.min}-${o.max}`,status:l,fitnessImpact:u})});const i=e.length>0?e:kC(t);return{date:new Date().toLocaleDateString(),values:t,results:n,suggestions:r,risks:i}};/*!
 * ONNX Runtime Web v1.23.2
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */var zv=Object.defineProperty,_U=Object.getOwnPropertyDescriptor,vU=Object.getOwnPropertyNames,wU=Object.prototype.hasOwnProperty,bU=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')}),se=(t,e)=>()=>(t&&(e=t(t=0)),e),ll=(t,e)=>{for(var n in e)zv(t,n,{get:e[n],enumerable:!0})},xU=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of vU(e))!wU.call(t,i)&&i!==n&&zv(t,i,{get:()=>e[i],enumerable:!(r=_U(e,i))||r.enumerable});return t},fc=t=>xU(zv({},"__esModule",{value:!0}),t),Gl,ji,wo,jb,CC,AC=se(()=>{Gl=new Map,ji=[],wo=(t,e,n)=>{if(e&&typeof e.init=="function"&&typeof e.createInferenceSessionHandler=="function"){let r=Gl.get(t);if(r===void 0)Gl.set(t,{backend:e,priority:n});else{if(r.priority>n)return;if(r.priority===n&&r.backend!==e)throw new Error(`cannot register backend "${t}" using priority ${n}`)}if(n>=0){let i=ji.indexOf(t);i!==-1&&ji.splice(i,1);for(let s=0;s<ji.length;s++)if(Gl.get(ji[s]).priority<=n){ji.splice(s,0,t);return}ji.push(t)}return}throw new TypeError("not a valid backend")},jb=async t=>{let e=Gl.get(t);if(!e)return"backend not found.";if(e.initialized)return e.backend;if(e.aborted)return e.error;{let n=!!e.initPromise;try{return n||(e.initPromise=e.backend.init(t)),await e.initPromise,e.initialized=!0,e.backend}catch(r){return n||(e.error=`${r}`,e.aborted=!0),e.error}finally{delete e.initPromise}}},CC=async t=>{let e=t.executionProviders||[],n=e.map(l=>typeof l=="string"?l:l.name),r=n.length===0?ji:n,i,s=[],a=new Set;for(let l of r){let u=await jb(l);typeof u=="string"?s.push({name:l,err:u}):(i||(i=u),i===u&&a.add(l))}if(!i)throw new Error(`no available backend found. ERR: ${s.map(l=>`[${l.name}] ${l.err}`).join(", ")}`);for(let{name:l,err:u}of s)n.includes(l)&&console.warn(`removing requested execution provider "${l}" from session options because it is not available: ${u}`);let o=e.filter(l=>a.has(typeof l=="string"?l:l.name));return[i,new Proxy(t,{get:(l,u)=>u==="executionProviders"?o:Reflect.get(l,u)})]}}),EU=se(()=>{AC()}),RC,TU=se(()=>{RC="1.23.2"}),hm,Vt,NC=se(()=>{TU(),hm="warning",Vt={wasm:{},webgl:{},webgpu:{},versions:{common:RC},set logLevel(t){if(t!==void 0){if(typeof t!="string"||["verbose","info","warning","error","fatal"].indexOf(t)===-1)throw new Error(`Unsupported logging level: ${t}`);hm=t}},get logLevel(){return hm}},Object.defineProperty(Vt,"logLevel",{enumerable:!0})}),it,IU=se(()=>{NC(),it=Vt}),PC,OC,$U=se(()=>{PC=(t,e)=>{let n=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);n.width=t.dims[3],n.height=t.dims[2];let r=n.getContext("2d");if(r!=null){let i,s;(e==null?void 0:e.tensorLayout)!==void 0&&e.tensorLayout==="NHWC"?(i=t.dims[2],s=t.dims[3]):(i=t.dims[3],s=t.dims[2]);let a=(e==null?void 0:e.format)!==void 0?e.format:"RGB",o=e==null?void 0:e.norm,l,u;o===void 0||o.mean===void 0?l=[255,255,255,255]:typeof o.mean=="number"?l=[o.mean,o.mean,o.mean,o.mean]:(l=[o.mean[0],o.mean[1],o.mean[2],0],o.mean[3]!==void 0&&(l[3]=o.mean[3])),o===void 0||o.bias===void 0?u=[0,0,0,0]:typeof o.bias=="number"?u=[o.bias,o.bias,o.bias,o.bias]:(u=[o.bias[0],o.bias[1],o.bias[2],0],o.bias[3]!==void 0&&(u[3]=o.bias[3]));let h=s*i,f=0,p=h,g=h*2,_=-1;a==="RGBA"?(f=0,p=h,g=h*2,_=h*3):a==="RGB"?(f=0,p=h,g=h*2):a==="RBG"&&(f=0,g=h,p=h*2);for(let x=0;x<s;x++)for(let $=0;$<i;$++){let w=(t.data[f++]-u[0])*l[0],y=(t.data[p++]-u[1])*l[1],I=(t.data[g++]-u[2])*l[2],R=_===-1?255:(t.data[_++]-u[3])*l[3];r.fillStyle="rgba("+w+","+y+","+I+","+R+")",r.fillRect($,x,1,1)}if("toDataURL"in n)return n.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},OC=(t,e)=>{let n=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),r;if(n!=null){let i,s,a;(e==null?void 0:e.tensorLayout)!==void 0&&e.tensorLayout==="NHWC"?(i=t.dims[2],s=t.dims[1],a=t.dims[3]):(i=t.dims[3],s=t.dims[2],a=t.dims[1]);let o=e!==void 0&&e.format!==void 0?e.format:"RGB",l=e==null?void 0:e.norm,u,h;l===void 0||l.mean===void 0?u=[255,255,255,255]:typeof l.mean=="number"?u=[l.mean,l.mean,l.mean,l.mean]:(u=[l.mean[0],l.mean[1],l.mean[2],255],l.mean[3]!==void 0&&(u[3]=l.mean[3])),l===void 0||l.bias===void 0?h=[0,0,0,0]:typeof l.bias=="number"?h=[l.bias,l.bias,l.bias,l.bias]:(h=[l.bias[0],l.bias[1],l.bias[2],0],l.bias[3]!==void 0&&(h[3]=l.bias[3]));let f=s*i;if(e!==void 0&&(e.format!==void 0&&a===4&&e.format!=="RGBA"||a===3&&e.format!=="RGB"&&e.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let p=4,g=0,_=1,x=2,$=3,w=0,y=f,I=f*2,R=-1;o==="RGBA"?(w=0,y=f,I=f*2,R=f*3):o==="RGB"?(w=0,y=f,I=f*2):o==="RBG"&&(w=0,I=f,y=f*2),r=n.createImageData(i,s);for(let M=0;M<s*i;g+=p,_+=p,x+=p,$+=p,M++)r.data[g]=(t.data[w++]-h[0])*u[0],r.data[_]=(t.data[y++]-h[1])*u[1],r.data[x]=(t.data[I++]-h[2])*u[2],r.data[$]=R===-1?255:(t.data[R++]-h[3])*u[3]}else throw new Error("Can not access image data");return r}}),Vd,DC,MC,LC,zC,VC,kU=se(()=>{Vv(),Vd=(t,e)=>{if(t===void 0)throw new Error("Image buffer must be defined");if(e.height===void 0||e.width===void 0)throw new Error("Image height and width must be defined");if(e.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:n,width:r}=e,i=e.norm??{mean:255,bias:0},s,a;typeof i.mean=="number"?s=[i.mean,i.mean,i.mean,i.mean]:s=[i.mean[0],i.mean[1],i.mean[2],i.mean[3]??255],typeof i.bias=="number"?a=[i.bias,i.bias,i.bias,i.bias]:a=[i.bias[0],i.bias[1],i.bias[2],i.bias[3]??0];let o=e.format!==void 0?e.format:"RGBA",l=e.tensorFormat!==void 0&&e.tensorFormat!==void 0?e.tensorFormat:"RGB",u=n*r,h=l==="RGBA"?new Float32Array(u*4):new Float32Array(u*3),f=4,p=0,g=1,_=2,x=3,$=0,w=u,y=u*2,I=-1;o==="RGB"&&(f=3,p=0,g=1,_=2,x=-1),l==="RGBA"?I=u*3:l==="RBG"?($=0,y=u,w=u*2):l==="BGR"&&(y=0,w=u,$=u*2);for(let R=0;R<u;R++,p+=f,_+=f,g+=f,x+=f)h[$++]=(t[p]+a[0])/s[0],h[w++]=(t[g]+a[1])/s[1],h[y++]=(t[_]+a[2])/s[2],I!==-1&&x!==-1&&(h[I++]=(t[x]+a[3])/s[3]);return l==="RGBA"?new Nn("float32",h,[1,4,n,r]):new Nn("float32",h,[1,3,n,r])},DC=async(t,e)=>{let n=typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement,r=typeof ImageData<"u"&&t instanceof ImageData,i=typeof ImageBitmap<"u"&&t instanceof ImageBitmap,s=typeof t=="string",a,o=e??{},l=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},u=h=>typeof HTMLCanvasElement<"u"&&h instanceof HTMLCanvasElement||h instanceof OffscreenCanvas?h.getContext("2d"):null;if(n){let h=l();h.width=t.width,h.height=t.height;let f=u(h);if(f!=null){let p=t.height,g=t.width;if(e!==void 0&&e.resizedHeight!==void 0&&e.resizedWidth!==void 0&&(p=e.resizedHeight,g=e.resizedWidth),e!==void 0){if(o=e,e.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");o.tensorFormat="RGBA",o.height=p,o.width=g}else o.tensorFormat="RGBA",o.height=p,o.width=g;f.drawImage(t,0,0),a=f.getImageData(0,0,g,p).data}else throw new Error("Can not access image data")}else if(r){let h,f;if(e!==void 0&&e.resizedWidth!==void 0&&e.resizedHeight!==void 0?(h=e.resizedHeight,f=e.resizedWidth):(h=t.height,f=t.width),e!==void 0&&(o=e),o.format="RGBA",o.height=h,o.width=f,e!==void 0){let p=l();p.width=f,p.height=h;let g=u(p);if(g!=null)g.putImageData(t,0,0),a=g.getImageData(0,0,f,h).data;else throw new Error("Can not access image data")}else a=t.data}else if(i){if(e===void 0)throw new Error("Please provide image config with format for Imagebitmap");let h=l();h.width=t.width,h.height=t.height;let f=u(h);if(f!=null){let p=t.height,g=t.width;return f.drawImage(t,0,0,g,p),a=f.getImageData(0,0,g,p).data,o.height=p,o.width=g,Vd(a,o)}else throw new Error("Can not access image data")}else{if(s)return new Promise((h,f)=>{let p=l(),g=u(p);if(!t||!g)return f();let _=new Image;_.crossOrigin="Anonymous",_.src=t,_.onload=()=>{p.width=_.width,p.height=_.height,g.drawImage(_,0,0,p.width,p.height);let x=g.getImageData(0,0,p.width,p.height);o.height=p.height,o.width=p.width,h(Vd(x.data,o))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(a!==void 0)return Vd(a,o);throw new Error("Input data provided is not supported - aborted tensor creation")},MC=(t,e)=>{let{width:n,height:r,download:i,dispose:s}=e,a=[1,r,n,4];return new Nn({location:"texture",type:"float32",texture:t,dims:a,download:i,dispose:s})},LC=(t,e)=>{let{dataType:n,dims:r,download:i,dispose:s}=e;return new Nn({location:"gpu-buffer",type:n??"float32",gpuBuffer:t,dims:r,download:i,dispose:s})},zC=(t,e)=>{let{dataType:n,dims:r,download:i,dispose:s}=e;return new Nn({location:"ml-tensor",type:n??"float32",mlTensor:t,dims:r,download:i,dispose:s})},VC=(t,e,n)=>new Nn({location:"cpu-pinned",type:t,data:e,dims:n??[e.length]})}),na,gu,fm,jC,SU=se(()=>{na=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),gu=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),fm=!1,jC=()=>{if(!fm){fm=!0;let t=typeof BigInt64Array<"u"&&BigInt64Array.from,e=typeof BigUint64Array<"u"&&BigUint64Array.from,n=globalThis.Float16Array,r=typeof n<"u"&&n.from;t&&(na.set("int64",BigInt64Array),gu.set(BigInt64Array,"int64")),e&&(na.set("uint64",BigUint64Array),gu.set(BigUint64Array,"uint64")),r?(na.set("float16",n),gu.set(n,"float16")):na.set("float16",Uint16Array)}}}),UC,BC,CU=se(()=>{Vv(),UC=t=>{let e=1;for(let n=0;n<t.length;n++){let r=t[n];if(typeof r!="number"||!Number.isSafeInteger(r))throw new TypeError(`dims[${n}] must be an integer, got: ${r}`);if(r<0)throw new RangeError(`dims[${n}] must be a non-negative integer, got: ${r}`);e*=r}return e},BC=(t,e)=>{switch(t.location){case"cpu":return new Nn(t.type,t.data,e);case"cpu-pinned":return new Nn({location:"cpu-pinned",data:t.data,type:t.type,dims:e});case"texture":return new Nn({location:"texture",texture:t.texture,type:t.type,dims:e});case"gpu-buffer":return new Nn({location:"gpu-buffer",gpuBuffer:t.gpuBuffer,type:t.type,dims:e});case"ml-tensor":return new Nn({location:"ml-tensor",mlTensor:t.mlTensor,type:t.type,dims:e});default:throw new Error(`tensorReshape: tensor location ${t.location} is not supported`)}}}),Nn,Vv=se(()=>{$U(),kU(),SU(),CU(),Nn=class{constructor(t,e,n){jC();let r,i;if(typeof t=="object"&&"location"in t)switch(this.dataLocation=t.location,r=t.type,i=t.dims,t.location){case"cpu-pinned":{let a=na.get(r);if(!a)throw new TypeError(`unsupported type "${r}" to create tensor from pinned buffer`);if(!(t.data instanceof a))throw new TypeError(`buffer should be of type ${a.name}`);this.cpuData=t.data;break}case"texture":{if(r!=="float32")throw new TypeError(`unsupported type "${r}" to create tensor from texture`);this.gpuTextureData=t.texture,this.downloader=t.download,this.disposer=t.dispose;break}case"gpu-buffer":{if(r!=="float32"&&r!=="float16"&&r!=="int32"&&r!=="int64"&&r!=="uint32"&&r!=="uint8"&&r!=="bool"&&r!=="uint4"&&r!=="int4")throw new TypeError(`unsupported type "${r}" to create tensor from gpu buffer`);this.gpuBufferData=t.gpuBuffer,this.downloader=t.download,this.disposer=t.dispose;break}case"ml-tensor":{if(r!=="float32"&&r!=="float16"&&r!=="int32"&&r!=="int64"&&r!=="uint32"&&r!=="uint64"&&r!=="int8"&&r!=="uint8"&&r!=="bool"&&r!=="uint4"&&r!=="int4")throw new TypeError(`unsupported type "${r}" to create tensor from MLTensor`);this.mlTensorData=t.mlTensor,this.downloader=t.download,this.disposer=t.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let a,o;if(typeof t=="string")if(r=t,o=n,t==="string"){if(!Array.isArray(e))throw new TypeError("A string tensor's data must be a string array.");a=e}else{let l=na.get(t);if(l===void 0)throw new TypeError(`Unsupported tensor type: ${t}.`);if(Array.isArray(e)){if(t==="float16"&&l===Uint16Array||t==="uint4"||t==="int4")throw new TypeError(`Creating a ${t} tensor from number array is not supported. Please use ${l.name} as data.`);t==="uint64"||t==="int64"?a=l.from(e,BigInt):a=l.from(e)}else if(e instanceof l)a=e;else if(e instanceof Uint8ClampedArray)if(t==="uint8")a=Uint8Array.from(e);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(t==="float16"&&e instanceof Uint16Array&&l!==Uint16Array)a=new globalThis.Float16Array(e.buffer,e.byteOffset,e.length);else throw new TypeError(`A ${r} tensor's data must be type of ${l}`)}else if(o=e,Array.isArray(t)){if(t.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let l=typeof t[0];if(l==="string")r="string",a=t;else if(l==="boolean")r="bool",a=Uint8Array.from(t);else throw new TypeError(`Invalid element type of data array: ${l}.`)}else if(t instanceof Uint8ClampedArray)r="uint8",a=Uint8Array.from(t);else{let l=gu.get(t.constructor);if(l===void 0)throw new TypeError(`Unsupported type for tensor data: ${t.constructor}.`);r=l,a=t}if(o===void 0)o=[a.length];else if(!Array.isArray(o))throw new TypeError("A tensor's dims must be a number array");i=o,this.cpuData=a,this.dataLocation="cpu"}let s=UC(i);if(this.cpuData&&s!==this.cpuData.length&&!((r==="uint4"||r==="int4")&&Math.ceil(s/2)===this.cpuData.length))throw new Error(`Tensor's size(${s}) does not match data length(${this.cpuData.length}).`);this.type=r,this.dims=i,this.size=s}static async fromImage(t,e){return DC(t,e)}static fromTexture(t,e){return MC(t,e)}static fromGpuBuffer(t,e){return LC(t,e)}static fromMLTensor(t,e){return zC(t,e)}static fromPinnedBuffer(t,e,n){return VC(t,e,n)}toDataURL(t){return PC(this,t)}toImageData(t){return OC(this,t)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(t){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let e=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=e,t&&this.disposer&&(this.disposer(),this.disposer=void 0),e}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(t){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return BC(this,t)}}}),gr,FC=se(()=>{Vv(),gr=Nn}),mf,pm,Zr,Er,ha,fa,WC=se(()=>{NC(),mf=(t,e)=>{(typeof Vt.trace>"u"?!Vt.wasm.trace:!Vt.trace)||console.timeStamp(`${t}::ORT::${e}`)},pm=(t,e)=>{var i;let n=((i=new Error().stack)==null?void 0:i.split(/\r\n|\r|\n/g))||[],r=!1;for(let s=0;s<n.length;s++){if(r&&!n[s].includes("TRACE_FUNC")){let a=`FUNC_${t}::${n[s].trim().split(" ")[1]}`;e&&(a+=`::${e}`),mf("CPU",a);return}n[s].includes("TRACE_FUNC")&&(r=!0)}},Zr=t=>{(typeof Vt.trace>"u"?!Vt.wasm.trace:!Vt.trace)||pm("BEGIN",t)},Er=t=>{(typeof Vt.trace>"u"?!Vt.wasm.trace:!Vt.trace)||pm("END",t)},ha=t=>{(typeof Vt.trace>"u"?!Vt.wasm.trace:!Vt.trace)||console.time(`ORT::${t}`)},fa=t=>{(typeof Vt.trace>"u"?!Vt.wasm.trace:!Vt.trace)||console.timeEnd(`ORT::${t}`)}}),qC,AU=se(()=>{AC(),FC(),WC(),qC=class HC{constructor(e){this.handler=e}async run(e,n,r){Zr(),ha("InferenceSession.run");let i={},s={};if(typeof e!="object"||e===null||e instanceof gr||Array.isArray(e))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let a=!0;if(typeof n=="object"){if(n===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(n instanceof gr)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(n)){if(n.length===0)throw new TypeError("'fetches' cannot be an empty array.");a=!1;for(let u of n){if(typeof u!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(u)===-1)throw new RangeError(`'fetches' contains invalid output name: ${u}.`);i[u]=null}if(typeof r=="object"&&r!==null)s=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else{let u=!1,h=Object.getOwnPropertyNames(n);for(let f of this.outputNames)if(h.indexOf(f)!==-1){let p=n[f];(p===null||p instanceof gr)&&(u=!0,a=!1,i[f]=p)}if(u){if(typeof r=="object"&&r!==null)s=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else s=n}}else if(typeof n<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let u of this.inputNames)if(typeof e[u]>"u")throw new Error(`input '${u}' is missing in 'feeds'.`);if(a)for(let u of this.outputNames)i[u]=null;let o=await this.handler.run(e,i,s),l={};for(let u in o)if(Object.hasOwnProperty.call(o,u)){let h=o[u];h instanceof gr?l[u]=h:l[u]=new gr(h.type,h.data,h.dims)}return fa("InferenceSession.run"),Er(),l}async release(){return this.handler.dispose()}static async create(e,n,r,i){Zr(),ha("InferenceSession.create");let s,a={};if(typeof e=="string"){if(s=e,typeof n=="object"&&n!==null)a=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof Uint8Array){if(s=e,typeof n=="object"&&n!==null)a=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer){let h=e,f=0,p=e.byteLength;if(typeof n=="object"&&n!==null)a=n;else if(typeof n=="number"){if(f=n,!Number.isSafeInteger(f))throw new RangeError("'byteOffset' must be an integer.");if(f<0||f>=h.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${h.byteLength}).`);if(p=e.byteLength-f,typeof r=="number"){if(p=r,!Number.isSafeInteger(p))throw new RangeError("'byteLength' must be an integer.");if(p<=0||f+p>h.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${h.byteLength-f}].`);if(typeof i=="object"&&i!==null)a=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(typeof r<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof n<"u")throw new TypeError("'options' must be an object.");s=new Uint8Array(h,f,p)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[o,l]=await CC(a),u=await o.createInferenceSessionHandler(s,l);return fa("InferenceSession.create"),Er(),new HC(u)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),jv,RU=se(()=>{AU(),jv=qC}),NU=se(()=>{}),PU=se(()=>{}),OU=se(()=>{}),DU=se(()=>{}),MU={};ll(MU,{InferenceSession:()=>jv,TRACE:()=>mf,TRACE_EVENT_BEGIN:()=>ha,TRACE_EVENT_END:()=>fa,TRACE_FUNC_BEGIN:()=>Zr,TRACE_FUNC_END:()=>Er,Tensor:()=>gr,env:()=>it,registerBackend:()=>wo});var Jn=se(()=>{EU(),IU(),RU(),FC(),NU(),PU(),WC(),OU(),DU()}),Uv=se(()=>{}),GC={};ll(GC,{default:()=>KC});var mm,gm,KC,LU=se(()=>{var t;Z3(),La(),Bv(),mm="ort-wasm-proxy-worker",gm=((t=globalThis.self)==null?void 0:t.name)===mm,gm&&(self.onmessage=e=>{let{type:n,in:r}=e.data;try{switch(n){case"init-wasm":Fv(r.wasm).then(()=>{a0(r).then(()=>{postMessage({type:n})},i=>{postMessage({type:n,err:i})})},i=>{postMessage({type:n,err:i})});break;case"init-ep":{let{epName:i,env:s}=r;o0(s,i).then(()=>{postMessage({type:n})},a=>{postMessage({type:n,err:a})});break}case"copy-from":{let{buffer:i}=r,s=xf(i);postMessage({type:n,out:s});break}case"create":{let{model:i,options:s}=r;l0(i,s).then(a=>{postMessage({type:n,out:a})},a=>{postMessage({type:n,err:a})});break}case"release":u0(r),postMessage({type:n});break;case"run":{let{sessionId:i,inputIndices:s,inputs:a,outputIndices:o,options:l}=r;c0(i,s,a,o,new Array(o.length).fill(null),l).then(u=>{u.some(h=>h[3]!=="cpu")?postMessage({type:n,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:n,out:u},h0([...a,...u]))},u=>{postMessage({type:n,err:u})});break}case"end-profiling":d0(r),postMessage({type:n});break;default:}}catch(i){postMessage({type:n,err:i})}}),KC=gm?null:e=>new Worker(e??An,{type:"module",name:mm})}),QC={};ll(QC,{default:()=>YC});var ym,YC,Ub,zU=se(()=>{var t,e;ym=async function(n={}){var D0;var r,i,s=n,a=new Promise((d,m)=>{r=d,i=m}),o=typeof window=="object",l=typeof WorkerGlobalScope<"u",u=l&&((D0=self.name)==null?void 0:D0.startsWith("em-pthread"));s.mountExternalData=(d,m)=>{d.startsWith("./")&&(d=d.substring(2)),(s.Fb||(s.Fb=new Map)).set(d,m)},s.unmountExternalData=()=>{delete s.Fb};var h=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,qc:!0}).buffer.constructor;let f=d=>async(...m)=>{var b;try{if(s.Gb)throw Error("Session already started");let T=s.Gb={ec:m[0],errors:[]},N=await d(...m);if(s.Gb!==T)throw Error("Session mismatch");(b=s.Kb)==null||b.flush();let V=T.errors;if(0<V.length){let W=await Promise.all(V);if(W=W.filter(J=>J),0<W.length)throw Error(W.join(`
`))}return N}finally{s.Gb=null}};s.jsepInit=(d,m)=>{if(d==="webgpu"){[s.Kb,s.Vb,s.Zb,s.Lb,s.Yb,s.Ab,s.$b,s.bc,s.Wb,s.Xb,s.ac]=m;let b=s.Kb;s.jsepRegisterBuffer=(T,N,V,W)=>b.registerBuffer(T,N,V,W),s.jsepGetBuffer=T=>b.getBuffer(T),s.jsepCreateDownloader=(T,N,V)=>b.createDownloader(T,N,V),s.jsepOnCreateSession=T=>{b.onCreateSession(T)},s.jsepOnReleaseSession=T=>{b.onReleaseSession(T)},s.jsepOnRunStart=T=>b.onRunStart(T),s.cc=(T,N)=>{b.upload(T,N)}}else if(d==="webnn"){let b=m[0];[s.oc,s.Ob,s.webnnEnsureTensor,s.Pb,s.webnnDownloadTensor,s.nc,s.webnnEnableTraceEvent]=m.slice(1),s.webnnReleaseTensorId=s.Ob,s.webnnUploadTensor=s.Pb,s.webnnRegisterMLContext=s.nc,s.webnnOnRunStart=T=>b.onRunStart(T),s.webnnOnRunEnd=b.onRunEnd.bind(b),s.webnnOnReleaseSession=T=>{b.onReleaseSession(T)},s.webnnCreateMLTensorDownloader=(T,N)=>b.createMLTensorDownloader(T,N),s.webnnRegisterMLTensor=(T,N,V,W)=>b.registerMLTensor(T,N,V,W),s.webnnCreateMLContext=T=>b.createMLContext(T),s.webnnRegisterMLConstant=(T,N,V,W,J,re)=>b.registerMLConstant(T,N,V,W,J,s.Fb,re),s.webnnRegisterGraphInput=b.registerGraphInput.bind(b),s.webnnIsGraphInput=b.isGraphInput.bind(b),s.webnnRegisterGraphOutput=b.registerGraphOutput.bind(b),s.webnnIsGraphOutput=b.isGraphOutput.bind(b),s.webnnCreateTemporaryTensor=b.createTemporaryTensor.bind(b),s.webnnIsGraphInputOutputTypeSupported=b.isGraphInputOutputTypeSupported.bind(b)}};let p=()=>{let d=(m,b,T)=>(...N)=>{let V=yn,W=b==null?void 0:b();N=m(...N);let J=b==null?void 0:b();return W!==J&&(m=J,T(W),b=T=null),yn!=V?new Promise((re,oe)=>{Bs={resolve:re,reject:oe}}):N};(()=>{for(let m of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])s[m]=d(s[m],()=>s[m],b=>s[m]=b)})(),f!==void 0&&(s._OrtRun=f(s._OrtRun),s._OrtRunWithBinding=f(s._OrtRunWithBinding)),p=void 0};s.asyncInit=()=>{p==null||p()};var g,_,x=(d,m)=>{throw m},$=import.meta.url,w="";if(o||l){try{w=new URL(".",$).href}catch{}l&&(_=d=>{var m=new XMLHttpRequest;return m.open("GET",d,!1),m.responseType="arraybuffer",m.send(null),new Uint8Array(m.response)}),g=async d=>{if(G(d))return new Promise((b,T)=>{var N=new XMLHttpRequest;N.open("GET",d,!0),N.responseType="arraybuffer",N.onload=()=>{N.status==200||N.status==0&&N.response?b(N.response):T(N.status)},N.onerror=T,N.send(null)});var m=await fetch(d,{credentials:"same-origin"});if(m.ok)return m.arrayBuffer();throw Error(m.status+" : "+m.url)}}var y,I,R,M,j,C,k,P,A,D,z,O,ce,de,ue,pe=console.log.bind(console),K=console.error.bind(console),B=pe,F=K,U=!1,G=d=>d.startsWith("file://");function q(){return I.buffer!=j.buffer&&je(),j}function Y(){return I.buffer!=j.buffer&&je(),C}function ae(){return I.buffer!=j.buffer&&je(),k}function Ee(){return I.buffer!=j.buffer&&je(),P}function Q(){return I.buffer!=j.buffer&&je(),A}function be(){return I.buffer!=j.buffer&&je(),D}function rt(){return I.buffer!=j.buffer&&je(),z}function et(){return I.buffer!=j.buffer&&je(),de}if(u){let d=function(m){try{var b=m.data,T=b.Db;if(T==="load"){let N=[];self.onmessage=V=>N.push(V),self.startWorker=()=>{postMessage({Db:"loaded"});for(let V of N)d(V);self.onmessage=d};for(let V of b.Sb)s[V]&&!s[V].proxy||(s[V]=(...W)=>{postMessage({Db:"callHandler",Rb:V,args:W})},V=="print"&&(B=s[V]),V=="printErr"&&(F=s[V]));I=b.kc,je(),ue(b.lc)}else if(T==="run"){Nc(b.Bb),wp(b.Bb,0,0,1,0,0),Ua(),$l(b.Bb),vt||(E0(),vt=!0);try{Fa(b.hc,b.Jb)}catch(N){if(N!="unwind")throw N}}else b.target!=="setimmediate"&&(T==="checkMailbox"?vt&&Rr():T&&(F(`worker: received unknown command ${T}`),F(b)))}catch(N){throw T0(),N}};var vt=!1;self.onunhandledrejection=m=>{throw m.reason||m},self.onmessage=d}function je(){var d=I.buffer;s.HEAP8=j=new Int8Array(d),k=new Int16Array(d),s.HEAPU8=C=new Uint8Array(d),P=new Uint16Array(d),s.HEAP32=A=new Int32Array(d),s.HEAPU32=D=new Uint32Array(d),z=new Float32Array(d),de=new Float64Array(d),O=new BigInt64Array(d),ce=new BigUint64Array(d)}function Xe(){u?startWorker(s):ee.Da()}var Yt,ni=0,Xn=null;function Va(){if(--ni==0&&Xn){var d=Xn;Xn=null,d()}}function Zn(d){throw F(d="Aborted("+d+")"),U=!0,d=new WebAssembly.RuntimeError(d+". Build with -sASSERTIONS for more info."),i(d),d}function At(){return{a:{L:gN,Aa:mN,b:Ps,$:Lt,A:Oc,pa:Dc,X:ri,Z:Mc,qa:Lc,na:Os,ga:ml,ma:gl,J:Wa,Y:Pi,V:zc,oa:er,W:yl,va:vl,E:Vc,Q:Ms,O:El,D:Uc,v:Bc,s:lp,P:Ls,z:Fc,R:cp,ja:dp,T:si,aa:Wc,M:qc,F:Hc,ia:$l,sa:Gc,r:hp,Ca:fp,w:pp,o:Jc,m:Pr,c:bl,Ba:Zc,n:Ws,j:Qa,u:nd,p:Ya,f:mp,t:rd,l:qs,e:id,k:sd,h:Sl,g:Cl,d:ad,da:Ja,ea:od,fa:ld,ba:Nl,ca:Pl,N:Ol,xa:ud,ua:c,i:L,C:H,G:Z,ta:Li,x:he,ra:Oe,U:wt,q:un,y:Ye,K:Tt,S:Bn,za:Xa,ya:Dl,ka:m0,la:g0,_:Rs,B:y0,I:_0,ha:v0,H:w0,a:I,wa:ja}}}class Rt{constructor(m){M0(this,"name","ExitStatus");this.message=`Program terminated with exit(${m})`,this.status=m}}var As=d=>{d.terminate(),d.onmessage=()=>{}},ul=[],cl=d=>{Sr.length==0&&(Ar(),Ba(Sr[0]));var m=Sr.pop();if(!m)return 6;Ns.push(m),Cr[d.Bb]=m,m.Bb=d.Bb;var b={Db:"run",hc:d.fc,Jb:d.Jb,Bb:d.Bb};return m.postMessage(b,d.Nb),0},kr=0,Ge=(d,m,...b)=>{for(var T=2*b.length,N=Ep(),V=xp(8*T),W=V>>>3,J=0;J<b.length;J++){var re=b[J];typeof re=="bigint"?(O[W+2*J]=1n,O[W+2*J+1]=re):(O[W+2*J]=0n,et()[W+2*J+1>>>0]=re)}return d=I0(d,0,T,V,m),hd(N),d};function ja(d){if(u)return Ge(0,1,d);if(M=d,!(0<kr)){for(var m of Ns)As(m);for(m of Sr)As(m);Sr=[],Ns=[],Cr={},U=!0}x(0,new Rt(d))}function dl(d){if(u)return Ge(1,0,d);Rs(d)}var Rs=d=>{if(M=d,u)throw dl(d),"unwind";ja(d)},Sr=[],Ns=[],hl=[],Cr={},Ri=d=>{var m=d.Bb;delete Cr[m],Sr.push(d),Ns.splice(Ns.indexOf(d),1),d.Bb=0,$0(m)};function Ua(){hl.forEach(d=>d())}var Ba=d=>new Promise(m=>{d.onmessage=N=>{var V=(N=N.data).Db;if(N.Hb&&N.Hb!=vp()){var W=Cr[N.Hb];W?W.postMessage(N,N.Nb):F(`Internal error! Worker sent a message "${V}" to target pthread ${N.Hb}, but that thread no longer exists!`)}else V==="checkMailbox"?Rr():V==="spawnThread"?cl(N):V==="cleanupThread"?Ri(Cr[N.ic]):V==="loaded"?(d.loaded=!0,m(d)):N.target==="setimmediate"?d.postMessage(N):V==="callHandler"?s[N.Rb](...N.args):V&&F(`worker sent an unknown command ${V}`)},d.onerror=N=>{throw F(`worker sent an error! ${N.filename}:${N.lineno}: ${N.message}`),N};var b,T=[];for(b of[])s.propertyIsEnumerable(b)&&T.push(b);d.postMessage({Db:"load",Sb:T,kc:I,lc:R})});function Ar(){var d=new Worker((()=>{let m=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new m("ort.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});Sr.push(d)}var Nc=d=>{je();var m=be()[d+52>>>2>>>0];d=be()[d+56>>>2>>>0],C0(m,m-d),hd(m)},Fa=(d,m)=>{kr=0,d=A0(d,m),0<kr?M=d:bp(d)};class Pc{constructor(m){this.Ib=m-24}}function Ps(d,m,b){var T=new Pc(d>>>=0);throw m>>>=0,b>>>=0,be()[T.Ib+16>>>2>>>0]=0,be()[T.Ib+4>>>2>>>0]=m,be()[T.Ib+8>>>2>>>0]=b,d}function fl(d,m,b,T){return u?Ge(2,1,d,m,b,T):Lt(d,m,b,T)}function Lt(d,m,b,T){if(d>>>=0,b>>>=0,T>>>=0,h===void 0)return 6;var N=[];return u&&N.length===0?fl(d,m>>>=0,b,T):(d={fc:b,Bb:d,Jb:T,Nb:N},u?(d.Db="spawnThread",postMessage(d,N),0):cl(d))}var pl=typeof TextDecoder<"u"?new TextDecoder:void 0,Ni=(d,m=0,b=NaN)=>{var T=(m>>>=0)+b;for(b=m;d[b]&&!(b>=T);)++b;if(16<b-m&&d.buffer&&pl)return pl.decode(d.buffer instanceof ArrayBuffer?d.subarray(m,b):d.slice(m,b));for(T="";m<b;){var N=d[m++];if(128&N){var V=63&d[m++];if((224&N)==192)T+=String.fromCharCode((31&N)<<6|V);else{var W=63&d[m++];65536>(N=(240&N)==224?(15&N)<<12|V<<6|W:(7&N)<<18|V<<12|W<<6|63&d[m++])?T+=String.fromCharCode(N):(N-=65536,T+=String.fromCharCode(55296|N>>10,56320|1023&N))}}else T+=String.fromCharCode(N)}return T},tt=(d,m)=>(d>>>=0)?Ni(Y(),d,m):"";function Oc(d,m,b){return u?Ge(3,1,d,m,b):0}function Dc(d,m){if(u)return Ge(4,1,d,m)}function ri(d,m){if(u)return Ge(5,1,d,m)}function Mc(d,m,b){if(u)return Ge(6,1,d,m,b)}function Lc(d,m,b){return u?Ge(7,1,d,m,b):0}function Os(d,m){if(u)return Ge(8,1,d,m)}function ml(d,m,b){if(u)return Ge(9,1,d,m,b)}function gl(d,m,b,T){if(u)return Ge(10,1,d,m,b,T)}function Wa(d,m,b,T){if(u)return Ge(11,1,d,m,b,T)}function Pi(d,m,b,T){if(u)return Ge(12,1,d,m,b,T)}function zc(d){if(u)return Ge(13,1,d)}function er(d,m){if(u)return Ge(14,1,d,m)}function yl(d,m,b){if(u)return Ge(15,1,d,m,b)}var _l,vl=()=>Zn(""),mn=d=>{for(var m="";Y()[d>>>0];)m+=_l[Y()[d++>>>0]];return m},qa={},wl={},ii=s.BindingError=class extends Error{constructor(d){super(d),this.name="BindingError"}};function tr(d,m,b={}){return function(T,N,V={}){var W=N.name;if(!T)throw new ii(`type "${W}" must have a positive integer typeid pointer`);if(wl.hasOwnProperty(T)){if(V.Tb)return;throw new ii(`Cannot register type '${W}' twice`)}wl[T]=N,qa.hasOwnProperty(T)&&(N=qa[T],delete qa[T],N.forEach(J=>J()))}(d,m,b)}var Ds=(d,m,b)=>{switch(m){case 1:return b?T=>q()[T>>>0]:T=>Y()[T>>>0];case 2:return b?T=>ae()[T>>>1>>>0]:T=>Ee()[T>>>1>>>0];case 4:return b?T=>Q()[T>>>2>>>0]:T=>be()[T>>>2>>>0];case 8:return b?T=>O[T>>>3]:T=>ce[T>>>3];default:throw new TypeError(`invalid integer width (${m}): ${d}`)}};function Vc(d,m,b){b>>>=0,tr(d>>>=0,{name:m=mn(m>>>0),fromWireType:T=>T,toWireType:function(T,N){if(typeof N!="bigint"&&typeof N!="number")throw N=N===null?"null":(T=typeof N)=="object"||T==="array"||T==="function"?N.toString():""+N,new TypeError(`Cannot convert "${N}" to ${this.name}`);return typeof N=="number"&&(N=BigInt(N)),N},Cb:Un,readValueFromPointer:Ds(m,b,m.indexOf("u")==-1),Eb:null})}var Un=8;function Ms(d,m,b,T){tr(d>>>=0,{name:m=mn(m>>>0),fromWireType:function(N){return!!N},toWireType:function(N,V){return V?b:T},Cb:Un,readValueFromPointer:function(N){return this.fromWireType(Y()[N>>>0])},Eb:null})}var nr=[],kn=[];function bl(d){9<(d>>>=0)&&--kn[d+1]==0&&(kn[d]=void 0,nr.push(d))}var zt=d=>{if(!d)throw new ii(`Cannot use deleted val. handle = ${d}`);return kn[d]},ln=d=>{switch(d){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let m=nr.pop()||kn.length;return kn[m]=d,kn[m+1]=1,m}};function Ha(d){return this.fromWireType(be()[d>>>2>>>0])}var xl={name:"emscripten::val",fromWireType:d=>{var m=zt(d);return bl(d),m},toWireType:(d,m)=>ln(m),Cb:Un,readValueFromPointer:Ha,Eb:null};function El(d){return tr(d>>>0,xl)}var jc=(d,m)=>{switch(m){case 4:return function(b){return this.fromWireType(rt()[b>>>2>>>0])};case 8:return function(b){return this.fromWireType(et()[b>>>3>>>0])};default:throw new TypeError(`invalid float width (${m}): ${d}`)}};function Uc(d,m,b){b>>>=0,tr(d>>>=0,{name:m=mn(m>>>0),fromWireType:T=>T,toWireType:(T,N)=>N,Cb:Un,readValueFromPointer:jc(m,b),Eb:null})}function Bc(d,m,b,T,N){if(d>>>=0,b>>>=0,m=mn(m>>>0),N===-1&&(N=4294967295),N=J=>J,T===0){var V=32-8*b;N=J=>J<<V>>>V}var W=m.includes("unsigned")?function(J,re){return re>>>0}:function(J,re){return re};tr(d,{name:m,fromWireType:N,toWireType:W,Cb:Un,readValueFromPointer:Ds(m,b,T!==0),Eb:null})}function lp(d,m,b){function T(V){var W=be()[V>>>2>>>0];return V=be()[V+4>>>2>>>0],new N(q().buffer,V,W)}var N=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][m];tr(d>>>=0,{name:b=mn(b>>>0),fromWireType:T,Cb:Un,readValueFromPointer:T},{Tb:!0})}var Jt=(d,m,b)=>{var T=Y();if(m>>>=0,0<b){var N=m;b=m+b-1;for(var V=0;V<d.length;++V){var W=d.charCodeAt(V);if(55296<=W&&57343>=W&&(W=65536+((1023&W)<<10)|1023&d.charCodeAt(++V)),127>=W){if(m>=b)break;T[m++>>>0]=W}else{if(2047>=W){if(m+1>=b)break;T[m++>>>0]=192|W>>6}else{if(65535>=W){if(m+2>=b)break;T[m++>>>0]=224|W>>12}else{if(m+3>=b)break;T[m++>>>0]=240|W>>18,T[m++>>>0]=128|W>>12&63}T[m++>>>0]=128|W>>6&63}T[m++>>>0]=128|63&W}}T[m>>>0]=0,d=m-N}else d=0;return d},gn=d=>{for(var m=0,b=0;b<d.length;++b){var T=d.charCodeAt(b);127>=T?m++:2047>=T?m+=2:55296<=T&&57343>=T?(m+=4,++b):m+=3}return m};function Ls(d,m){tr(d>>>=0,{name:m=mn(m>>>0),fromWireType:function(b){for(var T,N=be()[b>>>2>>>0],V=b+4,W=V,J=0;J<=N;++J){var re=V+J;J!=N&&Y()[re>>>0]!=0||(W=tt(W,re-W),T===void 0?T=W:(T+="\0",T+=W),W=re+1)}return oi(b),T},toWireType:function(b,T){T instanceof ArrayBuffer&&(T=new Uint8Array(T));var N=typeof T=="string";if(!(N||ArrayBuffer.isView(T)&&T.BYTES_PER_ELEMENT==1))throw new ii("Cannot pass non-string to std::string");var V=N?gn(T):T.length,W=dd(4+V+1),J=W+4;return be()[W>>>2>>>0]=V,N?Jt(T,J,V+1):Y().set(T,J>>>0),b!==null&&b.push(oi,W),W},Cb:Un,readValueFromPointer:Ha,Eb(b){oi(b)}})}var Oi=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Tl=(d,m)=>{for(var b=d>>1,T=b+m/2;!(b>=T)&&Ee()[b>>>0];)++b;if(32<(b<<=1)-d&&Oi)return Oi.decode(Y().slice(d,b));for(b="",T=0;!(T>=m/2);++T){var N=ae()[d+2*T>>>1>>>0];if(N==0)break;b+=String.fromCharCode(N)}return b},nt=(d,m,b)=>{if(b??(b=2147483647),2>b)return 0;var T=m;b=(b-=2)<2*d.length?b/2:d.length;for(var N=0;N<b;++N){var V=d.charCodeAt(N);ae()[m>>>1>>>0]=V,m+=2}return ae()[m>>>1>>>0]=0,m-T},Ga=d=>2*d.length,zs=(d,m)=>{for(var b=0,T="";!(b>=m/4);){var N=Q()[d+4*b>>>2>>>0];if(N==0)break;++b,65536<=N?(N-=65536,T+=String.fromCharCode(55296|N>>10,56320|1023&N)):T+=String.fromCharCode(N)}return T},Vs=(d,m,b)=>{if(m>>>=0,b??(b=2147483647),4>b)return 0;var T=m;b=T+b-4;for(var N=0;N<d.length;++N){var V=d.charCodeAt(N);if(55296<=V&&57343>=V&&(V=65536+((1023&V)<<10)|1023&d.charCodeAt(++N)),Q()[m>>>2>>>0]=V,(m+=4)+4>b)break}return Q()[m>>>2>>>0]=0,m-T},up=d=>{for(var m=0,b=0;b<d.length;++b){var T=d.charCodeAt(b);55296<=T&&57343>=T&&++b,m+=4}return m};function Fc(d,m,b){if(d>>>=0,m>>>=0,b=mn(b>>>=0),m===2)var T=Tl,N=nt,V=Ga,W=J=>Ee()[J>>>1>>>0];else m===4&&(T=zs,N=Vs,V=up,W=J=>be()[J>>>2>>>0]);tr(d,{name:b,fromWireType:J=>{for(var re,oe=be()[J>>>2>>>0],ge=J+4,Ie=0;Ie<=oe;++Ie){var Pe=J+4+Ie*m;Ie!=oe&&W(Pe)!=0||(ge=T(ge,Pe-ge),re===void 0?re=ge:(re+="\0",re+=ge),ge=Pe+m)}return oi(J),re},toWireType:(J,re)=>{if(typeof re!="string")throw new ii(`Cannot pass non-string to C++ string type ${b}`);var oe=V(re),ge=dd(4+oe+m);return be()[ge>>>2>>>0]=oe/m,N(re,ge+4,oe+m),J!==null&&J.push(oi,ge),ge},Cb:Un,readValueFromPointer:Ha,Eb(J){oi(J)}})}function cp(d,m){tr(d>>>=0,{Ub:!0,name:m=mn(m>>>0),Cb:0,fromWireType:()=>{},toWireType:()=>{}})}function dp(d){wp(d>>>0,!l,1,!o,131072,!1),Ua()}var Il=d=>{if(!U)try{if(d(),!(0<kr))try{u?bp(M):Rs(M)}catch(m){m instanceof Rt||m=="unwind"||x(0,m)}}catch(m){m instanceof Rt||m=="unwind"||x(0,m)}};function $l(d){d>>>=0,typeof Atomics.jc=="function"&&(Atomics.jc(Q(),d>>>2,d).value.then(Rr),d+=128,Atomics.store(Q(),d>>>2,1))}var Rr=()=>{var d=vp();d&&($l(d),Il(S0))};function si(d,m){(d>>>=0)==m>>>0?setTimeout(Rr):u?postMessage({Hb:d,Db:"checkMailbox"}):(d=Cr[d])&&d.postMessage({Db:"checkMailbox"})}var Ka=[];function Wc(d,m,b,T,N){for(m>>>=0,T/=2,Ka.length=T,b=N>>>0>>>3,N=0;N<T;N++)Ka[N]=O[b+2*N]?O[b+2*N+1]:et()[b+2*N+1>>>0];return(m?_p[m]:pN[d])(...Ka)}var qc=()=>{kr=0};function Hc(d){d>>>=0,u?postMessage({Db:"cleanupThread",ic:d}):Ri(Cr[d])}function Gc(d){}var rr=(d,m)=>{var b=wl[d];if(b===void 0)throw d=x0(d),b=mn(d),oi(d),new ii(`${m} has unknown type ${b}`);return b},Kc=(d,m,b)=>{var T=[];return d=d.toWireType(T,b),T.length&&(be()[m>>>2>>>0]=ln(T)),d};function hp(d,m,b){return m>>>=0,b>>>=0,d=zt(d>>>0),m=rr(m,"emval::as"),Kc(m,b,d)}function fp(d,m){return m>>>=0,d=zt(d>>>0),(m=rr(m,"emval::as")).toWireType(null,d)}var Sn=d=>{try{d()}catch(m){Zn(m)}},Nr=0,yn=null,js=0,Us=[],Di={},Mi={},Qc=0,Bs=null,ct=[];function Yc(d){return function(m){if(!U){if(Nr===0){var b=!1,T=!1;m((N=0)=>{if(!U&&(js=N,b=!0,T)){Nr=2,Sn(()=>P0(yn)),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.resume(),N=!1;try{var V=function(){var re=Q()[yn+8>>>2>>>0];return re=ee[Mi[re]],--kr,re()}()}catch(re){V=re,N=!0}var W=!1;if(!yn){var J=Bs;J&&(Bs=null,(N?J.reject:J.resolve)(V),W=!0)}if(N&&!W)throw V}}),T=!0,b||(Nr=1,yn=function(){var N=dd(65548),V=N+12;be()[N>>>2>>>0]=V,be()[N+4>>>2>>>0]=V+65536,V=Us[0];var W=Di[V];return W===void 0&&(W=Qc++,Di[V]=W,Mi[W]=V),V=W,Q()[N+8>>>2>>>0]=V,N}(),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.pause(),Sn(()=>R0(yn)))}else Nr===2?(Nr=0,Sn(O0),oi(yn),yn=null,ct.forEach(Il)):Zn(`invalid state: ${Nr}`);return js}}(m=>{d().then(m)})}function pp(d){return d>>>=0,Yc(async()=>{var m=await zt(d);return ln(m)})}var Fs=[];function Jc(d,m,b,T){return b>>>=0,T>>>=0,(d=Fs[d>>>0])(null,m=zt(m>>>0),b,T)}var Xc={},ai=d=>{var m=Xc[d];return m===void 0?mn(d):m};function Pr(d,m,b,T,N){return b>>>=0,T>>>=0,N>>>=0,(d=Fs[d>>>0])(m=zt(m>>>0),m[b=ai(b)],T,N)}function Zc(d,m){return m>>>=0,(d=zt(d>>>0))==zt(m)}var ed=()=>typeof globalThis=="object"?globalThis:Function("return this")();function Ws(d){return(d>>>=0)==0?ln(ed()):(d=ai(d),ln(ed()[d]))}var td=d=>{var m=Fs.length;return Fs.push(d),m},kl=(d,m)=>{for(var b=Array(d),T=0;T<d;++T)b[T]=rr(be()[m+4*T>>>2>>>0],`parameter ${T}`);return b};function Qa(d,m,b){var T=(m=kl(d,m>>>0)).shift();d--;var N=`return function (obj, func, destructorsRef, args) {
`,V=0,W=[];b===0&&W.push("obj");for(var J=["retType"],re=[T],oe=0;oe<d;++oe)W.push(`arg${oe}`),J.push(`argType${oe}`),re.push(m[oe]),N+=`  var arg${oe} = argType${oe}.readValueFromPointer(args${V?"+"+V:""});
`,V+=m[oe].Cb;return N+=`  var rv = ${b===1?"new func":"func.call"}(${W.join(", ")});
`,T.Ub||(J.push("emval_returnValue"),re.push(Kc),N+=`  return emval_returnValue(retType, destructorsRef, rv);
`),d=new Function(...J,N+`};
`)(...re),b=`methodCaller<(${m.map(ge=>ge.name).join(", ")}) => ${T.name}>`,td(Object.defineProperty(d,"name",{value:b}))}function nd(d){return d=ai(d>>>0),ln(s[d])}function Ya(d,m){return m>>>=0,d=zt(d>>>0),m=zt(m),ln(d[m])}function mp(d){9<(d>>>=0)&&(kn[d+1]+=1)}function rd(){return ln([])}function qs(d){d=zt(d>>>0);for(var m=Array(d.length),b=0;b<d.length;b++)m[b]=d[b];return ln(m)}function id(d){return ln(ai(d>>>0))}function sd(){return ln({})}function Sl(d){for(var m=zt(d>>>=0);m.length;){var b=m.pop();m.pop()(b)}bl(d)}function Cl(d,m,b){m>>>=0,b>>>=0,d=zt(d>>>0),m=zt(m),b=zt(b),d[m]=b}function ad(d,m){return m>>>=0,d=(d=rr(d>>>0,"_emval_take_value")).readValueFromPointer(m),ln(d)}function Ja(d,m){d=-9007199254740992>d||9007199254740992<d?NaN:Number(d),m>>>=0,d=new Date(1e3*d),Q()[m>>>2>>>0]=d.getUTCSeconds(),Q()[m+4>>>2>>>0]=d.getUTCMinutes(),Q()[m+8>>>2>>>0]=d.getUTCHours(),Q()[m+12>>>2>>>0]=d.getUTCDate(),Q()[m+16>>>2>>>0]=d.getUTCMonth(),Q()[m+20>>>2>>>0]=d.getUTCFullYear()-1900,Q()[m+24>>>2>>>0]=d.getUTCDay(),d=(d.getTime()-Date.UTC(d.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,Q()[m+28>>>2>>>0]=d}var Al=d=>d%4==0&&(d%100!=0||d%400==0),Rl=[0,31,60,91,121,152,182,213,244,274,305,335],Or=[0,31,59,90,120,151,181,212,243,273,304,334];function od(d,m){d=-9007199254740992>d||9007199254740992<d?NaN:Number(d),m>>>=0,d=new Date(1e3*d),Q()[m>>>2>>>0]=d.getSeconds(),Q()[m+4>>>2>>>0]=d.getMinutes(),Q()[m+8>>>2>>>0]=d.getHours(),Q()[m+12>>>2>>>0]=d.getDate(),Q()[m+16>>>2>>>0]=d.getMonth(),Q()[m+20>>>2>>>0]=d.getFullYear()-1900,Q()[m+24>>>2>>>0]=d.getDay();var b=(Al(d.getFullYear())?Rl:Or)[d.getMonth()]+d.getDate()-1|0;Q()[m+28>>>2>>>0]=b,Q()[m+36>>>2>>>0]=-60*d.getTimezoneOffset(),b=new Date(d.getFullYear(),6,1).getTimezoneOffset();var T=new Date(d.getFullYear(),0,1).getTimezoneOffset();d=0|(b!=T&&d.getTimezoneOffset()==Math.min(T,b)),Q()[m+32>>>2>>>0]=d}function ld(d){d>>>=0;var m=new Date(Q()[d+20>>>2>>>0]+1900,Q()[d+16>>>2>>>0],Q()[d+12>>>2>>>0],Q()[d+8>>>2>>>0],Q()[d+4>>>2>>>0],Q()[d>>>2>>>0],0),b=Q()[d+32>>>2>>>0],T=m.getTimezoneOffset(),N=new Date(m.getFullYear(),6,1).getTimezoneOffset(),V=new Date(m.getFullYear(),0,1).getTimezoneOffset(),W=Math.min(V,N);return 0>b?Q()[d+32>>>2>>>0]=+(N!=V&&W==T):0<b!=(W==T)&&(N=Math.max(V,N),m.setTime(m.getTime()+6e4*((0<b?W:N)-T))),Q()[d+24>>>2>>>0]=m.getDay(),b=(Al(m.getFullYear())?Rl:Or)[m.getMonth()]+m.getDate()-1|0,Q()[d+28>>>2>>>0]=b,Q()[d>>>2>>>0]=m.getSeconds(),Q()[d+4>>>2>>>0]=m.getMinutes(),Q()[d+8>>>2>>>0]=m.getHours(),Q()[d+12>>>2>>>0]=m.getDate(),Q()[d+16>>>2>>>0]=m.getMonth(),Q()[d+20>>>2>>>0]=m.getYear(),d=m.getTime(),BigInt(isNaN(d)?-1:d/1e3)}function Nl(d,m,b,T,N,V,W){return u?Ge(16,1,d,m,b,T,N,V,W):-52}function Pl(d,m,b,T,N,V){if(u)return Ge(17,1,d,m,b,T,N,V)}var Dr={},un=()=>performance.timeOrigin+performance.now();function Ol(d,m){if(u)return Ge(18,1,d,m);if(Dr[d]&&(clearTimeout(Dr[d].id),delete Dr[d]),!m)return 0;var b=setTimeout(()=>{delete Dr[d],Il(()=>k0(d,performance.timeOrigin+performance.now()))},m);return Dr[d]={id:b,rc:m},0}function ud(d,m,b,T){d>>>=0,m>>>=0,b>>>=0,T>>>=0;var N=new Date().getFullYear(),V=new Date(N,0,1).getTimezoneOffset();N=new Date(N,6,1).getTimezoneOffset();var W=Math.max(V,N);be()[d>>>2>>>0]=60*W,Q()[m>>>2>>>0]=+(V!=N),d=(m=J=>{var re=Math.abs(J);return`UTC${0<=J?"-":"+"}${String(Math.floor(re/60)).padStart(2,"0")}${String(re%60).padStart(2,"0")}`})(V),m=m(N),N<V?(Jt(d,b,17),Jt(m,T,17)):(Jt(d,T,17),Jt(m,b,17))}var Li=()=>Date.now();function c(d,m,b){return 0<=d&&3>=d?(d===0?d=Date.now():d=performance.timeOrigin+performance.now(),O[b>>>0>>>3]=BigInt(Math.round(1e6*d)),0):28}var v=[],S=(d,m)=>{v.length=0;for(var b;b=Y()[d++>>>0];){var T=b!=105;m+=(T&=b!=112)&&m%8?4:0,v.push(b==112?be()[m>>>2>>>0]:b==106?O[m>>>3]:b==105?Q()[m>>>2>>>0]:et()[m>>>3>>>0]),m+=T?8:4}return v};function L(d,m,b){return d>>>=0,m=S(m>>>0,b>>>0),_p[d](...m)}function H(d,m,b){return d>>>=0,m=S(m>>>0,b>>>0),_p[d](...m)}var Z=()=>{};function he(d,m){return F(tt(d>>>0,m>>>0))}var Oe=()=>{throw kr+=1,"unwind"};function wt(){return 4294901760}var Ye=()=>navigator.hardwareConcurrency;function Tt(){return Zn("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function Bn(d){d>>>=0;var m=Y().length;if(d<=m||4294901760<d)return!1;for(var b=1;4>=b;b*=2){var T=m*(1+.2/b);T=Math.min(T,d+100663296);e:{T=(Math.min(4294901760,65536*Math.ceil(Math.max(d,T)/65536))-I.buffer.byteLength+65535)/65536|0;try{I.grow(T),je();var N=1;break e}catch{}N=void 0}if(N)return!0}return!1}var Fn=()=>(Zn("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),_n={},ir=d=>{d.forEach(m=>{Fn()})};function Xa(){var d=Error().stack.toString().split(`
`);return d[0]=="Error"&&d.shift(),ir(d),_n.Mb=Fn(),_n.dc=d,_n.Mb}function Dl(d,m,b){if(d>>>=0,m>>>=0,_n.Mb==d)var T=_n.dc;else(T=Error().stack.toString().split(`
`))[0]=="Error"&&T.shift(),ir(T);for(var N=3;T[N]&&Fn()!=d;)++N;for(d=0;d<b&&T[d+N];++d)Q()[m+4*d>>>2>>>0]=Fn();return d}var gp,yp={},p0=()=>{if(!gp){var d,m={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(d in yp)yp[d]===void 0?delete m[d]:m[d]=yp[d];var b=[];for(d in m)b.push(`${d}=${m[d]}`);gp=b}return gp};function m0(d,m){if(u)return Ge(19,1,d,m);d>>>=0,m>>>=0;var b,T=0,N=0;for(b of p0()){var V=m+T;be()[d+N>>>2>>>0]=V,T+=Jt(b,V,1/0)+1,N+=4}return 0}function g0(d,m){if(u)return Ge(20,1,d,m);d>>>=0,m>>>=0;var b=p0();for(var T of(be()[d>>>2>>>0]=b.length,d=0,b))d+=gn(T)+1;return be()[m>>>2>>>0]=d,0}function y0(d){return u?Ge(21,1,d):52}function _0(d,m,b,T){return u?Ge(22,1,d,m,b,T):52}function v0(d,m,b,T){return u?Ge(23,1,d,m,b,T):70}var fN=[null,[],[]];function w0(d,m,b,T){if(u)return Ge(24,1,d,m,b,T);m>>>=0,b>>>=0,T>>>=0;for(var N=0,V=0;V<b;V++){var W=be()[m>>>2>>>0],J=be()[m+4>>>2>>>0];m+=8;for(var re=0;re<J;re++){var oe=d,ge=Y()[W+re>>>0],Ie=fN[oe];ge===0||ge===10?((oe===1?B:F)(Ni(Ie)),Ie.length=0):Ie.push(ge)}N+=J}return be()[T>>>2>>>0]=N,0}u||function(){for(var d=s.numThreads-1;d--;)Ar();ul.push(()=>{ni++,function(m){u?m():Promise.all(Sr.map(Ba)).then(m)}(()=>Va())})}();for(var b0=Array(256),cd=0;256>cd;++cd)b0[cd]=String.fromCharCode(cd);_l=b0,kn.push(0,1,void 0,1,null,1,!0,1,!1,1),s.count_emval_handles=()=>kn.length/2-5-nr.length,u||(I=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),je()),s.wasmBinary&&(y=s.wasmBinary),s.stackSave=()=>Ep(),s.stackRestore=d=>hd(d),s.stackAlloc=d=>xp(d),s.setValue=function(d,m,b="i8"){switch(b.endsWith("*")&&(b="*"),b){case"i1":case"i8":q()[d>>>0]=m;break;case"i16":ae()[d>>>1>>>0]=m;break;case"i32":Q()[d>>>2>>>0]=m;break;case"i64":O[d>>>3]=BigInt(m);break;case"float":rt()[d>>>2>>>0]=m;break;case"double":et()[d>>>3>>>0]=m;break;case"*":be()[d>>>2>>>0]=m;break;default:Zn(`invalid type for setValue: ${b}`)}},s.getValue=function(d,m="i8"){switch(m.endsWith("*")&&(m="*"),m){case"i1":case"i8":return q()[d>>>0];case"i16":return ae()[d>>>1>>>0];case"i32":return Q()[d>>>2>>>0];case"i64":return O[d>>>3];case"float":return rt()[d>>>2>>>0];case"double":return et()[d>>>3>>>0];case"*":return be()[d>>>2>>>0];default:Zn(`invalid type for getValue: ${m}`)}},s.UTF8ToString=tt,s.stringToUTF8=Jt,s.lengthBytesUTF8=gn;var pN=[ja,dl,fl,Oc,Dc,ri,Mc,Lc,Os,ml,gl,Wa,Pi,zc,er,yl,Nl,Pl,Ol,m0,g0,y0,_0,v0,w0],_p={893836:(d,m,b,T,N)=>{if(s===void 0||!s.Fb)return 1;if((d=tt(Number(d>>>0))).startsWith("./")&&(d=d.substring(2)),!(d=s.Fb.get(d)))return 2;if(m=Number(m>>>0),b=Number(b>>>0),T=Number(T>>>0),m+b>d.byteLength)return 3;try{let V=d.subarray(m,m+b);switch(N){case 0:Y().set(V,T>>>0);break;case 1:s.mc?s.mc(T,V):s.cc(T,V);break;default:return 4}return 0}catch{return 4}},894660:(d,m,b)=>{s.Pb(d,Y().subarray(m>>>0,m+b>>>0))},894724:()=>s.oc(),894766:d=>{s.Ob(d)},894803:()=>{s.Wb()},894834:()=>{s.Xb()},894863:()=>{s.ac()},894888:d=>s.Vb(d),894921:d=>s.Zb(d),894953:(d,m,b)=>{s.Lb(Number(d),Number(m),Number(b),!0)},895016:(d,m,b)=>{s.Lb(Number(d),Number(m),Number(b))},895073:()=>typeof wasmOffsetConverter<"u",895130:d=>{s.Ab("Abs",d,void 0)},895181:d=>{s.Ab("Neg",d,void 0)},895232:d=>{s.Ab("Floor",d,void 0)},895285:d=>{s.Ab("Ceil",d,void 0)},895337:d=>{s.Ab("Reciprocal",d,void 0)},895395:d=>{s.Ab("Sqrt",d,void 0)},895447:d=>{s.Ab("Exp",d,void 0)},895498:d=>{s.Ab("Erf",d,void 0)},895549:d=>{s.Ab("Sigmoid",d,void 0)},895604:(d,m,b)=>{s.Ab("HardSigmoid",d,{alpha:m,beta:b})},895683:d=>{s.Ab("Log",d,void 0)},895734:d=>{s.Ab("Sin",d,void 0)},895785:d=>{s.Ab("Cos",d,void 0)},895836:d=>{s.Ab("Tan",d,void 0)},895887:d=>{s.Ab("Asin",d,void 0)},895939:d=>{s.Ab("Acos",d,void 0)},895991:d=>{s.Ab("Atan",d,void 0)},896043:d=>{s.Ab("Sinh",d,void 0)},896095:d=>{s.Ab("Cosh",d,void 0)},896147:d=>{s.Ab("Asinh",d,void 0)},896200:d=>{s.Ab("Acosh",d,void 0)},896253:d=>{s.Ab("Atanh",d,void 0)},896306:d=>{s.Ab("Tanh",d,void 0)},896358:d=>{s.Ab("Not",d,void 0)},896409:(d,m,b)=>{s.Ab("Clip",d,{min:m,max:b})},896478:d=>{s.Ab("Clip",d,void 0)},896530:(d,m)=>{s.Ab("Elu",d,{alpha:m})},896588:d=>{s.Ab("Gelu",d,void 0)},896640:d=>{s.Ab("Relu",d,void 0)},896692:(d,m)=>{s.Ab("LeakyRelu",d,{alpha:m})},896756:(d,m)=>{s.Ab("ThresholdedRelu",d,{alpha:m})},896826:(d,m)=>{s.Ab("Cast",d,{to:m})},896884:d=>{s.Ab("Add",d,void 0)},896935:d=>{s.Ab("Sub",d,void 0)},896986:d=>{s.Ab("Mul",d,void 0)},897037:d=>{s.Ab("Div",d,void 0)},897088:d=>{s.Ab("Pow",d,void 0)},897139:d=>{s.Ab("Equal",d,void 0)},897192:d=>{s.Ab("Greater",d,void 0)},897247:d=>{s.Ab("GreaterOrEqual",d,void 0)},897309:d=>{s.Ab("Less",d,void 0)},897361:d=>{s.Ab("LessOrEqual",d,void 0)},897420:(d,m,b,T,N)=>{s.Ab("ReduceMean",d,{keepDims:!!m,noopWithEmptyAxes:!!b,axes:T?Array.from(Q().subarray(Number(T)>>>0,Number(N)>>>0)):[]})},897595:(d,m,b,T,N)=>{s.Ab("ReduceMax",d,{keepDims:!!m,noopWithEmptyAxes:!!b,axes:T?Array.from(Q().subarray(Number(T)>>>0,Number(N)>>>0)):[]})},897769:(d,m,b,T,N)=>{s.Ab("ReduceMin",d,{keepDims:!!m,noopWithEmptyAxes:!!b,axes:T?Array.from(Q().subarray(Number(T)>>>0,Number(N)>>>0)):[]})},897943:(d,m,b,T,N)=>{s.Ab("ReduceProd",d,{keepDims:!!m,noopWithEmptyAxes:!!b,axes:T?Array.from(Q().subarray(Number(T)>>>0,Number(N)>>>0)):[]})},898118:(d,m,b,T,N)=>{s.Ab("ReduceSum",d,{keepDims:!!m,noopWithEmptyAxes:!!b,axes:T?Array.from(Q().subarray(Number(T)>>>0,Number(N)>>>0)):[]})},898292:(d,m,b,T,N)=>{s.Ab("ReduceL1",d,{keepDims:!!m,noopWithEmptyAxes:!!b,axes:T?Array.from(Q().subarray(Number(T)>>>0,Number(N)>>>0)):[]})},898465:(d,m,b,T,N)=>{s.Ab("ReduceL2",d,{keepDims:!!m,noopWithEmptyAxes:!!b,axes:T?Array.from(Q().subarray(Number(T)>>>0,Number(N)>>>0)):[]})},898638:(d,m,b,T,N)=>{s.Ab("ReduceLogSum",d,{keepDims:!!m,noopWithEmptyAxes:!!b,axes:T?Array.from(Q().subarray(Number(T)>>>0,Number(N)>>>0)):[]})},898815:(d,m,b,T,N)=>{s.Ab("ReduceSumSquare",d,{keepDims:!!m,noopWithEmptyAxes:!!b,axes:T?Array.from(Q().subarray(Number(T)>>>0,Number(N)>>>0)):[]})},898995:(d,m,b,T,N)=>{s.Ab("ReduceLogSumExp",d,{keepDims:!!m,noopWithEmptyAxes:!!b,axes:T?Array.from(Q().subarray(Number(T)>>>0,Number(N)>>>0)):[]})},899175:d=>{s.Ab("Where",d,void 0)},899228:(d,m,b)=>{s.Ab("Transpose",d,{perm:m?Array.from(Q().subarray(Number(m)>>>0,Number(b)>>>0)):[]})},899352:(d,m,b,T)=>{s.Ab("DepthToSpace",d,{blocksize:m,mode:tt(b),format:T?"NHWC":"NCHW"})},899485:(d,m,b,T)=>{s.Ab("DepthToSpace",d,{blocksize:m,mode:tt(b),format:T?"NHWC":"NCHW"})},899618:(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe,It)=>{s.Ab("ConvTranspose",d,{format:re?"NHWC":"NCHW",autoPad:m,dilations:[b],group:T,kernelShape:[N],pads:[V,W],strides:[J],wIsConst:()=>!!q()[oe>>>0],outputPadding:ge?Array.from(Q().subarray(Number(ge)>>>0,Number(Ie)>>>0)):[],outputShape:Pe?Array.from(Q().subarray(Number(Pe)>>>0,Number(Fe)>>>0)):[],activation:tt(It)})},900051:(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe)=>{s.Ab("ConvTranspose",d,{format:J?"NHWC":"NCHW",autoPad:m,dilations:Array.from(Q().subarray(Number(b)>>>0,2+(Number(b)>>>0)>>>0)),group:T,kernelShape:Array.from(Q().subarray(Number(N)>>>0,2+(Number(N)>>>0)>>>0)),pads:Array.from(Q().subarray(Number(V)>>>0,4+(Number(V)>>>0)>>>0)),strides:Array.from(Q().subarray(Number(W)>>>0,2+(Number(W)>>>0)>>>0)),wIsConst:()=>!!q()[re>>>0],outputPadding:oe?Array.from(Q().subarray(Number(oe)>>>0,Number(ge)>>>0)):[],outputShape:Ie?Array.from(Q().subarray(Number(Ie)>>>0,Number(Pe)>>>0)):[],activation:tt(Fe)})},900712:(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe,It)=>{s.Ab("ConvTranspose",d,{format:re?"NHWC":"NCHW",autoPad:m,dilations:[b],group:T,kernelShape:[N],pads:[V,W],strides:[J],wIsConst:()=>!!q()[oe>>>0],outputPadding:ge?Array.from(Q().subarray(Number(ge)>>>0,Number(Ie)>>>0)):[],outputShape:Pe?Array.from(Q().subarray(Number(Pe)>>>0,Number(Fe)>>>0)):[],activation:tt(It)})},901145:(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe)=>{s.Ab("ConvTranspose",d,{format:J?"NHWC":"NCHW",autoPad:m,dilations:Array.from(Q().subarray(Number(b)>>>0,2+(Number(b)>>>0)>>>0)),group:T,kernelShape:Array.from(Q().subarray(Number(N)>>>0,2+(Number(N)>>>0)>>>0)),pads:Array.from(Q().subarray(Number(V)>>>0,4+(Number(V)>>>0)>>>0)),strides:Array.from(Q().subarray(Number(W)>>>0,2+(Number(W)>>>0)>>>0)),wIsConst:()=>!!q()[re>>>0],outputPadding:oe?Array.from(Q().subarray(Number(oe)>>>0,Number(ge)>>>0)):[],outputShape:Ie?Array.from(Q().subarray(Number(Ie)>>>0,Number(Pe)>>>0)):[],activation:tt(Fe)})},901806:(d,m)=>{s.Ab("GlobalAveragePool",d,{format:m?"NHWC":"NCHW"})},901897:(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe)=>{s.Ab("AveragePool",d,{format:Fe?"NHWC":"NCHW",auto_pad:m,ceil_mode:b,count_include_pad:T,storage_order:N,dilations:V?Array.from(Q().subarray(Number(V)>>>0,Number(W)>>>0)):[],kernel_shape:J?Array.from(Q().subarray(Number(J)>>>0,Number(re)>>>0)):[],pads:oe?Array.from(Q().subarray(Number(oe)>>>0,Number(ge)>>>0)):[],strides:Ie?Array.from(Q().subarray(Number(Ie)>>>0,Number(Pe)>>>0)):[]})},902376:(d,m)=>{s.Ab("GlobalAveragePool",d,{format:m?"NHWC":"NCHW"})},902467:(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe)=>{s.Ab("AveragePool",d,{format:Fe?"NHWC":"NCHW",auto_pad:m,ceil_mode:b,count_include_pad:T,storage_order:N,dilations:V?Array.from(Q().subarray(Number(V)>>>0,Number(W)>>>0)):[],kernel_shape:J?Array.from(Q().subarray(Number(J)>>>0,Number(re)>>>0)):[],pads:oe?Array.from(Q().subarray(Number(oe)>>>0,Number(ge)>>>0)):[],strides:Ie?Array.from(Q().subarray(Number(Ie)>>>0,Number(Pe)>>>0)):[]})},902946:(d,m)=>{s.Ab("GlobalMaxPool",d,{format:m?"NHWC":"NCHW"})},903033:(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe)=>{s.Ab("MaxPool",d,{format:Fe?"NHWC":"NCHW",auto_pad:m,ceil_mode:b,count_include_pad:T,storage_order:N,dilations:V?Array.from(Q().subarray(Number(V)>>>0,Number(W)>>>0)):[],kernel_shape:J?Array.from(Q().subarray(Number(J)>>>0,Number(re)>>>0)):[],pads:oe?Array.from(Q().subarray(Number(oe)>>>0,Number(ge)>>>0)):[],strides:Ie?Array.from(Q().subarray(Number(Ie)>>>0,Number(Pe)>>>0)):[]})},903508:(d,m)=>{s.Ab("GlobalMaxPool",d,{format:m?"NHWC":"NCHW"})},903595:(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe)=>{s.Ab("MaxPool",d,{format:Fe?"NHWC":"NCHW",auto_pad:m,ceil_mode:b,count_include_pad:T,storage_order:N,dilations:V?Array.from(Q().subarray(Number(V)>>>0,Number(W)>>>0)):[],kernel_shape:J?Array.from(Q().subarray(Number(J)>>>0,Number(re)>>>0)):[],pads:oe?Array.from(Q().subarray(Number(oe)>>>0,Number(ge)>>>0)):[],strides:Ie?Array.from(Q().subarray(Number(Ie)>>>0,Number(Pe)>>>0)):[]})},904070:(d,m,b,T,N)=>{s.Ab("Gemm",d,{alpha:m,beta:b,transA:T,transB:N})},904174:d=>{s.Ab("MatMul",d,void 0)},904228:(d,m,b,T)=>{s.Ab("ArgMax",d,{keepDims:!!m,selectLastIndex:!!b,axis:T})},904336:(d,m,b,T)=>{s.Ab("ArgMin",d,{keepDims:!!m,selectLastIndex:!!b,axis:T})},904444:(d,m)=>{s.Ab("Softmax",d,{axis:m})},904507:(d,m)=>{s.Ab("Concat",d,{axis:m})},904567:(d,m,b,T,N)=>{s.Ab("Split",d,{axis:m,numOutputs:b,splitSizes:T?Array.from(Q().subarray(Number(T)>>>0,Number(N)>>>0)):[]})},904723:d=>{s.Ab("Expand",d,void 0)},904777:(d,m)=>{s.Ab("Gather",d,{axis:Number(m)})},904848:(d,m)=>{s.Ab("GatherElements",d,{axis:Number(m)})},904927:(d,m)=>{s.Ab("GatherND",d,{batch_dims:Number(m)})},905006:(d,m,b,T,N,V,W,J,re,oe,ge)=>{s.Ab("Resize",d,{antialias:m,axes:b?Array.from(Q().subarray(Number(b)>>>0,Number(T)>>>0)):[],coordinateTransformMode:tt(N),cubicCoeffA:V,excludeOutside:W,extrapolationValue:J,keepAspectRatioPolicy:tt(re),mode:tt(oe),nearestMode:tt(ge)})},905368:(d,m,b,T,N,V,W)=>{s.Ab("Slice",d,{starts:m?Array.from(Q().subarray(Number(m)>>>0,Number(b)>>>0)):[],ends:T?Array.from(Q().subarray(Number(T)>>>0,Number(N)>>>0)):[],axes:V?Array.from(Q().subarray(Number(V)>>>0,Number(W)>>>0)):[]})},905632:d=>{s.Ab("Tile",d,void 0)},905684:(d,m,b)=>{s.Ab("InstanceNormalization",d,{epsilon:m,format:b?"NHWC":"NCHW"})},905798:(d,m,b)=>{s.Ab("InstanceNormalization",d,{epsilon:m,format:b?"NHWC":"NCHW"})},905912:d=>{s.Ab("Range",d,void 0)},905965:(d,m)=>{s.Ab("Einsum",d,{equation:tt(m)})},906046:(d,m,b,T,N)=>{s.Ab("Pad",d,{mode:m,value:b,pads:T?Array.from(Q().subarray(Number(T)>>>0,Number(N)>>>0)):[]})},906189:(d,m,b,T,N,V)=>{s.Ab("BatchNormalization",d,{epsilon:m,momentum:b,spatial:!!N,trainingMode:!!T,format:V?"NHWC":"NCHW"})},906358:(d,m,b,T,N,V)=>{s.Ab("BatchNormalization",d,{epsilon:m,momentum:b,spatial:!!N,trainingMode:!!T,format:V?"NHWC":"NCHW"})},906527:(d,m,b)=>{s.Ab("CumSum",d,{exclusive:Number(m),reverse:Number(b)})},906624:(d,m,b)=>{s.Ab("DequantizeLinear",d,{axis:m,blockSize:b})},906714:(d,m,b,T,N)=>{s.Ab("GridSample",d,{align_corners:m,mode:tt(b),padding_mode:tt(T),format:N?"NHWC":"NCHW"})},906884:(d,m,b,T,N)=>{s.Ab("GridSample",d,{align_corners:m,mode:tt(b),padding_mode:tt(T),format:N?"NHWC":"NCHW"})},907054:(d,m)=>{s.Ab("ScatterND",d,{reduction:tt(m)})},907139:(d,m,b,T,N,V,W,J,re)=>{s.Ab("Attention",d,{numHeads:m,isUnidirectional:b,maskFilterValue:T,scale:N,doRotary:V,qkvHiddenSizes:W?Array.from(Q().subarray(Number(J)>>>0,Number(J)+W>>>0)):[],pastPresentShareBuffer:!!re})},907411:d=>{s.Ab("BiasAdd",d,void 0)},907466:d=>{s.Ab("BiasSplitGelu",d,void 0)},907527:d=>{s.Ab("FastGelu",d,void 0)},907583:(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe,It,Cn)=>{s.Ab("Conv",d,{format:Ie?"NHWC":"NCHW",auto_pad:m,dilations:b?Array.from(Q().subarray(Number(b)>>>0,Number(T)>>>0)):[],group:N,kernel_shape:V?Array.from(Q().subarray(Number(V)>>>0,Number(W)>>>0)):[],pads:J?Array.from(Q().subarray(Number(J)>>>0,Number(re)>>>0)):[],strides:oe?Array.from(Q().subarray(Number(oe)>>>0,Number(ge)>>>0)):[],w_is_const:()=>!!q()[Number(Pe)>>>0],activation:tt(Fe),activation_params:It?Array.from(rt().subarray(Number(It)>>>0,Number(Cn)>>>0)):[]})},908167:d=>{s.Ab("Gelu",d,void 0)},908219:(d,m,b,T,N,V,W,J,re)=>{s.Ab("GroupQueryAttention",d,{numHeads:m,kvNumHeads:b,scale:T,softcap:N,doRotary:V,rotaryInterleaved:W,smoothSoftmax:J,localWindowSize:re})},908436:(d,m,b,T)=>{s.Ab("LayerNormalization",d,{axis:m,epsilon:b,simplified:!!T})},908547:(d,m,b,T)=>{s.Ab("LayerNormalization",d,{axis:m,epsilon:b,simplified:!!T})},908658:(d,m,b,T,N,V)=>{s.Ab("MatMulNBits",d,{k:m,n:b,accuracyLevel:T,bits:N,blockSize:V})},908785:(d,m,b,T,N,V)=>{s.Ab("MultiHeadAttention",d,{numHeads:m,isUnidirectional:b,maskFilterValue:T,scale:N,doRotary:V})},908944:(d,m)=>{s.Ab("QuickGelu",d,{alpha:m})},909008:(d,m,b,T,N)=>{s.Ab("RotaryEmbedding",d,{interleaved:!!m,numHeads:b,rotaryEmbeddingDim:T,scale:N})},909147:(d,m,b)=>{s.Ab("SkipLayerNormalization",d,{epsilon:m,simplified:!!b})},909249:(d,m,b)=>{s.Ab("SkipLayerNormalization",d,{epsilon:m,simplified:!!b})},909351:(d,m,b,T)=>{s.Ab("GatherBlockQuantized",d,{gatherAxis:m,quantizeAxis:b,blockSize:T})},909472:d=>{s.$b(d)},909506:(d,m)=>s.bc(Number(d),Number(m),s.Gb.ec,s.Gb.errors)};function mN(d,m,b){return Yc(async()=>{await s.Yb(Number(d),Number(m),Number(b))})}function gN(){return typeof wasmOffsetConverter<"u"}var ee=await async function(){function d(T,N){return ee=T.exports,ee=function(){var V=ee,W={};for(let[J,re]of Object.entries(V))W[J]=typeof re=="function"?(...oe)=>{Us.push(J);try{return re(...oe)}finally{U||(Us.pop(),yn&&Nr===1&&Us.length===0&&(Nr=0,kr+=1,Sn(N0),typeof Fibers<"u"&&Fibers.sc()))}}:re;return W}(),ee=function(){var V=ee,W=re=>oe=>re(oe)>>>0,J=re=>()=>re()>>>0;return(V=Object.assign({},V)).Ea=W(V.Ea),V.gb=J(V.gb),V.ib=W(V.ib),V.tb=W(V.tb),V.ub=J(V.ub),V.__cxa_get_exception_ptr=W(V.__cxa_get_exception_ptr),V}(),hl.push(ee.jb),R=N,Va(),ee}ni++;var m=At();if(s.instantiateWasm)return new Promise(T=>{s.instantiateWasm(m,(N,V)=>{T(d(N,V))})});if(u)return new Promise(T=>{ue=N=>{var V=new WebAssembly.Instance(N,At());T(d(V,N))}});Yt??(Yt=s.locateFile?s.locateFile?s.locateFile("ort-wasm-simd-threaded.jsep.wasm",w):w+"ort-wasm-simd-threaded.jsep.wasm":new URL(""+new URL("ort-wasm-simd-threaded.jsep-BGTZ4Y7F.wasm",import.meta.url).href,import.meta.url).href);try{var b=await async function(T){var N=Yt;if(!y&&typeof WebAssembly.instantiateStreaming=="function"&&!G(N))try{var V=fetch(N,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(V,T)}catch(W){F(`wasm streaming compile failed: ${W}`),F("falling back to ArrayBuffer instantiation")}return async function(W,J){try{var re=await async function(oe){if(!y)try{var ge=await g(oe);return new Uint8Array(ge)}catch{}if(oe==Yt&&y)oe=new Uint8Array(y);else{if(!_)throw"both async and sync fetching of the wasm failed";oe=_(oe)}return oe}(W);return await WebAssembly.instantiate(re,J)}catch(oe){F(`failed to asynchronously prepare wasm: ${oe}`),Zn(oe)}}(N,T)}(m);return d(b.instance,b.module)}catch(T){return i(T),Promise.reject(T)}}(),x0=d=>(x0=ee.Ea)(d),E0=()=>(E0=ee.Fa)();s._OrtInit=(d,m)=>(s._OrtInit=ee.Ga)(d,m),s._OrtGetLastError=(d,m)=>(s._OrtGetLastError=ee.Ha)(d,m),s._OrtCreateSessionOptions=(d,m,b,T,N,V,W,J,re,oe)=>(s._OrtCreateSessionOptions=ee.Ia)(d,m,b,T,N,V,W,J,re,oe),s._OrtAppendExecutionProvider=(d,m,b,T,N)=>(s._OrtAppendExecutionProvider=ee.Ja)(d,m,b,T,N),s._OrtAddFreeDimensionOverride=(d,m,b)=>(s._OrtAddFreeDimensionOverride=ee.Ka)(d,m,b),s._OrtAddSessionConfigEntry=(d,m,b)=>(s._OrtAddSessionConfigEntry=ee.La)(d,m,b),s._OrtReleaseSessionOptions=d=>(s._OrtReleaseSessionOptions=ee.Ma)(d),s._OrtCreateSession=(d,m,b)=>(s._OrtCreateSession=ee.Na)(d,m,b),s._OrtReleaseSession=d=>(s._OrtReleaseSession=ee.Oa)(d),s._OrtGetInputOutputCount=(d,m,b)=>(s._OrtGetInputOutputCount=ee.Pa)(d,m,b),s._OrtGetInputOutputMetadata=(d,m,b,T)=>(s._OrtGetInputOutputMetadata=ee.Qa)(d,m,b,T),s._OrtFree=d=>(s._OrtFree=ee.Ra)(d),s._OrtCreateTensor=(d,m,b,T,N,V)=>(s._OrtCreateTensor=ee.Sa)(d,m,b,T,N,V),s._OrtGetTensorData=(d,m,b,T,N)=>(s._OrtGetTensorData=ee.Ta)(d,m,b,T,N),s._OrtReleaseTensor=d=>(s._OrtReleaseTensor=ee.Ua)(d),s._OrtCreateRunOptions=(d,m,b,T)=>(s._OrtCreateRunOptions=ee.Va)(d,m,b,T),s._OrtAddRunConfigEntry=(d,m,b)=>(s._OrtAddRunConfigEntry=ee.Wa)(d,m,b),s._OrtReleaseRunOptions=d=>(s._OrtReleaseRunOptions=ee.Xa)(d),s._OrtCreateBinding=d=>(s._OrtCreateBinding=ee.Ya)(d),s._OrtBindInput=(d,m,b)=>(s._OrtBindInput=ee.Za)(d,m,b),s._OrtBindOutput=(d,m,b,T)=>(s._OrtBindOutput=ee._a)(d,m,b,T),s._OrtClearBoundOutputs=d=>(s._OrtClearBoundOutputs=ee.$a)(d),s._OrtReleaseBinding=d=>(s._OrtReleaseBinding=ee.ab)(d),s._OrtRunWithBinding=(d,m,b,T,N)=>(s._OrtRunWithBinding=ee.bb)(d,m,b,T,N),s._OrtRun=(d,m,b,T,N,V,W,J)=>(s._OrtRun=ee.cb)(d,m,b,T,N,V,W,J),s._OrtEndProfiling=d=>(s._OrtEndProfiling=ee.db)(d),s._JsepOutput=(d,m,b)=>(s._JsepOutput=ee.eb)(d,m,b),s._JsepGetNodeName=d=>(s._JsepGetNodeName=ee.fb)(d);var vp=()=>(vp=ee.gb)(),oi=s._free=d=>(oi=s._free=ee.hb)(d),dd=s._malloc=d=>(dd=s._malloc=ee.ib)(d),wp=(d,m,b,T,N,V)=>(wp=ee.kb)(d,m,b,T,N,V),T0=()=>(T0=ee.lb)(),I0=(d,m,b,T,N)=>(I0=ee.mb)(d,m,b,T,N),$0=d=>($0=ee.nb)(d),bp=d=>(bp=ee.ob)(d),k0=(d,m)=>(k0=ee.pb)(d,m),S0=()=>(S0=ee.qb)(),C0=(d,m)=>(C0=ee.rb)(d,m),hd=d=>(hd=ee.sb)(d),xp=d=>(xp=ee.tb)(d),Ep=()=>(Ep=ee.ub)(),A0=s.dynCall_ii=(d,m)=>(A0=s.dynCall_ii=ee.vb)(d,m);s.dynCall_vii=(d,m,b)=>(s.dynCall_vii=ee.dynCall_vii)(d,m,b),s.dynCall_iiiii=(d,m,b,T,N)=>(s.dynCall_iiiii=ee.dynCall_iiiii)(d,m,b,T,N),s.dynCall_iii=(d,m,b)=>(s.dynCall_iii=ee.dynCall_iii)(d,m,b),s.dynCall_iiiiii=(d,m,b,T,N,V)=>(s.dynCall_iiiiii=ee.dynCall_iiiiii)(d,m,b,T,N,V),s.dynCall_iiiiiiii=(d,m,b,T,N,V,W,J)=>(s.dynCall_iiiiiiii=ee.dynCall_iiiiiiii)(d,m,b,T,N,V,W,J),s.dynCall_iiiiiii=(d,m,b,T,N,V,W)=>(s.dynCall_iiiiiii=ee.dynCall_iiiiiii)(d,m,b,T,N,V,W),s.dynCall_vi=(d,m)=>(s.dynCall_vi=ee.dynCall_vi)(d,m),s.dynCall_iiii=(d,m,b,T)=>(s.dynCall_iiii=ee.dynCall_iiii)(d,m,b,T),s.dynCall_i=d=>(s.dynCall_i=ee.dynCall_i)(d),s.dynCall_viiiiiiii=(d,m,b,T,N,V,W,J,re)=>(s.dynCall_viiiiiiii=ee.dynCall_viiiiiiii)(d,m,b,T,N,V,W,J,re),s.dynCall_viii=(d,m,b,T)=>(s.dynCall_viii=ee.dynCall_viii)(d,m,b,T),s.dynCall_viijj=(d,m,b,T,N)=>(s.dynCall_viijj=ee.dynCall_viijj)(d,m,b,T,N),s.dynCall_viiiiii=(d,m,b,T,N,V,W)=>(s.dynCall_viiiiii=ee.dynCall_viiiiii)(d,m,b,T,N,V,W),s.dynCall_viiii=(d,m,b,T,N)=>(s.dynCall_viiii=ee.dynCall_viiii)(d,m,b,T,N),s.dynCall_viiiii=(d,m,b,T,N,V)=>(s.dynCall_viiiii=ee.dynCall_viiiii)(d,m,b,T,N,V),s.dynCall_vfiii=(d,m,b,T,N)=>(s.dynCall_vfiii=ee.dynCall_vfiii)(d,m,b,T,N),s.dynCall_viiiiff=(d,m,b,T,N,V,W)=>(s.dynCall_viiiiff=ee.dynCall_viiiiff)(d,m,b,T,N,V,W),s.dynCall_viiiiiff=(d,m,b,T,N,V,W,J)=>(s.dynCall_viiiiiff=ee.dynCall_viiiiiff)(d,m,b,T,N,V,W,J),s.dynCall_ffff=(d,m,b,T)=>(s.dynCall_ffff=ee.dynCall_ffff)(d,m,b,T),s.dynCall_viiff=(d,m,b,T,N)=>(s.dynCall_viiff=ee.dynCall_viiff)(d,m,b,T,N),s.dynCall_fffffff=(d,m,b,T,N,V,W)=>(s.dynCall_fffffff=ee.dynCall_fffffff)(d,m,b,T,N,V,W),s.dynCall_jjjjjjj=(d,m,b,T,N,V,W)=>(s.dynCall_jjjjjjj=ee.dynCall_jjjjjjj)(d,m,b,T,N,V,W),s.dynCall_jjjjjj=(d,m,b,T,N,V)=>(s.dynCall_jjjjjj=ee.dynCall_jjjjjj)(d,m,b,T,N,V),s.dynCall_iijjii=(d,m,b,T,N,V)=>(s.dynCall_iijjii=ee.dynCall_iijjii)(d,m,b,T,N,V),s.dynCall_viiiiiiiiiiiii=(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe)=>(s.dynCall_viiiiiiiiiiiii=ee.dynCall_viiiiiiiiiiiii)(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe),s.dynCall_viiiiiiiiii=(d,m,b,T,N,V,W,J,re,oe,ge)=>(s.dynCall_viiiiiiiiii=ee.dynCall_viiiiiiiiii)(d,m,b,T,N,V,W,J,re,oe,ge),s.dynCall_viiiiiiiiiii=(d,m,b,T,N,V,W,J,re,oe,ge,Ie)=>(s.dynCall_viiiiiiiiiii=ee.dynCall_viiiiiiiiiii)(d,m,b,T,N,V,W,J,re,oe,ge,Ie),s.dynCall_viiiiiiiiiiii=(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe)=>(s.dynCall_viiiiiiiiiiii=ee.dynCall_viiiiiiiiiiii)(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe),s.dynCall_viiiiiiiiiiiiiiiiii=(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe,It,Cn,li,Hs,Ml)=>(s.dynCall_viiiiiiiiiiiiiiiiii=ee.dynCall_viiiiiiiiiiiiiiiiii)(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe,It,Cn,li,Hs,Ml),s.dynCall_viiiiiiiii=(d,m,b,T,N,V,W,J,re,oe)=>(s.dynCall_viiiiiiiii=ee.dynCall_viiiiiiiii)(d,m,b,T,N,V,W,J,re,oe),s.dynCall_viiiiiiiiiiiiiiiiiii=(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe,It,Cn,li,Hs,Ml,Tp)=>(s.dynCall_viiiiiiiiiiiiiiiiiii=ee.dynCall_viiiiiiiiiiiiiiiiiii)(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe,It,Cn,li,Hs,Ml,Tp),s.dynCall_viiiiiii=(d,m,b,T,N,V,W,J)=>(s.dynCall_viiiiiii=ee.dynCall_viiiiiii)(d,m,b,T,N,V,W,J),s.dynCall_viiiiiiiiiiiiiii=(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe,It,Cn)=>(s.dynCall_viiiiiiiiiiiiiii=ee.dynCall_viiiiiiiiiiiiiii)(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe,It,Cn),s.dynCall_jiji=(d,m,b,T)=>(s.dynCall_jiji=ee.dynCall_jiji)(d,m,b,T),s.dynCall_v=d=>(s.dynCall_v=ee.dynCall_v)(d),s.dynCall_iidiiii=(d,m,b,T,N,V,W)=>(s.dynCall_iidiiii=ee.dynCall_iidiiii)(d,m,b,T,N,V,W),s.dynCall_iiiiiiiii=(d,m,b,T,N,V,W,J,re)=>(s.dynCall_iiiiiiiii=ee.dynCall_iiiiiiiii)(d,m,b,T,N,V,W,J,re),s.dynCall_iiij=(d,m,b,T)=>(s.dynCall_iiij=ee.dynCall_iiij)(d,m,b,T),s.dynCall_iiiiiiiiii=(d,m,b,T,N,V,W,J,re,oe)=>(s.dynCall_iiiiiiiiii=ee.dynCall_iiiiiiiiii)(d,m,b,T,N,V,W,J,re,oe),s.dynCall_iiiiiiiiiiiii=(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe)=>(s.dynCall_iiiiiiiiiiiii=ee.dynCall_iiiiiiiiiiiii)(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe),s.dynCall_iiiiiiiiiii=(d,m,b,T,N,V,W,J,re,oe,ge)=>(s.dynCall_iiiiiiiiiii=ee.dynCall_iiiiiiiiiii)(d,m,b,T,N,V,W,J,re,oe,ge),s.dynCall_ji=(d,m)=>(s.dynCall_ji=ee.dynCall_ji)(d,m),s.dynCall_iijii=(d,m,b,T,N)=>(s.dynCall_iijii=ee.dynCall_iijii)(d,m,b,T,N),s.dynCall_vij=(d,m,b)=>(s.dynCall_vij=ee.dynCall_vij)(d,m,b),s.dynCall_viiijii=(d,m,b,T,N,V,W)=>(s.dynCall_viiijii=ee.dynCall_viiijii)(d,m,b,T,N,V,W),s.dynCall_viijiiiiiiiiiiiiii=(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe,It,Cn,li,Hs)=>(s.dynCall_viijiiiiiiiiiiiiii=ee.dynCall_viijiiiiiiiiiiiiii)(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe,It,Cn,li,Hs),s.dynCall_viiiji=(d,m,b,T,N,V)=>(s.dynCall_viiiji=ee.dynCall_viiiji)(d,m,b,T,N,V),s.dynCall_fiii=(d,m,b,T)=>(s.dynCall_fiii=ee.dynCall_fiii)(d,m,b,T),s.dynCall_viijii=(d,m,b,T,N,V)=>(s.dynCall_viijii=ee.dynCall_viijii)(d,m,b,T,N,V),s.dynCall_viij=(d,m,b,T)=>(s.dynCall_viij=ee.dynCall_viij)(d,m,b,T),s.dynCall_jiij=(d,m,b,T)=>(s.dynCall_jiij=ee.dynCall_jiij)(d,m,b,T),s.dynCall_fi=(d,m)=>(s.dynCall_fi=ee.dynCall_fi)(d,m),s.dynCall_fii=(d,m,b)=>(s.dynCall_fii=ee.dynCall_fii)(d,m,b),s.dynCall_jii=(d,m,b)=>(s.dynCall_jii=ee.dynCall_jii)(d,m,b),s.dynCall_dii=(d,m,b)=>(s.dynCall_dii=ee.dynCall_dii)(d,m,b),s.dynCall_fiiii=(d,m,b,T,N)=>(s.dynCall_fiiii=ee.dynCall_fiiii)(d,m,b,T,N),s.dynCall_fif=(d,m,b)=>(s.dynCall_fif=ee.dynCall_fif)(d,m,b),s.dynCall_jfi=(d,m,b)=>(s.dynCall_jfi=ee.dynCall_jfi)(d,m,b),s.dynCall_viiiiiiiiiiiiii=(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe,It)=>(s.dynCall_viiiiiiiiiiiiii=ee.dynCall_viiiiiiiiiiiiii)(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe,It),s.dynCall_viiiiiiiiiiiiiiiiiiii=(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe,It,Cn,li,Hs,Ml,Tp,yN)=>(s.dynCall_viiiiiiiiiiiiiiiiiiii=ee.dynCall_viiiiiiiiiiiiiiiiiiii)(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe,It,Cn,li,Hs,Ml,Tp,yN),s.dynCall_viiiiiiiiiiiiiiii=(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe,It,Cn,li)=>(s.dynCall_viiiiiiiiiiiiiiii=ee.dynCall_viiiiiiiiiiiiiiii)(d,m,b,T,N,V,W,J,re,oe,ge,Ie,Pe,Fe,It,Cn,li),s.dynCall_iif=(d,m,b)=>(s.dynCall_iif=ee.dynCall_iif)(d,m,b),s.dynCall_jiiii=(d,m,b,T,N)=>(s.dynCall_jiiii=ee.dynCall_jiiii)(d,m,b,T,N),s.dynCall_jiii=(d,m,b,T)=>(s.dynCall_jiii=ee.dynCall_jiii)(d,m,b,T),s.dynCall_viif=(d,m,b,T)=>(s.dynCall_viif=ee.dynCall_viif)(d,m,b,T),s.dynCall_viiij=(d,m,b,T,N)=>(s.dynCall_viiij=ee.dynCall_viiij)(d,m,b,T,N),s.dynCall_viiiijii=(d,m,b,T,N,V,W,J)=>(s.dynCall_viiiijii=ee.dynCall_viiiijii)(d,m,b,T,N,V,W,J),s.dynCall_iiiiij=(d,m,b,T,N,V)=>(s.dynCall_iiiiij=ee.dynCall_iiiiij)(d,m,b,T,N,V),s.dynCall_iiiiid=(d,m,b,T,N,V)=>(s.dynCall_iiiiid=ee.dynCall_iiiiid)(d,m,b,T,N,V),s.dynCall_iiiiijj=(d,m,b,T,N,V,W)=>(s.dynCall_iiiiijj=ee.dynCall_iiiiijj)(d,m,b,T,N,V,W),s.dynCall_iiiiiijj=(d,m,b,T,N,V,W,J)=>(s.dynCall_iiiiiijj=ee.dynCall_iiiiiijj)(d,m,b,T,N,V,W,J);var R0=d=>(R0=ee.wb)(d),N0=()=>(N0=ee.xb)(),P0=d=>(P0=ee.yb)(d),O0=()=>(O0=ee.zb)();return function d(){if(0<ni)Xn=d;else if(u)r(s),Xe();else{for(;0<ul.length;)ul.shift()(s);0<ni?Xn=d:(s.calledRun=!0,U||(Xe(),r(s)))}}(),s.PTR_SIZE=4,a},YC=ym,Ub=(e=(t=globalThis.self)==null?void 0:t.name)==null?void 0:e.startsWith("em-pthread"),Ub&&ym()}),_m,Ay,Bb,An,JC,jd,Fb,Wb,vm,qb,wm,XC,bm,ZC,Bv=se(()=>{Uv(),_m=typeof location>"u"?void 0:location.origin,Ay=import.meta.url>"file:"&&import.meta.url<"file;",Bb=()=>{{if(Ay){let t=URL;return new URL(new t("ort.bundle.min.mjs",import.meta.url).href,_m).href}return import.meta.url}},An=Bb(),JC=()=>{if(An&&!An.startsWith("blob:"))return An.substring(0,An.lastIndexOf("/")+1)},jd=(t,e)=>{try{let n=e??An;return(n?new URL(t,n):new URL(t)).origin===_m}catch{return!1}},Fb=(t,e)=>{let n=e??An;try{return(n?new URL(t,n):new URL(t)).href}catch{return}},Wb=(t,e)=>`${e??"./"}${t}`,vm=async t=>{let e=await(await fetch(t,{credentials:"same-origin"})).blob();return URL.createObjectURL(e)},qb=async t=>(await import(t)).default,wm=(LU(),fc(GC)).default,XC=async()=>{if(!An)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(jd(An))return[void 0,wm()];let t=await vm(An);return[t,wm(t)]},bm=(zU(),fc(QC)).default,ZC=async(t,e,n,r)=>{let i=bm&&!(t||e);if(i)if(An)i=jd(An);else if(r&&!n)i=!0;else throw new Error("cannot determine the script source URL.");if(i)return[void 0,bm];{let s="ort-wasm-simd-threaded.jsep.mjs",a=t??Fb(s,e),o=n&&a&&!jd(a,e),l=o?await vm(a):a??Wb(s,e);return[o?l:void 0,await qb(l)]}}}),xm,Ud,Kl,Em,Hb,Gb,Kb,Fv,Ze,La=se(()=>{Bv(),Ud=!1,Kl=!1,Em=!1,Hb=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},Gb=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},Kb=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},Fv=async t=>{if(Ud)return Promise.resolve();if(Kl)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(Em)throw new Error("previous call to 'initializeWebAssembly()' failed.");Kl=!0;let e=t.initTimeout,n=t.numThreads;if(t.simd!==!1){if(t.simd==="relaxed"){if(!Kb())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!Gb())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let r=Hb();n>1&&!r&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+n+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),t.numThreads=n=1);let i=t.wasmPaths,s=typeof i=="string"?i:void 0,a=i==null?void 0:i.mjs,o=(a==null?void 0:a.href)??a,l=i==null?void 0:i.wasm,u=(l==null?void 0:l.href)??l,h=t.wasmBinary,[f,p]=await ZC(o,s,n>1,!!h||!!u),g=!1,_=[];if(e>0&&_.push(new Promise(x=>{setTimeout(()=>{g=!0,x()},e)})),_.push(new Promise((x,$)=>{let w={numThreads:n};if(h)w.wasmBinary=h;else if(u||s)w.locateFile=y=>u??s+y;else if(o&&o.indexOf("blob:")!==0)w.locateFile=y=>new URL(y,o).href;else if(f){let y=JC();y&&(w.locateFile=I=>y+I)}p(w).then(y=>{Kl=!1,Ud=!0,xm=y,x(),f&&URL.revokeObjectURL(f)},y=>{Kl=!1,Em=!0,$(y)})})),await Promise.race(_),g)throw new Error(`WebAssembly backend initializing failed due to timeout: ${e}ms`)},Ze=()=>{if(Ud&&xm)return xm;throw new Error("WebAssembly is not initialized yet.")}}),mr,gf,Ke,Wv=se(()=>{La(),mr=(t,e)=>{let n=Ze(),r=n.lengthBytesUTF8(t)+1,i=n._malloc(r);return n.stringToUTF8(t,i,r),e.push(i),i},gf=(t,e,n,r)=>{if(typeof t=="object"&&t!==null){if(n.has(t))throw new Error("Circular reference in options");n.add(t)}Object.entries(t).forEach(([i,s])=>{let a=e?e+i:i;if(typeof s=="object")gf(s,a+".",n,r);else if(typeof s=="string"||typeof s=="number")r(a,s.toString());else if(typeof s=="boolean")r(a,s?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof s}`)})},Ke=t=>{let e=Ze(),n=e.stackSave();try{let r=e.PTR_SIZE,i=e.stackAlloc(2*r);e._OrtGetLastError(i,i+r);let s=Number(e.getValue(i,r===4?"i32":"i64")),a=e.getValue(i+r,"*"),o=a?e.UTF8ToString(a):"";throw new Error(`${t} ERROR_CODE: ${s}, ERROR_MESSAGE: ${o}`)}finally{e.stackRestore(n)}}}),eA,VU=se(()=>{La(),Wv(),eA=t=>{let e=Ze(),n=0,r=[],i=t||{};try{if((t==null?void 0:t.logSeverityLevel)===void 0)i.logSeverityLevel=2;else if(typeof t.logSeverityLevel!="number"||!Number.isInteger(t.logSeverityLevel)||t.logSeverityLevel<0||t.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${t.logSeverityLevel}`);if((t==null?void 0:t.logVerbosityLevel)===void 0)i.logVerbosityLevel=0;else if(typeof t.logVerbosityLevel!="number"||!Number.isInteger(t.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${t.logVerbosityLevel}`);(t==null?void 0:t.terminate)===void 0&&(i.terminate=!1);let s=0;return(t==null?void 0:t.tag)!==void 0&&(s=mr(t.tag,r)),n=e._OrtCreateRunOptions(i.logSeverityLevel,i.logVerbosityLevel,!!i.terminate,s),n===0&&Ke("Can't create run options."),(t==null?void 0:t.extra)!==void 0&&gf(t.extra,"",new WeakSet,(a,o)=>{let l=mr(a,r),u=mr(o,r);e._OrtAddRunConfigEntry(n,l,u)!==0&&Ke(`Can't set a run config entry: ${a} - ${o}.`)}),[n,r]}catch(s){throw n!==0&&e._OrtReleaseRunOptions(n),r.forEach(a=>e._free(a)),s}}}),Qb,Yb,Jb,Ql,Xb,tA,jU=se(()=>{La(),Wv(),Qb=t=>{switch(t){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${t}`)}},Yb=t=>{switch(t){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${t}`)}},Jb=t=>{t.extra||(t.extra={}),t.extra.session||(t.extra.session={});let e=t.extra.session;e.use_ort_model_bytes_directly||(e.use_ort_model_bytes_directly="1"),t.executionProviders&&t.executionProviders.some(n=>(typeof n=="string"?n:n.name)==="webgpu")&&(t.enableMemPattern=!1)},Ql=(t,e,n,r)=>{let i=mr(e,r),s=mr(n,r);Ze()._OrtAddSessionConfigEntry(t,i,s)!==0&&Ke(`Can't set a session config entry: ${e} - ${n}.`)},Xb=async(t,e,n)=>{for(let r of e){let i=typeof r=="string"?r:r.name,s=[];switch(i){case"webnn":if(i="WEBNN",typeof r!="string"){let h=r==null?void 0:r.deviceType;h&&Ql(t,"deviceType",h,n)}break;case"webgpu":if(i="JS",typeof r!="string"){let h=r;if(h!=null&&h.preferredLayout){if(h.preferredLayout!=="NCHW"&&h.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${h.preferredLayout}`);Ql(t,"preferredLayout",h.preferredLayout,n)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${i}`)}let a=mr(i,n),o=s.length,l=0,u=0;if(o>0){l=Ze()._malloc(o*Ze().PTR_SIZE),n.push(l),u=Ze()._malloc(o*Ze().PTR_SIZE),n.push(u);for(let h=0;h<o;h++)Ze().setValue(l+h*Ze().PTR_SIZE,s[h][0],"*"),Ze().setValue(u+h*Ze().PTR_SIZE,s[h][1],"*")}await Ze()._OrtAppendExecutionProvider(t,a,l,u,o)!==0&&Ke(`Can't append execution provider: ${i}.`)}},tA=async t=>{let e=Ze(),n=0,r=[],i=t||{};Jb(i);try{let s=Qb(i.graphOptimizationLevel??"all"),a=Yb(i.executionMode??"sequential"),o=typeof i.logId=="string"?mr(i.logId,r):0,l=i.logSeverityLevel??2;if(!Number.isInteger(l)||l<0||l>4)throw new Error(`log severity level is not valid: ${l}`);let u=i.logVerbosityLevel??0;if(!Number.isInteger(u)||u<0||u>4)throw new Error(`log verbosity level is not valid: ${u}`);let h=typeof i.optimizedModelFilePath=="string"?mr(i.optimizedModelFilePath,r):0;if(n=e._OrtCreateSessionOptions(s,!!i.enableCpuMemArena,!!i.enableMemPattern,a,!!i.enableProfiling,0,o,l,u,h),n===0&&Ke("Can't create session options."),i.executionProviders&&await Xb(n,i.executionProviders,r),i.enableGraphCapture!==void 0){if(typeof i.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${i.enableGraphCapture}`);Ql(n,"enableGraphCapture",i.enableGraphCapture.toString(),r)}if(i.freeDimensionOverrides)for(let[f,p]of Object.entries(i.freeDimensionOverrides)){if(typeof f!="string")throw new Error(`free dimension override name must be a string: ${f}`);if(typeof p!="number"||!Number.isInteger(p)||p<0)throw new Error(`free dimension override value must be a non-negative integer: ${p}`);let g=mr(f,r);e._OrtAddFreeDimensionOverride(n,g,p)!==0&&Ke(`Can't set a free dimension override: ${f} - ${p}.`)}return i.extra!==void 0&&gf(i.extra,"",new WeakSet,(f,p)=>{Ql(n,f,p,r)}),[n,r]}catch(s){throw n!==0&&e._OrtReleaseSessionOptions(n)!==0&&Ke("Can't release session options."),r.forEach(a=>e._free(a)),s}}}),ra,hi,ia,op,yf,qv,Hv,Ry,$e=se(()=>{ra=t=>{switch(t){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${t}`)}},hi=t=>{switch(t){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${t}`)}},ia=(t,e)=>{let n=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][t],r=typeof e=="number"?e:e.reduce((i,s)=>i*s,1);return n>0?Math.ceil(r*n):void 0},op=t=>{switch(t){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${t}`)}},yf=t=>{switch(t){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${t}`)}},qv=t=>t==="float32"||t==="float16"||t==="int32"||t==="int64"||t==="uint32"||t==="uint8"||t==="bool"||t==="uint4"||t==="int4",Hv=t=>t==="float32"||t==="float16"||t==="int32"||t==="int64"||t==="uint32"||t==="uint64"||t==="int8"||t==="uint8"||t==="bool"||t==="uint4"||t==="int4",Ry=t=>{switch(t){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${t}`)}}}),Gv,nA=se(()=>{Uv(),Gv=async t=>{if(typeof t=="string"){let e=await fetch(t);if(!e.ok)throw new Error(`failed to load external data file: ${t}`);let n=e.headers.get("Content-Length"),r=n?parseInt(n,10):0;if(r<1073741824)return new Uint8Array(await e.arrayBuffer());{if(!e.body)throw new Error(`failed to load external data file: ${t}, no response body.`);let i=e.body.getReader(),s;try{s=new ArrayBuffer(r)}catch(o){if(o instanceof RangeError){let l=Math.ceil(r/65536);s=new WebAssembly.Memory({initial:l,maximum:l}).buffer}else throw o}let a=0;for(;;){let{done:o,value:l}=await i.read();if(o)break;let u=l.byteLength;new Uint8Array(s,a,u).set(l),a+=u}return new Uint8Array(s,0,r)}}else return t instanceof Blob?new Uint8Array(await t.arrayBuffer()):t instanceof Uint8Array?t:new Uint8Array(t)}}),Zb,ex,tx,nx,Kv,rx,De,Ai=se(()=>{$e(),Zb=["V","I","W","E","F"],ex=(t,e)=>{console.log(`[${Zb[t]},${new Date().toISOString()}]${e}`)},Kv=(t,e)=>{tx=t,nx=e},rx=(t,e)=>{let n=yf(t),r=yf(tx);n>=r&&ex(n,typeof e=="function"?e():e)},De=(...t)=>{nx&&rx(...t)}}),ix,Ko,X,_f,rA,iA,sA,Ce=se(()=>{ix=class{static calcMatMulShape(t,e){return t[1]!==e[0]?void 0:[t[0],e[1]]}},Ko=class{static calcShape(t,e,n=!1){let r=t.length,i=e.length;if(r===0)return e;if(i===0)return t;let s=Math.max(t.length,e.length),a=new Array(s);if(n){if(r<2||i<2)return;let o=ix.calcMatMulShape([t[r-2],t[r-1]],[e[i-2],e[i-1]]);if(o===void 0)return;[a[s-2],a[s-1]]=o}for(let o=n?3:1;o<=s;o++){let l=r-o<0?1:t[r-o],u=i-o<0?1:e[i-o];if(l!==u&&l>1&&u>1)return;let h=Math.max(l,u);if(l&&u)a[s-o]=Math.max(l,u);else{if(h>1)return;a[s-o]=0}}return a}static isValidBroadcast(t,e){let n=t.length,r=e.length;if(n>r)return!1;for(let i=1;i<=n;i++)if(t[n-i]!==1&&t[n-i]!==e[r-i])return!1;return!0}},X=class xh{static size(e){return xh.getSizeFromDimensionRange(e,0,e.length)}static convertShape(e,n=4){let r=e.length;if(r===0)return[];let i=new Array(r),s=r-1;for(;s>=0;){if(e[s]%n===0){i[s]=e[s]/n;break}if(n%e[s]!==0)throw new Error("cannot convert shape");i[s]=1,n/=e[s],s--}for(s--;s>=0;s--)i[s]=e[s];return i}static sizeFromDimension(e,n){if(n<0||n>e.length)throw new Error(`invalid dimension of ${n} for sizeFromDimension as Tensor has ${e.length} dimensions.`);return xh.getSizeFromDimensionRange(e,n,e.length)}static sizeToDimension(e,n){if(n<0||n>e.length)throw new Error(`invalid dimension of ${n} for sizeToDimension as Tensor has ${e.length} dimensions.`);return xh.getSizeFromDimensionRange(e,0,n)}static getSizeFromDimensionRange(e,n,r){let i=1;for(let s=n;s<r;s++){if(e[s]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");i*=Number(e[s])}return i}static computeStrides(e){let n=e.length;if(n===0)return[];if(n===1)return[1];let r=new Array(n);r[n-1]=1,r[n-2]=e[n-1];for(let i=n-3;i>=0;--i)r[i]=r[i+1]*e[i+1];return r}static normalizeAxis(e,n){if(e<-n&&e>=n)throw new Error("unsupported axis for this operation.");return e<0?e+n:e}static normalizeAxes(e,n){return e.map(r=>this.normalizeAxis(r,n??e.length))}static sortBasedOnPerm(e,n){return n?n.map(r=>e[r]):e.slice().reverse()}static padShape(e,n){let r=e.length;return e.map((i,s)=>i+n[s]+n[s+r])}static areEqual(e,n){return e.length!==n.length?!1:e.every((r,i)=>r===n[i])}},_f=class yu{static adjustPoolAttributes(e,n,r,i,s,a){if(!e&&r.length!==n.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(e)for(let o=0;o<n.length-2;o++)o>=r.length?r.push(n[o+2]):r[o]=n[o+2];for(let o=0;o<r.length;o++)if(o<i.length){if(i[o]<0)throw new Error("strides should be greater than or equal to 1")}else i.push(1);for(let o=0;o<r.length;o++)if(o<s.length){if(s[o]<0)throw new Error("dilations should be greater than or equal to 1")}else s.push(1);for(let o=0;o<r.length*2;o++)if(o<a.length){if(a[o]<0)throw new Error("pad should be greater than or equal to 1")}else a.push(0);for(let o=0;o<r.length;o++){if(r[o]<=0)throw new Error("kernel shapes need to be greater than 0");if(a[o]>=r[o]||a[o+r.length]>=r[o])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(e,n,r,i,s,a,o){if(o){if(s.length!==2*(e.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(n.length!==e.length-2)throw new Error("length of strides should be the length of data dimensions");if(i.length!==e.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let l=0;l<e.length-2;l++)yu.adjustPadAndReturnShape(e[l+(a?1:2)],n[l],r[l],i[l],s,l,l+e.length-2,o)}}static computePoolOutputShape(e,n,r,i,s,a,o){if(n.length<=0)throw new Error("input shape must be of size greater than 0");let l=[n[0],n[1]];return yu.computeShapeHelper(e,n,l,r,i,s,a,o),l}static computeConvOutputShape(e,n,r,i,s,a,o){if(e.length<=0||n.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let l=[e[0],n[0]];return yu.computeShapeHelper(!1,e,l,r,i,s,a,o),l}static computeShapeHelper(e,n,r,i,s,a,o,l){if(e)for(let u=0;u<n.length-2;u++)r.push(1);else for(let u=0;u<n.length-2;u++)r.push(yu.adjustPadAndReturnShape(n[u+2],i[u],s[u],a[u],o,u,u+n.length-2,l))}static adjustPadAndReturnShape(e,n,r,i,s,a,o,l){let u=r*(i-1)+1;if(l&&l!=="NOTSET")switch(l){case"VALID":return s[a]=0,s[o]=0,Math.floor((e-u)/n+1);case"SAME_LOWER":case"SAME_UPPER":if(r!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let h=((e+n-1)/n-1)*n+i-e;return s[a]=Math.floor(l==="SAME_LOWER"?(h+1)/2:h/2),s[o]=h-s[a],Math.floor((e+h-i)/n+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((e+s[a]+s[o]-u)/n+1)}},rA=class{static getShapeOfGemmResult(t,e,n,r,i){if(t.length!==2||n.length!==2)throw new Error("shape need to be of size 2");let s,a,o;e?(s=t[1],a=t[0]):(s=t[0],a=t[1]);let l=-1;if(r?(o=n[0],l=1):(o=n[1],l=0),n[l]!==a)throw new Error("dimension mismatch");if(s<=0||o<=0||a<=0)throw new Error("invalid shape specified");if(i&&!Ko.isValidBroadcast(i,[s,o]))throw new Error("gemm: invalid bias shape for broadcast");return[s,o,a]}},iA=-34028234663852886e22,sA=34028234663852886e22}),Qv,aA=se(()=>{$e(),Qv=(t,e)=>new(op(e))(t)}),Tm,Ny,Im,sx,$m,ax,km,Sm,Cm,ox,oA,UU=se(()=>{$e(),Ai(),Tm=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),Ny=(t,e)=>{if(e==="int32")return t;let n=Tm.get(e);if(!n)throw new Error(`WebNN backend does not support data type: ${e}`);let r=n/8;if(t.byteLength%r!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${r}.`);let i=t.byteLength/r,s=new(op(e))(t.buffer,t.byteOffset,i);switch(e){case"int64":case"uint64":{let a=new Int32Array(i);for(let o=0;o<i;o++){let l=s[o];if(l>2147483647n||l<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");a[o]=Number(l)}return new Uint8Array(a.buffer)}case"int8":case"uint8":case"uint32":{if(e==="uint32"&&s.some(o=>o>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let a=Int32Array.from(s,Number);return new Uint8Array(a.buffer)}default:throw new Error(`Unsupported data conversion from ${e} to 'int32'`)}},Im=(t,e)=>{if(e==="int32")return t;if(t.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let n=t.byteLength/4,r=new Int32Array(t.buffer,t.byteOffset,n);switch(e){case"int64":{let i=BigInt64Array.from(r,BigInt);return new Uint8Array(i.buffer)}case"uint64":{if(r.some(s=>s<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let i=BigUint64Array.from(r,BigInt);return new Uint8Array(i.buffer)}case"int8":{if(r.some(s=>s<-128||s>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let i=Int8Array.from(r,Number);return new Uint8Array(i.buffer)}case"uint8":{if(r.some(i=>i<0||i>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(r,Number)}case"uint32":{if(r.some(s=>s<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let i=Uint32Array.from(r,Number);return new Uint8Array(i.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${e}`)}},sx=1,$m=()=>sx++,ax=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),km=(t,e)=>{let n=Tm.get(t);if(!n)throw new Error(`WebNN backend does not support data type: ${t}`);return e.length>0?Math.ceil(e.reduce((r,i)=>r*i)*n/8):0},Sm=class{constructor(t){this.isDataConverted=!1;let{sessionId:e,context:n,tensor:r,dataType:i,shape:s,fallbackDataType:a}=t;this.sessionId=e,this.mlContext=n,this.mlTensor=r,this.dataType=i,this.tensorShape=s,this.fallbackDataType=a}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return km(this.dataType,this.tensorShape)}destroy(){De("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(t){this.mlContext.writeTensor(this.mlTensor,t)}async read(t){if(this.fallbackDataType){let e=await this.mlContext.readTensor(this.mlTensor),n=Im(new Uint8Array(e),this.dataType);if(t){(t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)).set(n);return}else return n.buffer}else return t?this.mlContext.readTensor(this.mlTensor,t):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(t,e,n){return this.mlContext===t&&this.dataType===e&&this.tensorShape.length===n.length&&this.tensorShape.every((r,i)=>r===n[i])}setIsDataConverted(t){this.isDataConverted=t}},Cm=class{constructor(t,e){this.tensorManager=t,this.wrapper=e}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(t,e,n,r){let i=this.tensorManager.getMLContext(t),s;if(!i.opSupportLimits().input.dataTypes.includes(e)){if(s=ax.get(e),!s||!i.opSupportLimits().input.dataTypes.includes(s))throw new Error(`WebNN backend does not support data type: ${e}`);De("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${e} to ${s}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(i,e,n))return this.wrapper.tensor;if(r){if(this.wrapper.byteLength!==km(e,n))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let a=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(t,e,n,a,!0,!0,s),r&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(t){let e=t;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")e=Ny(t,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(t.byteLength===this.wrapper.byteLength){this.wrapper.write(e);return}else De("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(e):this.activeUpload=new Uint8Array(e)}async download(t){var e,n;if(this.activeUpload){let r=(e=this.wrapper)!=null&&e.isDataConverted?Im(this.activeUpload,(n=this.wrapper)==null?void 0:n.type):this.activeUpload;if(t){t instanceof ArrayBuffer?new Uint8Array(t).set(r):new Uint8Array(t.buffer,t.byteOffset,t.byteLength).set(r);return}else return r.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return t?this.wrapper.read(t):this.wrapper.read()}},ox=class{constructor(t){this.backend=t,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(t){let e=this.backend.getMLContext(t);if(!e)throw new Error("MLContext not found for session.");return e}reserveTensorId(){let t=$m();return this.tensorTrackersById.set(t,new Cm(this)),t}releaseTensorId(t){let e=this.tensorTrackersById.get(t);e&&(this.tensorTrackersById.delete(t),e.tensorWrapper&&this.releaseTensor(e.tensorWrapper))}async ensureTensor(t,e,n,r,i){De("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${e}, dataType: ${n}, shape: ${r}, copyOld: ${i}}`);let s=this.tensorTrackersById.get(e);if(!s)throw new Error("Tensor not found.");return s.ensureTensor(t,n,r,i)}upload(t,e){let n=this.tensorTrackersById.get(t);if(!n)throw new Error("Tensor not found.");n.upload(e)}async download(t,e){De("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${t}, dstBuffer: ${e==null?void 0:e.byteLength}}`);let n=this.tensorTrackersById.get(t);if(!n)throw new Error("Tensor not found.");return n.download(e)}releaseTensorsForSession(t){for(let e of this.freeTensors)e.sessionId===t&&e.destroy();this.freeTensors=this.freeTensors.filter(e=>e.sessionId!==t)}registerTensor(t,e,n,r){let i=this.getMLContext(t),s=$m(),a=new Sm({sessionId:t,context:i,tensor:e,dataType:n,shape:r});return this.tensorTrackersById.set(s,new Cm(this,a)),this.externalTensors.add(a),s}async getCachedTensor(t,e,n,r,i,s,a){let o=this.getMLContext(t);for(let[u,h]of this.freeTensors.entries())if(h.canReuseTensor(o,e,n)){De("verbose",()=>`[WebNN] Reusing tensor {dataType: ${e}, ${a?`fallbackDataType: ${a},`:""} shape: ${n}`);let f=this.freeTensors.splice(u,1)[0];return f.sessionId=t,f}De("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${e}, ${a?`fallbackDataType: ${a},`:""} shape: ${n}}`);let l=await o.createTensor({dataType:a??e,shape:n,dimensions:n,usage:r,writable:i,readable:s});return new Sm({sessionId:t,context:o,tensor:l,dataType:e,shape:n,fallbackDataType:a})}releaseTensor(t){this.externalTensors.has(t)&&this.externalTensors.delete(t),this.freeTensors.push(t)}},oA=(...t)=>new ox(...t)}),Yl,lx,lA,BU=se(()=>{$e(),La(),aA(),UU(),Ai(),Yl=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),lx=(t,e)=>{if(t===e)return!0;if(t===void 0||e===void 0)return!1;let n=Object.keys(t).sort(),r=Object.keys(e).sort();return n.length===r.length&&n.every((i,s)=>i===r[s]&&t[i]===e[i])},lA=class{constructor(t){this.tensorManager=oA(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,Kv(t.logLevel,!!t.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(t){De("verbose",()=>`[WebNN] onRunStart {sessionId: ${t}}`),this.activeSessionId=t}onRunEnd(t){De("verbose",()=>`[WebNN] onRunEnd {sessionId: ${t}}`);let e=this.temporarySessionTensorIds.get(t);if(e){for(let n of e)De("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${n}}`),this.tensorManager.releaseTensorId(n);this.temporarySessionTensorIds.delete(t),this.activeSessionId=void 0}}async createMLContext(t){if(t instanceof GPUDevice){let n=this.mlContextCache.findIndex(r=>r.gpuDevice===t);if(n!==-1)return this.mlContextCache[n].mlContext;{let r=await navigator.ml.createContext(t);return this.mlContextCache.push({gpuDevice:t,mlContext:r}),r}}else if(t===void 0){let n=this.mlContextCache.findIndex(r=>r.options===void 0&&r.gpuDevice===void 0);if(n!==-1)return this.mlContextCache[n].mlContext;{let r=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:r}),r}}let e=this.mlContextCache.findIndex(n=>lx(n.options,t));if(e!==-1)return this.mlContextCache[e].mlContext;{let n=await navigator.ml.createContext(t);return this.mlContextCache.push({options:t,mlContext:n}),n}}registerMLContext(t,e){this.mlContextBySessionId.set(t,e);let n=this.sessionIdsByMLContext.get(e);n||(n=new Set,this.sessionIdsByMLContext.set(e,n)),n.add(t),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(t,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(t,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(t){this.sessionGraphInputs.delete(t),this.sessionGraphOutputs.delete(t);let e=this.mlContextBySessionId.get(t);if(!e)return;this.tensorManager.releaseTensorsForSession(t),this.mlContextBySessionId.delete(t);let n=this.sessionIdsByMLContext.get(e);if(n.delete(t),n.size===0){this.sessionIdsByMLContext.delete(e);let r=this.mlContextCache.findIndex(i=>i.mlContext===e);r!==-1&&this.mlContextCache.splice(r,1)}}getMLContext(t){return this.mlContextBySessionId.get(t)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(t){De("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${t}}`),this.tensorManager.releaseTensorId(t)}async ensureTensor(t,e,n,r,i){let s=Yl.get(n);if(!s)throw new Error(`Unsupported ONNX data type: ${n}`);return this.tensorManager.ensureTensor(t??this.currentSessionId,e,s,r,i)}async createTemporaryTensor(t,e,n){De("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${e}, shape: ${n}}`);let r=Yl.get(e);if(!r)throw new Error(`Unsupported ONNX data type: ${e}`);let i=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(t,i,r,n,!1);let s=this.temporarySessionTensorIds.get(t);return s?s.push(i):this.temporarySessionTensorIds.set(t,[i]),i}uploadTensor(t,e){if(!Ze().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");De("verbose",()=>`[WebNN] uploadTensor {tensorId: ${t}, data: ${e.byteLength}}`),this.tensorManager.upload(t,e)}async downloadTensor(t,e){return this.tensorManager.download(t,e)}createMLTensorDownloader(t,e){return async()=>{let n=await this.tensorManager.download(t);return Qv(n,e)}}registerMLTensor(t,e,n,r){let i=Yl.get(n);if(!i)throw new Error(`Unsupported ONNX data type: ${n}`);let s=this.tensorManager.registerTensor(t,e,i,r);return De("verbose",()=>`[WebNN] registerMLTensor {tensor: ${e}, dataType: ${i}, dimensions: ${r}} -> {tensorId: ${s}}`),s}registerMLConstant(t,e,n,r,i,s,a=!1){if(!s)throw new Error("External mounted files are not available.");let o=t;t.startsWith("./")&&(o=t.substring(2));let l=s.get(o);if(!l)throw new Error(`File with name ${o} not found in preloaded files.`);if(e+n>l.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let u=l.slice(e,e+n).buffer,h;switch(i.dataType){case"float32":h=new Float32Array(u);break;case"float16":h=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(u):new Uint16Array(u);break;case"int32":h=new Int32Array(u);break;case"uint32":h=new Uint32Array(u);break;case"int64":if(a){let f=Ny(new Uint8Array(u),"int64");h=new Int32Array(f.buffer),i.dataType="int32"}else h=new BigInt64Array(u);break;case"uint64":h=new BigUint64Array(u);break;case"int8":h=new Int8Array(u);break;case"int4":case"uint4":case"uint8":h=new Uint8Array(u);break;default:throw new Error(`Unsupported data type: ${i.dataType} in creating WebNN Constant from external data.`)}return De("verbose",()=>`[WebNN] registerMLConstant {dataType: ${i.dataType}, shape: ${i.shape}}} ${a?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),r.constant(i,h)}registerGraphInput(t){this.temporaryGraphInputs.push(t)}registerGraphOutput(t){this.temporaryGraphOutputs.push(t)}isGraphInput(t,e){let n=this.sessionGraphInputs.get(t);return n?n.includes(e):!1}isGraphOutput(t,e){let n=this.sessionGraphOutputs.get(t);return n?n.includes(e):!1}isGraphInputOutputTypeSupported(t,e,n=!0){let r=this.mlContextBySessionId.get(t),i=Yl.get(ra(e));return typeof i>"u"?!1:n?!!(r!=null&&r.opSupportLimits().input.dataTypes.includes(i)):!!(r!=null&&r.opSupportLimits().output.dataTypes.includes(i))}flush(){}}}),Yv=se(()=>{}),Am,Bd,Fd,ux,cx,Rm,Py,dx,uA,FU=se(()=>{Ai(),Yv(),Am=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),Bd=[],Fd=t=>Math.ceil(Number(t)/16)*16,ux=t=>{for(let e=0;e<Bd.length;e++){let n=Bd[e];if(t<=n)return n}return Math.ceil(t/16)*16},cx=1,Rm=()=>cx++,Py=async(t,e,n,r)=>{let i=Fd(n),s=t.device.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let a=t.getCommandEncoder();t.endComputePass(),a.copyBufferToBuffer(e,0,s,0,i),t.flush(),await s.mapAsync(GPUMapMode.READ);let o=s.getMappedRange();if(r){let l=r();return l.set(new Uint8Array(o,0,n)),l}else return new Uint8Array(o.slice(0,n))}finally{s.destroy()}},dx=class{constructor(t){this.backend=t,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[e]of Am)Bd.push(e),this.freeBuffers.set(e,[]),this.freeUniformBuffers.set(e,[]);this.sessionCount=0}upload(t,e){let n=e.buffer,r=e.byteOffset,i=e.byteLength,s=Fd(i),a=this.storageCache.get(t);if(!a)throw new Error("gpu data for uploading does not exist");if(Number(a.originalSize)!==i)throw new Error(`inconsistent data size. gpu data size=${a.originalSize}, data size=${i}`);let o=this.backend.device.createBuffer({mappedAtCreation:!0,size:s,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),l=o.getMappedRange();new Uint8Array(l).set(new Uint8Array(n,r,i)),o.unmap();let u=this.backend.device.createCommandEncoder();u.copyBufferToBuffer(o,0,a.gpuData.buffer,0,s),this.backend.device.queue.submit([u.finish()]),o.destroy(),De("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${t})`)}memcpy(t,e){let n=this.storageCache.get(t);if(!n)throw new Error("source gpu data for memcpy does not exist");let r=this.storageCache.get(e);if(!r)throw new Error("destination gpu data for memcpy does not exist");if(n.originalSize!==r.originalSize)throw new Error("inconsistent source and destination gpu data size");let i=Fd(n.originalSize),s=this.backend.getCommandEncoder();this.backend.endComputePass(),s.copyBufferToBuffer(n.gpuData.buffer,0,r.gpuData.buffer,0,i)}registerExternalBuffer(t,e,n){let r;if(n){if(r=n[0],t===n[1])return De("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${e}) => id=${r}, buffer is the same, skip.`),r;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else r=Rm();return this.storageCache.set(r,{gpuData:{id:r,type:0,buffer:t},originalSize:e}),De("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${e}) => id=${r}, registered.`),r}unregisterExternalBuffer(t){t!==void 0&&(this.storageCache.delete(t),De("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${t}`))}create(t,e=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let n=ux(t),r,i=(e&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,s=(e&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(i||s){let o=(i?this.freeBuffers:this.freeUniformBuffers).get(n);o?o.length>0?r=o.pop():r=this.backend.device.createBuffer({size:n,usage:e}):r=this.backend.device.createBuffer({size:n,usage:e})}else r=this.backend.device.createBuffer({size:n,usage:e});let a={id:Rm(),type:0,buffer:r};return this.storageCache.set(a.id,{gpuData:a,originalSize:Number(t)}),De("verbose",()=>`[WebGPU] GpuDataManager.create(size=${t}) => id=${a.id}`),a}get(t){var e;return(e=this.storageCache.get(t))==null?void 0:e.gpuData}release(t){let e=typeof t=="bigint"?Number(t):t,n=this.storageCache.get(e);if(!n){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return De("verbose",()=>`[WebGPU] GpuDataManager.release(id=${e}), gpuDataId=${n.gpuData.id}`),this.storageCache.delete(e),this.buffersPending.push(n.gpuData.buffer),n.originalSize}async download(t,e){let n=this.storageCache.get(Number(t));if(!n)throw new Error("data does not exist");await Py(this.backend,n.gpuData.buffer,n.originalSize,e)}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let t of this.buffersPending){let e=Am.get(t.size);if((t.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let n=this.freeBuffers.get(t.size)||[];e===void 0||n.length>=e?t.destroy():n.push(t)}else if((t.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let n=this.freeUniformBuffers.get(t.size)||[];e===void 0||n.length>=e?t.destroy():n.push(t)}else t.destroy()}this.buffersPending=[]}else{let t=this.capturedPendingBuffers.get(this.backend.currentSessionId);t||(t=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,t));for(let e of this.buffersPending)t.push(e);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(t=>{t.forEach(e=>{e.destroy()})}),this.freeUniformBuffers.forEach(t=>{t.forEach(e=>{e.destroy()})}),this.storageCache.forEach(t=>{t.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(t=>{t.forEach(e=>{e.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(t){let e=this.capturedPendingBuffers.get(t);e&&(e.forEach(n=>{n.destroy()}),this.capturedPendingBuffers.delete(t)),this.sessionCount-=1,this.sessionCount===0&&(De("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(n=>{n.gpuData.buffer.destroy()}),this.storageCache=new Map)}},uA=(...t)=>new dx(...t)}),hx,qe,yt=se(()=>{hx=class{constructor(t){Object.assign(this,t)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(t=>`${this[t]}`).join(";")),this.key}},qe=t=>new hx(t)}),Qo,Wd,Dt,tn,xe,ht,Oy,bo,bs,we,Jl,te,ye,cA,Jv,fx,dA,Ae=se(()=>{$e(),Ce(),Qo=64,Wd=(t,e)=>{if(e===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(t)){case 10:return e>1?`vec${e}<f16>`:"f16";case 1:return e>1?`vec${e}<f32>`:"f32";case 6:return e>1?`vec${e}<i32>`:"i32";case 12:return e>1?`vec${e}<u32>`:"u32";case 7:if(e>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(e>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(e!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${t}`)}},Dt=(t,e=1)=>{let n=Wd(t,e);return typeof n=="string"?n:n[0]},tn=(t,e=1)=>{let n=Wd(t,e);return typeof n=="string"?n:n[1]},xe=(...t)=>{let e=[];return t.forEach(n=>{n.length!==0&&e.push({type:12,data:n},{type:12,data:X.computeStrides(n)})}),e},ht=t=>t%4===0?4:t%2===0?2:1,Oy=(t="f32",e,n="0")=>!e||e===1?`${t}(${n})`:`vec${e}<${t}>(${n})`,bo=(t,e,n)=>t==="f32"?n:e===1?`f32(${n})`:`vec${e}<f32>(${n})`,bs=(t,e)=>e===4?`(${t}.x + ${t}.y + ${t}.z + ${t}.w)`:e===2?`(${t}.x + ${t}.y)`:e===3?`(${t}.x + ${t}.y + ${t}.z)`:t,we=(t,e,n,r)=>t.startsWith("uniforms.")&&n>4?typeof e=="string"?r==="f16"?`${t}[(${e}) / 8][(${e}) % 8 / 4][(${e}) % 8 % 4]`:`${t}[(${e}) / 4][(${e}) % 4]`:r==="f16"?`${t}[${Math.floor(e/8)}][${Math.floor(e%8/4)}][${e%8%4}]`:`${t}[${Math.floor(e/4)}][${e%4}]`:n>1?`${t}[${e}]`:t,Jl=(t,e,n,r,i)=>{let s=typeof n=="number",a=s?n:n.length,o=[...new Array(a).keys()],l=a<2?"u32":a<=4?`vec${a}<u32>`:`array<u32, ${a}>`,u=Wd(e,i),h=typeof u=="string"?u:u[1],f=typeof u=="string"?u:u[0],p={indices:l,value:h,storage:f,tensor:e},g=U=>typeof U=="string"?U:`${U}u`,_={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},x=s?"uniforms.":"",$=`${x}${t}_shape`,w=`${x}${t}_strides`,y="";for(let U=0;U<a-1;U++)y+=`
    let dim${U} = current / ${we(w,U,a)};
    let rest${U} = current % ${we(w,U,a)};
    indices[${U}] = dim${U};
    current = rest${U};
    `;y+=`indices[${a-1}] = current;`;let I=a<2?"":`
  fn o2i_${t}(offset: u32) -> ${p.indices} {
    var indices: ${p.indices};
    var current = offset;
    ${y}
    return indices;
  }`,R=U=>(_.offsetToIndices=!0,a<2?U:`o2i_${t}(${U})`),M=[];if(a>=2)for(let U=a-1;U>=0;U--)M.push(`${we(w,U,a)} * (indices[${U}])`);let j=a<2?"":`
  fn i2o_${t}(indices: ${p.indices}) -> u32 {
    return ${M.join("+")};
  }`,C=U=>(_.indicesToOffset=!0,a<2?U:`i2o_${t}(${U})`),k=(...U)=>a===0?"0u":`${p.indices}(${U.map(g).join(",")})`,P=(U,G)=>a<2?`${U}`:`${we(U,G,a)}`,A=(U,G,q)=>a<2?`${U}=${q};`:`${we(U,G,a)}=${q};`,D={},z=(U,G)=>{_.broadcastedIndicesToOffset=!0;let q=`${G.name}broadcastedIndicesTo${t}Offset`;if(q in D)return`${q}(${U})`;let Y=[];for(let ae=a-1;ae>=0;ae--){let Ee=G.indicesGet("outputIndices",ae+G.rank-a);Y.push(`${P(w,ae)} * (${Ee} % ${P($,ae)})`)}return D[q]=`fn ${q}(outputIndices: ${G.type.indices}) -> u32 {
             return ${Y.length>0?Y.join("+"):"0u"};
           }`,`${q}(${U})`},O=(U,G)=>(()=>{if(p.storage===p.value)return`${t}[${U}]=${G};`;if(p.storage==="vec2<u32>"&&p.value==="i32")return`${t}[${U}]=vec2<u32>(u32(${G}), select(0u, 0xFFFFFFFFu, ${G} < 0));`;if(p.storage==="vec2<u32>"&&p.value==="u32")return`${t}[${U}]=vec2<u32>(u32(${G}), 0u);`;if(p.storage==="u32"&&p.value==="vec4<bool>")return`${t}[${U}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${G}));`;throw new Error(`not supported combination of storage type ${p.storage} and value type ${p.value} yet`)})(),ce=U=>(()=>{if(p.storage===p.value)return`${t}[${U}]`;if(p.storage==="vec2<u32>"&&p.value==="i32")return`i32(${t}[${U}].x)`;if(p.storage==="vec2<u32>"&&p.value==="u32")return`u32(${t}[${U}].x)`;if(p.storage==="u32"&&p.value==="vec4<bool>")return`vec4<bool>(bool(${t}[${U}] & 0xFFu), bool(${t}[${U}] & 0xFF00u), bool(${t}[${U}] & 0xFF0000u), bool(${t}[${U}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${p.storage} and value type ${p.value} yet`)})(),de=a<2?"":`
  fn get_${t}ByIndices(indices: ${p.indices}) -> ${h} {
    return ${ce(`i2o_${t}(indices)`)};
  }`,ue=a<2?"":(()=>{let U=o.map(q=>`d${q}: u32`).join(", "),G=o.map(q=>`d${q}`).join(", ");return`
  fn get_${t}(${U}) -> ${h} {
    return get_${t}ByIndices(${k(G)});
  }`})(),pe=(...U)=>{if(U.length!==a)throw new Error(`indices length must be ${a}`);let G=U.map(g).join(",");return a===0?ce("0u"):a===1?ce(G[0]):(_.get=!0,_.getByIndices=!0,_.indicesToOffset=!0,`get_${t}(${G})`)},K=U=>a<2?ce(U):(_.getByIndices=!0,_.indicesToOffset=!0,`get_${t}ByIndices(${U})`),B=a<2?"":`
  fn set_${t}ByIndices(indices: ${p.indices}, value: ${h}) {
    ${O(`i2o_${t}(indices)`,"value")}
  }`,F=a<2?"":(()=>{let U=o.map(q=>`d${q}: u32`).join(", "),G=o.map(q=>`d${q}`).join(", ");return`
  fn set_${t}(${U}, value: ${h}) {
    set_${t}ByIndices(${k(G)}, value);
  }`})();return{impl:()=>{let U=[],G=!1;return _.offsetToIndices&&(U.push(I),G=!0),_.indicesToOffset&&(U.push(j),G=!0),_.broadcastedIndicesToOffset&&(Object.values(D).forEach(q=>U.push(q)),G=!0),_.set&&(U.push(F),G=!0),_.setByIndices&&(U.push(B),G=!0),_.get&&(U.push(ue),G=!0),_.getByIndices&&(U.push(de),G=!0),!s&&G&&U.unshift(`const ${$} = ${p.indices}(${n.join(",")});`,`const ${w} = ${p.indices}(${X.computeStrides(n).join(",")});`),U.join(`
`)},type:p,offsetToIndices:R,indicesToOffset:C,broadcastedIndicesToOffset:z,indices:k,indicesGet:P,indicesSet:A,set:(...U)=>{if(U.length!==a+1)throw new Error(`indices length must be ${a}`);let G=U[a];if(typeof G!="string")throw new Error("value must be string");let q=U.slice(0,a).map(g).join(",");return a===0?O("0u",G):a===1?O(q[0],G):(_.set=!0,_.setByIndices=!0,_.indicesToOffset=!0,`set_${t}(${q}, ${G})`)},setByOffset:O,setByIndices:(U,G)=>a<2?O(U,G):(_.setByIndices=!0,_.indicesToOffset=!0,`set_${t}ByIndices(${U}, ${G});`),get:pe,getByOffset:ce,getByIndices:K,usage:r,name:t,strides:w,shape:$,rank:a}},te=(t,e,n,r=1)=>Jl(t,e,n,"input",r),ye=(t,e,n,r=1)=>Jl(t,e,n,"output",r),cA=(t,e,n)=>Jl(t,e,n,"atomicOutput",1),Jv=(t,e,n,r=1)=>Jl(t,e,n,"internal",r),fx=class{constructor(t,e){this.normalizedDispatchGroup=t,this.limits=e,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(t){return`if (global_idx >= ${typeof t=="number"?`${t}u`:t}) { return; }`}mainStart(t=Qo){let e=typeof t=="number"?t:t[0],n=typeof t=="number"?1:t[1],r=typeof t=="number"?1:t[2];if(e>this.limits.maxComputeWorkgroupSizeX||n>this.limits.maxComputeWorkgroupSizeY||r>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${e}, ${n}, ${r}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(e*n*r>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${e}, ${n}, ${r}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let i=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,s=i?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,a=i?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${e*n*r}u + local_idx;`;return`@compute @workgroup_size(${e}, ${n}, ${r})
  fn main(${s}) {
    ${a}
  `}appendVariableUniforms(t){t.rank!==0&&(t.shape.startsWith("uniforms.")&&this.uniforms.push({name:t.shape.replace("uniforms.",""),type:"u32",length:t.rank}),t.strides.startsWith("uniforms.")&&this.uniforms.push({name:t.strides.replace("uniforms.",""),type:"u32",length:t.rank}))}declareVariable(t,e){if(t.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(t),this.appendVariableUniforms(t);let n=t.usage==="input"?"read":"read_write",r=t.usage==="atomicOutput"?"atomic<i32>":t.type.storage;return`@group(0) @binding(${e}) var<storage, ${n}> ${t.name}: array<${r}>;`}declareVariables(...t){return t.map(e=>this.declareVariable(e,this.variableIndex++)).join(`
`)}registerInternalVariable(t){if(t.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(t),this.appendVariableUniforms(t)}registerInternalVariables(...t){return t.forEach(e=>this.registerInternalVariable(e)),this}registerUniform(t,e,n=1){return this.uniforms.push({name:t,type:e,length:n}),this}registerUniforms(t){return this.uniforms=this.uniforms.concat(t),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let t=[];for(let{name:e,type:n,length:r}of this.uniforms)if(r&&r>4)n==="f16"?t.push(`@align(16) ${e}:array<mat2x4<${n}>, ${Math.ceil(r/8)}>`):t.push(`${e}:array<vec4<${n}>, ${Math.ceil(r/4)}>`);else{let i=r==null||r===1?n:`vec${r}<${n}>`;t.push(`${e}:${i}`)}return`
      struct Uniforms { ${t.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(t=>t.impl()).join(`
`)+this.internalVariables.map(t=>t.impl()).join(`
`)}get variablesInfo(){if(this.uniforms.length===0)return;let t=e=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(e)];return this.uniforms.map(e=>[t(e.type),e.length??1])}},dA=(t,e)=>new fx(t,e)}),px,Nm,mx,gx,yx,_x,Ln,hA,fA,Cs=se(()=>{$e(),Ce(),yt(),Ae(),px=(t,e)=>{if(!t||t.length!==1)throw new Error("Transpose requires 1 input.");if(e.length!==0&&e.length!==t[0].dims.length)throw new Error(`perm size ${e.length} does not match input rank ${t[0].dims.length}`)},Nm=(t,e)=>e.length!==0?e:[...new Array(t).keys()].reverse(),mx=(t,e)=>X.sortBasedOnPerm(t,Nm(t.length,e)),gx=(t,e,n,r)=>{let i=`fn perm(i: ${r.type.indices}) -> ${n.type.indices} {
    var a: ${n.type.indices};`;for(let s=0;s<e;++s)i+=`a[${t[s]}]=i[${s}];`;return i+="return a;}"},yx=(t,e)=>{let n=[],r=[];for(let i=0;i<t.length;++i)t[i]!==1&&n.push(t[i]),t[e[i]]!==1&&r.push(e[i]);return{newShape:n,newPerm:r}},_x=(t,e)=>{let n=0;for(let r=0;r<t.length;++r)if(e[t[r]]!==1){if(t[r]<n)return!1;n=t[r]}return!0},Ln=(t,e)=>{let n=t.dataType,r=t.dims.length,i=Nm(r,e),s=mx(t.dims,i),a=t.dims,o=s,l=r<2||_x(i,t.dims),u;if(l)return u=_=>{let x=te("input",n,a,4),$=ye("output",n,o,4);return`
  ${_.registerUniform("output_size","u32").declareVariables(x,$)}
  ${_.mainStart()}
    ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let _=X.size(s);return{outputs:[{dims:s,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(_/64/4)},programUniforms:[{type:12,data:Math.ceil(_/4)}]}},getShaderSource:u};let{newShape:h,newPerm:f}=yx(t.dims,i),p=X.areEqual(f,[2,3,1]),g=X.areEqual(f,[3,1,2]);if(h.length===2||p||g){a=p?[h[0],h[1]*h[2]]:g?[h[0]*h[1],h[2]]:h,o=[a[1],a[0]];let _=16;return u=x=>{let $=te("a",n,a.length),w=ye("output",n,o.length);return`
  ${x.registerUniform("output_size","u32").declareVariables($,w)}
  var<workgroup> tile : array<array<${w.type.value}, ${_+1}>, ${_}>;
  ${x.mainStart([_,_,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${_} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${_}u + local_id.x;
    let input_row = workgroup_id_x * ${_}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${$.getByIndices(`${$.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${_}u + local_id.x;
    let output_row = workgroup_id_y * ${_}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${w.setByIndices(`${w.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let x=X.size(s);return{outputs:[{dims:s,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(o[1]/_),y:Math.ceil(o[0]/_)},programUniforms:[{type:12,data:x},...xe(a,o)]}},getShaderSource:u}}return u=_=>{let x=te("a",n,a.length),$=ye("output",n,o.length);return`
  ${_.registerUniform("output_size","u32").declareVariables(x,$)}

  ${gx(i,r,x,$)}

  ${_.mainStart()}
    ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${$.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${$.setByOffset("global_idx",x.getByIndices("aIndices"))}
  }`},{name:"Transpose",shaderCache:{hint:`${e}`,inputDependencies:["rank"]},getRunData:()=>{let _=X.size(s);return{outputs:[{dims:s,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(_/64)},programUniforms:[{type:12,data:_},...xe(a,o)]}},getShaderSource:u}},hA=(t,e)=>{px(t.inputs,e.perm),t.compute(Ln(t.inputs[0],e.perm))},fA=t=>qe({perm:t.perm})}),vx,wx,bx,xx,Ex,Tx,Ix,$x,kx,Sx,or,pA,mA,gA,yA,_A,vA,wA,bA,xA,EA,WU=se(()=>{$e(),Ce(),Ae(),Xv(),Cs(),vx={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},wx={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},bx={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},xx={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},Ex=(t,e)=>{let n=[];for(let r=e-t;r<e;++r)n.push(r);return n},Tx=(t,e)=>{let n=[],r=t.length;for(let s=0;s<r;s++)e.indexOf(s)===-1&&n.push(t[s]);let i=e.map(s=>t[s]);return[n,i]},Ix=(t,e)=>{let n=t.length+e.length,r=[],i=0;for(let s=0;s<n;s++)e.indexOf(s)===-1?r.push(t[i++]):r.push(1);return r},$x=(t,e)=>{for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0},kx=(t,e)=>{let n=[];if(!$x(t,e)){for(let r=0;r<e;++r)t.indexOf(r)===-1&&n.push(r);t.forEach(r=>n.push(r))}return n},Sx=(t,e,n,r,i,s,a)=>{let o=n[0].dims,l=X.size(s),u=X.size(a),h=te("_A",n[0].dataType,o),f=ye("output",i,s),p=64;l===1&&(p=256);let g=`
          var<workgroup> aBestValues : array<f32, ${p}>;
       `,_=x=>`
        ${x.registerUniform("reduceSize","u32").declareVariables(h,f)}
        ${g}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${x.mainStart(p)}

          let outputIndex = global_idx / ${p};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${bx[r]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${p}) {
           let candidate = f32(${h.getByOffset("offset + k")});
           bestValue = ${vx[r]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${p}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${wx[r]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${f.setByOffset("outputIndex",`${r==="mean"?`${f.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${f.type.storage}(${xx[r]})`}`)};
         }
        }`;return{name:t,shaderCache:{hint:`${e};${p}`,inputDependencies:["type"]},getShaderSource:_,getRunData:()=>({outputs:[{dims:s,dataType:i}],dispatchGroup:{x:l},programUniforms:[{type:12,data:u}]})}},or=(t,e,n,r)=>{let i=t.inputs.length===1?n:Dy(t.inputs,n),s=i.axes;s.length===0&&!i.noopWithEmptyAxes&&(s=t.inputs[0].dims.map((g,_)=>_));let a=X.normalizeAxes(s,t.inputs[0].dims.length),o=a,l=t.inputs[0],u=kx(o,t.inputs[0].dims.length);u.length>0&&(l=t.compute(Ln(t.inputs[0],u),{inputs:[0],outputs:[-1]})[0],o=Ex(o.length,l.dims.length));let[h,f]=Tx(l.dims,o),p=h;i.keepDims&&(p=Ix(h,a)),t.compute(Sx(e,i.cacheKey,[l],r,t.inputs[0].dataType,p,f),{inputs:[l]})},pA=(t,e)=>{or(t,"ReduceMeanShared",e,"mean")},mA=(t,e)=>{or(t,"ReduceL1Shared",e,"l1")},gA=(t,e)=>{or(t,"ReduceL2Shared",e,"l2")},yA=(t,e)=>{or(t,"ReduceLogSumExpShared",e,"logSumExp")},_A=(t,e)=>{or(t,"ReduceMaxShared",e,"max")},vA=(t,e)=>{or(t,"ReduceMinShared",e,"min")},wA=(t,e)=>{or(t,"ReduceProdShared",e,"prod")},bA=(t,e)=>{or(t,"ReduceSumShared",e,"sum")},xA=(t,e)=>{or(t,"ReduceSumSquareShared",e,"sumSquare")},EA=(t,e)=>{or(t,"ReduceLogSumShared",e,"logSum")}}),lr,Cx,vf,Dy,ur,Ax,Rx,Nx,Px,Ox,Dx,Mx,Lx,zx,Vx,cr,TA,IA,$A,kA,SA,CA,AA,RA,NA,PA,Xv=se(()=>{$e(),Ce(),yt(),Ae(),WU(),lr=t=>{if(!t||t.length===0||t.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(t.length===2&&t[1].dims.length!==1)throw new Error("Invalid axes input dims.")},Cx=t=>["","",`var value = ${t.getByIndices("input_indices")};`,""],vf=(t,e,n,r,i,s,a=!1,o=!1)=>{let l=[],u=n[0].dims,h=u.length,f=X.normalizeAxes(i,h),p=!o&&f.length===0;u.forEach((x,$)=>{p||f.indexOf($)>=0?a&&l.push(1):l.push(x)});let g=l.length,_=X.size(l);return{name:t,shaderCache:e,getShaderSource:x=>{let $=[],w=te("_A",n[0].dataType,h),y=ye("output",s,g),I=r(w,y,f),R=I[2];for(let M=0,j=0;M<h;M++)p||f.indexOf(M)>=0?(a&&j++,R=`for(var j${M}: u32 = 0; j${M} < ${u[M]}; j${M}++) {
                  ${I[2].includes("last_index")?`let last_index = j${M};`:""}
                  ${w.indicesSet("input_indices",M,`j${M}`)}
                  ${R}
                }`):($.push(`${w.indicesSet("input_indices",M,y.indicesGet("output_indices",j))};`),j++);return`

        ${x.registerUniform("output_size","u32").declareVariables(w,y)}

        ${x.mainStart()}
          ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${w.type.indices};
          let output_indices = ${y.offsetToIndices("global_idx")};

          ${$.join(`
`)}
          ${I[0]}       // init ops for reduce max/min
          ${I[1]}
          ${R}
          ${I[3]}
          ${I.length===4?y.setByOffset("global_idx","value"):I.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:l,dataType:s}],dispatchGroup:{x:Math.ceil(_/64)},programUniforms:[{type:12,data:_},...xe(u,l)]})}},Dy=(t,e)=>{let n=[];return t[1].dims[0]>0&&t[1].getBigInt64Array().forEach(r=>n.push(Number(r))),qe({axes:n,keepDims:e.keepDims,noopWithEmptyAxes:e.noopWithEmptyAxes})},ur=(t,e,n,r)=>{let i=t.inputs,s=i.length===1?n:Dy(i,n);t.compute(vf(e,{hint:s.cacheKey,inputDependencies:["rank"]},[i[0]],s.noopWithEmptyAxes&&s.axes.length===0?Cx:r,s.axes,i[0].dataType,s.keepDims,s.noopWithEmptyAxes),{inputs:[0]})},Ax=(t,e)=>{lr(t.inputs),ur(t,"ReduceLogSum",e,(n,r)=>[`var value = ${r.type.storage}(0);`,"",`value += ${n.getByIndices("input_indices")};`,"value = log(value);"])},Rx=(t,e)=>{lr(t.inputs),ur(t,"ReduceL1",e,(n,r)=>[`var value = ${r.type.storage}(0);`,"",`value += abs(${n.getByIndices("input_indices")});`,""])},Nx=(t,e)=>{lr(t.inputs),ur(t,"ReduceL2",e,(n,r)=>[`var t = ${r.type.value}(0); var value = ${r.type.value}(0);`,"",`t = ${n.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},Px=(t,e)=>{lr(t.inputs),ur(t,"ReduceLogSumExp",e,(n,r)=>[`var value = ${r.type.storage}(0);`,"",`value += exp(${n.getByIndices("input_indices")});`,"value = log(value);"])},Ox=(t,e)=>{lr(t.inputs),ur(t,"ReduceMax",e,(n,r,i)=>{let s=[];for(let a=0;a<n.rank;a++)(i.indexOf(a)>=0||i.length===0)&&s.push(n.indicesSet("input_indices",a,0));return[`${s.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};`,`value = max(value, ${n.getByIndices("input_indices")});`,""]})},Dx=(t,e)=>{lr(t.inputs),ur(t,"ReduceMean",e,(n,r,i)=>{let s=1;for(let a=0;a<n.rank;a++)(i.indexOf(a)>=0||i.length===0)&&(s*=t.inputs[0].dims[a]);return["var sum = f32(0);","",`sum += f32(${n.getByIndices("input_indices")});`,`let value = ${r.type.value}(sum / ${s});`]})},Mx=(t,e)=>{lr(t.inputs),ur(t,"ReduceMin",e,(n,r,i)=>{let s=[];for(let a=0;a<n.rank;a++)(i.indexOf(a)>=0||i.length===0)&&s.push(`input_indices[${a}] = 0;`);return[`${s.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};`,`value = min(value, ${n.getByIndices("input_indices")});`,""]})},Lx=(t,e)=>{lr(t.inputs),ur(t,"ReduceProd",e,(n,r)=>[`var value = ${r.type.storage}(1);`,"",`value *= ${n.getByIndices("input_indices")};`,""])},zx=(t,e)=>{lr(t.inputs),ur(t,"ReduceSum",e,(n,r)=>[`var value = ${r.type.storage}(0);`,"",`value += ${n.getByIndices("input_indices")};`,""])},Vx=(t,e)=>{lr(t.inputs),ur(t,"ReduceSumSquare",e,(n,r)=>[`var t = ${r.type.value}(0); var value = ${r.type.value}(0);`,"",`t = ${n.getByIndices("input_indices")}; value += t * t;`,""])},cr=(t,e,n)=>{if(e.length===0)return n;let r=1,i=1;for(let s=0;s<e.length;s++)e.indexOf(s)===-1?r*=t[s]:i*=t[s];return i<32&&r>1024},TA=(t,e)=>{cr(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Dx(t,e):pA(t,e)},IA=(t,e)=>{cr(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Rx(t,e):mA(t,e)},$A=(t,e)=>{cr(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Nx(t,e):gA(t,e)},kA=(t,e)=>{cr(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Px(t,e):yA(t,e)},SA=(t,e)=>{cr(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Ox(t,e):_A(t,e)},CA=(t,e)=>{cr(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Mx(t,e):vA(t,e)},AA=(t,e)=>{cr(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Lx(t,e):wA(t,e)},RA=(t,e)=>{cr(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?zx(t,e):bA(t,e)},NA=(t,e)=>{cr(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Vx(t,e):xA(t,e)},PA=(t,e)=>{cr(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Ax(t,e):EA(t,e)}}),Pm,OA,DA,My,qU=se(()=>{$e(),yt(),Xv(),Pm=t=>{if(!t||t.length===0||t.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(t[0].dataType!==1)throw new Error("Invalid input type.")},OA=(t,e)=>{Pm(t.inputs);let n=(r,i,s)=>{let a=[];for(let o=0;o<r.rank;o++)(s.indexOf(o)>=0||s.length===0)&&a.push(`input_indices[${o}] = 0;`);return[`${a.join(`
`)}`,`var value = ${r.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${r.getByIndices("input_indices")} ${e.selectLastIndex>0?"<=":"<"} value) {
         value = ${r.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",i.setByOffset("global_idx","best_index")]};t.compute(vf("ArgMin",{hint:e.cacheKey,inputDependencies:["rank"]},[t.inputs[0]],n,[e.axis],7,e.keepDims),{inputs:[0]})},DA=(t,e)=>{Pm(t.inputs);let n=(r,i,s)=>{let a=[];for(let o=0;o<r.rank;o++)(s.indexOf(o)>=0||s.length===0)&&a.push(`input_indices[${o}] = 0;`);return[`${a.join(`
`)}`,`var value = ${r.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${r.getByIndices("input_indices")} ${e.selectLastIndex>0?">=":">"} value) {
         value = ${r.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",i.setByOffset("global_idx","best_index")]};t.compute(vf("argMax",{hint:e.cacheKey,inputDependencies:["rank"]},[t.inputs[0]],n,[e.axis],7,e.keepDims),{inputs:[0]})},My=t=>qe(t)}),jx,qd,Ux,Bx,Fx,pc,Wx,MA,Zv=se(()=>{$e(),Ce(),Yv(),Ae(),jx=(t,e)=>{let n=t[0],r=t[1],i=t[2],s=t[3],a=t[4],o=t[5];if(a&&o)throw new Error("Attention cannot have both past and attention_bias");if(n.dims.length!==3)throw new Error('Input "input" must have 3 dimensions');let l=n.dims[0],u=n.dims[1],h=n.dims[2];if(i.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimensions');if(r.dims.length!==2)throw new Error('Input "weights" is expected to have 2 dimensions');if(r.dims[0]!==h)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(i.dims[0]!==r.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let f=i.dims[0]/3,p=f,g=p;if(e.qkvHiddenSizes.length>0){if(e.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let I of e.qkvHiddenSizes)if(I%e.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");f=e.qkvHiddenSizes[0],p=e.qkvHiddenSizes[1],g=e.qkvHiddenSizes[2]}let _=u;if(f!==p)throw new Error("qkv_hidden_sizes first element should be same as the second");if(i.dims[0]!==f+p+g)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let x=0;if(a){if(p!==g)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(a.dims.length!==5)throw new Error('Input "past" must have 5 dimensions');if(a.dims[0]!==2)throw new Error('Input "past" first dimension must be 2');if(a.dims[1]!==l)throw new Error('Input "past" second dimension must be batch_size');if(a.dims[2]!==e.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(a.dims[4]!==p/e.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');e.pastPresentShareBuffer||(x=a.dims[3])}let $=_+x,w=-1,y=0;if(s)throw new Error("Mask not supported");if(a)throw new Error("past is not supported");if(o){if(o.dims.length!==4)throw new Error('Input "attention_bias" must have 4 dimensions');if(o.dims[0]!==l||o.dims[1]!==e.numHeads||o.dims[2]!==u||o.dims[3]!==$)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:l,sequenceLength:u,pastSequenceLength:x,kvSequenceLength:_,totalSequenceLength:$,maxSequenceLength:w,inputHiddenSize:h,hiddenSize:f,vHiddenSize:g,headSize:Math.floor(f/e.numHeads),vHeadSize:Math.floor(g/e.numHeads),numHeads:e.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:e.maskFilterValue,maskType:y,scale:e.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},qd=(t,e,n)=>e&&t?`
      let total_sequence_length_input = u32(${e.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${t==null?void 0:t.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${n?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,Ux=(t,e,n,r,i,s,a,o)=>{let l=ht(a?1:s),u=64,h=s/l;h<u&&(u=32);let f=Math.ceil(s/l/u),p=[{type:12,data:e},{type:12,data:n},{type:12,data:r},{type:12,data:i},{type:12,data:h},{type:12,data:f}],g=Dt(t.dataType,l),_=tn(1,l),x=["type"];a&&x.push("type"),o&&x.push("type");let $=w=>{let y=ye("x",t.dataType,t.dims,l),I=[y],R=a?te("seq_lens",a.dataType,a.dims):void 0;R&&I.push(R);let M=o?te("total_sequence_length_input",o.dataType,o.dims):void 0;M&&I.push(M);let j=tn(t.dataType),C=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${u}>;
  var<workgroup> thread_sum: array<f32, ${u}>;
  ${w.registerUniforms(C).declareVariables(...I)}
  ${w.mainStart([u,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${qd(R,M,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${u}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${a?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${_}(-3.402823e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${_}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(l){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${l}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.402823e+38f);
    for (var i = 0u; i < ${u}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${_}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${_}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(l){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${l}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${u}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${y.type.value}(${j}(1.0) / ${j}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${_}(x[offset + i]);
        x[offset + i] = ${y.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${a?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${y.type.value}(${j}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${u};${g};${l}`,inputDependencies:x},getShaderSource:$,getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:i,z:e*n},programUniforms:p})}},Bx=(t,e,n,r,i,s,a,o,l)=>{let u=a+s.kvSequenceLength,h=[s.batchSize,s.numHeads,s.sequenceLength,u],f=t>1&&r,p=s.kvNumHeads?s.kvNumHeads:s.numHeads,g=f?[s.batchSize,p,u,s.headSize]:void 0,_=s.nReps?s.nReps:1,x=s.scale===0?1/Math.sqrt(s.headSize):s.scale,$=ht(s.headSize),w=s.headSize/$,y=12,I={x:Math.ceil(u/y),y:Math.ceil(s.sequenceLength/y),z:s.batchSize*s.numHeads},R=[{type:12,data:s.sequenceLength},{type:12,data:w},{type:12,data:u},{type:12,data:s.numHeads},{type:12,data:s.headSize},{type:1,data:x},{type:12,data:a},{type:12,data:s.kvSequenceLength},{type:12,data:_}],M=f&&r&&X.size(r.dims)>0,j=["type","type"];M&&j.push("type"),i&&j.push("type"),o&&j.push("type"),l&&j.push("type");let C=[{dims:h,dataType:e.dataType,gpuDataType:0}];f&&C.push({dims:g,dataType:e.dataType,gpuDataType:0});let k=P=>{let A=te("q",e.dataType,e.dims,$),D=te("key",n.dataType,n.dims,$),z=[A,D];if(M){let B=te("past_key",r.dataType,r.dims,$);z.push(B)}i&&z.push(te("attention_bias",i.dataType,i.dims));let O=o?te("seq_lens",o.dataType,o.dims):void 0;O&&z.push(O);let ce=l?te("total_sequence_length_input",l.dataType,l.dims):void 0;ce&&z.push(ce);let de=ye("output",e.dataType,h),ue=[de];f&&ue.push(ye("present_key",e.dataType,g,$));let pe=tn(1,$),K=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${y}u;

  var<workgroup> tileQ: array<${A.type.storage}, ${y*y}>;
  var<workgroup> tileK: array<${A.type.storage}, ${y*y}>;
  ${P.registerUniforms(K).declareVariables(...z,...ue)}
  ${P.mainStart([y,y,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${_===1?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${_===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${qd(O,ce,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${M&&f?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${f?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${pe}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${M&&f?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${f?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${pe}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch($){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${$}`)}})()};
        output[outputIdx] = ${de.type.value} (sum * uniforms.alpha) + ${i?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${$};${i!==void 0};${r!==void 0};${t}`,inputDependencies:j},getRunData:()=>({outputs:C,dispatchGroup:I,programUniforms:R}),getShaderSource:k}},Fx=(t,e,n,r,i,s,a=void 0,o=void 0)=>{let l=s+i.kvSequenceLength,u=i.nReps?i.nReps:1,h=i.vHiddenSize*u,f=t>1&&r,p=i.kvNumHeads?i.kvNumHeads:i.numHeads,g=f?[i.batchSize,p,l,i.headSize]:void 0,_=[i.batchSize,i.sequenceLength,h],x=12,$={x:Math.ceil(i.vHeadSize/x),y:Math.ceil(i.sequenceLength/x),z:i.batchSize*i.numHeads},w=[{type:12,data:i.sequenceLength},{type:12,data:l},{type:12,data:i.vHeadSize},{type:12,data:i.numHeads},{type:12,data:i.headSize},{type:12,data:h},{type:12,data:s},{type:12,data:i.kvSequenceLength},{type:12,data:u}],y=f&&r&&X.size(r.dims)>0,I=["type","type"];y&&I.push("type"),a&&I.push("type"),o&&I.push("type");let R=[{dims:_,dataType:e.dataType,gpuDataType:0}];f&&R.push({dims:g,dataType:e.dataType,gpuDataType:0});let M=j=>{let C=te("probs",e.dataType,e.dims),k=te("v",n.dataType,n.dims),P=[C,k];y&&P.push(te("past_value",r.dataType,r.dims));let A=a?te("seq_lens",a.dataType,a.dims):void 0;a&&P.push(A);let D=o?te("total_sequence_length_input",o.dataType,o.dims):void 0;o&&P.push(D);let z=[ye("output",e.dataType,_)];f&&z.push(ye("present_value",e.dataType,g));let O=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${x}u;
  var<workgroup> tileQ: array<${C.type.value}, ${x*x}>;
  var<workgroup> tileV: array<${C.type.value}, ${x*x}>;
  ${j.registerUniforms(O).declareVariables(...P,...z)}
  ${j.mainStart([x,x,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${u===1?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${u===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${qd(A,D,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${y&&f?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${f?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${C.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${y&&f?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${f?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${r!==void 0};${t}`,inputDependencies:I},getRunData:()=>({outputs:R,dispatchGroup:$,programUniforms:w}),getShaderSource:M}},pc=(t,e,n,r,i,s,a,o,l,u,h=void 0,f=void 0)=>{let p=Math.min(t.outputCount,1+(a?1:0)+(o?1:0)),g=p>1?u.pastSequenceLength:0,_=g+u.kvSequenceLength,x=l&&X.size(l.dims)>0?l:void 0,$=[e,n];p>1&&a&&X.size(a.dims)>0&&$.push(a),x&&$.push(x),h&&$.push(h),f&&$.push(f);let w=t.compute(Bx(p,e,n,a,x,u,g,h,f),{inputs:$,outputs:p>1?[-1,1]:[-1]})[0];t.compute(Ux(w,u.batchSize,u.numHeads,g,u.sequenceLength,_,h,f),{inputs:h&&f?[w,h,f]:[w],outputs:[]});let y=[w,r];p>1&&o&&X.size(o.dims)>0&&y.push(o),h&&y.push(h),f&&y.push(f),t.compute(Fx(p,w,r,o,u,g,h,f),{inputs:y,outputs:p>1?[0,2]:[0]})},Wx=(t,e)=>{let n=[e.batchSize,e.numHeads,e.sequenceLength,e.headSize],r=e.sequenceLength,i=e.inputHiddenSize,s=e.headSize,a=12,o={x:Math.ceil(e.headSize/a),y:Math.ceil(e.sequenceLength/a),z:e.batchSize*e.numHeads},l=[t.inputs[0],t.inputs[1],t.inputs[2]],u=[{type:12,data:r},{type:12,data:i},{type:12,data:s},{type:12,data:e.numHeads},{type:12,data:e.headSize},{type:12,data:e.hiddenSize},{type:12,data:e.hiddenSize+e.hiddenSize+e.vHiddenSize}],h=f=>{let p=ye("output_q",l[0].dataType,n),g=ye("output_k",l[0].dataType,n),_=ye("output_v",l[0].dataType,n),x=te("input",l[0].dataType,l[0].dims),$=te("weight",l[1].dataType,l[1].dims),w=te("bias",l[2].dataType,l[2].dims),y=x.type.storage,I=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${a}u;
  var<workgroup> tileInput: array<${y}, ${a*a}>;
  var<workgroup> tileWeightQ: array<${y}, ${a*a}>;
  var<workgroup> tileWeightK: array<${y}, ${a*a}>;
  var<workgroup> tileWeightV: array<${y}, ${a*a}>;
  ${f.registerUniforms(I).declareVariables(x,$,w,p,g,_)}
  ${f.mainStart([a,a,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${y}(0);
    var valueK = ${y}(0);
    var valueV = ${y}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return t.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:n,dataType:t.inputs[0].dataType,gpuDataType:0},{dims:n,dataType:t.inputs[0].dataType,gpuDataType:0},{dims:n,dataType:t.inputs[0].dataType,gpuDataType:0}],dispatchGroup:o,programUniforms:u}),getShaderSource:h},{inputs:l,outputs:[-1,-1,-1]})},MA=(t,e)=>{let n=jx(t.inputs,e),[r,i,s]=Wx(t,n);return pc(t,r,i,s,t.inputs[4],void 0,void 0,void 0,t.inputs[5],n)}}),qx,Hx,Gx,LA,HU=se(()=>{Jn(),$e(),Ce(),yt(),Ae(),qx=(t,e)=>{if(!t||t.length!==5)throw new Error("BatchNormalization requires 5 inputs");let n=(r,i,s)=>{let a=i.length;if(a!==r.length)throw new Error(`${s}: num dimensions != ${a}`);i.forEach((o,l)=>{if(o!==r[l])throw new Error(`${s}: dim[${l}] do not match`)})};if(t[0].dims.length>1){let r=e.format==="NHWC"?e.spatial?t[0].dims.slice(-1):t[0].dims.slice(-1).concat(t[0].dims.slice(1,t[0].dims.length-1)):t[0].dims.slice(1,e.spatial?2:void 0);n(t[1].dims,r,"Invalid input scale"),n(t[2].dims,r,"Invalid input B"),n(t[3].dims,r,"Invalid input mean"),n(t[4].dims,r,"Invalid input var")}else n(t[1].dims,[1],"Invalid input scale"),n(t[2].dims,[1],"Invalid input B"),n(t[3].dims,[1],"Invalid input mean"),n(t[4].dims,[1],"Invalid input var")},Hx=(t,e)=>{let{epsilon:n,spatial:r,format:i}=e,s=t[0].dims,a=r?ht(s[s.length-1]):1,o=i==="NHWC"&&s.length>1?a:1,l=X.size(s)/a,u=r,h=u?s.length:s,f=te("x",t[0].dataType,t[0].dims,a),p=te("scale",t[1].dataType,t[1].dims,o),g=te("bias",t[2].dataType,t[2].dims,o),_=te("inputMean",t[3].dataType,t[3].dims,o),x=te("inputVar",t[4].dataType,t[4].dims,o),$=ye("y",t[0].dataType,h,a),w=()=>{let I="";if(r)I=`let cOffset = ${s.length===1?"0u":i==="NHWC"?`outputIndices[${s.length-1}] / ${a}`:"outputIndices[1]"};`;else if(i==="NCHW")I=`
            ${$.indicesSet("outputIndices","0","0")}
            let cOffset = ${$.indicesToOffset("outputIndices")};`;else{I=`var cIndices = ${p.type.indices}(0);
                       cIndices[0] = outputIndices[${s.length-1}];`;for(let R=1;R<p.rank;R++)I+=`cIndices[${R}] = outputIndices[${R}];`;I+=`let cOffset = ${p.indicesToOffset("cIndices")};`}return I},y=I=>`
  const epsilon = ${n};
  ${I.registerUniform("outputSize","u32").declareVariables(f,p,g,_,x,$)}
  ${I.mainStart()}
  ${I.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${$.offsetToIndices(`global_idx * ${a}`)};
    ${w()}
    let scale = ${p.getByOffset("cOffset")};
    let bias = ${g.getByOffset("cOffset")};
    let inputMean = ${_.getByOffset("cOffset")};
    let inputVar = ${x.getByOffset("cOffset")};
    let x = ${f.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${$.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${e.epsilon}_${e.format}_${r}_${a}`,inputDependencies:u?["rank","type","type","type","type"]:void 0},getShaderSource:y,getRunData:()=>({outputs:[{dims:t[0].dims,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:u?[{type:12,data:l},...xe(s)]:[{type:12,data:l}]})}},Gx=t=>qe(t),LA=(t,e)=>{let{inputs:n,outputCount:r}=t,i=Gx({...e,outputCount:r});if(it.webgpu.validateInputContent&&qx(n,i),e.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");t.compute(Hx(n,i))}}),Kx,Qx,zA,GU=se(()=>{Ce(),Ae(),Kx=t=>{if(t[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(t[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(t[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(t[0].dims[2]!==t[1].dims[0])throw new Error("last dimension of input and bias are not the same")},Qx=t=>{let e=t[0].dims,n=t[0].dims[2],r=X.size(e)/4,i=t[0].dataType,s=te("input",i,e,4),a=te("bias",i,[n],4),o=te("residual",i,e,4),l=ye("output",i,e,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:e,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(r/64)}}),getShaderSource:u=>`
  const channels = ${n}u / 4;
  ${u.declareVariables(s,a,o,l)}

  ${u.mainStart()}
    ${u.guardAgainstOutOfBoundsWorkgroupSizes(r)}
    let value = ${s.getByOffset("global_idx")}
      + ${a.getByOffset("global_idx % channels")} + ${o.getByOffset("global_idx")};
    ${l.setByOffset("global_idx","value")}
  }`}},zA=t=>{Kx(t.inputs),t.compute(Qx(t.inputs))}}),Yx,Be,VA,jA,UA,BA,FA,WA,qA,HA,GA,Jx,KA,QA,YA,JA,_u,XA,Eh,ZA,eR,tR,nR,rR,iR,sR,aR,oR,lR,uR,cR,dR,hR,fR,pR,Om,mR,Ly,zy,gR,yR,_R,Xx,Zx,vR,e0=se(()=>{$e(),Ce(),yt(),Ae(),Yx=(t,e,n,r,i,s,a)=>{let o=Math.ceil(e/4),l="";typeof i=="string"?l=`${i}(a)`:l=i("a");let u=te("inputData",n,[o],4),h=ye("outputData",r,[o],4),f=[{name:"vec_size",type:"u32"}];return a&&f.push(...a),`
      ${t.registerUniforms(f).declareVariables(u,h)}

  ${s??""}

  ${t.mainStart()}
    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${u.getByOffset("global_idx")};
    ${h.setByOffset("global_idx",l)}
  }`},Be=(t,e,n,r,i,s=t.dataType,a,o)=>{let l=[{type:12,data:Math.ceil(X.size(t.dims)/4)}];return a&&l.push(...a),{name:e,shaderCache:{hint:i,inputDependencies:["type"]},getShaderSource:u=>Yx(u,X.size(t.dims),t.dataType,s,n,r,o),getRunData:u=>({outputs:[{dims:t.dims,dataType:s}],dispatchGroup:{x:Math.ceil(X.size(u[0].dims)/64/4)},programUniforms:l})}},VA=t=>{t.compute(Be(t.inputs[0],"Abs","abs"))},jA=t=>{t.compute(Be(t.inputs[0],"Acos","acos"))},UA=t=>{t.compute(Be(t.inputs[0],"Acosh","acosh"))},BA=t=>{t.compute(Be(t.inputs[0],"Asin","asin"))},FA=t=>{t.compute(Be(t.inputs[0],"Asinh","asinh"))},WA=t=>{t.compute(Be(t.inputs[0],"Atan","atan"))},qA=t=>{t.compute(Be(t.inputs[0],"Atanh","atanh"))},HA=t=>qe(t),GA=(t,e)=>{let n;switch(e.to){case 10:n="vec4<f16>";break;case 1:n="vec4<f32>";break;case 12:n="vec4<u32>";break;case 6:n="vec4<i32>";break;case 9:n="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${e.to}`)}t.compute(Be(t.inputs[0],"Cast",n,void 0,e.cacheKey,e.to))},Jx=t=>{let e,n,r=t.length>=2&&t[1].data!==0,i=t.length>=3&&t[2].data!==0;switch(t[0].dataType){case 1:e=r?t[1].getFloat32Array()[0]:-34028234663852886e22,n=i?t[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:e=r?t[1].getUint16Array()[0]:64511,n=i?t[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return qe({min:e,max:n})},KA=(t,e)=>{let n=e||Jx(t.inputs),r=tn(t.inputs[0].dataType);t.compute(Be(t.inputs[0],"Clip",i=>`clamp(${i}, vec4<${r}>(uniforms.min), vec4<${r}>(uniforms.max))`,void 0,n.cacheKey,void 0,[{type:t.inputs[0].dataType,data:n.min},{type:t.inputs[0].dataType,data:n.max}],[{name:"min",type:r},{name:"max",type:r}]),{inputs:[0]})},QA=t=>{t.compute(Be(t.inputs[0],"Ceil","ceil"))},YA=t=>{t.compute(Be(t.inputs[0],"Cos","cos"))},JA=t=>{t.compute(Be(t.inputs[0],"Cosh","cosh"))},_u=t=>qe(t),XA=(t,e)=>{let n=tn(t.inputs[0].dataType);t.compute(Be(t.inputs[0],"Elu",r=>`elu_vf32(${r})`,`
  const elu_alpha_ = ${n}(${e.alpha});

  fn elu_f32(a: ${n}) -> ${n} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${n}>) -> vec4<${n}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,e.cacheKey))},Eh=(t="f32")=>`
const r0: ${t} = 0.3275911;
const r1: ${t} = 0.254829592;
const r2: ${t} = -0.284496736;
const r3: ${t} = 1.421413741;
const r4: ${t} = -1.453152027;
const r5: ${t} = 1.061405429;

fn erf_vf32(v: vec4<${t}>) -> vec4<${t}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,ZA=t=>{let e=tn(t.inputs[0].dataType);t.compute(Be(t.inputs[0],"Erf",n=>`erf_vf32(${n})`,Eh(e)))},eR=t=>{t.compute(Be(t.inputs[0],"Exp","exp"))},tR=t=>{t.compute(Be(t.inputs[0],"Floor","floor"))},nR=t=>{let e=tn(t.inputs[0].dataType);t.compute(Be(t.inputs[0],"Gelu",n=>`0.5 * ${n} * (1.0 + erf_vf32(${n} * 0.7071067811865475))`,Eh(e)))},rR=(t,e)=>{let n=tn(t.inputs[0].dataType);t.compute(Be(t.inputs[0],"LeakyRelu",r=>`select(leaky_relu_alpha_ * ${r}, ${r}, ${r} >= vec4<${n}>(0.0))`,`const leaky_relu_alpha_ = ${n}(${e.alpha});`,e.cacheKey))},iR=t=>{t.compute(Be(t.inputs[0],"Not",e=>`!${e}`))},sR=t=>{t.compute(Be(t.inputs[0],"Neg",e=>`-${e}`))},aR=t=>{t.compute(Be(t.inputs[0],"Reciprocal",e=>`1.0/${e}`))},oR=t=>{let e=tn(t.inputs[0].dataType);t.compute(Be(t.inputs[0],"Relu",n=>`select(vec4<${e}>(0.0), ${n}, ${n} > vec4<${e}>(0.0))`))},lR=t=>{t.compute(Be(t.inputs[0],"Sigmoid",e=>`(1.0 / (1.0 + exp(-${e})))`))},uR=t=>qe(t),cR=(t,e)=>{let n=tn(t.inputs[0].dataType);t.compute(Be(t.inputs[0],"HardSigmoid",r=>`max(vec4<${n}>(0.0), min(vec4<${n}>(1.0), ${e.alpha} * ${r} + vec4<${n}>(${e.beta})))`,void 0,e.cacheKey))},dR=t=>{t.compute(Be(t.inputs[0],"Sin","sin"))},hR=t=>{t.compute(Be(t.inputs[0],"Sinh","sinh"))},fR=t=>{t.compute(Be(t.inputs[0],"Sqrt","sqrt"))},pR=t=>{t.compute(Be(t.inputs[0],"Tan","tan"))},Om=t=>`sign(${t}) * (1 - exp(-2 * abs(${t}))) / (1 + exp(-2 * abs(${t})))`,mR=t=>{t.compute(Be(t.inputs[0],"Tanh",Om))},Ly=(t="f32")=>`
const fast_gelu_a: ${t} = 0.5;
const fast_gelu_b: ${t} = 0.7978845608028654;
const fast_gelu_c: ${t} = 0.035677408136300125;

fn tanh_v(v: vec4<${t}>) -> vec4<${t}> {
  return ${Om("v")};
}
`,zy=t=>`(fast_gelu_a + fast_gelu_a * tanh_v(${t} * (fast_gelu_c * ${t} * ${t} + fast_gelu_b))) * ${t}`,gR=t=>{let e=tn(t.inputs[0].dataType);t.compute(Be(t.inputs[0],"FastGelu",zy,Ly(e),void 0,t.inputs[0].dataType))},yR=(t,e)=>{let n=tn(t.inputs[0].dataType);return t.compute(Be(t.inputs[0],"ThresholdedRelu",r=>`select(vec4<${n}>(0.0), ${r}, ${r} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${n}>(${e.alpha});`,e.cacheKey)),0},_R=t=>{t.compute(Be(t.inputs[0],"Log","log"))},Xx=(t,e)=>`
const alpha = vec4<${t}>(${e});
const one = ${t}(1.0);
const zero = ${t}(0.0);

fn quick_gelu_impl(x: vec4<${t}>) -> vec4<${t}> {
  let v = x *alpha;
  var x1 : vec4<${t}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,Zx=t=>`quick_gelu_impl(${t})`,vR=(t,e)=>{let n=tn(t.inputs[0].dataType);t.compute(Be(t.inputs[0],"QuickGelu",Zx,Xx(n,e.alpha),e.cacheKey,t.inputs[0].dataType))}}),e2,t2,wR,KU=se(()=>{Ce(),Ae(),e0(),e2=t=>{if(t[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(t[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(t[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(t[0].dims[2]!==t[1].dims[0])throw new Error("last dimension of input and bias are not the same")},t2=t=>{let e=t[0].dims.slice();e[2]=e[2]/2;let n=te("input",t[0].dataType,t[0].dims,4),r=te("bias",t[0].dataType,[t[0].dims[2]],4),i=ye("output",t[0].dataType,e,4),s=X.size(e)/4,a=Dt(t[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:e,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)}}),getShaderSource:o=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${t[0].dims[2]/4/2}u;

  ${o.declareVariables(n,r,i)}

  ${Eh(a)}

  ${o.mainStart()}
    ${o.guardAgainstOutOfBoundsWorkgroupSizes(s)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${i.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},wR=t=>{e2(t.inputs),t.compute(t2(t.inputs))}}),n2,r2,dr,bR,xR,ER,TR,IR,$R,kR,SR,CR,AR,QU=se(()=>{$e(),Ce(),Ae(),n2=(t,e,n,r,i,s,a,o,l,u,h,f)=>{let p,g;typeof o=="string"?p=g=(y,I)=>`${o}((${y}),(${I}))`:typeof o=="function"?p=g=o:(p=o.scalar,g=o.vector);let _=ye("outputData",h,r.length,4),x=te("aData",l,e.length,4),$=te("bData",u,n.length,4),w;if(i)if(s){let y=X.size(e)===1,I=X.size(n)===1,R=e.length>0&&e[e.length-1]%4===0,M=n.length>0&&n[n.length-1]%4===0;y||I?w=_.setByOffset("global_idx",g(y?`${x.type.value}(${x.getByOffset("0")}.x)`:x.getByOffset("global_idx"),I?`${$.type.value}(${$.getByOffset("0")}.x)`:$.getByOffset("global_idx"))):w=`
            let outputIndices = ${_.offsetToIndices("global_idx * 4u")};
            let offsetA = ${x.broadcastedIndicesToOffset("outputIndices",_)};
            let offsetB = ${$.broadcastedIndicesToOffset("outputIndices",_)};
            ${_.setByOffset("global_idx",g(a||R?x.getByOffset("offsetA / 4u"):`${x.type.value}(${x.getByOffset("offsetA / 4u")}[offsetA % 4u])`,a||M?$.getByOffset("offsetB / 4u"):`${$.type.value}(${$.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else w=_.setByOffset("global_idx",g(x.getByOffset("global_idx"),$.getByOffset("global_idx")));else{if(!s)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let y=(I,R,M="")=>{let j=`aData[indexA${R}][componentA${R}]`,C=`bData[indexB${R}][componentB${R}]`;return`
            let outputIndices${R} = ${_.offsetToIndices(`global_idx * 4u + ${R}u`)};
            let offsetA${R} = ${x.broadcastedIndicesToOffset(`outputIndices${R}`,_)};
            let offsetB${R} = ${$.broadcastedIndicesToOffset(`outputIndices${R}`,_)};
            let indexA${R} = offsetA${R} / 4u;
            let indexB${R} = offsetB${R} / 4u;
            let componentA${R} = offsetA${R} % 4u;
            let componentB${R} = offsetB${R} % 4u;
            ${I}[${R}] = ${M}(${p(j,C)});
          `};h===9?w=`
            var data = vec4<u32>(0);
            ${y("data",0,"u32")}
            ${y("data",1,"u32")}
            ${y("data",2,"u32")}
            ${y("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:w=`
            ${y("outputData[global_idx]",0)}
            ${y("outputData[global_idx]",1)}
            ${y("outputData[global_idx]",2)}
            ${y("outputData[global_idx]",3)}
          `}return`
        ${t.registerUniform("vec_size","u32").declareVariables(x,$,_)}

        ${f??""}

        ${t.mainStart()}
        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${w}
      }`},r2=(t,e,n,r,i,s,a=n.dataType)=>{let o=n.dims.map(x=>Number(x)??1),l=r.dims.map(x=>Number(x)??1),u=!X.areEqual(o,l),h=o,f=X.size(o),p=!1,g=!1,_=[u];if(u){let x=Ko.calcShape(o,l,!1);if(!x)throw new Error("Can't perform binary op on the given tensors");h=x.slice(),f=X.size(h);let $=X.size(o)===1,w=X.size(l)===1,y=o.length>0&&o[o.length-1]%4===0,I=l.length>0&&l[l.length-1]%4===0;_.push($),_.push(w),_.push(y),_.push(I);let R=1;for(let M=1;M<h.length;M++){let j=o[o.length-M],C=l[l.length-M];if(j===C)R*=j;else break}R%4===0?(g=!0,p=!0):($||w||y||I)&&(p=!0)}else p=!0;return _.push(p),{name:t,shaderCache:{hint:e+_.map(x=>x.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:x=>n2(x,o,l,h,p,u,g,i,n.dataType,r.dataType,a,s),getRunData:()=>({outputs:[{dims:h,dataType:a}],dispatchGroup:{x:Math.ceil(f/64/4)},programUniforms:[{type:12,data:Math.ceil(X.size(h)/4)},...xe(o,l,h)]})}},dr=(t,e,n,r,i,s)=>{t.compute(r2(e,i??"",t.inputs[0],t.inputs[1],n,r,s))},bR=t=>{dr(t,"Add",(e,n)=>`${e}+${n}`)},xR=t=>{dr(t,"Div",(e,n)=>`${e}/${n}`)},ER=t=>{dr(t,"Equal",{scalar:(e,n)=>`u32(${e}==${n})`,vector:(e,n)=>`vec4<u32>(${e}==${n})`},void 0,void 0,9)},TR=t=>{dr(t,"Mul",(e,n)=>`${e}*${n}`)},IR=t=>{let e=te("input",t.inputs[0].dataType,t.inputs[0].dims).type.value;dr(t,"Pow",{scalar:(n,r)=>`pow_custom(${n},${r})`,vector:(n,r)=>`pow_vector_custom(${n},${r})`},`
    fn pow_custom(a : ${e}, b : ${e}) -> ${e} {
      if (b == ${e}(0.0)) {
        return ${e}(1.0);
      } else if (a < ${e}(0.0) && f32(b) != floor(f32(b))) {
        return ${e}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${e}(1.0), round(f32(abs(b) % ${e}(2.0))) != 1.0) * ${e}(${e==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${e}>, b : vec4<${e}>) -> vec4<${e}> {
      // TODO: implement vectorized pow
      return vec4<${e}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},$R=t=>{dr(t,"Sub",(e,n)=>`${e}-${n}`)},kR=t=>{dr(t,"Greater",{scalar:(e,n)=>`u32(${e}>${n})`,vector:(e,n)=>`vec4<u32>(${e}>${n})`},void 0,void 0,9)},SR=t=>{dr(t,"Less",{scalar:(e,n)=>`u32(${e}<${n})`,vector:(e,n)=>`vec4<u32>(${e}<${n})`},void 0,void 0,9)},CR=t=>{dr(t,"GreaterOrEqual",{scalar:(e,n)=>`u32(${e}>=${n})`,vector:(e,n)=>`vec4<u32>(${e}>=${n})`},void 0,void 0,9)},AR=t=>{dr(t,"LessOrEqual",{scalar:(e,n)=>`u32(${e}<=${n})`,vector:(e,n)=>`vec4<u32>(${e}<=${n})`},void 0,void 0,9)}}),i2,s2,a2,o2,RR,NR,YU=se(()=>{$e(),Ce(),yt(),Ae(),i2=(t,e)=>{if(!t||t.length<1)throw new Error("too few inputs");let n=0,r=t[n],i=r.dataType,s=r.dims.length;t.forEach((a,o)=>{if(o!==n){if(a.dataType!==i)throw new Error("input tensors should be one type");if(a.dims.length!==s)throw new Error("input tensors should have the same shape");a.dims.forEach((l,u)=>{if(u!==e&&l!==r.dims[u])throw new Error("non concat dimensions must match")})}})},s2=(t,e)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${t}u>(${e});
    for (var i: u32 = 0u; i < ${t}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${t}u;
  }`,a2=(t,e)=>{let n=t.length,r=[];for(let i=0;i<n;++i){let s=e.setByOffset("global_idx",t[i].getByIndices("indices"));n===1?r.push(s):i===0?r.push(`if (inputIndex == ${i}u) { ${s} }`):i===n-1?r.push(`else { ${s} }`):r.push(`else if (inputIndex == ${i}) { ${s} }`)}return r.join(`
`)},o2=(t,e,n,r)=>{let i=X.size(n),s=new Array(t.length),a=new Array(t.length),o=0,l=[],u=[],h=[{type:12,data:i}];for(let x=0;x<t.length;++x)o+=t[x].dims[e],s[x]=o,u.push(t[x].dims.length),a[x]=te(`input${x}`,r,u[x]),l.push("rank"),h.push({type:12,data:s[x]});for(let x=0;x<t.length;++x)h.push(...xe(t[x].dims));h.push(...xe(n));let f=ye("output",r,n.length),p=f.indicesGet("indices",e),g=Array.from(Array(s.length).keys()).map(x=>`uniforms.sizeInConcatAxis${x}`).join(","),_=x=>`

  ${(()=>{x.registerUniform("outputSize","u32");for(let $=0;$<t.length;$++)x.registerUniform(`sizeInConcatAxis${$}`,"u32");return x.declareVariables(...a,f)})()}

  ${s2(s.length,g)}

  ${x.mainStart()}
    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${f.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${p});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${s.length}u>(${g});
      ${p} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${a2(a,f)}
  }`;return{name:"Concat",shaderCache:{hint:`${e}`,inputDependencies:l},getRunData:()=>({outputs:[{dims:n,dataType:r}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:h}),getShaderSource:_}},RR=(t,e)=>{let n=t.inputs,r=n[0].dims,i=X.normalizeAxis(e.axis,r.length);i2(n,i);let s=r.slice();s[i]=n.reduce((o,l)=>o+(l.dims.length>i?l.dims[i]:0),0);let a=n.filter(o=>X.size(o.dims)>0);t.compute(o2(a,i,s,n[0].dataType),{inputs:a})},NR=t=>qe({axis:t.axis})}),Ia,$a,ka,t0,za=se(()=>{$e(),Ce(),Ia=(t,e,n="f32")=>{switch(t.activation){case"Relu":return`value = max(value, ${e}(0.0));`;case"Sigmoid":return`value = (${e}(1.0) / (${e}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${e}(${n}(uniforms.clip_min)), ${e}(${n}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${e}(0.0), min(${e}(1.0), ${n}(uniforms.alpha) * value + ${n}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${n}(uniforms.alpha) * value, value, value >= ${e}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw new Error(`Unsupported activation ${t.activation}`)}},$a=(t,e)=>{t.activation==="Clip"?e.push({type:1,data:t.clipMax},{type:1,data:t.clipMin}):t.activation==="HardSigmoid"?e.push({type:1,data:t.alpha},{type:1,data:t.beta}):t.activation==="LeakyRelu"&&e.push({type:1,data:t.alpha})},ka=(t,e)=>{t.activation==="Clip"?e.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):t.activation==="HardSigmoid"?e.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):t.activation==="LeakyRelu"&&e.push({name:"alpha",type:"f32"})},t0=t=>{let e=(t==null?void 0:t.activation)||"";if(e==="HardSigmoid"){let[n,r]=(t==null?void 0:t.activation_params)||[.2,.5];return{activation:e,alpha:n,beta:r}}else if(e==="Clip"){let[n,r]=(t==null?void 0:t.activation_params)||[iA,sA];return{activation:e,clipMax:r,clipMin:n}}else if(e==="LeakyRelu"){let[n]=(t==null?void 0:t.activation_params)||[.01];return{activation:e,alpha:n}}return{activation:e}}}),jt,PR,n0=se(()=>{jt=(t,e)=>{switch(t){case 1:return e;case 2:return`vec2<${e}>`;case 3:return`vec3<${e}>`;case 4:return`vec4<${e}>`;default:throw new Error(`${t}-component is not supported.`)}},PR=t=>`
      ${t?"value = value + getBiasByOutputCoords(coords);":""}
      `}),OR,JU=se(()=>{OR=t=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${t}.x), i32(${t}.y), i32(${t}.z), 1));
}
`}),Lu,r0,i0=se(()=>{$e(),Ce(),Ae(),za(),Lu=(t,e,n,r,i)=>{let s=r-n;return`
      ${Array.from({length:n}).map((a,o)=>`
      if (${we(e.shape,o,e.rank)} != 1) {
        ${e.indicesSet(t,o,we(i,o+s,r))}
      } else {
        ${e.indicesSet(t,o,0)}
      }`).join("")}
`},r0=(t,e,n,r,i=!1,s)=>{let a=t[0].dims,o=t[1].dims,l=a[a.length-2],u=o[o.length-1],h=a[a.length-1],f=ht(u),p=ht(h),g=ht(l),_=X.size(n)/f/g,x=t.length>2,$=r?r.slice(0,-2):n.slice(0,-2),w=[X.size($),l,u],y=[{type:12,data:_},{type:12,data:l},{type:12,data:u},{type:12,data:h}];$a(e,y),y.push(...xe($,a,o)),x&&y.push(...xe(t[2].dims)),y.push(...xe(w));let I=R=>{let M=Jv("batch_dims",t[0].dataType,$.length),j=te("a",t[0].dataType,a.length,p),C=te("b",t[1].dataType,o.length,f),k=ye("output",t[0].dataType,w.length,f),P=Dt(k.type.tensor),A=Ia(e,k.type.value,P),D=[j,C],z="";if(x){let de=i?f:1;D.push(te("bias",t[2].dataType,t[2].dims.length,de)),z=`${i?`value += bias[col / ${de}];`:`value += ${k.type.value}(bias[row + i]);`}`}let O=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];ka(e,O);let ce=()=>{let de=`var a_data: ${j.type.value};`;for(let ue=0;ue<p;ue++)de+=`
              let b_data${ue} = b[(b_offset + (k + ${ue}) * uniforms.N + col) / ${f}];`;for(let ue=0;ue<g;ue++){de+=`a_data = a[(a_offset + (row + ${ue}) * uniforms.K + k) / ${p}];`;for(let pe=0;pe<p;pe++)de+=`
            values[${ue}] = fma(${C.type.value}(a_data${p===1?"":`[${pe}]`}), b_data${pe}, values[${ue}]);
`}return de};return`
  ${R.registerUniforms(O).registerInternalVariables(M).declareVariables(...D,k)}
  ${R.mainStart()}
    ${R.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${f})) * ${f};
    var index1 = global_idx / (uniforms.N / ${f});
    let stride1 = uniforms.M / ${g};
    let row = (index1 % stride1) * ${g};
    let batch = index1 / stride1;

    ${n.length===2?"":`let batch_indices = ${M.offsetToIndices("batch")};`}

    var a_indices: ${j.type.indices};
    ${Lu("a_indices",j,j.rank-2,M.rank,"batch_indices")}
    ${j.indicesSet("a_indices",j.rank-2,0)}
    ${j.indicesSet("a_indices",j.rank-1,0)}
    let a_offset = ${j.indicesToOffset("a_indices")};

    var b_indices: ${C.type.indices};
    ${Lu("b_indices",C,C.rank-2,M.rank,"batch_indices")}
    ${C.indicesSet("b_indices",C.rank-2,0)}
    ${C.indicesSet("b_indices",C.rank-1,0)}
    let b_offset = ${C.indicesToOffset("b_indices")};
    var values: array<${k.type.value}, ${g}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${p}) {
      ${ce()}
    }
    for (var i = 0u; i < ${g}u; i++) {
      var value = values[i];
      ${z}
      ${A}
      let cur_indices = ${k.type.indices}(batch, row + i, col);
      let offset = ${k.indicesToOffset("cur_indices")};
      ${k.setByOffset(`offset / ${f}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${e.activation};${f};${p};${g};${i}`,inputDependencies:x?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:s?s(n):n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(_/64)},programUniforms:y}),getShaderSource:I}}}),l2,u2,Vy,Dm,c2,jy,d2,wf,s0=se(()=>{$e(),Ce(),Ae(),za(),i0(),n0(),l2=(t,e)=>t?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${e?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${e?", batchIndices":""});
        `,u2=(t,e)=>t?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${e===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${e===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${e===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,Vy=(t,e,n="f32",r,i=!1,s=32,a=!1,o=32)=>{let l=e[1]*t[1],u=e[0]*t[0],h=i?l:s,f=i?s:l,p=h/e[0],g=s/e[1];if(!((i&&p===4&&t[1]===4||!i&&(p===3||p===4))&&h%e[0]===0&&s%e[1]===0&&t[0]===4))throw new Error(`If transposeA ${i} is true, innerElementSize ${p} and workPerThread[1] ${t[1]} must be 4.
      Otherwise, innerElementSize ${p} must be 3 or 4.
  tileAWidth ${h} must be divisible by workgroupSize[0]${e[0]}. tileInner ${s} must be divisible by workgroupSize[1] ${e[1]}. colPerThread ${t[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${p}<${n}>, ${h/p}>, ${f}>;
var<workgroup> mm_Bsub: array<array<vec4<${n}>, ${u/t[0]}>, ${s}>;

const rowPerThread = ${t[1]};
const colPerThread = ${t[0]};
const innerElementSize = ${p};
const tileInner = ${s};

@compute @workgroup_size(${e[0]}, ${e[1]}, ${e[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${a?"0":"i32(globalId.z)"};
  ${r?`let batchIndices = ${r.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${l};

  let num_tiles = ${a?`${Math.ceil(o/s)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${a?`i32(globalId.z) * ${o}`:"0"};

  var acc: array<vec4<${n}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${g};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${l2(i,r)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${g}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${r?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${p===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${u2(i,p)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},Dm=(t,e)=>t?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${e?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${e?", batchIndices":""});
            `,c2=t=>t?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",jy=(t,e,n="f32",r,i=!1,s=32,a=!1,o=32,l=!1)=>{let u=t[1]*e[1],h=t[0]*e[0],f=i?u:s,p=i?s:u;if(!(p%e[1]===0&&f%e[0]===0&&s%e[1]===0))throw new Error(`tileAHight ${p} must be divisible by workgroupSize[1]${e[1]}, tileAWidth ${f} must be divisible by workgroupSize[0]${e[0]}, tileInner ${s} must be divisible by workgroupSize[1]${e[1]}`);let g=p/e[1],_=f/e[0],x=s/e[1],$=l?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${u};
    let globalColStart = i32(workgroupId.x) * ${h};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${p}; inputRow = inputRow + ${e[1]}) {
        for (var inputCol = localCol; inputCol < ${f}; inputCol = inputCol + ${e[0]}) {
          ${Dm(i,r)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${s}; inputRow = inputRow + ${e[1]}) {
            for (var inputCol = localCol; inputCol < ${h}; inputCol = inputCol + ${e[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${r?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${n}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${e[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${i?`mm_Asub[k][localRow + innerRow * ${e[1]}];`:`mm_Asub[localRow + innerRow * ${e[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${e[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${e[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${u};

let tileRowA = i32(localId.y) * ${g};
let tileColA = i32(localId.x) * ${_};
let tileRowB = i32(localId.y) * ${x};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${g}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${_}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${Dm(i,r)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${x}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${r?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${n}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${c2(i)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${n}, ${f}>, ${p}>;
  var<workgroup> mm_Bsub : array<array<${n}, ${h}>, ${s}>;
  const rowPerThread = ${t[1]};
  const colPerThread = ${t[0]};
  const tileInner = ${s};

@compute @workgroup_size(${e[0]}, ${e[1]}, ${e[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${a?"0":"i32(globalId.z)"};
    ${r?`let batchIndices = ${r.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${a?`${Math.ceil(o/s)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${a?`i32(globalId.z) * ${o}`:"0"};

    var acc : array<array<${n}, colPerThread>, rowPerThread>;
    ${$}
  }
`},d2=(t,e,n,r,i=!1)=>{let[s,a,o,l]=r,u=Dt(r[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${s.type.indices}) -> ${jt(t,u)} {
      var value = ${jt(t,u)}(0.0);
      let col = colIn * ${t};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${a.type.indices};
        ${Lu("aIndices",a,a.rank-2,s.rank,"batchIndices")}
        ${a.indicesSet("aIndices",a.rank-2,"u32(row)")}
        ${a.indicesSet("aIndices",a.rank-1,"u32(colIn)")}
        value = ${a.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${s.type.indices}) -> ${jt(t,u)} {
      var value = ${jt(t,u)}(0.0);
      let col = colIn * ${t};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${o.type.indices};
        ${Lu("bIndices",o,o.rank-2,s.rank,"batchIndices")}
        ${o.indicesSet("bIndices",o.rank-2,"u32(row)")}
        ${o.indicesSet("bIndices",o.rank-1,"u32(colIn)")}
        value = ${o.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${jt(t,u)}) {
      let col = colIn * ${t};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${e?`value = value + ${i?"bias[colIn]":`${jt(t,u)}(bias[row])`};`:""}
        ${n}
        ${l.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},wf=(t,e,n,r,i=!1,s)=>{let a=t[0].dims,o=t[1].dims,l=a.slice(0,-2),u=o.slice(0,-2),h=r?r.slice(0,-2):n.slice(0,-2),f=X.size(h),p=a[a.length-2],g=a[a.length-1],_=o[o.length-1],x=g%4===0&&_%4===0,$=p<=8?[4,1,1]:[4,4,1],w=[8,8,1],y=[Math.ceil(_/w[0]/$[0]),Math.ceil(p/w[1]/$[1]),Math.ceil(f/w[2]/$[2])],I=x?4:1,R=[...l,p,g/I],M=R.length,j=[...u,g,_/I],C=j.length,k=[f,p,_/I],P=[{type:6,data:p},{type:6,data:_},{type:6,data:g}];$a(e,P),P.push(...xe(h,R,j));let A=["rank","rank"],D=t.length>2;D&&(P.push(...xe(t[2].dims)),A.push("rank")),P.push(...xe(k));let z=O=>{let ce=h.length,de=Jv("batchDims",t[0].dataType,ce,1),ue=Dt(t[0].dataType),pe=te("a",t[0].dataType,M,I),K=te("b",t[1].dataType,C,I),B=ye("result",t[0].dataType,k.length,I),F=[pe,K];if(D){let ae=i?I:1;F.push(te("bias",t[2].dataType,t[2].dims.length,ae))}let U=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];ka(e,U);let G=Dt(B.type.tensor),q=Ia(e,B.type.value,G),Y=d2(I,D,q,[de,pe,K,B],i);return`
  ${O.registerUniforms(U).registerInternalVariables(de).declareVariables(...F,B)}
  ${Y}
  ${x?Vy($,w,ue,de):jy($,w,ue,de)}
                   `};return{name:"MatMul",shaderCache:{hint:`${$};${e.activation};${x};${i}`,inputDependencies:A},getRunData:()=>({outputs:[{dims:s?s(n):n,dataType:t[0].dataType}],dispatchGroup:{x:y[0],y:y[1],z:y[2]},programUniforms:P}),getShaderSource:z}}}),h2,DR,XU=se(()=>{$e(),Ai(),Ae(),za(),n0(),JU(),s0(),h2=(t,e,n,r,i=!1,s,a=4,o=4,l=4,u="f32")=>{let h=P=>{switch(P){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${u}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${P} is not supported.`)}},f=P=>{switch(P){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${P} is not supported.`)}},p=t?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,g=t?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,_=t?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",x=t?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",$=t?"row":"col",w=t?"col":"row",y=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${$} / outWidth;
    let outCol = ${$} % outWidth;

    let WRow = ${w} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${w} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${w} % inChannels;
    var resData = ${jt(a,u)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${_} && xCol >= 0 && xCol < ${x}) {
      ${p}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${h(a)}
    }
    return resData;`,I=t?e&&r?`
    let col = colIn * ${a};
    ${y}`:`
    let col = colIn * ${a};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${y}
    }
    return ${jt(a,u)}(0.0);`:r&&n?`
    let col = colIn * ${a};
    ${y}`:`
    let col = colIn * ${a};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${y}
    }
    return ${jt(a,u)}(0.0);`,R=t?r&&n?f(o):`
    let col = colIn * ${o};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${f(o)}
    }
    return ${jt(o,u)}(0.0);`:`
    let col = colIn * ${o};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${f(o)}
    }
    return ${jt(o,u)}(0.0);`,M=jt(l,u),j=jt(t?a:o,u),C=jt(t?o:a,u),k=Ia(s,M,u);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${j} {
      ${t?I:R}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${C} {
      ${t?R:I}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${M}) {
      let col = colIn * ${l};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${g}
      ${PR(i)}
      ${k}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},DR=(t,e,n,r,i,s,a,o,l)=>{let u=e.format==="NHWC",h=u?t[0].dims[3]:t[0].dims[1],f=n[0],p=u?n[2]:n[3],g=u?n[1]:n[2],_=u?n[3]:n[1],x=u&&(h%4===0||h%3===0)&&_%4===0,$=u?_:p*g,w=u?p*g:_,y=[8,8,1],I=r<=8?[4,1,1]:[4,4,1],R=[Math.ceil($/y[0]/I[0]),Math.ceil(w/y[1]/I[1]),Math.ceil(f/y[2]/I[2])];De("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${R}`);let M=x?u&&h%4!==0?3:4:1,j=y[1]*I[1],C=y[0]*I[0],k=Math.max(y[0]*M,y[1]),P=r%j===0,A=i%C===0,D=s%k===0,z=x?[M,4,4]:[1,1,1],O=[{type:6,data:r},{type:6,data:i},{type:6,data:s},{type:6,data:[e.pads[0],e.pads[1]]},{type:6,data:e.strides},{type:6,data:e.dilations}];$a(e,O),O.push(...xe(t[0].dims,t[1].dims));let ce=["rank","rank"];a&&(O.push(...xe(t[2].dims)),ce.push("rank")),O.push(...xe(n));let de=ue=>{let pe=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];ka(e,pe);let K=x?4:1,B=Dt(t[0].dataType),F=`
      fn setOutputAtIndex(flatIndex : i32, value : ${x?`vec4<${B}>`:B}) {
        result[flatIndex] = ${x?`vec4<${B}>`:B}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${x?`vec4<${B}>`:B}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${x?"/ 4":""}, value);
      }`,U=te("x",t[0].dataType,t[0].dims.length,M===3?1:M),G=te("w",t[1].dataType,t[1].dims.length,K),q=[U,G],Y=ye("result",t[0].dataType,n.length,K);if(a){let ae=te("bias",t[2].dataType,t[2].dims.length,K);q.push(ae),F+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${x?`vec4<${B}>`:B} {
          return bias[coords.${u?"w":"y"}${x?"/ 4":""}];
        }`}return`
        ${OR("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${ue.registerUniforms(pe).declareVariables(...q,Y)}
        ${F}
        ${h2(u,P,A,D,a,e,z[0],z[1],z[2],B)}
        ${x?Vy(I,y,B,void 0,!u,k):jy(I,y,B,void 0,!u,k,!1,void 0,o)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${e.cacheKey};${M};${x};${P};${A};${D};${j};${C};${k}`,inputDependencies:ce},getRunData:()=>({outputs:[{dims:l?l(n):n,dataType:t[0].dataType}],dispatchGroup:{x:R[0],y:R[1],z:R[2]},programUniforms:O}),getShaderSource:de}}}),f2,Mm,Xl,p2,Lm,m2,MR,LR,ZU=se(()=>{$e(),Ai(),Ce(),Ae(),za(),n0(),f2=t=>{let e=1;for(let n=0;n<t.length;n++)e*=t[n];return e},Mm=t=>typeof t=="number"?[t,t,t]:t,Xl=(t,e)=>e<=1?t:t+(t-1)*(e-1),p2=(t,e,n,r=1)=>{let i=Xl(e,r);return Math.floor((t[0]*(n-1)-n+i)/2)},Lm=(t,e,n,r,i)=>{i==null&&(i=p2(t,e[0],r[0]));let s=[0,0,0,n];for(let a=0;a<3;a++)t[a]+2*i>=e[a]&&(s[a]=Math.trunc((t[a]-e[a]+2*i)/r[a]+1));return s},m2=(t,e,n,r,i,s,a,o,l,u)=>{let h,f,p,g;if(t==="VALID"&&(t=0),typeof t=="number"){h={top:t,bottom:t,left:t,right:t,front:t,back:t};let _=Lm([e,n,r,1],[o,l,u],1,[i,s,a],t);f=_[0],p=_[1],g=_[2]}else if(Array.isArray(t)){if(!t.every((x,$,w)=>x===w[0]))throw Error(`Unsupported padding parameter: ${t}`);h={top:t[0],bottom:t[1],left:t[2],right:t[3],front:t[4],back:t[5]};let _=Lm([e,n,r,1],[o,l,u],1,[i,s,a],t[0]);f=_[0],p=_[1],g=_[2]}else if(t==="SAME_UPPER"){f=Math.ceil(e/i),p=Math.ceil(n/s),g=Math.ceil(r/a);let _=(f-1)*i+o-e,x=(p-1)*s+l-n,$=(g-1)*a+u-r,w=Math.floor(_/2),y=_-w,I=Math.floor(x/2),R=x-I,M=Math.floor($/2),j=$-M;h={top:I,bottom:R,left:M,right:j,front:w,back:y}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:h,outDepth:f,outHeight:p,outWidth:g}},MR=(t,e,n,r,i,s=!1,a="channelsLast")=>{let o,l,u,h,f;if(a==="channelsLast")[o,l,u,h,f]=t;else if(a==="channelsFirst")[o,f,l,u,h]=t;else throw new Error(`Unknown dataFormat ${a}`);let[p,,g,_,x]=e,[$,w,y]=Mm(n),[I,R,M]=Mm(r),j=Xl(g,I),C=Xl(_,R),k=Xl(x,M),{padInfo:P,outDepth:A,outHeight:D,outWidth:z}=m2(i,l,u,h,$,w,y,j,C,k),O=s?p*f:p,ce=[0,0,0,0,0];return a==="channelsFirst"?ce=[o,O,A,D,z]:a==="channelsLast"&&(ce=[o,A,D,z,O]),{batchSize:o,dataFormat:a,inDepth:l,inHeight:u,inWidth:h,inChannels:f,outDepth:A,outHeight:D,outWidth:z,outChannels:O,padInfo:P,strideDepth:$,strideHeight:w,strideWidth:y,filterDepth:g,filterHeight:_,filterWidth:x,effectiveFilterDepth:j,effectiveFilterHeight:C,effectiveFilterWidth:k,dilationDepth:I,dilationHeight:R,dilationWidth:M,inShape:t,outShape:ce,filterShape:e}},LR=(t,e,n,r,i,s)=>{let a=s==="channelsLast";a?t[0].dims[3]:t[0].dims[1];let o=[64,1,1],l={x:n.map(($,w)=>w)},u=[Math.ceil(f2(l.x.map($=>n[$]))/o[0]),1,1];De("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${u}`);let h=1,f=X.size(n),p=[{type:12,data:f},{type:12,data:r},{type:12,data:i},{type:12,data:e.strides},{type:12,data:e.dilations}];$a(e,p),p.push(...xe(t[0].dims,t[1].dims));let g=["rank","rank"],_=t.length===3;_&&(p.push(...xe(t[2].dims)),g.push("rank")),p.push(...xe(n));let x=$=>{let w=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:r.length},{name:"pads",type:"u32",length:i.length},{name:"strides",type:"u32",length:e.strides.length},{name:"dilations",type:"u32",length:e.dilations.length}];ka(e,w);let y=1,I=Dt(t[0].dataType),R=te("x",t[0].dataType,t[0].dims.length,h),M=te("W",t[1].dataType,t[1].dims.length,y),j=[R,M],C=ye("result",t[0].dataType,n.length,y),k="";if(_){let D=te("bias",t[2].dataType,t[2].dims.length,y);j.push(D),k+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${I} {
          return bias[${a?we("coords",4,5):we("coords",1,5)}];
        }`}let P=jt(h,I),A=Ia(e,P,I);return`
            ${k}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${R.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${M.getByIndices("aIndices")};
            }
          ${$.registerUniforms(w).declareVariables(...j,C)}
          ${$.mainStart()}
          ${$.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${C.offsetToIndices("global_idx")};
              let batch = ${we("coords",0,R.rank)};
              let d2 = ${a?we("coords",R.rank-1,R.rank):we("coords",1,R.rank)};
              let xFRCCorner = vec3<u32>(${a?we("coords",1,R.rank):we("coords",2,R.rank)},
              ${a?we("coords",2,R.rank):we("coords",3,R.rank)},
              ${a?we("coords",3,R.rank):we("coords",4,R.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${a?we("uniforms.x_shape",1,R.rank):we("uniforms.x_shape",2,R.rank)};
              let xShapeZ = ${a?we("uniforms.x_shape",2,R.rank):we("uniforms.x_shape",3,R.rank)};
              let xShapeW = ${a?we("uniforms.x_shape",3,R.rank):we("uniforms.x_shape",4,R.rank)};
              let xShapeU = ${a?we("uniforms.x_shape",4,R.rank):we("uniforms.x_shape",1,R.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${a?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${a?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${a?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${a?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${_?"value = value + getBiasByOutputCoords(coords)":""};
              ${A}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${e.cacheKey};${a};${h};${_}`,inputDependencies:g},getRunData:()=>({outputs:[{dims:n,dataType:t[0].dataType}],dispatchGroup:{x:u[0],y:u[1],z:u[2]},programUniforms:p}),getShaderSource:x}}}),zR,VR,eB=se(()=>{$e(),Ce(),Ae(),za(),zR=(t,e,n,r)=>{let i=t.length>2,s=i?"value += b[output_channel];":"",a=t[0].dims,o=t[1].dims,l=e.format==="NHWC",u=l?n[3]:n[1],h=u/e.group,f=l&&h>=4?ht(u):1,p=X.size(n)/f,g=[{type:12,data:p},{type:12,data:e.dilations},{type:12,data:[e.strides[0],e.strides[1]]},{type:12,data:[e.pads[0],e.pads[1]]},{type:12,data:h}];$a(e,g),g.push(...xe(a,[o[0],o[1],o[2],o[3]/f]));let _=i?["rank","rank","rank"]:["rank","rank"];g.push(...xe([n[0],n[1],n[2],n[3]/f]));let x=$=>{let w=ye("output",t[0].dataType,n.length,f),y=Dt(w.type.tensor),I=Ia(e,w.type.value,y),R=te("x",t[0].dataType,a.length),M=te("w",t[1].dataType,o.length,f),j=[R,M];i&&j.push(te("b",t[2].dataType,t[2].dims,f));let C=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:e.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];ka(e,C);let k=l?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${R.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${M.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${R.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${M.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${$.registerUniforms(C).declareVariables(...j,w)}

  ${$.mainStart()}
    ${$.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${w.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${l?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${l?1:2}], outputIndices[${l?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${f} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${l?2:1}];

    var value: ${w.type.value} = ${w.type.value}(0);
    ${k}
    ${s}
    ${I}
    ${w.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${e.cacheKey}_${f}`,inputDependencies:_},getRunData:()=>({outputs:[{dims:r?r(n):n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:g}),getShaderSource:x}},VR=(t,e,n,r)=>{let i=t.length>2,s=ht(n[3]),a=ht(n[2]),o=X.size(n)/s/a,l=[t[0].dims[0],t[0].dims[1],t[0].dims[2],t[0].dims[3]/s],u=[t[1].dims[0],t[1].dims[1],t[1].dims[2],t[1].dims[3]/s],h=[n[0],n[1],n[2],n[3]/s],f=[{type:12,data:o},{type:6,data:[e.strides[0],e.strides[1]]},{type:6,data:[e.pads[0],e.pads[1]]}];$a(e,f),f.push(...xe(l,u,h));let p=(a-1)*e.strides[1]+u[1],g=_=>{let x=ye("output",t[0].dataType,h.length,s),$=Dt(x.type.tensor),w=Ia(e,x.type.value,$),y=te("x",t[0].dataType,l.length,s),I=te("w",t[1].dataType,u.length,s),R=[y,I];i&&R.push(te("b",t[2].dataType,t[2].dims,s));let M=i?"value += b[output_channel];":"",j=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return ka(e,j),`
  ${_.registerUniforms(j).declareVariables(...R,x)}
  ${_.mainStart()}
    ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${a}u;
    let col = (index1 % width1) * ${a}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${y.type.value}, ${p}>;
    var values: array<${x.type.value}, ${a}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${u[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${p}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${y.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${y.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${u[1]}; w_width++) {
          let w_val = ${I.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${a}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${a}u; i++) {
      var value = values[i];
      ${M}
      ${w}
      ${x.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${e.cacheKey};${s};${a};${p};${u[0]};${u[1]}`,inputDependencies:i?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:r?r(n):n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:f}),getShaderSource:g}}}),g2,Hd,y2,Gd,Uy,zm,_2,v2,By,tB=se(()=>{Ce(),XU(),ZU(),s0(),eB(),za(),i0(),Cs(),g2=(t,e,n,r,i,s)=>{let a=t[0],o=t.slice(s?1:2,s?3:4),l=o.length,u=e[0],h=e.slice(2).map((p,g)=>p+(p-1)*(n[g]-1)),f=o.map((p,g)=>p+r[g]+r[g+l]).map((p,g)=>Math.floor((p-h[g]+i[g])/i[g]));return f.splice(0,0,a),f.splice(s?3:1,0,u),f},Hd=[2,3,1,0],y2=(t,e)=>{if(!t||t.length!==2&&t.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(t[0].dims.length>5)throw new Error("greater than 5D is not supported");if(t[0].dims.length!==t[1].dims.length)throw new Error("filter does not have same dimension as input");let n=t[0].dims[e.format==="NHWC"?t[0].dims.length-1:1],r=t[1].dims[1]*e.group;if(n!==r)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(t.length===3&&(t[2].dims.length!==1||t[1].dims[0]!==t[2].dims[0]))throw new Error("invalid bias");let i=t[0].dims.length-2;if(e.dilations.length!==i)throw new Error(`dilations should be ${i}D`);if(e.strides.length!==i)throw new Error(`strides should be ${i}D`);if(e.pads.length!==i*2)throw new Error(`pads should be ${i*2}D`);if(e.kernelShape.length!==0&&e.kernelShape.length!==t[1].dims.length-2)throw new Error("invalid kernel shape")},Gd=(t,e)=>{let n=t.kernelShape.slice();n.length<e[1].dims.length-2&&n.push(...Array(e[1].dims.length-2-n.length).fill(0));for(let s=2;s<e[1].dims.length;++s)n[s-2]===0&&(n[s-2]=e[1].dims[s]);let r=t.pads.slice();_f.adjustPadsBasedOnAutoPad(e[0].dims,t.strides,t.dilations,n,r,t.format==="NHWC",t.autoPad);let i=Object.assign({},t);return Object.assign(i,{kernelShape:n,pads:r}),i},Uy=t=>{let e=t0(t),n=t.format,r=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][t.auto_pad],i=t.dilations,s=t.group,a=t.kernel_shape,o=t.pads,l=t.strides,u=t.w_is_const();return{autoPad:r,format:n,dilations:i,group:s,kernelShape:a,pads:o,strides:l,wIsConst:u,...e,cacheKey:`${t.format};${e.activation};`}},zm=(t,e,n,r)=>{let i=n.format==="NHWC",s=g2(e[0].dims,e[1].dims,n.dilations,n.pads,n.strides,i);if(n.group!==1){let j=[e[0]];if(i){let C=t.kernelCustomData.wT??t.compute(Ln(e[1],Hd),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=C),j.push(C)}else j.push(e[1]);e.length===3&&j.push(e[2]),!t.adapterInfo.isArchitecture("ampere")&&i&&e[1].dims[0]===n.group&&e[1].dims[1]===1&&n.dilations[0]===1&&n.dilations[1]===1?t.compute(VR(j,n,s,r),{inputs:j}):t.compute(zR(j,n,s,r),{inputs:j});return}let a=e.length===3,o=e[0].dims[i?1:2],l=e[0].dims[i?2:3],u=e[0].dims[i?3:1],h=e[1].dims[2],f=e[1].dims[3],p=s[i?1:2],g=s[i?2:3],_=s[i?3:1],x=i&&h===o&&f===l&&n.pads[0]===0&&n.pads[1]===0;if(x||h===1&&f===1&&n.dilations[0]===1&&n.dilations[1]===1&&n.strides[0]===1&&n.strides[1]===1&&n.pads[0]===0&&n.pads[1]===0){let j=s[0],C,k,P,A=[];if(i){let O=t.kernelCustomData.wT??t.compute(Ln(e[1],Hd),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];if(n.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=O),x){let ce=o*l*u;C=e[0].reshape([1,j,ce]),k=O.reshape([1,ce,_]),P=[1,j,_]}else C=e[0].reshape([j,o*l,u]),k=O.reshape([1,u,_]),P=[j,p*g,_];A.push(C),A.push(k)}else C=e[0].reshape([j,u,o*l]),k=e[1].reshape([1,_,u]),P=[j,_,p*g],A.push(k),A.push(C);a&&A.push(e[2]);let D=P[2],z=A[0].dims[A[0].dims.length-1];D<8&&z<8?t.compute(r0(A,n,s,P,i,r),{inputs:A}):t.compute(wf(A,n,s,P,i,r),{inputs:A});return}let $=!0,w=t.kernelCustomData.wT??t.compute(Ln(e[1],Hd),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=w);let y=[e[0],w];a&&y.push(e[2]);let I=i?p*g:_,R=i?_:p*g,M=h*f*u;t.compute(DR(y,n,s,I,R,M,a,$,r),{inputs:y})},_2=(t,e)=>{let n=e.format==="NHWC",r=[t.inputs[0].reshape(n?[t.inputs[0].dims[0],1,t.inputs[0].dims[1],t.inputs[0].dims[2]]:[t.inputs[0].dims[0],t.inputs[0].dims[1],1,t.inputs[0].dims[2]]),t.inputs[1].reshape([t.inputs[1].dims[0],t.inputs[1].dims[1],1,t.inputs[1].dims[2]])];t.inputs.length===3&&r.push(t.inputs[2]);let i=[0,e.pads[0],0,e.pads[1]],s=[1].concat(e.strides),a=[1].concat(e.dilations),o=[1].concat(e.kernelShape),l=Gd({...e,pads:i,strides:s,dilations:a,kernelShape:o},r);zm(t,r,l,u=>n?[u[0],u[2],u[3]]:[u[0],u[1],u[3]])},v2=(t,e,n)=>{let r=n.format==="NHWC"?"channelsLast":"channelsFirst",i=Gd(n,e),s=n.autoPad==="NOTSET"?n.pads:n.autoPad,a=MR(e[0].dims,e[1].dims,n.strides,n.dilations,s,!1,r);t.compute(LR(e,i,a.outShape,[a.filterDepth,a.filterHeight,a.filterWidth],[a.padInfo.front,a.padInfo.top,a.padInfo.left],r))},By=(t,e)=>{if(y2(t.inputs,e),t.inputs[0].dims.length===3)_2(t,e);else if(t.inputs[0].dims.length===5)v2(t,t.inputs,e);else{let n=Gd(e,t.inputs);zm(t,t.inputs,n)}}}),jR,nB=se(()=>{$e(),Ai(),Ce(),Ae(),jR=(t,e,n)=>{let r=t.length>2,i=e.outputShape,s=e.format==="NHWC",a=e.group,o=t[1].dims,l=o[2]/a,u=o[3],h=s?ht(l):1,f=s&&u===1&&l>=4,p=f?Math.floor(l/4)*4:Math.floor(l/h)*h,g=l-p,_=s?ht(u):1,x=s?u===1?h:_:1,$=X.size(i)/_,w=[Math.ceil($/64),1,1];De("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${w}`);let y=["rank","rank"],I=[e.strides[0],e.strides[1]],R=[e.kernelShape[s?1:2],e.kernelShape[s?2:3]],M=[e.dilations[0],e.dilations[1]],j=[R[0]+(e.dilations[0]<=1?0:(e.kernelShape[s?1:2]-1)*(e.dilations[0]-1)),R[1]+(e.dilations[1]<=1?0:(e.kernelShape[s?2:3]-1)*(e.dilations[1]-1))],C=[j[0]-1-Math.floor((e.pads[0]+e.pads[2])/2),j[1]-1-Math.floor((e.pads[1]+e.pads[3])/2)],k=[{type:12,data:$},{type:12,data:I},{type:12,data:R},{type:12,data:M},{type:12,data:j},{type:6,data:C},{type:12,data:p},{type:12,data:l},{type:12,data:u},...xe(t[0].dims,t[1].dims)];r&&(k.push(...xe(t[2].dims)),y.push("rank")),k.push(...xe(i));let P=A=>{let D=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:I.length},{name:"filter_dims",type:"u32",length:R.length},{name:"dilations",type:"u32",length:R.length},{name:"effective_filter_dims",type:"u32",length:j.length},{name:"pads",type:"i32",length:C.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],z=Dt(t[0].dataType),O=s?1:2,ce=s?2:3,de=s?3:1,ue=te("W",t[1].dataType,t[1].dims.length,x),pe=te("Dy",t[0].dataType,t[0].dims.length,h),K=[pe,ue];r&&K.push(te("bias",t[2].dataType,[i[de]].length,_));let B=ye("result",t[0].dataType,i.length,_),F=()=>{let q="";if(f)h===4?q+=`
        let xValue = ${pe.getByOffset("x_offset")};
        let wValue = ${ue.getByOffset("w_offset")};
        dotProd = dotProd + dot(xValue, wValue);
        x_offset += 1u;
        w_offset += 1u;`:h===2?q+=`
          dotProd = dotProd + dot(vec4<${z}>(${pe.getByOffset("x_offset")}, ${pe.getByOffset("x_offset + 1u")}), vec4<${z}>(${ue.getByOffset("w_offset")}, ${ue.getByOffset("w_offset + 1u")}));
          x_offset += 2u;
          w_offset += 2u;`:h===1&&(q+=`
          dotProd = dotProd + dot(vec4<${z}>(${pe.getByOffset("x_offset")}, ${pe.getByOffset("x_offset + 1u")}, ${pe.getByOffset("x_offset + 2u")}, ${pe.getByOffset("x_offset + 3u")}), vec4<${z}>(${ue.getByOffset("w_offset")}, ${ue.getByOffset("w_offset + 1u")}, ${ue.getByOffset("w_offset + 2u")}, ${ue.getByOffset("w_offset + 3u")}));
          x_offset += 4u;
          w_offset += 4u;`);else if(q+=`
                  let xValue = ${s?pe.getByOffset(`${pe.indicesToOffset(`${pe.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${h}`):pe.get("batch","inputChannel","idyR","idyC")};
        `,h===1)q+=`
          let w_offset = ${ue.indicesToOffset(`${ue.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
          let wValue = ${ue.getByOffset(`w_offset / ${x}`)};
          dotProd = dotProd + xValue * wValue;`;else for(let Y=0;Y<h;Y++)q+=`
            let wValue${Y} = ${ue.getByOffset(`${ue.indicesToOffset(`${ue.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${Y}, wOutChannel)`)} / ${x}`)};
            dotProd = dotProd + xValue[${Y}] * wValue${Y};`;return q},U=()=>{if(g===0)return"";if(!f)throw new Error(`packInputAs4 ${f} is not true.`);let q="";if(h===1){q+="dotProd = dotProd";for(let Y=0;Y<g;Y++)q+=`
            + ${pe.getByOffset(`x_offset + ${Y}`)} * ${ue.getByOffset(`w_offset + ${Y}`)}`;q+=";"}else if(h===2){if(g!==2)throw new Error(`Invalid inputChannelsRemainder ${g}.`);q+=`
          let xValue = ${pe.getByOffset("x_offset")};
          let wValue = ${ue.getByOffset("w_offset")};
          dotProd = dotProd + dot(xValue, wValue);`}return q},G=`
            let outputIndices = ${B.offsetToIndices(`global_idx * ${_}`)};
            let batch = ${B.indicesGet("outputIndices",0)};
            let d1 = ${B.indicesGet("outputIndices",de)};
            let r = ${B.indicesGet("outputIndices",O)};
            let c = ${B.indicesGet("outputIndices",ce)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${B.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${z}(dyRCorner) + ${z}(wR)) / ${z}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${z}(uniforms.Dy_shape[${O}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }
              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${z}(dyCCorner) + ${z}(wC)) / ${z}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${z}(uniforms.Dy_shape[${ce}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                ${f?`
                var x_offset = ${pe.indicesToOffset(`${pe.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${h};
                var w_offset = ${ue.indicesToOffset(`${ue.type.indices}(wRPerm, wCPerm, inputChannel, wOutChannel)`)} / ${x};
                  `:""}
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ${f?4:h}) {
                  ${F()}
                  inputChannel = inputChannel + ${f?4:h};
                }
                ${U()}
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${r?` + bias[d1 / ${_}]`:""};
            ${B.setByOffset("global_idx","value")};
          `;return`
    ${A.registerUniforms(D).declareVariables(...K,B)}
      ${A.mainStart()}
      ${A.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${G}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${e.cacheKey};${h}${x}${_}${f}${g}`,inputDependencies:y},getRunData:()=>({dispatchGroup:{x:w[0],y:w[1],z:w[2]},outputs:[{dims:n?n(i):i,dataType:t[0].dataType}],programUniforms:k}),getShaderSource:P}}}),w2,b2,x2,Vm,UR,E2,jm,T2,BR,rB=se(()=>{nB(),za(),Cs(),w2=(t,e,n,r,i,s)=>(t-1)*e+n+(r-1)*i+1-s,b2=(t,e,n,r,i)=>{let s=Math.floor(t/2);e==="SAME_UPPER"?(n[r]=s,n[i]=t-s):e==="SAME_LOWER"&&(n[r]=t-s,n[i]=s)},x2=(t,e,n,r,i,s,a,o,l,u)=>{let h=t.length-2,f=u.length===0;l.length<h&&l.push(...Array(h-l.length).fill(0));let p=t[0],g=e[o?3:1]*i;for(let _=0,x=t.length-h-(o?1:0);_<h;++_,++x){let $=t[x],w=f?$*a[_]:u[_],y=w2($,a[_],s[_],e[x],n[_],w);b2(y,r,s,_,_+h),f&&u.push(a[_]*($-1)+l[_]+(e[x]-1)*n[_]+1-s[_]-s[_+h])}u.splice(0,0,p),u.splice(o?3:1,0,g)},Vm=(t,e)=>{let n=t.kernelShape.slice();if(t.kernelShape.length===0||t.kernelShape.reduce((f,p)=>f*p,1)===0){n.length=0;for(let f=2;f<e[1].dims.length;++f)n.push(e[1].dims[f])}let r=t.format==="NHWC";n.splice(0,0,e[1].dims[0]),n.splice(r?3:1,0,e[1].dims[1]);let i=t.pads.slice(),s=t.outputShape.slice(),a=t.outputPadding.slice(),o=e[0].dims,l=t.dilations.slice();if(l.reduce((f,p)=>f+p,0)===0){let f=e[0].dims.length-2;l=new Array(f).fill(1)}let u=t.strides.slice();if(u.reduce((f,p)=>f+p,0)===0){let f=e[0].dims.length-2;u=new Array(f).fill(1)}x2(o,n,l,t.autoPad,t.group,i,u,r,a,s);let h=Object.assign({},t);return Object.assign(h,{kernelShape:n,pads:i,outputPadding:a,outputShape:s,dilations:l,strides:u}),h},UR=t=>{let e=t0(t),n=t.format,r=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof t.autoPad>"u"?0:t.autoPad],i=t.dilations,s=t.group,a=t.kernelShape,o=t.pads,l=t.strides,u=t.wIsConst(),h=t.outputPadding,f=t.outputShape;return{autoPad:r,format:n,dilations:i,group:s,kernelShape:a,outputPadding:h,outputShape:f,pads:o,strides:l,wIsConst:u,...e,cacheKey:`${t.format};${e.activation};`}},E2=(t,e)=>{if(!t||t.length!==2&&t.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(t[0].dims.length!==4&&t[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(t[0].dims.length!==t[1].dims.length)throw new Error("filter does not have same dimension as input");let n=t[0].dims[e.format==="NHWC"?t[0].dims.length-1:1],r=t[1].dims[0];if(n!==r)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let i=t[1].dims[1]*e.group;if(t.length===3&&(t[2].dims.length!==1||t[2].dims[0]!==i))throw new Error("invalid bias");let s=t[0].dims.length-2;if(e.dilations.reduce((a,o)=>a+o,0)>0&&e.dilations.length!==s)throw new Error(`dilations should be ${s}D`);if(e.strides.reduce((a,o)=>a+o,0)>0&&e.strides.length!==s)throw new Error(`strides should be ${s}D`);if(e.pads.reduce((a,o)=>a+o,0)>0&&e.pads.length!==s*2)throw new Error(`pads should be ${s*2}D`);if(e.outputPadding.length!==s&&e.outputPadding.length!==0)throw new Error(`output_padding should be ${s}D`);if(e.kernelShape.reduce((a,o)=>a+o,0)>0&&e.kernelShape.length!==0&&e.kernelShape.length!==t[1].dims.length-2)throw new Error("invalid kernel shape");if(e.outputShape.length!==0&&e.outputShape.length!==t[0].dims.length-2)throw new Error("invalid output shape")},jm=(t,e,n,r)=>{let i=t.kernelCustomData.wT??t.compute(Ln(e[1],[2,3,0,1]),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=i);let s=[e[0],i];e.length===3&&s.push(e[2]),t.compute(jR(s,n,r),{inputs:s})},T2=(t,e)=>{let n=e.format==="NHWC",r=[t.inputs[0].reshape(n?[t.inputs[0].dims[0],1,t.inputs[0].dims[1],t.inputs[0].dims[2]]:[t.inputs[0].dims[0],t.inputs[0].dims[1],1,t.inputs[0].dims[2]]),t.inputs[1].reshape([t.inputs[1].dims[0],t.inputs[1].dims[1],1,t.inputs[1].dims[2]])];t.inputs.length===3&&r.push(t.inputs[2]);let i=e.kernelShape;(i.length===0||i[0]===0)&&(i=[t.inputs[1].dims[2]]);let s=e.dilations;(s.length===0||s[0]===0)&&(s=[1]);let a=e.strides;(a.length===0||a[0]===0)&&(a=[1]);let o=e.pads;o.length===0&&(o=[0,0]),o=[0,o[0],0,o[1]],a=[1].concat(a),s=[1].concat(s),i=[1].concat(i);let l=e.outputPadding;l=[0].concat(l);let u=Vm({...e,pads:o,strides:a,dilations:s,kernelShape:i,outputPadding:l},r);jm(t,r,u,h=>n?[h[0],h[2],h[3]]:[h[0],h[1],h[3]])},BR=(t,e)=>{if(E2(t.inputs,e),t.inputs[0].dims.length===3)T2(t,e);else{let n=Vm(e,t.inputs);jm(t,t.inputs,n)}}}),I2,FR,WR,iB=se(()=>{$e(),Ce(),yt(),Ae(),I2=(t,e,n,r)=>{let i=X.size(e),s=e.length,a=te("input",t,s),o=ye("output",t,s),l=n.dataType===6?n.getInt32Array()[0]:Number(n.getBigInt64Array()[0]),u=X.normalizeAxis(l,s),h=f=>{let p=` i32(${a.indicesGet("inputIndices","uniforms.axis")}) `,g=we("uniforms.input_shape","uniforms.axis",s),_=r.reverse?p+(r.exclusive?" + 1":""):"0",x=r.reverse?g:p+(r.exclusive?"":" + 1");return`
                ${f.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(a,o)}
                ${f.mainStart()}
                  ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${o.offsetToIndices("global_idx")};
                  var sum = ${o.type.value}(0);
                  let first : i32 = ${_};
                  let last : i32 = ${x};
                  for (var i : i32 = first; i < last; i++) {
                    ${a.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${a.getByIndices("inputIndices")};
                  }
                  ${o.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:r.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:e,dataType:t}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:[{type:12,data:i},{type:12,data:u},...xe(e,e)]}),getShaderSource:h}},FR=(t,e)=>{let n=t.inputs[0].dims,r=t.inputs[0].dataType,i=t.inputs[1];t.compute(I2(r,n,i,e),{inputs:[0]})},WR=t=>{let e=t.exclusive===1,n=t.reverse===1;return qe({exclusive:e,reverse:n})}}),$2,k2,S2,qR,HR,sB=se(()=>{$e(),Ce(),yt(),Ae(),$2=t=>{if(!t||t.length!==1)throw new Error("DepthToSpace requires 1 input.");if(t[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},k2=(t,e,n,r)=>{let i=[];i.push(`fn perm(i: ${r.type.indices}) -> ${n.type.indices} {
    var a: ${n.type.indices};`);for(let s=0;s<e;++s)i.push(n.indicesSet("a",t[s],`i[${s}]`));return i.push("return a;}"),i.join(`
`)},S2=(t,e)=>{let n,r,i,s,a,o,l=e.format==="NHWC",u=e.blocksize,h=e.mode==="DCR";l?([n,r,i,s]=t.dims,a=h?[n,r,i,u,u,s/u**2]:[n,r,i,s/u**2,u,u],o=h?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([n,r,i,s]=[t.dims[0],t.dims[2],t.dims[3],t.dims[1]],a=h?[n,u,u,s/u**2,r,i]:[n,s/u**2,u,u,r,i],o=h?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let f=t.reshape(a),p=f.dims.length,g=t.dataType,_=te("a",g,p),x=ye("output",g,p),$=w=>`
  ${w.registerUniform("output_size","u32").declareVariables(_,x)}

  ${k2(o,p,_,x)}

  ${w.mainStart()}
    ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${x.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${x.setByOffset("global_idx",_.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${t.dims};${e.blocksize};${e.mode}`,inputDependencies:["rank"]},getRunData:w=>{let y=l?[n,r*u,i*u,s/u**2]:[n,s/u**2,r*u,i*u],I=X.size(y),R=f.dims,M=X.sortBasedOnPerm(R,o);return{outputs:[{dims:y,dataType:w[0].dataType}],dispatchGroup:{x:Math.ceil(I/64)},programUniforms:[{type:12,data:I},...xe(R,M)]}},getShaderSource:$}},qR=(t,e)=>{$2(t.inputs),t.compute(S2(t.inputs[0],e))},HR=t=>qe({blocksize:t.blocksize,mode:t.mode,format:t.format})}),Kd,Zl,Um,C2,A2,R2,N2,Bm,P2,GR,KR,aB=se(()=>{$e(),Ce(),yt(),Ae(),Kd="[a-zA-Z]|\\.\\.\\.",Zl="("+Kd+")+",Um="^"+Zl+"$",C2="("+Zl+",)*"+Zl,A2="^"+C2+"$",R2=class{constructor(t=-1){this.symbolToIndices=new Map,this.inputIndex=t}addSymbol(t,e){let n=this.symbolToIndices.get(t);n===void 0?n=[e]:n.push(e),this.symbolToIndices.set(t,n)}},N2=class{constructor(t,e){var i;this.equation=e,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[n,r]=e.includes("->")?e.split("->",2):[e,""];if(!n.match(RegExp(A2)))throw new Error("Invalid LHS term");if(n.split(",").forEach((s,a)=>{let o=t[a].dims.slice();if(!s.match(RegExp(Um)))throw new Error("Invalid LHS term");let l=this.processTerm(s,!0,o,a);this.lhs.push(l)}),r==="")r+=[...this.symbolToInfo.entries()].filter(([s,a])=>a.count===1||s==="...").map(([s])=>s).join("");else if(!r.match(RegExp(Zl)))throw new Error("Invalid RHS");(i=r.match(RegExp(Kd,"g")))==null||i.forEach(s=>{if(s==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let a=this.symbolToInfo.get(s);if(a===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(a.dimValue)}}),this.rhs=this.processTerm(r,!1,this.outputDims)}addSymbol(t,e,n){let r=this.symbolToInfo.get(t);if(r!==void 0){if(r.dimValue!==e&&r.count!==1)throw new Error("Dimension mismatch");r.count++,r.inputIndices.push(n)}else r={count:1,dimValue:e,inputIndices:[n]};this.symbolToInfo.set(t,r)}processTerm(t,e,n,r=-1){let i=n.length,s=!1,a=[],o=0;if(!t.match(RegExp(Um))&&!e&&t!=="")throw new Error("Invalid LHS term");let l=t.match(RegExp(Kd,"g")),u=new R2(r);return l==null||l.forEach((h,f)=>{if(h==="..."){if(s)throw new Error("Only one ellipsis is allowed per input term");s=!0;let p=i-l.length+1;if(p<0)throw new Error("Ellipsis out of bounds");if(a=n.slice(o,o+p),this.hasEllipsis){if(this.ellipsisDims.length!==a.length||this.ellipsisDims.toString()!==a.toString())throw new Error("Ellipsis dimensions mismatch")}else if(e)this.hasEllipsis=!0,this.ellipsisDims=a;else throw new Error("Ellipsis must be specified in the LHS");for(let g=0;g<a.length;g++){let _=String.fromCharCode(48+g);u.addSymbol(_,f+g),this.addSymbol(_,n[o++],r)}}else u.addSymbol(h,f+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(h,n[o++],r)}),u}},Bm=t=>t+"_max",P2=(t,e,n,r)=>{let i=t.map(u=>u.length).map((u,h)=>te(`input${h}`,e,u)),s=X.size(r),a=ye("output",e,r.length),o=[...n.symbolToInfo.keys()].filter(u=>!n.rhs.symbolToIndices.has(u)),l=u=>{let h=[],f="var prod = 1.0;",p="var sum = 0.0;",g="sum += prod;",_=[],x=[],$=[],w=[],y=n.symbolToInfo.size===n.rhs.symbolToIndices.size;n.symbolToInfo.forEach((R,M)=>{var j;if(n.rhs.symbolToIndices.has(M)){let C=(j=n.rhs.symbolToIndices.get(M))==null?void 0:j[0];C!==void 0&&n.lhs.forEach((k,P)=>{if(R.inputIndices.includes(P)){let A=k.symbolToIndices.get(M);if(A===void 0)throw new Error("Invalid symbol error");A.forEach(D=>{h.push(`${i[P].indicesSet(`input${P}Indices`,D,a.indicesGet("outputIndices",C))}`)})}})}else n.lhs.forEach((C,k)=>{if(R.inputIndices.includes(k)){let P=C.symbolToIndices.get(M);if(P===void 0)throw new Error("Invalid symbol error");P.forEach(A=>{_.push(`${i[k].indicesSet(`input${k}Indices`,A,`${M}`)}`)}),w.push(`prod *= ${i[k].getByIndices(`input${k}Indices`)};`)}}),x.push(`for(var ${M}: u32 = 0; ${M} < uniforms.${Bm(M)}; ${M}++) {`),$.push("}")});let I=y?[...h,`let sum = ${i.map((R,M)=>R.getByIndices(`input${M}Indices`)).join(" * ")};`]:[...h,p,...x,..._,f,...w,g,...$];return`
            ${u.registerUniforms(o.map(R=>({name:`${Bm(R)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...i,a)}

            ${u.mainStart()}
            ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${a.offsetToIndices("global_idx")};
            ${i.map((R,M)=>`var input${M}Indices: ${i[M].type.indices};`).join(`
`)}
            ${I.join(`
`)};
            ${a.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:n.equation,inputDependencies:t.map(()=>"rank")},getRunData:()=>{let u=o.filter(f=>n.symbolToInfo.has(f)).map(f=>{var p;return{type:12,data:((p=n.symbolToInfo.get(f))==null?void 0:p.dimValue)||0}});u.push({type:12,data:s});let h=t.map((f,p)=>[...xe(f)]).reduce((f,p)=>f.concat(p),u);return h.push(...xe(r)),{outputs:[{dims:r,dataType:e}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:h}},getShaderSource:l}},GR=(t,e)=>{let n=new N2(t.inputs,e.equation),r=n.outputDims,i=t.inputs.map((s,a)=>s.dims);t.compute(P2(i,t.inputs[0].dataType,n,r))},KR=t=>{let e=t.equation.replace(/\s+/g,"");return qe({equation:e})}}),O2,Fm,D2,M2,QR,oB=se(()=>{$e(),Ce(),Ae(),O2=t=>{if(!t||t.length!==2)throw new Error("Expand requires 2 input.");let e=t[0].dims,n=Array.from(t[1].getBigInt64Array(),Number),r=n.length<e.length?0:n.length-e.length,i=e.length<n.length?0:e.length-n.length;for(;r<n.length&&i<e.length;++r,++i)if(n[r]!==e[i]&&n[r]!==1&&e[i]!==1)throw new Error("Expand requires shape to be broadcastable to input")},Fm=(t,e)=>{let n=t.length-e.length,r=[];for(let i=0;i<n;++i)r.push(t[i]);for(let i=0;i<e.length;++i)r.push(e[i]===1?t[i+n]:e[i]);return r},D2=(t,e)=>t.length>e.length?Fm(t,e):Fm(e,t),M2=t=>{let e=t[0].dims,n=Array.from(t[1].getBigInt64Array(),Number),r=D2(e,n),i=t[0].dataType,s=i===9||X.size(e)===1,a=i===9||e.length>0&&e[e.length-1]%4===0?4:1,o=s||r.length>0&&r[r.length-1]%4===0?4:1,l=Math.ceil(X.size(r)/o),u=f=>{let p=te("input",i,e.length,a),g=ye("output",i,r.length,o),_;if(i===9){let x=($,w,y="")=>`
          let outputIndices${w} = ${g.offsetToIndices(`outputOffset + ${w}u`)};
          let offset${w} = ${p.broadcastedIndicesToOffset(`outputIndices${w}`,g)};
          let index${w} = offset${w} / 4u;
          let component${w} = offset${w} % 4u;
          ${$}[${w}] = ${y}(${p.getByOffset(`index${w}`)}[component${w}]);
        `;_=`
        let outputOffset = global_idx * ${o};
        var data = vec4<u32>(0);
        ${x("data",0,"u32")}
        ${x("data",1,"u32")}
        ${x("data",2,"u32")}
        ${x("data",3,"u32")}
        ${g.setByOffset("global_idx","data")}
      }`}else _=`
        let outputIndices = ${g.offsetToIndices(`global_idx * ${o}`)};
        let inputOffset = ${p.broadcastedIndicesToOffset("outputIndices",g)};
        let data = ${g.type.value}(${p.getByOffset(`inputOffset / ${a}`)});
        ${g.setByOffset("global_idx","data")}
      }`;return`
    ${f.registerUniform("vec_size","u32").declareVariables(p,g)}
    ${f.mainStart()}
    ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${_}`},h=[{type:12,data:l},...xe(e,r)];return{name:"Expand",shaderCache:{hint:`${r.length};${a}${o}`,inputDependencies:["rank"]},getShaderSource:u,getRunData:()=>({outputs:[{dims:r,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:h})}},QR=t=>{O2(t.inputs),t.compute(M2(t.inputs),{inputs:[0]})}}),L2,YR,lB=se(()=>{$e(),Ce(),Ae(),e0(),L2=t=>{let e=t[0].dataType,n=X.size(t[0].dims),r=X.size(t[1].dims),i=r%4===0,s=a=>{let o=te("x",e,[1],4),l=te("bias",e,[1],4),u=ye("y",e,[1],4),h=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],f=g=>`
      let bias${g}_offset: u32 = (global_idx * 4 + ${g}) % uniforms.bias_size;
      let bias${g} = ${l.getByOffset(`bias${g}_offset / 4`)}[bias${g}_offset % 4];`,p=i?`
      let bias = ${l.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${f(0)}${f(1)}${f(2)}${f(3)}
      let bias = ${o.type.value}(bias0, bias1, bias2, bias3);`;return`${a.registerUniforms(h).declareVariables(o,l,u)}

    ${Ly(tn(e))}

    ${a.mainStart(Qo)}
      ${a.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${o.getByOffset("global_idx")};
      ${p}
      let x_in = x + bias;
      ${u.setByOffset("global_idx",zy("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${i}`,inputDependencies:["type","type"]},getShaderSource:s,getRunData:a=>({outputs:[{dims:a[0].dims,dataType:a[0].dataType}],programUniforms:[{type:12,data:Math.ceil(n/4)},{type:12,data:r}],dispatchGroup:{x:Math.ceil(n/Qo/4)}})}},YR=t=>{t.inputs.length<2||X.size(t.inputs[1].dims)===0?gR(t):t.compute(L2(t.inputs))}}),z2,V2,JR,XR,uB=se(()=>{$e(),Ce(),yt(),Ae(),z2=t=>{if(!t||t.length!==2)throw new Error("Gather requires 2 inputs.")},V2=(t,e)=>{let n=t[0].dims,r=t[1].dims,i=n.length,s=X.normalizeAxis(e.axis,i),a=n.slice(0);a.splice(s,1,...r);let o=n[s],l=t[0].dataType===9?4:1,u=Math.ceil(X.size(a)/l),h=[{type:12,data:u},{type:6,data:o},{type:12,data:s},...xe(t[0].dims,t[1].dims,a)],f=p=>{let g=te("data",t[0].dataType,t[0].dims.length,l),_=te("inputIndices",t[1].dataType,t[1].dims.length),x=ye("output",t[0].dataType,a.length,l),$=y=>{let I=r.length,R=`var indicesIndices${y}  = ${_.type.indices}(0);`;for(let M=0;M<I;M++)R+=`${I>1?`indicesIndices${y}[${M}]`:`indicesIndices${y}`} = ${a.length>1?`outputIndices${y}[uniforms.axis + ${M}]`:`outputIndices${y}`};`;R+=`
          var idx${y} = ${_.getByIndices(`indicesIndices${y}`)};
          if (idx${y} < 0) {
            idx${y} = idx${y} + uniforms.axisDimLimit;
          }
          var dataIndices${y} : ${g.type.indices};
        `;for(let M=0,j=0;M<i;M++)M===s?(R+=`${i>1?`dataIndices${y}[${M}]`:`dataIndices${y}`} = u32(idx${y});`,j+=I):(R+=`${i>1?`dataIndices${y}[${M}]`:`dataIndices${y}`} = ${a.length>1?`outputIndices${y}[${j}]`:`outputIndices${y}`};`,j++);return R},w;if(t[0].dataType===9){let y=(I,R,M="")=>`
          let outputIndices${R} = ${x.offsetToIndices(`outputOffset + ${R}u`)};
          ${$(R)};
          let offset${R} = ${g.indicesToOffset(`dataIndices${R}`)};
          let index${R} = offset${R} / 4u;
          let component${R} = offset${R} % 4u;
          ${I}[${R}] = ${M}(${g.getByOffset(`index${R}`)}[component${R}]);
        `;w=`
        let outputOffset = global_idx * ${l};
        var value = vec4<u32>(0);
        ${y("value",0,"u32")}
        ${y("value",1,"u32")}
        ${y("value",2,"u32")}
        ${y("value",3,"u32")}
        ${x.setByOffset("global_idx","value")}
      `}else w=`
      let outputIndices = ${x.offsetToIndices("global_idx")};
      ${$("")};
      let value = ${g.getByIndices("dataIndices")};
      ${x.setByOffset("global_idx","value")};
      `;return`
      ${p.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(g,_,x)}
      ${p.mainStart()}
        ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${w}
      }`};return{name:"Gather",shaderCache:{hint:e.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:a,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:h}),getShaderSource:f}},JR=t=>qe({axis:t.axis}),XR=(t,e)=>{let n=t.inputs;z2(n),t.compute(V2(t.inputs,e))}}),j2,ZR,e3,cB=se(()=>{$e(),Ce(),Ae(),j2=(t,e,n,r,i,s,a,o,l)=>{let u=[{type:12,data:s},{type:12,data:r},{type:12,data:i},{type:12,data:n},{type:12,data:a},{type:12,data:o},{type:12,data:l}],h=[s];u.push(...xe(e.dims,h));let f=p=>{let g=te("indices_data",e.dataType,e.dims.length),_=ye("input_slice_offsets_data",12,1,1),x=[g,_],$=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:i.length},{name:"sizes_from_slice_dims_data",type:"u32",length:n.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${p.registerUniforms($).declareVariables(...x)}
  ${p.mainStart()}
    ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${i.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${n.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return t.compute({name:"computeSliceOffsets",shaderCache:{hint:`${i.length}_${n.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:h,dataType:t.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:u}),getShaderSource:f},{inputs:[e],outputs:[-1]})[0]},ZR=(t,e)=>{let n=t.inputs,r=n[0].dims,i=n[0].dataType,s=n[1].dims,a=s[s.length-1],o=X.sizeToDimension(s,s.length-1),l=X.sizeFromDimension(r,e.batchDims+a),u=X.sizeToDimension(r,e.batchDims),h=X.sizeFromDimension(r,e.batchDims),f=o/u,p=new Array(a),g=l;for(let R=0;R<a;++R)p[a-1-R]=g,g*=r[e.batchDims+a-1-R];let _=j2(t,n[1],p,e.batchDims,r,o,f,h,a),x=e.batchDims+a;if(x>r.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let $=s.slice(0,-1).concat(r.slice(x)),w=X.size($),y=[{type:12,data:w},{type:12,data:l},...xe(n[0].dims,_.dims,$)],I=R=>{let M=te("data",n[0].dataType,n[0].dims.length),j=te("slice_offsets",12,_.dims.length),C=ye("output",n[0].dataType,$.length);return`
          ${R.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(M,j,C)}
            ${R.mainStart()}
            ${R.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};t.compute({name:"GatherND",shaderCache:{hint:e.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:$,dataType:i}],dispatchGroup:{x:Math.ceil(w/64)},programUniforms:y}),getShaderSource:I},{inputs:[n[0],_]})},e3=t=>({batchDims:t.batch_dims,cacheKey:""})}),U2,B2,t3,n3,dB=se(()=>{$e(),Ce(),yt(),Ae(),U2=(t,e)=>{if(t.length<3||t.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let n=X.normalizeAxis(e.quantizeAxis,t[0].dims.length),r=e.blockSize,i=t[0],s=t[2],a=t.length===4?t[3]:void 0;if(s.dims.length!==i.dims.length||!i.dims.map((o,l)=>l===n?Math.ceil(o/r)===s.dims[l]:o===s.dims[l]).reduce((o,l)=>o&&l,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(a){if(a.dataType!==i.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(a.dims.length!==s.dims.length||!a.dims.map((o,l)=>o===s.dims[l]).reduce((o,l)=>o&&l,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},B2=(t,e)=>{let n=t[0].dims,r=t[1].dims,i=n.length,s=X.normalizeAxis(e.gatherAxis,i),a=X.normalizeAxis(e.quantizeAxis,i),o=n.slice(0);o.splice(s,1,...r);let l=X.size(o),u=t[2].dataType,h=t[0].dataType===22,f=[{type:12,data:l},{type:12,data:a},{type:12,data:s},{type:12,data:e.blockSize},...xe(...t.map((g,_)=>g.dims),o)],p=g=>{let _=te("data",t[0].dataType,t[0].dims.length),x=te("inputIndices",t[1].dataType,t[1].dims.length),$=te("scales",t[2].dataType,t[2].dims.length),w=t.length>3?te("zeroPoint",t[3].dataType,t[3].dims.length):void 0,y=ye("output",u,o.length),I=[_,x,$];w&&I.push(w);let R=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${g.registerUniforms(R).declareVariables(...I,y)}
        ${g.mainStart()}
        let output_indices = ${y.offsetToIndices("global_idx")};
        var indices_indices = ${x.type.indices}(0);
        ${r.length>1?`
          for (var i: u32 = 0; i < ${r.length}; i++) {
            let index = ${y.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${x.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${y.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${_.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${y.indicesGet("output_indices","i")};
          ${_.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${x.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${n[s]};
        }
        ${_.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${o.length}; i++) {
          let index = ${y.indicesGet("output_indices",`i + ${r.length} - 1`)};
          ${_.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${_.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${_.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${h?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${$.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${$.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${$.getByIndices("scale_indices")};
        ${w?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${w.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${w.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${h?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${tn(u)}(quantized_data - zero_point) * scale;
        ${y.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${e.cacheKey};${t.filter((g,_)=>_!==1).map(g=>g.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:t.length},(g,_)=>"rank")},getRunData:()=>({outputs:[{dims:o,dataType:u}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:f}),getShaderSource:p}},t3=(t,e)=>{let n=t.inputs;U2(n,e),t.compute(B2(t.inputs,e))},n3=t=>qe({blockSize:t.blockSize,gatherAxis:t.gatherAxis,quantizeAxis:t.quantizeAxis})}),F2,W2,r3,i3,hB=se(()=>{$e(),Ce(),yt(),Ae(),F2=t=>{if(!t||t.length!==2)throw new Error("GatherElements requires 2 inputs.");if(t[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(t[0].dims.length!==t[1].dims.length)throw new Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},W2=(t,e)=>{let n=t[0].dims,r=t[0].dataType,i=n.length,s=t[1].dims,a=t[1].dataType,o=X.normalizeAxis(e.axis,i),l=n[o],u=s.slice(0),h=X.size(u),f=te("input",r,i),p=te("indicesInput",a,s.length),g=ye("output",r,u.length),_=[{type:12,data:h},{type:6,data:l},{type:12,data:o}];return _.push(...xe(n,s,u)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:u,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:_}),getShaderSource:x=>`
      ${x.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(f,p,g)}
      ${x.mainStart()}
      ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${g.offsetToIndices("global_idx")};

      var idx = ${p.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${f.type.indices}(outputIndices);
      ${f.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${f.getByIndices("inputIndices")};

      ${g.setByOffset("global_idx","value")};
  }`}},r3=t=>qe({axis:t.axis}),i3=(t,e)=>{let n=t.inputs;F2(n),t.compute(W2(t.inputs,e))}}),q2,H2,s3,a3,fB=se(()=>{$e(),Ce(),Ae(),q2=t=>{if(!t)throw new Error("Input is missing");if(t.length<2||t.length>3)throw new Error("Invaid input number.");if(t.length===3&&t[2].dims.length>2)throw new Error("Invalid input shape of C");if(t[0].dataType!==t[1].dataType||t.length===3&&t[0].dataType!==t[2].dataType)throw new Error("Input types are mismatched")},H2=(t,e)=>{let n=t[0].dims.slice(),r=t[1].dims.slice(),[i,s,a]=rA.getShapeOfGemmResult(n,e.transA,r,e.transB,t.length===3?t[2].dims:void 0),o=[i,s];if(!o)throw new Error("Can't use gemm on the given tensors");let l=16,u=Math.ceil(s/l),h=Math.ceil(i/l),f=!0,p=X.size(o),g=[{type:12,data:f?u:p},{type:12,data:i},{type:12,data:s},{type:12,data:a},{type:1,data:e.alpha},{type:1,data:e.beta}],_=["type","type"];t.length===3&&(g.push(...xe(t[2].dims)),_.push("rank")),g.push(...xe(o));let x=w=>{let y="";e.transA&&e.transB?y="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":e.transA&&!e.transB?y="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!e.transA&&e.transB?y="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!e.transA&&!e.transB&&(y="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let I=e.alpha===1?"":"value *= uniforms.alpha;",R=te("a",t[0].dataType,t[0].dims),M=te("b",t[1].dataType,t[1].dims),j=R.type.value,C=null,k=[R,M];t.length===3&&(C=te("c",t[2].dataType,t[2].dims.length),k.push(C));let P=ye("output",t[0].dataType,o.length);k.push(P);let A=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`
  ${w.registerUniforms(A).declareVariables(...k)}

  ${w.mainStart()}
    ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let m = global_idx / uniforms.N;
    let n = global_idx % uniforms.N;

    var value = ${j}(0);
    for (var k: u32 = 0u; k < uniforms.K; k++) {
      ${y}
    }

    ${I}
    ${C!=null?`let cOffset = ${C.broadcastedIndicesToOffset("vec2(m, n)",P)}; value += ${j}(uniforms.beta) * ${C.getByOffset("cOffset")};`:""}
    output[global_idx] = value;
  }`},$=w=>{let y=te("a",t[0].dataType,t[0].dims),I=te("b",t[1].dataType,t[1].dims),R=null,M=[y,I];t.length===3&&(R=te("c",t[2].dataType,t[2].dims.length),M.push(R));let j=ye("output",t[0].dataType,o.length);M.push(j);let C=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],k="",P="";e.transA&&e.transB?(P=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${y.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${I.type.value}(0);
      }
      `,k="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):e.transA&&!e.transB?(P=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${y.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${I.type.value}(0);
      }
      `,k="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!e.transA&&e.transB?(P=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${y.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${I.type.value}(0);
      }
      `,k="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!e.transA&&!e.transB&&(P=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${y.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${I.type.value}(0);
      }
      `,k="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let A=e.alpha===1?"":"value *= uniforms.alpha;";return`
  ${w.registerUniforms(C).declareVariables(...M)}
  var<workgroup> tile_a: array<array<${y.type.storage}, ${l}>, ${l}>;
  var<workgroup> tile_b: array<array<${I.type.storage}, ${l}>, ${l}>;
  ${w.mainStart([l,l,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${l};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${l};
    let num_tiles = (uniforms.K - 1) / ${l} + 1;
    var k_start = 0u;
    var value = ${j.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${P}
      k_start = k_start + ${l};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${l}; k++) {
        ${k}
      }
      workgroupBarrier();
    }

    ${A}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${R!=null?`let cOffset = ${R.broadcastedIndicesToOffset("vec2(m, n)",j)}; value += ${j.type.value}(uniforms.beta) * ${R.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return f?{name:"GemmShared",shaderCache:{hint:`${e.cacheKey}`,inputDependencies:_},getRunData:()=>({outputs:[{dims:o,dataType:t[0].dataType}],dispatchGroup:{x:u*h},programUniforms:g}),getShaderSource:$}:{name:"Gemm",shaderCache:{hint:`${e.cacheKey}`,inputDependencies:_},getRunData:()=>({outputs:[{dims:o,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:g}),getShaderSource:x}},s3=t=>{let e=t.transA,n=t.transB,r=t.alpha,i=t.beta;return{transA:e,transB:n,alpha:r,beta:i,cacheKey:`${t.transA};${t.transB};${t.alpha===1}`}},a3=(t,e)=>{q2(t.inputs),t.compute(H2(t.inputs,e))}}),zr,ui,Qs,Ys,G2,K2,Q2,Y2,J2,X2,Z2,eE,o3,l3,pB=se(()=>{$e(),Ce(),yt(),Ae(),[zr,ui,Qs,Ys]=[0,1,2,3],G2=t=>{if(t[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(t[0].dims.length!==t[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(t[0].dims.length-2!==t[1].dims[t[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${t[0].dims.length-2}`);if(t[0].dims[0]!==t[1].dims[0])throw new Error("grid batch size must match input batch size")},K2=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,Q2=t=>`
  fn gs_bicubic_interpolate(p: mat4x4<${t}>, x: f32, y: f32) -> ${t} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${t}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,Y2=t=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${t.alignCorners===0?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,J2=t=>`
  ${t.paddingMode==="reflection"?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,X2=(t,e,n)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${e} {
     var pixel = ${e}(0);
     var indices = vec4<u32>(0);
     indices[${zr}] = batch;
     indices[${ui}] = channel;`+(()=>{switch(n.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${Qs}] = u32(r);
            indices[${Ys}] = u32(c);
          } else {
            return ${e}(0);
          }
        `;case"border":return`
          indices[${Qs}] = u32(clamp(r, 0, H - 1));
          indices[${Ys}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${Qs}] = gs_reflect(r, border[1], border[3]);
          indices[${Ys}] = gs_reflect(c, border[0], border[2]);
        `;default:throw new Error(`padding mode ${n.paddingMode} is not supported`)}})()+`
    return ${t.getByIndices("indices")};
  }
`,Z2=(t,e,n)=>(()=>{switch(n.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${zr}], indices[${ui}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${zr}], indices[${ui}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${zr}], indices[${ui}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${zr}], indices[${ui}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${zr}], indices[${ui}], border);

          let dx2 = ${e}(f32(x2) - x);
          let dx1 = ${e}(x - f32(x1));
          let dy2 = ${e}(f32(y2) - y);
          let dy1 = ${e}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${e}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${zr}], indices[${ui}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw new Error(`mode ${n.mode} is not supported`)}})()+`${t.setByOffset("global_idx","result")}`,eE=(t,e)=>{let n=te("x",t[0].dataType,t[0].dims.length),r=[t[1].dims[0],t[1].dims[1],t[1].dims[2]],i=te("grid",t[1].dataType,r.length,2),s=[t[0].dims[0],t[0].dims[1],t[1].dims[1],t[1].dims[2]];e.format==="NHWC"&&(s=[t[0].dims[0],t[1].dims[1],t[1].dims[2],t[0].dims[3]],[zr,ui,Qs,Ys]=[0,3,1,2]);let a=ye("output",t[0].dataType,s.length),o=n.type.value,l=X.size(s),u=[{type:12,data:l},...xe(t[0].dims,r,s)],h=f=>`
  ${f.registerUniform("output_size","u32").declareVariables(n,i,a)}
  ${K2}
  ${Q2(o)}
  ${Y2(e)}
  ${J2(e)}
  ${X2(n,o,e)}

  ${f.mainStart()}
    ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${Qs}]);
      let W_in = i32(uniforms.x_shape[${Ys}]);

      ${e.alignCorners===0?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${a.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${zr}], indices[${Qs}], indices[${Ys}]);
      let nxy = ${i.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${Z2(a,o,e)}
  }`;return{name:"GridSample",shaderCache:{hint:`${e.cacheKey}`,inputDependencies:["type","type"]},getRunData:f=>{let p=X.size(s);return{outputs:[{dims:s,dataType:f[0].dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:u}},getShaderSource:h}},o3=(t,e)=>{G2(t.inputs),t.compute(eE(t.inputs,e))},l3=t=>qe({alignCorners:t.align_corners,mode:t.mode,paddingMode:t.padding_mode,format:t.format})}),cn,tE,u3,Wm,nE,vu,c3,d3=se(()=>{$e(),Ce(),yt(),Yv(),Zv(),Ae(),Cs(),cn=(t,e)=>t.length>e&&t[e].dims.length>0?t[e]:void 0,tE=(t,e)=>{let n=t[0],r=cn(t,1),i=cn(t,2),s=cn(t,3),a=cn(t,4),o=cn(t,5),l=cn(t,6),u=cn(t,7);if(n.dims.length!==3&&n.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let h=n.dims[0],f=n.dims[1],p=n.dims.length===3?n.dims[2]:e.numHeads*n.dims[4],g=f,_=0,x=0,$=Math.floor(p/e.numHeads);if(l&&u&&X.size(l.dims)&&X.size(u.dims)){if(l.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(l.dims[0]!==h||l.dims[1]!==e.numHeads||l.dims[3]!==$)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(u.dims[0]!==h||u.dims[1]!==e.numHeads||u.dims[3]!==$)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(l.dims[2]!==u.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(u.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');_=l.dims[2],x=l.dims[2]}else if(l&&X.size(l.dims)||u&&X.size(u.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let w;if(r&&X.size(r.dims)>0){if(n.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(r.dims.length<3||r.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(n.dims[0]!==r.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(r.dims.length===3){if(r.dims[2]!==n.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');w=2,g=r.dims[1]}else if(r.dims.length===5){if(r.dims[2]!==e.numHeads||r.dims[3]!==2||r.dims[4]!==$)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(i)throw new Error('Expect "value" be none when "key" has packed kv format.');w=5,g=r.dims[1]}else{if(r.dims[1]!==e.numHeads||r.dims[3]!==$)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');w=0,g=r.dims[2]}}else{if(n.dims.length!==5)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(n.dims[2]!==e.numHeads||n.dims[3]!==3)throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');w=3}if(s&&X.size(s.dims)>0){if(s.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimension');if(r&&r.dims.length===5&&r.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let y=_+g,I=0;if(a&&X.size(a.dims)>0){I=8;let C=a.dims;throw C.length===1?C[0]===h?I=1:C[0]===3*h+2&&(I=3):C.length===2&&C[0]===h&&C[1]===y&&(I=5),I===8?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let R=!1,M=p;if(i&&X.size(i.dims)>0){if(i.dims.length!==3&&i.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(n.dims[0]!==i.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(i.dims.length===3){if(g!==i.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');M=i.dims[2]}else{if(g!==i.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');M=i.dims[1]*i.dims[3],R=!0}}let j=!1;if(a&&X.size(a.dims)>0)throw new Error("Key padding mask is not supported");if(o&&X.size(o.dims)>0){if(o.dims.length!==4)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(o.dims[0]!==h||o.dims[1]!==e.numHeads||o.dims[2]!==f||o.dims[3]!==y)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:h,sequenceLength:f,pastSequenceLength:_,kvSequenceLength:g,totalSequenceLength:y,maxSequenceLength:x,inputHiddenSize:0,hiddenSize:p,vHiddenSize:M,headSize:$,vHeadSize:Math.floor(M/e.numHeads),numHeads:e.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:e.maskFilterValue,maskType:I,scale:e.scale,broadcastResPosBias:j,passPastInKv:R,qkvFormat:w}},u3=t=>qe({...t}),Wm=qe({perm:[0,2,1,3]}),nE=(t,e,n,r,i,s,a)=>{let o=[r,i,s],l=X.size(o),u=[{type:12,data:l},{type:12,data:a},{type:12,data:s}],h=f=>{let p=ye("qkv_with_bias",e.dataType,o),g=te("qkv",e.dataType,o),_=te("bias",n.dataType,o),x=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${f.registerUniforms(x).declareVariables(g,_,p)}
  ${f.mainStart()}
    ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return t.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:o,dataType:e.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:u}),getShaderSource:h},{inputs:[e,n],outputs:[-1]})[0]},vu=(t,e,n,r,i,s,a,o)=>{let l=s;if(a&&X.size(a.dims)>0){if(r===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return l=nE(t,s,a,e,r,n*i,o),l=l.reshape([e,r,n,i]),n===1||r===1?l:t.compute(Ln(l,Wm.perm),{inputs:[l],outputs:[-1]})[0]}else return s.dims.length===3&&(l=s.reshape([e,r,n,i])),n===1||r===1?l:t.compute(Ln(l,Wm.perm),{inputs:[l],outputs:[-1]})[0]},c3=(t,e)=>{let n=tE(t.inputs,e),r=t.inputs[0],i=cn(t.inputs,1),s=cn(t.inputs,2),a=cn(t.inputs,3),o=cn(t.inputs,4),l=cn(t.inputs,5),u=cn(t.inputs,6),h=cn(t.inputs,7);if(r.dims.length===5)throw new Error("Packed QKV is not implemented");if((i==null?void 0:i.dims.length)===5)throw new Error("Packed KV is not implemented");let f=i&&s&&i.dims.length===4&&s.dims.length===4,p=vu(t,n.batchSize,n.numHeads,n.sequenceLength,n.headSize,r,a,0);if(f)return pc(t,p,i,s,o,void 0,u,h,l,n);if(!i||!s)throw new Error("key and value must be provided");let g=vu(t,n.batchSize,n.numHeads,n.kvSequenceLength,n.headSize,i,a,n.hiddenSize),_=vu(t,n.batchSize,n.numHeads,n.kvSequenceLength,n.vHeadSize,s,a,2*n.hiddenSize);pc(t,p,g,_,o,void 0,u,h,l,n)}}),rE,iE,sE,aE,Fy,h3,f3,p3=se(()=>{$e(),Ce(),yt(),Ae(),rE=t=>{if(!t||t.length<1)throw new Error("too few inputs")},iE=(t,e)=>{let n=[],r=e.numOutputs;return t[1].dims[0]>0&&(t[1].getBigInt64Array().forEach(i=>n.push(Number(i))),r=n.length),qe({numOutputs:r,axis:e.axis,splitSizes:n})},sE=t=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${t}u; i += 1u ) {
    if (index < ${we("uniforms.size_in_split_axis","i",t)}) {
        return i;
    }
    }
    return ${t}u;
}`,aE=t=>{let e=t.length,n=[];for(let r=0;r<e;++r){let i=t[r].setByIndices("indices","input[global_idx]");e===1?n.push(i):r===0?n.push(`if (output_number == ${r}u) { ${i} }`):r===e-1?n.push(`else { ${i} }`):n.push(`else if (output_number == ${r}) { ${i} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${t[0].type.indices}, global_idx: u32) {
        ${n.join(`
`)}
      }`},Fy=(t,e)=>{let n=t[0].dims,r=X.size(n),i=t[0].dataType,s=X.normalizeAxis(e.axis,n.length),a=new Array(e.numOutputs),o=te("input",i,n.length),l=new Array(e.numOutputs),u=[],h=[],f=0,p=[{type:12,data:r}];for(let _=0;_<e.numOutputs;_++){f+=e.splitSizes[_],l[_]=f;let x=n.slice();x[s]=e.splitSizes[_],h.push(x),a[_]=ye(`output${_}`,i,x.length),u.push({dims:h[_],dataType:t[0].dataType})}p.push({type:12,data:l},...xe(n,...h));let g=_=>`
  ${_.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",l.length).declareVariables(o,...a)}
  ${sE(l.length)}
  ${aE(a)}

  ${_.mainStart()}
    ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${o.offsetToIndices("global_idx")};
    var index = ${o.indicesGet("indices",s)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${we("uniforms.size_in_split_axis","output_number - 1u",l.length)};
      ${o.indicesSet("indices",s,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:e.cacheKey,inputDependencies:["rank"]},getShaderSource:g,getRunData:()=>({outputs:u,dispatchGroup:{x:Math.ceil(r/64)},programUniforms:p})}},h3=(t,e)=>{rE(t.inputs);let n=t.inputs.length===1?e:iE(t.inputs,e);t.compute(Fy(t.inputs,n),{inputs:[0]})},f3=t=>{let e=t.axis,n=t.splitSizes,r=t.numOutputs<0?n.length:t.numOutputs;if(r!==n.length)throw new Error("numOutputs and splitSizes length must be equal");return qe({axis:e,numOutputs:r,splitSizes:n})}}),oE,bf,m3,g3=se(()=>{$e(),Ce(),yt(),Ae(),oE=(t,e)=>{let[n,r,i,s]=t,{numHeads:a,rotaryEmbeddingDim:o}=e;if(n.dims.length!==3&&n.dims.length!==4)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${n.dims.length}`);if(!X.areEqual(r.dims,[])&&!X.areEqual(r.dims,[1])&&r.dims.length!==2)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${r.dims.length}`);if(i.dims.length!==2)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${i.dims.length}`);if(s.dims.length!==2)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${s.dims.length}`);if(!X.areEqual(i.dims,s.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(o>0&&a===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let l=n.dims[0],u=n.dims[n.dims.length-2],h=i.dims[0],f=X.sizeFromDimension(n.dims,1)/u,p=o===0?i.dims[1]*2:f/a;if(o>p)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(r.dims.length===2){if(l!==r.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${r.dims[0]}`);if(u!==r.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${r.dims[1]}`)}if(p/2!==i.dims[1]&&o/2!==i.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${i.dims[1]}`);if(u>h)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},bf=(t,e)=>{let{interleaved:n,numHeads:r,rotaryEmbeddingDim:i,scale:s}=e,a=t[0].dims[0],o=X.sizeFromDimension(t[0].dims,1),l=t[0].dims[t[0].dims.length-2],u=o/l,h=t[2].dims[1],f=i===0?h*2:u/r,p=new Array(a,l,u/f,f-h),g=X.computeStrides(p),_=[{type:1,data:s},{type:12,data:p},{type:12,data:g},...t[0].dims.length===3?new Array({type:12,data:[o,u,f,1]}):[],...t[0].dims.length===4?new Array({type:12,data:[o,f,l*f,1]}):[],...xe(t[0].dims,t[1].dims,t[2].dims,t[3].dims,t[0].dims)],x=$=>{let w=te("input",t[0].dataType,t[0].dims.length),y=te("position_ids",t[1].dataType,t[1].dims.length),I=te("cos_cache",t[2].dataType,t[2].dims.length),R=te("sin_cache",t[3].dataType,t[3].dims.length),M=ye("output",t[0].dataType,t[0].dims.length);return $.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:p.length},{name:"global_strides",type:"u32",length:g.length},{name:"input_output_strides",type:"u32",length:g.length}]),`
        ${$.declareVariables(w,y,I,R,M)}

        ${$.mainStart(Qo)}
          let half_rotary_emb_dim = uniforms.${I.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${$.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${y.broadcastedIndicesToOffset("bsnh.xy",ye("",y.type.tensor,2))};
            let position_id =
                u32(${y.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${n});
            let j = i + select(half_rotary_emb_dim, 1, ${n});
            let re = ${w.getByOffset("i")} * ${I.get("position_id","bsnh[3]")} -
                ${w.getByOffset("j")} * ${R.get("position_id","bsnh[3]")};
            ${M.setByOffset("i","re")}
            let im = ${w.getByOffset("i")} * ${R.get("position_id","bsnh[3]")} +
                ${w.getByOffset("j")} * ${I.get("position_id","bsnh[3]")};
            ${M.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${M.setByOffset("k",w.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:qe({interleaved:n}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:x,getRunData:()=>({outputs:[{dims:t[0].dims,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(X.size(p)/Qo)},programUniforms:_})}},m3=(t,e)=>{oE(t.inputs,e),t.compute(bf(t.inputs,e))}}),lE,uE,qm,cE,y3,mB=se(()=>{yt(),$e(),Zv(),d3(),p3(),Cs(),g3(),Ae(),lE=(t,e)=>{if(e.doRotary&&t.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let n=t[0],r=t[1],i=t[2],s=t[3],a=t[4];if(e.doRotary!==0&&t.length<=7)throw new Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(e.localWindowSize!==-1)throw new Error("Local attention is not supported");if(e.softcap!==0)throw new Error("Softcap is not supported");if(e.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(e.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(n.dims.length!==3&&n.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let o=!1,l=n.dims[0],u=n.dims[1],h=n.dims.length===3?o?n.dims[2]/3:n.dims[2]:e.numHeads*n.dims[4],f=u,p=0,g=!r||r.dims.length===0,_=Math.floor(g?h/(e.numHeads+2*e.kvNumHeads):h/e.numHeads);g&&(h=_*e.numHeads);let x=s&&s.dims.length!==0,$=a&&a.dims.length!==0;if(x&&s.dims.length===4&&s.dims[0]===l&&s.dims[1]!==e.kvNumHeads&&s.dims[2]===e.kvNumHeads&&s.dims[3]===_)throw new Error("BSNH pastKey/pastValue is not supported");if(x&&$){if(s.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(a.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');p=s.dims[2]}else if(x||$)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let w=1;if(r&&r.dims.length>0){if(n.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(r.dims.length<3||r.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(n.dims[0]!==r.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(r.dims.length===3){if(n.dims[2]%r.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');f=r.dims[1]}else if(r.dims.length===5){if(r.dims[2]!==e.numHeads||r.dims[3]!==2||r.dims[4]!==_)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(i)throw new Error('Expect "value" be none when "key" has packed kv format.');f=r.dims[1]}else{if(r.dims[1]!==e.numHeads||r.dims[3]!==_)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');f=r.dims[2]}}else{if(n.dims.length!==3&&n.dims.length!==5)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(n.dims.length===5&&(n.dims[2]!==e.numHeads||n.dims[3]!==3))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');w=3}let y=0,I=!1,R=e.kvNumHeads?_*e.kvNumHeads:h;if(i&&i.dims.length>0){if(i.dims.length!==3&&i.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(n.dims[0]!==i.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(i.dims.length===3){if(f!==i.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');R=i.dims[2]}else{if(f!==i.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');R=i.dims[1]*i.dims[3],I=!0}}let M=t.length>4?t[5]:void 0;if(M&&M.dims.length!==1&&M.dims[0]!==l)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:l,sequenceLength:u,pastSequenceLength:p,kvSequenceLength:f,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:h,vHiddenSize:R,headSize:_,vHeadSize:Math.floor(R/e.kvNumHeads),numHeads:e.numHeads,kvNumHeads:e.kvNumHeads,nReps:e.numHeads/e.kvNumHeads,pastPresentShareBuffer:!1,maskType:y,scale:e.scale,broadcastResPosBias:!1,passPastInKv:I,qkvFormat:w}},uE=qe({perm:[0,2,1,3]}),qm=(t,e,n)=>{let r=e,i=n.kvNumHeads;return e.dims.length===3&&n.kvSequenceLength!==0&&(r=e.reshape([n.batchSize,n.kvSequenceLength,i,n.headSize]),r=t.compute(Ln(r,uE.perm),{inputs:[r],outputs:[-1]})[0]),r},cE=(t,e,n,r)=>{let i=7,s=["type","type"],a=[t*e],o=t*e,l=[{type:12,data:o},{type:12,data:e},{type:12,data:t}],u=h=>{let f=te("seq_lens",n.dataType,n.dims),p=te("total_seq_lens",r.dataType,r.dims),g=ye("pos_ids",i,a),_=[{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}];return`
  ${h.registerUniforms(_).declareVariables(f,p,g)}
  ${h.mainStart()}
    ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let total_sequence_length = u32(${p.getByOffset("0")});
    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;
    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;
    let batch_idx = global_idx / uniforms.sequence_length;
    let sequence_idx = i32(global_idx % uniforms.sequence_length);
    var pos_id: i32 = 0;
    let seqlen = ${f.getByOffset("batch_idx")};
    let total_seqlen = seqlen + 1;
    if (is_first_prompt) {
      if (sequence_idx < total_seqlen) {
        pos_id = sequence_idx;
      } else {
        pos_id = 1;
      }
      ${g.setByOffset("global_idx","pos_id")}
    } else if (is_subsequent_prompt) {
      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);
      if (past_seqlen + sequence_idx < total_seqlen) {
        pos_id = past_seqlen + sequence_idx;
      } else {
        pos_id = 1;
      }
      ${g.setByOffset("global_idx","pos_id")}
    } else if (global_idx < uniforms.batch_size) {
      ${g.setByOffset("global_idx","seqlen")}
    };
  }
  `};return{name:"GeneratePositionIds",shaderCache:{hint:`${t};${e}`,inputDependencies:s},getRunData:()=>({outputs:[{dims:a,dataType:i}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:l}),getShaderSource:u}},y3=(t,e)=>{var R;let n=lE(t.inputs,e);if(t.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(((R=t.inputs[1])==null?void 0:R.dims.length)===5)throw new Error("Packed KV is not implemented");let r=t.inputs[0],i=t.inputs[1]&&t.inputs[1].dims.length>0?t.inputs[1]:void 0,s=t.inputs[2]&&t.inputs[2].dims.length>0?t.inputs[2]:void 0,a=t.inputs[3]&&t.inputs[3].dims.length!==0?t.inputs[3]:void 0,o=t.inputs[4]&&t.inputs[4].dims.length!==0?t.inputs[4]:void 0,l=t.inputs.length>4?t.inputs[5]:void 0,u=t.inputs.length>5?t.inputs[6]:void 0,h=n.kvNumHeads?n.kvNumHeads:n.numHeads,f=qe({axis:2,numOutputs:3,splitSizes:[n.numHeads*n.headSize,h*n.headSize,h*n.headSize]}),[p,g,_]=!i&&!s?t.compute(Fy([r],f),{inputs:[r],outputs:[-1,-1,-1]}):[r,i,s],x,$;if(e.doRotary){let M=t.compute(cE(n.batchSize,n.sequenceLength,l,u),{inputs:[l,u],outputs:[-1]})[0],j=t.inputs[7],C=t.inputs[8],k=qe({interleaved:e.rotaryInterleaved!==0,numHeads:n.numHeads,rotaryEmbeddingDim:0,scale:e.scale}),P=[p,M,j,C],A=[-1];x=t.compute(bf(P,k),{inputs:P,outputs:A})[0],P.splice(0,1,g);let D=qe({interleaved:e.rotaryInterleaved!==0,numHeads:n.kvNumHeads,rotaryEmbeddingDim:0,scale:e.scale});$=t.compute(bf(P,D),{inputs:P,outputs:A})[0]}let w=vu(t,n.batchSize,n.numHeads,n.sequenceLength,n.headSize,e.doRotary?x:p,void 0,0),y=qm(t,e.doRotary?$:g,n),I=qm(t,_,n);pc(t,w,y,I,void 0,void 0,a,o,void 0,n,l,u)}}),Hm,dE,hE,_3,gB=se(()=>{$e(),Ce(),Cs(),Ae(),Hm=(t,e,n,r,i,s,a,o)=>{let l=ht(s),u=l===1?"f32":`vec${l}f`,h=l===1?"vec2f":`mat2x${l}f`,f=i*a,p=64;f===1&&(p=256);let g=[i,a,s/l],_=[i,a,2],x=["rank","type","type"],$=[];$.push(...xe(g,_));let w=y=>{let I=te("x",e.dataType,3,l),R=te("scale",n.dataType,n.dims),M=te("bias",r.dataType,r.dims),j=ye("output",1,3,2),C=[I,R,M,j];return`
  var<workgroup> workgroup_shared : array<${h}, ${p}>;
  const workgroup_size = ${p}u;
  ${y.declareVariables(...C)}
  ${y.mainStart(p)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${u}(0);
    var squared_sum = ${u}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${u}(${I.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${h}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${bs("workgroup_shared[0][0]",l)} / f32(hight * ${l});
      let squared_sum_final = ${bs("workgroup_shared[0][1]",l)} / f32(hight * ${l});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${o}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return t.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${l};${o};${p}`,inputDependencies:x},getRunData:()=>({outputs:[{dims:_,dataType:1}],dispatchGroup:{x:f},programUniforms:$}),getShaderSource:w},{inputs:[e,n,r],outputs:[-1]})[0]},dE=(t,e,n)=>{let r=e[0].dims,i=r,s=2,a=r[0],o=r[1],l=X.sizeFromDimension(r,s),u=ht(l),h=X.size(i)/u,f=Hm(t,e[0],e[1],e[2],a,l,o,n.epsilon),p=[a,o,l/u],g=[a,o],_=["type","none"],x=$=>{let w=te("x",e[0].dataType,p.length,u),y=te("scale_shift",1,g.length,2),I=ye("output",e[0].dataType,p.length,u),R=[w,y,I];return`
  ${$.registerUniform("output_size","u32").declareVariables(...R)}
  ${$.mainStart()}
  ${$.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${I.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${y.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${w.getByOffset("global_idx")} * ${I.type.value}(scale_shift.x) + ${I.type.value}(scale_shift.y);
      ${I.setByOffset("global_idx","value")};
  }`};t.compute({name:"InstanceNormalization",shaderCache:{hint:`${u}`,inputDependencies:_},getRunData:()=>({outputs:[{dims:i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:[{type:12,data:h},...xe(p,g,p)]}),getShaderSource:x},{inputs:[e[0],f]})},hE=(t,e,n)=>{let r=e[0].dims,i=r,s=r[0],a=r[r.length-1],o=X.sizeFromDimension(r,1)/a,l=ht(a),u=X.size(i)/l,h=[{type:12,data:o},{type:12,data:Math.floor(a/l)}],f=["type","type"],p=!1,g=[0,r.length-1];for(let w=0;w<r.length-2;w++)p=p||r[w+1]!==1,g.push(w+1);p=p&&r[r.length-1]!==1;let _=p?t.compute(Ln(t.inputs[0],g),{inputs:[t.inputs[0]],outputs:[-1]})[0]:t.inputs[0].reshape(Array.from({length:r.length},(w,y)=>r[g[y]])),x=Hm(t,_,e[1],e[2],s,o,a,n.epsilon),$=w=>{let y=Dt(e[0].dataType),I=l===1?"vec2f":`mat${l}x2f`,R=C=>{let k=C===0?"x":"y",P=l===1?"f32":`vec${l}f`;switch(l){case 1:return`${y}(${P}(scale.${k}))`;case 2:return`vec2<${y}>(${P}(scale[0].${k}, scale[1].${k}))`;case 4:return`vec4<${y}>(${P}(scale[0].${k}, scale[1].${k}, scale[2].${k}, scale[3].${k}))`;default:throw new Error(`Not supported compoents ${l}`)}},M=te("input",e[0].dataType,e[0].dims,l),j=ye("output",e[0].dataType,i,l);return`
  @group(0) @binding(0) var<storage, read> input : array<${M.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${I}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${j.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${w.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${R(0)}, ${R(1)});
  }`};t.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${l}`,inputDependencies:f},getRunData:()=>({outputs:[{dims:i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:h}),getShaderSource:$},{inputs:[e[0],x]})},_3=(t,e)=>{e.format==="NHWC"?hE(t,t.inputs,e):dE(t,t.inputs,e)}}),fE,pE,v3,yB=se(()=>{$e(),Ce(),Ae(),fE=t=>{if(!t||t.length<2)throw new Error("layerNorm requires at least 2 inputs.")},pE=(t,e,n)=>{let r=e.simplified,i=t[0].dims,s=t[1],a=!r&&t[2],o=i,l=X.normalizeAxis(e.axis,i.length),u=X.sizeToDimension(i,l),h=X.sizeFromDimension(i,l),f=X.size(s.dims),p=a?X.size(a.dims):0;if(f!==h||a&&p!==h)throw new Error(`Size of X.shape()[axis:] == ${h}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${f} and bias size of ${p}`);let g=[];for(let M=0;M<i.length;++M)M<l?g.push(i[M]):g.push(1);let _=ht(h),x=["type","type"],$=[{type:12,data:u},{type:1,data:h},{type:12,data:Math.floor(h/_)},{type:1,data:e.epsilon}];a&&x.push("type");let w=n>1,y=n>2,I=M=>{let j=Dt(t[0].dataType),C=[te("x",t[0].dataType,t[0].dims,_),te("scale",s.dataType,s.dims,_)];a&&C.push(te("bias",a.dataType,a.dims,_)),C.push(ye("output",t[0].dataType,o,_)),w&&C.push(ye("mean_data_output",1,g)),y&&C.push(ye("inv_std_output",1,g));let k=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${M.registerUniforms(k).declareVariables(...C)}
  ${M.mainStart()}
    ${M.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${Oy("f32",_)};
    var mean_square_vector = ${Oy("f32",_)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${bo(j,_,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${bs("mean_vector",_)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${bs("mean_square_vector",_)} / uniforms.norm_size ${r?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${bo(j,_,"x[j + offset]")};
      let f32scale = ${bo(j,_,"scale[j]")};
      output[j + offset] = ${C[0].type.value}((f32input ${r?"":"- mean"}) * inv_std_dev * f32scale
        ${a?`+ ${bo(j,_,"bias[j]")}`:""}
      );
    }

    ${w?"mean_data_output[global_idx] = mean":""};
    ${y?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},R=[{dims:o,dataType:t[0].dataType}];return w&&R.push({dims:g,dataType:1}),y&&R.push({dims:g,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${_};${n};${r}`,inputDependencies:x},getRunData:()=>({outputs:R,dispatchGroup:{x:Math.ceil(u/64)},programUniforms:$}),getShaderSource:I}},v3=(t,e)=>{fE(t.inputs),t.compute(pE(t.inputs,e,t.outputCount))}}),mE,w3,_B=se(()=>{Ce(),i0(),s0(),mE=t=>{if(!t||t.length!==2)throw new Error("MatMul requires 2 inputs.");if(t[0].dims[t[0].dims.length-1]!==t[1].dims[t[1].dims.length-2])throw new Error("shared dimension does not match.")},w3=t=>{mE(t.inputs);let e=Ko.calcShape(t.inputs[0].dims,t.inputs[1].dims,!0);if(!e)throw new Error("Can't use matmul on the given tensors");let n=e[e.length-1],r=t.inputs[0].dims[t.inputs[0].dims.length-1];if(n<8&&r<8)t.compute(r0(t.inputs,{activation:""},e));else{let i=e[e.length-2],s=X.size(t.inputs[0].dims.slice(0,-2)),a=X.size(t.inputs[1].dims.slice(0,-2));if(s!==1&&i===1&&a===1){let o=t.inputs[0].reshape([1,s,r]),l=t.inputs[1].reshape([1,r,n]),u=[1,s,n],h=[o,l];t.compute(wf(h,{activation:""},e,u),{inputs:h})}else t.compute(wf(t.inputs,{activation:""},e))}}}),gE,yE,_E,b3,x3,vB=se(()=>{$e(),Ce(),yt(),Ae(),gE=(t,e)=>{if(t.length<3||t.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let n=t[0],r=n.dims.length;if(n.dims[r-1]!==e.k)throw new Error("The last dim of input shape does not match the k value");let i=Math.floor((e.k+e.blockSize-1)/e.blockSize),s=e.blockSize/8*e.bits,a=t[1];if(!X.areEqual(a.dims,[e.n,i,s]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let o=t[2].dims;if(X.size(o)!==e.n*i)throw new Error("scales input size error.");if(t.length===4){let l=t[3].dims,u=e.n*(e.bits===8?i:Math.floor((i*e.bits+7)/8));if(X.size(l)!==u)throw new Error("zeroPoints input size error.")}},yE=(t,e)=>{let n=t[0].dims,r=n.length,i=n[r-2],s=e.k,a=e.n,o=n.slice(0,r-2),l=X.size(o),u=t[1].dims[2]/4,h=t[0].dataType,f=ht(e.k),p=ht(u),g=ht(a),_=o.concat([i,a]),x=i>1&&a/g%2===0?2:1,$=X.size(_)/g/x,w=64,y=[],I=[l,i,s/f],R=X.convertShape(t[1].dims).slice();R.splice(-1,1,u/p),y.push(...xe(I)),y.push(...xe(R)),y.push(...xe(t[2].dims)),t.length===4&&y.push(...xe(X.convertShape(t[3].dims)));let M=[l,i,a/g];y.push(...xe(M));let j=C=>{let k=I.length,P=te("a",t[0].dataType,k,f),A=te("b",12,R.length,p),D=te("scales",t[2].dataType,t[2].dims.length),z=[P,A,D],O=t.length===4?te("zero_points",12,t[3].dims.length):void 0;O&&z.push(O);let ce=M.length,de=ye("output",t[0].dataType,ce,g),ue=Dt(t[0].dataType),pe=(()=>{switch(f){case 1:return`array<${ue}, 8>`;case 2:return`mat4x2<${ue}>`;case 4:return`mat2x4<${ue}>`;default:throw new Error(`${f}-component is not supported.`)}})(),K=()=>{let U=`
          // reuse a data
            var input_offset = ${P.indicesToOffset(`${P.type.indices}(batch, row, word_offset)`)};
            var a_data: ${pe};
            for (var j: u32 = 0; j < ${8/f}; j++) {
              a_data[j] = ${P.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let G=0;G<g*x;G++)U+=`
            b_value = ${p===1?`b${G}_data`:`b${G}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${pe}(${Array.from({length:4},(q,Y)=>`${ue}(b_value_lower[${Y}]), ${ue}(b_value_upper[${Y}])`).join(", ")});
            b_dequantized_values = ${f===1?`${pe}(${Array.from({length:8},(q,Y)=>`(b_quantized_values[${Y}] - ${O?`zero_point${G}`:"zero_point"}) * scale${G}`).join(", ")});`:`(b_quantized_values - ${pe}(${Array(8).fill(`${O?`zero_point${G}`:"zero_point"}`).join(",")})) * scale${G};`};
            workgroup_shared[local_id.x * ${x} + ${Math.floor(G/g)}]${g>1?`[${G%g}]`:""} += ${Array.from({length:8/f},(q,Y)=>`${f===1?`a_data[${Y}] * b_dequantized_values[${Y}]`:`dot(a_data[${Y}], b_dequantized_values[${Y}])`}`).join(" + ")};
          `;return U},B=()=>{let U=`
            var col_index = col * ${g};
            ${O?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${ue}(8);`}
            `;for(let G=0;G<g*x;G++)U+=`
            let scale${G} = ${D.getByOffset("col_index * nBlocksPerCol + block")};
            ${O?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${O.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${G} = ${ue}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return U},F=()=>{let U=`col_index = col * ${g};`;for(let G=0;G<g*x;G++)U+=`
            let b${G}_data = ${A.getByIndices(`${A.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return U+=`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${pe};
            var b_dequantized_values: ${pe};`,U};return`
        var<workgroup> workgroup_shared: array<${de.type.value}, ${x*w}>;
        ${C.declareVariables(...z,de)}
        ${C.mainStart([w,1,1])}
          let output_indices = ${de.offsetToIndices(`(global_idx / ${w}) * ${x}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${w}) {
            //process one block
            var word_offset: u32 = block * ${e.blockSize/f};
            ${B()}
            for (var word: u32 = 0; word < ${u}; word += ${p}) {
              ${F()}
              for (var i: u32 = 0; i < ${p}; i++) {
                ${K()}
                word_offset += ${8/f};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${x}) {
            var output_value: ${de.type.value} = ${de.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${w}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${x};
            }
            ${de.setByIndices(`${de.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${e.blockSize};${e.bits};${f};${p};${g};${x};${w}`,inputDependencies:Array(t.length).fill("rank")},getRunData:()=>({outputs:[{dims:_,dataType:h}],dispatchGroup:{x:$},programUniforms:y}),getShaderSource:j}},_E=(t,e)=>{let n=t[0].dims,r=n.length,i=n[r-2],s=e.k,a=e.n,o=n.slice(0,r-2),l=X.size(o),u=t[1].dims[2]/4,h=t[0].dataType,f=ht(e.k),p=ht(u),g=o.concat([i,a]),_=128,x=a%8===0?8:a%4===0?4:1,$=_/x,w=$*p*8,y=w/f,I=w/e.blockSize,R=X.size(g)/x,M=[],j=[l,i,s/f],C=X.convertShape(t[1].dims).slice();C.splice(-1,1,u/p),M.push(...xe(j)),M.push(...xe(C)),M.push(...xe(t[2].dims)),t.length===4&&M.push(...xe(X.convertShape(t[3].dims)));let k=[l,i,a];M.push(...xe(k));let P=A=>{let D=j.length,z=te("a",t[0].dataType,D,f),O=te("b",12,C.length,p),ce=te("scales",t[2].dataType,t[2].dims.length),de=[z,O,ce],ue=t.length===4?te("zero_points",12,t[3].dims.length):void 0;ue&&de.push(ue);let pe=k.length,K=ye("output",t[0].dataType,pe),B=Dt(t[0].dataType),F=()=>{switch(f){case 1:return`
          let a_data0 = vec4<${B}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${B}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${B}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${B}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${f}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${z.type.value}, ${y}>;
        var<workgroup> inter_results: array<array<${K.type.value}, ${$}>, ${x}>;
        ${A.declareVariables(...de,K)}
        ${A.mainStart([$,x,1])}
          let output_indices = ${K.offsetToIndices(`workgroup_index * ${x}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${I} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${y};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${y}; a_offset += ${_})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${z.getByIndices(`${z.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${z.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${I} + local_id.x;
            ${ue?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${ue.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${B}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${B}(8);`}
            let scale = ${ce.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${O.getByIndices(`${O.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${e.blockSize/f};
            for (var i: u32 = 0; i < ${p}; i++) {
              ${F()}
              let b_value = ${p===1?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${B}>(${Array.from({length:4},(U,G)=>`${B}(b_value_lower[${G}]), ${B}(b_value_upper[${G}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${B}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(U,G)=>`${`dot(a_data${G}, b_dequantized_values[${G}])`}`).join(" + ")};
              word_offset += ${8/f};
            }
            workgroupBarrier();
          }

          if (local_idx < ${x}) {
            var output_value: ${K.type.value} = ${K.type.value}(0);
            for (var b = 0u; b < ${$}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${K.setByIndices(`${K.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${e.blockSize};${f};${p};${$};${x}`,inputDependencies:Array(t.length).fill("rank")},getRunData:()=>({outputs:[{dims:g,dataType:h}],dispatchGroup:{x:R},programUniforms:M}),getShaderSource:P}},b3=(t,e)=>{gE(t.inputs,e),e.blockSize===32&&t.adapterInfo.isVendor("intel")&&t.adapterInfo.isArchitecture("gen-12lp")?t.compute(_E(t.inputs,e)):t.compute(yE(t.inputs,e))},x3=t=>qe(t)}),vE,wE,bE,xE,EE,TE,IE,$E,E3,wB=se(()=>{$e(),Ce(),Ae(),vE=t=>{if(!t||t.length<1)throw new Error("Too few inputs");if(t[0].dataType!==1&&t[0].dataType!==10)throw new Error("Input type must be float or float16.");if(t.length>=2){let e=t[0].dims.length*2===t[1].dims[0];if(t.length===4&&(e=t[3].dims[0]*2===t[1].dims[0]),!e)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},wE=(t,e,n)=>{let r="";for(let i=e-1;i>=0;--i)r+=`
            k = i32(${t.indicesGet("indices",i)}) - ${we("uniforms.pads",i,n)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${we("uniforms.x_shape",i,e)})) {
              break;
            }
            offset += k * i32(${we("uniforms.x_strides",i,e)});
        `;return`
          value = ${t.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${r}
            value = x[offset];
          }
      `},bE=(t,e,n)=>{let r="";for(let i=e-1;i>=0;--i)r+=`
                k = i32(${t.indicesGet("indices",i)}) - ${we("uniforms.pads",i,n)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${we("uniforms.x_shape",i,e)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${we("uniforms.x_shape",i,e)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${we("uniforms.x_strides",i,e)});
            `;return`
              var offset = 0;
              var k = 0;
              ${r}
              value = x[offset];
          `},xE=(t,e,n)=>{let r="";for(let i=e-1;i>=0;--i)r+=`
                k = i32(${t.indicesGet("indices",i)}) - ${we("uniforms.pads",i,n)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${we("uniforms.x_shape",i,e)})) {
                  k = i32(${we("uniforms.x_shape",i,e)}) - 1;
                }
                offset += k * i32(${we("uniforms.x_strides",i,e)});
            `;return`
              var offset = 0;
              var k = 0;
              ${r}
              value = x[offset];
          `},EE=(t,e,n)=>{let r="";for(let i=e-1;i>=0;--i)r+=`
                k = i32(${t.indicesGet("indices",i)}) - ${we("uniforms.pads",i,n)};
                if (k < 0)  {
                  k += i32(${we("uniforms.x_shape",i,e)}]);
                }
                if (k >= i32(${we("uniforms.x_shape",i,e)})) {
                  k -= i32(${we("uniforms.x_shape",i,e)});
                }
                offset += k * i32(${we("uniforms.x_strides",i,e)});
            `;return`
              var offset = 0;
              var k = 0;
              ${r}
              value = x[offset];
          `},TE=(t,e,n)=>{switch(n.mode){case 0:return wE(t,e,n.pads.length);case 1:return bE(t,e,n.pads.length);case 2:return xE(t,e,n.pads.length);case 3:return EE(t,e,n.pads.length);default:throw new Error("Invalid mode")}},IE=(t,e)=>{let n=X.padShape(t[0].dims.slice(),e.pads),r=t[0].dims,i=X.size(n),s=[{type:12,data:i},{type:6,data:e.pads}],a=t.length>=3&&t[2].data;e.mode===0&&s.push({type:a?t[2].dataType:1,data:e.value}),s.push(...xe(t[0].dims,n));let o=["rank"],l=u=>{let h=ye("output",t[0].dataType,n.length),f=te("x",t[0].dataType,r.length),p=f.type.value,g=TE(h,r.length,e),_=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:e.pads.length}];return e.mode===0&&_.push({name:"constant_value",type:a?p:"f32"}),`
            ${u.registerUniforms(_).declareVariables(f,h)}
            ${u.mainStart()}
            ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${h.offsetToIndices("global_idx")};

            var value = ${p}(0);
            ${g}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${e.mode}${a}`,inputDependencies:o},getRunData:()=>({outputs:[{dims:n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(X.size(n)/64)},programUniforms:s}),getShaderSource:l}},$E=(t,e)=>{if(t.length>1){let n=t[1].getBigInt64Array(),r=t.length>=3&&t[2].data?t[2].dataType===10?t[2].getUint16Array()[0]:t[2].getFloat32Array()[0]:0,i=t[0].dims.length,s=new Int32Array(2*i).fill(0);if(t.length>=4){let o=t[3].getBigInt64Array();for(let l=0;l<o.length;l++)s[Number(o[l])]=Number(n[l]),s[Number(o[l])+i]=Number(n[l+o.length])}else n.forEach((o,l)=>s[Number(l)]=Number(o));let a=[];return s.forEach(o=>a.push(o)),{mode:e.mode,value:r,pads:a}}else return e},E3=(t,e)=>{vE(t.inputs);let n=$E(t.inputs,e);t.compute(IE(t.inputs,n),{inputs:[0]})}}),eu,Gm,Km,Qm,Ym,kE,SE,Jm,Xm,T3,I3,Zm,$3,k3,eg,S3,C3,A3,R3,bB=se(()=>{Jn(),$e(),Ce(),Ae(),eu=t=>{if(it.webgpu.validateInputContent&&(!t||t.length!==1))throw new Error("Pool ops requires 1 input.")},Gm=(t,e,n)=>{let r=e.format==="NHWC",i=t.dims.slice();r&&i.splice(1,0,i.pop());let s=Object.hasOwnProperty.call(e,"dilations"),a=e.kernelShape.slice(),o=e.strides.slice(),l=s?e.dilations.slice():[],u=e.pads.slice();_f.adjustPoolAttributes(n,i,a,o,l,u);let h=_f.computePoolOutputShape(n,i,o,l,a,u,e.autoPad),f=Object.assign({},e);s?Object.assign(f,{kernelShape:a,strides:o,pads:u,dilations:l,cacheKey:e.cacheKey}):Object.assign(f,{kernelShape:a,strides:o,pads:u,cacheKey:e.cacheKey});let p=h.slice();return p.push(p.splice(1,1)[0]),[f,r?p:h]},Km=(t,e)=>{let n=e.format==="NHWC",r=X.size(t),i=X.size(e.kernelShape),s=[{type:12,data:r},{type:12,data:i}],a=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(e.kernelShape.length<=2){let o=e.kernelShape[e.kernelShape.length-1],l=e.strides[e.strides.length-1],u=e.pads[e.pads.length/2-1],h=e.pads[e.pads.length-1],f=!!(u+h);s.push({type:12,data:o},{type:12,data:l},{type:12,data:u},{type:12,data:h}),a.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let p=!1;if(e.kernelShape.length===2){let g=e.kernelShape[e.kernelShape.length-2],_=e.strides[e.strides.length-2],x=e.pads[e.pads.length/2-2],$=e.pads[e.pads.length-2];p=!!(x+$),s.push({type:12,data:g},{type:12,data:_},{type:12,data:x},{type:12,data:$}),a.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[s,a,!0,f,p]}else{if(n)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let o=X.computeStrides(e.kernelShape);s.push({type:12,data:o},{type:12,data:e.pads},{type:12,data:e.strides}),a.push({name:"kernelStrides",type:"u32",length:o.length},{name:"pads",type:"u32",length:e.pads.length},{name:"strides",type:"u32",length:e.strides.length});let l=e.pads.reduce((u,h)=>u+h);return[s,a,!!l,!1,!1]}},Qm=(t,e,n,r,i,s,a,o,l,u,h,f)=>{let p=i.format==="NHWC",g=e.type.value,_=ye("output",e.type.tensor,r);if(i.kernelShape.length<=2){let x="",$="",w="",y=n-(p?2:1);if(h?x=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${y}] = indices[${y}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${y}] < 0 || xIndices[${y}]
                      >= uniforms.x_shape[${y}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${e.indicesToOffset("xIndices")}];
                  ${s}
                }`:x=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${y}] = indices[${y}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${e.indicesToOffset("xIndices")}];
                  ${s}
                }`,i.kernelShape.length===2){let I=n-(p?3:2);f?$=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${I}] = indices[${I}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${I}] < 0 || xIndices[${I}] >= uniforms.x_shape[${I}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:$=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${I}] = indices[${I}] * uniforms.sh - uniforms.phStart + j;
                `,w=`
              }
            `}return`
            ${t.registerUniforms(l).declareVariables(e,_)}

            ${t.mainStart()}
              ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${_.offsetToIndices("global_idx")};
              var xIndices = ${_.offsetToIndices("global_idx")};

              var value = ${g}(${o});
              var pad = 0;
              ${$}
              ${x}
              ${w}
              ${a}

              output[global_idx] = value;
            }`}else{if(p)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let x=i.kernelShape.length,$=i.pads.length,w="";return u?w=`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${e.indicesToOffset("xIndices")}];
                ${s}
              }`:w=`
              }
              let x_val = x[${e.indicesToOffset("xIndices")}];
              ${s}
            `,`
            ${t.registerUniforms(l).declareVariables(e,_)}

            ${t.mainStart()}
              ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${_.offsetToIndices("global_idx")};
              var xIndices = ${_.offsetToIndices("global_idx")};

              var offsets: array<u32, ${x}>;

              var value = ${g}(${o});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${x-1}u; j++) {
                  offsets[j] = offset / ${we("uniforms.kernelStrides","j",x)};
                  offset -= offsets[j] * ${we("uniforms.kernelStrides","j",x)};
                }
                offsets[${x-1}] = offset;

                isPad = false;
                for (var j = ${n-x}u; j < ${n}u; j++) {
                  xIndices[j] = indices[j] * ${we("uniforms.strides",`j - ${n-x}u`,x)}
                    + offsets[j - ${n-x}u] - ${we("uniforms.pads","j - 2u",$)};
                  ${w}
              }
              ${a}

              output[global_idx] = value;
            }`}},Ym=t=>`${t.format};${t.ceilMode};${t.autoPad};${t.kernelShape.length}`,kE=t=>`${Ym(t)};${t.countIncludePad}`,SE=t=>`${Ym(t)};${t.storageOrder};${t.dilations}`,Jm=t=>({format:t.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][t.auto_pad],ceilMode:t.ceil_mode,kernelShape:t.kernel_shape,strides:t.strides,pads:t.pads}),Xm=(t,e,n,r)=>{let[i,s]=Gm(e,r,n),a=te("x",e.dataType,e.dims.length),o=a.type.value,l="value += x_val;",u="";i.countIncludePad?u+=`value /= ${o}(uniforms.kernelSize);`:u+=`value /= ${o}(i32(uniforms.kernelSize) - pad);`;let[h,f,p,g,_]=Km(s,i);h.push(...xe(e.dims,s));let x=["rank"];return{name:t,shaderCache:{hint:`${r.cacheKey};${p};${g};${_}`,inputDependencies:x},getRunData:()=>({outputs:[{dims:s,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(X.size(s)/64)},programUniforms:h}),getShaderSource:$=>Qm($,a,e.dims.length,s.length,i,l,u,0,f,p,g,_)}},T3=t=>{let e=t.count_include_pad!==0,n=Jm(t);if(n.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let r={countIncludePad:e,...n,cacheKey:""};return{...r,cacheKey:kE(r)}},I3=(t,e)=>{eu(t.inputs),t.compute(Xm("AveragePool",t.inputs[0],!1,e))},Zm={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},$3=t=>{let e=t.format;return{format:e,...Zm,cacheKey:e}},k3=(t,e)=>{eu(t.inputs),t.compute(Xm("GlobalAveragePool",t.inputs[0],!0,e))},eg=(t,e,n,r)=>{let[i,s]=Gm(e,r,n),a=`
      value = max(x_val, value);
    `,o="",l=te("x",e.dataType,e.dims.length),u=["rank"],[h,f,p,g,_]=Km(s,i);return h.push(...xe(e.dims,s)),{name:t,shaderCache:{hint:`${r.cacheKey};${p};${g};${_}`,inputDependencies:u},getRunData:()=>({outputs:[{dims:s,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(X.size(s)/64)},programUniforms:h}),getShaderSource:x=>Qm(x,l,e.dims.length,s.length,i,a,o,e.dataType===10?-65504:-1e5,f,p,g,_)}},S3=(t,e)=>{eu(t.inputs),t.compute(eg("MaxPool",t.inputs[0],!1,e))},C3=t=>{let e=t.storage_order,n=t.dilations,r=Jm(t);if(e!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(r.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let i={storageOrder:e,dilations:n,...r,cacheKey:""};return{...i,cacheKey:SE(i)}},A3=t=>{let e=t.format;return{format:e,...Zm,cacheKey:e}},R3=(t,e)=>{eu(t.inputs),t.compute(eg("GlobalMaxPool",t.inputs[0],!0,e))}}),CE,AE,N3,P3,xB=se(()=>{$e(),Ce(),yt(),Ae(),CE=(t,e)=>{if(t.length<2||t.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(t.length===3&&t[1].dims===t[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(t.length===3&&t[0].dataType!==t[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(t[0].dataType===6&&t.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(t[1].dims.length!==0&&t[1].dims.length!==1&&t[1].dims.length!==t[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(t.length>2){if(t[0].dataType!==t[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(t[1].dims.length!==t[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!t[1].dims.map((n,r)=>n===t[2].dims[r]).reduce((n,r)=>n&&r,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(e.blockSize>0){if(t[1].dims.length===0||t[1].dims.length===1&&t[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!t[1].dims.map((i,s)=>s===e.axis||i===t[0].dims[s]).reduce((i,s)=>i&&s,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(t[1].dims.length!==t[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let n=t[0].dims[e.axis],r=t[1].dims[e.axis];if(e.blockSize<Math.ceil(n/r)||e.blockSize>Math.ceil(n/(r-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},AE=(t,e)=>{let n=X.normalizeAxis(e.axis,t[0].dims.length),r=t[0].dataType,i=r===3,s=t[0].dims,a=t[1].dataType,o=X.size(s),l=r===3||r===2,u=l?[Math.ceil(X.size(t[0].dims)/4)]:t[0].dims,h=t[1].dims,f=t.length>2?t[2]:void 0,p=f?l?[Math.ceil(X.size(f.dims)/4)]:f.dims:void 0,g=h.length===0||h.length===1&&h[0]===1,_=g===!1&&h.length===1,x=ht(o),$=g&&(!l||x===4),w=$?x:1,y=$&&!l?x:1,I=te("input",l?12:r,u.length,y),R=te("scale",a,h.length),M=f?te("zero_point",l?12:r,p.length):void 0,j=ye("output",a,s.length,w),C=[I,R];M&&C.push(M);let k=[u,h];f&&k.push(p);let P=[{type:12,data:o/w},{type:12,data:n},{type:12,data:e.blockSize},...xe(...k,s)],A=D=>{let z=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${D.registerUniforms(z).declareVariables(...C,j)}
      ${D.mainStart()}
          ${D.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${j.offsetToIndices("global_idx")};

          // Set input x
          ${l?`
            let input = ${I.getByOffset("global_idx / 4")};
            let x_vec = ${i?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${w===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${I.getByOffset("global_idx")};`};

          // Set scale input
          ${g?`let scale_value= ${R.getByOffset("0")}`:_?`
            let scale_index = ${j.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${R.getByOffset("scale_index")};`:`
            var scale_indices: ${R.type.indices} = output_indices;
            let index = ${R.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${R.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${R.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${M?g?l?`
                let zero_point_input = ${M.getByOffset("0")};
                let zero_point_vec =  ${i?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${M.getByOffset("0")}`:_?l?`
                let zero_point_index = ${j.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${M.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${i?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${j.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${M.getByOffset("zero_point_index")};`:l?`
                let zero_point_offset = ${R.indicesToOffset("scale_indices")};
                let zero_point_input = ${M.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${i?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${M.getByIndices("scale_indices")};`:`let zero_point_value = ${l?i?"i32":"u32":I.type.value}(0);`};
      // Compute and write output
      ${j.setByOffset("global_idx",`${j.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:e.cacheKey,inputDependencies:M?["rank","rank","rank"]:["rank","rank"]},getShaderSource:A,getRunData:()=>({outputs:[{dims:s,dataType:a}],dispatchGroup:{x:Math.ceil(o/w/64),y:1,z:1},programUniforms:P})}},N3=(t,e)=>{CE(t.inputs,e),t.compute(AE(t.inputs,e))},P3=t=>qe({axis:t.axis,blockSize:t.blockSize})}),RE,NE,O3,EB=se(()=>{Jn(),$e(),Ae(),RE=(t,e,n)=>{let r=t===e,i=t<e&&n<0,s=t>e&&n>0;if(r||i||s)throw new Error("Range these inputs' contents are invalid.")},NE=(t,e,n,r)=>{let i=Math.abs(Math.ceil((e-t)/n)),s=[i],a=i,o=[{type:12,data:a},{type:r,data:t},{type:r,data:n},...xe(s)],l=u=>{let h=ye("output",r,s.length),f=h.type.value,p=[{name:"outputSize",type:"u32"},{name:"start",type:f},{name:"delta",type:f}];return`
        ${u.registerUniforms(p).declareVariables(h)}
        ${u.mainStart()}
        ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${f}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${r}`},getShaderSource:l,getRunData:()=>({outputs:[{dims:s,dataType:r}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:o})}},O3=t=>{let e=0,n=0,r=0;t.inputs[0].dataType===6?(e=t.inputs[0].getInt32Array()[0],n=t.inputs[1].getInt32Array()[0],r=t.inputs[2].getInt32Array()[0]):t.inputs[0].dataType===1&&(e=t.inputs[0].getFloat32Array()[0],n=t.inputs[1].getFloat32Array()[0],r=t.inputs[2].getFloat32Array()[0]),it.webgpu.validateInputContent&&RE(e,n,r),t.compute(NE(e,n,r,t.inputs[0].dataType),{inputs:[]})}}),PE,OE,D3,M3,TB=se(()=>{$e(),Ce(),yt(),Ae(),PE=(t,e,n,r)=>{if(t!=="none"&&r!=="i32"&&r!=="u32"&&r!=="f32")throw new Error(`Input ${r} is not supported with reduction ${t}.`);let i=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,s=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${e}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(t){case"none":return`${e}=${n};`;case"add":return r==="i32"||r==="u32"?`atomicAdd(&${e}, bitcast<${r}>(${n}));`:`
              ${i}bitcast<${r}>(oldValue) + (${n})${s}`;case"max":return r==="i32"||r==="u32"?`atomicMax(&${e}, bitcast<${r}>(${n}));`:`
                ${i}max(bitcast<f32>(oldValue), (${n}))${s}`;case"min":return r==="i32"||r==="u32"?`atomicMin(&${e}, bitcast<${r}>(${n}));`:`${i}min(bitcast<${r}>(oldValue), (${n}))${s}`;case"mul":return`${i}(bitcast<${r}>(oldValue) * (${n}))${s}`;default:throw new Error(`Reduction ${t} is not supported.`)}},OE=(t,e)=>{let n=t[0].dims,r=t[1].dims,i=n,s=1,a=Math.ceil(X.sizeToDimension(r,r.length-1)/s),o=r[r.length-1],l=X.sizeFromDimension(n,o),u=[{type:12,data:a},{type:12,data:o},{type:12,data:l},...xe(t[1].dims,t[2].dims,i)],h=f=>{let p=te("indices",t[1].dataType,t[1].dims.length),g=te("updates",t[2].dataType,t[2].dims.length,s),_=e.reduction!=="none"&&e.reduction!==""?cA("output",t[0].dataType,i.length):ye("output",t[0].dataType,i.length,s);return`
      ${f.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(p,g,_)}
      ${f.mainStart()}
        ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var data_offset = 0u;
  let indices_start = uniforms.last_index_dimension * global_idx;
  let indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${t[0].dims.length===1?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[i - indices_start];
    let dim_value = uniforms.output_shape[i - indices_start];`}
    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));
  }

  for (var i = 0u; i < uniforms.num_updates_elements; i++) {
    let value = updates[uniforms.num_updates_elements * global_idx + i];
    ${PE(e.reduction,"output[data_offset + i]","value",_.type.value)}
  }

      }`};return{name:"ScatterND",shaderCache:{hint:`${e.cacheKey}_${e.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:i,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:u}),getShaderSource:h}},D3=t=>qe({reduction:t.reduction}),M3=(t,e)=>{t.compute(OE(t.inputs,e),{inputs:[t.inputs[1],t.inputs[2]],outputs:[]})}}),DE,ME,LE,tg,zE,VE,jE,UE,BE,FE,WE,qE,ng,HE,GE,KE,QE,YE,L3,z3,IB=se(()=>{$e(),Ce(),yt(),Ae(),DE=(t,e)=>{if(t.every(n=>n>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),t.length>0){if(e.mode==="linear"){if(!(t.length===2||t.length===3||t.length===4&&t[0]===1&&t[1]===1||t.length===4&&t[0]===1&&t[3]===1||t.length===5&&t[0]===1&&t[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(e.mode==="cubic"&&!(t.length===2||t.length===4&&t[0]===1&&t[1]===1||t.length===4&&t[0]===1&&t[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},ME=(t,e,n)=>{e.every(i=>i>=0&&i<n||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let r=new Array(n).fill(1);return e.forEach((i,s)=>r[i]=t[s]),r},LE=(t,e,n,r,i,s)=>{let[a,o,l]=n>10?[1,2,3]:[-1,t.length>1?1:-1,-1],u=t[0].dims.length;if(a>0&&t.length>a&&t[a].dims.length>0)t[a].getFloat32Array().forEach(h=>s.push(h));else if(e.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(o>0&&t.length>o&&t[o].dims.length===1&&t[o].dims[0]>0){if(t[o].getFloat32Array().forEach(h=>r.push(h)),r.length!==0&&r.length!==u&&n>=18&&r.length!==e.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");DE(r,e),e.axes.length>0&&ME(r,e.axes,u).forEach((h,f)=>r[f]=h)}if(l>0&&t.length>l&&t[l].dims.length===1&&t[l].dims[0]>0&&(t[l].getBigInt64Array().forEach(h=>i.push(Number(h))),i.length!==0&&i.length!==u&&n>=18&&i.length!==e.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(e.axes.length>0){if(r.length!==0&&r.length!==e.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(i.length!==0&&i.length!==e.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof r<"u"&&typeof i<"u"&&r.length>0&&i.length>u)throw new Error("Resize requires only of scales or sizes to be specified")},tg=(t,e,n,r)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${t}) * (${e});
  let whole = ${r}(big / (${n}));
  let fract = ${r}(big % (${n})) / ${r}(${n});
  return whole + fract;
`,zE=(t,e)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${e} { `+(()=>{switch(t){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${e}(xResized) / ${e}(xScale);
          } else {
            ${tg("xResized","lengthOriginal","lengthResized",e)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${e}(xResized) + 0.5) / ${e}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${e}(xResized) + 0.5) / ${e}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${tg("xResized","lengthOriginal - 1","lengthResized - 1",e)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${e}(roiStart) * ${e}(lengthOriginal - 1) +
                        (${e}(xResized) * ${e}(roiEnd - roiStart) * ${e}(lengthOriginal - 1)) /
                        ${e}(lengthResized - 1);
                  } else {
                    return 0.5 * ${e}(roiStart + roiEnd) * ${e}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${e}xScale * ${e}(lengthResized);
                  const adjustment = ${e}(lengthResized) / outputWidth;
                  const center = ${e}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${e}(xResized) + 0.5) / ${e}(xScale)) - 0.5;`;case"half_pixel":return`return ((${e}(xResized) + 0.5) / ${e}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${t} is not supported`)}})()+"}",VE=(t,e,n)=>`fn getNearestPixelFromOriginal(xOriginal: ${n}, isDownSample: bool) -> ${n} {`+(()=>{switch(t){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(e<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${t} is not supported`)}})()+"}",jE=(t,e,n)=>{let r=new Array(n).fill(0).concat(new Array(n).fill(1)),i=t.length===0?r:t.slice();return e.length>0?(e.forEach((s,a)=>{r[s]=i[a],r[a+n]=i[e.length+a]}),r):i},UE=(t,e,n,r)=>{let i=[];if(n.length>0)if(r.length>0){if(t.forEach(s=>i.push(s)),Math.max(...r)>t.length)throw new Error("axes is out of bound");r.forEach((s,a)=>i[s]=n[a])}else n.forEach(s=>i.push(s));else{if(e.length===0)throw new Error("Resize requires either scales or sizes.");i=t.map((s,a)=>Math.round(s*e[a]))}return i},BE=(t,e,n)=>{let r=(()=>{switch(n.keepAspectRatioPolicy){case"not_larger":return n.axes.length>0?Math.min(...n.axes.map(s=>e[s]),Number.MAX_VALUE):Math.min(...e,Number.MAX_VALUE);case"not_smaller":return n.axes.length>0?Math.max(...n.axes.map(s=>e[s]),Number.MIN_VALUE):Math.max(...e,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${n.keepAspectRatioPolicy} is not supported`)}})();e.fill(1,0,e.length);let i=t.slice();return n.axes.length>0?(n.axes.forEach(s=>e[s]=r),n.axes.forEach(s=>i[s]=Math.round(t[s]*e[s]))):(e.fill(r,0,e.length),i.forEach((s,a)=>i[a]=Math.round(s*e[a]))),i},FE=(t,e,n,r,i)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${t.type.indices}) -> array<${t.type.value}, ${n.length}> {
      var original_indices: array<${t.type.value}, ${n.length}>;
      for (var i:u32 = 0; i < ${n.length}; i++) {
        var output_index = ${t.indicesGet("output_indices","i")};
        var scale = ${we("uniforms.scales","i",r)};
        var roi_low = ${we("uniforms.roi","i",i)};
        var roi_hi = ${we("uniforms.roi",`i + ${e.length}`,i)};
        if (scale == 1.0) {
          original_indices[i] = ${t.type.value}(output_index);
        } else {
          var input_shape_i = ${we("uniforms.input_shape","i",e.length)};
          var output_shape_i = ${we("uniforms.output_shape","i",n.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,WE=(t,e,n,r,i,s,a)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${e.type.indices}) -> ${t.type.indices} {
      var input_indices: ${t.type.indices};
      for (var i:u32 = 0; i < ${r.length}; i++) {
        var output_index = ${e.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${we("uniforms.scales","i",i)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${we("uniforms.roi","i",s)};
          var roi_hi = ${we("uniforms.roi",`i + ${n.length}`,s)};
          var input_shape_i = ${we("uniforms.input_shape","i",n.length)};
          var output_shape_i = ${we("uniforms.output_shape","i",r.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${a} || (original_idx >= 0 && original_idx < ${e.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${e.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${t.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,qE=(t,e)=>`
    fn checkInputIndices(input_indices: ${t.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${e.length}; i++) {
        var input_index = ${t.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${we("uniforms.input_shape","i",e.length)}) {
          return false;
        }
      }
      return true;
    }`,ng=(t,e,n,r)=>t.rank>r?`
    ${t.indicesSet("input_indices",e,"channel")};
    ${t.indicesSet("input_indices",n,"batch")};
`:"",HE=(t,e,n,r,i)=>{let[s,a,o,l]=n.length===2?[-1,0,1,-1]:[0,2,3,1],u=t.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${u} {
      var input_indices: ${t.type.indices};
      ${t.indicesSet("input_indices",a,`max(0, min(row, ${n[a]} - 1))`)};
      ${t.indicesSet("input_indices",o,`max(0, min(col, ${n[o]} - 1))`)};
      ${ng(t,l,s,2)}
      return ${t.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${e.type.indices}) -> ${u} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${u} = originalIndices[${a}];
      var col:${u} = originalIndices[${o}];
      ${r?`if (row < 0 || row > (${n[a]} - 1) || col < 0 || col > (${n[o]} - 1)) {
        return ${i};
      }`:""};
      row = max(0, min(row, ${n[a]} - 1));
      col = max(0, min(col, ${n[o]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${n.length>2?`u32(originalIndices[${l}])`:"0"};
      var batch: u32 =  ${n.length>2?`u32(originalIndices[${s}])`:"0"};
      var x11: ${u} = getInputValue(batch, channel, row1, col1);
      var x12: ${u} = getInputValue(batch, channel, row1, col2);
      var x21: ${u} = getInputValue(batch, channel, row2, col1);
      var x22: ${u} = getInputValue(batch, channel, row2, col2);
      var dx1: ${u} = abs(row - ${u}(row1));
      var dx2: ${u} = abs(${u}(row2) - row);
      var dy1: ${u} = abs(col - ${u}(col1));
      var dy2: ${u} = abs(${u}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},GE=(t,e,n,r,i,s,a,o,l,u)=>{let h=n.length===2,[f,p]=h?[0,1]:[2,3],g=t.type.value,_=x=>{let $=x===f?"row":"col";return`
      fn ${$}CubicInterpolation(input_indices: ${t.type.indices}, output_indices: ${e.type.indices}) -> ${g} {
        var output_index = ${e.indicesGet("output_indices",x)};
        var originalIdx: ${g} = getOriginalCoordinateFromResizedCoordinate(output_index, ${i[x]},
        ${r[x]}, ${n[x]}, ${s[x]}, ${s[x]} + ${n.length});
        var fractOriginalIdx: ${g} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${o} && (originalIdx < 0 || originalIdx > (${n[x]} - 1))) {
          return ${l};
        }
        var data: array<${g}, 4> = array<${g}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${$}: ${g} = originalIdx + ${g}(i);
          if (${$} < 0 || ${$} >= ${n[x]}) {
            ${u?`coefs[i + 1] = 0.0;
                        continue;`:o?`return ${l};`:`${$} = max(0, min(${$}, ${n[x]} - 1));`};
          }
        var input_indices_copy: ${t.type.indices} = input_indices;
          ${t.indicesSet("input_indices_copy",x,`u32(${$})`)};
          data[i + 1] = ${x===f?t.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${_(f)};
    ${_(p)};
  fn getCubicInterpolationCoefs(s: ${g}) -> array<${g}, 4> {
    var absS = abs(s);
    var coeffs: array<${g}, 4> = array<${g}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${g} = 1.0 - absS;
    var twoMinusAbsS: ${g} = 2.0 - absS;
    var onePlusAbsS: ${g} = 1.0 + absS;
    coeffs[0] = ((${a} * onePlusAbsS - 5 * ${a}) * onePlusAbsS + 8 * ${a}) * onePlusAbsS - 4 * ${a};
    coeffs[1] = ((${a} + 2) * absS - (${a} + 3)) * absS * absS + 1;
    coeffs[2] = ((${a} + 2) * oneMinusAbsS - (${a} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${a} * twoMinusAbsS - 5 * ${a}) * twoMinusAbsS + 8 * ${a}) * twoMinusAbsS - 4 * ${a};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${g}, 4>, coefs: array<${g}, 4>) -> ${g} {
    var coefsSum: ${g} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${e.type.indices}) -> ${g} {
    var input_indices: ${t.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},KE=(t,e,n,r,i)=>{let[s,a,o,l,u]=n.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],h=t.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${h} {
      var input_indices: ${t.type.indices};
      ${t.indicesSet("input_indices",a,`max(0, min(depth, ${n[a]} - 1))`)};
      ${t.indicesSet("input_indices",o,`max(0, min(height, ${n[o]} - 1))`)};
      ${t.indicesSet("input_indices",l,`max(0, min(width, ${n[l]} - 1))`)};
      ${ng(t,u,s,3)}
      return ${t.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${e.type.indices}) -> ${h} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${h} = originalIndices[${a}];
      var height:${h} = originalIndices[${o}];
      var width:${h} = originalIndices[${l}];
      ${r?`if (depth < 0 || depth > (${n[a]} - 1) || height < 0 || height > (${n[o]} - 1) || width < 0 || (width > ${n[l]} - 1)) {
      return ${i};
        }`:""};

    depth = max(0, min(depth, ${n[a]} - 1));
      height = max(0, min(height, ${n[o]} - 1));
      width = max(0, min(width, ${n[l]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${n.length>3?`u32(originalIndices[${u}])`:"0"};
      var batch: u32 =  ${n.length>3?`u32(originalIndices[${s}])`:"0"};

      var x111: ${h} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${h} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${h} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${h} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${h} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${h} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${h} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${h} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${h} = abs(depth - ${h}(depth1));
      var dx2: ${h} = abs(${h}(depth2) - depth);
      var dy1: ${h} = abs(height - ${h}(height1));
      var dy2: ${h} = abs(${h}(height2) - height);
      var dz1: ${h} = abs(width - ${h}(width1));
      var dz2: ${h} = abs(${h}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},QE=(t,e,n,r,i,s)=>{let a=t.dims,o=jE(s,e.axes,a.length),l=UE(a,r,i,e.axes),u=r.slice();r.length===0&&(u=a.map((y,I)=>y===0?1:l[I]/y),e.keepAspectRatioPolicy!=="stretch"&&(l=BE(a,u,e)));let h=ye("output",t.dataType,l.length),f=te("input",t.dataType,a.length),p=X.size(l),g=a.length===l.length&&a.every((y,I)=>y===l[I]),_=e.coordinateTransformMode==="tf_crop_and_resize",x=e.extrapolationValue,$=f.type.value,w=y=>`
      ${g?"":`
      ${zE(e.coordinateTransformMode,$)};
      ${(()=>{switch(e.mode){case"nearest":return`
              ${qE(f,a)};
              ${VE(e.nearestMode,n,$)};
              ${WE(f,h,a,l,u.length,o.length,_)};
              `;case"linear":return`
              ${FE(h,a,l,u.length,o.length)};
              ${(()=>{if(a.length===2||a.length===4)return`${HE(f,h,a,_,x)}`;if(a.length===3||a.length===5)return`${KE(f,h,a,_,x)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(a.length===2||a.length===4)return`${GE(f,h,a,l,u,o,e.cubicCoeffA,_,e.extrapolationValue,e.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${y.registerUniform("output_size","u32").registerUniform("scales","f32",u.length).registerUniform("roi","f32",o.length).declareVariables(f,h)}
      ${y.mainStart()}
        ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${g?"output[global_idx] = input[global_idx];":`
        let output_indices = ${h.offsetToIndices("global_idx")};
        var input_indices: ${f.type.indices};
        ${(()=>{switch(e.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${f.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${e.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${a.length===2||a.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${e.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${e.cacheKey}|${n}|${u.length>0?e.mode==="cubic"?u:u.length:""}|${i.length>0?i:""}|${o.length>0?o:""}|${g}|${e.mode==="nearest"?a.length:a}`,inputDependencies:["rank"]},getShaderSource:w,getRunData:()=>({outputs:[{dims:l,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:[{type:12,data:p},{type:1,data:u},{type:1,data:o},...xe(a,l)]})}},YE=t=>{let e=t.customDataBuffer;return new Uint32Array(e,e.byteOffset,1)[0]},L3=(t,e)=>{let n=[],r=[],i=[],s=YE(t);if(e.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");LE(t.inputs,e,s,n,r,i),t.compute(QE(t.inputs[0],e,s,n,r,i),{inputs:[0]})},z3=t=>{let e=t.antialias,n=t.axes,r=t.coordinateTransformMode,i=t.cubicCoeffA,s=t.excludeOutside!==0,a=t.extrapolationValue,o=t.keepAspectRatioPolicy,l=t.mode,u=t.nearestMode===""?"simple":t.nearestMode;return qe({antialias:e,axes:n,coordinateTransformMode:r,cubicCoeffA:i,excludeOutside:s,extrapolationValue:a,keepAspectRatioPolicy:o,mode:l,nearestMode:u})}}),JE,XE,V3,$B=se(()=>{$e(),Ce(),Ae(),JE=t=>{if(!t||t.length<3)throw new Error("layerNorm requires at least 3 inputs.");let e=t[0],n=t[1],r=t[2];if(e.dataType!==n.dataType||e.dataType!==r.dataType)throw new Error("All inputs must have the same data type");if(e.dims.length!==3&&e.dims.length!==2)throw new Error("Input must be 2D or 3D");if(n.dims.length!==3&&n.dims.length!==2)throw new Error("Skip must be 2D or 3D");let i=e.dims[e.dims.length-1],s=e.dims[e.dims.length-2];if(n.dims[n.dims.length-1]!==i)throw new Error("Skip must have the same hidden size as input");if(n.dims[n.dims.length-2]!==s)throw new Error("Skip must have the same sequence length as input");if(r.dims.length!==1)throw new Error("Gamma must be 1D");if(r.dims[r.dims.length-1]!==i)throw new Error("Gamma must have the same hidden size as input");if(t.length>3){let a=t[3];if(a.dims.length!==1)throw new Error("Beta must be 1D");if(a.dims[a.dims.length-1]!==i)throw new Error("Beta must have the same hidden size as input")}if(t.length>4){let a=t[4];if(a.dims.length!==1)throw new Error("Bias must be 1D");if(a.dims[a.dims.length-1]!==i)throw new Error("Bias must have the same hidden size as input")}},XE=(t,e,n,r)=>{let i=e.simplified,s=t[0].dims,a=X.size(s),o=s,l=a,u=s.slice(-1)[0],h=r?s.slice(0,-1).concat(1):[],f=!i&&t.length>3,p=t.length>4,g=r&&n>1,_=r&&n>2,x=n>3,$=64,w=ht(u),y=[{type:12,data:l},{type:12,data:w},{type:12,data:u},{type:1,data:e.epsilon}],I=M=>{let j=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],C=[te("x",t[0].dataType,t[0].dims,w),te("skip",t[1].dataType,t[1].dims,w),te("gamma",t[2].dataType,t[2].dims,w)];f&&C.push(te("beta",t[3].dataType,t[3].dims,w)),p&&C.push(te("bias",t[4].dataType,t[4].dims,w)),C.push(ye("output",t[0].dataType,o,w)),g&&C.push(ye("mean_output",1,h)),_&&C.push(ye("inv_std_output",1,h)),x&&C.push(ye("input_skip_bias_sum",t[0].dataType,o,w));let k=Dt(t[0].dataType),P=Dt(1,w);return`

      ${M.registerUniforms(j).declareVariables(...C)}
      var<workgroup> sum_shared : array<${P}, ${$}>;
      var<workgroup> sum_squared_shared : array<${P}, ${$}>;

      ${M.mainStart([$,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${$};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${$};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${$-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${p?"bias[offset1d + i]":k+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${x?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${bo(k,w,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${$};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${bs("sum",w)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${bs("square_sum",w)} / f32(uniforms.hidden_size) ${i?"":"- mean * mean"} + uniforms.epsilon);
        ${g?"mean_output[global_idx] = mean;":""}
        ${_?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${i?"":`- ${k}(mean)`}) *
            ${k}(inv_std_dev) * gamma[offset1d + i]
            ${f?"+ beta[offset1d + i]":""};
        }
      }`},R=[{dims:o,dataType:t[0].dataType}];return n>1&&R.push({dims:h,dataType:1}),n>2&&R.push({dims:h,dataType:1}),n>3&&R.push({dims:s,dataType:t[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${w};${g};${_};${x}`,inputDependencies:t.map((M,j)=>"type")},getShaderSource:I,getRunData:()=>({outputs:R,dispatchGroup:{x:Math.ceil(l/u)},programUniforms:y})}},V3=(t,e)=>{JE(t.inputs);let n=[0];t.outputCount>1&&n.push(-3),t.outputCount>2&&n.push(-3),t.outputCount>3&&n.push(3),t.compute(XE(t.inputs,e,t.outputCount,!1),{outputs:n})}}),ZE,tu,eT,rg,tT,nT,j3,U3,kB=se(()=>{$e(),Ce(),yt(),Ae(),ZE=(t,e)=>{if(!t||t.length<1)throw new Error("too few inputs");if(e.axes.length!==0){if(e.axes.length!==e.starts.length||e.axes.length!==e.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(e.starts.length!==e.ends.length)throw new Error("starts and ends must have the same length");t.slice(1).forEach((n,r)=>{if(t[r+1].dataType!==6&&t[r+1].dataType!==7)throw new Error(`Input ${r} must be an array of int32 or int64`)})},tu=(t,e)=>{let n=[];if(t.length>e)if(t[e].dataType===7)t[e].getBigInt64Array().forEach(r=>n.push(Number(r)));else if(t[e].dataType===6)t[e].getInt32Array().forEach(r=>n.push(Number(r)));else throw new Error(`Input ${e} must be an array of int32 or int64`);return n},eT=(t,e)=>{if(t.length>1){let n=tu(t,1),r=tu(t,2),i=tu(t,3);return i.length===0&&(i=[...Array(t[0].dims.length).keys()]),qe({starts:n,ends:r,axes:i})}else return e},rg=(t,e,n,r,i)=>{let s=t;return t<0&&(s+=n[r[e]]),i[e]<0?Math.max(0,Math.min(s,n[r[e]]-1)):Math.max(0,Math.min(s,n[r[e]]))},tT=(t,e,n)=>`fn calculateInputIndices(output_indices: ${e.type.indices}) -> ${t.type.indices} {
          var input_indices: ${t.type.indices};
          var carry = 0u;
          for (var i = ${n.length-1}; i >= 0; i--) {
            let input_shape_i = ${we("uniforms.input_shape","i",n.length)};
            let steps_i = ${we("uniforms.steps","i",n.length)};
            let signs_i = ${we("uniforms.signs","i",n.length)};
            let starts_i = ${we("uniforms.starts","i",n.length)};
            var output_index = ${e.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${t.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,nT=(t,e)=>{let n=t[0].dims,r=X.size(n),i=e.axes.length>0?X.normalizeAxes(e.axes,n.length):[...Array(n.length).keys()],s=tu(t,4);s.forEach(w=>w!==0||(()=>{throw new Error("step cannot be 0")})),s.length===0&&(s=Array(i.length).fill(1));let a=e.starts.map((w,y)=>rg(w,y,n,i,s)),o=e.ends.map((w,y)=>rg(w,y,n,i,s));if(i.length!==a.length||i.length!==o.length)throw new Error("start, ends and axes should have the same number of elements");if(i.length!==n.length)for(let w=0;w<n.length;++w)i.includes(w)||(a.splice(w,0,0),o.splice(w,0,n[w]),s.splice(w,0,1));let l=s.map(w=>Math.sign(w));s.forEach((w,y,I)=>{if(w<0){let R=(o[y]-a[y])/w,M=a[y],j=M+R*s[y];a[y]=j,o[y]=M,I[y]=-w}});let u=n.slice(0);i.forEach((w,y)=>{u[w]=Math.ceil((o[w]-a[w])/s[w])});let h={dims:u,dataType:t[0].dataType},f=ye("output",t[0].dataType,u.length),p=te("input",t[0].dataType,t[0].dims.length),g=X.size(u),_=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:a.length},{name:"signs",type:"i32",length:l.length},{name:"steps",type:"u32",length:s.length}],x=[{type:12,data:g},{type:12,data:a},{type:6,data:l},{type:12,data:s},...xe(t[0].dims,u)],$=w=>`
      ${w.registerUniforms(_).declareVariables(p,f)}
        ${tT(p,f,n)}
        ${w.mainStart()}
          ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${f.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${f.setByOffset("global_idx",p.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${l.length}_${a.length}_${s.length}`,inputDependencies:["rank"]},getShaderSource:$,getRunData:()=>({outputs:[h],dispatchGroup:{x:Math.ceil(r/64)},programUniforms:x})}},j3=(t,e)=>{ZE(t.inputs,e);let n=eT(t.inputs,e);t.compute(nT(t.inputs,n),{inputs:[0]})},U3=t=>{let e=t.starts,n=t.ends,r=t.axes;return qe({starts:e,ends:n,axes:r})}}),rT,iT,B3,F3,SB=se(()=>{$e(),Ce(),yt(),Cs(),Ae(),rT=t=>{if(!t||t.length!==1)throw new Error("Softmax op requires 1 input.")},iT=(t,e)=>{let n=t.inputs[0],r=n.dims,i=X.size(r),s=r.length,a=X.normalizeAxis(e.axis,s),o=a<r.length-1,l,u=[];o?(u=Array.from({length:s},(C,k)=>k),u[a]=s-1,u[s-1]=a,l=t.compute(Ln(n,u),{inputs:[n],outputs:[-1]})[0]):l=n;let h=l.dims,f=h[s-1],p=i/f,g=ht(f),_=f/g,x=64;p===1&&(x=256);let $=(C,k)=>k===4?`max(max(${C}.x, ${C}.y), max(${C}.z, ${C}.w))`:k===2?`max(${C}.x, ${C}.y)`:k===3?`max(max(${C}.x, ${C}.y), ${C}.z)`:C,w=te("x",l.dataType,l.dims,g),y=ye("result",l.dataType,l.dims,g),I=w.type.value,R=Dt(l.dataType)==="f32"?`var threadMax = ${I}(-3.402823e+38f);`:`var threadMax = ${I}(-65504.0h);`,M=C=>`
      var<workgroup> rowMaxShared : ${I};
      var<workgroup> rowSumShared : ${I};
      var<workgroup> threadShared : array<${I}, ${x}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${I} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${I}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${C.registerUniform("packedCols","i32").declareVariables(w,y)}
      ${C.mainStart(x)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${x};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${R}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${I}(${$("threadShared[0]",g)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${I}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${I}(${bs("threadShared[0]",g)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          var value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          // max operation protects against NaN since all values should be >=0
          value = max(value, ${I}(0.0));
          setValue(row, col, row_stride, value);
        }
      }`,j=t.compute({name:"Softmax",shaderCache:{hint:`${g};${x}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:h,dataType:l.dataType}],dispatchGroup:{x:p},programUniforms:[{type:6,data:_}]}),getShaderSource:M},{inputs:[l],outputs:[o?-1:0]})[0];o&&t.compute(Ln(j,u),{inputs:[j]})},B3=(t,e)=>{rT(t.inputs),iT(t,e)},F3=t=>qe({axis:t.axis})}),ig,sT,aT,oT,W3,CB=se(()=>{$e(),Ce(),Ae(),ig=t=>Array.from(t.getBigInt64Array(),Number),sT=t=>{if(!t||t.length!==2)throw new Error("Tile requires 2 inputs.");if(t[0].dataType!==1&&t[0].dataType!==10&&t[0].dataType!==6&&t[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(t[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(t[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(ig(t[1]).length!==t[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},aT=(t,e)=>{let n=[];for(let r=0;r<t.length;++r)n.push(t[r]*e[r]);return n},oT=(t,e)=>{let n=t[0].dims,r=e??ig(t[1]),i=aT(n,r),s=X.size(i),a=t[0].dataType,o=te("input",a,n.length),l=ye("output",a,i.length),u=h=>`
      const inputShape = ${o.indices(...n)};
      ${h.registerUniform("output_size","u32").declareVariables(o,l)}
      ${h.mainStart()}
      ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${l.offsetToIndices("global_idx")};
      var input_indices: ${o.type.indices};
      for (var i = 0; i < ${n.length}; i++) {
        let input_dim_i = ${o.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${l.indicesGet("output_indices","i")}  % input_dim_i;

        ${o.indicesSet("input_indices","i","input_dim_value")}
      }
      ${l.setByOffset("global_idx",o.getByIndices("input_indices"))}
    }`;return{name:"Tile",shaderCache:{hint:`${r}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:i,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:[{type:12,data:s},...xe(t[0].dims,i)]}),getShaderSource:u}},W3=t=>{sT(t.inputs),t.compute(oT(t.inputs),{inputs:[0]})}}),lT,uT,q3,AB=se(()=>{$e(),Ce(),Ae(),lT=(t,e,n,r,i)=>{let s=ye("output_data",i,n.length,4),a=te("a_data",e[1].dataType,e[1].dims.length,4),o=te("b_data",e[2].dataType,e[2].dims.length,4),l=te("c_data",e[0].dataType,e[0].dims.length,4),u,h=(f,p,g)=>`select(${p}, ${f}, ${g})`;if(!r)u=s.setByOffset("global_idx",h(a.getByOffset("global_idx"),o.getByOffset("global_idx"),l.getByOffset("global_idx")));else{let f=(p,g,_="")=>{let x=`a_data[index_a${g}][component_a${g}]`,$=`b_data[index_b${g}][component_b${g}]`,w=`bool(c_data[index_c${g}] & (0xffu << (component_c${g} * 8)))`;return`
            let output_indices${g} = ${s.offsetToIndices(`global_idx * 4u + ${g}u`)};
            let offset_a${g} = ${a.broadcastedIndicesToOffset(`output_indices${g}`,s)};
            let offset_b${g} = ${o.broadcastedIndicesToOffset(`output_indices${g}`,s)};
            let offset_c${g} = ${l.broadcastedIndicesToOffset(`output_indices${g}`,s)};
            let index_a${g} = offset_a${g} / 4u;
            let index_b${g} = offset_b${g} / 4u;
            let index_c${g} = offset_c${g} / 4u;
            let component_a${g} = offset_a${g} % 4u;
            let component_b${g} = offset_b${g} % 4u;
            let component_c${g} = offset_c${g} % 4u;
            ${p}[${g}] = ${_}(${h(x,$,w)});
          `};i===9?u=`
            var data = vec4<u32>(0);
            ${f("data",0,"u32")}
            ${f("data",1,"u32")}
            ${f("data",2,"u32")}
            ${f("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:u=`
            ${f("output_data[global_idx]",0)}
            ${f("output_data[global_idx]",1)}
            ${f("output_data[global_idx]",2)}
            ${f("output_data[global_idx]",3)}
          `}return`
        ${t.registerUniform("vec_size","u32").declareVariables(l,a,o,s)}
        ${t.mainStart()}
        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${u}
      }`},uT=t=>{let e=t[1].dims,n=t[2].dims,r=t[0].dims,i=t[1].dataType,s=!(X.areEqual(e,n)&&X.areEqual(n,r)),a=e,o=X.size(e);if(s){let u=Ko.calcShape(Ko.calcShape(e,n,!1),r,!1);if(!u)throw new Error("Can't perform where op on the given tensors");a=u,o=X.size(a)}let l=Math.ceil(o/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:u=>lT(u,t,a,s,i),getRunData:()=>({outputs:[{dims:a,dataType:i}],dispatchGroup:{x:Math.ceil(o/64/4)},programUniforms:[{type:12,data:l},...xe(r,e,n,a)]})}},q3=t=>{t.compute(uT(t.inputs))}}),H3,RB=se(()=>{qU(),Zv(),HU(),GU(),KU(),QU(),YU(),tB(),rB(),iB(),sB(),aB(),oB(),lB(),uB(),cB(),dB(),hB(),fB(),pB(),mB(),gB(),yB(),_B(),vB(),d3(),wB(),bB(),xB(),EB(),TB(),Xv(),IB(),g3(),$B(),kB(),SB(),p3(),CB(),Cs(),e0(),AB(),H3=new Map([["Abs",[VA]],["Acos",[jA]],["Acosh",[UA]],["Add",[bR]],["ArgMax",[DA,My]],["ArgMin",[OA,My]],["Asin",[BA]],["Asinh",[FA]],["Atan",[WA]],["Atanh",[qA]],["Attention",[MA]],["AveragePool",[I3,T3]],["BatchNormalization",[LA]],["BiasAdd",[zA]],["BiasSplitGelu",[wR]],["Cast",[GA,HA]],["Ceil",[QA]],["Clip",[KA]],["Concat",[RR,NR]],["Conv",[By,Uy]],["ConvTranspose",[BR,UR]],["Cos",[YA]],["Cosh",[JA]],["CumSum",[FR,WR]],["DepthToSpace",[qR,HR]],["DequantizeLinear",[N3,P3]],["Div",[xR]],["Einsum",[GR,KR]],["Elu",[XA,_u]],["Equal",[ER]],["Erf",[ZA]],["Exp",[eR]],["Expand",[QR]],["FastGelu",[YR]],["Floor",[tR]],["FusedConv",[By,Uy]],["Gather",[XR,JR]],["GatherElements",[i3,r3]],["GatherBlockQuantized",[t3,n3]],["GatherND",[ZR,e3]],["Gelu",[nR]],["Gemm",[a3,s3]],["GlobalAveragePool",[k3,$3]],["GlobalMaxPool",[R3,A3]],["Greater",[kR]],["GreaterOrEqual",[CR]],["GridSample",[o3,l3]],["GroupQueryAttention",[y3]],["HardSigmoid",[cR,uR]],["InstanceNormalization",[_3]],["LayerNormalization",[v3]],["LeakyRelu",[rR,_u]],["Less",[SR]],["LessOrEqual",[AR]],["Log",[_R]],["MatMul",[w3]],["MatMulNBits",[b3,x3]],["MaxPool",[S3,C3]],["Mul",[TR]],["MultiHeadAttention",[c3,u3]],["Neg",[sR]],["Not",[iR]],["Pad",[E3]],["Pow",[IR]],["QuickGelu",[vR,_u]],["Range",[O3]],["Reciprocal",[aR]],["ReduceMin",[CA]],["ReduceMean",[TA]],["ReduceMax",[SA]],["ReduceSum",[RA]],["ReduceProd",[AA]],["ReduceL1",[IA]],["ReduceL2",[$A]],["ReduceLogSum",[PA]],["ReduceLogSumExp",[kA]],["ReduceSumSquare",[NA]],["Relu",[oR]],["Resize",[L3,z3]],["RotaryEmbedding",[m3]],["ScatterND",[M3,D3]],["Sigmoid",[lR]],["Sin",[dR]],["Sinh",[hR]],["Slice",[j3,U3]],["SkipLayerNormalization",[V3]],["Split",[h3,f3]],["Sqrt",[fR]],["Softmax",[B3,F3]],["Sub",[$R]],["Tan",[pR]],["Tanh",[mR]],["ThresholdedRelu",[yR,_u]],["Tile",[W3]],["Transpose",[hA,fA]],["Where",[q3]]])}),G3,NB=se(()=>{Jn(),Ai(),Ae(),G3=class{constructor(t){this.backend=t,this.repo=new Map,this.attributesBound=!1}getArtifact(t){return this.repo.get(t)}setArtifact(t,e){this.repo.set(t,e)}run(t,e,n,r,i){Zr(t.programInfo.name);let s=this.backend.device,a=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let o=[];for(let u of e)o.push({binding:o.length,resource:{buffer:u.buffer}});for(let u of n)o.push({binding:o.length,resource:{buffer:u.buffer}});i&&o.push({binding:o.length,resource:i});let l=s.createBindGroup({layout:t.computePipeline.getBindGroupLayout(0),entries:o,label:t.programInfo.name});if(this.backend.sessionStatus==="capturing"){let u={kernelId:this.backend.currentKernelId,computePipeline:t.computePipeline,bindGroup:l,dispatchGroup:r};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(u)}a.setPipeline(t.computePipeline),a.setBindGroup(0,l),a.dispatchWorkgroups(...r),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),Er(t.programInfo.name)}dispose(){}build(t,e){Zr(t.name);let n=this.backend.device,r=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(u=>{n.features.has(u.feature)&&r.push(`enable ${u.extension};`)});let i=dA(e,this.backend.device.limits),s=t.getShaderSource(i),a=`${r.join(`
`)}
${i.additionalImplementations}
${s}`,o=n.createShaderModule({code:a,label:t.name});De("verbose",()=>`[WebGPU] ${t.name} shader code: ${a}`);let l=n.createComputePipeline({compute:{module:o,entryPoint:"main"},layout:"auto",label:t.name});return Er(t.name),{programInfo:t,computePipeline:l,uniformVariablesInfo:i.variablesInfo}}normalizeDispatchGroupSize(t){let e=typeof t=="number"?t:t.x,n=typeof t=="number"?1:t.y||1,r=typeof t=="number"?1:t.z||1,i=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(e<=i&&n<=i&&r<=i)return[e,n,r];let s=e*n*r,a=Math.ceil(Math.sqrt(s));if(a>i){if(a=Math.ceil(Math.cbrt(s)),a>i)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[a,a,a]}else return[a,a,1]}}}),K3={};ll(K3,{WebGpuBackend:()=>Q3});var cT,dT,hT,Q3,PB=se(()=>{Jn(),$e(),Ai(),aA(),FU(),RB(),NB(),cT=(t,e)=>{if(e.length!==t.length)throw new Error(`inputDependencies length ${e.length} is not equal to inputTensors length ${t.length}.`);let n=[];for(let r=0;r<t.length;++r){let i=t[r].dataType;switch(e[r]){case"none":{n.push("");break}case"type":{n.push(`${i}`);break}case"rank":{let s=t[r].dims.length;n.push(`${i};${s}`);break}case"dims":{let s=t[r].dims.join(",");n.push(`${i};${s}`);break}default:throw new Error(`unsupported input dependency: ${e[r]}`)}}return n.join("|")},dT=(t,e,n)=>{var i,s;let r=t.name;return(i=t.shaderCache)!=null&&i.hint&&(r+="["+t.shaderCache.hint+"]"),r+=":"+n+`:${cT(e,((s=t.shaderCache)==null?void 0:s.inputDependencies)??new Array(e.length).fill("dims"))}`,r},hT=class{constructor(t){t&&(this.architecture=t.architecture,this.vendor=t.vendor)}isArchitecture(t){return this.architecture===t}isVendor(t){return this.vendor===t}},Q3=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let t=this.kernelCustomData.get(this.currentKernelId);return t||(t={},this.kernelCustomData.set(this.currentKernelId,t)),t}async initialize(t,e){this.env=t;let n=[],r={requiredLimits:{maxComputeWorkgroupStorageSize:e.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:e.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:e.limits.maxStorageBufferBindingSize,maxBufferSize:e.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:e.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:e.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:e.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:e.limits.maxComputeWorkgroupSizeZ},requiredFeatures:n},i=s=>e.features.has(s)&&n.push(s)&&!0;i("chromium-experimental-timestamp-query-inside-passes")||i("timestamp-query"),i("shader-f16"),i("subgroups"),this.device=await e.requestDevice(r),this.adapterInfo=new hT(e.info||await e.requestAdapterInfo()),this.gpuDataManager=uA(this),this.programManager=new G3(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,Kv(t.logLevel,!!t.debug),this.device.onuncapturederror=s=>{s.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${s.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:e,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let t=this.getCommandEncoder(),e={};this.queryType==="at-passes"&&(e.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=t.beginComputePass(e)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;Zr(),this.endComputePass();let t;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),t=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(t,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,t,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&t.mapAsync(GPUMapMode.READ).then(()=>{var r;let e=new BigUint64Array(t.getMappedRange()),n=this.pendingQueries.get(t);for(let i=0;i<e.length/2;i++){let s=n[i],a=s.kernelId,o=this.kernels.get(a),l=o.kernelType,u=o.kernelName,h=s.programName,f=s.inputTensorViews,p=s.outputTensorViews,g=e[i*2],_=e[i*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=g);let x=Number(g-this.queryTimeBase),$=Number(_-this.queryTimeBase);if(!Number.isSafeInteger(x)||!Number.isSafeInteger($))throw new RangeError("incorrect timestamp range");if((r=this.env.webgpu.profiling)!=null&&r.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:f.map(w=>({dims:w.dims,dataType:hi(w.dataType)})),outputsMetadata:p.map(w=>({dims:w.dims,dataType:hi(w.dataType)})),kernelId:a,kernelType:l,kernelName:u,programName:h,startTime:x,endTime:$});else{let w="";f.forEach((I,R)=>{w+=`input[${R}]: [${I.dims}] | ${hi(I.dataType)}, `});let y="";p.forEach((I,R)=>{y+=`output[${R}]: [${I.dims}] | ${hi(I.dataType)}, `}),console.log(`[profiling] kernel "${a}|${l}|${u}|${h}" ${w}${y}start time: ${x} ns, execution time: ${$-x} ns`)}mf("GPU",`${h}::${g}::${_}`)}t.unmap(),this.pendingQueries.delete(t)}),Er()}run(t,e,n,r,i,s){Zr(t.name);let a=[];for(let y=0;y<e.length;++y){let I=e[y].data;if(I===0)continue;let R=this.gpuDataManager.get(I);if(!R)throw new Error(`no GPU data for input: ${I}`);a.push(R)}let{outputs:o,dispatchGroup:l,programUniforms:u}=t.getRunData(e),h=n.length===0?o.map((y,I)=>I):n;if(h.length!==o.length)throw new Error(`Output size ${h.length} must be equal to ${o.length}.`);let f=[],p=[];for(let y=0;y<o.length;++y){if(!Number.isInteger(h[y])||h[y]<-3||h[y]>=s)throw new Error(`Invalid output index: ${h[y]}`);if(h[y]===-3)continue;let I=h[y]===-1,R=h[y]===-2,M=I||R?i(o[y].dataType,o[y].dims):r(h[y],o[y].dataType,o[y].dims);if(f.push(M),M.data===0)continue;let j=this.gpuDataManager.get(M.data);if(!j)throw new Error(`no GPU data for output: ${M.data}`);if(I&&this.temporaryData.push(j),R){let C=this.kernelPersistentData.get(this.currentKernelId);C||(C=[],this.kernelPersistentData.set(this.currentKernelId,C)),C.push(j)}p.push(j)}if(a.length!==e.length||p.length!==f.length){if(p.length===0)return Er(t.name),f;throw new Error(`Program ${t.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let g;if(u){let y=0,I=[];u.forEach(C=>{let k=typeof C.data=="number"?[C.data]:C.data;if(k.length===0)return;let P=C.type===10?2:4,A,D;C.type===10?(D=k.length>4?16:k.length>2?8:k.length*P,A=k.length>4?16:P*k.length):(D=k.length<=2?k.length*P:16,A=16),y=Math.ceil(y/D)*D,I.push(y);let z=C.type===10?8:4;y+=k.length>4?Math.ceil(k.length/z)*A:k.length*P});let R=16;y=Math.ceil(y/R)*R;let M=new ArrayBuffer(y);u.forEach((C,k)=>{let P=I[k],A=typeof C.data=="number"?[C.data]:C.data;if(C.type===6)new Int32Array(M,P,A.length).set(A);else if(C.type===12)new Uint32Array(M,P,A.length).set(A);else if(C.type===10)new Uint16Array(M,P,A.length).set(A);else if(C.type===1)new Float32Array(M,P,A.length).set(A);else throw new Error(`Unsupported uniform type: ${hi(C.type)}`)});let j=this.gpuDataManager.create(y,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(j.buffer,0,M,0,y),this.gpuDataManager.release(j.id),g={offset:0,size:y,buffer:j.buffer}}let _=this.programManager.normalizeDispatchGroupSize(l),x=_[1]===1&&_[2]===1,$=dT(t,e,x),w=this.programManager.getArtifact($);if(w||(w=this.programManager.build(t,_),this.programManager.setArtifact($,w),De("info",()=>`[artifact] key: ${$}, programName: ${t.name}`)),u&&w.uniformVariablesInfo){if(u.length!==w.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${w.uniformVariablesInfo.length}, got ${u.length} in program "${w.programInfo.name}".`);for(let y=0;y<u.length;y++){let I=u[y],R=I.type,M=typeof I.data=="number"?1:I.data.length,[j,C]=w.uniformVariablesInfo[y];if(R!==j||M!==C)throw new Error(`Uniform variable ${y} mismatch: expect type ${j} with size ${C}, got type ${R} with size ${M} in program "${w.programInfo.name}".`)}}if(De("info",()=>`[ProgramManager] run "${t.name}" (key=${$}) with ${_[0]}x${_[1]}x${_[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let y={kernelId:this.currentKernelId,programName:w.programInfo.name,inputTensorViews:e,outputTensorViews:f};this.pendingKernels.push(y),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push(y)}return this.programManager.run(w,a,p,_,g),Er(t.name),f}upload(t,e){this.gpuDataManager.upload(t,e)}memcpy(t,e){this.gpuDataManager.memcpy(t,e)}async download(t,e){await this.gpuDataManager.download(t,e)}alloc(t){return this.gpuDataManager.create(t).id}free(t){return this.gpuDataManager.release(t)}createKernel(t,e,n,r){let i=H3.get(t);if(!i)throw new Error(`kernel not implemented: ${t}`);let s={kernelType:t,kernelName:r,kernelEntry:i[0],attributes:[i[1],n]};this.kernels.set(e,s)}releaseKernel(t){let e=this.kernelPersistentData.get(t);if(e){for(let n of e)this.gpuDataManager.release(n.id);this.kernelPersistentData.delete(t)}this.kernelCustomData.delete(t),this.kernels.delete(t)}computeKernel(t,e,n){let r=this.kernels.get(t);if(!r)throw new Error(`kernel not created: ${t}`);let i=r.kernelType,s=r.kernelName,a=r.kernelEntry,o=r.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${i}] ${s}" is not allowed to be called recursively`);this.currentKernelId=t,o[0]&&(o[1]=o[0](o[1]),o[0]=void 0),De("info",()=>`[WebGPU] Start to run kernel "[${i}] ${s}"...`);let l=this.env.debug;this.temporaryData=[];try{return l&&this.device.pushErrorScope("validation"),a(e,o[1]),0}catch(u){return n.push(Promise.resolve(`[WebGPU] Kernel "[${i}] ${s}" failed. ${u}`)),1}finally{l&&n.push(this.device.popErrorScope().then(u=>u?`GPU validation error for kernel "[${i}] ${s}": ${u.message}`:null));for(let u of this.temporaryData)this.gpuDataManager.release(u.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(t,e,n,r){let i=this.sessionExternalDataMapping.get(t);i||(i=new Map,this.sessionExternalDataMapping.set(t,i));let s=i.get(e),a=this.gpuDataManager.registerExternalBuffer(n,r,s);return i.set(e,[a,n]),a}unregisterBuffers(t){let e=this.sessionExternalDataMapping.get(t);e&&(e.forEach(n=>this.gpuDataManager.unregisterExternalBuffer(n[0])),this.sessionExternalDataMapping.delete(t))}getBuffer(t){let e=this.gpuDataManager.get(t);if(!e)throw new Error(`no GPU data for buffer: ${t}`);return e.buffer}createDownloader(t,e,n){return async()=>{let r=await Py(this,t,e);return Qv(r.buffer,n)}}writeTimestamp(t){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,t)}setQueryType(){var t;this.queryType="none",(((t=this.env.webgpu.profiling)==null?void 0:t.mode)==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){De("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){De("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){De("info","replay"),this.sessionStatus="replaying";let t=this.capturedCommandList.get(this.currentSessionId),e=this.capturedPendingKernels.get(this.currentSessionId),n=t.length;this.pendingKernels=[];for(let r=0;r<n;r++){let i=this.getComputePassEncoder(),s=t[r];this.writeTimestamp(this.pendingDispatchNumber*2),i.setPipeline(s.computePipeline),i.setBindGroup(0,s.bindGroup),i.dispatchWorkgroups(...s.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(e[r]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(t){this.unregisterBuffers(t),this.capturedCommandList.has(t)&&this.capturedCommandList.delete(t),this.capturedPendingKernels.has(t)&&this.capturedPendingKernels.delete(t),this.gpuDataManager.onReleaseSession(t)}onRunStart(t){this.currentSessionId=t,this.setQueryType()}}}),Y3={};ll(Y3,{init:()=>J3});var Qd,fT,J3,OB=se(()=>{$e(),Ai(),Ce(),BU(),Qd=class X3{constructor(e,n,r,i){this.module=e,this.dataType=n,this.data=r,this.dims=i}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let e=X.size(this.dims);return e===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,e)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let e=X.size(this.dims);return e===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,e)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let e=X.size(this.dims);return e===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,e)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let e=X.size(this.dims);return e===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,e)}reshape(e){if(X.size(e)!==X.size(this.dims))throw new Error("Invalid new shape");return new X3(this.module,this.dataType,this.data,e)}},fT=class{constructor(t,e,n){this.module=t,this.backend=e,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=e.adapterInfo;let r=t.PTR_SIZE,i=n/t.PTR_SIZE,s=r===4?"i32":"i64";this.opKernelContext=Number(t.getValue(r*i++,s));let a=Number(t.getValue(r*i++,s));this.outputCount=Number(t.getValue(r*i++,s)),this.customDataOffset=Number(t.getValue(r*i++,"*")),this.customDataSize=Number(t.getValue(r*i++,s));let o=[];for(let l=0;l<a;l++){let u=Number(t.getValue(r*i++,s)),h=Number(t.getValue(r*i++,"*")),f=Number(t.getValue(r*i++,s)),p=[];for(let g=0;g<f;g++)p.push(Number(t.getValue(r*i++,s)));o.push(new Qd(t,u,h,p))}this.inputs=o}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(t,e){var a;let n=((a=e==null?void 0:e.inputs)==null?void 0:a.map(o=>typeof o=="number"?this.inputs[o]:o))??this.inputs,r=(e==null?void 0:e.outputs)??[],i=(o,l,u)=>new Qd(this.module,l,this.output(o,u),u),s=(o,l)=>{let u=ia(o,l);if(!u)throw new Error(`Unsupported data type: ${o}`);let h=u>0?this.backend.gpuDataManager.create(u).id:0;return new Qd(this.module,o,h,l)};return this.backend.run(t,n,r,i,s,this.outputCount)}output(t,e){let n=this.module.stackSave();try{let r=this.module.PTR_SIZE,i=r===4?"i32":"i64",s=this.module.stackAlloc((1+e.length)*r);this.module.setValue(s,e.length,i);for(let a=0;a<e.length;a++)this.module.setValue(s+r*(a+1),e[a],i);return this.module._JsepOutput(this.opKernelContext,t,s)}catch(r){throw new Error(`Failed to generate kernel's output[${t}] with dims [${e}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${r}`)}finally{this.module.stackRestore(n)}}},J3=async(t,e,n,r)=>{let i=e.jsepInit;if(!i)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(t==="webgpu"){let s=(PB(),fc(K3)).WebGpuBackend,a=new s;await a.initialize(n,r),i("webgpu",[a,o=>a.alloc(Number(o)),o=>a.free(o),(o,l,u,h=!1)=>{if(h)De("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(o)}, dst=${Number(l)}, size=${Number(u)}`),a.memcpy(Number(o),Number(l));else{De("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(o)}, gpuDataId=${Number(l)}, size=${Number(u)}`);let f=e.HEAPU8.subarray(Number(o>>>0),Number(o>>>0)+Number(u));a.upload(Number(l),f)}},async(o,l,u)=>{De("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${o}, dataOffset=${l}, size=${u}`),await a.download(Number(o),()=>e.HEAPU8.subarray(Number(l)>>>0,Number(l+u)>>>0))},(o,l,u)=>a.createKernel(o,Number(l),u,e.UTF8ToString(e._JsepGetNodeName(Number(l)))),o=>a.releaseKernel(o),(o,l,u,h)=>{De("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${u}, kernel=${o}, contextDataOffset=${l}`);let f=new fT(e,a,Number(l));return a.computeKernel(Number(o),f,h)},()=>a.captureBegin(),()=>a.captureEnd(),()=>a.replay()])}else{let s=new lA(n);i("webnn",[s,()=>s.reserveTensorId(),a=>s.releaseTensorId(a),async(a,o,l,u,h)=>s.ensureTensor(a,o,l,u,h),(a,o)=>{s.uploadTensor(a,o)},async(a,o)=>s.downloadTensor(a,o),(a,o)=>s.registerMLContext(a,o),!!n.trace])}}}),pT,a0,o0,Ui,mT,sg,xf,l0,u0,ag,c0,d0,h0,Z3=se(()=>{Jn(),VU(),jU(),$e(),La(),Wv(),nA(),pT=(t,e)=>{Ze()._OrtInit(t,e)!==0&&Ke("Can't initialize onnxruntime.")},a0=async t=>{pT(t.wasm.numThreads,yf(t.logLevel))},o0=async(t,e)=>{var r,i;(i=(r=Ze()).asyncInit)==null||i.call(r);let n=t.webgpu.adapter;if(e==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(n){if(typeof n.limits!="object"||typeof n.features!="object"||typeof n.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let s=t.webgpu.powerPreference;if(s!==void 0&&s!=="low-power"&&s!=="high-performance")throw new Error(`Invalid powerPreference setting: "${s}"`);let a=t.webgpu.forceFallbackAdapter;if(a!==void 0&&typeof a!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${a}"`);if(n=await navigator.gpu.requestAdapter({powerPreference:s,forceFallbackAdapter:a}),!n)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(e==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");{let s=(OB(),fc(Y3)).init;e==="webgpu"&&await s("webgpu",Ze(),t,n),e==="webnn"&&await s("webnn",Ze(),t)}},Ui=new Map,mT=t=>{let e=Ze(),n=e.stackSave();try{let r=e.PTR_SIZE,i=e.stackAlloc(2*r);e._OrtGetInputOutputCount(t,i,i+r)!==0&&Ke("Can't get session input/output count.");let s=r===4?"i32":"i64";return[Number(e.getValue(i,s)),Number(e.getValue(i+r,s))]}finally{e.stackRestore(n)}},sg=(t,e)=>{let n=Ze(),r=n.stackSave(),i=0;try{let s=n.PTR_SIZE,a=n.stackAlloc(2*s);n._OrtGetInputOutputMetadata(t,e,a,a+s)!==0&&Ke("Can't get session input/output metadata.");let o=Number(n.getValue(a,"*"));i=Number(n.getValue(a+s,"*"));let l=n.HEAP32[i/4];if(l===0)return[o,0];let u=n.HEAPU32[i/4+1],h=[];for(let f=0;f<u;f++){let p=Number(n.getValue(i+8+f*s,"*"));h.push(p!==0?n.UTF8ToString(p):Number(n.getValue(i+8+(f+u)*s,"*")))}return[o,l,h]}finally{n.stackRestore(r),i!==0&&n._OrtFree(i)}},xf=t=>{let e=Ze(),n=e._malloc(t.byteLength);if(n===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${t.byteLength}.`);return e.HEAPU8.set(t,n),[n,t.byteLength]},l0=async(t,e)=>{var f,p,g,_;let n,r,i=Ze();Array.isArray(t)?[n,r]=t:t.buffer===i.HEAPU8.buffer?[n,r]=[t.byteOffset,t.byteLength]:[n,r]=xf(t);let s=0,a=0,o=0,l=[],u=[],h=[];try{if([a,l]=await tA(e),(e==null?void 0:e.externalData)&&i.mountExternalData){let k=[];for(let P of e.externalData){let A=typeof P=="string"?P:P.path;k.push(Gv(typeof P=="string"?P:P.data).then(D=>{i.mountExternalData(A,D)}))}await Promise.all(k)}for(let k of(e==null?void 0:e.executionProviders)??[])if((typeof k=="string"?k:k.name)==="webnn"){if(i.shouldTransferToMLTensor=!1,typeof k!="string"){let P=k,A=P==null?void 0:P.context,D=P==null?void 0:P.gpuDevice,z=P==null?void 0:P.deviceType,O=P==null?void 0:P.powerPreference;A?i.currentContext=A:D?i.currentContext=await i.webnnCreateMLContext(D):i.currentContext=await i.webnnCreateMLContext({deviceType:z,powerPreference:O})}else i.currentContext=await i.webnnCreateMLContext();break}s=await i._OrtCreateSession(n,r,a),(f=i.webgpuOnCreateSession)==null||f.call(i,s),s===0&&Ke("Can't create a session."),(p=i.jsepOnCreateSession)==null||p.call(i),i.currentContext&&(i.webnnRegisterMLContext(s,i.currentContext),i.currentContext=void 0,i.shouldTransferToMLTensor=!0);let[x,$]=mT(s),w=!!(e!=null&&e.enableGraphCapture),y=[],I=[],R=[],M=[],j=[];for(let k=0;k<x;k++){let[P,A,D]=sg(s,k);P===0&&Ke("Can't get an input name."),u.push(P);let z=i.UTF8ToString(P);y.push(z),R.push(A===0?{name:z,isTensor:!1}:{name:z,isTensor:!0,type:hi(A),shape:D})}for(let k=0;k<$;k++){let[P,A,D]=sg(s,k+x);P===0&&Ke("Can't get an output name."),h.push(P);let z=i.UTF8ToString(P);I.push(z),M.push(A===0?{name:z,isTensor:!1}:{name:z,isTensor:!0,type:hi(A),shape:D});{if(w&&(e==null?void 0:e.preferredOutputLocation)===void 0){j.push("gpu-buffer");continue}let O=typeof(e==null?void 0:e.preferredOutputLocation)=="string"?e.preferredOutputLocation:((g=e==null?void 0:e.preferredOutputLocation)==null?void 0:g[z])??"cpu",ce=i.webnnIsGraphOutput;if(O==="cpu"&&ce&&ce(s,z)){j.push("ml-tensor-cpu-output");continue}if(O!=="cpu"&&O!=="cpu-pinned"&&O!=="gpu-buffer"&&O!=="ml-tensor")throw new Error(`Not supported preferred output location: ${O}.`);if(w&&O!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${O}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);j.push(O)}}let C=null;return j.some(k=>k==="gpu-buffer"||k==="ml-tensor"||k==="ml-tensor-cpu-output")&&(o=i._OrtCreateBinding(s),o===0&&Ke("Can't create IO binding."),C={handle:o,outputPreferredLocations:j,outputPreferredLocationsEncoded:j.map(k=>k==="ml-tensor-cpu-output"?"ml-tensor":k).map(k=>Ry(k))}),Ui.set(s,[s,u,h,C,w,!1]),[s,y,I,R,M]}catch(x){throw u.forEach($=>i._OrtFree($)),h.forEach($=>i._OrtFree($)),o!==0&&i._OrtReleaseBinding(o)!==0&&Ke("Can't release IO binding."),s!==0&&i._OrtReleaseSession(s)!==0&&Ke("Can't release session."),x}finally{i._free(n),a!==0&&i._OrtReleaseSessionOptions(a)!==0&&Ke("Can't release session options."),l.forEach(x=>i._free(x)),(_=i.unmountExternalData)==null||_.call(i)}},u0=t=>{var l,u,h;let e=Ze(),n=Ui.get(t);if(!n)throw new Error(`cannot release session. invalid session id: ${t}`);let[r,i,s,a,o]=n;a&&(o&&e._OrtClearBoundOutputs(a.handle)!==0&&Ke("Can't clear bound outputs."),e._OrtReleaseBinding(a.handle)!==0&&Ke("Can't release IO binding.")),(l=e.jsepOnReleaseSession)==null||l.call(e,t),(u=e.webnnOnReleaseSession)==null||u.call(e,t),(h=e.webgpuOnReleaseSession)==null||h.call(e,t),i.forEach(f=>e._OrtFree(f)),s.forEach(f=>e._OrtFree(f)),e._OrtReleaseSession(r)!==0&&Ke("Can't release session."),Ui.delete(t)},ag=async(t,e,n,r,i,s,a=!1)=>{if(!t){e.push(0);return}let o=Ze(),l=o.PTR_SIZE,u=t[0],h=t[1],f=t[3],p=f,g,_;if(u==="string"&&(f==="gpu-buffer"||f==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(a&&f!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${s} when enableGraphCapture is true.`);if(f==="gpu-buffer"){let w=t[2].gpuBuffer;_=ia(ra(u),h);{let y=o.jsepRegisterBuffer;if(!y)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');g=y(r,s,w,_)}}else if(f==="ml-tensor"){let w=t[2].mlTensor;_=ia(ra(u),h);let y=o.webnnRegisterMLTensor;if(!y)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');g=y(r,w,ra(u),h)}else{let w=t[2];if(Array.isArray(w)){_=l*w.length,g=o._malloc(_),n.push(g);for(let y=0;y<w.length;y++){if(typeof w[y]!="string")throw new TypeError(`tensor data at index ${y} is not a string`);o.setValue(g+y*l,mr(w[y],n),"*")}}else{let y=o.webnnIsGraphInput,I=o.webnnIsGraphOutput;if(u!=="string"&&y&&I){let R=o.UTF8ToString(i);if(y(r,R)||I(r,R)){let M=ra(u);_=ia(M,h),p="ml-tensor";let j=o.webnnCreateTemporaryTensor,C=o.webnnUploadTensor;if(!j||!C)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let k=await j(r,M,h);C(k,new Uint8Array(w.buffer,w.byteOffset,w.byteLength)),g=k}else _=w.byteLength,g=o._malloc(_),n.push(g),o.HEAPU8.set(new Uint8Array(w.buffer,w.byteOffset,_),g)}else _=w.byteLength,g=o._malloc(_),n.push(g),o.HEAPU8.set(new Uint8Array(w.buffer,w.byteOffset,_),g)}}let x=o.stackSave(),$=o.stackAlloc(4*h.length);try{h.forEach((y,I)=>o.setValue($+I*l,y,l===4?"i32":"i64"));let w=o._OrtCreateTensor(ra(u),g,_,$,h.length,Ry(p));w===0&&Ke(`Can't create tensor for input/output. session=${r}, index=${s}.`),e.push(w)}finally{o.stackRestore(x)}},c0=async(t,e,n,r,i,s)=>{var D,z,O,ce;let a=Ze(),o=a.PTR_SIZE,l=Ui.get(t);if(!l)throw new Error(`cannot run inference. invalid session id: ${t}`);let u=l[0],h=l[1],f=l[2],p=l[3],g=l[4],_=l[5],x=e.length,$=r.length,w=0,y=[],I=[],R=[],M=[],j=a.stackSave(),C=a.stackAlloc(x*o),k=a.stackAlloc(x*o),P=a.stackAlloc($*o),A=a.stackAlloc($*o);try{[w,y]=eA(s),ha("wasm prepareInputOutputTensor");for(let K=0;K<x;K++)await ag(n[K],I,M,t,h[e[K]],e[K],g);for(let K=0;K<$;K++)await ag(i[K],R,M,t,f[r[K]],x+r[K],g);fa("wasm prepareInputOutputTensor");for(let K=0;K<x;K++)a.setValue(C+K*o,I[K],"*"),a.setValue(k+K*o,h[e[K]],"*");for(let K=0;K<$;K++)a.setValue(P+K*o,R[K],"*"),a.setValue(A+K*o,f[r[K]],"*");if(p&&!_){let{handle:K,outputPreferredLocations:B,outputPreferredLocationsEncoded:F}=p;if(h.length!==x)throw new Error(`input count from feeds (${x}) is expected to be always equal to model's input count (${h.length}).`);ha("wasm bindInputsOutputs");for(let U=0;U<x;U++){let G=e[U];await a._OrtBindInput(K,h[G],I[U])!==0&&Ke(`Can't bind input[${U}] for session=${t}.`)}for(let U=0;U<$;U++){let G=r[U];(D=i[U])!=null&&D[3]?a._OrtBindOutput(K,f[G],R[U],0)!==0&&Ke(`Can't bind pre-allocated output[${U}] for session=${t}.`):a._OrtBindOutput(K,f[G],0,F[G])!==0&&Ke(`Can't bind output[${U}] to ${B[U]} for session=${t}.`)}fa("wasm bindInputsOutputs"),Ui.set(t,[u,h,f,p,g,!0])}(z=a.jsepOnRunStart)==null||z.call(a,u),(O=a.webnnOnRunStart)==null||O.call(a,u);let de;p?de=await a._OrtRunWithBinding(u,p.handle,$,P,w):de=await a._OrtRun(u,k,C,x,A,$,P,w),de!==0&&Ke("failed to call OrtRun().");let ue=[],pe=[];ha("wasm ProcessOutputTensor");for(let K=0;K<$;K++){let B=Number(a.getValue(P+K*o,"*"));if(B===R[K]){ue.push(i[K]);continue}let F=a.stackSave(),U=a.stackAlloc(4*o),G=!1,q,Y=0;try{a._OrtGetTensorData(B,U,U+o,U+2*o,U+3*o)!==0&&Ke(`Can't access output tensor data on index ${K}.`);let ae=o===4?"i32":"i64",Ee=Number(a.getValue(U,ae));Y=a.getValue(U+o,"*");let Q=a.getValue(U+o*2,"*"),be=Number(a.getValue(U+o*3,ae)),rt=[];for(let je=0;je<be;je++)rt.push(Number(a.getValue(Q+je*o,ae)));a._OrtFree(Q)!==0&&Ke("Can't free memory for tensor dims.");let et=rt.reduce((je,Xe)=>je*Xe,1);q=hi(Ee);let vt=p==null?void 0:p.outputPreferredLocations[r[K]];if(q==="string"){if(vt==="gpu-buffer"||vt==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let je=[];for(let Xe=0;Xe<et;Xe++){let Yt=a.getValue(Y+Xe*o,"*"),ni=a.getValue(Y+(Xe+1)*o,"*"),Xn=Xe===et-1?void 0:ni-Yt;je.push(a.UTF8ToString(Yt,Xn))}ue.push([q,rt,je,"cpu"])}else if(vt==="gpu-buffer"&&et>0){let je=a.jsepGetBuffer;if(!je)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let Xe=je(Y),Yt=ia(Ee,et);if(Yt===void 0||!qv(q))throw new Error(`Unsupported data type: ${q}`);G=!0,ue.push([q,rt,{gpuBuffer:Xe,download:a.jsepCreateDownloader(Xe,Yt,q),dispose:()=>{a._OrtReleaseTensor(B)!==0&&Ke("Can't release tensor.")}},"gpu-buffer"])}else if(vt==="ml-tensor"&&et>0){let je=a.webnnEnsureTensor,Xe=a.webnnIsGraphInputOutputTypeSupported;if(!je||!Xe)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(ia(Ee,et)===void 0||!Hv(q))throw new Error(`Unsupported data type: ${q}`);if(!Xe(t,q,!1))throw new Error(`preferredLocation "ml-tensor" for ${q} output is not supported by current WebNN Context.`);let Yt=await je(t,Y,Ee,rt,!1);G=!0,ue.push([q,rt,{mlTensor:Yt,download:a.webnnCreateMLTensorDownloader(Y,q),dispose:()=>{a.webnnReleaseTensorId(Y),a._OrtReleaseTensor(B)}},"ml-tensor"])}else if(vt==="ml-tensor-cpu-output"&&et>0){let je=a.webnnCreateMLTensorDownloader(Y,q)(),Xe=ue.length;G=!0,pe.push((async()=>{let Yt=[Xe,await je];return a.webnnReleaseTensorId(Y),a._OrtReleaseTensor(B),Yt})()),ue.push([q,rt,[],"cpu"])}else{let je=op(q),Xe=new je(et);new Uint8Array(Xe.buffer,Xe.byteOffset,Xe.byteLength).set(a.HEAPU8.subarray(Y,Y+Xe.byteLength)),ue.push([q,rt,Xe,"cpu"])}}finally{a.stackRestore(F),q==="string"&&Y&&a._free(Y),G||a._OrtReleaseTensor(B)}}p&&!g&&(a._OrtClearBoundOutputs(p.handle)!==0&&Ke("Can't clear bound outputs."),Ui.set(t,[u,h,f,p,g,!1]));for(let[K,B]of await Promise.all(pe))ue[K][2]=B;return fa("wasm ProcessOutputTensor"),ue}finally{(ce=a.webnnOnRunEnd)==null||ce.call(a,u),a.stackRestore(j),I.forEach(de=>a._OrtReleaseTensor(de)),R.forEach(de=>a._OrtReleaseTensor(de)),M.forEach(de=>a._free(de)),w!==0&&a._OrtReleaseRunOptions(w),y.forEach(de=>a._free(de))}},d0=t=>{let e=Ze(),n=Ui.get(t);if(!n)throw new Error("invalid session id");let r=n[0],i=e._OrtEndProfiling(r);i===0&&Ke("Can't get an profile file name."),e._OrtFree(i)},h0=t=>{let e=[];for(let n of t){let r=n[2];!Array.isArray(r)&&"buffer"in r&&e.push(r.buffer)}return e}}),Bi,vn,to,nu,ru,Yd,og,Jd,Js,Xs,gT,eN,tN,nN,rN,iN,sN,aN,oN=se(()=>{Jn(),Z3(),La(),Bv(),Bi=()=>!!it.wasm.proxy&&typeof document<"u",to=!1,nu=!1,ru=!1,Jd=new Map,Js=(t,e)=>{let n=Jd.get(t);n?n.push(e):Jd.set(t,[e])},Xs=()=>{if(to||!nu||ru||!vn)throw new Error("worker not ready")},gT=t=>{switch(t.data.type){case"init-wasm":to=!1,t.data.err?(ru=!0,og[1](t.data.err)):(nu=!0,og[0]()),Yd&&(URL.revokeObjectURL(Yd),Yd=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let e=Jd.get(t.data.type);t.data.err?e.shift()[1](t.data.err):e.shift()[0](t.data.out);break}}},eN=async()=>{if(!nu){if(to)throw new Error("multiple calls to 'initWasm()' detected.");if(ru)throw new Error("previous call to 'initWasm()' failed.");if(to=!0,Bi())return new Promise((t,e)=>{vn==null||vn.terminate(),XC().then(([n,r])=>{try{vn=r,vn.onerror=s=>e(s),vn.onmessage=gT,og=[t,e];let i={type:"init-wasm",in:it};!i.in.wasm.wasmPaths&&(n||Ay)&&(i.in.wasm.wasmPaths={wasm:new URL(""+new URL("ort-wasm-simd-threaded.jsep-BGTZ4Y7F.wasm",import.meta.url).href,import.meta.url).href}),vn.postMessage(i),Yd=n}catch(i){e(i)}},e)});try{await Fv(it.wasm),await a0(it),nu=!0}catch(t){throw ru=!0,t}finally{to=!1}}},tN=async t=>{if(Bi())return Xs(),new Promise((e,n)=>{Js("init-ep",[e,n]);let r={type:"init-ep",in:{epName:t,env:it}};vn.postMessage(r)});await o0(it,t)},nN=async t=>Bi()?(Xs(),new Promise((e,n)=>{Js("copy-from",[e,n]);let r={type:"copy-from",in:{buffer:t}};vn.postMessage(r,[t.buffer])})):xf(t),rN=async(t,e)=>{if(Bi()){if(e!=null&&e.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return Xs(),new Promise((n,r)=>{Js("create",[n,r]);let i={type:"create",in:{model:t,options:{...e}}},s=[];t instanceof Uint8Array&&s.push(t.buffer),vn.postMessage(i,s)})}else return l0(t,e)},iN=async t=>{if(Bi())return Xs(),new Promise((e,n)=>{Js("release",[e,n]);let r={type:"release",in:t};vn.postMessage(r)});u0(t)},sN=async(t,e,n,r,i,s)=>{if(Bi()){if(n.some(a=>a[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(i.some(a=>a))throw new Error("pre-allocated output tensor is not supported for proxy.");return Xs(),new Promise((a,o)=>{Js("run",[a,o]);let l=n,u={type:"run",in:{sessionId:t,inputIndices:e,inputs:l,outputIndices:r,options:s}};vn.postMessage(u,h0(l))})}else return c0(t,e,n,r,i,s)},aN=async t=>{if(Bi())return Xs(),new Promise((e,n)=>{Js("end-profiling",[e,n]);let r={type:"end-profiling",in:t};vn.postMessage(r)});d0(t)}}),lg,yT,lN,DB=se(()=>{Jn(),oN(),$e(),Uv(),nA(),lg=(t,e)=>{switch(t.location){case"cpu":return[t.type,t.dims,t.data,"cpu"];case"gpu-buffer":return[t.type,t.dims,{gpuBuffer:t.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[t.type,t.dims,{mlTensor:t.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${t.location} for ${e()}`)}},yT=t=>{switch(t[3]){case"cpu":return new gr(t[0],t[2],t[1]);case"gpu-buffer":{let e=t[0];if(!qv(e))throw new Error(`not supported data type: ${e} for deserializing GPU tensor`);let{gpuBuffer:n,download:r,dispose:i}=t[2];return gr.fromGpuBuffer(n,{dataType:e,dims:t[1],download:r,dispose:i})}case"ml-tensor":{let e=t[0];if(!Hv(e))throw new Error(`not supported data type: ${e} for deserializing MLTensor tensor`);let{mlTensor:n,download:r,dispose:i}=t[2];return gr.fromMLTensor(n,{dataType:e,dims:t[1],download:r,dispose:i})}default:throw new Error(`invalid data location: ${t[3]}`)}},lN=class{async fetchModelAndCopyToWasmMemory(t){return nN(await Gv(t))}async loadModel(t,e){Zr();let n;typeof t=="string"?n=await this.fetchModelAndCopyToWasmMemory(t):n=t,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await rN(n,e),Er()}async dispose(){return iN(this.sessionId)}async run(t,e,n){Zr();let r=[],i=[];Object.entries(t).forEach(f=>{let p=f[0],g=f[1],_=this.inputNames.indexOf(p);if(_===-1)throw new Error(`invalid input '${p}'`);r.push(g),i.push(_)});let s=[],a=[];Object.entries(e).forEach(f=>{let p=f[0],g=f[1],_=this.outputNames.indexOf(p);if(_===-1)throw new Error(`invalid output '${p}'`);s.push(g),a.push(_)});let o=r.map((f,p)=>lg(f,()=>`input "${this.inputNames[i[p]]}"`)),l=s.map((f,p)=>f?lg(f,()=>`output "${this.outputNames[a[p]]}"`):null),u=await sN(this.sessionId,i,o,a,l,n),h={};for(let f=0;f<u.length;f++)h[this.outputNames[a[f]]]=s[f]??yT(u[f]);return Er(),h}startProfiling(){}endProfiling(){aN(this.sessionId)}}}),uN={};ll(uN,{OnnxruntimeWebAssemblyBackend:()=>qy,initializeFlags:()=>Wy,wasmBackend:()=>cN});var Wy,qy,cN,MB=se(()=>{Jn(),oN(),DB(),Wy=()=>{(typeof it.wasm.initTimeout!="number"||it.wasm.initTimeout<0)&&(it.wasm.initTimeout=0);let t=it.wasm.simd;if(typeof t!="boolean"&&t!==void 0&&t!=="fixed"&&t!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${t}". Reset it to \`false\` and ignore SIMD feature checking.`),it.wasm.simd=!1),typeof it.wasm.proxy!="boolean"&&(it.wasm.proxy=!1),typeof it.wasm.trace!="boolean"&&(it.wasm.trace=!1),typeof it.wasm.numThreads!="number"||!Number.isInteger(it.wasm.numThreads)||it.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)it.wasm.numThreads=1;else{let e=typeof navigator>"u"?bU("node:os").cpus().length:navigator.hardwareConcurrency;it.wasm.numThreads=Math.min(4,Math.ceil((e||1)/2))}},qy=class{async init(t){Wy(),await eN(),await tN(t)}async createInferenceSessionHandler(t,e){let n=new lN;return await n.loadModel(t,e),n}},cN=new qy});Jn();Jn();Jn();var LB="1.23.2";{let t=(MB(),fc(uN)).wasmBackend;wo("webgpu",t,5),wo("webnn",t,5),wo("cpu",t,10),wo("wasm",t,10)}Object.defineProperty(it.versions,"web",{value:LB,enumerable:!0});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zB="/models/disease_prediction_model.onnx",VB=["hemoglobin","wbc","rbc","platelets","glucose","cholesterol","creatinine","tsh"],jB=[{key:"has_diabetes",label:"Diabetes",warning:"High glucose levels detected. Consult a doctor."},{key:"has_anemia",label:"Anemia",warning:"Hemoglobin levels are low. Eat iron-rich foods."},{key:"has_thyroid",label:"Thyroid Issue",warning:"TSH levels are abnormal. Thyroid checkup recommended."},{key:"has_kidney_issue",label:"Kidney Issue",warning:"Creatinine levels are high. Kidney function check advised."}];let zu=null;const UB=async()=>{try{return zu||(console.log(" Loading ML Model..."),zu=await jv.create(zB),console.log(" ML Model Loaded")),!0}catch(t){return console.error(" Failed to load ML model:",t),!1}},BB=async t=>{if(!zu&&!await UB())return null;try{const e=Float32Array.from(VB.map(u=>{const h=parseFloat(t[u]);return isNaN(h)?0:h})),r={float_input:new gr("float32",e,[1,8])},i=await zu.run(r),s=[],a=zu.outputNames;console.log("Model Outputs:",a);const o=[];let l=0;for(const u of jB){let h=!1;i[a[l]]&&i[a[l]].data[0]===1&&(h=!0),u.key==="has_diabetes"&&t.glucose>126&&(h=!0),u.key==="has_anemia"&&t.hemoglobin<11&&(h=!0),u.key==="has_thyroid"&&(t.tsh<.4||t.tsh>4)&&(h=!0),u.key==="has_kidney_issue"&&t.creatinine>1.4&&(h=!0),h&&o.push(u),l++}return o}catch(e){return console.error("Prediction Error:",e),[]}},FB=({predictions:t})=>!t||t.length===0?E.jsxs("div",{className:"prediction-card safe fade-in",children:[E.jsx("div",{className:"status-icon",children:""}),E.jsxs("div",{className:"content",children:[E.jsx("h3",{children:"Great News!"}),E.jsx("p",{children:"Our AI didn't detect any high-risk patterns in your report."})]})]}):E.jsxs("div",{className:"prediction-container fade-in",children:[E.jsx("h3",{children:"AI Health Insights "}),E.jsx("p",{className:"disclaimer",children:"Based on your blood values, we identified potential risks:"}),E.jsx("div",{className:"prediction-list",children:t.map((e,n)=>E.jsxs("div",{className:"prediction-card warning",children:[E.jsx("div",{className:"status-icon",children:""}),E.jsxs("div",{className:"content",children:[E.jsx("h4",{children:e.label}),E.jsx("p",{children:e.warning})]})]},n))}),E.jsx("div",{className:"recommendation",children:E.jsxs("p",{children:[E.jsx("strong",{children:"Recommendation:"})," Please consult a certified doctor for precise diagnosis."]})}),E.jsx("style",{children:`
                .prediction-container {
                    margin-top: 20px;
                    padding: 20px;
                    background: #fff;
                    border-radius: 16px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
                    border: 1px solid #f1f5f9;
                }
                .prediction-container h3 {
                    margin: 0 0 10px 0;
                    color: #1e293b;
                    font-size: 18px;
                }
                .disclaimer {
                    color: #64748b;
                    font-size: 13px;
                    margin-bottom: 15px;
                }
                .prediction-list {
                    display: flex;
                    flex-direction: column;
                    gap: 12px;
                }
                .prediction-card {
                    display: flex;
                    align-items: flex-start;
                    gap: 15px;
                    padding: 16px;
                    border-radius: 12px;
                }
                .prediction-card.safe {
                    background: #f0fdf4;
                    border: 1px solid #dcfce7;
                }
                .prediction-card.warning {
                    background: #fef2f2;
                    border: 1px solid #fee2e2;
                }
                .status-icon {
                    font-size: 24px;
                }
                .content h3, .content h4 {
                    margin: 0 0 5px 0;
                    color: #1e293b;
                }
                .content p {
                    margin: 0;
                    font-size: 13px;
                    color: #475569;
                    line-height: 1.4;
                }
                .recommendation {
                    margin-top: 20px;
                    padding-top: 15px;
                    border-top: 1px solid #e2e8f0;
                    font-size: 13px;
                    color: #334155;
                }
            `})]}),WB=({onBack:t,user:e,initialViewReport:n})=>{const[r,i]=ve.useState(null),[s,a]=ve.useState(null),[o,l]=ve.useState([]),[u,h]=ve.useState(!1),[f,p]=ve.useState(""),[g,_]=ve.useState("hemoglobin"),[x,$]=ve.useState(""),[w,y]=ve.useState(null),[I,R]=ve.useState(!1);ve.useEffect(()=>{const A=e&&e.email?`reports_${e.email}`:`temp_reports_${Date.now()}`,D=localStorage.getItem(A);l(D?JSON.parse(D):[]),n&&a(n)},[e,n]);const M=A=>new Promise(D=>{const z=new Image;z.src=URL.createObjectURL(A),z.onload=()=>{const O=document.createElement("canvas"),ce=O.getContext("2d");O.width=z.width,O.height=z.height,ce.drawImage(z,0,0);const de=ce.getImageData(0,0,O.width,O.height),ue=de.data,pe=50,K=259*(pe+255)/(255*(259-pe));for(let B=0;B<ue.length;B+=4){const F=(ue[B]+ue[B+1]+ue[B+2])/3;let U=K*(F-128)+128;U<0&&(U=0),U>255&&(U=255),ue[B]=U,ue[B+1]=U,ue[B+2]=U}ce.putImageData(de,0,0),O.toBlob(B=>{D(B)})}}),j=async A=>{h(!0),p("Applying Digital Lens (Enhancing Quality)...");try{const D=I?await M(A):A;p("Scanning Enhanced Image...");const{data:{text:z}}=await $C.recognize(D,"eng",{logger:K=>p(`${K.status} (${Math.round(K.progress*100)}%)`)});console.log("Raw OCR Text:",z);const O=z.split(`
`),ce={},de=K=>K.toLowerCase().replace(/[^a-z0-9.]/g,"");if(O.forEach(K=>{const B=K.toLowerCase().trim();B&&Object.keys(Vb).forEach(F=>{const G=Vb[F].find(q=>B.includes(q));if(G&&!ce[F]){const q=B.split(G);if(q.length<2)return;const Y=q.slice(1).join(" ").trim();let ae=null;const Ee=Y.match(/(\d+\.\d+)/);if(Ee)ae=parseFloat(Ee[0]);else{const Q=Y.match(/(\d+)\s+(\d{1,2})(?!\d)/);if(Q&&!Y.includes("-"))ae=parseFloat(Q[1]+"."+Q[2]),console.log(`Detected spaced decimal: "${Q[0]}"  ${ae}`);else{const be=Y.match(/(\d+)/);if(be){if(new RegExp(be[0]+"\\s*-\\s*\\d+").test(Y)){console.log(`Skipping range value: ${be[0]}`);return}ae=parseFloat(be[0])}}}if(ae!==null&&!isNaN(ae)){const Q=Mu[F];if(Q&&(ae>Q.max*5&&(ae/10>=Q.min&&ae/10<=Q.max?(console.log(`Auto-correcting ${F}: ${ae} -> ${ae/10}`),ae=ae/10):ae/100>=Q.min&&ae/100<=Q.max&&(ae=ae/100)),ae>1900&&ae<2100&&F!=="total_count"))return;ce[F]=ae}}})}),Object.keys(ce).length===0){window.confirm(`Automatic scanning failed to find exact values. 

See raw text?
`+z.substring(0,100)+"...")&&alert(`Full Text Found by AI:
`+z),h(!1);return}const ue=kC(ce);let pe=[];try{pe=await BB(ce),console.log("ML Predictions:",pe)}catch(K){console.error("ML Prediction Failed:",K)}k({date:new Date().toLocaleDateString(),values:ce,risks:ue,mlPredictions:pe})}catch(D){console.error(D),alert("Error parsing image. Please try a clearer photo.")}finally{h(!1),p("")}},C=A=>{const D=A.target.files[0];D&&(D.type.startsWith("image/")?(i(D),j(D)):alert("Please upload an Image (JPG/PNG) for OCR scanning."))},k=A=>{const D=SC(A.values,A.risks);A.mlPredictions&&(D.mlPredictions=A.mlPredictions),a(D);const z=e&&e.email?`reports_${e.email}`:`temp_reports_${Date.now()}`,O=JSON.parse(localStorage.getItem(z)||"[]"),ce=[D,...O];l(ce),localStorage.setItem(z,JSON.stringify(ce))},P=A=>{var ce,de;if(A.preventDefault(),!x)return;const D=parseFloat(x),z=Mu[g];let O="Normal";D<z.min&&(O="Low"),D>z.max&&(O="High"),y({parameter:g,value:D,unit:z.unit,range:`${z.min}-${z.max}`,status:O,foods:z.foods,fitnessImpact:O==="Low"?(ce=z.impact)==null?void 0:ce.low:O==="High"?(de=z.impact)==null?void 0:de.high:null})};return E.jsxs("div",{className:"blood-container fade-in",children:[E.jsxs("div",{className:"header-row",children:[E.jsx("button",{onClick:t,className:"back-btn",children:E.jsx(Si,{size:24})}),E.jsx("h2",{children:"Blood Evaluation"})]}),s?E.jsxs("div",{className:"results-section fade-in",children:[E.jsxs("div",{className:"results-header",children:[E.jsx("h3",{children:"Report Analysis"}),E.jsx("button",{className:"text-btn",onClick:()=>a(null),children:"Close"})]}),s.mlPredictions&&E.jsx(FB,{predictions:s.mlPredictions}),s.risks&&s.risks.length>0&&E.jsxs("div",{className:"risk-container fade-up",children:[E.jsx("h4",{children:" AI Health Risk Detection"}),E.jsx("div",{className:"risk-grid",children:s.risks.map((A,D)=>E.jsxs("div",{className:"risk-card",style:{borderLeft:`4px solid ${A.color}`},children:[E.jsxs("div",{className:"risk-header",children:[E.jsx("span",{className:"condition-title",children:A.condition}),E.jsx("span",{className:"risk-badge",style:{background:A.color},children:A.risk})]}),E.jsx("p",{className:"risk-advice",children:A.advice}),E.jsx("button",{className:"view-details",onClick:()=>alert(`Detailed explanation for ${A.condition}: 

This condition was flagged based on your values. Please consult a doctor for verification.`),children:"View Details"})]},D))})]}),E.jsx("div",{className:"params-list",children:s.results.map((A,D)=>E.jsxs("div",{className:"param-card",children:[E.jsxs("div",{className:"param-header",children:[E.jsx("h4",{children:A.parameter.replace(/_/g," ").toUpperCase()}),E.jsxs("span",{className:`status-badge ${A.status.toLowerCase()}`,children:[A.status==="Normal"&&E.jsx(Z6,{size:14}),A.status==="High"&&E.jsx(K6,{size:14}),A.status==="Low"&&E.jsx(_C,{size:14}),A.status]})]}),E.jsxs("div",{className:"param-value",children:[E.jsx("span",{className:"val",children:A.value}),E.jsx("span",{className:"unit",children:A.unit})]}),E.jsxs("p",{className:"range-info",children:["Ref Range: ",A.range]})]},D))}),s.suggestions.length>0&&E.jsxs("div",{className:"suggestions-box",children:[E.jsx("h3",{children:" Health & Fitness Recommendations"}),s.suggestions.map((A,D)=>E.jsxs("div",{className:"suggestion-item",children:[E.jsx("div",{className:"suggestion-header",children:E.jsxs("strong",{children:[A.status," ",A.parameter.replace(/_/g," ").toUpperCase()]})}),A.foods.length>0&&E.jsxs("p",{className:"food-list",children:[" ",E.jsx("b",{children:"Diety Tip:"})," Eat ",A.foods.join(", ")]}),A.fitnessImpact&&E.jsxs("p",{className:"fitness-list",children:[" ",E.jsx("b",{children:"Fitness Impact:"})," ",A.fitnessImpact]})]},D))]})]}):E.jsxs("div",{className:"main-content",children:[E.jsxs("div",{className:"card manual-card",children:[E.jsx("h3",{children:"Quick Check"}),E.jsx("p",{className:"sub-label",children:"Enter a single value to check results instantly."}),E.jsxs("form",{onSubmit:P,className:"manual-form",children:[E.jsxs("div",{className:"row",children:[E.jsx("select",{className:"input-field",value:g,onChange:A=>{_(A.target.value),y(null)},children:Object.keys(Mu).map(A=>E.jsx("option",{value:A,children:A.replace(/_/g," ").toUpperCase()},A))}),E.jsx("input",{type:"number",step:"0.1",className:"input-field",placeholder:"Value",value:x,onChange:A=>$(A.target.value),required:!0})]}),E.jsxs("button",{type:"submit",className:"btn-primary small-btn",children:["Check ",E.jsx(o5,{size:16})]})]}),w&&E.jsxs("div",{className:"manual-result fade-in",children:[E.jsx("div",{className:`result-badge ${w.status.toLowerCase()}`,children:w.status}),E.jsxs("p",{className:"result-text",children:[E.jsxs("strong",{children:[w.parameter.replace(/_/g," ").toUpperCase(),":"]})," ",w.value," ",w.unit,E.jsx("br",{}),E.jsxs("span",{className:"text-muted",children:["Normal: ",w.range]})]}),w.status!=="Normal"&&w.foods.length>0&&E.jsxs("div",{className:"diet-tip",children:[E.jsx("strong",{children:"Tip:"})," Eat ",w.foods.join(", ")]}),w.fitnessImpact&&E.jsxs("div",{className:"fitness-tip",children:[E.jsx("strong",{children:"Fitness Impact:"})," ",w.fitnessImpact]})]})]}),E.jsx("div",{className:"divider",children:"OR"}),E.jsxs("div",{className:"upload-card",children:[E.jsx("div",{className:"icon-circle",children:E.jsx(wC,{size:32,color:"var(--color-primary)"})}),E.jsx("h3",{children:"Upload Report Image"}),E.jsx("p",{children:"Take a clear photo of your report. AI will scan for values."}),E.jsx("div",{style:{marginBottom:"15px"},children:E.jsxs("label",{className:"checkbox-container",children:[E.jsx("input",{type:"checkbox",checked:I,onChange:A=>R(A.target.checked)}),E.jsx("span",{className:"checkmark"}),"Enable Digital Lens (Enhance Image)"]})}),E.jsxs("label",{className:"btn-secondary upload-btn",children:[u?f||"Scanning...":"Select Image (JPG/PNG)",E.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:C,disabled:u})]})]}),o.length>0&&E.jsxs("div",{className:"history-section",children:[E.jsx("h3",{children:"Recent Reports"}),o.map((A,D)=>E.jsxs("div",{className:"history-item",onClick:()=>a(A),children:[E.jsx(Dv,{size:18,className:"text-muted"}),E.jsx("span",{children:A.date}),E.jsx("span",{className:"arrow",children:""})]},D))]})]}),E.jsx("style",{children:`
        .blood-container {
           padding: var(--spacing-md);
        }
        /* ... Existing Styles ... */
        /* Risk Styles */
        .risk-container {
            background: #fffafa; border: 1px solid #fee2e2; padding: 15px; border-radius: 12px; margin-bottom: 20px;
        }
        .risk-container h4 { color: #b91c1c; margin-top: 0; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        .risk-grid { display: flex; flex-direction: column; gap: 10px; }
        .risk-card { background: white; padding: 12px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .risk-header { display: flex; justify-content: space-between; margin-bottom: 5px; align-items: center; }
        .condition-title { font-weight: 700; color: #1f2937; }
        .risk-badge { font-size: 10px; color: white; padding: 2px 8px; border-radius: 99px; font-weight: 700; text-transform: uppercase; }
        .risk-advice { font-size: 13px; color: #4b5563; margin: 0; line-height: 1.4; }
        .view-details { margin-top: 8px; font-size: 11px; background: white; border: 1px solid #e5e7eb; padding: 4px 10px; border-radius: 4px; cursor: pointer; }
        
        .header-row {
           display: flex;
           align-items: center;
           gap: var(--spacing-md);
           margin-bottom: var(--spacing-lg);
        }
        .back-btn, .text-btn {
           background: transparent;
           color: var(--color-text-main);
           padding: 0;
           font-weight: 600;
        }

        .card {
           background: white;
           padding: var(--spacing-md);
           border-radius: var(--radius-md);
           box-shadow: var(--shadow-sm);
           margin-bottom: var(--spacing-lg);
        }

        /* Manual Entry */
        .manual-card h3 { font-size: var(--font-size-base); margin-bottom: 5px; }
        .sub-label { font-size: 12px; color: var(--color-text-secondary); margin-bottom: 15px; }
        .manual-form {
           display: flex;
           flex-direction: column;
           gap: 10px;
        }
        .manual-form .row { display: flex; gap: 10px; }
        .manual-form .input-field { 
            padding: 10px; 
            border: 1px solid #e2e8f0; 
            border-radius: var(--radius-sm); 
            flex: 1;
            font-size: 14px;
        }
        .small-btn { padding: 10px; width: 100%; display: flex; justify-content: center; gap: 8px; }

        .manual-result {
            margin-top: 15px;
            padding: 10px;
            background: #f8fafc;
            border-radius: var(--radius-sm);
            border-left: 3px solid var(--color-text-muted);
        }
        .result-badge {
            display: inline-block;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 99px;
            margin-bottom: 5px;
            text-transform: uppercase;
        }
        .result-badge.normal { background: #dcfce7; color: #166534; border-color: #166534; }
        .result-badge.high { background: #fee2e2; color: #991b1b; }
        .result-badge.low { background: #fef9c3; color: #854d0e; }
        
        .diet-tip { margin-top: 8px; font-size: 12px; color: #155724; background: #d4edda; padding: 5px; border-radius: 4px; }

        .divider { text-align: center; color: var(--color-text-muted); font-size: 12px; margin: 20px 0; font-weight: bold; }

        .upload-card {
           text-align: center;
           padding: 20px;
           background: #F8F9FA;
           border: 1px dashed #cbd5e1;
           border-radius: var(--radius-lg);
        }
        .icon-circle {
           width: 60px; height: 60px;
           background: #eef2ff;
           border-radius: 50%;
           display: flex; align-items: center; justify-content: center;
           margin: 0 auto 15px;
        }
        .upload-btn {
           display: inline-block;
           margin-top: 15px;
           font-size: 14px;
           padding: 8px 16px;
           background: white; border: 1px solid #e2e8f0; border-radius: 99px;
        }

        .results-header {
           display: flex; justify-content: space-between; align-items: center;
           margin-bottom: 20px;
        }
        .params-list { display: grid; gap: 10px; }
        .param-card {
           background: white; padding: 15px; border-radius: var(--radius-md); box-shadow: var(--shadow-sm);
        }
        .param-header { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .status-badge { font-size: 10px; padding: 2px 8px; border-radius: 99px; font-weight: bold; float: right; }
        .status-badge.normal { background: #dcfce7; color: #166534; }
        .status-badge.high { background: #fee2e2; color: #991b1b; }
        .status-badge.low { background: #fef9c3; color: #854d0e; }

        .param-value .val { font-size: 18px; font-weight: bold; margin-right: 5px; }
        .param-value .unit { font-size: 12px; color: #64748b; }
        .range-info { font-size: 10px; color: #94a3b8; margin-top: 2px; }

        .suggestions-box { margin-top: 20px; background: #fffbeb; padding: 15px; border-radius: var(--radius-md); border-left: 4px solid #f59e0b; }
        .suggestions-box h3 { font-size: 14px; margin-bottom: 12px; color: #92400e; display: flex; align-items: center; gap: 8px; }
        .suggestion-item { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #fef3c7; }
        .suggestion-item:last-child { border-bottom: none; }
        .suggestion-header { margin-bottom: 6px; color: #92400e; }
        .food-list, .fitness-list { font-size: 11px; margin-top: 4px; line-height: 1.4; color: #78350f; }
        .fitness-list { font-style: italic; color: #b45309; }
        .fitness-tip { margin-top: 8px; font-size: 11px; color: #b45309; background: #fffbeb; padding: 8px; border-radius: 4px; border: 1px dashed #f59e0b; }

        .scan-mode-toggle {
            display: flex; justify-content: center; gap: 10px; margin: 15px 0;
        }
        .mode-btn {
            padding: 6px 12px;
            font-size: 12px;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 99px;
            cursor: pointer;
            position: relative;
        }
        .mode-btn.active {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }
        .dot {
            width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-left: 5px;
        }
        .dot.online { background: #22c55e; }
        .dot.offline { background: #ef4444; }
      `})]})},Xd={breakfast:[{name:"Puttu & Kadala Curry",cal:450},{name:"Appam & Egg Roast",cal:400},{name:"Idli & Sambar",cal:300},{name:"Dosa & Chutney",cal:350},{name:"Oats Upma",cal:250}],lunch:[{name:"Kerala Rice Meals with Fish Curry",cal:650},{name:"Red Rice, Thoran & Curd",cal:500},{name:"Biriyani (Chicken)",cal:800},{name:"Kanji & Payar",cal:400}],snack:[{name:"Banana Fry (Pazham Pori) - 2 pcs",cal:300},{name:"Tea & Vada",cal:250},{name:"Fruit Salad",cal:150},{name:"Nuts & Dates",cal:200}],dinner:[{name:"Chapati & Veg Curry",cal:400},{name:"Wheat Porotta & Chicken",cal:600},{name:"Kanji (Rice Gruel)",cal:300},{name:"Salad & Grilled Fish",cal:350}]},qB=({userProfile:t,onBack:e})=>{const[n,r]=ve.useState(null),[i,s]=ve.useState(0),[a,o]=ve.useState(null);ve.useEffect(()=>{n&&t&&u()},[n]);const l=()=>{if(!t)return 2e3;const{weight:h,heightCm:f,age:p,gender:g}=t;let _=10*h+6.25*f-5*p;g==="male"?_+=5:_-=161;let x=Math.round(_*1.375);return n==="loss"?x-500:n==="gain"?x+500:x},u=()=>{const h=l();s(h);const f=p=>p[Math.floor(Math.random()*p.length)];o({breakfast:f(Xd.breakfast),lunch:f(Xd.lunch),snack:f(Xd.snack),dinner:f(Xd.dinner)})};return E.jsxs("div",{className:"fitness-container fade-in",children:[E.jsxs("div",{className:"header-row",children:[E.jsx("button",{onClick:e,className:"back-btn",children:E.jsx(Si,{size:24})}),E.jsx("h2",{children:"Fitness Helper"})]}),n?E.jsxs("div",{className:"plan-view fade-in",children:[E.jsxs("div",{className:"summary-card",children:[E.jsxs("div",{className:"cal-target",children:[E.jsx("span",{className:"label",children:"Daily Target"}),E.jsx("h1",{children:i}),E.jsx("span",{className:"unit",children:"kcal"})]}),E.jsx("div",{className:"goal-badge",children:n==="loss"?"Weight Loss":n==="gain"?"Weight Gain":"Maintain"}),E.jsx("button",{className:"change-btn",onClick:()=>r(null),children:"Change Goal"})]}),E.jsxs("div",{className:"meals-list",children:[E.jsx("h3",{children:" Today's Kerala Diet Plan"}),a&&E.jsxs(E.Fragment,{children:[E.jsx(Zd,{type:"Breakfast",icon:E.jsx(Nb,{size:18}),data:a.breakfast}),E.jsx(Zd,{type:"Lunch",icon:E.jsx(Du,{size:18}),data:a.lunch}),E.jsx(Zd,{type:"Snack",icon:E.jsx(Nb,{size:18}),data:a.snack}),E.jsx(Zd,{type:"Dinner",icon:E.jsx(Du,{size:18}),data:a.dinner})]})]})]}):E.jsxs("div",{className:"goal-selection",children:[E.jsx("h3",{children:"What is your goal?"}),E.jsxs("button",{className:"goal-card",onClick:()=>r("loss"),children:[E.jsx("div",{className:"icon-box loss",children:E.jsx(u5,{size:24})}),E.jsxs("div",{className:"text",children:[E.jsx("h4",{children:"Weight Loss"}),E.jsx("p",{children:"Reduce body fat locally."})]})]}),E.jsxs("button",{className:"goal-card",onClick:()=>r("maintain"),children:[E.jsx("div",{className:"icon-box maintain",children:E.jsx(m5,{size:24})}),E.jsxs("div",{className:"text",children:[E.jsx("h4",{children:"Maintain Weight"}),E.jsx("p",{children:"Stay healthy and fit."})]})]}),E.jsxs("button",{className:"goal-card",onClick:()=>r("gain"),children:[E.jsx("div",{className:"icon-box gain",children:E.jsx(Du,{size:24})}),E.jsxs("div",{className:"text",children:[E.jsx("h4",{children:"Weight Gain"}),E.jsx("p",{children:"Build muscle mass."})]})]})]}),E.jsx("style",{children:`
        .fitness-container {
           padding: var(--spacing-md);
        }
        .header-row {
           display: flex;
           align-items: center;
           gap: var(--spacing-md);
           margin-bottom: var(--spacing-xl);
        }
        .back-btn {
           background: transparent;
           color: var(--color-text-main);
           padding: 0;
        }
        .goal-selection {
           display: flex;
           flex-direction: column;
           gap: var(--spacing-md);
        }
        .goal-selection h3 {
           text-align: center;
           margin-bottom: var(--spacing-md);
        }
        .goal-card {
           display: flex;
           align-items: center;
           gap: var(--spacing-md);
           background: white;
           padding: var(--spacing-md);
           border-radius: var(--radius-lg);
           box-shadow: var(--shadow-sm);
           text-align: left;
           width: 100%;
           transition: transform 0.2s;
        }
        .goal-card:active { transform: scale(0.98); }
        .icon-box {
           width: 50px;
           height: 50px;
           border-radius: var(--radius-md);
           display: flex;
           align-items: center;
           justify-content: center;
           color: white;
        }
        .icon-box.loss { background: #FF6B6B; }
        .icon-box.maintain { background: #4CC9F0; }
        .icon-box.gain { background: #4ECDC4; }
        
        .summary-card {
           background: linear-gradient(135deg, #1D3557 0%, #457B9D 100%);
           color: white;
           padding: var(--spacing-lg);
           border-radius: var(--radius-lg);
           text-align: center;
           margin-bottom: var(--spacing-xl);
           box-shadow: var(--shadow-md);
           position: relative;
        }
        .cal-target h1 {
           font-size: 3rem;
           line-height: 1;
           margin: 10px 0;
        }
        .change-btn {
           position: absolute;
           top: 10px;
           right: 10px;
           background: rgba(255,255,255,0.2);
           color: white;
           font-size: 10px;
           padding: 4px 8px;
           border-radius: var(--radius-full);
        }

        .meals-list h3 {
           margin-bottom: var(--spacing-md);
        }
        .meal-card {
           background: white;
           padding: var(--spacing-md);
           border-radius: var(--radius-md);
           margin-bottom: var(--spacing-sm);
           box-shadow: var(--shadow-sm);
           display: flex;
           justify-content: space-between;
           align-items: center;
        }
        .meal-info h4 {
           font-size: var(--font-size-sm);
           color: var(--color-text-secondary);
           margin-bottom: 2px;
           display: flex;
           align-items: center;
           gap: 6px;
        }
        .meal-info p {
           font-weight: 600;
           color: var(--color-text-main);
        }
        .meal-cal {
           font-size: var(--font-size-sm);
           color: var(--color-primary);
           font-weight: bold;
        }
      `})]})},Zd=({type:t,icon:e,data:n})=>E.jsxs("div",{className:"meal-card",children:[E.jsxs("div",{className:"meal-info",children:[E.jsxs("h4",{children:[e," ",t]}),E.jsx("p",{children:n.name})]}),E.jsxs("div",{className:"meal-cal",children:[n.cal," kcal"]})]}),HB=[{id:1,name:"Jumping Jacks",calories:"10-15 cal/min",duration:"1 min",desc:"Full body cardio warm-up.",steps:["Stand with feet together, hands at sides.","Jump legs apart and raise arms overhead.","Jump back to starting position.","Repeat quickly."]},{id:2,name:"Push-ups",calories:"0.3-0.6 cal/rep",duration:"15-20 reps",desc:"Strengthens chest, shoulders, and triceps.",steps:["Start in plank position.","Lower chest to floor.","Push back up strongly.","Keep core tight."]},{id:3,name:"Plank",calories:"3-4 cal/min",duration:"30-45 sec",desc:"Core stability and abdominal strength.",steps:["Rest on forearms and toes.","Keep body in straight line.","Hold selection tight.","Breathe normally."]},{id:4,name:"Squats",calories:"0.3-0.5 cal/rep",duration:"20 reps",desc:"Legs and glutes builder.",steps:["Stand feet shoulder-width apart.","Lower hips like sitting in a chair.","Keep chest up.","Return to standing."]},{id:5,name:"Lunges",calories:"0.5 cal/rep",duration:"15 reps/leg",desc:"Balance and leg strength.",steps:["Step forward with one leg.","Lower hips until both knees are 90.","Push back to start.","Switch legs."]},{id:6,name:"Burpees",calories:"10-15 cal/min",duration:"10-15 reps",desc:"High intensity full body calorie burner.",steps:["Squat down.","Kick feet back to plank.","Do a push-up.","Jump feet forward and jump up."]},{id:7,name:"High Knees",calories:"7-9 cal/min",duration:"1 min",desc:"Cardio and core engagement.",steps:["Run in place.","Lift knees as high as possible.","Pump arms.","Keep a fast pace."]},{id:8,name:"Mountain Climbers",calories:"8-10 cal/min",duration:"45 sec",desc:"Cardio, core, and arm endurance.",steps:["Start in plank.","Drive one knee to chest.","Switch legs quickly.","Keep hips down."]}],GB=({onBack:t})=>{const[e,n]=ve.useState(null);return E.jsxs("div",{className:"workout-container fade-in",children:[E.jsxs("div",{className:"header-row",children:[E.jsx("button",{onClick:t,className:"back-btn",children:E.jsx(Si,{size:24})}),E.jsx("h2",{children:"Home Workouts"})]}),E.jsxs("div",{className:"info-card",children:[E.jsx("div",{className:"intro-icon",children:E.jsx(Pb,{size:28,color:"#FF6B6B"})}),E.jsx("p",{children:"Burn calories with these 8 basic home exercises. No equipment needed!"})]}),E.jsx("div",{className:"workout-list",children:HB.map(r=>E.jsxs("div",{className:"workout-card",children:[E.jsxs("div",{className:"w-header",children:[E.jsx("h3",{children:r.name}),E.jsxs("span",{className:"cal-badge",children:[E.jsx(Pb,{size:12,fill:"currentColor"})," ",r.calories]})]}),E.jsx("p",{className:"w-desc",children:r.desc}),E.jsxs("div",{className:"w-footer",children:[E.jsxs("span",{className:"duration",children:[E.jsx(c5,{size:14})," ",r.duration]}),E.jsx("button",{className:"start-btn",onClick:()=>n(r),children:"Steps"})]})]},r.id))}),e&&E.jsx("div",{className:"modal-overlay fade-in",onClick:()=>n(null),children:E.jsxs("div",{className:"modal-content",onClick:r=>r.stopPropagation(),children:[E.jsx("button",{className:"close-btn",onClick:()=>n(null),children:E.jsx(p5,{size:24})}),E.jsxs("div",{className:"modal-header",children:[E.jsx("h3",{children:e.name}),E.jsx("span",{className:"cal-pill",children:e.calories})]}),(()=>{const i={"Jumping Jacks":"iSSAk4XCsRA",Squats:"YaXPRqUwItQ","Push-ups":"IODxDxX7oi4",Burpees:"dZgVxmf6jkA","High Knees":"oDdkytliOqE",Lunges:"QOVaHwm-Q6U",Plank:"pSHjTRCQxIw","Mountain Climbers":"zT-9L3CEcmk"}[e.name]||"UpH7rm0cYbM";return E.jsx("div",{style:{width:"100%",height:"220px",marginBottom:"20px",borderRadius:"12px",overflow:"hidden",background:"#000"},children:E.jsx("iframe",{width:"100%",height:"100%",src:`https://www.youtube.com/embed/${i}?autoplay=1&mute=1&loop=1&playlist=${i}&controls=0&showinfo=0&modestbranding=1`,title:"Workout Demonstration",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,style:{display:"block"}})})})(),E.jsxs("div",{className:"modal-body",children:[E.jsxs("h4",{children:[E.jsx(vC,{size:16})," How to do it:"]}),E.jsx("ul",{className:"steps-list",children:e.steps.map((r,i)=>E.jsxs("li",{children:[E.jsx("span",{className:"step-num",children:i+1}),r]},i))})]})]})}),E.jsx("style",{children:`
                .workout-container {
                    padding: var(--spacing-md);
                    padding-bottom: 40px;
                }
                .header-row {
                   display: flex;
                   align-items: center;
                   gap: var(--spacing-md);
                   margin-bottom: var(--spacing-lg);
                }
                .back-btn {
                   background: transparent;
                   color: var(--color-text-main);
                   padding: 0;
                }
                
                .info-card {
                    background: #FFF0F1;
                    padding: 15px;
                    border-radius: var(--radius-md);
                    margin-bottom: 20px;
                    display: flex;
                    align-items: center;
                    gap: 15px;
                    color: var(--color-text-main);
                    border: 1px solid #FFD1D1;
                }
                .intro-icon {
                    background: white;
                    padding: 10px;
                    border-radius: 50%;
                    box-shadow: var(--shadow-sm);
                }

                .workout-list {
                    display: flex;
                    flex-direction: column;
                    gap: 15px;
                }

                .workout-card {
                    background: white;
                    padding: 15px;
                    border-radius: var(--radius-md);
                    box-shadow: var(--shadow-sm);
                    transition: transform 0.2s;
                    border: 1px solid #f1f5f9;
                }
                .workout-card:hover {
                    transform: translateY(-2px);
                    box-shadow: var(--shadow-md);
                }

                .w-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 8px;
                }
                .w-header h3 {
                    font-size: 16px;
                    color: var(--color-text-main);
                }
                .cal-badge {
                    font-size: 11px;
                    background: #ffe4e6;
                    color: #be123c;
                    padding: 4px 8px;
                    border-radius: 99px;
                    display: flex;
                    align-items: center;
                    gap: 4px;
                    font-weight: 600;
                }

                .w-desc {
                    font-size: 12px;
                    color: var(--color-text-secondary);
                    margin-bottom: 15px;
                }

                .w-footer {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding-top: 10px;
                    border-top: 1px solid #f1f5f9;
                }
                .start-now-btn {
                    background: var(--color-primary);
                    color: white;
                    padding: 10px 20px;
                    border-radius: 99px;
                    font-weight: 600;
                    box-shadow: var(--shadow-md);
                }

                .modal-body h4 { display: flex; align-items: center; gap: 8px; font-size: 14px; margin-bottom: 10px; margin-top: 15px; color: var(--color-text-main); }
                .steps-list { list-style: none; padding: 0; }
                .steps-list li {
                    display: flex; gap: 10px;
                    font-size: 14px; color: var(--color-text-secondary);
                    margin-bottom: 12px;
                    line-height: 1.4;
                }
                .step-num {
                    background: #eef2ff; color: var(--color-primary);
                    font-weight: bold; font-size: 12px;
                    width: 20px; height: 20px;
                    border-radius: 50%;
                    display: flex; align-items: center; justify-content: center;
                    flex-shrink: 0;
                }
            `})]})},KB=({onBack:t,userProfile:e})=>{const[n,r]=ve.useState(()=>{if(!(e!=null&&e.email))return[];const f=localStorage.getItem(`weight_log_${e.email}`);return f?JSON.parse(f):[]}),[i,s]=ve.useState(""),a=()=>{if(!i||isNaN(i))return;const f={weight:parseFloat(i),date:new Date().toISOString(),displayDate:new Date().toLocaleDateString()},p=[...n,f];r(p),e!=null&&e.email&&localStorage.setItem(`weight_log_${e.email}`,JSON.stringify(p)),s("")},l=(()=>{if(n.length<2)return{change:0,type:"neutral"};const f=n[n.length-1].weight,p=n[n.length-2].weight,g=f-p;return{change:Math.abs(g).toFixed(1),type:g>0?"gain":g<0?"loss":"neutral"}})(),u=(e==null?void 0:e.weight)||(n.length>0?n[0].weight:0),h=n.length>0?n[n.length-1].weight:u;return E.jsxs("div",{className:"weight-container fade-in",children:[E.jsxs("div",{className:"header-row",children:[E.jsx("button",{onClick:t,className:"back-btn",children:E.jsx(Si,{size:24})}),E.jsx("h2",{children:"Weight Progress"})]}),E.jsxs("div",{className:"stats-card",children:[E.jsxs("div",{className:"stat-item",children:[E.jsx("span",{className:"label",children:"Starting Weight"}),E.jsxs("span",{className:"value",children:[u," kg"]})]}),E.jsx("div",{className:"divider"}),E.jsxs("div",{className:"stat-item",children:[E.jsx("span",{className:"label",children:"Current Weight"}),E.jsxs("span",{className:"value primary",children:[h," kg"]})]}),E.jsx("div",{className:"divider"}),E.jsxs("div",{className:"stat-item",children:[E.jsx("span",{className:"label",children:"Change"}),E.jsxs("span",{className:`value ${l.type}`,children:[l.type==="gain"&&E.jsx(f5,{size:16}),l.type==="loss"&&E.jsx(h5,{size:16}),l.type==="neutral"&&E.jsx(i5,{size:16}),l.change," kg"]})]})]}),E.jsxs("div",{className:"input-section",children:[E.jsx("h3",{children:"Log Current Weight"}),E.jsxs("div",{className:"input-group",children:[E.jsx("input",{type:"number",placeholder:"Enter weight in kg",value:i,onChange:f=>s(f.target.value),step:"0.1"}),E.jsx("button",{className:"add-btn",onClick:a,children:"Add"})]})]}),E.jsxs("div",{className:"history-section",children:[E.jsx("h3",{children:"Weight History"}),n.length===0?E.jsxs("div",{className:"empty-state",children:[E.jsx(yC,{size:40,color:"#cbd5e1"}),E.jsx("p",{children:"No entries yet. Start logging your weight!"})]}):E.jsx("div",{className:"history-list",children:[...n].reverse().map((f,p)=>E.jsxs("div",{className:"history-item",children:[E.jsxs("div",{className:"date-badge",children:[E.jsx(X6,{size:14}),f.displayDate]}),E.jsxs("div",{className:"weight-display",children:[f.weight," kg"]})]},p))})]}),E.jsx("style",{children:`
                .weight-container {
                    padding: var(--spacing-md);
                    padding-bottom: 40px;
                }
                .header-row {
                   display: flex;
                   align-items: center;
                   gap: var(--spacing-md);
                   margin-bottom: 20px;
                }
                .back-btn { background: transparent; color: var(--color-text-main); padding: 0; }
                
                .stats-card {
                    background: white;
                    padding: 20px;
                    border-radius: var(--radius-lg);
                    box-shadow: var(--shadow-md);
                    display: flex;
                    justify-content: space-around;
                    margin-bottom: 25px;
                }
                .stat-item {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 5px;
                }
                .label {
                    font-size: 11px;
                    color: var(--color-text-muted);
                    text-transform: uppercase;
                }
                .value {
                    font-size: 18px;
                    font-weight: bold;
                    color: var(--color-text-main);
                    display: flex;
                    align-items: center;
                    gap: 4px;
                }
                .value.primary { color: var(--color-primary); }
                .value.gain { color: #f59e0b; }
                .value.loss { color: #10b981; }
                .value.neutral { color: #64748b; }
                .divider {
                    width: 1px;
                    background: #e2e8f0;
                    align-self: stretch;
                }

                .input-section {
                    background: white;
                    padding: 20px;
                    border-radius: var(--radius-lg);
                    box-shadow: var(--shadow-sm);
                    margin-bottom: 25px;
                }
                .input-section h3 {
                    font-size: 14px;
                    margin-bottom: 15px;
                    color: var(--color-text-main);
                }
                .input-group {
                    display: flex;
                    gap: 10px;
                }
                .input-group input {
                    flex: 1;
                    padding: 12px;
                    border: 1px solid #e2e8f0;
                    border-radius: var(--radius-md);
                    font-size: 14px;
                }
                .add-btn {
                    background: var(--color-primary);
                    color: white;
                    padding: 12px 24px;
                    border-radius: var(--radius-md);
                    font-weight: 600;
                    box-shadow: var(--shadow-sm);
                }

                .history-section h3 {
                    font-size: 14px;
                    margin-bottom: 15px;
                    color: var(--color-text-main);
                }
                .empty-state {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 10px;
                    padding: 40px 20px;
                    color: var(--color-text-muted);
                    font-size: 13px;
                }
                .history-list {
                    display: flex;
                    flex-direction: column;
                    gap: 10px;
                }
                .history-item {
                    background: white;
                    padding: 15px;
                    border-radius: var(--radius-md);
                    box-shadow: var(--shadow-sm);
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                .date-badge {
                    display: flex;
                    align-items: center;
                    gap: 5px;
                    font-size: 12px;
                    color: var(--color-text-secondary);
                }
                .weight-display {
                    font-size: 16px;
                    font-weight: bold;
                    color: var(--color-primary);
                }
            `})]})},QB=[{q:"Best protein sources?",a:"Top protein sources: Eggs, Chicken Breast, Fish, Paneer, Lentils (Dal), Soy chunks, and Greek Yogurt."},{q:"Pre-workout snacks?",a:"Eat 30-60 mins before: Banana, Oats, Peanut butter toast, or a handful of Almonds."},{q:"How to build muscle?",a:"Focus on: 1. Resistance training (lifting weights), 2. High protein intake (1.6g per kg weight), 3. Progressive overload, 4. 7-8 hours sleep."},{q:"Weight loss tips?",a:"To lose weight: Maintain a calorie deficit, increase fiber intake, stay hydrated, and include consistent Zone 2 cardio."}],_T=["blood","report","diet","food","fitness","exercise","weight","bmi","sugar","cholesterol","protein","health","heart","hemoglobin","fat","muscle","gym","workout","yoga","sleep","water","cardio","calories","supplement","recovery","strength"],YB=({onBack:t,userProfile:e})=>{const[n,r]=ve.useState([{id:1,text:`Hello ${e!=null&&e.name?e.name.split(" ")[0]:""}! I'm your Health Assistant. Ask me about your blood report, diet, or workout.`,sender:"bot"}]),[i,s]=ve.useState(""),[a,o]=ve.useState(!1),l=ve.useRef(null),u=()=>{var x;(x=l.current)==null||x.scrollIntoView({behavior:"smooth"})},[h,f]=ve.useState([]);ve.useEffect(()=>{if(e!=null&&e.email){const x=JSON.parse(localStorage.getItem(`reports_${e.email}`)||"[]");f(x)}u()},[n,e==null?void 0:e.email]);const p=x=>{const $=x.toLowerCase();if($.includes("analyze")||$.includes("summary")||$.includes("my report")){if(h.length===0)return"I don't see any blood reports uploaded yet. specific values. You can upload one in the Blood Evaluation section!";const P=h[0],A=P.results.filter(z=>z.status!=="Normal");if(A.length===0)return"Your latest report looks perfect! All values are within the normal range. Keep it up! ";const D=A.map(z=>`${z.parameter} is ${z.status} (${z.value} ${z.unit})`).join(", ");return`Based on your latest report (${P.date}), here are some things to watch: ${D}. Would you like diet tips for any of these?`}const w=_T.find(P=>$.includes(P));if(w&&h.length>0){const A=h[0].results.find(D=>D.parameter.toLowerCase().includes(w));if(A)return`Your latest ${A.parameter} is ${A.value} ${A.unit}, which is ${A.status}. ${A.fitnessImpact||""}`}const y=e!=null&&e.diseases?e.diseases.toLowerCase():"",I=e!=null&&e.allergies?e.allergies.toLowerCase():"",R=(e==null?void 0:e.age)||"",M=(e==null?void 0:e.weight)||"",j=(e==null?void 0:e.bloodGroup)||"",C=(e==null?void 0:e.gender)||"";return!_T.some(P=>$.includes(P))&&!$.includes("hello")&&!$.includes("hi")?`I'm analyzing your health data... I can help with Blood Reports, Diet, and Fitness. Try asking "Analyze my report" or "How is my hemoglobin?".`:$.includes("my profile")||$.includes("my health")||$.includes("about me")?`You are a ${R}-year-old ${C} with Blood Group ${j}. Current weight: ${M}kg. Known conditions: ${y||"None"}. Allergies: ${I||"None"}.`:y.includes("diabetes")&&($.includes("sugar")||$.includes("sweet")||$.includes("fruit"))?"Since you mentioned Diabetes, be very careful with high GI fruits like mangoes and chikoo. Opt for apples, berries, and papaya. Monitor your blood sugar regularly and avoid refined sugars completely.":(y.includes("hypertension")||y.includes("bp"))&&($.includes("salt")||$.includes("diet"))?"For hypertension management, the DASH diet is recommended. Reduce sodium intake (salt), avoid pickles and papad, and increase potassium-rich foods like bananas and leafy greens.":$.includes("protein")?"Protein is the building block. vegetarians: Paneer, Dal, Soy. Non-veg: Chicken, Fish. "+(y.includes("kidney")?"However, since you have kidney concerns, please consult your doctor for the exact protein limit.":"Aim for 1.2g/kg body weight."):$.includes("pre-workout")||$.includes("before gym")?"A banana or oatmeal 45 mins before workout is great energy.":$.includes("post-workout")||$.includes("after gym")?"Post-workout, have a protein source (shake/chicken/eggs) within 45 mins to maximize recovery.":$.includes("muscle")?"Building muscle requires specific resistance training, protein surplus, and sleep. Consistency is key!":$.includes("cardio")?"Cardio improves heart health and burns calories. 150 mins/week is a good target.":$.includes("bmi")?"BMI is a rough indicator. "+(e!=null&&e.weight?`At ${e.weight}kg, your focus should be on body composition (muscle vs fat) rather than just the scale.`:"Check your weight-to-height ratio."):$.includes("diet")||$.includes("food")?I?`Given your allergies to ${I}, ensure you check food labels. Focus on whole, unprocessed foods.`:"A balanced diet with protein, good fats, and fiber is essential. Avoid processed foods.":$.includes("hemoglobin")?"Iron-rich foods (spinach, dates, red meat) help boost hemoglobin. Vitamin C helps absorption.":$.includes("sugar")?"Minimize added sugars. Natural sugars in whole fruits are generally okay in moderation.":$.includes("weight")?"Weight management is about Calorie In vs Calorie Out, quality of food, and hormonal balance.":$.includes("sleep")?"7-9 hours of sleep is non-negotiable for recovery and mental health.":"That's a good question. Based on general fitness guidelines, consistency in diet and exercise is 90% of the game. How is your sleep lately?"},g=x=>{if(x.preventDefault(),!i.trim())return;const $={id:Date.now(),text:i,sender:"user"};r(w=>[...w,$]),s(""),o(!0),setTimeout(()=>{const w={id:Date.now()+1,text:p($.text),sender:"bot"};r(y=>[...y,w]),o(!1)},1200)},_=x=>{const $={id:Date.now(),text:x.q,sender:"user"};r(w=>[...w,$]),o(!0),setTimeout(()=>{const w={id:Date.now()+1,text:x.a,sender:"bot"};r(y=>[...y,w]),o(!1)},1200)};return E.jsxs("div",{className:"chat-container fade-in",children:[E.jsxs("div",{className:"header-row",children:[E.jsx("button",{onClick:t,className:"back-btn",children:E.jsx(Si,{size:24})}),E.jsx("h2",{children:"Health Assistant"})]}),E.jsxs("div",{className:"chat-window",children:[n.map(x=>E.jsxs("div",{className:`message-row ${x.sender}`,children:[x.sender==="bot"&&E.jsx("div",{className:"avatar bot",children:E.jsx(Rb,{size:16})}),E.jsx("div",{className:"message-bubble",children:x.text}),x.sender==="user"&&E.jsx("div",{className:"avatar user",children:E.jsx(bC,{size:16})})]},x.id)),a&&E.jsxs("div",{className:"message-row bot",children:[E.jsx("div",{className:"avatar bot",children:E.jsx(Rb,{size:16})}),E.jsxs("div",{className:"message-bubble typing",children:[E.jsx("span",{children:"."}),E.jsx("span",{children:"."}),E.jsx("span",{children:"."})]})]}),E.jsx("div",{ref:l})]}),E.jsxs("div",{className:"input-section",children:[E.jsx("div",{className:"chips-row",children:QB.map((x,$)=>E.jsx("button",{className:"chip",onClick:()=>_(x),disabled:a,children:x.q},$))}),E.jsxs("form",{onSubmit:g,className:"input-form",children:[E.jsx("input",{type:"text",value:i,onChange:x=>s(x.target.value),placeholder:"Ask about health...",className:"chat-input"}),E.jsx("button",{type:"submit",className:"send-btn",children:E.jsx(l5,{size:20})})]})]}),E.jsx("style",{children:`
        .chat-container {
           padding: var(--spacing-md);
           display: flex;
           flex-direction: column;
           height: 100vh;
           max-height: 100vh;
        }
        .header-row {
           display: flex;
           align-items: center;
           gap: var(--spacing-md);
           margin-bottom: var(--spacing-md);
           flex-shrink: 0;
        }
        .back-btn {
           background: transparent;
           color: var(--color-text-main);
           padding: 0;
        }
        .chat-window {
           flex: 1;
           background: #f8fafc;
           border-radius: var(--radius-lg);
           padding: var(--spacing-md);
           overflow-y: auto;
           display: flex;
           flex-direction: column;
           gap: var(--spacing-md);
           margin-bottom: var(--spacing-md);
           border: 1px solid #e2e8f0;
        }
        .message-row {
           display: flex;
           align-items: flex-end;
           gap: 8px;
        }
        .message-row.user {
           justify-content: flex-end;
        }
        .avatar {
           width: 28px;
           height: 28px;
           border-radius: 50%;
           display: flex;
           align-items: center;
           justify-content: center;
           flex-shrink: 0;
        }
        .avatar.bot { background: #7209B7; color: white; }
        .avatar.user { background: var(--color-primary); color: white; }

        .message-bubble {
           max-width: 75%;
           padding: 10px 14px;
           border-radius: 12px;
           font-size: var(--font-size-sm);
           line-height: 1.4;
           box-shadow: var(--shadow-sm);
        }
        .bot .message-bubble {
           background: white;
           color: var(--color-text-main);
           border-bottom-left-radius: 4px;
        }
        .user .message-bubble {
           background: var(--color-primary);
           color: white;
           border-bottom-right-radius: 4px;
        }

        .input-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex-shrink: 0;
        }

        .chips-row {
           display: flex;
           overflow-x: auto;
           gap: 8px;
           padding-bottom: 5px;
           scrollbar-width: none;
        }
        .chip {
           white-space: nowrap;
           background: white;
           border: 1px solid var(--color-primary);
           color: var(--color-primary);
           padding: 6px 12px;
           border-radius: var(--radius-full);
           font-size: 11px;
           transition: all 0.2s;
        }
        .chip:hover {
           background: var(--color-primary);
           color: white;
        }

        .input-form {
            display: flex;
            gap: 10px;
            padding-bottom: 5px; /* for safe area */
        }
        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border-radius: 99px;
            border: 1px solid #cbd5e1;
            font-size: 14px;
            background: white;
        }
        .chat-input:focus { border-color: var(--color-primary); outline: none; }
        .send-btn {
            width: 46px; 
            height: 46px;
            background: var(--color-primary);
            color: white;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: var(--shadow-md);
        }

        .typing span {
           animation: blink 1.4s infinite both;
           margin: 0 1px;
        }
        .typing span:nth-child(2) { animation-delay: 0.2s; }
        .typing span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes blink {
           0% { opacity: 0.2; }
           20% { opacity: 1; }
           100% { opacity: 0.2; }
        }
      `})]})},JB=({message:t,onClose:e})=>(ve.useEffect(()=>{const n=setTimeout(()=>{e()},5e3);return()=>clearTimeout(n)},[e]),E.jsxs("div",{className:"toast-notification",children:[E.jsx("div",{className:"icon-bg",children:E.jsx(Y6,{size:20})}),E.jsxs("div",{className:"content",children:[E.jsx("h4",{children:"Reminder"}),E.jsx("p",{children:t})]}),E.jsx("button",{onClick:e,className:"close-btn",children:""}),E.jsx("style",{children:`
         .toast-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            color: var(--color-text-main);
            padding: 12px 16px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            animation: slideIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            border-left: 4px solid var(--color-primary);
            max-width: 90vw;
         }
         
         .icon-bg {
            background: #FFF0F1;
            color: var(--color-primary);
            padding: 8px;
            border-radius: 50%;
            display: flex;
         }

         .content h4 {
            font-size: var(--font-size-sm);
            margin-bottom: 2px;
         }

         .content p {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
         }

         .close-btn {
            background: transparent;
            font-size: 20px;
            color: #999;
            margin-left: 8px;
         }

         @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
         }
       `})]})),vT=t=>{let e={breakfast:[{name:"Oatmeal with Walnuts & Apple",calories:350,carbs:"60g",protein:"12g",fat:"8g",benefits:["Heart Healthy","High Fiber"]},{name:"Egg Whites & Whole Wheat Toast",calories:300,carbs:"30g",protein:"20g",fat:"5g",benefits:["Muscle Repair"]}],lunch:[{name:"Grilled Chicken Salad with Quinoa",calories:500,carbs:"40g",protein:"40g",fat:"15g",benefits:["Lean Protein","Complete Meal"]},{name:"Lentil Soup (Dal) & Brown Rice",calories:450,carbs:"60g",protein:"18g",fat:"8g",benefits:["Plant Protein","Easy Digestion"]}],snacks:[{name:"Greek Yogurt with Berries",calories:150,carbs:"15g",protein:"12g",fat:"0g",benefits:["Probiotics","Antioxidants"]},{name:"Handful of Almonds",calories:160,carbs:"6g",protein:"6g",fat:"14g",benefits:["Healthy Fats"]}],dinner:[{name:"Baked Salmon with Steamed Broccoli",calories:550,carbs:"10g",protein:"45g",fat:"30g",benefits:["Omega-3","Light Dinner"]},{name:"Stir-Fried Tofu with Mixed Veggies",calories:400,carbs:"15g",protein:"25g",fat:"20g",benefits:["Vegan Option","Light"]}],recommendations:["Drink 3-4 liters of water daily.","Eat dinner at least 2 hours before sleep.","Include a serving of raw salad with lunch.","Limit processed sugar intake."],restrictions:[]};if(!t||!t.results)return e;const{results:n}=t,r=p=>n.find(g=>g.parameter===p),i=r("glucose_fasting"),s=r("glucose_pp");(i&&i.status==="High"||s&&s.status==="High")&&(e.recommendations.unshift(" STRICT LOW GLYCEMIC INDEX DIET RECOMMENDED"),e.restrictions.push("White bread, white rice, pasta","Sugary drinks & desserts","High-sugar fruits (mango, grapes)"),e.breakfast=[{name:"Steel-Cut Oats with Cinnamon (No Sugar)",calories:300,carbs:"50g",protein:"10g",fat:"6g",benefits:["Low GI","Cinnamon Helps Insulin"]},{name:"Vegetable Omelette (Double Spinach)",calories:320,carbs:"5g",protein:"22g",fat:"20g",benefits:["Keto-Friendly","Iron Boost"]}],e.snacks=[{name:"Roasted Chana (Chickpeas)",calories:180,carbs:"20g",protein:"10g",fat:"4g",benefits:["Complex Carbs","Satiety"]},{name:"Cucumber & Hummus Sticks",calories:150,carbs:"15g",protein:"6g",fat:"8g",benefits:["Hydrating","Low Carb"]}]);const a=r("cholesterol"),o=r("triglycerides"),l=r("ldl_cholesterol");(a&&a.status==="High"||o&&o.status==="High"||l&&l.status==="High")&&(e.recommendations.unshift(" HEART HEALTHY FATS ONLY (Avoid Saturated Fats)"),e.restrictions.push("Red meat","Butter/Ghee","Fried foods","Full-fat dairy"),e.dinner=[{name:"Grilled Mackerel/Salmon (No Butter)",calories:500,carbs:"0g",protein:"40g",fat:"25g",benefits:["High Omega-3","Lowers inflammation"]},{name:"Quinoa Bowl with Beans",calories:450,carbs:"60g",protein:"18g",fat:"8g",benefits:["Fiber lowers cholesterol"]}],e.breakfast.some(p=>p.name.includes("Oat"))||e.breakfast.unshift({name:"Bowl of Oatmeal with Flaxseeds",calories:350,carbs:"55g",protein:"12g",fat:"10g",benefits:["Soluble Fiber","Cholesterol Lowering"]}));const u=r("hemoglobin");u&&u.status==="Low"&&(e.recommendations.unshift(" IRON-RICH DIET (Consume Vitamin C for absorption)"),e.lunch.forEach(p=>{p.name.includes("Spinach")||(p.name+=" + Side Spinach Salad"),p.benefits.push("Iron Booster")}),e.snacks.push({name:"Dates & Walnuts",calories:200,carbs:"40g",protein:"4g",fat:"8g",benefits:["High Iron","Energy"]}),e.restrictions.push("Tea/Coffee within 1 hour of meals (Inhibits Iron absorption)"));const h=r("uric_acid");h&&h.status==="High"&&(e.recommendations.unshift(" LOW PURINE DIET (Manage Uric Acid)"),e.restrictions.push("Red meat","Shellfish","Spinach","Cauliflower","Alcohol"),["breakfast","lunch","dinner","snacks"].forEach(p=>{e[p]=e[p].map(g=>g.name.includes("Spinach")?{...g,name:g.name.replace("Spinach","Cucumber"),benefits:g.benefits.filter(_=>_!=="Iron Booster")}:g)}),e.snacks.push({name:"Bowl of Cherries / Berries",calories:100,carbs:"25g",protein:"1g",fat:"0g",benefits:["Lowers Uric Acid"]}));const f=r("tsh");return f&&f.status==="High"&&(e.recommendations.unshift(" THYROID SUPPORT (Limit Goitrogens raw)"),e.restrictions.push("Raw Cruciferous Veggies (Cabbage, Broccoli, Cauliflower) - Cook them well"),e.recommendations.push("Ensure iodized salt usage or eat seaweed."),e.breakfast.push({name:"Brazil Nuts (2-3) & Smoothie",calories:300,carbs:"40g",protein:"10g",fat:"15g",benefits:["Selenium for Thyroid"]})),e},XB=({onBack:t,user:e})=>{const[n,r]=ve.useState(null),[i,s]=ve.useState(null),[a,o]=ve.useState(!0),[l,u]=ve.useState(!1),[h,f]=ve.useState("breakfast");ve.useEffect(()=>{p()},[e]);const p=()=>{e&&e.email?`${e.email}`:`${Date.now()}`;let _=null;if(e&&e.email){const x=localStorage.getItem(`reports_${e.email}`);if(x){const $=JSON.parse(x);$.length>0&&(_=$[0])}}else{const x=Object.keys(localStorage).filter($=>$.startsWith("temp_reports_"));if(x.length>0){const $=localStorage.getItem(x[x.length-1]);if($){const w=JSON.parse($);w.length>0&&(_=w[0])}}}if(_){r(_);const x=vT(_);s(x)}o(!1)},g=async _=>{const x=_.target.files[0];if(x){u(!0);try{const{data:{text:$}}=await $C.recognize(x,"eng"),w=$.split(`
`),y={},I={hemoglobin:["hemoglobin","hb"],glucose_fasting:["glucose fasting","fbs"],cholesterol:["cholesterol"],uric_acid:["uric acid"],tsh:["tsh"]};if(w.forEach(k=>{const P=k.toLowerCase();Object.keys(I).forEach(A=>{if(I[A].some(D=>P.includes(D))){const D=k.match(/(\d+(\.\d+)?)/g);D&&(y[A]=parseFloat(D[0]))}})}),Object.keys(y).length===0){alert("Could not detect clear values. Please try a clearer image."),u(!1);return}const R=SC(y);s(vT(R)),r(R);const M=e&&e.email?`reports_${e.email}`:`temp_reports_${Date.now()}`,j=JSON.parse(localStorage.getItem(M)||"[]"),C=[R,...j];localStorage.setItem(M,JSON.stringify(C))}catch($){console.error($),alert("Error scanning file.")}finally{u(!1)}}};return a?E.jsx("div",{className:"p-4",children:"Loading Diet Plan..."}):n?E.jsxs("div",{className:"diet-container fade-in",children:[E.jsxs("div",{className:"header-row",children:[E.jsx("button",{onClick:t,className:"back-btn",children:E.jsx(Si,{size:24})}),E.jsx("h2",{children:"Your Personalized Diet"})]}),E.jsx("div",{className:"health-summary",children:i.recommendations.some(_=>_.includes(""))?E.jsxs("div",{className:"alert-badge warning",children:[E.jsx(_C,{size:16}),E.jsx("span",{children:"Based on your report: Modifications applied for specific conditions."})]}):E.jsxs("div",{className:"alert-badge success",children:[E.jsx(e5,{size:16}),E.jsx("span",{children:"Report looks balanced. Showing base healthy plan."})]})}),E.jsxs("div",{className:"recommendations-box",children:[E.jsx("h4",{children:"Key Guidelines"}),E.jsx("ul",{children:i.recommendations.slice(0,3).map((_,x)=>E.jsx("li",{className:_.includes("")?"high-priority":"",children:_},x))})]}),E.jsx("div",{className:"meal-tabs",children:["breakfast","lunch","snacks","dinner"].map(_=>E.jsx("button",{className:`tab-btn ${h===_?"active":""}`,onClick:()=>f(_),children:_.charAt(0).toUpperCase()+_.slice(1)},_))}),E.jsx("div",{className:"meal-content",children:i[h].map((_,x)=>E.jsxs("div",{className:"food-card slide-in",children:[E.jsxs("div",{className:"food-header",children:[E.jsx("h3",{children:_.name}),E.jsxs("span",{className:"cal-badge",children:[_.calories," kcal"]})]}),E.jsxs("div",{className:"macros-row",children:[E.jsxs("span",{className:"macro",children:["C: ",_.carbs]}),E.jsxs("span",{className:"macro",children:["P: ",_.protein]}),E.jsxs("span",{className:"macro",children:["F: ",_.fat]})]}),E.jsx("div",{className:"benefits-tags",children:_.benefits.map(($,w)=>E.jsx("span",{className:"tag",children:$},w))})]},x))}),i.restrictions.length>0&&E.jsxs("div",{className:"restrictions-box",children:[E.jsx("h4",{children:" Avoid / Limit"}),E.jsx("p",{children:i.restrictions.join(", ")})]}),E.jsx("style",{children:`
                .diet-container { padding: 20px; padding-bottom: 80px; }
                .header-row { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
                .back-btn { background: none; border: none; padding: 0; cursor: pointer; color: #333; }
                
                .health-summary { margin-bottom: 20px; }
                .alert-badge { 
                    padding: 10px 15px; border-radius: 8px; font-size: 13px; 
                    display: flex; align-items: center; gap: 8px; font-weight: 500;
                }
                .alert-badge.warning { background: #fff7ed; color: #c2410c; border: 1px solid #ffedd5; }
                .alert-badge.success { background: #f0fdf4; color: #15803d; border: 1px solid #dcfce7; }

                .recommendations-box { 
                    background: #f8fafc; padding: 15px; border-radius: 12px; margin-bottom: 20px;
                }
                .recommendations-box h4 { margin: 0 0 10px 0; font-size: 14px; color: #475569; }
                .recommendations-box ul { padding-left: 20px; margin: 0; font-size: 13px; color: #334155; }
                .recommendations-box li { margin-bottom: 5px; }
                .recommendations-box li.high-priority { color: #dc2626; font-weight: 600; }

                .meal-tabs { 
                    display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 10px; 
                    scrollbar-width: none;
                }
                .tab-btn {
                    padding: 8px 16px; border-radius: 20px; background: white; border: 1px solid #e2e8f0;
                    font-size: 13px; white-space: nowrap; cursor: pointer; transition: all 0.2s;
                }
                .tab-btn.active {
                    background: var(--color-primary); color: white; border-color: var(--color-primary);
                    box-shadow: 0 4px 6px -1px rgba(var(--color-primary-rgb), 0.4);
                }

                .food-card {
                    background: white; padding: 16px; border-radius: 12px; margin-bottom: 15px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.06); border-left: 4px solid var(--color-primary);
                }
                .food-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
                .food-header h3 { margin: 0; font-size: 15px; font-weight: 600; color: #1e293b; max-width: 70%; }
                .cal-badge { font-size: 11px; font-weight: bold; background: #f1f5f9; padding: 4px 8px; border-radius: 6px; color: #64748b; }
                
                .macros-row { display: flex; gap: 15px; margin-bottom: 10px; font-size: 12px; color: #64748b; }
                .macro { font-weight: 500; }
                
                .benefits-tags { display: flex; flex-wrap: wrap; gap: 6px; }
                .tag { font-size: 10px; background: #ecfdf5; color: #047857; padding: 3px 8px; border-radius: 4px; }

                .restrictions-box {
                    margin-top: 25px; padding: 15px; background: #fef2f2; border-radius: 12px;
                    border: 1px dashed #fecaca;
                }
                .restrictions-box h4 { color: #b91c1c; margin: 0 0 5px 0; font-size: 13px; }
                .restrictions-box p { color: #7f1d1d; font-size: 12px; margin: 0; line-height: 1.4; }

                .slide-in { animation: slideIn 0.3s ease-out forwards; }
                @keyframes slideIn {
                    from { opacity: 0; transform: translateY(10px); }
                    to { opacity: 1; transform: translateY(0); }
                }
            `})]}):E.jsxs("div",{className:"diet-container fade-in",children:[E.jsxs("div",{className:"header-row",children:[E.jsx("button",{onClick:t,className:"back-btn",children:E.jsx(Si,{size:24})}),E.jsx("h2",{children:"Specialized Diet"})]}),E.jsxs("div",{className:"no-report-state",children:[E.jsx("div",{className:"icon-box",children:E.jsx(Du,{size:40,color:"var(--color-primary)"})}),E.jsx("h3",{children:"No Report Uploaded"}),E.jsx("p",{children:"Please upload your blood test report to get a personalized diet plan tailored to your body's needs."}),E.jsxs("label",{className:"btn-primary upload-btn-large",children:[l?"Scanning...":"Upload Report Now",E.jsx(wC,{size:18,style:{marginLeft:8}}),E.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:g,disabled:l})]})]}),E.jsx("style",{children:`
                    .diet-container { padding: 20px; }
                    .header-row { display: flex; align-items: center; gap: 15px; margin-bottom: 30px; }
                    .back-btn { background: none; border: none; padding: 0; cursor: pointer; color: #333; }
                    .no-report-state { 
                        text-align: center; padding: 40px 20px; background: white; 
                        border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);
                        display: flex; flex-direction: column; align-items: center;
                    }
                    .icon-box { 
                        width: 80px; height: 80px; background: #e0f2fe; border-radius: 50%; 
                        display: flex; align-items: center; justify-content: center; margin-bottom: 20px;
                    }
                    .no-report-state h3 { margin-bottom: 10px; color: #0c4a6e; }
                    .no-report-state p { color: #64748b; margin-bottom: 30px; max-width: 300px; line-height: 1.5; }
                    .upload-btn-large { 
                        padding: 12px 24px; background: var(--color-primary); color: white; 
                        border-radius: 99px; display: inline-flex; align-items: center; cursor: pointer;
                        font-weight: 500;
                    }
                `})]})};/*! Capacitor: https://capacitorjs.com/ - MIT License */const ZB=t=>{const e=new Map;e.set("web",{name:"web"});const n=t.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:e},r=(s,a)=>{n.platforms.set(s,a)},i=s=>{n.platforms.has(s)&&(n.currentPlatform=n.platforms.get(s))};return n.addPlatform=r,n.setPlatform=i,n},eF=t=>t.CapacitorPlatforms=ZB(t),dN=eF(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});dN.addPlatform;dN.setPlatform;var Yo;(function(t){t.Unimplemented="UNIMPLEMENTED",t.Unavailable="UNAVAILABLE"})(Yo||(Yo={}));class ug extends Error{constructor(e,n,r){super(e),this.message=e,this.code=n,this.data=r}}const tF=t=>{var e,n;return t!=null&&t.androidBridge?"android":!((n=(e=t==null?void 0:t.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||n===void 0)&&n.bridge?"ios":"web"},nF=t=>{var e,n,r,i,s;const a=t.CapacitorCustomPlatform||null,o=t.Capacitor||{},l=o.Plugins=o.Plugins||{},u=t.CapacitorPlatforms,h=()=>a!==null?a.name:tF(t),f=((e=u==null?void 0:u.currentPlatform)===null||e===void 0?void 0:e.getPlatform)||h,p=()=>f()!=="web",g=((n=u==null?void 0:u.currentPlatform)===null||n===void 0?void 0:n.isNativePlatform)||p,_=C=>{const k=R.get(C);return!!(k!=null&&k.platforms.has(f())||w(C))},x=((r=u==null?void 0:u.currentPlatform)===null||r===void 0?void 0:r.isPluginAvailable)||_,$=C=>{var k;return(k=o.PluginHeaders)===null||k===void 0?void 0:k.find(P=>P.name===C)},w=((i=u==null?void 0:u.currentPlatform)===null||i===void 0?void 0:i.getPluginHeader)||$,y=C=>t.console.error(C),I=(C,k,P)=>Promise.reject(`${P} does not have an implementation of "${k}".`),R=new Map,M=(C,k={})=>{const P=R.get(C);if(P)return console.warn(`Capacitor plugin "${C}" already registered. Cannot register plugins twice.`),P.proxy;const A=f(),D=w(C);let z;const O=async()=>(!z&&A in k?z=typeof k[A]=="function"?z=await k[A]():z=k[A]:a!==null&&!z&&"web"in k&&(z=typeof k.web=="function"?z=await k.web():z=k.web),z),ce=(F,U)=>{var G,q;if(D){const Y=D==null?void 0:D.methods.find(ae=>U===ae.name);if(Y)return Y.rtype==="promise"?ae=>o.nativePromise(C,U.toString(),ae):(ae,Ee)=>o.nativeCallback(C,U.toString(),ae,Ee);if(F)return(G=F[U])===null||G===void 0?void 0:G.bind(F)}else{if(F)return(q=F[U])===null||q===void 0?void 0:q.bind(F);throw new ug(`"${C}" plugin is not implemented on ${A}`,Yo.Unimplemented)}},de=F=>{let U;const G=(...q)=>{const Y=O().then(ae=>{const Ee=ce(ae,F);if(Ee){const Q=Ee(...q);return U=Q==null?void 0:Q.remove,Q}else throw new ug(`"${C}.${F}()" is not implemented on ${A}`,Yo.Unimplemented)});return F==="addListener"&&(Y.remove=async()=>U()),Y};return G.toString=()=>`${F.toString()}() { [capacitor code] }`,Object.defineProperty(G,"name",{value:F,writable:!1,configurable:!1}),G},ue=de("addListener"),pe=de("removeListener"),K=(F,U)=>{const G=ue({eventName:F},U),q=async()=>{const ae=await G;pe({eventName:F,callbackId:ae},U)},Y=new Promise(ae=>G.then(()=>ae({remove:q})));return Y.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await q()},Y},B=new Proxy({},{get(F,U){switch(U){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return D?K:ue;case"removeListener":return pe;default:return de(U)}}});return l[C]=B,R.set(C,{name:C,proxy:B,platforms:new Set([...Object.keys(k),...D?[A]:[]])}),B},j=((s=u==null?void 0:u.currentPlatform)===null||s===void 0?void 0:s.registerPlugin)||M;return o.convertFileSrc||(o.convertFileSrc=C=>C),o.getPlatform=f,o.handleError=y,o.isNativePlatform=g,o.isPluginAvailable=x,o.pluginMethodNoop=I,o.registerPlugin=j,o.Exception=ug,o.DEBUG=!!o.DEBUG,o.isLoggingEnabled=!!o.isLoggingEnabled,o.platform=o.getPlatform(),o.isNative=o.isNativePlatform(),o},rF=t=>t.Capacitor=nF(t),Sa=rF(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),f0=Sa.registerPlugin;Sa.Plugins;class hN{constructor(e){this.listeners={},this.retainedEventArguments={},this.windowListeners={},e&&(console.warn(`Capacitor WebPlugin "${e.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=e)}addListener(e,n){let r=!1;this.listeners[e]||(this.listeners[e]=[],r=!0),this.listeners[e].push(n);const s=this.windowListeners[e];s&&!s.registered&&this.addWindowListener(s),r&&this.sendRetainedArgumentsForEvent(e);const a=async()=>this.removeListener(e,n);return Promise.resolve({remove:a})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,n,r){const i=this.listeners[e];if(!i){if(r){let s=this.retainedEventArguments[e];s||(s=[]),s.push(n),this.retainedEventArguments[e]=s}return}i.forEach(s=>s(n))}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,n){this.windowListeners[n]={registered:!1,windowEventName:e,pluginEventName:n,handler:r=>{this.notifyListeners(n,r)}}}unimplemented(e="not implemented"){return new Sa.Exception(e,Yo.Unimplemented)}unavailable(e="not available"){return new Sa.Exception(e,Yo.Unavailable)}async removeListener(e,n){const r=this.listeners[e];if(!r)return;const i=r.indexOf(n);this.listeners[e].splice(i,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const n=this.retainedEventArguments[e];n&&(delete this.retainedEventArguments[e],n.forEach(r=>{this.notifyListeners(e,r)}))}}const wT=t=>encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),bT=t=>t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class iF extends hN{async getCookies(){const e=document.cookie,n={};return e.split(";").forEach(r=>{if(r.length<=0)return;let[i,s]=r.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");i=bT(i).trim(),s=bT(s).trim(),n[i]=s}),n}async setCookie(e){try{const n=wT(e.key),r=wT(e.value),i=`; expires=${(e.expires||"").replace("expires=","")}`,s=(e.path||"/").replace("path=",""),a=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${n}=${r||""}${i}; path=${s}; ${a};`}catch(n){return Promise.reject(n)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(n){return Promise.reject(n)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const n of e)document.cookie=n.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}f0("CapacitorCookies",{web:()=>new iF});const sF=async t=>new Promise((e,n)=>{const r=new FileReader;r.onload=()=>{const i=r.result;e(i.indexOf(",")>=0?i.split(",")[1]:i)},r.onerror=i=>n(i),r.readAsDataURL(t)}),aF=(t={})=>{const e=Object.keys(t);return Object.keys(t).map(i=>i.toLocaleLowerCase()).reduce((i,s,a)=>(i[s]=t[e[a]],i),{})},oF=(t,e=!0)=>t?Object.entries(t).reduce((r,i)=>{const[s,a]=i;let o,l;return Array.isArray(a)?(l="",a.forEach(u=>{o=e?encodeURIComponent(u):u,l+=`${s}=${o}&`}),l.slice(0,-1)):(o=e?encodeURIComponent(a):a,l=`${s}=${o}`),`${r}&${l}`},"").substr(1):null,lF=(t,e={})=>{const n=Object.assign({method:t.method||"GET",headers:t.headers},e),i=aF(t.headers)["content-type"]||"";if(typeof t.data=="string")n.body=t.data;else if(i.includes("application/x-www-form-urlencoded")){const s=new URLSearchParams;for(const[a,o]of Object.entries(t.data||{}))s.set(a,o);n.body=s.toString()}else if(i.includes("multipart/form-data")||t.data instanceof FormData){const s=new FormData;if(t.data instanceof FormData)t.data.forEach((o,l)=>{s.append(l,o)});else for(const o of Object.keys(t.data))s.append(o,t.data[o]);n.body=s;const a=new Headers(n.headers);a.delete("content-type"),n.headers=a}else(i.includes("application/json")||typeof t.data=="object")&&(n.body=JSON.stringify(t.data));return n};class uF extends hN{async request(e){const n=lF(e,e.webFetchExtra),r=oF(e.params,e.shouldEncodeUrlParams),i=r?`${e.url}?${r}`:e.url,s=await fetch(i,n),a=s.headers.get("content-type")||"";let{responseType:o="text"}=s.ok?e:{};a.includes("application/json")&&(o="json");let l,u;switch(o){case"arraybuffer":case"blob":u=await s.blob(),l=await sF(u);break;case"json":l=await s.json();break;case"document":case"text":default:l=await s.text()}const h={};return s.headers.forEach((f,p)=>{h[p]=f}),{data:l,headers:h,status:s.status,url:s.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}f0("CapacitorHttp",{web:()=>new uF});var xT;(function(t){t[t.Sunday=1]="Sunday",t[t.Monday=2]="Monday",t[t.Tuesday=3]="Tuesday",t[t.Wednesday=4]="Wednesday",t[t.Thursday=5]="Thursday",t[t.Friday=6]="Friday",t[t.Saturday=7]="Saturday"})(xT||(xT={}));const Ef=f0("LocalNotifications",{web:()=>L$(()=>import("./web-DB7VZnDP.js"),[],import.meta.url).then(t=>new t.LocalNotificationsWeb)}),cF=async()=>{if(!Sa.isNativePlatform())return console.log("Notifications only work on native platforms"),!1;try{return(await Ef.requestPermissions()).display==="granted"}catch(t){return console.error("Error requesting notification permissions:",t),!1}},dF=async()=>{if(Sa.isNativePlatform())try{await Ef.cancel({notifications:[{id:1}]});const t=new Date;return t.setMonth(t.getMonth()+3),await Ef.schedule({notifications:[{title:" Blood Checkup Reminder",body:"It's been 3 months since your last blood test. Time for a health checkup!",id:1,schedule:{at:t},sound:"default",actionTypeId:"",extra:{type:"blood_checkup_reminder"}}]}),console.log("3-month reminder scheduled for:",t),t}catch(t){return console.error("Error scheduling 3-month reminder:",t),null}},hF=()=>{Sa.isNativePlatform()&&Ef.addListener("localNotificationActionPerformed",t=>{console.log("Notification clicked:",t)})};function fF(){const t=localStorage.getItem("user_profile"),[e,n]=ve.useState(t?"dashboard":"login"),[r,i]=ve.useState(null),[s,a]=ve.useState(null),[o,l]=ve.useState(t?JSON.parse(t):null),[u,h]=ve.useState(null);OT.useEffect(()=>{(async()=>{if(await cF()){console.log("Notifications enabled"),hF();const R=await dF();R&&console.log("Next blood checkup reminder:",R.toLocaleDateString())}})();const $=mu.onAuthStateChange(async I=>{if(I){console.log("User logged in:",I.email),a({email:I.email,id:I.uid});try{const R=await mu.getProfile();R.success&&R.profile?(l(R.profile),n("dashboard")):n("profile_setup")}catch(R){console.error("Error loading profile:",R),n("profile_setup")}}else console.log("User logged out"),a(null),l(null),n("login")}),w=["Drink a glass of water now! ","Time to stretch your legs! ","Don't forget to eat a fruit today! ","Stay motivated! You're doing great. ","Check your blood report regularly. ","Avoid sugary drinks for better health. "],y=setInterval(()=>{const I=w[Math.floor(Math.random()*w.length)];h(I)},12e4);return()=>{clearInterval(y),$()}},[]);const f=async(x,$=!1)=>{if(a(x),$){n("profile_setup");return}try{const w=await mu.getProfile();w.success&&w.profile?(console.log("Profile found:",w.profile),l(w.profile),localStorage.setItem("user_profile",JSON.stringify(w.profile)),n("dashboard")):(console.log("No profile found, redirecting to setup"),n("profile_setup"))}catch(w){console.error("Error fetching profile:",w);const y=localStorage.getItem("user_profile");if(y){const I=JSON.parse(y);I.email===x.email?(l(I),n("dashboard")):(console.log("Cached profile does not match current user. Redirecting to setup."),n("profile_setup"))}else n("profile_setup")}},p=x=>{const $={...x,email:s==null?void 0:s.email};l($),localStorage.setItem("user_profile",JSON.stringify($)),n("dashboard")},g=(x,$=null)=>{i($),n(x)},_=async()=>{await mu.logout()};return E.jsxs("div",{className:"app-container",children:[u&&E.jsx(JB,{message:u,onClose:()=>h(null)}),e==="login"&&E.jsx(K4,{onLogin:f}),e==="profile_setup"&&E.jsx(q6,{onComplete:p}),e==="dashboard"&&E.jsx(y5,{userName:o==null?void 0:o.name,userProfile:o,onNavigate:g,onLogout:_}),e==="bmi"&&E.jsx(_5,{userProfile:o,onBack:()=>n("dashboard")}),e==="blood"&&E.jsx(WB,{user:o,onBack:()=>n("dashboard"),initialViewReport:r}),e==="fitness"&&E.jsx(qB,{userProfile:o,onBack:()=>n("dashboard")}),e==="homeworkout"&&E.jsx(GB,{onBack:()=>n("dashboard")}),e==="weightprogress"&&E.jsx(KB,{userProfile:o,onBack:()=>n("dashboard")}),e==="chat"&&E.jsx(YB,{userProfile:o,onBack:()=>n("dashboard")}),e==="diet"&&E.jsx(XB,{user:o,onBack:()=>n("dashboard")})]})}cg.createRoot(document.getElementById("root")).render(E.jsx(OT.StrictMode,{children:E.jsx(fF,{})}));export{hN as W};
