var g5=Object.defineProperty;var yk=n=>{throw TypeError(n)};var y5=(n,e,t)=>e in n?g5(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Le=(n,e,t)=>y5(n,typeof e!="symbol"?e+"":e,t),bx=(n,e,t)=>e.has(n)||yk("Cannot "+t);var d=(n,e,t)=>(bx(n,e,"read from private field"),t?t.call(n):e.get(n)),F=(n,e,t)=>e.has(n)?yk("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),R=(n,e,t,i)=>(bx(n,e,"write to private field"),i?i.call(n,t):e.set(n,t),t),z=(n,e,t)=>(bx(n,e,"access private method"),t);var Ti=(n,e,t,i)=>({set _(r){R(n,e,r,t)},get _(){return d(n,e,i)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function AO(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var TO={exports:{}},h1={},SO={exports:{}},tt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K_=Symbol.for("react.element"),_5=Symbol.for("react.portal"),v5=Symbol.for("react.fragment"),w5=Symbol.for("react.strict_mode"),b5=Symbol.for("react.profiler"),x5=Symbol.for("react.provider"),E5=Symbol.for("react.context"),A5=Symbol.for("react.forward_ref"),T5=Symbol.for("react.suspense"),S5=Symbol.for("react.memo"),I5=Symbol.for("react.lazy"),_k=Symbol.iterator;function C5(n){return n===null||typeof n!="object"?null:(n=_k&&n[_k]||n["@@iterator"],typeof n=="function"?n:null)}var IO={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},CO=Object.assign,kO={};function Dp(n,e,t){this.props=n,this.context=e,this.refs=kO,this.updater=t||IO}Dp.prototype.isReactComponent={};Dp.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Dp.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function $O(){}$O.prototype=Dp.prototype;function d2(n,e,t){this.props=n,this.context=e,this.refs=kO,this.updater=t||IO}var h2=d2.prototype=new $O;h2.constructor=d2;CO(h2,Dp.prototype);h2.isPureReactComponent=!0;var vk=Array.isArray,RO=Object.prototype.hasOwnProperty,f2={current:null},PO={key:!0,ref:!0,__self:!0,__source:!0};function NO(n,e,t){var i,r={},s=null,a=null;if(e!=null)for(i in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(s=""+e.key),e)RO.call(e,i)&&!PO.hasOwnProperty(i)&&(r[i]=e[i]);var o=arguments.length-2;if(o===1)r.children=t;else if(1<o){for(var l=Array(o),u=0;u<o;u++)l[u]=arguments[u+2];r.children=l}if(n&&n.defaultProps)for(i in o=n.defaultProps,o)r[i]===void 0&&(r[i]=o[i]);return{$$typeof:K_,type:n,key:s,ref:a,props:r,_owner:f2.current}}function k5(n,e){return{$$typeof:K_,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function p2(n){return typeof n=="object"&&n!==null&&n.$$typeof===K_}function $5(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var wk=/\/+/g;function xx(n,e){return typeof n=="object"&&n!==null&&n.key!=null?$5(""+n.key):e.toString(36)}function Vw(n,e,t,i,r){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case K_:case _5:a=!0}}if(a)return a=n,r=r(a),n=i===""?"."+xx(a,0):i,vk(r)?(t="",n!=null&&(t=n.replace(wk,"$&/")+"/"),Vw(r,e,t,"",function(u){return u})):r!=null&&(p2(r)&&(r=k5(r,t+(!r.key||a&&a.key===r.key?"":(""+r.key).replace(wk,"$&/")+"/")+n)),e.push(r)),1;if(a=0,i=i===""?".":i+":",vk(n))for(var o=0;o<n.length;o++){s=n[o];var l=i+xx(s,o);a+=Vw(s,e,t,l,r)}else if(l=C5(n),typeof l=="function")for(n=l.call(n),o=0;!(s=n.next()).done;)s=s.value,l=i+xx(s,o++),a+=Vw(s,e,t,l,r);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function Yv(n,e,t){if(n==null)return n;var i=[],r=0;return Vw(n,i,"","",function(s){return e.call(t,s,r++)}),i}function R5(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Li={current:null},jw={transition:null},P5={ReactCurrentDispatcher:Li,ReactCurrentBatchConfig:jw,ReactCurrentOwner:f2};function DO(){throw Error("act(...) is not supported in production builds of React.")}tt.Children={map:Yv,forEach:function(n,e,t){Yv(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Yv(n,function(){e++}),e},toArray:function(n){return Yv(n,function(e){return e})||[]},only:function(n){if(!p2(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};tt.Component=Dp;tt.Fragment=v5;tt.Profiler=b5;tt.PureComponent=d2;tt.StrictMode=w5;tt.Suspense=T5;tt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P5;tt.act=DO;tt.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var i=CO({},n.props),r=n.key,s=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,a=f2.current),e.key!==void 0&&(r=""+e.key),n.type&&n.type.defaultProps)var o=n.type.defaultProps;for(l in e)RO.call(e,l)&&!PO.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=t;else if(1<l){o=Array(l);for(var u=0;u<l;u++)o[u]=arguments[u+2];i.children=o}return{$$typeof:K_,type:n.type,key:r,ref:s,props:i,_owner:a}};tt.createContext=function(n){return n={$$typeof:E5,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:x5,_context:n},n.Consumer=n};tt.createElement=NO;tt.createFactory=function(n){var e=NO.bind(null,n);return e.type=n,e};tt.createRef=function(){return{current:null}};tt.forwardRef=function(n){return{$$typeof:A5,render:n}};tt.isValidElement=p2;tt.lazy=function(n){return{$$typeof:I5,_payload:{_status:-1,_result:n},_init:R5}};tt.memo=function(n,e){return{$$typeof:S5,type:n,compare:e===void 0?null:e}};tt.startTransition=function(n){var e=jw.transition;jw.transition={};try{n()}finally{jw.transition=e}};tt.unstable_act=DO;tt.useCallback=function(n,e){return Li.current.useCallback(n,e)};tt.useContext=function(n){return Li.current.useContext(n)};tt.useDebugValue=function(){};tt.useDeferredValue=function(n){return Li.current.useDeferredValue(n)};tt.useEffect=function(n,e){return Li.current.useEffect(n,e)};tt.useId=function(){return Li.current.useId()};tt.useImperativeHandle=function(n,e,t){return Li.current.useImperativeHandle(n,e,t)};tt.useInsertionEffect=function(n,e){return Li.current.useInsertionEffect(n,e)};tt.useLayoutEffect=function(n,e){return Li.current.useLayoutEffect(n,e)};tt.useMemo=function(n,e){return Li.current.useMemo(n,e)};tt.useReducer=function(n,e,t){return Li.current.useReducer(n,e,t)};tt.useRef=function(n){return Li.current.useRef(n)};tt.useState=function(n){return Li.current.useState(n)};tt.useSyncExternalStore=function(n,e,t){return Li.current.useSyncExternalStore(n,e,t)};tt.useTransition=function(){return Li.current.useTransition()};tt.version="18.3.1";SO.exports=tt;var Ce=SO.exports;const MO=AO(Ce);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N5=Ce,D5=Symbol.for("react.element"),M5=Symbol.for("react.fragment"),O5=Object.prototype.hasOwnProperty,L5=N5.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,F5={key:!0,ref:!0,__self:!0,__source:!0};function OO(n,e,t){var i,r={},s=null,a=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(a=e.ref);for(i in e)O5.call(e,i)&&!F5.hasOwnProperty(i)&&(r[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:D5,type:n,key:s,ref:a,props:r,_owner:L5.current}}h1.Fragment=M5;h1.jsx=OO;h1.jsxs=OO;TO.exports=h1;var S=TO.exports,pA={},LO={exports:{}},Pr={},FO={exports:{}},zO={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(J,q){var G=J.length;J.push(q);e:for(;0<G;){var U=G-1>>>1,Y=J[U];if(0<r(Y,q))J[U]=q,J[G]=Y,G=U;else break e}}function t(J){return J.length===0?null:J[0]}function i(J){if(J.length===0)return null;var q=J[0],G=J.pop();if(G!==q){J[0]=G;e:for(var U=0,Y=J.length,K=Y>>>1;U<K;){var Z=2*(U+1)-1,ge=J[Z],ve=Z+1,Q=J[ve];if(0>r(ge,G))ve<Y&&0>r(Q,ge)?(J[U]=Q,J[ve]=G,U=ve):(J[U]=ge,J[Z]=G,U=Z);else if(ve<Y&&0>r(Q,G))J[U]=Q,J[ve]=G,U=ve;else break e}}return q}function r(J,q){var G=J.sortIndex-q.sortIndex;return G!==0?G:J.id-q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var l=[],u=[],c=1,h=null,f=3,m=!1,y=!1,_=!1,x=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(J){for(var q=t(u);q!==null;){if(q.callback===null)i(u);else if(q.startTime<=J)i(u),q.sortIndex=q.expirationTime,e(l,q);else break;q=t(u)}}function C(J){if(_=!1,E(J),!y)if(t(l)!==null)y=!0,ee(D);else{var q=t(u);q!==null&&ae(C,q.startTime-J)}}function D(J,q){y=!1,_&&(_=!1,v(k),k=-1),m=!0;var G=f;try{for(E(q),h=t(l);h!==null&&(!(h.expirationTime>q)||J&&!j());){var U=h.callback;if(typeof U=="function"){h.callback=null,f=h.priorityLevel;var Y=U(h.expirationTime<=q);q=n.unstable_now(),typeof Y=="function"?h.callback=Y:h===t(l)&&i(l),E(q)}else i(l);h=t(l)}if(h!==null)var K=!0;else{var Z=t(u);Z!==null&&ae(C,Z.startTime-q),K=!1}return K}finally{h=null,f=G,m=!1}}var V=!1,I=null,k=-1,N=5,L=-1;function j(){return!(n.unstable_now()-L<N)}function H(){if(I!==null){var J=n.unstable_now();L=J;var q=!0;try{q=I(!0,J)}finally{q?M():(V=!1,I=null)}}else V=!1}var M;if(typeof w=="function")M=function(){w(H)};else if(typeof MessageChannel<"u"){var se=new MessageChannel,ue=se.port2;se.port1.onmessage=H,M=function(){ue.postMessage(null)}}else M=function(){x(H,0)};function ee(J){I=J,V||(V=!0,M())}function ae(J,q){k=x(function(){J(n.unstable_now())},q)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(J){J.callback=null},n.unstable_continueExecution=function(){y||m||(y=!0,ee(D))},n.unstable_forceFrameRate=function(J){0>J||125<J?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<J?Math.floor(1e3/J):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(J){switch(f){case 1:case 2:case 3:var q=3;break;default:q=f}var G=f;f=q;try{return J()}finally{f=G}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(J,q){switch(J){case 1:case 2:case 3:case 4:case 5:break;default:J=3}var G=f;f=J;try{return q()}finally{f=G}},n.unstable_scheduleCallback=function(J,q,G){var U=n.unstable_now();switch(typeof G=="object"&&G!==null?(G=G.delay,G=typeof G=="number"&&0<G?U+G:U):G=U,J){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=G+Y,J={id:c++,callback:q,priorityLevel:J,startTime:G,expirationTime:Y,sortIndex:-1},G>U?(J.sortIndex=G,e(u,J),t(l)===null&&J===t(u)&&(_?(v(k),k=-1):_=!0,ae(C,G-U))):(J.sortIndex=Y,e(l,J),y||m||(y=!0,ee(D))),J},n.unstable_shouldYield=j,n.unstable_wrapCallback=function(J){var q=f;return function(){var G=f;f=q;try{return J.apply(this,arguments)}finally{f=G}}}})(zO);FO.exports=zO;var z5=FO.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V5=Ce,Rr=z5;function me(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var VO=new Set,Hg={};function Yd(n,e){yp(n,e),yp(n+"Capture",e)}function yp(n,e){for(Hg[n]=e,n=0;n<e.length;n++)VO.add(e[n])}var Bo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),mA=Object.prototype.hasOwnProperty,j5=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,bk={},xk={};function B5(n){return mA.call(xk,n)?!0:mA.call(bk,n)?!1:j5.test(n)?xk[n]=!0:(bk[n]=!0,!1)}function U5(n,e,t,i){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function H5(n,e,t,i){if(e===null||typeof e>"u"||U5(n,e,t,i))return!0;if(i)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Fi(n,e,t,i,r,s,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=a}var ti={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){ti[n]=new Fi(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];ti[e]=new Fi(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){ti[n]=new Fi(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){ti[n]=new Fi(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){ti[n]=new Fi(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){ti[n]=new Fi(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){ti[n]=new Fi(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){ti[n]=new Fi(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){ti[n]=new Fi(n,5,!1,n.toLowerCase(),null,!1,!1)});var m2=/[\-:]([a-z])/g;function g2(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(m2,g2);ti[e]=new Fi(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(m2,g2);ti[e]=new Fi(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(m2,g2);ti[e]=new Fi(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){ti[n]=new Fi(n,1,!1,n.toLowerCase(),null,!1,!1)});ti.xlinkHref=new Fi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){ti[n]=new Fi(n,1,!1,n.toLowerCase(),null,!0,!0)});function y2(n,e,t,i){var r=ti.hasOwnProperty(e)?ti[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(H5(e,t,r,i)&&(t=null),i||r===null?B5(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):r.mustUseProperty?n[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,i=r.attributeNamespace,t===null?n.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,i?n.setAttributeNS(i,e,t):n.setAttribute(e,t))))}var Zo=V5.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Xv=Symbol.for("react.element"),Dh=Symbol.for("react.portal"),Mh=Symbol.for("react.fragment"),_2=Symbol.for("react.strict_mode"),gA=Symbol.for("react.profiler"),jO=Symbol.for("react.provider"),BO=Symbol.for("react.context"),v2=Symbol.for("react.forward_ref"),yA=Symbol.for("react.suspense"),_A=Symbol.for("react.suspense_list"),w2=Symbol.for("react.memo"),pl=Symbol.for("react.lazy"),UO=Symbol.for("react.offscreen"),Ek=Symbol.iterator;function wm(n){return n===null||typeof n!="object"?null:(n=Ek&&n[Ek]||n["@@iterator"],typeof n=="function"?n:null)}var Qt=Object.assign,Ex;function Wm(n){if(Ex===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Ex=e&&e[1]||""}return`
`+Ex+n}var Ax=!1;function Tx(n,e){if(!n||Ax)return"";Ax=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var i=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){i=u}n.call(e.prototype)}else{try{throw Error()}catch(u){i=u}n()}}catch(u){if(u&&i&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),s=i.stack.split(`
`),a=r.length-1,o=s.length-1;1<=a&&0<=o&&r[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==s[o]){if(a!==1||o!==1)do if(a--,o--,0>o||r[a]!==s[o]){var l=`
`+r[a].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=a&&0<=o);break}}}finally{Ax=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Wm(n):""}function W5(n){switch(n.tag){case 5:return Wm(n.type);case 16:return Wm("Lazy");case 13:return Wm("Suspense");case 19:return Wm("SuspenseList");case 0:case 2:case 15:return n=Tx(n.type,!1),n;case 11:return n=Tx(n.type.render,!1),n;case 1:return n=Tx(n.type,!0),n;default:return""}}function vA(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Mh:return"Fragment";case Dh:return"Portal";case gA:return"Profiler";case _2:return"StrictMode";case yA:return"Suspense";case _A:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case BO:return(n.displayName||"Context")+".Consumer";case jO:return(n._context.displayName||"Context")+".Provider";case v2:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case w2:return e=n.displayName||null,e!==null?e:vA(n.type)||"Memo";case pl:e=n._payload,n=n._init;try{return vA(n(e))}catch{}}return null}function q5(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return vA(e);case 8:return e===_2?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function mu(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function HO(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function G5(n){var e=HO(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),i=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return r.call(this)},set:function(a){i=""+a,s.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(a){i=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Qv(n){n._valueTracker||(n._valueTracker=G5(n))}function WO(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return n&&(i=HO(n)?n.checked?"true":"false":n.value),n=i,n!==t?(e.setValue(n),!0):!1}function V0(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function wA(n,e){var t=e.checked;return Qt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function Ak(n,e){var t=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;t=mu(e.value!=null?e.value:t),n._wrapperState={initialChecked:i,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function qO(n,e){e=e.checked,e!=null&&y2(n,"checked",e,!1)}function bA(n,e){qO(n,e);var t=mu(e.value),i=e.type;if(t!=null)i==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(i==="submit"||i==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?xA(n,e.type,t):e.hasOwnProperty("defaultValue")&&xA(n,e.type,mu(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Tk(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function xA(n,e,t){(e!=="number"||V0(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var qm=Array.isArray;function Qh(n,e,t,i){if(n=n.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<n.length;t++)r=e.hasOwnProperty("$"+n[t].value),n[t].selected!==r&&(n[t].selected=r),r&&i&&(n[t].defaultSelected=!0)}else{for(t=""+mu(t),e=null,r=0;r<n.length;r++){if(n[r].value===t){n[r].selected=!0,i&&(n[r].defaultSelected=!0);return}e!==null||n[r].disabled||(e=n[r])}e!==null&&(e.selected=!0)}}function EA(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(me(91));return Qt({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Sk(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(me(92));if(qm(t)){if(1<t.length)throw Error(me(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:mu(t)}}function GO(n,e){var t=mu(e.value),i=mu(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),i!=null&&(n.defaultValue=""+i)}function Ik(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function KO(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function AA(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?KO(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Jv,YO=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,i,r){MSApp.execUnsafeLocalFunction(function(){return n(e,t,i,r)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(Jv=Jv||document.createElement("div"),Jv.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Jv.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Wg(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Eg={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},K5=["Webkit","ms","Moz","O"];Object.keys(Eg).forEach(function(n){K5.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Eg[e]=Eg[n]})});function XO(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Eg.hasOwnProperty(n)&&Eg[n]?(""+e).trim():e+"px"}function QO(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var i=t.indexOf("--")===0,r=XO(t,e[t],i);t==="float"&&(t="cssFloat"),i?n.setProperty(t,r):n[t]=r}}var Y5=Qt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function TA(n,e){if(e){if(Y5[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(me(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(me(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(me(61))}if(e.style!=null&&typeof e.style!="object")throw Error(me(62))}}function SA(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var IA=null;function b2(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var CA=null,Jh=null,Zh=null;function Ck(n){if(n=Q_(n)){if(typeof CA!="function")throw Error(me(280));var e=n.stateNode;e&&(e=y1(e),CA(n.stateNode,n.type,e))}}function JO(n){Jh?Zh?Zh.push(n):Zh=[n]:Jh=n}function ZO(){if(Jh){var n=Jh,e=Zh;if(Zh=Jh=null,Ck(n),e)for(n=0;n<e.length;n++)Ck(e[n])}}function e3(n,e){return n(e)}function t3(){}var Sx=!1;function n3(n,e,t){if(Sx)return n(e,t);Sx=!0;try{return e3(n,e,t)}finally{Sx=!1,(Jh!==null||Zh!==null)&&(t3(),ZO())}}function qg(n,e){var t=n.stateNode;if(t===null)return null;var i=y1(t);if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(n=n.type,i=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!i;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(me(231,e,typeof t));return t}var kA=!1;if(Bo)try{var bm={};Object.defineProperty(bm,"passive",{get:function(){kA=!0}}),window.addEventListener("test",bm,bm),window.removeEventListener("test",bm,bm)}catch{kA=!1}function X5(n,e,t,i,r,s,a,o,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(c){this.onError(c)}}var Ag=!1,j0=null,B0=!1,$A=null,Q5={onError:function(n){Ag=!0,j0=n}};function J5(n,e,t,i,r,s,a,o,l){Ag=!1,j0=null,X5.apply(Q5,arguments)}function Z5(n,e,t,i,r,s,a,o,l){if(J5.apply(this,arguments),Ag){if(Ag){var u=j0;Ag=!1,j0=null}else throw Error(me(198));B0||(B0=!0,$A=u)}}function Xd(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function i3(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function kk(n){if(Xd(n)!==n)throw Error(me(188))}function e8(n){var e=n.alternate;if(!e){if(e=Xd(n),e===null)throw Error(me(188));return e!==n?null:n}for(var t=n,i=e;;){var r=t.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){t=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===t)return kk(r),n;if(s===i)return kk(r),e;s=s.sibling}throw Error(me(188))}if(t.return!==i.return)t=r,i=s;else{for(var a=!1,o=r.child;o;){if(o===t){a=!0,t=r,i=s;break}if(o===i){a=!0,i=r,t=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===t){a=!0,t=s,i=r;break}if(o===i){a=!0,i=s,t=r;break}o=o.sibling}if(!a)throw Error(me(189))}}if(t.alternate!==i)throw Error(me(190))}if(t.tag!==3)throw Error(me(188));return t.stateNode.current===t?n:e}function r3(n){return n=e8(n),n!==null?s3(n):null}function s3(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=s3(n);if(e!==null)return e;n=n.sibling}return null}var a3=Rr.unstable_scheduleCallback,$k=Rr.unstable_cancelCallback,t8=Rr.unstable_shouldYield,n8=Rr.unstable_requestPaint,ln=Rr.unstable_now,i8=Rr.unstable_getCurrentPriorityLevel,x2=Rr.unstable_ImmediatePriority,o3=Rr.unstable_UserBlockingPriority,U0=Rr.unstable_NormalPriority,r8=Rr.unstable_LowPriority,l3=Rr.unstable_IdlePriority,f1=null,ka=null;function s8(n){if(ka&&typeof ka.onCommitFiberRoot=="function")try{ka.onCommitFiberRoot(f1,n,void 0,(n.current.flags&128)===128)}catch{}}var Fs=Math.clz32?Math.clz32:l8,a8=Math.log,o8=Math.LN2;function l8(n){return n>>>=0,n===0?32:31-(a8(n)/o8|0)|0}var Zv=64,ew=4194304;function Gm(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function H0(n,e){var t=n.pendingLanes;if(t===0)return 0;var i=0,r=n.suspendedLanes,s=n.pingedLanes,a=t&268435455;if(a!==0){var o=a&~r;o!==0?i=Gm(o):(s&=a,s!==0&&(i=Gm(s)))}else a=t&~r,a!==0?i=Gm(a):s!==0&&(i=Gm(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=i;0<e;)t=31-Fs(e),r=1<<t,i|=n[t],e&=~r;return i}function u8(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function c8(n,e){for(var t=n.suspendedLanes,i=n.pingedLanes,r=n.expirationTimes,s=n.pendingLanes;0<s;){var a=31-Fs(s),o=1<<a,l=r[a];l===-1?(!(o&t)||o&i)&&(r[a]=u8(o,e)):l<=e&&(n.expiredLanes|=o),s&=~o}}function RA(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function u3(){var n=Zv;return Zv<<=1,!(Zv&4194240)&&(Zv=64),n}function Ix(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Y_(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Fs(e),n[e]=t}function d8(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var i=n.eventTimes;for(n=n.expirationTimes;0<t;){var r=31-Fs(t),s=1<<r;e[r]=0,i[r]=-1,n[r]=-1,t&=~s}}function E2(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var i=31-Fs(t),r=1<<i;r&e|n[i]&e&&(n[i]|=e),t&=~r}}var At=0;function c3(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var d3,A2,h3,f3,p3,PA=!1,tw=[],nu=null,iu=null,ru=null,Gg=new Map,Kg=new Map,gl=[],h8="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Rk(n,e){switch(n){case"focusin":case"focusout":nu=null;break;case"dragenter":case"dragleave":iu=null;break;case"mouseover":case"mouseout":ru=null;break;case"pointerover":case"pointerout":Gg.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Kg.delete(e.pointerId)}}function xm(n,e,t,i,r,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=Q_(e),e!==null&&A2(e)),n):(n.eventSystemFlags|=i,e=n.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),n)}function f8(n,e,t,i,r){switch(e){case"focusin":return nu=xm(nu,n,e,t,i,r),!0;case"dragenter":return iu=xm(iu,n,e,t,i,r),!0;case"mouseover":return ru=xm(ru,n,e,t,i,r),!0;case"pointerover":var s=r.pointerId;return Gg.set(s,xm(Gg.get(s)||null,n,e,t,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Kg.set(s,xm(Kg.get(s)||null,n,e,t,i,r)),!0}return!1}function m3(n){var e=yc(n.target);if(e!==null){var t=Xd(e);if(t!==null){if(e=t.tag,e===13){if(e=i3(t),e!==null){n.blockedOn=e,p3(n.priority,function(){h3(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Bw(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=NA(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var i=new t.constructor(t.type,t);IA=i,t.target.dispatchEvent(i),IA=null}else return e=Q_(t),e!==null&&A2(e),n.blockedOn=t,!1;e.shift()}return!0}function Pk(n,e,t){Bw(n)&&t.delete(e)}function p8(){PA=!1,nu!==null&&Bw(nu)&&(nu=null),iu!==null&&Bw(iu)&&(iu=null),ru!==null&&Bw(ru)&&(ru=null),Gg.forEach(Pk),Kg.forEach(Pk)}function Em(n,e){n.blockedOn===e&&(n.blockedOn=null,PA||(PA=!0,Rr.unstable_scheduleCallback(Rr.unstable_NormalPriority,p8)))}function Yg(n){function e(r){return Em(r,n)}if(0<tw.length){Em(tw[0],n);for(var t=1;t<tw.length;t++){var i=tw[t];i.blockedOn===n&&(i.blockedOn=null)}}for(nu!==null&&Em(nu,n),iu!==null&&Em(iu,n),ru!==null&&Em(ru,n),Gg.forEach(e),Kg.forEach(e),t=0;t<gl.length;t++)i=gl[t],i.blockedOn===n&&(i.blockedOn=null);for(;0<gl.length&&(t=gl[0],t.blockedOn===null);)m3(t),t.blockedOn===null&&gl.shift()}var ef=Zo.ReactCurrentBatchConfig,W0=!0;function m8(n,e,t,i){var r=At,s=ef.transition;ef.transition=null;try{At=1,T2(n,e,t,i)}finally{At=r,ef.transition=s}}function g8(n,e,t,i){var r=At,s=ef.transition;ef.transition=null;try{At=4,T2(n,e,t,i)}finally{At=r,ef.transition=s}}function T2(n,e,t,i){if(W0){var r=NA(n,e,t,i);if(r===null)Lx(n,e,i,q0,t),Rk(n,i);else if(f8(r,n,e,t,i))i.stopPropagation();else if(Rk(n,i),e&4&&-1<h8.indexOf(n)){for(;r!==null;){var s=Q_(r);if(s!==null&&d3(s),s=NA(n,e,t,i),s===null&&Lx(n,e,i,q0,t),s===r)break;r=s}r!==null&&i.stopPropagation()}else Lx(n,e,i,null,t)}}var q0=null;function NA(n,e,t,i){if(q0=null,n=b2(i),n=yc(n),n!==null)if(e=Xd(n),e===null)n=null;else if(t=e.tag,t===13){if(n=i3(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return q0=n,null}function g3(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(i8()){case x2:return 1;case o3:return 4;case U0:case r8:return 16;case l3:return 536870912;default:return 16}default:return 16}}var Zl=null,S2=null,Uw=null;function y3(){if(Uw)return Uw;var n,e=S2,t=e.length,i,r="value"in Zl?Zl.value:Zl.textContent,s=r.length;for(n=0;n<t&&e[n]===r[n];n++);var a=t-n;for(i=1;i<=a&&e[t-i]===r[s-i];i++);return Uw=r.slice(n,1<i?1-i:void 0)}function Hw(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function nw(){return!0}function Nk(){return!1}function Nr(n){function e(t,i,r,s,a){this._reactName=t,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],this[o]=t?t(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?nw:Nk,this.isPropagationStopped=Nk,this}return Qt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=nw)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=nw)},persist:function(){},isPersistent:nw}),e}var Mp={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},I2=Nr(Mp),X_=Qt({},Mp,{view:0,detail:0}),y8=Nr(X_),Cx,kx,Am,p1=Qt({},X_,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:C2,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Am&&(Am&&n.type==="mousemove"?(Cx=n.screenX-Am.screenX,kx=n.screenY-Am.screenY):kx=Cx=0,Am=n),Cx)},movementY:function(n){return"movementY"in n?n.movementY:kx}}),Dk=Nr(p1),_8=Qt({},p1,{dataTransfer:0}),v8=Nr(_8),w8=Qt({},X_,{relatedTarget:0}),$x=Nr(w8),b8=Qt({},Mp,{animationName:0,elapsedTime:0,pseudoElement:0}),x8=Nr(b8),E8=Qt({},Mp,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),A8=Nr(E8),T8=Qt({},Mp,{data:0}),Mk=Nr(T8),S8={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},I8={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},C8={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function k8(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=C8[n])?!!e[n]:!1}function C2(){return k8}var $8=Qt({},X_,{key:function(n){if(n.key){var e=S8[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Hw(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?I8[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:C2,charCode:function(n){return n.type==="keypress"?Hw(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Hw(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),R8=Nr($8),P8=Qt({},p1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ok=Nr(P8),N8=Qt({},X_,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:C2}),D8=Nr(N8),M8=Qt({},Mp,{propertyName:0,elapsedTime:0,pseudoElement:0}),O8=Nr(M8),L8=Qt({},p1,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),F8=Nr(L8),z8=[9,13,27,32],k2=Bo&&"CompositionEvent"in window,Tg=null;Bo&&"documentMode"in document&&(Tg=document.documentMode);var V8=Bo&&"TextEvent"in window&&!Tg,_3=Bo&&(!k2||Tg&&8<Tg&&11>=Tg),Lk=" ",Fk=!1;function v3(n,e){switch(n){case"keyup":return z8.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function w3(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Oh=!1;function j8(n,e){switch(n){case"compositionend":return w3(e);case"keypress":return e.which!==32?null:(Fk=!0,Lk);case"textInput":return n=e.data,n===Lk&&Fk?null:n;default:return null}}function B8(n,e){if(Oh)return n==="compositionend"||!k2&&v3(n,e)?(n=y3(),Uw=S2=Zl=null,Oh=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return _3&&e.locale!=="ko"?null:e.data;default:return null}}var U8={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function zk(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!U8[n.type]:e==="textarea"}function b3(n,e,t,i){JO(i),e=G0(e,"onChange"),0<e.length&&(t=new I2("onChange","change",null,t,i),n.push({event:t,listeners:e}))}var Sg=null,Xg=null;function H8(n){P3(n,0)}function m1(n){var e=zh(n);if(WO(e))return n}function W8(n,e){if(n==="change")return e}var x3=!1;if(Bo){var Rx;if(Bo){var Px="oninput"in document;if(!Px){var Vk=document.createElement("div");Vk.setAttribute("oninput","return;"),Px=typeof Vk.oninput=="function"}Rx=Px}else Rx=!1;x3=Rx&&(!document.documentMode||9<document.documentMode)}function jk(){Sg&&(Sg.detachEvent("onpropertychange",E3),Xg=Sg=null)}function E3(n){if(n.propertyName==="value"&&m1(Xg)){var e=[];b3(e,Xg,n,b2(n)),n3(H8,e)}}function q8(n,e,t){n==="focusin"?(jk(),Sg=e,Xg=t,Sg.attachEvent("onpropertychange",E3)):n==="focusout"&&jk()}function G8(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return m1(Xg)}function K8(n,e){if(n==="click")return m1(e)}function Y8(n,e){if(n==="input"||n==="change")return m1(e)}function X8(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Us=typeof Object.is=="function"?Object.is:X8;function Qg(n,e){if(Us(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var r=t[i];if(!mA.call(e,r)||!Us(n[r],e[r]))return!1}return!0}function Bk(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Uk(n,e){var t=Bk(n);n=0;for(var i;t;){if(t.nodeType===3){if(i=n+t.textContent.length,n<=e&&i>=e)return{node:t,offset:e-n};n=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Bk(t)}}function A3(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?A3(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function T3(){for(var n=window,e=V0();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=V0(n.document)}return e}function $2(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function Q8(n){var e=T3(),t=n.focusedElem,i=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&A3(t.ownerDocument.documentElement,t)){if(i!==null&&$2(t)){if(e=i.start,n=i.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var r=t.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!n.extend&&s>i&&(r=i,i=s,s=r),r=Uk(t,s);var a=Uk(t,i);r&&a&&(n.rangeCount!==1||n.anchorNode!==r.node||n.anchorOffset!==r.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),n.removeAllRanges(),s>i?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var J8=Bo&&"documentMode"in document&&11>=document.documentMode,Lh=null,DA=null,Ig=null,MA=!1;function Hk(n,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;MA||Lh==null||Lh!==V0(i)||(i=Lh,"selectionStart"in i&&$2(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Ig&&Qg(Ig,i)||(Ig=i,i=G0(DA,"onSelect"),0<i.length&&(e=new I2("onSelect","select",null,e,t),n.push({event:e,listeners:i}),e.target=Lh)))}function iw(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Fh={animationend:iw("Animation","AnimationEnd"),animationiteration:iw("Animation","AnimationIteration"),animationstart:iw("Animation","AnimationStart"),transitionend:iw("Transition","TransitionEnd")},Nx={},S3={};Bo&&(S3=document.createElement("div").style,"AnimationEvent"in window||(delete Fh.animationend.animation,delete Fh.animationiteration.animation,delete Fh.animationstart.animation),"TransitionEvent"in window||delete Fh.transitionend.transition);function g1(n){if(Nx[n])return Nx[n];if(!Fh[n])return n;var e=Fh[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in S3)return Nx[n]=e[t];return n}var I3=g1("animationend"),C3=g1("animationiteration"),k3=g1("animationstart"),$3=g1("transitionend"),R3=new Map,Wk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Cu(n,e){R3.set(n,e),Yd(e,[n])}for(var Dx=0;Dx<Wk.length;Dx++){var Mx=Wk[Dx],Z8=Mx.toLowerCase(),eH=Mx[0].toUpperCase()+Mx.slice(1);Cu(Z8,"on"+eH)}Cu(I3,"onAnimationEnd");Cu(C3,"onAnimationIteration");Cu(k3,"onAnimationStart");Cu("dblclick","onDoubleClick");Cu("focusin","onFocus");Cu("focusout","onBlur");Cu($3,"onTransitionEnd");yp("onMouseEnter",["mouseout","mouseover"]);yp("onMouseLeave",["mouseout","mouseover"]);yp("onPointerEnter",["pointerout","pointerover"]);yp("onPointerLeave",["pointerout","pointerover"]);Yd("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Yd("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Yd("onBeforeInput",["compositionend","keypress","textInput","paste"]);Yd("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Yd("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Yd("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Km="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),tH=new Set("cancel close invalid load scroll toggle".split(" ").concat(Km));function qk(n,e,t){var i=n.type||"unknown-event";n.currentTarget=t,Z5(i,e,void 0,n),n.currentTarget=null}function P3(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var i=n[t],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var a=i.length-1;0<=a;a--){var o=i[a],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==s&&r.isPropagationStopped())break e;qk(r,o,u),s=l}else for(a=0;a<i.length;a++){if(o=i[a],l=o.instance,u=o.currentTarget,o=o.listener,l!==s&&r.isPropagationStopped())break e;qk(r,o,u),s=l}}}if(B0)throw n=$A,B0=!1,$A=null,n}function Ot(n,e){var t=e[VA];t===void 0&&(t=e[VA]=new Set);var i=n+"__bubble";t.has(i)||(N3(e,n,2,!1),t.add(i))}function Ox(n,e,t){var i=0;e&&(i|=4),N3(t,n,i,e)}var rw="_reactListening"+Math.random().toString(36).slice(2);function Jg(n){if(!n[rw]){n[rw]=!0,VO.forEach(function(t){t!=="selectionchange"&&(tH.has(t)||Ox(t,!1,n),Ox(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[rw]||(e[rw]=!0,Ox("selectionchange",!1,e))}}function N3(n,e,t,i){switch(g3(e)){case 1:var r=m8;break;case 4:r=g8;break;default:r=T2}t=r.bind(null,e,t,n),r=void 0,!kA||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?n.addEventListener(e,t,{capture:!0,passive:r}):n.addEventListener(e,t,!0):r!==void 0?n.addEventListener(e,t,{passive:r}):n.addEventListener(e,t,!1)}function Lx(n,e,t,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var a=i.tag;if(a===3||a===4){var o=i.stateNode.containerInfo;if(o===r||o.nodeType===8&&o.parentNode===r)break;if(a===4)for(a=i.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;a=a.return}for(;o!==null;){if(a=yc(o),a===null)return;if(l=a.tag,l===5||l===6){i=s=a;continue e}o=o.parentNode}}i=i.return}n3(function(){var u=s,c=b2(t),h=[];e:{var f=R3.get(n);if(f!==void 0){var m=I2,y=n;switch(n){case"keypress":if(Hw(t)===0)break e;case"keydown":case"keyup":m=R8;break;case"focusin":y="focus",m=$x;break;case"focusout":y="blur",m=$x;break;case"beforeblur":case"afterblur":m=$x;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=Dk;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=v8;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=D8;break;case I3:case C3:case k3:m=x8;break;case $3:m=O8;break;case"scroll":m=y8;break;case"wheel":m=F8;break;case"copy":case"cut":case"paste":m=A8;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=Ok}var _=(e&4)!==0,x=!_&&n==="scroll",v=_?f!==null?f+"Capture":null:f;_=[];for(var w=u,E;w!==null;){E=w;var C=E.stateNode;if(E.tag===5&&C!==null&&(E=C,v!==null&&(C=qg(w,v),C!=null&&_.push(Zg(w,C,E)))),x)break;w=w.return}0<_.length&&(f=new m(f,y,null,t,c),h.push({event:f,listeners:_}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",m=n==="mouseout"||n==="pointerout",f&&t!==IA&&(y=t.relatedTarget||t.fromElement)&&(yc(y)||y[Uo]))break e;if((m||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,m?(y=t.relatedTarget||t.toElement,m=u,y=y?yc(y):null,y!==null&&(x=Xd(y),y!==x||y.tag!==5&&y.tag!==6)&&(y=null)):(m=null,y=u),m!==y)){if(_=Dk,C="onMouseLeave",v="onMouseEnter",w="mouse",(n==="pointerout"||n==="pointerover")&&(_=Ok,C="onPointerLeave",v="onPointerEnter",w="pointer"),x=m==null?f:zh(m),E=y==null?f:zh(y),f=new _(C,w+"leave",m,t,c),f.target=x,f.relatedTarget=E,C=null,yc(c)===u&&(_=new _(v,w+"enter",y,t,c),_.target=E,_.relatedTarget=x,C=_),x=C,m&&y)t:{for(_=m,v=y,w=0,E=_;E;E=wh(E))w++;for(E=0,C=v;C;C=wh(C))E++;for(;0<w-E;)_=wh(_),w--;for(;0<E-w;)v=wh(v),E--;for(;w--;){if(_===v||v!==null&&_===v.alternate)break t;_=wh(_),v=wh(v)}_=null}else _=null;m!==null&&Gk(h,f,m,_,!1),y!==null&&x!==null&&Gk(h,x,y,_,!0)}}e:{if(f=u?zh(u):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var D=W8;else if(zk(f))if(x3)D=Y8;else{D=G8;var V=q8}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(D=K8);if(D&&(D=D(n,u))){b3(h,D,t,c);break e}V&&V(n,f,u),n==="focusout"&&(V=f._wrapperState)&&V.controlled&&f.type==="number"&&xA(f,"number",f.value)}switch(V=u?zh(u):window,n){case"focusin":(zk(V)||V.contentEditable==="true")&&(Lh=V,DA=u,Ig=null);break;case"focusout":Ig=DA=Lh=null;break;case"mousedown":MA=!0;break;case"contextmenu":case"mouseup":case"dragend":MA=!1,Hk(h,t,c);break;case"selectionchange":if(J8)break;case"keydown":case"keyup":Hk(h,t,c)}var I;if(k2)e:{switch(n){case"compositionstart":var k="onCompositionStart";break e;case"compositionend":k="onCompositionEnd";break e;case"compositionupdate":k="onCompositionUpdate";break e}k=void 0}else Oh?v3(n,t)&&(k="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(k="onCompositionStart");k&&(_3&&t.locale!=="ko"&&(Oh||k!=="onCompositionStart"?k==="onCompositionEnd"&&Oh&&(I=y3()):(Zl=c,S2="value"in Zl?Zl.value:Zl.textContent,Oh=!0)),V=G0(u,k),0<V.length&&(k=new Mk(k,n,null,t,c),h.push({event:k,listeners:V}),I?k.data=I:(I=w3(t),I!==null&&(k.data=I)))),(I=V8?j8(n,t):B8(n,t))&&(u=G0(u,"onBeforeInput"),0<u.length&&(c=new Mk("onBeforeInput","beforeinput",null,t,c),h.push({event:c,listeners:u}),c.data=I))}P3(h,e)})}function Zg(n,e,t){return{instance:n,listener:e,currentTarget:t}}function G0(n,e){for(var t=e+"Capture",i=[];n!==null;){var r=n,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=qg(n,t),s!=null&&i.unshift(Zg(n,s,r)),s=qg(n,e),s!=null&&i.push(Zg(n,s,r))),n=n.return}return i}function wh(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Gk(n,e,t,i,r){for(var s=e._reactName,a=[];t!==null&&t!==i;){var o=t,l=o.alternate,u=o.stateNode;if(l!==null&&l===i)break;o.tag===5&&u!==null&&(o=u,r?(l=qg(t,s),l!=null&&a.unshift(Zg(t,l,o))):r||(l=qg(t,s),l!=null&&a.push(Zg(t,l,o)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var nH=/\r\n?/g,iH=/\u0000|\uFFFD/g;function Kk(n){return(typeof n=="string"?n:""+n).replace(nH,`
`).replace(iH,"")}function sw(n,e,t){if(e=Kk(e),Kk(n)!==e&&t)throw Error(me(425))}function K0(){}var OA=null,LA=null;function FA(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var zA=typeof setTimeout=="function"?setTimeout:void 0,rH=typeof clearTimeout=="function"?clearTimeout:void 0,Yk=typeof Promise=="function"?Promise:void 0,sH=typeof queueMicrotask=="function"?queueMicrotask:typeof Yk<"u"?function(n){return Yk.resolve(null).then(n).catch(aH)}:zA;function aH(n){setTimeout(function(){throw n})}function Fx(n,e){var t=e,i=0;do{var r=t.nextSibling;if(n.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(i===0){n.removeChild(r),Yg(e);return}i--}else t!=="$"&&t!=="$?"&&t!=="$!"||i++;t=r}while(t);Yg(e)}function su(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function Xk(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Op=Math.random().toString(36).slice(2),Ca="__reactFiber$"+Op,ey="__reactProps$"+Op,Uo="__reactContainer$"+Op,VA="__reactEvents$"+Op,oH="__reactListeners$"+Op,lH="__reactHandles$"+Op;function yc(n){var e=n[Ca];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Uo]||t[Ca]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=Xk(n);n!==null;){if(t=n[Ca])return t;n=Xk(n)}return e}n=t,t=n.parentNode}return null}function Q_(n){return n=n[Ca]||n[Uo],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function zh(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(me(33))}function y1(n){return n[ey]||null}var jA=[],Vh=-1;function ku(n){return{current:n}}function zt(n){0>Vh||(n.current=jA[Vh],jA[Vh]=null,Vh--)}function Mt(n,e){Vh++,jA[Vh]=n.current,n.current=e}var gu={},bi=ku(gu),tr=ku(!1),$d=gu;function _p(n,e){var t=n.type.contextTypes;if(!t)return gu;var i=n.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in t)r[s]=e[s];return i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=r),r}function nr(n){return n=n.childContextTypes,n!=null}function Y0(){zt(tr),zt(bi)}function Qk(n,e,t){if(bi.current!==gu)throw Error(me(168));Mt(bi,e),Mt(tr,t)}function D3(n,e,t){var i=n.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return t;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(me(108,q5(n)||"Unknown",r));return Qt({},t,i)}function X0(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||gu,$d=bi.current,Mt(bi,n),Mt(tr,tr.current),!0}function Jk(n,e,t){var i=n.stateNode;if(!i)throw Error(me(169));t?(n=D3(n,e,$d),i.__reactInternalMemoizedMergedChildContext=n,zt(tr),zt(bi),Mt(bi,n)):zt(tr),Mt(tr,t)}var ro=null,_1=!1,zx=!1;function M3(n){ro===null?ro=[n]:ro.push(n)}function uH(n){_1=!0,M3(n)}function $u(){if(!zx&&ro!==null){zx=!0;var n=0,e=At;try{var t=ro;for(At=1;n<t.length;n++){var i=t[n];do i=i(!0);while(i!==null)}ro=null,_1=!1}catch(r){throw ro!==null&&(ro=ro.slice(n+1)),a3(x2,$u),r}finally{At=e,zx=!1}}return null}var jh=[],Bh=0,Q0=null,J0=0,Wr=[],qr=0,Rd=null,No=1,Do="";function ac(n,e){jh[Bh++]=J0,jh[Bh++]=Q0,Q0=n,J0=e}function O3(n,e,t){Wr[qr++]=No,Wr[qr++]=Do,Wr[qr++]=Rd,Rd=n;var i=No;n=Do;var r=32-Fs(i)-1;i&=~(1<<r),t+=1;var s=32-Fs(e)+r;if(30<s){var a=r-r%5;s=(i&(1<<a)-1).toString(32),i>>=a,r-=a,No=1<<32-Fs(e)+r|t<<r|i,Do=s+n}else No=1<<s|t<<r|i,Do=n}function R2(n){n.return!==null&&(ac(n,1),O3(n,1,0))}function P2(n){for(;n===Q0;)Q0=jh[--Bh],jh[Bh]=null,J0=jh[--Bh],jh[Bh]=null;for(;n===Rd;)Rd=Wr[--qr],Wr[qr]=null,Do=Wr[--qr],Wr[qr]=null,No=Wr[--qr],Wr[qr]=null}var Cr=null,Sr=null,Ht=!1,Ps=null;function L3(n,e){var t=Xr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function Zk(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Cr=n,Sr=su(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Cr=n,Sr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Rd!==null?{id:No,overflow:Do}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Xr(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Cr=n,Sr=null,!0):!1;default:return!1}}function BA(n){return(n.mode&1)!==0&&(n.flags&128)===0}function UA(n){if(Ht){var e=Sr;if(e){var t=e;if(!Zk(n,e)){if(BA(n))throw Error(me(418));e=su(t.nextSibling);var i=Cr;e&&Zk(n,e)?L3(i,t):(n.flags=n.flags&-4097|2,Ht=!1,Cr=n)}}else{if(BA(n))throw Error(me(418));n.flags=n.flags&-4097|2,Ht=!1,Cr=n}}}function e$(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Cr=n}function aw(n){if(n!==Cr)return!1;if(!Ht)return e$(n),Ht=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!FA(n.type,n.memoizedProps)),e&&(e=Sr)){if(BA(n))throw F3(),Error(me(418));for(;e;)L3(n,e),e=su(e.nextSibling)}if(e$(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(me(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Sr=su(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Sr=null}}else Sr=Cr?su(n.stateNode.nextSibling):null;return!0}function F3(){for(var n=Sr;n;)n=su(n.nextSibling)}function vp(){Sr=Cr=null,Ht=!1}function N2(n){Ps===null?Ps=[n]:Ps.push(n)}var cH=Zo.ReactCurrentBatchConfig;function Tm(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(me(309));var i=t.stateNode}if(!i)throw Error(me(147,n));var r=i,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(a){var o=r.refs;a===null?delete o[s]:o[s]=a},e._stringRef=s,e)}if(typeof n!="string")throw Error(me(284));if(!t._owner)throw Error(me(290,n))}return n}function ow(n,e){throw n=Object.prototype.toString.call(e),Error(me(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function t$(n){var e=n._init;return e(n._payload)}function z3(n){function e(v,w){if(n){var E=v.deletions;E===null?(v.deletions=[w],v.flags|=16):E.push(w)}}function t(v,w){if(!n)return null;for(;w!==null;)e(v,w),w=w.sibling;return null}function i(v,w){for(v=new Map;w!==null;)w.key!==null?v.set(w.key,w):v.set(w.index,w),w=w.sibling;return v}function r(v,w){return v=uu(v,w),v.index=0,v.sibling=null,v}function s(v,w,E){return v.index=E,n?(E=v.alternate,E!==null?(E=E.index,E<w?(v.flags|=2,w):E):(v.flags|=2,w)):(v.flags|=1048576,w)}function a(v){return n&&v.alternate===null&&(v.flags|=2),v}function o(v,w,E,C){return w===null||w.tag!==6?(w=qx(E,v.mode,C),w.return=v,w):(w=r(w,E),w.return=v,w)}function l(v,w,E,C){var D=E.type;return D===Mh?c(v,w,E.props.children,C,E.key):w!==null&&(w.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===pl&&t$(D)===w.type)?(C=r(w,E.props),C.ref=Tm(v,w,E),C.return=v,C):(C=Qw(E.type,E.key,E.props,null,v.mode,C),C.ref=Tm(v,w,E),C.return=v,C)}function u(v,w,E,C){return w===null||w.tag!==4||w.stateNode.containerInfo!==E.containerInfo||w.stateNode.implementation!==E.implementation?(w=Gx(E,v.mode,C),w.return=v,w):(w=r(w,E.children||[]),w.return=v,w)}function c(v,w,E,C,D){return w===null||w.tag!==7?(w=Sd(E,v.mode,C,D),w.return=v,w):(w=r(w,E),w.return=v,w)}function h(v,w,E){if(typeof w=="string"&&w!==""||typeof w=="number")return w=qx(""+w,v.mode,E),w.return=v,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Xv:return E=Qw(w.type,w.key,w.props,null,v.mode,E),E.ref=Tm(v,null,w),E.return=v,E;case Dh:return w=Gx(w,v.mode,E),w.return=v,w;case pl:var C=w._init;return h(v,C(w._payload),E)}if(qm(w)||wm(w))return w=Sd(w,v.mode,E,null),w.return=v,w;ow(v,w)}return null}function f(v,w,E,C){var D=w!==null?w.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return D!==null?null:o(v,w,""+E,C);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case Xv:return E.key===D?l(v,w,E,C):null;case Dh:return E.key===D?u(v,w,E,C):null;case pl:return D=E._init,f(v,w,D(E._payload),C)}if(qm(E)||wm(E))return D!==null?null:c(v,w,E,C,null);ow(v,E)}return null}function m(v,w,E,C,D){if(typeof C=="string"&&C!==""||typeof C=="number")return v=v.get(E)||null,o(w,v,""+C,D);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case Xv:return v=v.get(C.key===null?E:C.key)||null,l(w,v,C,D);case Dh:return v=v.get(C.key===null?E:C.key)||null,u(w,v,C,D);case pl:var V=C._init;return m(v,w,E,V(C._payload),D)}if(qm(C)||wm(C))return v=v.get(E)||null,c(w,v,C,D,null);ow(w,C)}return null}function y(v,w,E,C){for(var D=null,V=null,I=w,k=w=0,N=null;I!==null&&k<E.length;k++){I.index>k?(N=I,I=null):N=I.sibling;var L=f(v,I,E[k],C);if(L===null){I===null&&(I=N);break}n&&I&&L.alternate===null&&e(v,I),w=s(L,w,k),V===null?D=L:V.sibling=L,V=L,I=N}if(k===E.length)return t(v,I),Ht&&ac(v,k),D;if(I===null){for(;k<E.length;k++)I=h(v,E[k],C),I!==null&&(w=s(I,w,k),V===null?D=I:V.sibling=I,V=I);return Ht&&ac(v,k),D}for(I=i(v,I);k<E.length;k++)N=m(I,v,k,E[k],C),N!==null&&(n&&N.alternate!==null&&I.delete(N.key===null?k:N.key),w=s(N,w,k),V===null?D=N:V.sibling=N,V=N);return n&&I.forEach(function(j){return e(v,j)}),Ht&&ac(v,k),D}function _(v,w,E,C){var D=wm(E);if(typeof D!="function")throw Error(me(150));if(E=D.call(E),E==null)throw Error(me(151));for(var V=D=null,I=w,k=w=0,N=null,L=E.next();I!==null&&!L.done;k++,L=E.next()){I.index>k?(N=I,I=null):N=I.sibling;var j=f(v,I,L.value,C);if(j===null){I===null&&(I=N);break}n&&I&&j.alternate===null&&e(v,I),w=s(j,w,k),V===null?D=j:V.sibling=j,V=j,I=N}if(L.done)return t(v,I),Ht&&ac(v,k),D;if(I===null){for(;!L.done;k++,L=E.next())L=h(v,L.value,C),L!==null&&(w=s(L,w,k),V===null?D=L:V.sibling=L,V=L);return Ht&&ac(v,k),D}for(I=i(v,I);!L.done;k++,L=E.next())L=m(I,v,k,L.value,C),L!==null&&(n&&L.alternate!==null&&I.delete(L.key===null?k:L.key),w=s(L,w,k),V===null?D=L:V.sibling=L,V=L);return n&&I.forEach(function(H){return e(v,H)}),Ht&&ac(v,k),D}function x(v,w,E,C){if(typeof E=="object"&&E!==null&&E.type===Mh&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case Xv:e:{for(var D=E.key,V=w;V!==null;){if(V.key===D){if(D=E.type,D===Mh){if(V.tag===7){t(v,V.sibling),w=r(V,E.props.children),w.return=v,v=w;break e}}else if(V.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===pl&&t$(D)===V.type){t(v,V.sibling),w=r(V,E.props),w.ref=Tm(v,V,E),w.return=v,v=w;break e}t(v,V);break}else e(v,V);V=V.sibling}E.type===Mh?(w=Sd(E.props.children,v.mode,C,E.key),w.return=v,v=w):(C=Qw(E.type,E.key,E.props,null,v.mode,C),C.ref=Tm(v,w,E),C.return=v,v=C)}return a(v);case Dh:e:{for(V=E.key;w!==null;){if(w.key===V)if(w.tag===4&&w.stateNode.containerInfo===E.containerInfo&&w.stateNode.implementation===E.implementation){t(v,w.sibling),w=r(w,E.children||[]),w.return=v,v=w;break e}else{t(v,w);break}else e(v,w);w=w.sibling}w=Gx(E,v.mode,C),w.return=v,v=w}return a(v);case pl:return V=E._init,x(v,w,V(E._payload),C)}if(qm(E))return y(v,w,E,C);if(wm(E))return _(v,w,E,C);ow(v,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,w!==null&&w.tag===6?(t(v,w.sibling),w=r(w,E),w.return=v,v=w):(t(v,w),w=qx(E,v.mode,C),w.return=v,v=w),a(v)):t(v,w)}return x}var wp=z3(!0),V3=z3(!1),Z0=ku(null),eb=null,Uh=null,D2=null;function M2(){D2=Uh=eb=null}function O2(n){var e=Z0.current;zt(Z0),n._currentValue=e}function HA(n,e,t){for(;n!==null;){var i=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),n===t)break;n=n.return}}function tf(n,e){eb=n,D2=Uh=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(er=!0),n.firstContext=null)}function Zr(n){var e=n._currentValue;if(D2!==n)if(n={context:n,memoizedValue:e,next:null},Uh===null){if(eb===null)throw Error(me(308));Uh=n,eb.dependencies={lanes:0,firstContext:n}}else Uh=Uh.next=n;return e}var _c=null;function L2(n){_c===null?_c=[n]:_c.push(n)}function j3(n,e,t,i){var r=e.interleaved;return r===null?(t.next=t,L2(e)):(t.next=r.next,r.next=t),e.interleaved=t,Ho(n,i)}function Ho(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var ml=!1;function F2(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function B3(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Lo(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function au(n,e,t){var i=n.updateQueue;if(i===null)return null;if(i=i.shared,ct&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Ho(n,t)}return r=i.interleaved,r===null?(e.next=e,L2(i)):(e.next=r.next,r.next=e),i.interleaved=e,Ho(n,t)}function Ww(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,E2(n,t)}}function n$(n,e){var t=n.updateQueue,i=n.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var r=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?r=s=a:s=s.next=a,t=t.next}while(t!==null);s===null?r=s=e:s=s.next=e}else r=s=e;t={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function tb(n,e,t,i){var r=n.updateQueue;ml=!1;var s=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(o!==null){r.shared.pending=null;var l=o,u=l.next;l.next=null,a===null?s=u:a.next=u,a=l;var c=n.alternate;c!==null&&(c=c.updateQueue,o=c.lastBaseUpdate,o!==a&&(o===null?c.firstBaseUpdate=u:o.next=u,c.lastBaseUpdate=l))}if(s!==null){var h=r.baseState;a=0,c=u=l=null,o=s;do{var f=o.lane,m=o.eventTime;if((i&f)===f){c!==null&&(c=c.next={eventTime:m,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var y=n,_=o;switch(f=e,m=t,_.tag){case 1:if(y=_.payload,typeof y=="function"){h=y.call(m,h,f);break e}h=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=_.payload,f=typeof y=="function"?y.call(m,h,f):y,f==null)break e;h=Qt({},h,f);break e;case 2:ml=!0}}o.callback!==null&&o.lane!==0&&(n.flags|=64,f=r.effects,f===null?r.effects=[o]:f.push(o))}else m={eventTime:m,lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},c===null?(u=c=m,l=h):c=c.next=m,a|=f;if(o=o.next,o===null){if(o=r.shared.pending,o===null)break;f=o,o=f.next,f.next=null,r.lastBaseUpdate=f,r.shared.pending=null}}while(!0);if(c===null&&(l=h),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=c,e=r.shared.interleaved,e!==null){r=e;do a|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);Nd|=a,n.lanes=a,n.memoizedState=h}}function i$(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var i=n[e],r=i.callback;if(r!==null){if(i.callback=null,i=t,typeof r!="function")throw Error(me(191,r));r.call(i)}}}var J_={},$a=ku(J_),ty=ku(J_),ny=ku(J_);function vc(n){if(n===J_)throw Error(me(174));return n}function z2(n,e){switch(Mt(ny,e),Mt(ty,n),Mt($a,J_),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:AA(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=AA(e,n)}zt($a),Mt($a,e)}function bp(){zt($a),zt(ty),zt(ny)}function U3(n){vc(ny.current);var e=vc($a.current),t=AA(e,n.type);e!==t&&(Mt(ty,n),Mt($a,t))}function V2(n){ty.current===n&&(zt($a),zt(ty))}var Kt=ku(0);function nb(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Vx=[];function j2(){for(var n=0;n<Vx.length;n++)Vx[n]._workInProgressVersionPrimary=null;Vx.length=0}var qw=Zo.ReactCurrentDispatcher,jx=Zo.ReactCurrentBatchConfig,Pd=0,Xt=null,Sn=null,Un=null,ib=!1,Cg=!1,iy=0,dH=0;function si(){throw Error(me(321))}function B2(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Us(n[t],e[t]))return!1;return!0}function U2(n,e,t,i,r,s){if(Pd=s,Xt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,qw.current=n===null||n.memoizedState===null?mH:gH,n=t(i,r),Cg){s=0;do{if(Cg=!1,iy=0,25<=s)throw Error(me(301));s+=1,Un=Sn=null,e.updateQueue=null,qw.current=yH,n=t(i,r)}while(Cg)}if(qw.current=rb,e=Sn!==null&&Sn.next!==null,Pd=0,Un=Sn=Xt=null,ib=!1,e)throw Error(me(300));return n}function H2(){var n=iy!==0;return iy=0,n}function ua(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Un===null?Xt.memoizedState=Un=n:Un=Un.next=n,Un}function es(){if(Sn===null){var n=Xt.alternate;n=n!==null?n.memoizedState:null}else n=Sn.next;var e=Un===null?Xt.memoizedState:Un.next;if(e!==null)Un=e,Sn=n;else{if(n===null)throw Error(me(310));Sn=n,n={memoizedState:Sn.memoizedState,baseState:Sn.baseState,baseQueue:Sn.baseQueue,queue:Sn.queue,next:null},Un===null?Xt.memoizedState=Un=n:Un=Un.next=n}return Un}function ry(n,e){return typeof e=="function"?e(n):e}function Bx(n){var e=es(),t=e.queue;if(t===null)throw Error(me(311));t.lastRenderedReducer=n;var i=Sn,r=i.baseQueue,s=t.pending;if(s!==null){if(r!==null){var a=r.next;r.next=s.next,s.next=a}i.baseQueue=r=s,t.pending=null}if(r!==null){s=r.next,i=i.baseState;var o=a=null,l=null,u=s;do{var c=u.lane;if((Pd&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:n(i,u.action);else{var h={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(o=l=h,a=i):l=l.next=h,Xt.lanes|=c,Nd|=c}u=u.next}while(u!==null&&u!==s);l===null?a=i:l.next=o,Us(i,e.memoizedState)||(er=!0),e.memoizedState=i,e.baseState=a,e.baseQueue=l,t.lastRenderedState=i}if(n=t.interleaved,n!==null){r=n;do s=r.lane,Xt.lanes|=s,Nd|=s,r=r.next;while(r!==n)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Ux(n){var e=es(),t=e.queue;if(t===null)throw Error(me(311));t.lastRenderedReducer=n;var i=t.dispatch,r=t.pending,s=e.memoizedState;if(r!==null){t.pending=null;var a=r=r.next;do s=n(s,a.action),a=a.next;while(a!==r);Us(s,e.memoizedState)||(er=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,i]}function H3(){}function W3(n,e){var t=Xt,i=es(),r=e(),s=!Us(i.memoizedState,r);if(s&&(i.memoizedState=r,er=!0),i=i.queue,W2(K3.bind(null,t,i,n),[n]),i.getSnapshot!==e||s||Un!==null&&Un.memoizedState.tag&1){if(t.flags|=2048,sy(9,G3.bind(null,t,i,r,e),void 0,null),Hn===null)throw Error(me(349));Pd&30||q3(t,e,r)}return r}function q3(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Xt.updateQueue,e===null?(e={lastEffect:null,stores:null},Xt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function G3(n,e,t,i){e.value=t,e.getSnapshot=i,Y3(e)&&X3(n)}function K3(n,e,t){return t(function(){Y3(e)&&X3(n)})}function Y3(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Us(n,t)}catch{return!0}}function X3(n){var e=Ho(n,1);e!==null&&zs(e,n,1,-1)}function r$(n){var e=ua();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ry,lastRenderedState:n},e.queue=n,n=n.dispatch=pH.bind(null,Xt,n),[e.memoizedState,n]}function sy(n,e,t,i){return n={tag:n,create:e,destroy:t,deps:i,next:null},e=Xt.updateQueue,e===null?(e={lastEffect:null,stores:null},Xt.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(i=t.next,t.next=n,n.next=i,e.lastEffect=n)),n}function Q3(){return es().memoizedState}function Gw(n,e,t,i){var r=ua();Xt.flags|=n,r.memoizedState=sy(1|e,t,void 0,i===void 0?null:i)}function v1(n,e,t,i){var r=es();i=i===void 0?null:i;var s=void 0;if(Sn!==null){var a=Sn.memoizedState;if(s=a.destroy,i!==null&&B2(i,a.deps)){r.memoizedState=sy(e,t,s,i);return}}Xt.flags|=n,r.memoizedState=sy(1|e,t,s,i)}function s$(n,e){return Gw(8390656,8,n,e)}function W2(n,e){return v1(2048,8,n,e)}function J3(n,e){return v1(4,2,n,e)}function Z3(n,e){return v1(4,4,n,e)}function eL(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function tL(n,e,t){return t=t!=null?t.concat([n]):null,v1(4,4,eL.bind(null,e,n),t)}function q2(){}function nL(n,e){var t=es();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&B2(e,i[1])?i[0]:(t.memoizedState=[n,e],n)}function iL(n,e){var t=es();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&B2(e,i[1])?i[0]:(n=n(),t.memoizedState=[n,e],n)}function rL(n,e,t){return Pd&21?(Us(t,e)||(t=u3(),Xt.lanes|=t,Nd|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,er=!0),n.memoizedState=t)}function hH(n,e){var t=At;At=t!==0&&4>t?t:4,n(!0);var i=jx.transition;jx.transition={};try{n(!1),e()}finally{At=t,jx.transition=i}}function sL(){return es().memoizedState}function fH(n,e,t){var i=lu(n);if(t={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null},aL(n))oL(e,t);else if(t=j3(n,e,t,i),t!==null){var r=Ni();zs(t,n,i,r),lL(t,e,i)}}function pH(n,e,t){var i=lu(n),r={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null};if(aL(n))oL(e,r);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var a=e.lastRenderedState,o=s(a,t);if(r.hasEagerState=!0,r.eagerState=o,Us(o,a)){var l=e.interleaved;l===null?(r.next=r,L2(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}t=j3(n,e,r,i),t!==null&&(r=Ni(),zs(t,n,i,r),lL(t,e,i))}}function aL(n){var e=n.alternate;return n===Xt||e!==null&&e===Xt}function oL(n,e){Cg=ib=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function lL(n,e,t){if(t&4194240){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,E2(n,t)}}var rb={readContext:Zr,useCallback:si,useContext:si,useEffect:si,useImperativeHandle:si,useInsertionEffect:si,useLayoutEffect:si,useMemo:si,useReducer:si,useRef:si,useState:si,useDebugValue:si,useDeferredValue:si,useTransition:si,useMutableSource:si,useSyncExternalStore:si,useId:si,unstable_isNewReconciler:!1},mH={readContext:Zr,useCallback:function(n,e){return ua().memoizedState=[n,e===void 0?null:e],n},useContext:Zr,useEffect:s$,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Gw(4194308,4,eL.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Gw(4194308,4,n,e)},useInsertionEffect:function(n,e){return Gw(4,2,n,e)},useMemo:function(n,e){var t=ua();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var i=ua();return e=t!==void 0?t(e):e,i.memoizedState=i.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},i.queue=n,n=n.dispatch=fH.bind(null,Xt,n),[i.memoizedState,n]},useRef:function(n){var e=ua();return n={current:n},e.memoizedState=n},useState:r$,useDebugValue:q2,useDeferredValue:function(n){return ua().memoizedState=n},useTransition:function(){var n=r$(!1),e=n[0];return n=hH.bind(null,n[1]),ua().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var i=Xt,r=ua();if(Ht){if(t===void 0)throw Error(me(407));t=t()}else{if(t=e(),Hn===null)throw Error(me(349));Pd&30||q3(i,e,t)}r.memoizedState=t;var s={value:t,getSnapshot:e};return r.queue=s,s$(K3.bind(null,i,s,n),[n]),i.flags|=2048,sy(9,G3.bind(null,i,s,t,e),void 0,null),t},useId:function(){var n=ua(),e=Hn.identifierPrefix;if(Ht){var t=Do,i=No;t=(i&~(1<<32-Fs(i)-1)).toString(32)+t,e=":"+e+"R"+t,t=iy++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=dH++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},gH={readContext:Zr,useCallback:nL,useContext:Zr,useEffect:W2,useImperativeHandle:tL,useInsertionEffect:J3,useLayoutEffect:Z3,useMemo:iL,useReducer:Bx,useRef:Q3,useState:function(){return Bx(ry)},useDebugValue:q2,useDeferredValue:function(n){var e=es();return rL(e,Sn.memoizedState,n)},useTransition:function(){var n=Bx(ry)[0],e=es().memoizedState;return[n,e]},useMutableSource:H3,useSyncExternalStore:W3,useId:sL,unstable_isNewReconciler:!1},yH={readContext:Zr,useCallback:nL,useContext:Zr,useEffect:W2,useImperativeHandle:tL,useInsertionEffect:J3,useLayoutEffect:Z3,useMemo:iL,useReducer:Ux,useRef:Q3,useState:function(){return Ux(ry)},useDebugValue:q2,useDeferredValue:function(n){var e=es();return Sn===null?e.memoizedState=n:rL(e,Sn.memoizedState,n)},useTransition:function(){var n=Ux(ry)[0],e=es().memoizedState;return[n,e]},useMutableSource:H3,useSyncExternalStore:W3,useId:sL,unstable_isNewReconciler:!1};function ys(n,e){if(n&&n.defaultProps){e=Qt({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function WA(n,e,t,i){e=n.memoizedState,t=t(i,e),t=t==null?e:Qt({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var w1={isMounted:function(n){return(n=n._reactInternals)?Xd(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var i=Ni(),r=lu(n),s=Lo(i,r);s.payload=e,t!=null&&(s.callback=t),e=au(n,s,r),e!==null&&(zs(e,n,r,i),Ww(e,n,r))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var i=Ni(),r=lu(n),s=Lo(i,r);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=au(n,s,r),e!==null&&(zs(e,n,r,i),Ww(e,n,r))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Ni(),i=lu(n),r=Lo(t,i);r.tag=2,e!=null&&(r.callback=e),e=au(n,r,i),e!==null&&(zs(e,n,i,t),Ww(e,n,i))}};function a$(n,e,t,i,r,s,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(i,s,a):e.prototype&&e.prototype.isPureReactComponent?!Qg(t,i)||!Qg(r,s):!0}function uL(n,e,t){var i=!1,r=gu,s=e.contextType;return typeof s=="object"&&s!==null?s=Zr(s):(r=nr(e)?$d:bi.current,i=e.contextTypes,s=(i=i!=null)?_p(n,r):gu),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=w1,n.stateNode=e,e._reactInternals=n,i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=s),e}function o$(n,e,t,i){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==n&&w1.enqueueReplaceState(e,e.state,null)}function qA(n,e,t,i){var r=n.stateNode;r.props=t,r.state=n.memoizedState,r.refs={},F2(n);var s=e.contextType;typeof s=="object"&&s!==null?r.context=Zr(s):(s=nr(e)?$d:bi.current,r.context=_p(n,s)),r.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(WA(n,e,s,t),r.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&w1.enqueueReplaceState(r,r.state,null),tb(n,t,r,i),r.state=n.memoizedState),typeof r.componentDidMount=="function"&&(n.flags|=4194308)}function xp(n,e){try{var t="",i=e;do t+=W5(i),i=i.return;while(i);var r=t}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:r,digest:null}}function Hx(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function GA(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var _H=typeof WeakMap=="function"?WeakMap:Map;function cL(n,e,t){t=Lo(-1,t),t.tag=3,t.payload={element:null};var i=e.value;return t.callback=function(){ab||(ab=!0,iT=i),GA(n,e)},t}function dL(n,e,t){t=Lo(-1,t),t.tag=3;var i=n.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;t.payload=function(){return i(r)},t.callback=function(){GA(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){GA(n,e),typeof i!="function"&&(ou===null?ou=new Set([this]):ou.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function l$(n,e,t){var i=n.pingCache;if(i===null){i=n.pingCache=new _H;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(t)||(r.add(t),n=PH.bind(null,n,e,t),e.then(n,n))}function u$(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function c$(n,e,t,i,r){return n.mode&1?(n.flags|=65536,n.lanes=r,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Lo(-1,1),e.tag=2,au(t,e,1))),t.lanes|=1),n)}var vH=Zo.ReactCurrentOwner,er=!1;function Pi(n,e,t,i){e.child=n===null?V3(e,null,t,i):wp(e,n.child,t,i)}function d$(n,e,t,i,r){t=t.render;var s=e.ref;return tf(e,r),i=U2(n,e,t,i,s,r),t=H2(),n!==null&&!er?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,Wo(n,e,r)):(Ht&&t&&R2(e),e.flags|=1,Pi(n,e,i,r),e.child)}function h$(n,e,t,i,r){if(n===null){var s=t.type;return typeof s=="function"&&!eI(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,hL(n,e,s,i,r)):(n=Qw(t.type,null,i,e,e.mode,r),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&r)){var a=s.memoizedProps;if(t=t.compare,t=t!==null?t:Qg,t(a,i)&&n.ref===e.ref)return Wo(n,e,r)}return e.flags|=1,n=uu(s,i),n.ref=e.ref,n.return=e,e.child=n}function hL(n,e,t,i,r){if(n!==null){var s=n.memoizedProps;if(Qg(s,i)&&n.ref===e.ref)if(er=!1,e.pendingProps=i=s,(n.lanes&r)!==0)n.flags&131072&&(er=!0);else return e.lanes=n.lanes,Wo(n,e,r)}return KA(n,e,t,i,r)}function fL(n,e,t){var i=e.pendingProps,r=i.children,s=n!==null?n.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Mt(Wh,br),br|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Mt(Wh,br),br|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:t,Mt(Wh,br),br|=i}else s!==null?(i=s.baseLanes|t,e.memoizedState=null):i=t,Mt(Wh,br),br|=i;return Pi(n,e,r,t),e.child}function pL(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function KA(n,e,t,i,r){var s=nr(t)?$d:bi.current;return s=_p(e,s),tf(e,r),t=U2(n,e,t,i,s,r),i=H2(),n!==null&&!er?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,Wo(n,e,r)):(Ht&&i&&R2(e),e.flags|=1,Pi(n,e,t,r),e.child)}function f$(n,e,t,i,r){if(nr(t)){var s=!0;X0(e)}else s=!1;if(tf(e,r),e.stateNode===null)Kw(n,e),uL(e,t,i),qA(e,t,i,r),i=!0;else if(n===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,u=t.contextType;typeof u=="object"&&u!==null?u=Zr(u):(u=nr(t)?$d:bi.current,u=_p(e,u));var c=t.getDerivedStateFromProps,h=typeof c=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==i||l!==u)&&o$(e,a,i,u),ml=!1;var f=e.memoizedState;a.state=f,tb(e,i,a,r),l=e.memoizedState,o!==i||f!==l||tr.current||ml?(typeof c=="function"&&(WA(e,t,c,i),l=e.memoizedState),(o=ml||a$(e,t,o,i,f,l,u))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),a.props=i,a.state=l,a.context=u,i=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{a=e.stateNode,B3(n,e),o=e.memoizedProps,u=e.type===e.elementType?o:ys(e.type,o),a.props=u,h=e.pendingProps,f=a.context,l=t.contextType,typeof l=="object"&&l!==null?l=Zr(l):(l=nr(t)?$d:bi.current,l=_p(e,l));var m=t.getDerivedStateFromProps;(c=typeof m=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==h||f!==l)&&o$(e,a,i,l),ml=!1,f=e.memoizedState,a.state=f,tb(e,i,a,r);var y=e.memoizedState;o!==h||f!==y||tr.current||ml?(typeof m=="function"&&(WA(e,t,m,i),y=e.memoizedState),(u=ml||a$(e,t,u,i,f,y,l)||!1)?(c||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(i,y,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(i,y,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=y),a.props=i,a.state=y,a.context=l,i=u):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),i=!1)}return YA(n,e,t,i,s,r)}function YA(n,e,t,i,r,s){pL(n,e);var a=(e.flags&128)!==0;if(!i&&!a)return r&&Jk(e,t,!1),Wo(n,e,s);i=e.stateNode,vH.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,n!==null&&a?(e.child=wp(e,n.child,null,s),e.child=wp(e,null,o,s)):Pi(n,e,o,s),e.memoizedState=i.state,r&&Jk(e,t,!0),e.child}function mL(n){var e=n.stateNode;e.pendingContext?Qk(n,e.pendingContext,e.pendingContext!==e.context):e.context&&Qk(n,e.context,!1),z2(n,e.containerInfo)}function p$(n,e,t,i,r){return vp(),N2(r),e.flags|=256,Pi(n,e,t,i),e.child}var XA={dehydrated:null,treeContext:null,retryLane:0};function QA(n){return{baseLanes:n,cachePool:null,transitions:null}}function gL(n,e,t){var i=e.pendingProps,r=Kt.current,s=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=n!==null&&n.memoizedState===null?!1:(r&2)!==0),o?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(r|=1),Mt(Kt,r&1),n===null)return UA(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=i.children,n=i.fallback,s?(i=e.mode,s=e.child,a={mode:"hidden",children:a},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=E1(a,i,0,null),n=Sd(n,i,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=QA(t),e.memoizedState=XA,n):G2(e,a));if(r=n.memoizedState,r!==null&&(o=r.dehydrated,o!==null))return wH(n,e,a,i,o,r,t);if(s){s=i.fallback,a=e.mode,r=n.child,o=r.sibling;var l={mode:"hidden",children:i.children};return!(a&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=uu(r,l),i.subtreeFlags=r.subtreeFlags&14680064),o!==null?s=uu(o,s):(s=Sd(s,a,t,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,a=n.child.memoizedState,a=a===null?QA(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=n.childLanes&~t,e.memoizedState=XA,i}return s=n.child,n=s.sibling,i=uu(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=t),i.return=e,i.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=i,e.memoizedState=null,i}function G2(n,e){return e=E1({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function lw(n,e,t,i){return i!==null&&N2(i),wp(e,n.child,null,t),n=G2(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function wH(n,e,t,i,r,s,a){if(t)return e.flags&256?(e.flags&=-257,i=Hx(Error(me(422))),lw(n,e,a,i)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=E1({mode:"visible",children:i.children},r,0,null),s=Sd(s,r,a,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&wp(e,n.child,null,a),e.child.memoizedState=QA(a),e.memoizedState=XA,s);if(!(e.mode&1))return lw(n,e,a,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var o=i.dgst;return i=o,s=Error(me(419)),i=Hx(s,i,void 0),lw(n,e,a,i)}if(o=(a&n.childLanes)!==0,er||o){if(i=Hn,i!==null){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|a)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,Ho(n,r),zs(i,n,r,-1))}return Z2(),i=Hx(Error(me(421))),lw(n,e,a,i)}return r.data==="$?"?(e.flags|=128,e.child=n.child,e=NH.bind(null,n),r._reactRetry=e,null):(n=s.treeContext,Sr=su(r.nextSibling),Cr=e,Ht=!0,Ps=null,n!==null&&(Wr[qr++]=No,Wr[qr++]=Do,Wr[qr++]=Rd,No=n.id,Do=n.overflow,Rd=e),e=G2(e,i.children),e.flags|=4096,e)}function m$(n,e,t){n.lanes|=e;var i=n.alternate;i!==null&&(i.lanes|=e),HA(n.return,e,t)}function Wx(n,e,t,i,r){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=t,s.tailMode=r)}function yL(n,e,t){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Pi(n,e,i.children,t),i=Kt.current,i&2)i=i&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&m$(n,t,e);else if(n.tag===19)m$(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}i&=1}if(Mt(Kt,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)n=t.alternate,n!==null&&nb(n)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),Wx(e,!1,r,t,s);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(n=r.alternate,n!==null&&nb(n)===null){e.child=r;break}n=r.sibling,r.sibling=t,t=r,r=n}Wx(e,!0,t,null,s);break;case"together":Wx(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Kw(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Wo(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Nd|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(me(153));if(e.child!==null){for(n=e.child,t=uu(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=uu(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function bH(n,e,t){switch(e.tag){case 3:mL(e),vp();break;case 5:U3(e);break;case 1:nr(e.type)&&X0(e);break;case 4:z2(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;Mt(Z0,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(Mt(Kt,Kt.current&1),e.flags|=128,null):t&e.child.childLanes?gL(n,e,t):(Mt(Kt,Kt.current&1),n=Wo(n,e,t),n!==null?n.sibling:null);Mt(Kt,Kt.current&1);break;case 19:if(i=(t&e.childLanes)!==0,n.flags&128){if(i)return yL(n,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Mt(Kt,Kt.current),i)break;return null;case 22:case 23:return e.lanes=0,fL(n,e,t)}return Wo(n,e,t)}var _L,JA,vL,wL;_L=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};JA=function(){};vL=function(n,e,t,i){var r=n.memoizedProps;if(r!==i){n=e.stateNode,vc($a.current);var s=null;switch(t){case"input":r=wA(n,r),i=wA(n,i),s=[];break;case"select":r=Qt({},r,{value:void 0}),i=Qt({},i,{value:void 0}),s=[];break;case"textarea":r=EA(n,r),i=EA(n,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(n.onclick=K0)}TA(t,i);var a;t=null;for(u in r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var o=r[u];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Hg.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in i){var l=i[u];if(o=r!=null?r[u]:void 0,i.hasOwnProperty(u)&&l!==o&&(l!=null||o!=null))if(u==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(t||(t={}),t[a]=l[a])}else t||(s||(s=[]),s.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(s=s||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Hg.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Ot("scroll",n),s||o===l||(s=[])):(s=s||[]).push(u,l))}t&&(s=s||[]).push("style",t);var u=s;(e.updateQueue=u)&&(e.flags|=4)}};wL=function(n,e,t,i){t!==i&&(e.flags|=4)};function Sm(n,e){if(!Ht)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:i.sibling=null}}function ai(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,i=0;if(e)for(var r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=n,r=r.sibling;else for(r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=n,r=r.sibling;return n.subtreeFlags|=i,n.childLanes=t,e}function xH(n,e,t){var i=e.pendingProps;switch(P2(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ai(e),null;case 1:return nr(e.type)&&Y0(),ai(e),null;case 3:return i=e.stateNode,bp(),zt(tr),zt(bi),j2(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(n===null||n.child===null)&&(aw(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ps!==null&&(aT(Ps),Ps=null))),JA(n,e),ai(e),null;case 5:V2(e);var r=vc(ny.current);if(t=e.type,n!==null&&e.stateNode!=null)vL(n,e,t,i,r),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(me(166));return ai(e),null}if(n=vc($a.current),aw(e)){i=e.stateNode,t=e.type;var s=e.memoizedProps;switch(i[Ca]=e,i[ey]=s,n=(e.mode&1)!==0,t){case"dialog":Ot("cancel",i),Ot("close",i);break;case"iframe":case"object":case"embed":Ot("load",i);break;case"video":case"audio":for(r=0;r<Km.length;r++)Ot(Km[r],i);break;case"source":Ot("error",i);break;case"img":case"image":case"link":Ot("error",i),Ot("load",i);break;case"details":Ot("toggle",i);break;case"input":Ak(i,s),Ot("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},Ot("invalid",i);break;case"textarea":Sk(i,s),Ot("invalid",i)}TA(t,s),r=null;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];a==="children"?typeof o=="string"?i.textContent!==o&&(s.suppressHydrationWarning!==!0&&sw(i.textContent,o,n),r=["children",o]):typeof o=="number"&&i.textContent!==""+o&&(s.suppressHydrationWarning!==!0&&sw(i.textContent,o,n),r=["children",""+o]):Hg.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&Ot("scroll",i)}switch(t){case"input":Qv(i),Tk(i,s,!0);break;case"textarea":Qv(i),Ik(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=K0)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{a=r.nodeType===9?r:r.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=KO(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof i.is=="string"?n=a.createElement(t,{is:i.is}):(n=a.createElement(t),t==="select"&&(a=n,i.multiple?a.multiple=!0:i.size&&(a.size=i.size))):n=a.createElementNS(n,t),n[Ca]=e,n[ey]=i,_L(n,e,!1,!1),e.stateNode=n;e:{switch(a=SA(t,i),t){case"dialog":Ot("cancel",n),Ot("close",n),r=i;break;case"iframe":case"object":case"embed":Ot("load",n),r=i;break;case"video":case"audio":for(r=0;r<Km.length;r++)Ot(Km[r],n);r=i;break;case"source":Ot("error",n),r=i;break;case"img":case"image":case"link":Ot("error",n),Ot("load",n),r=i;break;case"details":Ot("toggle",n),r=i;break;case"input":Ak(n,i),r=wA(n,i),Ot("invalid",n);break;case"option":r=i;break;case"select":n._wrapperState={wasMultiple:!!i.multiple},r=Qt({},i,{value:void 0}),Ot("invalid",n);break;case"textarea":Sk(n,i),r=EA(n,i),Ot("invalid",n);break;default:r=i}TA(t,r),o=r;for(s in o)if(o.hasOwnProperty(s)){var l=o[s];s==="style"?QO(n,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&YO(n,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Wg(n,l):typeof l=="number"&&Wg(n,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Hg.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Ot("scroll",n):l!=null&&y2(n,s,l,a))}switch(t){case"input":Qv(n),Tk(n,i,!1);break;case"textarea":Qv(n),Ik(n);break;case"option":i.value!=null&&n.setAttribute("value",""+mu(i.value));break;case"select":n.multiple=!!i.multiple,s=i.value,s!=null?Qh(n,!!i.multiple,s,!1):i.defaultValue!=null&&Qh(n,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(n.onclick=K0)}switch(t){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ai(e),null;case 6:if(n&&e.stateNode!=null)wL(n,e,n.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(me(166));if(t=vc(ny.current),vc($a.current),aw(e)){if(i=e.stateNode,t=e.memoizedProps,i[Ca]=e,(s=i.nodeValue!==t)&&(n=Cr,n!==null))switch(n.tag){case 3:sw(i.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&sw(i.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else i=(t.nodeType===9?t:t.ownerDocument).createTextNode(i),i[Ca]=e,e.stateNode=i}return ai(e),null;case 13:if(zt(Kt),i=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Ht&&Sr!==null&&e.mode&1&&!(e.flags&128))F3(),vp(),e.flags|=98560,s=!1;else if(s=aw(e),i!==null&&i.dehydrated!==null){if(n===null){if(!s)throw Error(me(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(me(317));s[Ca]=e}else vp(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ai(e),s=!1}else Ps!==null&&(aT(Ps),Ps=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(i=i!==null,i!==(n!==null&&n.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(n===null||Kt.current&1?In===0&&(In=3):Z2())),e.updateQueue!==null&&(e.flags|=4),ai(e),null);case 4:return bp(),JA(n,e),n===null&&Jg(e.stateNode.containerInfo),ai(e),null;case 10:return O2(e.type._context),ai(e),null;case 17:return nr(e.type)&&Y0(),ai(e),null;case 19:if(zt(Kt),s=e.memoizedState,s===null)return ai(e),null;if(i=(e.flags&128)!==0,a=s.rendering,a===null)if(i)Sm(s,!1);else{if(In!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=nb(n),a!==null){for(e.flags|=128,Sm(s,!1),i=a.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=t,t=e.child;t!==null;)s=t,n=i,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,n=a.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Mt(Kt,Kt.current&1|2),e.child}n=n.sibling}s.tail!==null&&ln()>Ep&&(e.flags|=128,i=!0,Sm(s,!1),e.lanes=4194304)}else{if(!i)if(n=nb(a),n!==null){if(e.flags|=128,i=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Sm(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!Ht)return ai(e),null}else 2*ln()-s.renderingStartTime>Ep&&t!==1073741824&&(e.flags|=128,i=!0,Sm(s,!1),e.lanes=4194304);s.isBackwards?(a.sibling=e.child,e.child=a):(t=s.last,t!==null?t.sibling=a:e.child=a,s.last=a)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=ln(),e.sibling=null,t=Kt.current,Mt(Kt,i?t&1|2:t&1),e):(ai(e),null);case 22:case 23:return J2(),i=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?br&1073741824&&(ai(e),e.subtreeFlags&6&&(e.flags|=8192)):ai(e),null;case 24:return null;case 25:return null}throw Error(me(156,e.tag))}function EH(n,e){switch(P2(e),e.tag){case 1:return nr(e.type)&&Y0(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return bp(),zt(tr),zt(bi),j2(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return V2(e),null;case 13:if(zt(Kt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(me(340));vp()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return zt(Kt),null;case 4:return bp(),null;case 10:return O2(e.type._context),null;case 22:case 23:return J2(),null;case 24:return null;default:return null}}var uw=!1,_i=!1,AH=typeof WeakSet=="function"?WeakSet:Set,Ie=null;function Hh(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(i){tn(n,e,i)}else t.current=null}function ZA(n,e,t){try{t()}catch(i){tn(n,e,i)}}var g$=!1;function TH(n,e){if(OA=W0,n=T3(),$2(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var i=t.getSelection&&t.getSelection();if(i&&i.rangeCount!==0){t=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,u=0,c=0,h=n,f=null;t:for(;;){for(var m;h!==t||r!==0&&h.nodeType!==3||(o=a+r),h!==s||i!==0&&h.nodeType!==3||(l=a+i),h.nodeType===3&&(a+=h.nodeValue.length),(m=h.firstChild)!==null;)f=h,h=m;for(;;){if(h===n)break t;if(f===t&&++u===r&&(o=a),f===s&&++c===i&&(l=a),(m=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=m}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(LA={focusedElem:n,selectionRange:t},W0=!1,Ie=e;Ie!==null;)if(e=Ie,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,Ie=n;else for(;Ie!==null;){e=Ie;try{var y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var _=y.memoizedProps,x=y.memoizedState,v=e.stateNode,w=v.getSnapshotBeforeUpdate(e.elementType===e.type?_:ys(e.type,_),x);v.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var E=e.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(me(163))}}catch(C){tn(e,e.return,C)}if(n=e.sibling,n!==null){n.return=e.return,Ie=n;break}Ie=e.return}return y=g$,g$=!1,y}function kg(n,e,t){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&n)===n){var s=r.destroy;r.destroy=void 0,s!==void 0&&ZA(e,t,s)}r=r.next}while(r!==i)}}function b1(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}}function eT(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function bL(n){var e=n.alternate;e!==null&&(n.alternate=null,bL(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Ca],delete e[ey],delete e[VA],delete e[oH],delete e[lH])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function xL(n){return n.tag===5||n.tag===3||n.tag===4}function y$(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||xL(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function tT(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=K0));else if(i!==4&&(n=n.child,n!==null))for(tT(n,e,t),n=n.sibling;n!==null;)tT(n,e,t),n=n.sibling}function nT(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(i!==4&&(n=n.child,n!==null))for(nT(n,e,t),n=n.sibling;n!==null;)nT(n,e,t),n=n.sibling}var Xn=null,Rs=!1;function ll(n,e,t){for(t=t.child;t!==null;)EL(n,e,t),t=t.sibling}function EL(n,e,t){if(ka&&typeof ka.onCommitFiberUnmount=="function")try{ka.onCommitFiberUnmount(f1,t)}catch{}switch(t.tag){case 5:_i||Hh(t,e);case 6:var i=Xn,r=Rs;Xn=null,ll(n,e,t),Xn=i,Rs=r,Xn!==null&&(Rs?(n=Xn,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Xn.removeChild(t.stateNode));break;case 18:Xn!==null&&(Rs?(n=Xn,t=t.stateNode,n.nodeType===8?Fx(n.parentNode,t):n.nodeType===1&&Fx(n,t),Yg(n)):Fx(Xn,t.stateNode));break;case 4:i=Xn,r=Rs,Xn=t.stateNode.containerInfo,Rs=!0,ll(n,e,t),Xn=i,Rs=r;break;case 0:case 11:case 14:case 15:if(!_i&&(i=t.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&ZA(t,e,a),r=r.next}while(r!==i)}ll(n,e,t);break;case 1:if(!_i&&(Hh(t,e),i=t.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=t.memoizedProps,i.state=t.memoizedState,i.componentWillUnmount()}catch(o){tn(t,e,o)}ll(n,e,t);break;case 21:ll(n,e,t);break;case 22:t.mode&1?(_i=(i=_i)||t.memoizedState!==null,ll(n,e,t),_i=i):ll(n,e,t);break;default:ll(n,e,t)}}function _$(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new AH),e.forEach(function(i){var r=DH.bind(null,n,i);t.has(i)||(t.add(i),i.then(r,r))})}}function us(n,e){var t=e.deletions;if(t!==null)for(var i=0;i<t.length;i++){var r=t[i];try{var s=n,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:Xn=o.stateNode,Rs=!1;break e;case 3:Xn=o.stateNode.containerInfo,Rs=!0;break e;case 4:Xn=o.stateNode.containerInfo,Rs=!0;break e}o=o.return}if(Xn===null)throw Error(me(160));EL(s,a,r),Xn=null,Rs=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(u){tn(r,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)AL(e,n),e=e.sibling}function AL(n,e){var t=n.alternate,i=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(us(e,n),ia(n),i&4){try{kg(3,n,n.return),b1(3,n)}catch(_){tn(n,n.return,_)}try{kg(5,n,n.return)}catch(_){tn(n,n.return,_)}}break;case 1:us(e,n),ia(n),i&512&&t!==null&&Hh(t,t.return);break;case 5:if(us(e,n),ia(n),i&512&&t!==null&&Hh(t,t.return),n.flags&32){var r=n.stateNode;try{Wg(r,"")}catch(_){tn(n,n.return,_)}}if(i&4&&(r=n.stateNode,r!=null)){var s=n.memoizedProps,a=t!==null?t.memoizedProps:s,o=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{o==="input"&&s.type==="radio"&&s.name!=null&&qO(r,s),SA(o,a);var u=SA(o,s);for(a=0;a<l.length;a+=2){var c=l[a],h=l[a+1];c==="style"?QO(r,h):c==="dangerouslySetInnerHTML"?YO(r,h):c==="children"?Wg(r,h):y2(r,c,h,u)}switch(o){case"input":bA(r,s);break;case"textarea":GO(r,s);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var m=s.value;m!=null?Qh(r,!!s.multiple,m,!1):f!==!!s.multiple&&(s.defaultValue!=null?Qh(r,!!s.multiple,s.defaultValue,!0):Qh(r,!!s.multiple,s.multiple?[]:"",!1))}r[ey]=s}catch(_){tn(n,n.return,_)}}break;case 6:if(us(e,n),ia(n),i&4){if(n.stateNode===null)throw Error(me(162));r=n.stateNode,s=n.memoizedProps;try{r.nodeValue=s}catch(_){tn(n,n.return,_)}}break;case 3:if(us(e,n),ia(n),i&4&&t!==null&&t.memoizedState.isDehydrated)try{Yg(e.containerInfo)}catch(_){tn(n,n.return,_)}break;case 4:us(e,n),ia(n);break;case 13:us(e,n),ia(n),r=n.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(X2=ln())),i&4&&_$(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?(_i=(u=_i)||c,us(e,n),_i=u):us(e,n),ia(n),i&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!c&&n.mode&1)for(Ie=n,c=n.child;c!==null;){for(h=Ie=c;Ie!==null;){switch(f=Ie,m=f.child,f.tag){case 0:case 11:case 14:case 15:kg(4,f,f.return);break;case 1:Hh(f,f.return);var y=f.stateNode;if(typeof y.componentWillUnmount=="function"){i=f,t=f.return;try{e=i,y.props=e.memoizedProps,y.state=e.memoizedState,y.componentWillUnmount()}catch(_){tn(i,t,_)}}break;case 5:Hh(f,f.return);break;case 22:if(f.memoizedState!==null){w$(h);continue}}m!==null?(m.return=f,Ie=m):w$(h)}c=c.sibling}e:for(c=null,h=n;;){if(h.tag===5){if(c===null){c=h;try{r=h.stateNode,u?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(o=h.stateNode,l=h.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=XO("display",a))}catch(_){tn(n,n.return,_)}}}else if(h.tag===6){if(c===null)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(_){tn(n,n.return,_)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===n)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===n)break e;for(;h.sibling===null;){if(h.return===null||h.return===n)break e;c===h&&(c=null),h=h.return}c===h&&(c=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:us(e,n),ia(n),i&4&&_$(n);break;case 21:break;default:us(e,n),ia(n)}}function ia(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(xL(t)){var i=t;break e}t=t.return}throw Error(me(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Wg(r,""),i.flags&=-33);var s=y$(n);nT(n,s,r);break;case 3:case 4:var a=i.stateNode.containerInfo,o=y$(n);tT(n,o,a);break;default:throw Error(me(161))}}catch(l){tn(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function SH(n,e,t){Ie=n,TL(n)}function TL(n,e,t){for(var i=(n.mode&1)!==0;Ie!==null;){var r=Ie,s=r.child;if(r.tag===22&&i){var a=r.memoizedState!==null||uw;if(!a){var o=r.alternate,l=o!==null&&o.memoizedState!==null||_i;o=uw;var u=_i;if(uw=a,(_i=l)&&!u)for(Ie=r;Ie!==null;)a=Ie,l=a.child,a.tag===22&&a.memoizedState!==null?b$(r):l!==null?(l.return=a,Ie=l):b$(r);for(;s!==null;)Ie=s,TL(s),s=s.sibling;Ie=r,uw=o,_i=u}v$(n)}else r.subtreeFlags&8772&&s!==null?(s.return=r,Ie=s):v$(n)}}function v$(n){for(;Ie!==null;){var e=Ie;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:_i||b1(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!_i)if(t===null)i.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:ys(e.type,t.memoizedProps);i.componentDidUpdate(r,t.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&i$(e,s,i);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}i$(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var h=c.dehydrated;h!==null&&Yg(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(me(163))}_i||e.flags&512&&eT(e)}catch(f){tn(e,e.return,f)}}if(e===n){Ie=null;break}if(t=e.sibling,t!==null){t.return=e.return,Ie=t;break}Ie=e.return}}function w$(n){for(;Ie!==null;){var e=Ie;if(e===n){Ie=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Ie=t;break}Ie=e.return}}function b$(n){for(;Ie!==null;){var e=Ie;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{b1(4,e)}catch(l){tn(e,t,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){tn(e,r,l)}}var s=e.return;try{eT(e)}catch(l){tn(e,s,l)}break;case 5:var a=e.return;try{eT(e)}catch(l){tn(e,a,l)}}}catch(l){tn(e,e.return,l)}if(e===n){Ie=null;break}var o=e.sibling;if(o!==null){o.return=e.return,Ie=o;break}Ie=e.return}}var IH=Math.ceil,sb=Zo.ReactCurrentDispatcher,K2=Zo.ReactCurrentOwner,Qr=Zo.ReactCurrentBatchConfig,ct=0,Hn=null,mn=null,ei=0,br=0,Wh=ku(0),In=0,ay=null,Nd=0,x1=0,Y2=0,$g=null,Ji=null,X2=0,Ep=1/0,to=null,ab=!1,iT=null,ou=null,cw=!1,eu=null,ob=0,Rg=0,rT=null,Yw=-1,Xw=0;function Ni(){return ct&6?ln():Yw!==-1?Yw:Yw=ln()}function lu(n){return n.mode&1?ct&2&&ei!==0?ei&-ei:cH.transition!==null?(Xw===0&&(Xw=u3()),Xw):(n=At,n!==0||(n=window.event,n=n===void 0?16:g3(n.type)),n):1}function zs(n,e,t,i){if(50<Rg)throw Rg=0,rT=null,Error(me(185));Y_(n,t,i),(!(ct&2)||n!==Hn)&&(n===Hn&&(!(ct&2)&&(x1|=t),In===4&&yl(n,ei)),ir(n,i),t===1&&ct===0&&!(e.mode&1)&&(Ep=ln()+500,_1&&$u()))}function ir(n,e){var t=n.callbackNode;c8(n,e);var i=H0(n,n===Hn?ei:0);if(i===0)t!==null&&$k(t),n.callbackNode=null,n.callbackPriority=0;else if(e=i&-i,n.callbackPriority!==e){if(t!=null&&$k(t),e===1)n.tag===0?uH(x$.bind(null,n)):M3(x$.bind(null,n)),sH(function(){!(ct&6)&&$u()}),t=null;else{switch(c3(i)){case 1:t=x2;break;case 4:t=o3;break;case 16:t=U0;break;case 536870912:t=l3;break;default:t=U0}t=NL(t,SL.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function SL(n,e){if(Yw=-1,Xw=0,ct&6)throw Error(me(327));var t=n.callbackNode;if(nf()&&n.callbackNode!==t)return null;var i=H0(n,n===Hn?ei:0);if(i===0)return null;if(i&30||i&n.expiredLanes||e)e=lb(n,i);else{e=i;var r=ct;ct|=2;var s=CL();(Hn!==n||ei!==e)&&(to=null,Ep=ln()+500,Td(n,e));do try{$H();break}catch(o){IL(n,o)}while(!0);M2(),sb.current=s,ct=r,mn!==null?e=0:(Hn=null,ei=0,e=In)}if(e!==0){if(e===2&&(r=RA(n),r!==0&&(i=r,e=sT(n,r))),e===1)throw t=ay,Td(n,0),yl(n,i),ir(n,ln()),t;if(e===6)yl(n,i);else{if(r=n.current.alternate,!(i&30)&&!CH(r)&&(e=lb(n,i),e===2&&(s=RA(n),s!==0&&(i=s,e=sT(n,s))),e===1))throw t=ay,Td(n,0),yl(n,i),ir(n,ln()),t;switch(n.finishedWork=r,n.finishedLanes=i,e){case 0:case 1:throw Error(me(345));case 2:oc(n,Ji,to);break;case 3:if(yl(n,i),(i&130023424)===i&&(e=X2+500-ln(),10<e)){if(H0(n,0)!==0)break;if(r=n.suspendedLanes,(r&i)!==i){Ni(),n.pingedLanes|=n.suspendedLanes&r;break}n.timeoutHandle=zA(oc.bind(null,n,Ji,to),e);break}oc(n,Ji,to);break;case 4:if(yl(n,i),(i&4194240)===i)break;for(e=n.eventTimes,r=-1;0<i;){var a=31-Fs(i);s=1<<a,a=e[a],a>r&&(r=a),i&=~s}if(i=r,i=ln()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*IH(i/1960))-i,10<i){n.timeoutHandle=zA(oc.bind(null,n,Ji,to),i);break}oc(n,Ji,to);break;case 5:oc(n,Ji,to);break;default:throw Error(me(329))}}}return ir(n,ln()),n.callbackNode===t?SL.bind(null,n):null}function sT(n,e){var t=$g;return n.current.memoizedState.isDehydrated&&(Td(n,e).flags|=256),n=lb(n,e),n!==2&&(e=Ji,Ji=t,e!==null&&aT(e)),n}function aT(n){Ji===null?Ji=n:Ji.push.apply(Ji,n)}function CH(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var i=0;i<t.length;i++){var r=t[i],s=r.getSnapshot;r=r.value;try{if(!Us(s(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function yl(n,e){for(e&=~Y2,e&=~x1,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Fs(e),i=1<<t;n[t]=-1,e&=~i}}function x$(n){if(ct&6)throw Error(me(327));nf();var e=H0(n,0);if(!(e&1))return ir(n,ln()),null;var t=lb(n,e);if(n.tag!==0&&t===2){var i=RA(n);i!==0&&(e=i,t=sT(n,i))}if(t===1)throw t=ay,Td(n,0),yl(n,e),ir(n,ln()),t;if(t===6)throw Error(me(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,oc(n,Ji,to),ir(n,ln()),null}function Q2(n,e){var t=ct;ct|=1;try{return n(e)}finally{ct=t,ct===0&&(Ep=ln()+500,_1&&$u())}}function Dd(n){eu!==null&&eu.tag===0&&!(ct&6)&&nf();var e=ct;ct|=1;var t=Qr.transition,i=At;try{if(Qr.transition=null,At=1,n)return n()}finally{At=i,Qr.transition=t,ct=e,!(ct&6)&&$u()}}function J2(){br=Wh.current,zt(Wh)}function Td(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,rH(t)),mn!==null)for(t=mn.return;t!==null;){var i=t;switch(P2(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Y0();break;case 3:bp(),zt(tr),zt(bi),j2();break;case 5:V2(i);break;case 4:bp();break;case 13:zt(Kt);break;case 19:zt(Kt);break;case 10:O2(i.type._context);break;case 22:case 23:J2()}t=t.return}if(Hn=n,mn=n=uu(n.current,null),ei=br=e,In=0,ay=null,Y2=x1=Nd=0,Ji=$g=null,_c!==null){for(e=0;e<_c.length;e++)if(t=_c[e],i=t.interleaved,i!==null){t.interleaved=null;var r=i.next,s=t.pending;if(s!==null){var a=s.next;s.next=r,i.next=a}t.pending=i}_c=null}return n}function IL(n,e){do{var t=mn;try{if(M2(),qw.current=rb,ib){for(var i=Xt.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}ib=!1}if(Pd=0,Un=Sn=Xt=null,Cg=!1,iy=0,K2.current=null,t===null||t.return===null){In=1,ay=e,mn=null;break}e:{var s=n,a=t.return,o=t,l=e;if(e=ei,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=o,h=c.tag;if(!(c.mode&1)&&(h===0||h===11||h===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var m=u$(a);if(m!==null){m.flags&=-257,c$(m,a,o,s,e),m.mode&1&&l$(s,u,e),e=m,l=u;var y=e.updateQueue;if(y===null){var _=new Set;_.add(l),e.updateQueue=_}else y.add(l);break e}else{if(!(e&1)){l$(s,u,e),Z2();break e}l=Error(me(426))}}else if(Ht&&o.mode&1){var x=u$(a);if(x!==null){!(x.flags&65536)&&(x.flags|=256),c$(x,a,o,s,e),N2(xp(l,o));break e}}s=l=xp(l,o),In!==4&&(In=2),$g===null?$g=[s]:$g.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var v=cL(s,l,e);n$(s,v);break e;case 1:o=l;var w=s.type,E=s.stateNode;if(!(s.flags&128)&&(typeof w.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(ou===null||!ou.has(E)))){s.flags|=65536,e&=-e,s.lanes|=e;var C=dL(s,o,e);n$(s,C);break e}}s=s.return}while(s!==null)}$L(t)}catch(D){e=D,mn===t&&t!==null&&(mn=t=t.return);continue}break}while(!0)}function CL(){var n=sb.current;return sb.current=rb,n===null?rb:n}function Z2(){(In===0||In===3||In===2)&&(In=4),Hn===null||!(Nd&268435455)&&!(x1&268435455)||yl(Hn,ei)}function lb(n,e){var t=ct;ct|=2;var i=CL();(Hn!==n||ei!==e)&&(to=null,Td(n,e));do try{kH();break}catch(r){IL(n,r)}while(!0);if(M2(),ct=t,sb.current=i,mn!==null)throw Error(me(261));return Hn=null,ei=0,In}function kH(){for(;mn!==null;)kL(mn)}function $H(){for(;mn!==null&&!t8();)kL(mn)}function kL(n){var e=PL(n.alternate,n,br);n.memoizedProps=n.pendingProps,e===null?$L(n):mn=e,K2.current=null}function $L(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=EH(t,e),t!==null){t.flags&=32767,mn=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{In=6,mn=null;return}}else if(t=xH(t,e,br),t!==null){mn=t;return}if(e=e.sibling,e!==null){mn=e;return}mn=e=n}while(e!==null);In===0&&(In=5)}function oc(n,e,t){var i=At,r=Qr.transition;try{Qr.transition=null,At=1,RH(n,e,t,i)}finally{Qr.transition=r,At=i}return null}function RH(n,e,t,i){do nf();while(eu!==null);if(ct&6)throw Error(me(327));t=n.finishedWork;var r=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(me(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(d8(n,s),n===Hn&&(mn=Hn=null,ei=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||cw||(cw=!0,NL(U0,function(){return nf(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=Qr.transition,Qr.transition=null;var a=At;At=1;var o=ct;ct|=4,K2.current=null,TH(n,t),AL(t,n),Q8(LA),W0=!!OA,LA=OA=null,n.current=t,SH(t),n8(),ct=o,At=a,Qr.transition=s}else n.current=t;if(cw&&(cw=!1,eu=n,ob=r),s=n.pendingLanes,s===0&&(ou=null),s8(t.stateNode),ir(n,ln()),e!==null)for(i=n.onRecoverableError,t=0;t<e.length;t++)r=e[t],i(r.value,{componentStack:r.stack,digest:r.digest});if(ab)throw ab=!1,n=iT,iT=null,n;return ob&1&&n.tag!==0&&nf(),s=n.pendingLanes,s&1?n===rT?Rg++:(Rg=0,rT=n):Rg=0,$u(),null}function nf(){if(eu!==null){var n=c3(ob),e=Qr.transition,t=At;try{if(Qr.transition=null,At=16>n?16:n,eu===null)var i=!1;else{if(n=eu,eu=null,ob=0,ct&6)throw Error(me(331));var r=ct;for(ct|=4,Ie=n.current;Ie!==null;){var s=Ie,a=s.child;if(Ie.flags&16){var o=s.deletions;if(o!==null){for(var l=0;l<o.length;l++){var u=o[l];for(Ie=u;Ie!==null;){var c=Ie;switch(c.tag){case 0:case 11:case 15:kg(8,c,s)}var h=c.child;if(h!==null)h.return=c,Ie=h;else for(;Ie!==null;){c=Ie;var f=c.sibling,m=c.return;if(bL(c),c===u){Ie=null;break}if(f!==null){f.return=m,Ie=f;break}Ie=m}}}var y=s.alternate;if(y!==null){var _=y.child;if(_!==null){y.child=null;do{var x=_.sibling;_.sibling=null,_=x}while(_!==null)}}Ie=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,Ie=a;else e:for(;Ie!==null;){if(s=Ie,s.flags&2048)switch(s.tag){case 0:case 11:case 15:kg(9,s,s.return)}var v=s.sibling;if(v!==null){v.return=s.return,Ie=v;break e}Ie=s.return}}var w=n.current;for(Ie=w;Ie!==null;){a=Ie;var E=a.child;if(a.subtreeFlags&2064&&E!==null)E.return=a,Ie=E;else e:for(a=w;Ie!==null;){if(o=Ie,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:b1(9,o)}}catch(D){tn(o,o.return,D)}if(o===a){Ie=null;break e}var C=o.sibling;if(C!==null){C.return=o.return,Ie=C;break e}Ie=o.return}}if(ct=r,$u(),ka&&typeof ka.onPostCommitFiberRoot=="function")try{ka.onPostCommitFiberRoot(f1,n)}catch{}i=!0}return i}finally{At=t,Qr.transition=e}}return!1}function E$(n,e,t){e=xp(t,e),e=cL(n,e,1),n=au(n,e,1),e=Ni(),n!==null&&(Y_(n,1,e),ir(n,e))}function tn(n,e,t){if(n.tag===3)E$(n,n,t);else for(;e!==null;){if(e.tag===3){E$(e,n,t);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(ou===null||!ou.has(i))){n=xp(t,n),n=dL(e,n,1),e=au(e,n,1),n=Ni(),e!==null&&(Y_(e,1,n),ir(e,n));break}}e=e.return}}function PH(n,e,t){var i=n.pingCache;i!==null&&i.delete(e),e=Ni(),n.pingedLanes|=n.suspendedLanes&t,Hn===n&&(ei&t)===t&&(In===4||In===3&&(ei&130023424)===ei&&500>ln()-X2?Td(n,0):Y2|=t),ir(n,e)}function RL(n,e){e===0&&(n.mode&1?(e=ew,ew<<=1,!(ew&130023424)&&(ew=4194304)):e=1);var t=Ni();n=Ho(n,e),n!==null&&(Y_(n,e,t),ir(n,t))}function NH(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),RL(n,t)}function DH(n,e){var t=0;switch(n.tag){case 13:var i=n.stateNode,r=n.memoizedState;r!==null&&(t=r.retryLane);break;case 19:i=n.stateNode;break;default:throw Error(me(314))}i!==null&&i.delete(e),RL(n,t)}var PL;PL=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||tr.current)er=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return er=!1,bH(n,e,t);er=!!(n.flags&131072)}else er=!1,Ht&&e.flags&1048576&&O3(e,J0,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Kw(n,e),n=e.pendingProps;var r=_p(e,bi.current);tf(e,t),r=U2(null,e,i,n,r,t);var s=H2();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,nr(i)?(s=!0,X0(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,F2(e),r.updater=w1,e.stateNode=r,r._reactInternals=e,qA(e,i,n,t),e=YA(null,e,i,!0,s,t)):(e.tag=0,Ht&&s&&R2(e),Pi(null,e,r,t),e=e.child),e;case 16:i=e.elementType;e:{switch(Kw(n,e),n=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=OH(i),n=ys(i,n),r){case 0:e=KA(null,e,i,n,t);break e;case 1:e=f$(null,e,i,n,t);break e;case 11:e=d$(null,e,i,n,t);break e;case 14:e=h$(null,e,i,ys(i.type,n),t);break e}throw Error(me(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:ys(i,r),KA(n,e,i,r,t);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:ys(i,r),f$(n,e,i,r,t);case 3:e:{if(mL(e),n===null)throw Error(me(387));i=e.pendingProps,s=e.memoizedState,r=s.element,B3(n,e),tb(e,i,null,t);var a=e.memoizedState;if(i=a.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=xp(Error(me(423)),e),e=p$(n,e,i,t,r);break e}else if(i!==r){r=xp(Error(me(424)),e),e=p$(n,e,i,t,r);break e}else for(Sr=su(e.stateNode.containerInfo.firstChild),Cr=e,Ht=!0,Ps=null,t=V3(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(vp(),i===r){e=Wo(n,e,t);break e}Pi(n,e,i,t)}e=e.child}return e;case 5:return U3(e),n===null&&UA(e),i=e.type,r=e.pendingProps,s=n!==null?n.memoizedProps:null,a=r.children,FA(i,r)?a=null:s!==null&&FA(i,s)&&(e.flags|=32),pL(n,e),Pi(n,e,a,t),e.child;case 6:return n===null&&UA(e),null;case 13:return gL(n,e,t);case 4:return z2(e,e.stateNode.containerInfo),i=e.pendingProps,n===null?e.child=wp(e,null,i,t):Pi(n,e,i,t),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:ys(i,r),d$(n,e,i,r,t);case 7:return Pi(n,e,e.pendingProps,t),e.child;case 8:return Pi(n,e,e.pendingProps.children,t),e.child;case 12:return Pi(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,a=r.value,Mt(Z0,i._currentValue),i._currentValue=a,s!==null)if(Us(s.value,a)){if(s.children===r.children&&!tr.current){e=Wo(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var o=s.dependencies;if(o!==null){a=s.child;for(var l=o.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=Lo(-1,t&-t),l.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}s.lanes|=t,l=s.alternate,l!==null&&(l.lanes|=t),HA(s.return,t,e),o.lanes|=t;break}l=l.next}}else if(s.tag===10)a=s.type===e.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(me(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),HA(a,t,e),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===e){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}Pi(n,e,r.children,t),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,tf(e,t),r=Zr(r),i=i(r),e.flags|=1,Pi(n,e,i,t),e.child;case 14:return i=e.type,r=ys(i,e.pendingProps),r=ys(i.type,r),h$(n,e,i,r,t);case 15:return hL(n,e,e.type,e.pendingProps,t);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:ys(i,r),Kw(n,e),e.tag=1,nr(i)?(n=!0,X0(e)):n=!1,tf(e,t),uL(e,i,r),qA(e,i,r,t),YA(null,e,i,!0,n,t);case 19:return yL(n,e,t);case 22:return fL(n,e,t)}throw Error(me(156,e.tag))};function NL(n,e){return a3(n,e)}function MH(n,e,t,i){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Xr(n,e,t,i){return new MH(n,e,t,i)}function eI(n){return n=n.prototype,!(!n||!n.isReactComponent)}function OH(n){if(typeof n=="function")return eI(n)?1:0;if(n!=null){if(n=n.$$typeof,n===v2)return 11;if(n===w2)return 14}return 2}function uu(n,e){var t=n.alternate;return t===null?(t=Xr(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Qw(n,e,t,i,r,s){var a=2;if(i=n,typeof n=="function")eI(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case Mh:return Sd(t.children,r,s,e);case _2:a=8,r|=8;break;case gA:return n=Xr(12,t,e,r|2),n.elementType=gA,n.lanes=s,n;case yA:return n=Xr(13,t,e,r),n.elementType=yA,n.lanes=s,n;case _A:return n=Xr(19,t,e,r),n.elementType=_A,n.lanes=s,n;case UO:return E1(t,r,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case jO:a=10;break e;case BO:a=9;break e;case v2:a=11;break e;case w2:a=14;break e;case pl:a=16,i=null;break e}throw Error(me(130,n==null?n:typeof n,""))}return e=Xr(a,t,e,r),e.elementType=n,e.type=i,e.lanes=s,e}function Sd(n,e,t,i){return n=Xr(7,n,i,e),n.lanes=t,n}function E1(n,e,t,i){return n=Xr(22,n,i,e),n.elementType=UO,n.lanes=t,n.stateNode={isHidden:!1},n}function qx(n,e,t){return n=Xr(6,n,null,e),n.lanes=t,n}function Gx(n,e,t){return e=Xr(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function LH(n,e,t,i,r){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ix(0),this.expirationTimes=Ix(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ix(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function tI(n,e,t,i,r,s,a,o,l){return n=new LH(n,e,t,o,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Xr(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:i,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},F2(s),n}function FH(n,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Dh,key:i==null?null:""+i,children:n,containerInfo:e,implementation:t}}function DL(n){if(!n)return gu;n=n._reactInternals;e:{if(Xd(n)!==n||n.tag!==1)throw Error(me(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(nr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(me(171))}if(n.tag===1){var t=n.type;if(nr(t))return D3(n,t,e)}return e}function ML(n,e,t,i,r,s,a,o,l){return n=tI(t,i,!0,n,r,s,a,o,l),n.context=DL(null),t=n.current,i=Ni(),r=lu(t),s=Lo(i,r),s.callback=e??null,au(t,s,r),n.current.lanes=r,Y_(n,r,i),ir(n,i),n}function A1(n,e,t,i){var r=e.current,s=Ni(),a=lu(r);return t=DL(t),e.context===null?e.context=t:e.pendingContext=t,e=Lo(s,a),e.payload={element:n},i=i===void 0?null:i,i!==null&&(e.callback=i),n=au(r,e,a),n!==null&&(zs(n,r,a,s),Ww(n,r,a)),a}function ub(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function A$(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function nI(n,e){A$(n,e),(n=n.alternate)&&A$(n,e)}function zH(){return null}var OL=typeof reportError=="function"?reportError:function(n){console.error(n)};function iI(n){this._internalRoot=n}T1.prototype.render=iI.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(me(409));A1(n,e,null,null)};T1.prototype.unmount=iI.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Dd(function(){A1(null,n,null,null)}),e[Uo]=null}};function T1(n){this._internalRoot=n}T1.prototype.unstable_scheduleHydration=function(n){if(n){var e=f3();n={blockedOn:null,target:n,priority:e};for(var t=0;t<gl.length&&e!==0&&e<gl[t].priority;t++);gl.splice(t,0,n),t===0&&m3(n)}};function rI(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function S1(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function T$(){}function VH(n,e,t,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var u=ub(a);s.call(u)}}var a=ML(e,i,n,0,null,!1,!1,"",T$);return n._reactRootContainer=a,n[Uo]=a.current,Jg(n.nodeType===8?n.parentNode:n),Dd(),a}for(;r=n.lastChild;)n.removeChild(r);if(typeof i=="function"){var o=i;i=function(){var u=ub(l);o.call(u)}}var l=tI(n,0,!1,null,null,!1,!1,"",T$);return n._reactRootContainer=l,n[Uo]=l.current,Jg(n.nodeType===8?n.parentNode:n),Dd(function(){A1(e,l,t,i)}),l}function I1(n,e,t,i,r){var s=t._reactRootContainer;if(s){var a=s;if(typeof r=="function"){var o=r;r=function(){var l=ub(a);o.call(l)}}A1(e,a,n,r)}else a=VH(t,e,n,r,i);return ub(a)}d3=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Gm(e.pendingLanes);t!==0&&(E2(e,t|1),ir(e,ln()),!(ct&6)&&(Ep=ln()+500,$u()))}break;case 13:Dd(function(){var i=Ho(n,1);if(i!==null){var r=Ni();zs(i,n,1,r)}}),nI(n,1)}};A2=function(n){if(n.tag===13){var e=Ho(n,134217728);if(e!==null){var t=Ni();zs(e,n,134217728,t)}nI(n,134217728)}};h3=function(n){if(n.tag===13){var e=lu(n),t=Ho(n,e);if(t!==null){var i=Ni();zs(t,n,e,i)}nI(n,e)}};f3=function(){return At};p3=function(n,e){var t=At;try{return At=n,e()}finally{At=t}};CA=function(n,e,t){switch(e){case"input":if(bA(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==n&&i.form===n.form){var r=y1(i);if(!r)throw Error(me(90));WO(i),bA(i,r)}}}break;case"textarea":GO(n,t);break;case"select":e=t.value,e!=null&&Qh(n,!!t.multiple,e,!1)}};e3=Q2;t3=Dd;var jH={usingClientEntryPoint:!1,Events:[Q_,zh,y1,JO,ZO,Q2]},Im={findFiberByHostInstance:yc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},BH={bundleType:Im.bundleType,version:Im.version,rendererPackageName:Im.rendererPackageName,rendererConfig:Im.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Zo.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=r3(n),n===null?null:n.stateNode},findFiberByHostInstance:Im.findFiberByHostInstance||zH,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var dw=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!dw.isDisabled&&dw.supportsFiber)try{f1=dw.inject(BH),ka=dw}catch{}}Pr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=jH;Pr.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!rI(e))throw Error(me(200));return FH(n,e,null,t)};Pr.createRoot=function(n,e){if(!rI(n))throw Error(me(299));var t=!1,i="",r=OL;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=tI(n,1,!1,null,null,t,!1,i,r),n[Uo]=e.current,Jg(n.nodeType===8?n.parentNode:n),new iI(e)};Pr.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(me(188)):(n=Object.keys(n).join(","),Error(me(268,n)));return n=r3(e),n=n===null?null:n.stateNode,n};Pr.flushSync=function(n){return Dd(n)};Pr.hydrate=function(n,e,t){if(!S1(e))throw Error(me(200));return I1(null,n,e,!0,t)};Pr.hydrateRoot=function(n,e,t){if(!rI(n))throw Error(me(405));var i=t!=null&&t.hydratedSources||null,r=!1,s="",a=OL;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=ML(e,null,n,1,t??null,r,!1,s,a),n[Uo]=e.current,Jg(n),i)for(n=0;n<i.length;n++)t=i[n],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new T1(e)};Pr.render=function(n,e,t){if(!S1(e))throw Error(me(200));return I1(null,n,e,!1,t)};Pr.unmountComponentAtNode=function(n){if(!S1(n))throw Error(me(40));return n._reactRootContainer?(Dd(function(){I1(null,null,n,!1,function(){n._reactRootContainer=null,n[Uo]=null})}),!0):!1};Pr.unstable_batchedUpdates=Q2;Pr.unstable_renderSubtreeIntoContainer=function(n,e,t,i){if(!S1(t))throw Error(me(200));if(n==null||n._reactInternals===void 0)throw Error(me(38));return I1(n,e,t,!1,i)};Pr.version="18.3.1-next-f1338f8080-20240426";function LL(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(LL)}catch(n){console.error(n)}}LL(),LO.exports=Pr;var UH=LO.exports,S$=UH;pA.createRoot=S$.createRoot,pA.hydrateRoot=S$.hydrateRoot;const HH="modulepreload",WH=function(n){return"/blood-report-fitness-evaluation-system/"+n},I$={},FL=function(e,t,i){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));r=Promise.allSettled(t.map(l=>{if(l=WH(l),l in I$)return;I$[l]=!0;const u=l.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${c}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":HH,u||(h.as="script"),h.crossOrigin="",h.href=l,o&&h.setAttribute("nonce",o),document.head.appendChild(h),u)return new Promise((f,m)=>{h.addEventListener("load",f),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return r.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return e().catch(s)})},qH=({onLogin:n})=>{const[e,t]=Ce.useState(!0),[i,r]=Ce.useState(""),[s,a]=Ce.useState(""),[o,l]=Ce.useState(""),[u,c]=Ce.useState(!1),[h,f]=Ce.useState(!1),m=async y=>{if(y.preventDefault(),l(""),!i.includes("@")){l("Please enter a valid email address.");return}if(s.length<6){l("Password must be at least 6 characters long.");return}c(!0);try{const{api:_}=await FL(async()=>{const{api:v}=await Promise.resolve().then(()=>BX);return{api:v}},void 0);let x;e?x=await _.login(i,s):x=await _.register(i,s),x.success?n(x.user,!e):l(x.error||"Authentication failed")}catch(_){console.error("Authentication error:",_),l("Network error. Please try again.")}finally{c(!1)}};return S.jsxs("div",{className:"login-container",children:[S.jsxs("div",{className:"login-card fade-in",children:[S.jsxs("div",{className:"logo-section",children:[S.jsx("img",{src:"app_logo.jpg",alt:"BloodFit Logo",className:"app-logo"}),S.jsx("h1",{children:"Blood & Fit"}),S.jsx("p",{children:"Your personal health companion"})]}),S.jsxs("form",{onSubmit:m,className:"login-form",children:[S.jsxs("div",{className:"form-group",children:[S.jsx("label",{htmlFor:"email",children:"Email Address"}),S.jsx("input",{type:"email",id:"email",className:"input-field",placeholder:"hello@example.com",value:i,onChange:y=>r(y.target.value),required:!0})]}),S.jsxs("div",{className:"form-group",children:[S.jsx("label",{htmlFor:"password",children:"Password"}),S.jsxs("div",{className:"password-wrapper",children:[S.jsx("input",{type:h?"text":"password",id:"password",className:"input-field",placeholder:"",value:s,onChange:y=>a(y.target.value),required:!0}),S.jsx("button",{type:"button",className:"toggle-password",onClick:()=>f(!h),children:h?"Hide":"Show"})]}),e&&S.jsx("div",{className:"forgot-password",children:S.jsx("span",{onClick:()=>alert("Reset link sent to email!"),children:"Forgot Password?"})})]}),o&&S.jsx("div",{className:"error-box fade-in",children:S.jsxs("span",{children:[" ",o]})}),S.jsx("button",{type:"submit",className:"btn-primary",disabled:u,children:u?S.jsx("span",{className:"spinner"}):e?"Login":"Sign Up"})]}),S.jsxs("p",{className:"footer-text",children:[e?"Don't have an account? ":"Already have an account? ",S.jsx("span",{className:"link",onClick:()=>{t(!e),l("")},children:e?"Sign up":"Login"})]})]}),S.jsx("style",{children:`
        .login-container {
          min-height: 100vh;
          display: flex;
          align-items: center;
          justify-content: center;
          padding: var(--spacing-md);
          background: linear-gradient(135deg, #fff1f2 0%, #fff 100%);
        }
        
        .login-card {
           width: 100%;
           max-width: 400px;
           background: rgba(255, 255, 255, 0.9);
           backdrop-filter: blur(10px);
           padding: var(--spacing-xl);
           border-radius: 24px;
           box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
           text-align: center;
           border: 1px solid rgba(255,255,255,0.5);
        }

        .logo-section {
          margin-bottom: var(--spacing-xl);
        }

        .app-logo {
          width: 80px;
          height: 80px;
          object-fit: contain;
          margin-bottom: var(--spacing-md);
          border-radius: 20px; /* Softer edges */
          box-shadow: var(--shadow-md);
        }

        .logo-section h1 {
          font-size: 24px;
          color: var(--color-text-main);
          margin-bottom: 5px;
          font-weight: 800;
        }

        .logo-section p {
          color: var(--color-text-secondary);
          font-size: 14px;
        }

        .login-form {
          display: flex;
          flex-direction: column;
          gap: 20px;
        }

        .form-group {
          text-align: left;
        }

        .form-group label {
          display: block;
          margin-bottom: 8px;
          font-weight: 600;
          color: var(--color-text-main);
          font-size: 13px;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-md);
            font-size: 14px;
            transition: all 0.2s;
        }
        .input-field:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);
        }

        .password-wrapper {
            position: relative;
        }
        .toggle-password {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            font-size: 12px;
            color: var(--color-primary);
            font-weight: 600;
            cursor: pointer;
        }

        .btn-primary {
          width: 100%;
          padding: 12px;
          background: var(--color-primary);
          color: white;
          border: none;
          border-radius: var(--radius-md);
          font-weight: 600;
          font-size: 14px;
          cursor: pointer;
          transition: background 0.2s;
        }
        .btn-primary:active { transform: scale(0.98); }

        .error-box {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #ef4444;
            padding: 10px;
            border-radius: var(--radius-md);
            font-size: 12px;
            text-align: left;
            display: flex; gap: 8px;
        }

        .footer-text {
          margin-top: 25px;
          font-size: 13px;
          color: var(--color-text-secondary);
        }

        .link {
          color: var(--color-primary);
          font-weight: 600;
          cursor: pointer;
        }
        .link:hover { text-decoration: underline; }

        .spinner {
          width: 20px;
          height: 20px;
          border: 2px solid rgba(255,255,255,0.3);
          border-radius: 50%;
          border-top-color: white;
          animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        .fade-in {
          animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
          to { opacity: 1; transform: translateY(0); }
        }
        
        .forgot-password {
            text-align: right;
            margin-top: 8px;
            font-size: 12px;
        }
        .forgot-password span {
            color: var(--color-primary);
            cursor: pointer;
            font-weight: 500;
        }
      `})]})},GH=()=>{};var C$={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zL=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},KH=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const r=n[t++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=n[t++];e[i++]=String.fromCharCode((r&31)<<6|s&63)}else if(r>239&&r<365){const s=n[t++],a=n[t++],o=n[t++],l=((r&7)<<18|(s&63)<<12|(a&63)<<6|o&63)-65536;e[i++]=String.fromCharCode(55296+(l>>10)),e[i++]=String.fromCharCode(56320+(l&1023))}else{const s=n[t++],a=n[t++];e[i++]=String.fromCharCode((r&15)<<12|(s&63)<<6|a&63)}}return e.join("")},VL={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<n.length;r+=3){const s=n[r],a=r+1<n.length,o=a?n[r+1]:0,l=r+2<n.length,u=l?n[r+2]:0,c=s>>2,h=(s&3)<<4|o>>4;let f=(o&15)<<2|u>>6,m=u&63;l||(m=64,a||(f=64)),i.push(t[c],t[h],t[f],t[m])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(zL(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):KH(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<n.length;){const s=t[n.charAt(r++)],o=r<n.length?t[n.charAt(r)]:0;++r;const u=r<n.length?t[n.charAt(r)]:64;++r;const h=r<n.length?t[n.charAt(r)]:64;if(++r,s==null||o==null||u==null||h==null)throw new YH;const f=s<<2|o>>4;if(i.push(f),u!==64){const m=o<<4&240|u>>2;if(i.push(m),h!==64){const y=u<<6&192|h;i.push(y)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class YH extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const XH=function(n){const e=zL(n);return VL.encodeByteArray(e,!0)},cb=function(n){return XH(n).replace(/\./g,"")},jL=function(n){try{return VL.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QH(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JH=()=>QH().__FIREBASE_DEFAULTS__,ZH=()=>{if(typeof process>"u"||typeof C$>"u")return;const n=C$.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},e9=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&jL(n[1]);return e&&JSON.parse(e)},C1=()=>{try{return GH()||JH()||ZH()||e9()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},BL=n=>{var e,t;return(t=(e=C1())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},UL=n=>{const e=BL(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},HL=()=>{var n;return(n=C1())==null?void 0:n.config},WL=n=>{var e;return(e=C1())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t9{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qd(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function sI(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qL(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",r=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${i}`,aud:i,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...n};return[cb(JSON.stringify(t)),cb(JSON.stringify(a)),""].join(".")}const Pg={};function n9(){const n={prod:[],emulator:[]};for(const e of Object.keys(Pg))Pg[e]?n.emulator.push(e):n.prod.push(e);return n}function i9(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let k$=!1;function aI(n,e){if(typeof window>"u"||typeof document>"u"||!Qd(window.location.host)||Pg[n]===e||Pg[n]||k$)return;Pg[n]=e;function t(f){return`__firebase__banner__${f}`}const i="__firebase__banner",s=n9().prod.length>0;function a(){const f=document.getElementById(i);f&&f.remove()}function o(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function l(f,m){f.setAttribute("width","24"),f.setAttribute("id",m),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function u(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{k$=!0,a()},f}function c(f,m){f.setAttribute("id",m),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function h(){const f=i9(i),m=t("text"),y=document.getElementById(m)||document.createElement("span"),_=t("learnmore"),x=document.getElementById(_)||document.createElement("a"),v=t("preprendIcon"),w=document.getElementById(v)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const E=f.element;o(E),c(x,_);const C=u();l(w,v),E.append(w,y,x,C),document.body.appendChild(E)}s?(y.innerText="Preview backend disconnected.",w.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(w.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,y.innerText="Preview backend running in this workspace."),y.setAttribute("id",m)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xi(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function r9(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(xi())}function s9(){var e;const n=(e=C1())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function a9(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function o9(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function l9(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function u9(){const n=xi();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function c9(){return!s9()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function d9(){try{return typeof indexedDB=="object"}catch{return!1}}function h9(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var s;e(((s=r.error)==null?void 0:s.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f9="FirebaseError";class Ba extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=f9,Object.setPrototypeOf(this,Ba.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Z_.prototype.create)}}class Z_{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],a=s?p9(s,i):"Error",o=`${this.serviceName}: ${a} (${r}).`;return new Ba(r,o,i)}}function p9(n,e){return n.replace(m9,(t,i)=>{const r=e[i];return r!=null?String(r):`<${i}?>`})}const m9=/\{\$([^}]+)}/g;function g9(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Md(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const r of t){if(!i.includes(r))return!1;const s=n[r],a=e[r];if($$(s)&&$$(a)){if(!Md(s,a))return!1}else if(s!==a)return!1}for(const r of i)if(!t.includes(r))return!1;return!0}function $$(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ev(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function Ym(n){const e={};return n.replace(/^\?/,"").split("&").forEach(i=>{if(i){const[r,s]=i.split("=");e[decodeURIComponent(r)]=decodeURIComponent(s)}}),e}function Xm(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function y9(n,e){const t=new _9(n,e);return t.subscribe.bind(t)}class _9{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let r;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");v9(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:i},r.next===void 0&&(r.next=Kx),r.error===void 0&&(r.error=Kx),r.complete===void 0&&(r.complete=Kx);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function v9(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Kx(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rn(n){return n&&n._delegate?n._delegate:n}class yu{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lc="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w9{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new t9;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&i.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(i)return null;throw r}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(x9(e))try{this.getOrInitializeService({instanceIdentifier:lc})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:r});i.resolve(s)}catch{}}}}clearInstance(e=lc){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=lc){return this.instances.has(e)}getOptions(e=lc){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[s,a]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(s);i===o&&a.resolve(r)}return r}onInit(e,t){const i=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(i)??new Set;r.add(e),this.onInitCallbacks.set(i,r);const s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const r of i)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:b9(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=lc){return this.component?this.component.multipleInstances?e:lc:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function b9(n){return n===lc?void 0:n}function x9(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E9{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new w9(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(nt||(nt={}));const A9={debug:nt.DEBUG,verbose:nt.VERBOSE,info:nt.INFO,warn:nt.WARN,error:nt.ERROR,silent:nt.SILENT},T9=nt.INFO,S9={[nt.DEBUG]:"log",[nt.VERBOSE]:"log",[nt.INFO]:"info",[nt.WARN]:"warn",[nt.ERROR]:"error"},I9=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),r=S9[e];if(r)console[r](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class oI{constructor(e){this.name=e,this._logLevel=T9,this._logHandler=I9,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in nt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?A9[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,nt.DEBUG,...e),this._logHandler(this,nt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,nt.VERBOSE,...e),this._logHandler(this,nt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,nt.INFO,...e),this._logHandler(this,nt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,nt.WARN,...e),this._logHandler(this,nt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,nt.ERROR,...e),this._logHandler(this,nt.ERROR,...e)}}const C9=(n,e)=>e.some(t=>n instanceof t);let R$,P$;function k9(){return R$||(R$=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function $9(){return P$||(P$=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const GL=new WeakMap,oT=new WeakMap,KL=new WeakMap,Yx=new WeakMap,lI=new WeakMap;function R9(n){const e=new Promise((t,i)=>{const r=()=>{n.removeEventListener("success",s),n.removeEventListener("error",a)},s=()=>{t(cu(n.result)),r()},a=()=>{i(n.error),r()};n.addEventListener("success",s),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&GL.set(t,n)}).catch(()=>{}),lI.set(e,n),e}function P9(n){if(oT.has(n))return;const e=new Promise((t,i)=>{const r=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",a),n.removeEventListener("abort",a)},s=()=>{t(),r()},a=()=>{i(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",s),n.addEventListener("error",a),n.addEventListener("abort",a)});oT.set(n,e)}let lT={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return oT.get(n);if(e==="objectStoreNames")return n.objectStoreNames||KL.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return cu(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function N9(n){lT=n(lT)}function D9(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(Xx(this),e,...t);return KL.set(i,e.sort?e.sort():[e]),cu(i)}:$9().includes(n)?function(...e){return n.apply(Xx(this),e),cu(GL.get(this))}:function(...e){return cu(n.apply(Xx(this),e))}}function M9(n){return typeof n=="function"?D9(n):(n instanceof IDBTransaction&&P9(n),C9(n,k9())?new Proxy(n,lT):n)}function cu(n){if(n instanceof IDBRequest)return R9(n);if(Yx.has(n))return Yx.get(n);const e=M9(n);return e!==n&&(Yx.set(n,e),lI.set(e,n)),e}const Xx=n=>lI.get(n);function O9(n,e,{blocked:t,upgrade:i,blocking:r,terminated:s}={}){const a=indexedDB.open(n,e),o=cu(a);return i&&a.addEventListener("upgradeneeded",l=>{i(cu(a.result),l.oldVersion,l.newVersion,cu(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),o.then(l=>{s&&l.addEventListener("close",()=>s()),r&&l.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),o}const L9=["get","getKey","getAll","getAllKeys","count"],F9=["put","add","delete","clear"],Qx=new Map;function N$(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Qx.get(e))return Qx.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,r=F9.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(r||L9.includes(t)))return;const s=async function(a,...o){const l=this.transaction(a,r?"readwrite":"readonly");let u=l.store;return i&&(u=u.index(o.shift())),(await Promise.all([u[t](...o),r&&l.done]))[0]};return Qx.set(e,s),s}N9(n=>({...n,get:(e,t,i)=>N$(e,t)||n.get(e,t,i),has:(e,t)=>!!N$(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z9{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(V9(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function V9(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const uT="@firebase/app",D$="0.14.7";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qo=new oI("@firebase/app"),j9="@firebase/app-compat",B9="@firebase/analytics-compat",U9="@firebase/analytics",H9="@firebase/app-check-compat",W9="@firebase/app-check",q9="@firebase/auth",G9="@firebase/auth-compat",K9="@firebase/database",Y9="@firebase/data-connect",X9="@firebase/database-compat",Q9="@firebase/functions",J9="@firebase/functions-compat",Z9="@firebase/installations",eW="@firebase/installations-compat",tW="@firebase/messaging",nW="@firebase/messaging-compat",iW="@firebase/performance",rW="@firebase/performance-compat",sW="@firebase/remote-config",aW="@firebase/remote-config-compat",oW="@firebase/storage",lW="@firebase/storage-compat",uW="@firebase/firestore",cW="@firebase/ai",dW="@firebase/firestore-compat",hW="firebase",fW="12.8.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cT="[DEFAULT]",pW={[uT]:"fire-core",[j9]:"fire-core-compat",[U9]:"fire-analytics",[B9]:"fire-analytics-compat",[W9]:"fire-app-check",[H9]:"fire-app-check-compat",[q9]:"fire-auth",[G9]:"fire-auth-compat",[K9]:"fire-rtdb",[Y9]:"fire-data-connect",[X9]:"fire-rtdb-compat",[Q9]:"fire-fn",[J9]:"fire-fn-compat",[Z9]:"fire-iid",[eW]:"fire-iid-compat",[tW]:"fire-fcm",[nW]:"fire-fcm-compat",[iW]:"fire-perf",[rW]:"fire-perf-compat",[sW]:"fire-rc",[aW]:"fire-rc-compat",[oW]:"fire-gcs",[lW]:"fire-gcs-compat",[uW]:"fire-fst",[dW]:"fire-fst-compat",[cW]:"fire-vertex","fire-js":"fire-js",[hW]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const db=new Map,mW=new Map,dT=new Map;function M$(n,e){try{n.container.addComponent(e)}catch(t){qo.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Od(n){const e=n.name;if(dT.has(e))return qo.debug(`There were multiple attempts to register component ${e}.`),!1;dT.set(e,n);for(const t of db.values())M$(t,n);for(const t of mW.values())M$(t,n);return!0}function k1(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Ar(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gW={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},du=new Z_("app","Firebase",gW);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yW{constructor(e,t,i){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new yu("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw du.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jd=fW;function YL(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i={name:cT,automaticDataCollectionEnabled:!0,...e},r=i.name;if(typeof r!="string"||!r)throw du.create("bad-app-name",{appName:String(r)});if(t||(t=HL()),!t)throw du.create("no-options");const s=db.get(r);if(s){if(Md(t,s.options)&&Md(i,s.config))return s;throw du.create("duplicate-app",{appName:r})}const a=new E9(r);for(const l of dT.values())a.addComponent(l);const o=new yW(t,i,a);return db.set(r,o),o}function uI(n=cT){const e=db.get(n);if(!e&&n===cT&&HL())return YL();if(!e)throw du.create("no-app",{appName:n});return e}function Ra(n,e,t){let i=pW[n]??n;t&&(i+=`-${t}`);const r=i.match(/\s|\//),s=e.match(/\s|\//);if(r||s){const a=[`Unable to register library "${i}" with version "${e}":`];r&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&s&&a.push("and"),s&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),qo.warn(a.join(" "));return}Od(new yu(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _W="firebase-heartbeat-database",vW=1,oy="firebase-heartbeat-store";let Jx=null;function XL(){return Jx||(Jx=O9(_W,vW,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(oy)}catch(t){console.warn(t)}}}}).catch(n=>{throw du.create("idb-open",{originalErrorMessage:n.message})})),Jx}async function wW(n){try{const t=(await XL()).transaction(oy),i=await t.objectStore(oy).get(QL(n));return await t.done,i}catch(e){if(e instanceof Ba)qo.warn(e.message);else{const t=du.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});qo.warn(t.message)}}}async function O$(n,e){try{const i=(await XL()).transaction(oy,"readwrite");await i.objectStore(oy).put(e,QL(n)),await i.done}catch(t){if(t instanceof Ba)qo.warn(t.message);else{const i=du.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});qo.warn(i.message)}}}function QL(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bW=1024,xW=30;class EW{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new TW(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,t;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=L$();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:r}),this._heartbeatsCache.heartbeats.length>xW){const a=SW(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){qo.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=L$(),{heartbeatsToSend:i,unsentEntries:r}=AW(this._heartbeatsCache.heartbeats),s=cb(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return qo.warn(t),""}}}function L$(){return new Date().toISOString().substring(0,10)}function AW(n,e=bW){const t=[];let i=n.slice();for(const r of n){const s=t.find(a=>a.agent===r.agent);if(s){if(s.dates.push(r.date),F$(t)>e){s.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),F$(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class TW{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return d9()?h9().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await wW(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return O$(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return O$(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function F$(n){return cb(JSON.stringify({version:2,heartbeats:n})).length}function SW(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let i=1;i<n.length;i++)n[i].date<t&&(t=n[i].date,e=i);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IW(n){Od(new yu("platform-logger",e=>new z9(e),"PRIVATE")),Od(new yu("heartbeat",e=>new EW(e),"PRIVATE")),Ra(uT,D$,n),Ra(uT,D$,"esm2020"),Ra("fire-js","")}IW("");function JL(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const CW=JL,ZL=new Z_("auth","Firebase",JL());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hb=new oI("@firebase/auth");function kW(n,...e){hb.logLevel<=nt.WARN&&hb.warn(`Auth (${Jd}): ${n}`,...e)}function Jw(n,...e){hb.logLevel<=nt.ERROR&&hb.error(`Auth (${Jd}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hs(n,...e){throw cI(n,...e)}function Pa(n,...e){return cI(n,...e)}function e4(n,e,t){const i={...CW(),[e]:t};return new Z_("auth","Firebase",i).create(e,{appName:n.name})}function Fo(n){return e4(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function cI(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return ZL.create(n,...e)}function ze(n,e,...t){if(!n)throw cI(e,...t)}function Mo(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Jw(e),new Error(e)}function Go(n,e){n||Mo(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hT(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function $W(){return z$()==="http:"||z$()==="https:"}function z$(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RW(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&($W()||o9()||"connection"in navigator)?navigator.onLine:!0}function PW(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tv{constructor(e,t){this.shortDelay=e,this.longDelay=t,Go(t>e,"Short delay should be less than long delay!"),this.isMobile=r9()||l9()}get(){return RW()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dI(n,e){Go(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t4{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Mo("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Mo("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Mo("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NW={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DW=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],MW=new tv(3e4,6e4);function Ru(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Pu(n,e,t,i,r={}){return n4(n,r,async()=>{let s={},a={};i&&(e==="GET"?a=i:s={body:JSON.stringify(i)});const o=ev({key:n.config.apiKey,...a}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:l,...s};return a9()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&Qd(n.emulatorConfig.host)&&(u.credentials="include"),t4.fetch()(await i4(n,n.config.apiHost,t,o),u)})}async function n4(n,e,t){n._canInitEmulator=!1;const i={...NW,...e};try{const r=new LW(n),s=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const a=await s.json();if("needConfirmation"in a)throw hw(n,"account-exists-with-different-credential",a);if(s.ok&&!("errorMessage"in a))return a;{const o=s.ok?a.errorMessage:a.error.message,[l,u]=o.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw hw(n,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw hw(n,"email-already-in-use",a);if(l==="USER_DISABLED")throw hw(n,"user-disabled",a);const c=i[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw e4(n,c,u);Hs(n,c)}}catch(r){if(r instanceof Ba)throw r;Hs(n,"network-request-failed",{message:String(r)})}}async function nv(n,e,t,i,r={}){const s=await Pu(n,e,t,i,r);return"mfaPendingCredential"in s&&Hs(n,"multi-factor-auth-required",{_serverResponse:s}),s}async function i4(n,e,t,i){const r=`${e}${t}?${i}`,s=n,a=s.config.emulator?dI(n.config,r):`${n.config.apiScheme}://${r}`;return DW.includes(t)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(a).toString():a}function OW(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class LW{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(Pa(this.auth,"network-request-failed")),MW.get())})}}function hw(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const r=Pa(n,e,i);return r.customData._tokenResponse=t,r}function V$(n){return n!==void 0&&n.enterprise!==void 0}class FW{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return OW(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function zW(n,e){return Pu(n,"GET","/v2/recaptchaConfig",Ru(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VW(n,e){return Pu(n,"POST","/v1/accounts:delete",e)}async function fb(n,e){return Pu(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ng(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function jW(n,e=!1){const t=Rn(n),i=await t.getIdToken(e),r=hI(i);ze(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const s=typeof r.firebase=="object"?r.firebase:void 0,a=s==null?void 0:s.sign_in_provider;return{claims:r,token:i,authTime:Ng(Zx(r.auth_time)),issuedAtTime:Ng(Zx(r.iat)),expirationTime:Ng(Zx(r.exp)),signInProvider:a||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function Zx(n){return Number(n)*1e3}function hI(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return Jw("JWT malformed, contained fewer than 3 sections"),null;try{const r=jL(t);return r?JSON.parse(r):(Jw("Failed to decode base64 JWT payload"),null)}catch(r){return Jw("Caught error parsing JWT payload as JSON",r==null?void 0:r.toString()),null}}function j$(n){const e=hI(n);return ze(e,"internal-error"),ze(typeof e.exp<"u","internal-error"),ze(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ly(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof Ba&&BW(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function BW({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UW{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const i=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fT{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ng(this.lastLoginAt),this.creationTime=Ng(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pb(n){var h;const e=n.auth,t=await n.getIdToken(),i=await ly(n,fb(e,{idToken:t}));ze(i==null?void 0:i.users.length,e,"internal-error");const r=i.users[0];n._notifyReloadListener(r);const s=(h=r.providerUserInfo)!=null&&h.length?r4(r.providerUserInfo):[],a=WW(n.providerData,s),o=n.isAnonymous,l=!(n.email&&r.passwordHash)&&!(a!=null&&a.length),u=o?l:!1,c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new fT(r.createdAt,r.lastLoginAt),isAnonymous:u};Object.assign(n,c)}async function HW(n){const e=Rn(n);await pb(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function WW(n,e){return[...n.filter(i=>!e.some(r=>r.providerId===i.providerId)),...e]}function r4(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qW(n,e){const t=await n4(n,{},async()=>{const i=ev({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:s}=n.config,a=await i4(n,r,"/v1/token",`key=${s}`),o=await n._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:o,body:i};return n.emulatorConfig&&Qd(n.emulatorConfig.host)&&(l.credentials="include"),t4.fetch()(a,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function GW(n,e){return Pu(n,"POST","/v2/accounts:revokeToken",Ru(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rf{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ze(e.idToken,"internal-error"),ze(typeof e.idToken<"u","internal-error"),ze(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):j$(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ze(e.length!==0,"internal-error");const t=j$(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ze(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:r,expiresIn:s}=await qW(e,t);this.updateTokensAndExpiration(i,r,Number(s))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:r,expirationTime:s}=t,a=new rf;return i&&(ze(typeof i=="string","internal-error",{appName:e}),a.refreshToken=i),r&&(ze(typeof r=="string","internal-error",{appName:e}),a.accessToken=r),s&&(ze(typeof s=="number","internal-error",{appName:e}),a.expirationTime=s),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new rf,this.toJSON())}_performRefresh(){return Mo("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ul(n,e){ze(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Ms{constructor({uid:e,auth:t,stsTokenManager:i,...r}){this.providerId="firebase",this.proactiveRefresh=new UW(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new fT(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await ly(this,this.stsTokenManager.getToken(this.auth,e));return ze(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return jW(this,e)}reload(){return HW(this)}_assign(e){this!==e&&(ze(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Ms({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){ze(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await pb(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ar(this.auth.app))return Promise.reject(Fo(this.auth));const e=await this.getIdToken();return await ly(this,VW(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const i=t.displayName??void 0,r=t.email??void 0,s=t.phoneNumber??void 0,a=t.photoURL??void 0,o=t.tenantId??void 0,l=t._redirectEventId??void 0,u=t.createdAt??void 0,c=t.lastLoginAt??void 0,{uid:h,emailVerified:f,isAnonymous:m,providerData:y,stsTokenManager:_}=t;ze(h&&_,e,"internal-error");const x=rf.fromJSON(this.name,_);ze(typeof h=="string",e,"internal-error"),ul(i,e.name),ul(r,e.name),ze(typeof f=="boolean",e,"internal-error"),ze(typeof m=="boolean",e,"internal-error"),ul(s,e.name),ul(a,e.name),ul(o,e.name),ul(l,e.name),ul(u,e.name),ul(c,e.name);const v=new Ms({uid:h,auth:e,email:r,emailVerified:f,displayName:i,isAnonymous:m,photoURL:a,phoneNumber:s,tenantId:o,stsTokenManager:x,createdAt:u,lastLoginAt:c});return y&&Array.isArray(y)&&(v.providerData=y.map(w=>({...w}))),l&&(v._redirectEventId=l),v}static async _fromIdTokenResponse(e,t,i=!1){const r=new rf;r.updateFromServerResponse(t);const s=new Ms({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:i});return await pb(s),s}static async _fromGetAccountInfoResponse(e,t,i){const r=t.users[0];ze(r.localId!==void 0,"internal-error");const s=r.providerUserInfo!==void 0?r4(r.providerUserInfo):[],a=!(r.email&&r.passwordHash)&&!(s!=null&&s.length),o=new rf;o.updateFromIdToken(i);const l=new Ms({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:a}),u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new fT(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(s!=null&&s.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B$=new Map;function Oo(n){Go(n instanceof Function,"Expected a class definition");let e=B$.get(n);return e?(Go(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,B$.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s4{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}s4.type="NONE";const U$=s4;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zw(n,e,t){return`firebase:${n}:${e}:${t}`}class sf{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:r,name:s}=this.auth;this.fullUserKey=Zw(this.userKey,r.apiKey,s),this.fullPersistenceKey=Zw("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await fb(this.auth,{idToken:e}).catch(()=>{});return t?Ms._fromGetAccountInfoResponse(this.auth,t,e):null}return Ms._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new sf(Oo(U$),e,i);const r=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let s=r[0]||Oo(U$);const a=Zw(i,e.config.apiKey,e.name);let o=null;for(const u of t)try{const c=await u._get(a);if(c){let h;if(typeof c=="string"){const f=await fb(e,{idToken:c}).catch(()=>{});if(!f)break;h=await Ms._fromGetAccountInfoResponse(e,f,c)}else h=Ms._fromJSON(e,c);u!==s&&(o=h),s=u;break}}catch{}const l=r.filter(u=>u._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new sf(s,e,i):(s=l[0],o&&await s._set(a,o.toJSON()),await Promise.all(t.map(async u=>{if(u!==s)try{await u._remove(a)}catch{}})),new sf(s,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H$(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(u4(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(a4(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(d4(e))return"Blackberry";if(h4(e))return"Webos";if(o4(e))return"Safari";if((e.includes("chrome/")||l4(e))&&!e.includes("edge/"))return"Chrome";if(c4(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if((i==null?void 0:i.length)===2)return i[1]}return"Other"}function a4(n=xi()){return/firefox\//i.test(n)}function o4(n=xi()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function l4(n=xi()){return/crios\//i.test(n)}function u4(n=xi()){return/iemobile/i.test(n)}function c4(n=xi()){return/android/i.test(n)}function d4(n=xi()){return/blackberry/i.test(n)}function h4(n=xi()){return/webos/i.test(n)}function fI(n=xi()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function KW(n=xi()){var e;return fI(n)&&!!((e=window.navigator)!=null&&e.standalone)}function YW(){return u9()&&document.documentMode===10}function f4(n=xi()){return fI(n)||c4(n)||h4(n)||d4(n)||/windows phone/i.test(n)||u4(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p4(n,e=[]){let t;switch(n){case"Browser":t=H$(xi());break;case"Worker":t=`${H$(xi())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Jd}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XW{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=s=>new Promise((a,o)=>{try{const l=e(s);a(l)}catch(l){o(l)}});i.onAbort=t,this.queue.push(i);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i==null?void 0:i.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QW(n,e={}){return Pu(n,"GET","/v2/passwordPolicy",Ru(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JW=6;class ZW{constructor(e){var i;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??JW,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((i=e.allowedNonAlphanumericCharacters)==null?void 0:i.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const i=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let r=0;r<e.length;r++)i=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,r,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eq{constructor(e,t,i,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new W$(this),this.idTokenSubscription=new W$(this),this.beforeStateQueue=new XW(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ZL,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Oo(t)),this._initializationPromise=this.queue(async()=>{var i,r,s;if(!this._deleted&&(this.persistenceManager=await sf.create(this,e),(i=this._resolvePersistenceManagerAvailable)==null||i.call(this),!this._deleted)){if((r=this._popupRedirectResolver)!=null&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)==null?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await fb(this,{idToken:e}),i=await Ms._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var s;if(Ar(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(o,o))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let i=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(s=this.redirectUser)==null?void 0:s._redirectEventId,o=i==null?void 0:i._redirectEventId,l=await this.tryRedirectSignIn(e);(!a||a===o)&&(l!=null&&l.user)&&(i=l.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(a){i=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return ze(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await pb(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=PW()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ar(this.app))return Promise.reject(Fo(this));const t=e?Rn(e):null;return t&&ze(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ze(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ar(this.app)?Promise.reject(Fo(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ar(this.app)?Promise.reject(Fo(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Oo(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await QW(this),t=new ZW(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Z_("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),await GW(this,i)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Oo(e)||this._popupRedirectResolver;ze(t,this,"argument-error"),this.redirectPersistenceManager=await sf.create(this,[Oo(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)==null?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,r){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t);let a=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(ze(o,this,"internal-error"),o.then(()=>{a||s(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,i,r);return()=>{a=!0,l()}}else{const l=e.addObserver(t);return()=>{a=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ze(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=p4(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var r;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((r=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:r.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const i=await this._getAppCheckToken();return i&&(e["X-Firebase-AppCheck"]=i),e}async _getAppCheckToken(){var t;if(Ar(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&kW(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Zd(n){return Rn(n)}class W${constructor(e){this.auth=e,this.observer=null,this.addObserver=y9(t=>this.observer=t)}get next(){return ze(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $1={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function tq(n){$1=n}function m4(n){return $1.loadJS(n)}function nq(){return $1.recaptchaEnterpriseScript}function iq(){return $1.gapiScript}function rq(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class sq{constructor(){this.enterprise=new aq}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class aq{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const oq="recaptcha-enterprise",g4="NO_RECAPTCHA";class lq{constructor(e){this.type=oq,this.auth=Zd(e)}async verify(e="verify",t=!1){async function i(s){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise(async(a,o)=>{zW(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)o(new Error("recaptcha Enterprise site key undefined"));else{const u=new FW(l);return s.tenantId==null?s._agentRecaptchaConfig=u:s._tenantRecaptchaConfigs[s.tenantId]=u,a(u.siteKey)}}).catch(l=>{o(l)})})}function r(s,a,o){const l=window.grecaptcha;V$(l)?l.enterprise.ready(()=>{l.enterprise.execute(s,{action:e}).then(u=>{a(u)}).catch(()=>{a(g4)})}):o(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new sq().execute("siteKey",{action:"verify"}):new Promise((s,a)=>{i(this.auth).then(o=>{if(!t&&V$(window.grecaptcha))r(o,s,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let l=nq();l.length!==0&&(l+=o),m4(l).then(()=>{r(o,s,a)}).catch(u=>{a(u)})}}).catch(o=>{a(o)})})}}async function q$(n,e,t,i=!1,r=!1){const s=new lq(n);let a;if(r)a=g4;else try{a=await s.verify(t)}catch{a=await s.verify(t,!0)}const o={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in o){const l=o.phoneEnrollmentInfo.phoneNumber,u=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const l=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return i?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function pT(n,e,t,i,r){var s;if((s=n._getRecaptchaConfig())!=null&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await q$(n,e,t,t==="getOobCode");return i(n,a)}else return i(n,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await q$(n,e,t,t==="getOobCode");return i(n,o)}else return Promise.reject(a)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uq(n,e){const t=k1(n,"auth");if(t.isInitialized()){const r=t.getImmediate(),s=t.getOptions();if(Md(s,e??{}))return r;Hs(r,"already-initialized")}return t.initialize({options:e})}function cq(n,e){const t=(e==null?void 0:e.persistence)||[],i=(Array.isArray(t)?t:[t]).map(Oo);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e==null?void 0:e.popupRedirectResolver)}function dq(n,e,t){const i=Zd(n);ze(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const r=!1,s=y4(e),{host:a,port:o}=hq(e),l=o===null?"":`:${o}`,u={url:`${s}//${a}${l}/`},c=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!i._canInitEmulator){ze(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),ze(Md(u,i.config.emulator)&&Md(c,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=u,i.emulatorConfig=c,i.settings.appVerificationDisabledForTesting=!0,Qd(a)?(sI(`${s}//${a}${l}`),aI("Auth",!0)):fq()}function y4(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function hq(n){const e=y4(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const s=r[1];return{host:s,port:G$(i.substr(s.length+1))}}else{const[s,a]=i.split(":");return{host:s,port:G$(a)}}}function G$(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function fq(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pI{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Mo("not implemented")}_getIdTokenResponse(e){return Mo("not implemented")}_linkToIdToken(e,t){return Mo("not implemented")}_getReauthenticationResolver(e){return Mo("not implemented")}}async function pq(n,e){return Pu(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mq(n,e){return nv(n,"POST","/v1/accounts:signInWithPassword",Ru(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gq(n,e){return nv(n,"POST","/v1/accounts:signInWithEmailLink",Ru(n,e))}async function yq(n,e){return nv(n,"POST","/v1/accounts:signInWithEmailLink",Ru(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uy extends pI{constructor(e,t,i,r=null){super("password",i),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new uy(e,t,"password")}static _fromEmailAndCode(e,t,i=null){return new uy(e,t,"emailLink",i)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return pT(e,t,"signInWithPassword",mq);case"emailLink":return gq(e,{email:this._email,oobCode:this._password});default:Hs(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const i={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return pT(e,i,"signUpPassword",pq);case"emailLink":return yq(e,{idToken:t,email:this._email,oobCode:this._password});default:Hs(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function af(n,e){return nv(n,"POST","/v1/accounts:signInWithIdp",Ru(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _q="http://localhost";class Ld extends pI{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ld(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Hs("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:r,...s}=t;if(!i||!r)return null;const a=new Ld(i,r);return a.idToken=s.idToken||void 0,a.accessToken=s.accessToken||void 0,a.secret=s.secret,a.nonce=s.nonce,a.pendingToken=s.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return af(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,af(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,af(e,t)}buildRequest(){const e={requestUri:_q,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ev(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vq(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function wq(n){const e=Ym(Xm(n)).link,t=e?Ym(Xm(e)).deep_link_id:null,i=Ym(Xm(n)).deep_link_id;return(i?Ym(Xm(i)).link:null)||i||t||e||n}class mI{constructor(e){const t=Ym(Xm(e)),i=t.apiKey??null,r=t.oobCode??null,s=vq(t.mode??null);ze(i&&r&&s,"argument-error"),this.apiKey=i,this.operation=s,this.code=r,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=wq(e);try{return new mI(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lp{constructor(){this.providerId=Lp.PROVIDER_ID}static credential(e,t){return uy._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const i=mI.parseLink(t);return ze(i,"argument-error"),uy._fromEmailAndCode(e,i.code,i.tenantId)}}Lp.PROVIDER_ID="password";Lp.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Lp.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _4{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iv extends _4{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _l extends iv{constructor(){super("facebook.com")}static credential(e){return Ld._fromParams({providerId:_l.PROVIDER_ID,signInMethod:_l.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return _l.credentialFromTaggedObject(e)}static credentialFromError(e){return _l.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return _l.credential(e.oauthAccessToken)}catch{return null}}}_l.FACEBOOK_SIGN_IN_METHOD="facebook.com";_l.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vl extends iv{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ld._fromParams({providerId:vl.PROVIDER_ID,signInMethod:vl.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return vl.credentialFromTaggedObject(e)}static credentialFromError(e){return vl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return vl.credential(t,i)}catch{return null}}}vl.GOOGLE_SIGN_IN_METHOD="google.com";vl.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wl extends iv{constructor(){super("github.com")}static credential(e){return Ld._fromParams({providerId:wl.PROVIDER_ID,signInMethod:wl.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return wl.credentialFromTaggedObject(e)}static credentialFromError(e){return wl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return wl.credential(e.oauthAccessToken)}catch{return null}}}wl.GITHUB_SIGN_IN_METHOD="github.com";wl.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bl extends iv{constructor(){super("twitter.com")}static credential(e,t){return Ld._fromParams({providerId:bl.PROVIDER_ID,signInMethod:bl.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return bl.credentialFromTaggedObject(e)}static credentialFromError(e){return bl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return bl.credential(t,i)}catch{return null}}}bl.TWITTER_SIGN_IN_METHOD="twitter.com";bl.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bq(n,e){return nv(n,"POST","/v1/accounts:signUp",Ru(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fd{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,r=!1){const s=await Ms._fromIdTokenResponse(e,i,r),a=K$(i);return new Fd({user:s,providerId:a,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const r=K$(i);return new Fd({user:e,providerId:r,_tokenResponse:i,operationType:t})}}function K$(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mb extends Ba{constructor(e,t,i,r){super(t.code,t.message),this.operationType=i,this.user=r,Object.setPrototypeOf(this,mb.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,r){return new mb(e,t,i,r)}}function v4(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?mb._fromErrorAndOperation(n,s,e,i):s})}async function xq(n,e,t=!1){const i=await ly(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Fd._forOperation(n,"link",i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Eq(n,e,t=!1){const{auth:i}=n;if(Ar(i.app))return Promise.reject(Fo(i));const r="reauthenticate";try{const s=await ly(n,v4(i,r,e,n),t);ze(s.idToken,i,"internal-error");const a=hI(s.idToken);ze(a,i,"internal-error");const{sub:o}=a;return ze(n.uid===o,i,"user-mismatch"),Fd._forOperation(n,r,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&Hs(i,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function w4(n,e,t=!1){if(Ar(n.app))return Promise.reject(Fo(n));const i="signIn",r=await v4(n,i,e),s=await Fd._fromIdTokenResponse(n,i,r);return t||await n._updateCurrentUser(s.user),s}async function Aq(n,e){return w4(Zd(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function b4(n){const e=Zd(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Tq(n,e,t){if(Ar(n.app))return Promise.reject(Fo(n));const i=Zd(n),a=await pT(i,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",bq).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&b4(n),l}),o=await Fd._fromIdTokenResponse(i,"signIn",a);return await i._updateCurrentUser(o.user),o}function Sq(n,e,t){return Ar(n.app)?Promise.reject(Fo(n)):Aq(Rn(n),Lp.credential(e,t)).catch(async i=>{throw i.code==="auth/password-does-not-meet-requirements"&&b4(n),i})}function Iq(n,e,t,i){return Rn(n).onIdTokenChanged(e,t,i)}function Cq(n,e,t){return Rn(n).beforeAuthStateChanged(e,t)}function kq(n,e,t,i){return Rn(n).onAuthStateChanged(e,t,i)}function $q(n){return Rn(n).signOut()}const gb="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x4{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(gb,"1"),this.storage.removeItem(gb),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rq=1e3,Pq=10;class E4 extends x4{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=f4(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),r=this.localCache[t];i!==r&&e(t,r,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,o,l)=>{this.notifyListeners(a,l)});return}const i=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const a=this.storage.getItem(i);!t&&this.localCache[i]===a||this.notifyListeners(i,a)},s=this.storage.getItem(i);YW()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,Pq):r()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const r of Array.from(i))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},Rq)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}E4.type="LOCAL";const Nq=E4;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A4 extends x4{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}A4.type="SESSION";const T4=A4;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dq(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R1{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const i=new R1(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:r,data:s}=t.data,a=this.handlersMap[r];if(!(a!=null&&a.size))return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:r});const o=Array.from(a).map(async u=>u(t.origin,s)),l=await Dq(o);t.ports[0].postMessage({status:"done",eventId:i,eventType:r,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}R1.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gI(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mq{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,a;return new Promise((o,l)=>{const u=gI("",20);r.port1.start();const c=setTimeout(()=>{l(new Error("unsupported_event"))},i);a={messageChannel:r,onMessage(h){const f=h;if(f.data.eventId===u)switch(f.data.status){case"ack":clearTimeout(c),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),o(f.data.response);break;default:clearTimeout(c),clearTimeout(s),l(new Error("invalid_response"));break}}},this.handlers.add(a),r.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[r.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Na(){return window}function Oq(n){Na().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S4(){return typeof Na().WorkerGlobalScope<"u"&&typeof Na().importScripts=="function"}async function Lq(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Fq(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function zq(){return S4()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I4="firebaseLocalStorageDb",Vq=1,yb="firebaseLocalStorage",C4="fbase_key";class rv{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function P1(n,e){return n.transaction([yb],e?"readwrite":"readonly").objectStore(yb)}function jq(){const n=indexedDB.deleteDatabase(I4);return new rv(n).toPromise()}function mT(){const n=indexedDB.open(I4,Vq);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(yb,{keyPath:C4})}catch(r){t(r)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(yb)?e(i):(i.close(),await jq(),e(await mT()))})})}async function Y$(n,e,t){const i=P1(n,!0).put({[C4]:e,value:t});return new rv(i).toPromise()}async function Bq(n,e){const t=P1(n,!1).get(e),i=await new rv(t).toPromise();return i===void 0?null:i.value}function X$(n,e){const t=P1(n,!0).delete(e);return new rv(t).toPromise()}const Uq=800,Hq=3;class k4{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await mT(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>Hq)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return S4()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=R1._getInstance(zq()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,i;if(this.activeServiceWorker=await Lq(),!this.activeServiceWorker)return;this.sender=new Mq(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(i=e[0])!=null&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Fq()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await mT();return await Y$(e,gb,"1"),await X$(e,gb),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>Y$(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>Bq(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>X$(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const s=P1(r,!1).getAll();return new rv(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;if(e.length!==0)for(const{fbase_key:r,value:s}of e)i.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(s)&&(this.notifyListeners(r,s),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!i.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const r of Array.from(i))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Uq)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}k4.type="LOCAL";const Wq=k4;new tv(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qq(n,e){return e?Oo(e):(ze(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yI extends pI{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return af(e,this._buildIdpRequest())}_linkToIdToken(e,t){return af(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return af(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Gq(n){return w4(n.auth,new yI(n),n.bypassAuthState)}function Kq(n){const{auth:e,user:t}=n;return ze(t,e,"internal-error"),Eq(t,new yI(n),n.bypassAuthState)}async function Yq(n){const{auth:e,user:t}=n;return ze(t,e,"internal-error"),xq(t,new yI(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $4{constructor(e,t,i,r,s=!1){this.auth=e,this.resolver=i,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:r,tenantId:s,error:a,type:o}=e;if(a){this.reject(a);return}const l={auth:this.auth,requestUri:t,sessionId:i,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Gq;case"linkViaPopup":case"linkViaRedirect":return Yq;case"reauthViaPopup":case"reauthViaRedirect":return Kq;default:Hs(this.auth,"internal-error")}}resolve(e){Go(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Go(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xq=new tv(2e3,1e4);class qh extends $4{constructor(e,t,i,r,s){super(e,t,r,s),this.provider=i,this.authWindow=null,this.pollId=null,qh.currentPopupAction&&qh.currentPopupAction.cancel(),qh.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ze(e,this.auth,"internal-error"),e}async onExecution(){Go(this.filter.length===1,"Popup operations only handle one event");const e=gI();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Pa(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Pa(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,qh.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if((i=(t=this.authWindow)==null?void 0:t.window)!=null&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Pa(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Xq.get())};e()}}qh.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qq="pendingRedirect",e0=new Map;class Jq extends $4{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=e0.get(this.auth._key());if(!e){try{const i=await Zq(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}e0.set(this.auth._key(),e)}return this.bypassAuthState||e0.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Zq(n,e){const t=nG(e),i=tG(n);if(!await i._isAvailable())return!1;const r=await i._get(t)==="true";return await i._remove(t),r}function eG(n,e){e0.set(n._key(),e)}function tG(n){return Oo(n._redirectPersistence)}function nG(n){return Zw(Qq,n.config.apiKey,n.name)}async function iG(n,e,t=!1){if(Ar(n.app))return Promise.reject(Fo(n));const i=Zd(n),r=qq(i,e),a=await new Jq(i,r,t).execute();return a&&!t&&(delete a.user._redirectEventId,await i._persistUserIfCurrent(a.user),await i._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rG=10*60*1e3;class sG{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!aG(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!R4(e)){const r=((i=e.error.code)==null?void 0:i.split("auth/")[1])||"internal-error";t.onError(Pa(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=rG&&this.cachedEventUids.clear(),this.cachedEventUids.has(Q$(e))}saveEventToCache(e){this.cachedEventUids.add(Q$(e)),this.lastProcessedEventTime=Date.now()}}function Q$(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function R4({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function aG(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return R4(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oG(n,e={}){return Pu(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lG=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,uG=/^https?/;async function cG(n){if(n.config.emulator)return;const{authorizedDomains:e}=await oG(n);for(const t of e)try{if(dG(t))return}catch{}Hs(n,"unauthorized-domain")}function dG(n){const e=hT(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===i}if(!uG.test(t))return!1;if(lG.test(n))return i===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hG=new tv(3e4,6e4);function J$(){const n=Na().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function fG(n){return new Promise((e,t)=>{var r,s,a;function i(){J$(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{J$(),t(Pa(n,"network-request-failed"))},timeout:hG.get()})}if((s=(r=Na().gapi)==null?void 0:r.iframes)!=null&&s.Iframe)e(gapi.iframes.getContext());else if((a=Na().gapi)!=null&&a.load)i();else{const o=rq("iframefcb");return Na()[o]=()=>{gapi.load?i():t(Pa(n,"network-request-failed"))},m4(`${iq()}?onload=${o}`).catch(l=>t(l))}}).catch(e=>{throw t0=null,e})}let t0=null;function pG(n){return t0=t0||fG(n),t0}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mG=new tv(5e3,15e3),gG="__/auth/iframe",yG="emulator/auth/iframe",_G={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},vG=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function wG(n){const e=n.config;ze(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?dI(e,yG):`https://${n.config.authDomain}/${gG}`,i={apiKey:e.apiKey,appName:n.name,v:Jd},r=vG.get(n.config.apiHost);r&&(i.eid=r);const s=n._getFrameworks();return s.length&&(i.fw=s.join(",")),`${t}?${ev(i).slice(1)}`}async function bG(n){const e=await pG(n),t=Na().gapi;return ze(t,n,"internal-error"),e.open({where:document.body,url:wG(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:_G,dontclear:!0},i=>new Promise(async(r,s)=>{await i.restyle({setHideOnLeave:!1});const a=Pa(n,"network-request-failed"),o=Na().setTimeout(()=>{s(a)},mG.get());function l(){Na().clearTimeout(o),r(i)}i.ping(l).then(l,()=>{s(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xG={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},EG=500,AG=600,TG="_blank",SG="http://localhost";class Z${constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function IG(n,e,t,i=EG,r=AG){const s=Math.max((window.screen.availHeight-r)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString();let o="";const l={...xG,width:i.toString(),height:r.toString(),top:s,left:a},u=xi().toLowerCase();t&&(o=l4(u)?TG:t),a4(u)&&(e=e||SG,l.scrollbars="yes");const c=Object.entries(l).reduce((f,[m,y])=>`${f}${m}=${y},`,"");if(KW(u)&&o!=="_self")return CG(e||"",o),new Z$(null);const h=window.open(e||"",o,c);ze(h,n,"popup-blocked");try{h.focus()}catch{}return new Z$(h)}function CG(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kG="__/auth/handler",$G="emulator/auth/handler",RG=encodeURIComponent("fac");async function eR(n,e,t,i,r,s){ze(n.config.authDomain,n,"auth-domain-config-required"),ze(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:Jd,eventId:r};if(e instanceof _4){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",g9(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[c,h]of Object.entries({}))a[c]=h}if(e instanceof iv){const c=e.getScopes().filter(h=>h!=="");c.length>0&&(a.scopes=c.join(","))}n.tenantId&&(a.tid=n.tenantId);const o=a;for(const c of Object.keys(o))o[c]===void 0&&delete o[c];const l=await n._getAppCheckToken(),u=l?`#${RG}=${encodeURIComponent(l)}`:"";return`${PG(n)}?${ev(o).slice(1)}${u}`}function PG({config:n}){return n.emulator?dI(n,$G):`https://${n.authDomain}/${kG}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eE="webStorageSupport";class NG{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=T4,this._completeRedirectFn=iG,this._overrideRedirectResult=eG}async _openPopup(e,t,i,r){var a;Go((a=this.eventManagers[e._key()])==null?void 0:a.manager,"_initialize() not called before _openPopup()");const s=await eR(e,t,i,hT(),r);return IG(e,s,gI())}async _openRedirect(e,t,i,r){await this._originValidation(e);const s=await eR(e,t,i,hT(),r);return Oq(s),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:s}=this.eventManagers[t];return r?Promise.resolve(r):(Go(s,"If manager is not set, promise should be"),s)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await bG(e),i=new sG(e);return t.register("authEvent",r=>(ze(r==null?void 0:r.authEvent,e,"invalid-auth-event"),{status:i.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(eE,{type:eE},r=>{var a;const s=(a=r==null?void 0:r[0])==null?void 0:a[eE];s!==void 0&&t(!!s),Hs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=cG(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return f4()||o4()||fI()}}const DG=NG;var tR="@firebase/auth",nR="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MG{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e((i==null?void 0:i.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ze(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OG(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function LG(n){Od(new yu("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=i.options;ze(a&&!a.includes(":"),"invalid-api-key",{appName:i.name});const l={apiKey:a,authDomain:o,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:p4(n)},u=new eq(i,r,s,l);return cq(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),Od(new yu("auth-internal",e=>{const t=Zd(e.getProvider("auth").getImmediate());return(i=>new MG(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ra(tR,nR,OG(n)),Ra(tR,nR,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FG=5*60,zG=WL("authIdTokenMaxAge")||FG;let iR=null;const VG=n=>async e=>{const t=e&&await e.getIdTokenResult(),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>zG)return;const r=t==null?void 0:t.token;iR!==r&&(iR=r,await fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function jG(n=uI()){const e=k1(n,"auth");if(e.isInitialized())return e.getImmediate();const t=uq(n,{popupRedirectResolver:DG,persistence:[Wq,Nq,T4]}),i=WL("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(i,location.origin);if(location.origin===s.origin){const a=VG(s.toString());Cq(t,a,()=>a(t.currentUser)),Iq(t,o=>a(o))}}const r=BL("auth");return r&&dq(t,`http://${r}`),t}function BG(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}tq({loadJS(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=r=>{const s=Pa("internal-error");s.customData=r,t(s)},i.type="text/javascript",i.charset="UTF-8",BG().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});LG("Browser");var UG="firebase",HG="12.8.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ra(UG,HG,"app");var rR=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var hu,P4;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(I,k){function N(){}N.prototype=k.prototype,I.F=k.prototype,I.prototype=new N,I.prototype.constructor=I,I.D=function(L,j,H){for(var M=Array(arguments.length-2),se=2;se<arguments.length;se++)M[se-2]=arguments[se];return k.prototype[j].apply(L,M)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(i,t),i.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(I,k,N){N||(N=0);const L=Array(16);if(typeof k=="string")for(var j=0;j<16;++j)L[j]=k.charCodeAt(N++)|k.charCodeAt(N++)<<8|k.charCodeAt(N++)<<16|k.charCodeAt(N++)<<24;else for(j=0;j<16;++j)L[j]=k[N++]|k[N++]<<8|k[N++]<<16|k[N++]<<24;k=I.g[0],N=I.g[1],j=I.g[2];let H=I.g[3],M;M=k+(H^N&(j^H))+L[0]+3614090360&4294967295,k=N+(M<<7&4294967295|M>>>25),M=H+(j^k&(N^j))+L[1]+3905402710&4294967295,H=k+(M<<12&4294967295|M>>>20),M=j+(N^H&(k^N))+L[2]+606105819&4294967295,j=H+(M<<17&4294967295|M>>>15),M=N+(k^j&(H^k))+L[3]+3250441966&4294967295,N=j+(M<<22&4294967295|M>>>10),M=k+(H^N&(j^H))+L[4]+4118548399&4294967295,k=N+(M<<7&4294967295|M>>>25),M=H+(j^k&(N^j))+L[5]+1200080426&4294967295,H=k+(M<<12&4294967295|M>>>20),M=j+(N^H&(k^N))+L[6]+2821735955&4294967295,j=H+(M<<17&4294967295|M>>>15),M=N+(k^j&(H^k))+L[7]+4249261313&4294967295,N=j+(M<<22&4294967295|M>>>10),M=k+(H^N&(j^H))+L[8]+1770035416&4294967295,k=N+(M<<7&4294967295|M>>>25),M=H+(j^k&(N^j))+L[9]+2336552879&4294967295,H=k+(M<<12&4294967295|M>>>20),M=j+(N^H&(k^N))+L[10]+4294925233&4294967295,j=H+(M<<17&4294967295|M>>>15),M=N+(k^j&(H^k))+L[11]+2304563134&4294967295,N=j+(M<<22&4294967295|M>>>10),M=k+(H^N&(j^H))+L[12]+1804603682&4294967295,k=N+(M<<7&4294967295|M>>>25),M=H+(j^k&(N^j))+L[13]+4254626195&4294967295,H=k+(M<<12&4294967295|M>>>20),M=j+(N^H&(k^N))+L[14]+2792965006&4294967295,j=H+(M<<17&4294967295|M>>>15),M=N+(k^j&(H^k))+L[15]+1236535329&4294967295,N=j+(M<<22&4294967295|M>>>10),M=k+(j^H&(N^j))+L[1]+4129170786&4294967295,k=N+(M<<5&4294967295|M>>>27),M=H+(N^j&(k^N))+L[6]+3225465664&4294967295,H=k+(M<<9&4294967295|M>>>23),M=j+(k^N&(H^k))+L[11]+643717713&4294967295,j=H+(M<<14&4294967295|M>>>18),M=N+(H^k&(j^H))+L[0]+3921069994&4294967295,N=j+(M<<20&4294967295|M>>>12),M=k+(j^H&(N^j))+L[5]+3593408605&4294967295,k=N+(M<<5&4294967295|M>>>27),M=H+(N^j&(k^N))+L[10]+38016083&4294967295,H=k+(M<<9&4294967295|M>>>23),M=j+(k^N&(H^k))+L[15]+3634488961&4294967295,j=H+(M<<14&4294967295|M>>>18),M=N+(H^k&(j^H))+L[4]+3889429448&4294967295,N=j+(M<<20&4294967295|M>>>12),M=k+(j^H&(N^j))+L[9]+568446438&4294967295,k=N+(M<<5&4294967295|M>>>27),M=H+(N^j&(k^N))+L[14]+3275163606&4294967295,H=k+(M<<9&4294967295|M>>>23),M=j+(k^N&(H^k))+L[3]+4107603335&4294967295,j=H+(M<<14&4294967295|M>>>18),M=N+(H^k&(j^H))+L[8]+1163531501&4294967295,N=j+(M<<20&4294967295|M>>>12),M=k+(j^H&(N^j))+L[13]+2850285829&4294967295,k=N+(M<<5&4294967295|M>>>27),M=H+(N^j&(k^N))+L[2]+4243563512&4294967295,H=k+(M<<9&4294967295|M>>>23),M=j+(k^N&(H^k))+L[7]+1735328473&4294967295,j=H+(M<<14&4294967295|M>>>18),M=N+(H^k&(j^H))+L[12]+2368359562&4294967295,N=j+(M<<20&4294967295|M>>>12),M=k+(N^j^H)+L[5]+4294588738&4294967295,k=N+(M<<4&4294967295|M>>>28),M=H+(k^N^j)+L[8]+2272392833&4294967295,H=k+(M<<11&4294967295|M>>>21),M=j+(H^k^N)+L[11]+1839030562&4294967295,j=H+(M<<16&4294967295|M>>>16),M=N+(j^H^k)+L[14]+4259657740&4294967295,N=j+(M<<23&4294967295|M>>>9),M=k+(N^j^H)+L[1]+2763975236&4294967295,k=N+(M<<4&4294967295|M>>>28),M=H+(k^N^j)+L[4]+1272893353&4294967295,H=k+(M<<11&4294967295|M>>>21),M=j+(H^k^N)+L[7]+4139469664&4294967295,j=H+(M<<16&4294967295|M>>>16),M=N+(j^H^k)+L[10]+3200236656&4294967295,N=j+(M<<23&4294967295|M>>>9),M=k+(N^j^H)+L[13]+681279174&4294967295,k=N+(M<<4&4294967295|M>>>28),M=H+(k^N^j)+L[0]+3936430074&4294967295,H=k+(M<<11&4294967295|M>>>21),M=j+(H^k^N)+L[3]+3572445317&4294967295,j=H+(M<<16&4294967295|M>>>16),M=N+(j^H^k)+L[6]+76029189&4294967295,N=j+(M<<23&4294967295|M>>>9),M=k+(N^j^H)+L[9]+3654602809&4294967295,k=N+(M<<4&4294967295|M>>>28),M=H+(k^N^j)+L[12]+3873151461&4294967295,H=k+(M<<11&4294967295|M>>>21),M=j+(H^k^N)+L[15]+530742520&4294967295,j=H+(M<<16&4294967295|M>>>16),M=N+(j^H^k)+L[2]+3299628645&4294967295,N=j+(M<<23&4294967295|M>>>9),M=k+(j^(N|~H))+L[0]+4096336452&4294967295,k=N+(M<<6&4294967295|M>>>26),M=H+(N^(k|~j))+L[7]+1126891415&4294967295,H=k+(M<<10&4294967295|M>>>22),M=j+(k^(H|~N))+L[14]+2878612391&4294967295,j=H+(M<<15&4294967295|M>>>17),M=N+(H^(j|~k))+L[5]+4237533241&4294967295,N=j+(M<<21&4294967295|M>>>11),M=k+(j^(N|~H))+L[12]+1700485571&4294967295,k=N+(M<<6&4294967295|M>>>26),M=H+(N^(k|~j))+L[3]+2399980690&4294967295,H=k+(M<<10&4294967295|M>>>22),M=j+(k^(H|~N))+L[10]+4293915773&4294967295,j=H+(M<<15&4294967295|M>>>17),M=N+(H^(j|~k))+L[1]+2240044497&4294967295,N=j+(M<<21&4294967295|M>>>11),M=k+(j^(N|~H))+L[8]+1873313359&4294967295,k=N+(M<<6&4294967295|M>>>26),M=H+(N^(k|~j))+L[15]+4264355552&4294967295,H=k+(M<<10&4294967295|M>>>22),M=j+(k^(H|~N))+L[6]+2734768916&4294967295,j=H+(M<<15&4294967295|M>>>17),M=N+(H^(j|~k))+L[13]+1309151649&4294967295,N=j+(M<<21&4294967295|M>>>11),M=k+(j^(N|~H))+L[4]+4149444226&4294967295,k=N+(M<<6&4294967295|M>>>26),M=H+(N^(k|~j))+L[11]+3174756917&4294967295,H=k+(M<<10&4294967295|M>>>22),M=j+(k^(H|~N))+L[2]+718787259&4294967295,j=H+(M<<15&4294967295|M>>>17),M=N+(H^(j|~k))+L[9]+3951481745&4294967295,I.g[0]=I.g[0]+k&4294967295,I.g[1]=I.g[1]+(j+(M<<21&4294967295|M>>>11))&4294967295,I.g[2]=I.g[2]+j&4294967295,I.g[3]=I.g[3]+H&4294967295}i.prototype.v=function(I,k){k===void 0&&(k=I.length);const N=k-this.blockSize,L=this.C;let j=this.h,H=0;for(;H<k;){if(j==0)for(;H<=N;)r(this,I,H),H+=this.blockSize;if(typeof I=="string"){for(;H<k;)if(L[j++]=I.charCodeAt(H++),j==this.blockSize){r(this,L),j=0;break}}else for(;H<k;)if(L[j++]=I[H++],j==this.blockSize){r(this,L),j=0;break}}this.h=j,this.o+=k},i.prototype.A=function(){var I=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);I[0]=128;for(var k=1;k<I.length-8;++k)I[k]=0;k=this.o*8;for(var N=I.length-8;N<I.length;++N)I[N]=k&255,k/=256;for(this.v(I),I=Array(16),k=0,N=0;N<4;++N)for(let L=0;L<32;L+=8)I[k++]=this.g[N]>>>L&255;return I};function s(I,k){var N=o;return Object.prototype.hasOwnProperty.call(N,I)?N[I]:N[I]=k(I)}function a(I,k){this.h=k;const N=[];let L=!0;for(let j=I.length-1;j>=0;j--){const H=I[j]|0;L&&H==k||(N[j]=H,L=!1)}this.g=N}var o={};function l(I){return-128<=I&&I<128?s(I,function(k){return new a([k|0],k<0?-1:0)}):new a([I|0],I<0?-1:0)}function u(I){if(isNaN(I)||!isFinite(I))return h;if(I<0)return x(u(-I));const k=[];let N=1;for(let L=0;I>=N;L++)k[L]=I/N|0,N*=4294967296;return new a(k,0)}function c(I,k){if(I.length==0)throw Error("number format error: empty string");if(k=k||10,k<2||36<k)throw Error("radix out of range: "+k);if(I.charAt(0)=="-")return x(c(I.substring(1),k));if(I.indexOf("-")>=0)throw Error('number format error: interior "-" character');const N=u(Math.pow(k,8));let L=h;for(let H=0;H<I.length;H+=8){var j=Math.min(8,I.length-H);const M=parseInt(I.substring(H,H+j),k);j<8?(j=u(Math.pow(k,j)),L=L.j(j).add(u(M))):(L=L.j(N),L=L.add(u(M)))}return L}var h=l(0),f=l(1),m=l(16777216);n=a.prototype,n.m=function(){if(_(this))return-x(this).m();let I=0,k=1;for(let N=0;N<this.g.length;N++){const L=this.i(N);I+=(L>=0?L:4294967296+L)*k,k*=4294967296}return I},n.toString=function(I){if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(y(this))return"0";if(_(this))return"-"+x(this).toString(I);const k=u(Math.pow(I,6));var N=this;let L="";for(;;){const j=C(N,k).g;N=v(N,j.j(k));let H=((N.g.length>0?N.g[0]:N.h)>>>0).toString(I);if(N=j,y(N))return H+L;for(;H.length<6;)H="0"+H;L=H+L}},n.i=function(I){return I<0?0:I<this.g.length?this.g[I]:this.h};function y(I){if(I.h!=0)return!1;for(let k=0;k<I.g.length;k++)if(I.g[k]!=0)return!1;return!0}function _(I){return I.h==-1}n.l=function(I){return I=v(this,I),_(I)?-1:y(I)?0:1};function x(I){const k=I.g.length,N=[];for(let L=0;L<k;L++)N[L]=~I.g[L];return new a(N,~I.h).add(f)}n.abs=function(){return _(this)?x(this):this},n.add=function(I){const k=Math.max(this.g.length,I.g.length),N=[];let L=0;for(let j=0;j<=k;j++){let H=L+(this.i(j)&65535)+(I.i(j)&65535),M=(H>>>16)+(this.i(j)>>>16)+(I.i(j)>>>16);L=M>>>16,H&=65535,M&=65535,N[j]=M<<16|H}return new a(N,N[N.length-1]&-2147483648?-1:0)};function v(I,k){return I.add(x(k))}n.j=function(I){if(y(this)||y(I))return h;if(_(this))return _(I)?x(this).j(x(I)):x(x(this).j(I));if(_(I))return x(this.j(x(I)));if(this.l(m)<0&&I.l(m)<0)return u(this.m()*I.m());const k=this.g.length+I.g.length,N=[];for(var L=0;L<2*k;L++)N[L]=0;for(L=0;L<this.g.length;L++)for(let j=0;j<I.g.length;j++){const H=this.i(L)>>>16,M=this.i(L)&65535,se=I.i(j)>>>16,ue=I.i(j)&65535;N[2*L+2*j]+=M*ue,w(N,2*L+2*j),N[2*L+2*j+1]+=H*ue,w(N,2*L+2*j+1),N[2*L+2*j+1]+=M*se,w(N,2*L+2*j+1),N[2*L+2*j+2]+=H*se,w(N,2*L+2*j+2)}for(I=0;I<k;I++)N[I]=N[2*I+1]<<16|N[2*I];for(I=k;I<2*k;I++)N[I]=0;return new a(N,0)};function w(I,k){for(;(I[k]&65535)!=I[k];)I[k+1]+=I[k]>>>16,I[k]&=65535,k++}function E(I,k){this.g=I,this.h=k}function C(I,k){if(y(k))throw Error("division by zero");if(y(I))return new E(h,h);if(_(I))return k=C(x(I),k),new E(x(k.g),x(k.h));if(_(k))return k=C(I,x(k)),new E(x(k.g),k.h);if(I.g.length>30){if(_(I)||_(k))throw Error("slowDivide_ only works with positive integers.");for(var N=f,L=k;L.l(I)<=0;)N=D(N),L=D(L);var j=V(N,1),H=V(L,1);for(L=V(L,2),N=V(N,2);!y(L);){var M=H.add(L);M.l(I)<=0&&(j=j.add(N),H=M),L=V(L,1),N=V(N,1)}return k=v(I,j.j(k)),new E(j,k)}for(j=h;I.l(k)>=0;){for(N=Math.max(1,Math.floor(I.m()/k.m())),L=Math.ceil(Math.log(N)/Math.LN2),L=L<=48?1:Math.pow(2,L-48),H=u(N),M=H.j(k);_(M)||M.l(I)>0;)N-=L,H=u(N),M=H.j(k);y(H)&&(H=f),j=j.add(H),I=v(I,M)}return new E(j,I)}n.B=function(I){return C(this,I).h},n.and=function(I){const k=Math.max(this.g.length,I.g.length),N=[];for(let L=0;L<k;L++)N[L]=this.i(L)&I.i(L);return new a(N,this.h&I.h)},n.or=function(I){const k=Math.max(this.g.length,I.g.length),N=[];for(let L=0;L<k;L++)N[L]=this.i(L)|I.i(L);return new a(N,this.h|I.h)},n.xor=function(I){const k=Math.max(this.g.length,I.g.length),N=[];for(let L=0;L<k;L++)N[L]=this.i(L)^I.i(L);return new a(N,this.h^I.h)};function D(I){const k=I.g.length+1,N=[];for(let L=0;L<k;L++)N[L]=I.i(L)<<1|I.i(L-1)>>>31;return new a(N,I.h)}function V(I,k){const N=k>>5;k%=32;const L=I.g.length-N,j=[];for(let H=0;H<L;H++)j[H]=k>0?I.i(H+N)>>>k|I.i(H+N+1)<<32-k:I.i(H+N);return new a(j,I.h)}i.prototype.digest=i.prototype.A,i.prototype.reset=i.prototype.u,i.prototype.update=i.prototype.v,P4=i,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=u,a.fromString=c,hu=a}).apply(typeof rR<"u"?rR:typeof self<"u"?self:typeof window<"u"?window:{});var fw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var N4,Qm,D4,n0,gT,M4,O4,L4;(function(){var n,e=Object.defineProperty;function t(p){p=[typeof globalThis=="object"&&globalThis,p,typeof window=="object"&&window,typeof self=="object"&&self,typeof fw=="object"&&fw];for(var A=0;A<p.length;++A){var P=p[A];if(P&&P.Math==Math)return P}throw Error("Cannot find global object")}var i=t(this);function r(p,A){if(A)e:{var P=i;p=p.split(".");for(var B=0;B<p.length-1;B++){var te=p[B];if(!(te in P))break e;P=P[te]}p=p[p.length-1],B=P[p],A=A(B),A!=B&&A!=null&&e(P,p,{configurable:!0,writable:!0,value:A})}}r("Symbol.dispose",function(p){return p||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(p){return p||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(p){return p||function(A){var P=[],B;for(B in A)Object.prototype.hasOwnProperty.call(A,B)&&P.push([B,A[B]]);return P}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var s=s||{},a=this||self;function o(p){var A=typeof p;return A=="object"&&p!=null||A=="function"}function l(p,A,P){return p.call.apply(p.bind,arguments)}function u(p,A,P){return u=l,u.apply(null,arguments)}function c(p,A){var P=Array.prototype.slice.call(arguments,1);return function(){var B=P.slice();return B.push.apply(B,arguments),p.apply(this,B)}}function h(p,A){function P(){}P.prototype=A.prototype,p.Z=A.prototype,p.prototype=new P,p.prototype.constructor=p,p.Ob=function(B,te,re){for(var ye=Array(arguments.length-2),Ge=2;Ge<arguments.length;Ge++)ye[Ge-2]=arguments[Ge];return A.prototype[te].apply(B,ye)}}var f=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?p=>p&&AsyncContext.Snapshot.wrap(p):p=>p;function m(p){const A=p.length;if(A>0){const P=Array(A);for(let B=0;B<A;B++)P[B]=p[B];return P}return[]}function y(p,A){for(let B=1;B<arguments.length;B++){const te=arguments[B];var P=typeof te;if(P=P!="object"?P:te?Array.isArray(te)?"array":P:"null",P=="array"||P=="object"&&typeof te.length=="number"){P=p.length||0;const re=te.length||0;p.length=P+re;for(let ye=0;ye<re;ye++)p[P+ye]=te[ye]}else p.push(te)}}class _{constructor(A,P){this.i=A,this.j=P,this.h=0,this.g=null}get(){let A;return this.h>0?(this.h--,A=this.g,this.g=A.next,A.next=null):A=this.i(),A}}function x(p){a.setTimeout(()=>{throw p},0)}function v(){var p=I;let A=null;return p.g&&(A=p.g,p.g=p.g.next,p.g||(p.h=null),A.next=null),A}class w{constructor(){this.h=this.g=null}add(A,P){const B=E.get();B.set(A,P),this.h?this.h.next=B:this.g=B,this.h=B}}var E=new _(()=>new C,p=>p.reset());class C{constructor(){this.next=this.g=this.h=null}set(A,P){this.h=A,this.g=P,this.next=null}reset(){this.next=this.g=this.h=null}}let D,V=!1,I=new w,k=()=>{const p=Promise.resolve(void 0);D=()=>{p.then(N)}};function N(){for(var p;p=v();){try{p.h.call(p.g)}catch(P){x(P)}var A=E;A.j(p),A.h<100&&(A.h++,p.next=A.g,A.g=p)}V=!1}function L(){this.u=this.u,this.C=this.C}L.prototype.u=!1,L.prototype.dispose=function(){this.u||(this.u=!0,this.N())},L.prototype[Symbol.dispose]=function(){this.dispose()},L.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function j(p,A){this.type=p,this.g=this.target=A,this.defaultPrevented=!1}j.prototype.h=function(){this.defaultPrevented=!0};var H=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var p=!1,A=Object.defineProperty({},"passive",{get:function(){p=!0}});try{const P=()=>{};a.addEventListener("test",P,A),a.removeEventListener("test",P,A)}catch{}return p}();function M(p){return/^[\s\xa0]*$/.test(p)}function se(p,A){j.call(this,p?p.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,p&&this.init(p,A)}h(se,j),se.prototype.init=function(p,A){const P=this.type=p.type,B=p.changedTouches&&p.changedTouches.length?p.changedTouches[0]:null;this.target=p.target||p.srcElement,this.g=A,A=p.relatedTarget,A||(P=="mouseover"?A=p.fromElement:P=="mouseout"&&(A=p.toElement)),this.relatedTarget=A,B?(this.clientX=B.clientX!==void 0?B.clientX:B.pageX,this.clientY=B.clientY!==void 0?B.clientY:B.pageY,this.screenX=B.screenX||0,this.screenY=B.screenY||0):(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0),this.button=p.button,this.key=p.key||"",this.ctrlKey=p.ctrlKey,this.altKey=p.altKey,this.shiftKey=p.shiftKey,this.metaKey=p.metaKey,this.pointerId=p.pointerId||0,this.pointerType=p.pointerType,this.state=p.state,this.i=p,p.defaultPrevented&&se.Z.h.call(this)},se.prototype.h=function(){se.Z.h.call(this);const p=this.i;p.preventDefault?p.preventDefault():p.returnValue=!1};var ue="closure_listenable_"+(Math.random()*1e6|0),ee=0;function ae(p,A,P,B,te){this.listener=p,this.proxy=null,this.src=A,this.type=P,this.capture=!!B,this.ha=te,this.key=++ee,this.da=this.fa=!1}function J(p){p.da=!0,p.listener=null,p.proxy=null,p.src=null,p.ha=null}function q(p,A,P){for(const B in p)A.call(P,p[B],B,p)}function G(p,A){for(const P in p)A.call(void 0,p[P],P,p)}function U(p){const A={};for(const P in p)A[P]=p[P];return A}const Y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function K(p,A){let P,B;for(let te=1;te<arguments.length;te++){B=arguments[te];for(P in B)p[P]=B[P];for(let re=0;re<Y.length;re++)P=Y[re],Object.prototype.hasOwnProperty.call(B,P)&&(p[P]=B[P])}}function Z(p){this.src=p,this.g={},this.h=0}Z.prototype.add=function(p,A,P,B,te){const re=p.toString();p=this.g[re],p||(p=this.g[re]=[],this.h++);const ye=ve(p,A,B,te);return ye>-1?(A=p[ye],P||(A.fa=!1)):(A=new ae(A,this.src,re,!!B,te),A.fa=P,p.push(A)),A};function ge(p,A){const P=A.type;if(P in p.g){var B=p.g[P],te=Array.prototype.indexOf.call(B,A,void 0),re;(re=te>=0)&&Array.prototype.splice.call(B,te,1),re&&(J(A),p.g[P].length==0&&(delete p.g[P],p.h--))}}function ve(p,A,P,B){for(let te=0;te<p.length;++te){const re=p[te];if(!re.da&&re.listener==A&&re.capture==!!P&&re.ha==B)return te}return-1}var Q="closure_lm_"+(Math.random()*1e6|0),be={};function vt(p,A,P,B,te){if(Array.isArray(A)){for(let re=0;re<A.length;re++)vt(p,A[re],P,B,te);return null}return P=is(P),p&&p[ue]?p.J(A,P,o(B)?!!B.capture:!1,te):mt(p,A,P,!1,B,te)}function mt(p,A,P,B,te,re){if(!A)throw Error("Invalid event type");const ye=o(te)?!!te.capture:!!te;let Ge=ns(p);if(Ge||(p[Q]=Ge=new Z(p)),P=Ge.add(A,P,B,ye,re),P.proxy)return P;if(B=nn(),P.proxy=B,B.src=p,B.listener=P,p.addEventListener)H||(te=ye),te===void 0&&(te=!1),p.addEventListener(A.toString(),B,te);else if(p.attachEvent)p.attachEvent(ii(A.toString()),B);else if(p.addListener&&p.removeListener)p.addListener(B);else throw Error("addEventListener and attachEvent are unavailable.");return P}function nn(){function p(P){return A.call(p.src,p.listener,P)}const A=Ha;return p}function at(p,A,P,B,te){if(Array.isArray(A))for(var re=0;re<A.length;re++)at(p,A[re],P,B,te);else B=o(B)?!!B.capture:!!B,P=is(P),p&&p[ue]?(p=p.i,re=String(A).toString(),re in p.g&&(A=p.g[re],P=ve(A,P,B,te),P>-1&&(J(A[P]),Array.prototype.splice.call(A,P,1),A.length==0&&(delete p.g[re],p.h--)))):p&&(p=ns(p))&&(A=p.g[A.toString()],p=-1,A&&(p=ve(A,P,B,te)),(P=p>-1?A[p]:null)&&Tt(P))}function Tt(p){if(typeof p!="number"&&p&&!p.da){var A=p.src;if(A&&A[ue])ge(A.i,p);else{var P=p.type,B=p.proxy;A.removeEventListener?A.removeEventListener(P,B,p.capture):A.detachEvent?A.detachEvent(ii(P),B):A.addListener&&A.removeListener&&A.removeListener(B),(P=ns(A))?(ge(P,p),P.h==0&&(P.src=null,A[Q]=null)):J(p)}}}function ii(p){return p in be?be[p]:be[p]="on"+p}function Ha(p,A){if(p.da)p=!0;else{A=new se(A,this);const P=p.listener,B=p.ha||p.src;p.fa&&Tt(p),p=P.call(B,A)}return p}function ns(p){return p=p[Q],p instanceof Z?p:null}var ah="__closure_events_fn_"+(Math.random()*1e9>>>0);function is(p){return typeof p=="function"?p:(p[ah]||(p[ah]=function(A){return p.handleEvent(A)}),p[ah])}function wn(){L.call(this),this.i=new Z(this),this.M=this,this.G=null}h(wn,L),wn.prototype[ue]=!0,wn.prototype.removeEventListener=function(p,A,P,B){at(this,p,A,P,B)};function bn(p,A){var P,B=p.G;if(B)for(P=[];B;B=B.G)P.push(B);if(p=p.M,B=A.type||A,typeof A=="string")A=new j(A,p);else if(A instanceof j)A.target=A.target||p;else{var te=A;A=new j(B,p),K(A,te)}te=!0;let re,ye;if(P)for(ye=P.length-1;ye>=0;ye--)re=A.g=P[ye],te=Lu(re,B,!0,A)&&te;if(re=A.g=p,te=Lu(re,B,!0,A)&&te,te=Lu(re,B,!1,A)&&te,P)for(ye=0;ye<P.length;ye++)re=A.g=P[ye],te=Lu(re,B,!1,A)&&te}wn.prototype.N=function(){if(wn.Z.N.call(this),this.i){var p=this.i;for(const A in p.g){const P=p.g[A];for(let B=0;B<P.length;B++)J(P[B]);delete p.g[A],p.h--}}this.G=null},wn.prototype.J=function(p,A,P,B){return this.i.add(String(p),A,!1,P,B)},wn.prototype.K=function(p,A,P,B){return this.i.add(String(p),A,!0,P,B)};function Lu(p,A,P,B){if(A=p.i.g[String(A)],!A)return!0;A=A.concat();let te=!0;for(let re=0;re<A.length;++re){const ye=A[re];if(ye&&!ye.da&&ye.capture==P){const Ge=ye.listener,rn=ye.ha||ye.src;ye.fa&&ge(p.i,ye),te=Ge.call(rn,B)!==!1&&te}}return te&&!B.defaultPrevented}function qp(p,A){if(typeof p!="function")if(p&&typeof p.handleEvent=="function")p=u(p.handleEvent,p);else throw Error("Invalid listener argument");return Number(A)>2147483647?-1:a.setTimeout(p,A||0)}function Gp(p){p.g=qp(()=>{p.g=null,p.i&&(p.i=!1,Gp(p))},p.l);const A=p.h;p.h=null,p.m.apply(null,A)}class Ks extends L{constructor(A,P){super(),this.m=A,this.l=P,this.h=null,this.i=!1,this.g=null}j(A){this.h=arguments,this.g?this.i=!0:Gp(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function gt(p){L.call(this),this.h=p,this.g={}}h(gt,L);var oh=[];function Kp(p){q(p.g,function(A,P){this.g.hasOwnProperty(P)&&Tt(A)},p),p.g={}}gt.prototype.N=function(){gt.Z.N.call(this),Kp(this)},gt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Fu=a.JSON.stringify,Ys=a.JSON.parse,zu=class{stringify(p){return a.JSON.stringify(p,void 0)}parse(p){return a.JSON.parse(p,void 0)}};function Yp(){}function Xs(){}var tl={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function lh(){j.call(this,"d")}h(lh,j);function uh(){j.call(this,"c")}h(uh,j);var Qs={},pv=null;function ch(){return pv=pv||new wn}Qs.Ia="serverreachability";function mv(p){j.call(this,Qs.Ia,p)}h(mv,j);function Vu(p){const A=ch();bn(A,new mv(A))}Qs.STAT_EVENT="statevent";function Xp(p,A){j.call(this,Qs.STAT_EVENT,p),this.stat=A}h(Xp,j);function Pn(p){const A=ch();bn(A,new Xp(A,p))}Qs.Ja="timingevent";function Qp(p,A){j.call(this,Qs.Ja,p),this.size=A}h(Qp,j);function nl(p,A){if(typeof p!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){p()},A)}function kt(){this.g=!0}kt.prototype.ua=function(){this.g=!1};function gv(p,A,P,B,te,re){p.info(function(){if(p.g)if(re){var ye="",Ge=re.split("&");for(let bt=0;bt<Ge.length;bt++){var rn=Ge[bt].split("=");if(rn.length>1){const dn=rn[0];rn=rn[1];const Mr=dn.split("_");ye=Mr.length>=2&&Mr[1]=="type"?ye+(dn+"="+rn+"&"):ye+(dn+"=redacted&")}}}else ye=null;else ye=re;return"XMLHTTP REQ ("+B+") [attempt "+te+"]: "+A+`
`+P+`
`+ye})}function yv(p,A,P,B,te,re,ye){p.info(function(){return"XMLHTTP RESP ("+B+") [ attempt "+te+"]: "+A+`
`+P+`
`+re+" "+ye})}function Wa(p,A,P,B){p.info(function(){return"XMLHTTP TEXT ("+A+"): "+vv(p,P)+(B?" "+B:"")})}function _v(p,A){p.info(function(){return"TIMEOUT: "+A})}kt.prototype.info=function(){};function vv(p,A){if(!p.g)return A;if(!A)return null;try{const re=JSON.parse(A);if(re){for(p=0;p<re.length;p++)if(Array.isArray(re[p])){var P=re[p];if(!(P.length<2)){var B=P[1];if(Array.isArray(B)&&!(B.length<1)){var te=B[0];if(te!="noop"&&te!="stop"&&te!="close")for(let ye=1;ye<B.length;ye++)B[ye]=""}}}}return Fu(re)}catch{return A}}var ju={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Jp={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Zp;function dh(){}h(dh,Yp),dh.prototype.g=function(){return new XMLHttpRequest},Zp=new dh;function il(p){return encodeURIComponent(String(p))}function wv(p){var A=1;p=p.split(":");const P=[];for(;A>0&&p.length;)P.push(p.shift()),A--;return p.length&&P.push(p.join(":")),P}function rs(p,A,P,B){this.j=p,this.i=A,this.l=P,this.S=B||1,this.V=new gt(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new em}function em(){this.i=null,this.g="",this.h=!1}var tm={},nm={};function zi(p,A,P){p.M=1,p.A=ph(Vi(A)),p.u=P,p.R=!0,hh(p,null)}function hh(p,A){p.F=Date.now(),Bu(p),p.B=Vi(p.A);var P=p.B,B=p.S;Array.isArray(B)||(B=[String(B)]),Cv(P.i,"t",B),p.C=0,P=p.j.L,p.h=new em,p.g=mm(p.j,P?A:null,!p.u),p.P>0&&(p.O=new Ks(u(p.Y,p,p.g),p.P)),A=p.V,P=p.g,B=p.ba;var te="readystatechange";Array.isArray(te)||(te&&(oh[0]=te.toString()),te=oh);for(let re=0;re<te.length;re++){const ye=vt(P,te[re],B||A.handleEvent,!1,A.h||A);if(!ye)break;A.g[ye.key]=ye}A=p.J?U(p.J):{},p.u?(p.v||(p.v="POST"),A["Content-Type"]="application/x-www-form-urlencoded",p.g.ea(p.B,p.v,p.u,A)):(p.v="GET",p.g.ea(p.B,p.v,null,A)),Vu(),gv(p.i,p.v,p.B,p.l,p.S,p.u)}rs.prototype.ba=function(p){p=p.target;const A=this.O;A&&ea(p)==3?A.j():this.Y(p)},rs.prototype.Y=function(p){try{if(p==this.g)e:{const Ge=ea(this.g),rn=this.g.ya(),bt=this.g.ca();if(!(Ge<3)&&(Ge!=3||this.g&&(this.h.h||this.g.la()||Mv(this.g)))){this.K||Ge!=4||rn==7||(rn==8||bt<=0?Vu(3):Vu(2)),Dr(this);var A=this.g.ca();this.X=A;var P=im(this);if(this.o=A==200,yv(this.i,this.v,this.B,this.l,this.S,Ge,A),this.o){if(this.U&&!this.L){t:{if(this.g){var B,te=this.g;if((B=te.g?te.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!M(B)){var re=B;break t}}re=null}if(p=re)Wa(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,rr(this,p);else{this.o=!1,this.m=3,Pn(12),as(this),Uu(this);break e}}if(this.R){p=!0;let dn;for(;!this.K&&this.C<P.length;)if(dn=ss(this,P),dn==nm){Ge==4&&(this.m=4,Pn(14),p=!1),Wa(this.i,this.l,null,"[Incomplete Response]");break}else if(dn==tm){this.m=4,Pn(15),Wa(this.i,this.l,P,"[Invalid Chunk]"),p=!1;break}else Wa(this.i,this.l,dn,null),rr(this,dn);if(qa(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ge!=4||P.length!=0||this.h.h||(this.m=1,Pn(16),p=!1),this.o=this.o&&p,!p)Wa(this.i,this.l,P,"[Invalid Chunked Response]"),as(this),Uu(this);else if(P.length>0&&!this.W){this.W=!0;var ye=this.j;ye.g==this&&ye.aa&&!ye.P&&(ye.j.info("Great, no buffering proxy detected. Bytes received: "+P.length),hm(ye),ye.P=!0,Pn(11))}}else Wa(this.i,this.l,P,null),rr(this,P);Ge==4&&as(this),this.o&&!this.K&&(Ge==4?fm(this.j,this):(this.o=!1,Bu(this)))}else Ov(this.g),A==400&&P.indexOf("Unknown SID")>0?(this.m=3,Pn(12)):(this.m=0,Pn(13)),as(this),Uu(this)}}}catch{}finally{}};function im(p){if(!qa(p))return p.g.la();const A=Mv(p.g);if(A==="")return"";let P="";const B=A.length,te=ea(p.g)==4;if(!p.h.i){if(typeof TextDecoder>"u")return as(p),Uu(p),"";p.h.i=new a.TextDecoder}for(let re=0;re<B;re++)p.h.h=!0,P+=p.h.i.decode(A[re],{stream:!(te&&re==B-1)});return A.length=0,p.h.g+=P,p.C=0,p.h.g}function qa(p){return p.g?p.v=="GET"&&p.M!=2&&p.j.Aa:!1}function ss(p,A){var P=p.C,B=A.indexOf(`
`,P);return B==-1?nm:(P=Number(A.substring(P,B)),isNaN(P)?tm:(B+=1,B+P>A.length?nm:(A=A.slice(B,B+P),p.C=B+P,A)))}rs.prototype.cancel=function(){this.K=!0,as(this)};function Bu(p){p.T=Date.now()+p.H,bv(p,p.H)}function bv(p,A){if(p.D!=null)throw Error("WatchDog timer not null");p.D=nl(u(p.aa,p),A)}function Dr(p){p.D&&(a.clearTimeout(p.D),p.D=null)}rs.prototype.aa=function(){this.D=null;const p=Date.now();p-this.T>=0?(_v(this.i,this.B),this.M!=2&&(Vu(),Pn(17)),as(this),this.m=2,Uu(this)):bv(this,this.T-p)};function Uu(p){p.j.I==0||p.K||fm(p.j,p)}function as(p){Dr(p);var A=p.O;A&&typeof A.dispose=="function"&&A.dispose(),p.O=null,Kp(p.V),p.g&&(A=p.g,p.g=null,A.abort(),A.dispose())}function rr(p,A){try{var P=p.j;if(P.I!=0&&(P.g==p||sm(P.h,p))){if(!p.L&&sm(P.h,p)&&P.I==3){try{var B=P.Ba.g.parse(A)}catch{B=null}if(Array.isArray(B)&&B.length==3){var te=B;if(te[0]==0){e:if(!P.v){if(P.g)if(P.g.F+3e3<p.F)_h(P),gh(P);else break e;dm(P),Pn(18)}}else P.xa=te[1],0<P.xa-P.K&&te[2]<37500&&P.F&&P.A==0&&!P.C&&(P.C=nl(u(P.Va,P),6e3));fh(P.h)<=1&&P.ta&&(P.ta=void 0)}else ta(P,11)}else if((p.L||P.g==p)&&_h(P),!M(A))for(te=P.Ba.g.parse(A),A=0;A<te.length;A++){let bt=te[A];const dn=bt[0];if(!(dn<=P.K))if(P.K=dn,bt=bt[1],P.I==2)if(bt[0]=="c"){P.M=bt[1],P.ba=bt[2];const Mr=bt[3];Mr!=null&&(P.ka=Mr,P.j.info("VER="+P.ka));const Or=bt[4];Or!=null&&(P.za=Or,P.j.info("SVER="+P.za));const Bi=bt[5];Bi!=null&&typeof Bi=="number"&&Bi>0&&(B=1.5*Bi,P.O=B,P.j.info("backChannelRequestTimeoutMs_="+B)),B=P;const ls=p.g;if(ls){const vh=ls.g?ls.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(vh){var re=B.h;re.g||vh.indexOf("spdy")==-1&&vh.indexOf("quic")==-1&&vh.indexOf("h2")==-1||(re.j=re.l,re.g=new Set,re.h&&(am(re,re.h),re.h=null))}if(B.G){const _m=ls.g?ls.g.getResponseHeader("X-HTTP-Session-Id"):null;_m&&(B.wa=_m,$t(B.J,B.G,_m))}}P.I=3,P.l&&P.l.ra(),P.aa&&(P.T=Date.now()-p.F,P.j.info("Handshake RTT: "+P.T+"ms")),B=P;var ye=p;if(B.na=Hv(B,B.L?B.ba:null,B.W),ye.L){xv(B.h,ye);var Ge=ye,rn=B.O;rn&&(Ge.H=rn),Ge.D&&(Dr(Ge),Bu(Ge)),B.g=ye}else jv(B);P.i.length>0&&yh(P)}else bt[0]!="stop"&&bt[0]!="close"||ta(P,7);else P.I==3&&(bt[0]=="stop"||bt[0]=="close"?bt[0]=="stop"?ta(P,7):cm(P):bt[0]!="noop"&&P.l&&P.l.qa(bt),P.A=0)}}Vu(4)}catch{}}var rm=class{constructor(p,A){this.g=p,this.map=A}};function Nn(p){this.l=p||10,a.PerformanceNavigationTiming?(p=a.performance.getEntriesByType("navigation"),p=p.length>0&&(p[0].nextHopProtocol=="hq"||p[0].nextHopProtocol=="h2")):p=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=p?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ei(p){return p.h?!0:p.g?p.g.size>=p.j:!1}function fh(p){return p.h?1:p.g?p.g.size:0}function sm(p,A){return p.h?p.h==A:p.g?p.g.has(A):!1}function am(p,A){p.g?p.g.add(A):p.h=A}function xv(p,A){p.h&&p.h==A?p.h=null:p.g&&p.g.has(A)&&p.g.delete(A)}Nn.prototype.cancel=function(){if(this.i=Ev(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const p of this.g.values())p.cancel();this.g.clear()}};function Ev(p){if(p.h!=null)return p.i.concat(p.h.G);if(p.g!=null&&p.g.size!==0){let A=p.i;for(const P of p.g.values())A=A.concat(P.G);return A}return m(p.i)}var Av=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function rx(p,A){if(p){p=p.split("&");for(let P=0;P<p.length;P++){const B=p[P].indexOf("=");let te,re=null;B>=0?(te=p[P].substring(0,B),re=p[P].substring(B+1)):te=p[P],A(te,re?decodeURIComponent(re.replace(/\+/g," ")):"")}}}function ri(p){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let A;p instanceof ri?(this.l=p.l,Hu(this,p.j),this.o=p.o,this.g=p.g,rl(this,p.u),this.h=p.h,om(this,kv(p.i)),this.m=p.m):p&&(A=String(p).match(Av))?(this.l=!1,Hu(this,A[1]||"",!0),this.o=Wu(A[2]||""),this.g=Wu(A[3]||"",!0),rl(this,A[4]),this.h=Wu(A[5]||"",!0),om(this,A[6]||"",!0),this.m=Wu(A[7]||"")):(this.l=!1,this.i=new Js(null,this.l))}ri.prototype.toString=function(){const p=[];var A=this.j;A&&p.push(qu(A,Tv,!0),":");var P=this.g;return(P||A=="file")&&(p.push("//"),(A=this.o)&&p.push(qu(A,Tv,!0),"@"),p.push(il(P).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),P=this.u,P!=null&&p.push(":",String(P))),(P=this.h)&&(this.g&&P.charAt(0)!="/"&&p.push("/"),p.push(qu(P,P.charAt(0)=="/"?ox:ax,!0))),(P=this.i.toString())&&p.push("?",P),(P=this.m)&&p.push("#",qu(P,um)),p.join("")},ri.prototype.resolve=function(p){const A=Vi(this);let P=!!p.j;P?Hu(A,p.j):P=!!p.o,P?A.o=p.o:P=!!p.g,P?A.g=p.g:P=p.u!=null;var B=p.h;if(P)rl(A,p.u);else if(P=!!p.h){if(B.charAt(0)!="/")if(this.g&&!this.h)B="/"+B;else{var te=A.h.lastIndexOf("/");te!=-1&&(B=A.h.slice(0,te+1)+B)}if(te=B,te==".."||te==".")B="";else if(te.indexOf("./")!=-1||te.indexOf("/.")!=-1){B=te.lastIndexOf("/",0)==0,te=te.split("/");const re=[];for(let ye=0;ye<te.length;){const Ge=te[ye++];Ge=="."?B&&ye==te.length&&re.push(""):Ge==".."?((re.length>1||re.length==1&&re[0]!="")&&re.pop(),B&&ye==te.length&&re.push("")):(re.push(Ge),B=!0)}B=re.join("/")}else B=te}return P?A.h=B:P=p.i.toString()!=="",P?om(A,kv(p.i)):P=!!p.m,P&&(A.m=p.m),A};function Vi(p){return new ri(p)}function Hu(p,A,P){p.j=P?Wu(A,!0):A,p.j&&(p.j=p.j.replace(/:$/,""))}function rl(p,A){if(A){if(A=Number(A),isNaN(A)||A<0)throw Error("Bad port number "+A);p.u=A}else p.u=null}function om(p,A,P){A instanceof Js?(p.i=A,$v(p.i,p.l)):(P||(A=qu(A,lm)),p.i=new Js(A,p.l))}function $t(p,A,P){p.i.set(A,P)}function ph(p){return $t(p,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),p}function Wu(p,A){return p?A?decodeURI(p.replace(/%25/g,"%2525")):decodeURIComponent(p):""}function qu(p,A,P){return typeof p=="string"?(p=encodeURI(p).replace(A,sx),P&&(p=p.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p):null}function sx(p){return p=p.charCodeAt(0),"%"+(p>>4&15).toString(16)+(p&15).toString(16)}var Tv=/[#\/\?@]/g,ax=/[#\?:]/g,ox=/[#\?]/g,lm=/[#\?@]/g,um=/#/g;function Js(p,A){this.h=this.g=null,this.i=p||null,this.j=!!A}function Ga(p){p.g||(p.g=new Map,p.h=0,p.i&&rx(p.i,function(A,P){p.add(decodeURIComponent(A.replace(/\+/g," ")),P)}))}n=Js.prototype,n.add=function(p,A){Ga(this),this.i=null,p=os(this,p);let P=this.g.get(p);return P||this.g.set(p,P=[]),P.push(A),this.h+=1,this};function mh(p,A){Ga(p),A=os(p,A),p.g.has(A)&&(p.i=null,p.h-=p.g.get(A).length,p.g.delete(A))}function Sv(p,A){return Ga(p),A=os(p,A),p.g.has(A)}n.forEach=function(p,A){Ga(this),this.g.forEach(function(P,B){P.forEach(function(te){p.call(A,te,B,this)},this)},this)};function Iv(p,A){Ga(p);let P=[];if(typeof A=="string")Sv(p,A)&&(P=P.concat(p.g.get(os(p,A))));else for(p=Array.from(p.g.values()),A=0;A<p.length;A++)P=P.concat(p[A]);return P}n.set=function(p,A){return Ga(this),this.i=null,p=os(this,p),Sv(this,p)&&(this.h-=this.g.get(p).length),this.g.set(p,[A]),this.h+=1,this},n.get=function(p,A){return p?(p=Iv(this,p),p.length>0?String(p[0]):A):A};function Cv(p,A,P){mh(p,A),P.length>0&&(p.i=null,p.g.set(os(p,A),m(P)),p.h+=P.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const p=[],A=Array.from(this.g.keys());for(let B=0;B<A.length;B++){var P=A[B];const te=il(P);P=Iv(this,P);for(let re=0;re<P.length;re++){let ye=te;P[re]!==""&&(ye+="="+il(P[re])),p.push(ye)}}return this.i=p.join("&")};function kv(p){const A=new Js;return A.i=p.i,p.g&&(A.g=new Map(p.g),A.h=p.h),A}function os(p,A){return A=String(A),p.j&&(A=A.toLowerCase()),A}function $v(p,A){A&&!p.j&&(Ga(p),p.i=null,p.g.forEach(function(P,B){const te=B.toLowerCase();B!=te&&(mh(this,B),Cv(this,te,P))},p)),p.j=A}function lx(p,A){const P=new kt;if(a.Image){const B=new Image;B.onload=c(sr,P,"TestLoadImage: loaded",!0,A,B),B.onerror=c(sr,P,"TestLoadImage: error",!1,A,B),B.onabort=c(sr,P,"TestLoadImage: abort",!1,A,B),B.ontimeout=c(sr,P,"TestLoadImage: timeout",!1,A,B),a.setTimeout(function(){B.ontimeout&&B.ontimeout()},1e4),B.src=p}else A(!1)}function ux(p,A){const P=new kt,B=new AbortController,te=setTimeout(()=>{B.abort(),sr(P,"TestPingServer: timeout",!1,A)},1e4);fetch(p,{signal:B.signal}).then(re=>{clearTimeout(te),re.ok?sr(P,"TestPingServer: ok",!0,A):sr(P,"TestPingServer: server error",!1,A)}).catch(()=>{clearTimeout(te),sr(P,"TestPingServer: error",!1,A)})}function sr(p,A,P,B,te){try{te&&(te.onload=null,te.onerror=null,te.onabort=null,te.ontimeout=null),B(P)}catch{}}function Zs(){this.g=new zu}function ji(p){this.i=p.Sb||null,this.h=p.ab||!1}h(ji,Yp),ji.prototype.g=function(){return new Gu(this.i,this.h)};function Gu(p,A){wn.call(this),this.H=p,this.o=A,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}h(Gu,wn),n=Gu.prototype,n.open=function(p,A){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=p,this.D=A,this.readyState=1,al(this)},n.send=function(p){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const A={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};p&&(A.body=p),(this.H||a).fetch(new Request(this.D,A)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,sl(this)),this.readyState=0},n.Pa=function(p){if(this.g&&(this.l=p,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=p.headers,this.readyState=2,al(this)),this.g&&(this.readyState=3,al(this),this.g)))if(this.responseType==="arraybuffer")p.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in p){if(this.j=p.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Ku(this)}else p.text().then(this.Oa.bind(this),this.ga.bind(this))};function Ku(p){p.j.read().then(p.Ma.bind(p)).catch(p.ga.bind(p))}n.Ma=function(p){if(this.g){if(this.o&&p.value)this.response.push(p.value);else if(!this.o){var A=p.value?p.value:new Uint8Array(0);(A=this.B.decode(A,{stream:!p.done}))&&(this.response=this.responseText+=A)}p.done?sl(this):al(this),this.readyState==3&&Ku(this)}},n.Oa=function(p){this.g&&(this.response=this.responseText=p,sl(this))},n.Na=function(p){this.g&&(this.response=p,sl(this))},n.ga=function(){this.g&&sl(this)};function sl(p){p.readyState=4,p.l=null,p.j=null,p.B=null,al(p)}n.setRequestHeader=function(p,A){this.A.append(p,A)},n.getResponseHeader=function(p){return this.h&&this.h.get(p.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const p=[],A=this.h.entries();for(var P=A.next();!P.done;)P=P.value,p.push(P[0]+": "+P[1]),P=A.next();return p.join(`\r
`)};function al(p){p.onreadystatechange&&p.onreadystatechange.call(p)}Object.defineProperty(Gu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(p){this.m=p?"include":"same-origin"}});function Rv(p){let A="";return q(p,function(P,B){A+=B,A+=":",A+=P,A+=`\r
`}),A}function Yu(p,A,P){e:{for(B in P){var B=!1;break e}B=!0}B||(P=Rv(P),typeof p=="string"?P!=null&&il(P):$t(p,A,P))}function Vt(p){wn.call(this),this.headers=new Map,this.L=p||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}h(Vt,wn);var Pv=/^https?$/i,cx=["POST","PUT"];n=Vt.prototype,n.Fa=function(p){this.H=p},n.ea=function(p,A,P,B){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+p);A=A?A.toUpperCase():"GET",this.D=p,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Zp.g(),this.g.onreadystatechange=f(u(this.Ca,this));try{this.B=!0,this.g.open(A,String(p),!0),this.B=!1}catch(re){Xu(this,re);return}if(p=P||"",P=new Map(this.headers),B)if(Object.getPrototypeOf(B)===Object.prototype)for(var te in B)P.set(te,B[te]);else if(typeof B.keys=="function"&&typeof B.get=="function")for(const re of B.keys())P.set(re,B.get(re));else throw Error("Unknown input type for opt_headers: "+String(B));B=Array.from(P.keys()).find(re=>re.toLowerCase()=="content-type"),te=a.FormData&&p instanceof a.FormData,!(Array.prototype.indexOf.call(cx,A,void 0)>=0)||B||te||P.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[re,ye]of P)this.g.setRequestHeader(re,ye);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(p),this.v=!1}catch(re){Xu(this,re)}};function Xu(p,A){p.h=!1,p.g&&(p.j=!0,p.g.abort(),p.j=!1),p.l=A,p.o=5,Nv(p),Ka(p)}function Nv(p){p.A||(p.A=!0,bn(p,"complete"),bn(p,"error"))}n.abort=function(p){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=p||7,bn(this,"complete"),bn(this,"abort"),Ka(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ka(this,!0)),Vt.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Dv(this):this.Xa())},n.Xa=function(){Dv(this)};function Dv(p){if(p.h&&typeof s<"u"){if(p.v&&ea(p)==4)setTimeout(p.Ca.bind(p),0);else if(bn(p,"readystatechange"),ea(p)==4){p.h=!1;try{const re=p.ca();e:switch(re){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var A=!0;break e;default:A=!1}var P;if(!(P=A)){var B;if(B=re===0){let ye=String(p.D).match(Av)[1]||null;!ye&&a.self&&a.self.location&&(ye=a.self.location.protocol.slice(0,-1)),B=!Pv.test(ye?ye.toLowerCase():"")}P=B}if(P)bn(p,"complete"),bn(p,"success");else{p.o=6;try{var te=ea(p)>2?p.g.statusText:""}catch{te=""}p.l=te+" ["+p.ca()+"]",Nv(p)}}finally{Ka(p)}}}}function Ka(p,A){if(p.g){p.m&&(clearTimeout(p.m),p.m=null);const P=p.g;p.g=null,A||bn(p,"ready");try{P.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function ea(p){return p.g?p.g.readyState:0}n.ca=function(){try{return ea(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(p){if(this.g){var A=this.g.responseText;return p&&A.indexOf(p)==0&&(A=A.substring(p.length)),Ys(A)}};function Mv(p){try{if(!p.g)return null;if("response"in p.g)return p.g.response;switch(p.F){case"":case"text":return p.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in p.g)return p.g.mozResponseArrayBuffer}return null}catch{return null}}function Ov(p){const A={};p=(p.g&&ea(p)>=2&&p.g.getAllResponseHeaders()||"").split(`\r
`);for(let B=0;B<p.length;B++){if(M(p[B]))continue;var P=wv(p[B]);const te=P[0];if(P=P[1],typeof P!="string")continue;P=P.trim();const re=A[te]||[];A[te]=re,re.push(P)}G(A,function(B){return B.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Qu(p,A,P){return P&&P.internalChannelParams&&P.internalChannelParams[p]||A}function Lv(p){this.za=0,this.i=[],this.j=new kt,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Qu("failFast",!1,p),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Qu("baseRetryDelayMs",5e3,p),this.Za=Qu("retryDelaySeedMs",1e4,p),this.Ta=Qu("forwardChannelMaxRetries",2,p),this.va=Qu("forwardChannelRequestTimeoutMs",2e4,p),this.ma=p&&p.xmlHttpFactory||void 0,this.Ua=p&&p.Rb||void 0,this.Aa=p&&p.useFetchStreams||!1,this.O=void 0,this.L=p&&p.supportsCrossDomainXhr||!1,this.M="",this.h=new Nn(p&&p.concurrentRequestLimit),this.Ba=new Zs,this.S=p&&p.fastHandshake||!1,this.R=p&&p.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=p&&p.Pb||!1,p&&p.ua&&this.j.ua(),p&&p.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&p&&p.detectBufferingProxy||!1,this.ia=void 0,p&&p.longPollingTimeout&&p.longPollingTimeout>0&&(this.ia=p.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Lv.prototype,n.ka=8,n.I=1,n.connect=function(p,A,P,B){Pn(0),this.W=p,this.H=A||{},P&&B!==void 0&&(this.H.OSID=P,this.H.OAID=B),this.F=this.X,this.J=Hv(this,null,this.W),yh(this)};function cm(p){if(Fv(p),p.I==3){var A=p.V++,P=Vi(p.J);if($t(P,"SID",p.M),$t(P,"RID",A),$t(P,"TYPE","terminate"),Ju(p,P),A=new rs(p,p.j,A),A.M=2,A.A=ph(Vi(P)),P=!1,a.navigator&&a.navigator.sendBeacon)try{P=a.navigator.sendBeacon(A.A.toString(),"")}catch{}!P&&a.Image&&(new Image().src=A.A,P=!0),P||(A.g=mm(A.j,null),A.g.ea(A.A)),A.F=Date.now(),Bu(A)}Uv(p)}function gh(p){p.g&&(hm(p),p.g.cancel(),p.g=null)}function Fv(p){gh(p),p.v&&(a.clearTimeout(p.v),p.v=null),_h(p),p.h.cancel(),p.m&&(typeof p.m=="number"&&a.clearTimeout(p.m),p.m=null)}function yh(p){if(!Ei(p.h)&&!p.m){p.m=!0;var A=p.Ea;D||k(),V||(D(),V=!0),I.add(A,p),p.D=0}}function dx(p,A){return fh(p.h)>=p.h.j-(p.m?1:0)?!1:p.m?(p.i=A.G.concat(p.i),!0):p.I==1||p.I==2||p.D>=(p.Sa?0:p.Ta)?!1:(p.m=nl(u(p.Ea,p,A),pm(p,p.D)),p.D++,!0)}n.Ea=function(p){if(this.m)if(this.m=null,this.I==1){if(!p){this.V=Math.floor(Math.random()*1e5),p=this.V++;const te=new rs(this,this.j,p);let re=this.o;if(this.U&&(re?(re=U(re),K(re,this.U)):re=this.U),this.u!==null||this.R||(te.J=re,re=null),this.S)e:{for(var A=0,P=0;P<this.i.length;P++){t:{var B=this.i[P];if("__data__"in B.map&&(B=B.map.__data__,typeof B=="string")){B=B.length;break t}B=void 0}if(B===void 0)break;if(A+=B,A>4096){A=P;break e}if(A===4096||P===this.i.length-1){A=P+1;break e}}A=1e3}else A=1e3;A=Vv(this,te,A),P=Vi(this.J),$t(P,"RID",p),$t(P,"CVER",22),this.G&&$t(P,"X-HTTP-Session-Id",this.G),Ju(this,P),re&&(this.R?A="headers="+il(Rv(re))+"&"+A:this.u&&Yu(P,this.u,re)),am(this.h,te),this.Ra&&$t(P,"TYPE","init"),this.S?($t(P,"$req",A),$t(P,"SID","null"),te.U=!0,zi(te,P,null)):zi(te,P,A),this.I=2}}else this.I==3&&(p?zv(this,p):this.i.length==0||Ei(this.h)||zv(this))};function zv(p,A){var P;A?P=A.l:P=p.V++;const B=Vi(p.J);$t(B,"SID",p.M),$t(B,"RID",P),$t(B,"AID",p.K),Ju(p,B),p.u&&p.o&&Yu(B,p.u,p.o),P=new rs(p,p.j,P,p.D+1),p.u===null&&(P.J=p.o),A&&(p.i=A.G.concat(p.i)),A=Vv(p,P,1e3),P.H=Math.round(p.va*.5)+Math.round(p.va*.5*Math.random()),am(p.h,P),zi(P,B,A)}function Ju(p,A){p.H&&q(p.H,function(P,B){$t(A,B,P)}),p.l&&q({},function(P,B){$t(A,B,P)})}function Vv(p,A,P){P=Math.min(p.i.length,P);const B=p.l?u(p.l.Ka,p.l,p):null;e:{var te=p.i;let Ge=-1;for(;;){const rn=["count="+P];Ge==-1?P>0?(Ge=te[0].g,rn.push("ofs="+Ge)):Ge=0:rn.push("ofs="+Ge);let bt=!0;for(let dn=0;dn<P;dn++){var re=te[dn].g;const Mr=te[dn].map;if(re-=Ge,re<0)Ge=Math.max(0,te[dn].g-100),bt=!1;else try{re="req"+re+"_"||"";try{var ye=Mr instanceof Map?Mr:Object.entries(Mr);for(const[Or,Bi]of ye){let ls=Bi;o(Bi)&&(ls=Fu(Bi)),rn.push(re+Or+"="+encodeURIComponent(ls))}}catch(Or){throw rn.push(re+"type="+encodeURIComponent("_badmap")),Or}}catch{B&&B(Mr)}}if(bt){ye=rn.join("&");break e}}ye=void 0}return p=p.i.splice(0,P),A.G=p,ye}function jv(p){if(!p.g&&!p.v){p.Y=1;var A=p.Da;D||k(),V||(D(),V=!0),I.add(A,p),p.A=0}}function dm(p){return p.g||p.v||p.A>=3?!1:(p.Y++,p.v=nl(u(p.Da,p),pm(p,p.A)),p.A++,!0)}n.Da=function(){if(this.v=null,Bv(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var p=4*this.T;this.j.info("BP detection timer enabled: "+p),this.B=nl(u(this.Wa,this),p)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Pn(10),gh(this),Bv(this))};function hm(p){p.B!=null&&(a.clearTimeout(p.B),p.B=null)}function Bv(p){p.g=new rs(p,p.j,"rpc",p.Y),p.u===null&&(p.g.J=p.o),p.g.P=0;var A=Vi(p.na);$t(A,"RID","rpc"),$t(A,"SID",p.M),$t(A,"AID",p.K),$t(A,"CI",p.F?"0":"1"),!p.F&&p.ia&&$t(A,"TO",p.ia),$t(A,"TYPE","xmlhttp"),Ju(p,A),p.u&&p.o&&Yu(A,p.u,p.o),p.O&&(p.g.H=p.O);var P=p.g;p=p.ba,P.M=1,P.A=ph(Vi(A)),P.u=null,P.R=!0,hh(P,p)}n.Va=function(){this.C!=null&&(this.C=null,gh(this),dm(this),Pn(19))};function _h(p){p.C!=null&&(a.clearTimeout(p.C),p.C=null)}function fm(p,A){var P=null;if(p.g==A){_h(p),hm(p),p.g=null;var B=2}else if(sm(p.h,A))P=A.G,xv(p.h,A),B=1;else return;if(p.I!=0){if(A.o)if(B==1){P=A.u?A.u.length:0,A=Date.now()-A.F;var te=p.D;B=ch(),bn(B,new Qp(B,P)),yh(p)}else jv(p);else if(te=A.m,te==3||te==0&&A.X>0||!(B==1&&dx(p,A)||B==2&&dm(p)))switch(P&&P.length>0&&(A=p.h,A.i=A.i.concat(P)),te){case 1:ta(p,5);break;case 4:ta(p,10);break;case 3:ta(p,6);break;default:ta(p,2)}}}function pm(p,A){let P=p.Qa+Math.floor(Math.random()*p.Za);return p.isActive()||(P*=2),P*A}function ta(p,A){if(p.j.info("Error code "+A),A==2){var P=u(p.bb,p),B=p.Ua;const te=!B;B=new ri(B||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Hu(B,"https"),ph(B),te?lx(B.toString(),P):ux(B.toString(),P)}else Pn(2);p.I=0,p.l&&p.l.pa(A),Uv(p),Fv(p)}n.bb=function(p){p?(this.j.info("Successfully pinged google.com"),Pn(2)):(this.j.info("Failed to ping google.com"),Pn(1))};function Uv(p){if(p.I=0,p.ja=[],p.l){const A=Ev(p.h);(A.length!=0||p.i.length!=0)&&(y(p.ja,A),y(p.ja,p.i),p.h.i.length=0,m(p.i),p.i.length=0),p.l.oa()}}function Hv(p,A,P){var B=P instanceof ri?Vi(P):new ri(P);if(B.g!="")A&&(B.g=A+"."+B.g),rl(B,B.u);else{var te=a.location;B=te.protocol,A=A?A+"."+te.hostname:te.hostname,te=+te.port;const re=new ri(null);B&&Hu(re,B),A&&(re.g=A),te&&rl(re,te),P&&(re.h=P),B=re}return P=p.G,A=p.wa,P&&A&&$t(B,P,A),$t(B,"VER",p.ka),Ju(p,B),B}function mm(p,A,P){if(A&&!p.L)throw Error("Can't create secondary domain capable XhrIo object.");return A=p.Aa&&!p.ma?new Vt(new ji({ab:P})):new Vt(p.ma),A.Fa(p.L),A}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function gm(){}n=gm.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function na(){}na.prototype.g=function(p,A){return new Ai(p,A)};function Ai(p,A){wn.call(this),this.g=new Lv(A),this.l=p,this.h=A&&A.messageUrlParams||null,p=A&&A.messageHeaders||null,A&&A.clientProtocolHeaderRequired&&(p?p["X-Client-Protocol"]="webchannel":p={"X-Client-Protocol":"webchannel"}),this.g.o=p,p=A&&A.initMessageHeaders||null,A&&A.messageContentType&&(p?p["X-WebChannel-Content-Type"]=A.messageContentType:p={"X-WebChannel-Content-Type":A.messageContentType}),A&&A.sa&&(p?p["X-WebChannel-Client-Profile"]=A.sa:p={"X-WebChannel-Client-Profile":A.sa}),this.g.U=p,(p=A&&A.Qb)&&!M(p)&&(this.g.u=p),this.A=A&&A.supportsCrossDomainXhr||!1,this.v=A&&A.sendRawJson||!1,(A=A&&A.httpSessionIdParam)&&!M(A)&&(this.g.G=A,p=this.h,p!==null&&A in p&&(p=this.h,A in p&&delete p[A])),this.j=new ol(this)}h(Ai,wn),Ai.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ai.prototype.close=function(){cm(this.g)},Ai.prototype.o=function(p){var A=this.g;if(typeof p=="string"){var P={};P.__data__=p,p=P}else this.v&&(P={},P.__data__=Fu(p),p=P);A.i.push(new rm(A.Ya++,p)),A.I==3&&yh(A)},Ai.prototype.N=function(){this.g.l=null,delete this.j,cm(this.g),delete this.g,Ai.Z.N.call(this)};function ym(p){lh.call(this),p.__headers__&&(this.headers=p.__headers__,this.statusCode=p.__status__,delete p.__headers__,delete p.__status__);var A=p.__sm__;if(A){e:{for(const P in A){p=P;break e}p=void 0}(this.i=p)&&(p=this.i,A=A!==null&&p in A?A[p]:void 0),this.data=A}else this.data=p}h(ym,lh);function Wv(){uh.call(this),this.status=1}h(Wv,uh);function ol(p){this.g=p}h(ol,gm),ol.prototype.ra=function(){bn(this.g,"a")},ol.prototype.qa=function(p){bn(this.g,new ym(p))},ol.prototype.pa=function(p){bn(this.g,new Wv)},ol.prototype.oa=function(){bn(this.g,"b")},na.prototype.createWebChannel=na.prototype.g,Ai.prototype.send=Ai.prototype.o,Ai.prototype.open=Ai.prototype.m,Ai.prototype.close=Ai.prototype.close,L4=function(){return new na},O4=function(){return ch()},M4=Qs,gT={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ju.NO_ERROR=0,ju.TIMEOUT=8,ju.HTTP_ERROR=6,n0=ju,Jp.COMPLETE="complete",D4=Jp,Xs.EventType=tl,tl.OPEN="a",tl.CLOSE="b",tl.ERROR="c",tl.MESSAGE="d",wn.prototype.listen=wn.prototype.J,Qm=Xs,Vt.prototype.listenOnce=Vt.prototype.K,Vt.prototype.getLastError=Vt.prototype.Ha,Vt.prototype.getLastErrorCode=Vt.prototype.ya,Vt.prototype.getStatus=Vt.prototype.ca,Vt.prototype.getResponseJson=Vt.prototype.La,Vt.prototype.getResponseText=Vt.prototype.la,Vt.prototype.send=Vt.prototype.ea,Vt.prototype.setWithCredentials=Vt.prototype.Fa,N4=Vt}).apply(typeof fw<"u"?fw:typeof self<"u"?self:typeof window<"u"?window:{});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gi=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};gi.UNAUTHENTICATED=new gi(null),gi.GOOGLE_CREDENTIALS=new gi("google-credentials-uid"),gi.FIRST_PARTY=new gi("first-party-uid"),gi.MOCK_USER=new gi("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Fp="12.8.0";function WG(n){Fp=n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zd=new oI("@firebase/firestore");function Eh(){return zd.logLevel}function xe(n,...e){if(zd.logLevel<=nt.DEBUG){const t=e.map(_I);zd.debug(`Firestore (${Fp}): ${n}`,...t)}}function Ko(n,...e){if(zd.logLevel<=nt.ERROR){const t=e.map(_I);zd.error(`Firestore (${Fp}): ${n}`,...t)}}function Ap(n,...e){if(zd.logLevel<=nt.WARN){const t=e.map(_I);zd.warn(`Firestore (${Fp}): ${n}`,...t)}}function _I(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ve(n,e,t){let i="Unexpected state";typeof e=="string"?i=e:t=e,F4(n,i,t)}function F4(n,e,t){let i=`FIRESTORE (${Fp}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{i+=" CONTEXT: "+JSON.stringify(t)}catch{i+=" CONTEXT: "+t}throw Ko(i),new Error(i)}function wt(n,e,t,i){let r="Unexpected state";typeof t=="string"?r=t:i=t,n||F4(e,r,i)}function We(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ce={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class we extends Ba{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zo{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z4{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class qG{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(gi.UNAUTHENTICATED))}shutdown(){}}class GG{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class KG{constructor(e){this.t=e,this.currentUser=gi.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){wt(this.o===void 0,42304);let i=this.i;const r=l=>this.i!==i?(i=this.i,t(l)):Promise.resolve();let s=new zo;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new zo,e.enqueueRetryable(()=>r(this.currentUser))};const a=()=>{const l=s;e.enqueueRetryable(async()=>{await l.promise,await r(this.currentUser)})},o=l=>{xe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>o(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?o(l):(xe("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new zo)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(xe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(wt(typeof i.accessToken=="string",31837,{l:i}),new z4(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return wt(e===null||typeof e=="string",2055,{h:e}),new gi(e)}}class YG{constructor(e,t,i){this.P=e,this.T=t,this.I=i,this.type="FirstParty",this.user=gi.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class XG{constructor(e,t,i){this.P=e,this.T=t,this.I=i}getToken(){return Promise.resolve(new YG(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(gi.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class sR{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class QG{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ar(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){wt(this.o===void 0,3512);const i=s=>{s.error!=null&&xe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.m;return this.m=s.token,xe("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>i(s))};const r=s=>{xe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?r(s):xe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new sR(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(wt(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new sR(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JG(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vI{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let i="";for(;i.length<20;){const r=JG(40);for(let s=0;s<r.length;++s)i.length<20&&r[s]<t&&(i+=e.charAt(r[s]%62))}return i}}function it(n,e){return n<e?-1:n>e?1:0}function yT(n,e){const t=Math.min(n.length,e.length);for(let i=0;i<t;i++){const r=n.charAt(i),s=e.charAt(i);if(r!==s)return tE(r)===tE(s)?it(r,s):tE(r)?1:-1}return it(n.length,e.length)}const ZG=55296,e7=57343;function tE(n){const e=n.charCodeAt(0);return e>=ZG&&e<=e7}function Tp(n,e,t){return n.length===e.length&&n.every((i,r)=>t(i,e[r]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aR="__name__";class ca{constructor(e,t,i){t===void 0?t=0:t>e.length&&Ve(637,{offset:t,range:e.length}),i===void 0?i=e.length-t:i>e.length-t&&Ve(1746,{length:i,range:e.length-t}),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return ca.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ca?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let r=0;r<i;r++){const s=ca.compareSegments(e.get(r),t.get(r));if(s!==0)return s}return it(e.length,t.length)}static compareSegments(e,t){const i=ca.isNumericId(e),r=ca.isNumericId(t);return i&&!r?-1:!i&&r?1:i&&r?ca.extractNumericId(e).compare(ca.extractNumericId(t)):yT(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return hu.fromString(e.substring(4,e.length-2))}}class Dt extends ca{construct(e,t,i){return new Dt(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new we(ce.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new Dt(t)}static emptyPath(){return new Dt([])}}const t7=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Zn extends ca{construct(e,t,i){return new Zn(e,t,i)}static isValidIdentifier(e){return t7.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Zn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===aR}static keyField(){return new Zn([aR])}static fromServerFormat(e){const t=[];let i="",r=0;const s=()=>{if(i.length===0)throw new we(ce.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let a=!1;for(;r<e.length;){const o=e[r];if(o==="\\"){if(r+1===e.length)throw new we(ce.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[r+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new we(ce.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=l,r+=2}else o==="`"?(a=!a,r++):o!=="."||a?(i+=o,r++):(s(),r++)}if(s(),a)throw new we(ce.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Zn(t)}static emptyPath(){return new Zn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class De{constructor(e){this.path=e}static fromPath(e){return new De(Dt.fromString(e))}static fromName(e){return new De(Dt.fromString(e).popFirst(5))}static empty(){return new De(Dt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Dt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Dt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new De(new Dt(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V4(n,e,t){if(!t)throw new we(ce.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function n7(n,e,t,i){if(e===!0&&i===!0)throw new we(ce.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function oR(n){if(!De.isDocumentKey(n))throw new we(ce.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function lR(n){if(De.isDocumentKey(n))throw new we(ce.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function j4(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function N1(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(i){return i.constructor?i.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Ve(12329,{type:typeof n})}function La(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new we(ce.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=N1(n);throw new we(ce.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _n(n,e){const t={typeString:n};return e&&(t.value=e),t}function sv(n,e){if(!j4(n))throw new we(ce.INVALID_ARGUMENT,"JSON must be an object");let t;for(const i in e)if(e[i]){const r=e[i].typeString,s="value"in e[i]?{value:e[i].value}:void 0;if(!(i in n)){t=`JSON missing required field: '${i}'`;break}const a=n[i];if(r&&typeof a!==r){t=`JSON field '${i}' must be a ${r}.`;break}if(s!==void 0&&a!==s.value){t=`Expected '${i}' field to equal '${s.value}'`;break}}if(t)throw new we(ce.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uR=-62135596800,cR=1e6;class Ft{static now(){return Ft.fromMillis(Date.now())}static fromDate(e){return Ft.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor((e-1e3*t)*cR);return new Ft(t,i)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new we(ce.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new we(ce.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<uR)throw new we(ce.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new we(ce.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/cR}_compareTo(e){return this.seconds===e.seconds?it(this.nanoseconds,e.nanoseconds):it(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Ft._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(sv(e,Ft._jsonSchema))return new Ft(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-uR;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Ft._jsonSchemaVersion="firestore/timestamp/1.0",Ft._jsonSchema={type:_n("string",Ft._jsonSchemaVersion),seconds:_n("number"),nanoseconds:_n("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class He{static fromTimestamp(e){return new He(e)}static min(){return new He(new Ft(0,0))}static max(){return new He(new Ft(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cy=-1;function i7(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=He.fromTimestamp(i===1e9?new Ft(t+1,0):new Ft(t,i));return new _u(r,De.empty(),e)}function r7(n){return new _u(n.readTime,n.key,cy)}class _u{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new _u(He.min(),De.empty(),cy)}static max(){return new _u(He.max(),De.empty(),cy)}}function s7(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=De.comparator(n.documentKey,e.documentKey),t!==0?t:it(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a7="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class o7{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zp(n){if(n.code!==ce.FAILED_PRECONDITION||n.message!==a7)throw n;xe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class he{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ve(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new he((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof he?t:he.resolve(t)}catch(t){return he.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):he.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):he.reject(t)}static resolve(e){return new he((t,i)=>{t(e)})}static reject(e){return new he((t,i)=>{i(e)})}static waitFor(e){return new he((t,i)=>{let r=0,s=0,a=!1;e.forEach(o=>{++r,o.next(()=>{++s,a&&s===r&&t()},l=>i(l))}),a=!0,s===r&&t()})}static or(e){let t=he.resolve(!1);for(const i of e)t=t.next(r=>r?he.resolve(r):i());return t}static forEach(e,t){const i=[];return e.forEach((r,s)=>{i.push(t.call(this,r,s))}),this.waitFor(i)}static mapArray(e,t){return new he((i,r)=>{const s=e.length,a=new Array(s);let o=0;for(let l=0;l<s;l++){const u=l;t(e[u]).next(c=>{a[u]=c,++o,o===s&&i(a)},c=>r(c))}})}static doWhile(e,t){return new he((i,r)=>{const s=()=>{e()===!0?t().next(()=>{s()},r):i()};s()})}}function l7(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Vp(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D1{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this.ae(i),this.ue=i=>t.writeSequenceNumber(i))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}D1.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wI=-1;function M1(n){return n==null}function _b(n){return n===0&&1/n==-1/0}function u7(n){return typeof n=="number"&&Number.isInteger(n)&&!_b(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B4="";function c7(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=dR(e)),e=d7(n.get(t),e);return dR(e)}function d7(n,e){let t=e;const i=n.length;for(let r=0;r<i;r++){const s=n.charAt(r);switch(s){case"\0":t+="";break;case B4:t+="";break;default:t+=s}}return t}function dR(n){return n+B4+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hR(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Nu(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function U4(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jt{constructor(e,t){this.comparator=e,this.root=t||Qn.EMPTY}insert(e,t){return new Jt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Qn.BLACK,null,null))}remove(e){return new Jt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Qn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const r=this.comparator(e,i.key);if(r===0)return t+i.left.size;r<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){const e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new pw(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new pw(this.root,e,this.comparator,!1)}getReverseIterator(){return new pw(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new pw(this.root,e,this.comparator,!0)}}class pw{constructor(e,t,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Qn{constructor(e,t,i,r,s){this.key=e,this.value=t,this.color=i??Qn.RED,this.left=r??Qn.EMPTY,this.right=s??Qn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,r,s){return new Qn(e??this.key,t??this.value,i??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let r=this;const s=i(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,i),null):s===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Qn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Qn.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Qn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Qn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ve(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ve(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ve(27949);return e+(this.isRed()?0:1)}}Qn.EMPTY=null,Qn.RED=!0,Qn.BLACK=!1;Qn.EMPTY=new class{constructor(){this.size=0}get key(){throw Ve(57766)}get value(){throw Ve(16141)}get color(){throw Ve(16727)}get left(){throw Ve(29726)}get right(){throw Ve(36894)}copy(e,t,i,r,s){return this}insert(e,t,i){return new Qn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kn{constructor(e){this.comparator=e,this.data=new Jt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new fR(this.data.getIterator())}getIteratorFrom(e){return new fR(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof kn)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=i.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new kn(this.comparator);return t.data=e,t}}class fR{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ir{constructor(e){this.fields=e,e.sort(Zn.comparator)}static empty(){return new Ir([])}unionWith(e){let t=new kn(Zn.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new Ir(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Tp(this.fields,e.fields,(t,i)=>t.isEqual(i))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H4 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ni{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new H4("Invalid base64 string: "+s):s}}(e);return new ni(t)}static fromUint8Array(e){const t=function(r){let s="";for(let a=0;a<r.length;++a)s+=String.fromCharCode(r[a]);return s}(e);return new ni(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return it(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ni.EMPTY_BYTE_STRING=new ni("");const h7=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function vu(n){if(wt(!!n,39018),typeof n=="string"){let e=0;const t=h7.exec(n);if(wt(!!t,46558,{timestamp:n}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:on(n.seconds),nanos:on(n.nanos)}}function on(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function wu(n){return typeof n=="string"?ni.fromBase64String(n):ni.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W4="server_timestamp",q4="__type__",G4="__previous_value__",K4="__local_write_time__";function bI(n){var t,i;return((i=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[q4])==null?void 0:i.stringValue)===W4}function O1(n){const e=n.mapValue.fields[G4];return bI(e)?O1(e):e}function dy(n){const e=vu(n.mapValue.fields[K4].timestampValue);return new Ft(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f7{constructor(e,t,i,r,s,a,o,l,u,c,h){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=o,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=c,this.apiKey=h}}const vb="(default)";class hy{constructor(e,t){this.projectId=e,this.database=t||vb}static empty(){return new hy("","")}get isDefaultDatabase(){return this.database===vb}isEqual(e){return e instanceof hy&&e.projectId===this.projectId&&e.database===this.database}}function p7(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new we(ce.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new hy(n.options.projectId,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y4="__type__",m7="__max__",mw={mapValue:{}},X4="__vector__",wb="value";function bu(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?bI(n)?4:y7(n)?9007199254740991:g7(n)?10:11:Ve(28295,{value:n})}function Fa(n,e){if(n===e)return!0;const t=bu(n);if(t!==bu(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return dy(n).isEqual(dy(e));case 3:return function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;const a=vu(r.timestampValue),o=vu(s.timestampValue);return a.seconds===o.seconds&&a.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(r,s){return wu(r.bytesValue).isEqual(wu(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,s){return on(r.geoPointValue.latitude)===on(s.geoPointValue.latitude)&&on(r.geoPointValue.longitude)===on(s.geoPointValue.longitude)}(n,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return on(r.integerValue)===on(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){const a=on(r.doubleValue),o=on(s.doubleValue);return a===o?_b(a)===_b(o):isNaN(a)&&isNaN(o)}return!1}(n,e);case 9:return Tp(n.arrayValue.values||[],e.arrayValue.values||[],Fa);case 10:case 11:return function(r,s){const a=r.mapValue.fields||{},o=s.mapValue.fields||{};if(hR(a)!==hR(o))return!1;for(const l in a)if(a.hasOwnProperty(l)&&(o[l]===void 0||!Fa(a[l],o[l])))return!1;return!0}(n,e);default:return Ve(52216,{left:n})}}function fy(n,e){return(n.values||[]).find(t=>Fa(t,e))!==void 0}function Sp(n,e){if(n===e)return 0;const t=bu(n),i=bu(e);if(t!==i)return it(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return it(n.booleanValue,e.booleanValue);case 2:return function(s,a){const o=on(s.integerValue||s.doubleValue),l=on(a.integerValue||a.doubleValue);return o<l?-1:o>l?1:o===l?0:isNaN(o)?isNaN(l)?0:-1:1}(n,e);case 3:return pR(n.timestampValue,e.timestampValue);case 4:return pR(dy(n),dy(e));case 5:return yT(n.stringValue,e.stringValue);case 6:return function(s,a){const o=wu(s),l=wu(a);return o.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(s,a){const o=s.split("/"),l=a.split("/");for(let u=0;u<o.length&&u<l.length;u++){const c=it(o[u],l[u]);if(c!==0)return c}return it(o.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,a){const o=it(on(s.latitude),on(a.latitude));return o!==0?o:it(on(s.longitude),on(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return mR(n.arrayValue,e.arrayValue);case 10:return function(s,a){var f,m,y,_;const o=s.fields||{},l=a.fields||{},u=(f=o[wb])==null?void 0:f.arrayValue,c=(m=l[wb])==null?void 0:m.arrayValue,h=it(((y=u==null?void 0:u.values)==null?void 0:y.length)||0,((_=c==null?void 0:c.values)==null?void 0:_.length)||0);return h!==0?h:mR(u,c)}(n.mapValue,e.mapValue);case 11:return function(s,a){if(s===mw.mapValue&&a===mw.mapValue)return 0;if(s===mw.mapValue)return 1;if(a===mw.mapValue)return-1;const o=s.fields||{},l=Object.keys(o),u=a.fields||{},c=Object.keys(u);l.sort(),c.sort();for(let h=0;h<l.length&&h<c.length;++h){const f=yT(l[h],c[h]);if(f!==0)return f;const m=Sp(o[l[h]],u[c[h]]);if(m!==0)return m}return it(l.length,c.length)}(n.mapValue,e.mapValue);default:throw Ve(23264,{he:t})}}function pR(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return it(n,e);const t=vu(n),i=vu(e),r=it(t.seconds,i.seconds);return r!==0?r:it(t.nanos,i.nanos)}function mR(n,e){const t=n.values||[],i=e.values||[];for(let r=0;r<t.length&&r<i.length;++r){const s=Sp(t[r],i[r]);if(s)return s}return it(t.length,i.length)}function Ip(n){return _T(n)}function _T(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const i=vu(t);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return wu(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return De.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let i="[",r=!0;for(const s of t.values||[])r?r=!1:i+=",",i+=_T(s);return i+"]"}(n.arrayValue):"mapValue"in n?function(t){const i=Object.keys(t.fields||{}).sort();let r="{",s=!0;for(const a of i)s?s=!1:r+=",",r+=`${a}:${_T(t.fields[a])}`;return r+"}"}(n.mapValue):Ve(61005,{value:n})}function i0(n){switch(bu(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=O1(n);return e?16+i0(e):16;case 5:return 2*n.stringValue.length;case 6:return wu(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(i){return(i.values||[]).reduce((r,s)=>r+i0(s),0)}(n.arrayValue);case 10:case 11:return function(i){let r=0;return Nu(i.fields,(s,a)=>{r+=s.length+i0(a)}),r}(n.mapValue);default:throw Ve(13486,{value:n})}}function gR(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function vT(n){return!!n&&"integerValue"in n}function xI(n){return!!n&&"arrayValue"in n}function yR(n){return!!n&&"nullValue"in n}function _R(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function r0(n){return!!n&&"mapValue"in n}function g7(n){var t,i;return((i=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Y4])==null?void 0:i.stringValue)===X4}function Dg(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Nu(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=Dg(i)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Dg(n.arrayValue.values[t]);return e}return{...n}}function y7(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===m7}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zi{constructor(e){this.value=e}static empty(){return new Zi({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!r0(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Dg(t)}setAll(e){let t=Zn.emptyPath(),i={},r=[];e.forEach((a,o)=>{if(!t.isImmediateParentOf(o)){const l=this.getFieldsMap(t);this.applyChanges(l,i,r),i={},r=[],t=o.popLast()}a?i[o.lastSegment()]=Dg(a):r.push(o.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,i,r)}delete(e){const t=this.field(e.popLast());r0(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Fa(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=t.mapValue.fields[e.get(i)];r0(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,i){Nu(t,(r,s)=>e[r]=s);for(const r of i)delete e[r]}clone(){return new Zi(Dg(this.value))}}function Q4(n){const e=[];return Nu(n.fields,(t,i)=>{const r=new Zn([t]);if(r0(i)){const s=Q4(i.mapValue).fields;if(s.length===0)e.push(r);else for(const a of s)e.push(r.child(a))}else e.push(r)}),new Ir(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vi{constructor(e,t,i,r,s,a,o){this.key=e,this.documentType=t,this.version=i,this.readTime=r,this.createTime=s,this.data=a,this.documentState=o}static newInvalidDocument(e){return new vi(e,0,He.min(),He.min(),He.min(),Zi.empty(),0)}static newFoundDocument(e,t,i,r){return new vi(e,1,t,He.min(),i,r,0)}static newNoDocument(e,t){return new vi(e,2,t,He.min(),He.min(),Zi.empty(),0)}static newUnknownDocument(e,t){return new vi(e,3,t,He.min(),He.min(),Zi.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(He.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Zi.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Zi.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=He.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof vi&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new vi(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bb{constructor(e,t){this.position=e,this.inclusive=t}}function vR(n,e,t){let i=0;for(let r=0;r<n.position.length;r++){const s=e[r],a=n.position[r];if(s.field.isKeyField()?i=De.comparator(De.fromName(a.referenceValue),t.key):i=Sp(a,t.data.field(s.field)),s.dir==="desc"&&(i*=-1),i!==0)break}return i}function wR(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Fa(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class py{constructor(e,t="asc"){this.field=e,this.dir=t}}function _7(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J4{}class gn extends J4{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new w7(e,t,i):t==="array-contains"?new E7(e,i):t==="in"?new A7(e,i):t==="not-in"?new T7(e,i):t==="array-contains-any"?new S7(e,i):new gn(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new b7(e,i):new x7(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Sp(t,this.value)):t!==null&&bu(this.value)===bu(t)&&this.matchesComparison(Sp(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ve(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ws extends J4{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Ws(e,t)}matches(e){return Z4(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Z4(n){return n.op==="and"}function eF(n){return v7(n)&&Z4(n)}function v7(n){for(const e of n.filters)if(e instanceof Ws)return!1;return!0}function wT(n){if(n instanceof gn)return n.field.canonicalString()+n.op.toString()+Ip(n.value);if(eF(n))return n.filters.map(e=>wT(e)).join(",");{const e=n.filters.map(t=>wT(t)).join(",");return`${n.op}(${e})`}}function tF(n,e){return n instanceof gn?function(i,r){return r instanceof gn&&i.op===r.op&&i.field.isEqual(r.field)&&Fa(i.value,r.value)}(n,e):n instanceof Ws?function(i,r){return r instanceof Ws&&i.op===r.op&&i.filters.length===r.filters.length?i.filters.reduce((s,a,o)=>s&&tF(a,r.filters[o]),!0):!1}(n,e):void Ve(19439)}function nF(n){return n instanceof gn?function(t){return`${t.field.canonicalString()} ${t.op} ${Ip(t.value)}`}(n):n instanceof Ws?function(t){return t.op.toString()+" {"+t.getFilters().map(nF).join(" ,")+"}"}(n):"Filter"}class w7 extends gn{constructor(e,t,i){super(e,t,i),this.key=De.fromName(i.referenceValue)}matches(e){const t=De.comparator(e.key,this.key);return this.matchesComparison(t)}}class b7 extends gn{constructor(e,t){super(e,"in",t),this.keys=iF("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class x7 extends gn{constructor(e,t){super(e,"not-in",t),this.keys=iF("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function iF(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(i=>De.fromName(i.referenceValue))}class E7 extends gn{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return xI(t)&&fy(t.arrayValue,this.value)}}class A7 extends gn{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&fy(this.value.arrayValue,t)}}class T7 extends gn{constructor(e,t){super(e,"not-in",t)}matches(e){if(fy(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!fy(this.value.arrayValue,t)}}class S7 extends gn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!xI(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>fy(this.value.arrayValue,i))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I7{constructor(e,t=null,i=[],r=[],s=null,a=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=a,this.endAt=o,this.Te=null}}function bR(n,e=null,t=[],i=[],r=null,s=null,a=null){return new I7(n,e,t,i,r,s,a)}function EI(n){const e=We(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>wT(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>function(s){return s.field.canonicalString()+s.dir}(i)).join(","),M1(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>Ip(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>Ip(i)).join(",")),e.Te=t}return e.Te}function AI(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!_7(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!tF(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!wR(n.startAt,e.startAt)&&wR(n.endAt,e.endAt)}function bT(n){return De.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jp{constructor(e,t=null,i=[],r=[],s=null,a="F",o=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=a,this.startAt=o,this.endAt=l,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function C7(n,e,t,i,r,s,a,o){return new jp(n,e,t,i,r,s,a,o)}function TI(n){return new jp(n)}function xR(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function k7(n){return De.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function rF(n){return n.collectionGroup!==null}function Mg(n){const e=We(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const s of e.explicitOrderBy)e.Ie.push(s),t.add(s.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let o=new kn(Zn.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(o=o.add(u.field))})}),o})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new py(s,i))}),t.has(Zn.keyField().canonicalString())||e.Ie.push(new py(Zn.keyField(),i))}return e.Ie}function Da(n){const e=We(n);return e.Ee||(e.Ee=$7(e,Mg(n))),e.Ee}function $7(n,e){if(n.limitType==="F")return bR(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{const s=r.dir==="desc"?"asc":"desc";return new py(r.field,s)});const t=n.endAt?new bb(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new bb(n.startAt.position,n.startAt.inclusive):null;return bR(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function xT(n,e){const t=n.filters.concat([e]);return new jp(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function R7(n,e){const t=n.explicitOrderBy.concat([e]);return new jp(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function ET(n,e,t){return new jp(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function L1(n,e){return AI(Da(n),Da(e))&&n.limitType===e.limitType}function sF(n){return`${EI(Da(n))}|lt:${n.limitType}`}function Ah(n){return`Query(target=${function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map(r=>nF(r)).join(", ")}]`),M1(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map(r=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(r)).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map(r=>Ip(r)).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map(r=>Ip(r)).join(",")),`Target(${i})`}(Da(n))}; limitType=${n.limitType})`}function F1(n,e){return e.isFoundDocument()&&function(i,r){const s=r.key.path;return i.collectionGroup!==null?r.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(s):De.isDocumentKey(i.path)?i.path.isEqual(s):i.path.isImmediateParentOf(s)}(n,e)&&function(i,r){for(const s of Mg(i))if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0}(n,e)&&function(i,r){for(const s of i.filters)if(!s.matches(r))return!1;return!0}(n,e)&&function(i,r){return!(i.startAt&&!function(a,o,l){const u=vR(a,o,l);return a.inclusive?u<=0:u<0}(i.startAt,Mg(i),r)||i.endAt&&!function(a,o,l){const u=vR(a,o,l);return a.inclusive?u>=0:u>0}(i.endAt,Mg(i),r))}(n,e)}function P7(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function aF(n){return(e,t)=>{let i=!1;for(const r of Mg(n)){const s=N7(r,e,t);if(s!==0)return s;i=i||r.field.isKeyField()}return 0}}function N7(n,e,t){const i=n.field.isKeyField()?De.comparator(e.key,t.key):function(s,a,o){const l=a.data.field(s),u=o.data.field(s);return l!==null&&u!==null?Sp(l,u):Ve(42886)}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return Ve(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eh{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[r,s]of i)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),r=this.inner[i];if(r===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return i.length===1?delete this.inner[t]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Nu(this.inner,(t,i)=>{for(const[r,s]of i)e(r,s)})}isEmpty(){return U4(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D7=new Jt(De.comparator);function Yo(){return D7}const oF=new Jt(De.comparator);function Jm(...n){let e=oF;for(const t of n)e=e.insert(t.key,t);return e}function lF(n){let e=oF;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function wc(){return Og()}function uF(){return Og()}function Og(){return new eh(n=>n.toString(),(n,e)=>n.isEqual(e))}const M7=new Jt(De.comparator),O7=new kn(De.comparator);function rt(...n){let e=O7;for(const t of n)e=e.add(t);return e}const L7=new kn(it);function F7(){return L7}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SI(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:_b(e)?"-0":e}}function cF(n){return{integerValue:""+n}}function z7(n,e){return u7(e)?cF(e):SI(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z1{constructor(){this._=void 0}}function V7(n,e,t){return n instanceof my?function(r,s){const a={fields:{[q4]:{stringValue:W4},[K4]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&bI(s)&&(s=O1(s)),s&&(a.fields[G4]=s),{mapValue:a}}(t,e):n instanceof gy?hF(n,e):n instanceof yy?fF(n,e):function(r,s){const a=dF(r,s),o=ER(a)+ER(r.Ae);return vT(a)&&vT(r.Ae)?cF(o):SI(r.serializer,o)}(n,e)}function j7(n,e,t){return n instanceof gy?hF(n,e):n instanceof yy?fF(n,e):t}function dF(n,e){return n instanceof xb?function(i){return vT(i)||function(s){return!!s&&"doubleValue"in s}(i)}(e)?e:{integerValue:0}:null}class my extends z1{}class gy extends z1{constructor(e){super(),this.elements=e}}function hF(n,e){const t=pF(e);for(const i of n.elements)t.some(r=>Fa(r,i))||t.push(i);return{arrayValue:{values:t}}}class yy extends z1{constructor(e){super(),this.elements=e}}function fF(n,e){let t=pF(e);for(const i of n.elements)t=t.filter(r=>!Fa(r,i));return{arrayValue:{values:t}}}class xb extends z1{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function ER(n){return on(n.integerValue||n.doubleValue)}function pF(n){return xI(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B7{constructor(e,t){this.field=e,this.transform=t}}function U7(n,e){return n.field.isEqual(e.field)&&function(i,r){return i instanceof gy&&r instanceof gy||i instanceof yy&&r instanceof yy?Tp(i.elements,r.elements,Fa):i instanceof xb&&r instanceof xb?Fa(i.Ae,r.Ae):i instanceof my&&r instanceof my}(n.transform,e.transform)}class H7{constructor(e,t){this.version=e,this.transformResults=t}}class Vs{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Vs}static exists(e){return new Vs(void 0,e)}static updateTime(e){return new Vs(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function s0(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class V1{}function mF(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new yF(n.key,Vs.none()):new av(n.key,n.data,Vs.none());{const t=n.data,i=Zi.empty();let r=new kn(Zn.comparator);for(let s of e.fields)if(!r.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?i.delete(s):i.set(s,a),r=r.add(s)}return new Du(n.key,i,new Ir(r.toArray()),Vs.none())}}function W7(n,e,t){n instanceof av?function(r,s,a){const o=r.value.clone(),l=TR(r.fieldTransforms,s,a.transformResults);o.setAll(l),s.convertToFoundDocument(a.version,o).setHasCommittedMutations()}(n,e,t):n instanceof Du?function(r,s,a){if(!s0(r.precondition,s))return void s.convertToUnknownDocument(a.version);const o=TR(r.fieldTransforms,s,a.transformResults),l=s.data;l.setAll(gF(r)),l.setAll(o),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(n,e,t):function(r,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function Lg(n,e,t,i){return n instanceof av?function(s,a,o,l){if(!s0(s.precondition,a))return o;const u=s.value.clone(),c=SR(s.fieldTransforms,l,a);return u.setAll(c),a.convertToFoundDocument(a.version,u).setHasLocalMutations(),null}(n,e,t,i):n instanceof Du?function(s,a,o,l){if(!s0(s.precondition,a))return o;const u=SR(s.fieldTransforms,l,a),c=a.data;return c.setAll(gF(s)),c.setAll(u),a.convertToFoundDocument(a.version,c).setHasLocalMutations(),o===null?null:o.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,e,t,i):function(s,a,o){return s0(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):o}(n,e,t)}function q7(n,e){let t=null;for(const i of n.fieldTransforms){const r=e.data.field(i.field),s=dF(i.transform,r||null);s!=null&&(t===null&&(t=Zi.empty()),t.set(i.field,s))}return t||null}function AR(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(i,r){return i===void 0&&r===void 0||!(!i||!r)&&Tp(i,r,(s,a)=>U7(s,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class av extends V1{constructor(e,t,i,r=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Du extends V1{constructor(e,t,i,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function gF(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}}),e}function TR(n,e,t){const i=new Map;wt(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let r=0;r<t.length;r++){const s=n[r],a=s.transform,o=e.data.field(s.field);i.set(s.field,j7(a,o,t[r]))}return i}function SR(n,e,t){const i=new Map;for(const r of n){const s=r.transform,a=t.data.field(r.field);i.set(r.field,V7(s,a,e))}return i}class yF extends V1{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class G7 extends V1{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K7{constructor(e,t,i,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const s=this.mutations[r];s.key.isEqual(e.key)&&W7(s,e,i[r])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=Lg(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=Lg(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=uF();return this.mutations.forEach(r=>{const s=e.get(r.key),a=s.overlayedDocument;let o=this.applyToLocalView(a,s.mutatedFields);o=t.has(r.key)?null:o;const l=mF(a,o);l!==null&&i.set(r.key,l),a.isValidDocument()||a.convertToNoDocument(He.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),rt())}isEqual(e){return this.batchId===e.batchId&&Tp(this.mutations,e.mutations,(t,i)=>AR(t,i))&&Tp(this.baseMutations,e.baseMutations,(t,i)=>AR(t,i))}}class II{constructor(e,t,i,r){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=r}static from(e,t,i){wt(e.mutations.length===i.length,58842,{me:e.mutations.length,fe:i.length});let r=function(){return M7}();const s=e.mutations;for(let a=0;a<s.length;a++)r=r.insert(s[a].key,i[a].version);return new II(e,t,i,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y7{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X7{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var pn,ot;function Q7(n){switch(n){case ce.OK:return Ve(64938);case ce.CANCELLED:case ce.UNKNOWN:case ce.DEADLINE_EXCEEDED:case ce.RESOURCE_EXHAUSTED:case ce.INTERNAL:case ce.UNAVAILABLE:case ce.UNAUTHENTICATED:return!1;case ce.INVALID_ARGUMENT:case ce.NOT_FOUND:case ce.ALREADY_EXISTS:case ce.PERMISSION_DENIED:case ce.FAILED_PRECONDITION:case ce.ABORTED:case ce.OUT_OF_RANGE:case ce.UNIMPLEMENTED:case ce.DATA_LOSS:return!0;default:return Ve(15467,{code:n})}}function _F(n){if(n===void 0)return Ko("GRPC error has no .code"),ce.UNKNOWN;switch(n){case pn.OK:return ce.OK;case pn.CANCELLED:return ce.CANCELLED;case pn.UNKNOWN:return ce.UNKNOWN;case pn.DEADLINE_EXCEEDED:return ce.DEADLINE_EXCEEDED;case pn.RESOURCE_EXHAUSTED:return ce.RESOURCE_EXHAUSTED;case pn.INTERNAL:return ce.INTERNAL;case pn.UNAVAILABLE:return ce.UNAVAILABLE;case pn.UNAUTHENTICATED:return ce.UNAUTHENTICATED;case pn.INVALID_ARGUMENT:return ce.INVALID_ARGUMENT;case pn.NOT_FOUND:return ce.NOT_FOUND;case pn.ALREADY_EXISTS:return ce.ALREADY_EXISTS;case pn.PERMISSION_DENIED:return ce.PERMISSION_DENIED;case pn.FAILED_PRECONDITION:return ce.FAILED_PRECONDITION;case pn.ABORTED:return ce.ABORTED;case pn.OUT_OF_RANGE:return ce.OUT_OF_RANGE;case pn.UNIMPLEMENTED:return ce.UNIMPLEMENTED;case pn.DATA_LOSS:return ce.DATA_LOSS;default:return Ve(39323,{code:n})}}(ot=pn||(pn={}))[ot.OK=0]="OK",ot[ot.CANCELLED=1]="CANCELLED",ot[ot.UNKNOWN=2]="UNKNOWN",ot[ot.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ot[ot.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ot[ot.NOT_FOUND=5]="NOT_FOUND",ot[ot.ALREADY_EXISTS=6]="ALREADY_EXISTS",ot[ot.PERMISSION_DENIED=7]="PERMISSION_DENIED",ot[ot.UNAUTHENTICATED=16]="UNAUTHENTICATED",ot[ot.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ot[ot.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ot[ot.ABORTED=10]="ABORTED",ot[ot.OUT_OF_RANGE=11]="OUT_OF_RANGE",ot[ot.UNIMPLEMENTED=12]="UNIMPLEMENTED",ot[ot.INTERNAL=13]="INTERNAL",ot[ot.UNAVAILABLE=14]="UNAVAILABLE",ot[ot.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J7(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z7=new hu([4294967295,4294967295],0);function IR(n){const e=J7().encode(n),t=new P4;return t.update(e),new Uint8Array(t.digest())}function CR(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new hu([t,i],0),new hu([r,s],0)]}class CI{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new Zm(`Invalid padding: ${t}`);if(i<0)throw new Zm(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new Zm(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new Zm(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=hu.fromNumber(this.ge)}ye(e,t,i){let r=e.add(t.multiply(hu.fromNumber(i)));return r.compare(Z7)===1&&(r=new hu([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=IR(e),[i,r]=CR(t);for(let s=0;s<this.hashCount;s++){const a=this.ye(i,r,s);if(!this.we(a))return!1}return!0}static create(e,t,i){const r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new CI(s,r,t);return i.forEach(o=>a.insert(o)),a}insert(e){if(this.ge===0)return;const t=IR(e),[i,r]=CR(t);for(let s=0;s<this.hashCount;s++){const a=this.ye(i,r,s);this.be(a)}}be(e){const t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}}class Zm extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j1{constructor(e,t,i,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const r=new Map;return r.set(e,ov.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new j1(He.min(),r,new Jt(it),Yo(),rt())}}class ov{constructor(e,t,i,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new ov(i,t,rt(),rt(),rt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a0{constructor(e,t,i,r){this.Se=e,this.removedTargetIds=t,this.key=i,this.De=r}}class vF{constructor(e,t){this.targetId=e,this.Ce=t}}class wF{constructor(e,t,i=ni.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=r}}class kR{constructor(){this.ve=0,this.Fe=$R(),this.Me=ni.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=rt(),t=rt(),i=rt();return this.Fe.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:i=i.add(r);break;default:Ve(38017,{changeType:s})}}),new ov(this.Me,this.xe,e,t,i)}Ke(){this.Oe=!1,this.Fe=$R()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,wt(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class eK{constructor(e){this.Ge=e,this.ze=new Map,this.je=Yo(),this.He=gw(),this.Je=gw(),this.Ze=new Jt(it)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const i=this.nt(t);switch(e.state){case 0:this.rt(t)&&i.Le(e.resumeToken);break;case 1:i.We(),i.Ne||i.Ke(),i.Le(e.resumeToken);break;case 2:i.We(),i.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(i.Qe(),i.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),i.Le(e.resumeToken));break;default:Ve(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((i,r)=>{this.rt(r)&&t(r)})}st(e){const t=e.targetId,i=e.Ce.count,r=this.ot(t);if(r){const s=r.target;if(bT(s))if(i===0){const a=new De(s.path);this.et(t,a,vi.newNoDocument(a,He.min()))}else wt(i===1,20013,{expectedCount:i});else{const a=this._t(t);if(a!==i){const o=this.ut(e),l=o?this.ct(o,e,a):1;if(l!==0){this.it(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,u)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:i="",padding:r=0},hashCount:s=0}=t;let a,o;try{a=wu(i).toUint8Array()}catch(l){if(l instanceof H4)return Ap("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{o=new CI(a,r,s)}catch(l){return Ap(l instanceof Zm?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return o.ge===0?null:o}ct(e,t,i){return t.Ce.count===i-this.Pt(e,t.targetId)?0:2}Pt(e,t){const i=this.Ge.getRemoteKeysForTarget(t);let r=0;return i.forEach(s=>{const a=this.Ge.ht(),o=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(o)||(this.et(t,s,null),r++)}),r}Tt(e){const t=new Map;this.ze.forEach((s,a)=>{const o=this.ot(a);if(o){if(s.current&&bT(o.target)){const l=new De(o.target.path);this.It(l).has(a)||this.Et(a,l)||this.et(a,l,vi.newNoDocument(l,e))}s.Be&&(t.set(a,s.ke()),s.Ke())}});let i=rt();this.Je.forEach((s,a)=>{let o=!0;a.forEachWhile(l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(o=!1,!1)}),o&&(i=i.add(s))}),this.je.forEach((s,a)=>a.setReadTime(e));const r=new j1(e,t,this.Ze,this.je,i);return this.je=Yo(),this.He=gw(),this.Je=gw(),this.Ze=new Jt(it),r}Ye(e,t){if(!this.rt(e))return;const i=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,i),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,i){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.qe(t,1):r.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),i&&(this.je=this.je.insert(t,i))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new kR,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new kn(it),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new kn(it),this.He=this.He.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||xe("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new kR),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function gw(){return new Jt(De.comparator)}function $R(){return new Jt(De.comparator)}const tK={asc:"ASCENDING",desc:"DESCENDING"},nK={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},iK={and:"AND",or:"OR"};class rK{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function AT(n,e){return n.useProto3Json||M1(e)?e:{value:e}}function Eb(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function bF(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function sK(n,e){return Eb(n,e.toTimestamp())}function Ma(n){return wt(!!n,49232),He.fromTimestamp(function(t){const i=vu(t);return new Ft(i.seconds,i.nanos)}(n))}function kI(n,e){return TT(n,e).canonicalString()}function TT(n,e){const t=function(r){return new Dt(["projects",r.projectId,"databases",r.database])}(n).child("documents");return e===void 0?t:t.child(e)}function xF(n){const e=Dt.fromString(n);return wt(IF(e),10190,{key:e.toString()}),e}function ST(n,e){return kI(n.databaseId,e.path)}function nE(n,e){const t=xF(e);if(t.get(1)!==n.databaseId.projectId)throw new we(ce.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new we(ce.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new De(AF(t))}function EF(n,e){return kI(n.databaseId,e)}function aK(n){const e=xF(n);return e.length===4?Dt.emptyPath():AF(e)}function IT(n){return new Dt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function AF(n){return wt(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function RR(n,e,t){return{name:ST(n,e),fields:t.value.mapValue.fields}}function oK(n,e){let t;if("targetChange"in e){e.targetChange;const i=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:Ve(39313,{state:u})}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=function(u,c){return u.useProto3Json?(wt(c===void 0||typeof c=="string",58123),ni.fromBase64String(c||"")):(wt(c===void 0||c instanceof Buffer||c instanceof Uint8Array,16193),ni.fromUint8Array(c||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,o=a&&function(u){const c=u.code===void 0?ce.UNKNOWN:_F(u.code);return new we(c,u.message||"")}(a);t=new wF(i,r,s,o||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const r=nE(n,i.document.name),s=Ma(i.document.updateTime),a=i.document.createTime?Ma(i.document.createTime):He.min(),o=new Zi({mapValue:{fields:i.document.fields}}),l=vi.newFoundDocument(r,s,a,o),u=i.targetIds||[],c=i.removedTargetIds||[];t=new a0(u,c,l.key,l)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const r=nE(n,i.document),s=i.readTime?Ma(i.readTime):He.min(),a=vi.newNoDocument(r,s),o=i.removedTargetIds||[];t=new a0([],o,a.key,a)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const r=nE(n,i.document),s=i.removedTargetIds||[];t=new a0([],s,r,null)}else{if(!("filter"in e))return Ve(11601,{Vt:e});{e.filter;const i=e.filter;i.targetId;const{count:r=0,unchangedNames:s}=i,a=new X7(r,s),o=i.targetId;t=new vF(o,a)}}return t}function lK(n,e){let t;if(e instanceof av)t={update:RR(n,e.key,e.value)};else if(e instanceof yF)t={delete:ST(n,e.key)};else if(e instanceof Du)t={update:RR(n,e.key,e.data),updateMask:yK(e.fieldMask)};else{if(!(e instanceof G7))return Ve(16599,{dt:e.type});t={verify:ST(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(s,a){const o=a.transform;if(o instanceof my)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof gy)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof yy)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof xb)return{fieldPath:a.field.canonicalString(),increment:o.Ae};throw Ve(20930,{transform:a.transform})}(0,i))),e.precondition.isNone||(t.currentDocument=function(r,s){return s.updateTime!==void 0?{updateTime:sK(r,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:Ve(27497)}(n,e.precondition)),t}function uK(n,e){return n&&n.length>0?(wt(e!==void 0,14353),n.map(t=>function(r,s){let a=r.updateTime?Ma(r.updateTime):Ma(s);return a.isEqual(He.min())&&(a=Ma(s)),new H7(a,r.transformResults||[])}(t,e))):[]}function cK(n,e){return{documents:[EF(n,e.path)]}}function dK(n,e){const t={structuredQuery:{}},i=e.path;let r;e.collectionGroup!==null?(r=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=EF(n,r);const s=function(u){if(u.length!==0)return SF(Ws.create(u,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const a=function(u){if(u.length!==0)return u.map(c=>function(f){return{field:Th(f.field),direction:pK(f.dir)}}(c))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const o=AT(n,e.limit);return o!==null&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ft:t,parent:r}}function hK(n){let e=aK(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let r=null;if(i>0){wt(i===1,65062);const c=t.from[0];c.allDescendants?r=c.collectionId:e=e.child(c.collectionId)}let s=[];t.where&&(s=function(h){const f=TF(h);return f instanceof Ws&&eF(f)?f.getFilters():[f]}(t.where));let a=[];t.orderBy&&(a=function(h){return h.map(f=>function(y){return new py(Sh(y.field),function(x){switch(x){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(y.direction))}(f))}(t.orderBy));let o=null;t.limit&&(o=function(h){let f;return f=typeof h=="object"?h.value:h,M1(f)?null:f}(t.limit));let l=null;t.startAt&&(l=function(h){const f=!!h.before,m=h.values||[];return new bb(m,f)}(t.startAt));let u=null;return t.endAt&&(u=function(h){const f=!h.before,m=h.values||[];return new bb(m,f)}(t.endAt)),C7(e,r,a,s,o,"F",l,u)}function fK(n,e){const t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ve(28987,{purpose:r})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function TF(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const i=Sh(t.unaryFilter.field);return gn.create(i,"==",{doubleValue:NaN});case"IS_NULL":const r=Sh(t.unaryFilter.field);return gn.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Sh(t.unaryFilter.field);return gn.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Sh(t.unaryFilter.field);return gn.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ve(61313);default:return Ve(60726)}}(n):n.fieldFilter!==void 0?function(t){return gn.create(Sh(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ve(58110);default:return Ve(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Ws.create(t.compositeFilter.filters.map(i=>TF(i)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return Ve(1026)}}(t.compositeFilter.op))}(n):Ve(30097,{filter:n})}function pK(n){return tK[n]}function mK(n){return nK[n]}function gK(n){return iK[n]}function Th(n){return{fieldPath:n.canonicalString()}}function Sh(n){return Zn.fromServerFormat(n.fieldPath)}function SF(n){return n instanceof gn?function(t){if(t.op==="=="){if(_R(t.value))return{unaryFilter:{field:Th(t.field),op:"IS_NAN"}};if(yR(t.value))return{unaryFilter:{field:Th(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(_R(t.value))return{unaryFilter:{field:Th(t.field),op:"IS_NOT_NAN"}};if(yR(t.value))return{unaryFilter:{field:Th(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Th(t.field),op:mK(t.op),value:t.value}}}(n):n instanceof Ws?function(t){const i=t.getFilters().map(r=>SF(r));return i.length===1?i[0]:{compositeFilter:{op:gK(t.op),filters:i}}}(n):Ve(54877,{filter:n})}function yK(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function IF(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function CF(n){return!!n&&typeof n._toProto=="function"&&n._protoValueType==="ProtoValue"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tu{constructor(e,t,i,r,s=He.min(),a=He.min(),o=ni.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=o,this.expectedCount=l}withSequenceNumber(e){return new tu(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new tu(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new tu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new tu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _K{constructor(e){this.yt=e}}function vK(n){const e=hK({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ET(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wK{constructor(){this.Sn=new bK}addToCollectionParentIndex(e,t){return this.Sn.add(t),he.resolve()}getCollectionParents(e,t){return he.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return he.resolve()}deleteFieldIndex(e,t){return he.resolve()}deleteAllFieldIndexes(e){return he.resolve()}createTargetIndexes(e,t){return he.resolve()}getDocumentsMatchingTarget(e,t){return he.resolve(null)}getIndexType(e,t){return he.resolve(0)}getFieldIndexes(e,t){return he.resolve([])}getNextCollectionGroupToUpdate(e){return he.resolve(null)}getMinOffset(e,t){return he.resolve(_u.min())}getMinOffsetFromCollectionGroup(e,t){return he.resolve(_u.min())}updateCollectionGroup(e,t,i){return he.resolve()}updateIndexEntries(e,t){return he.resolve()}}class bK{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t]||new kn(Dt.comparator),s=!r.has(i);return this.index[t]=r.add(i),s}has(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t];return r&&r.has(i)}getEntries(e){return(this.index[e]||new kn(Dt.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PR={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},kF=41943040;class Qi{static withCacheSize(e){return new Qi(e,Qi.DEFAULT_COLLECTION_PERCENTILE,Qi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Qi.DEFAULT_COLLECTION_PERCENTILE=10,Qi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Qi.DEFAULT=new Qi(kF,Qi.DEFAULT_COLLECTION_PERCENTILE,Qi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Qi.DISABLED=new Qi(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cp{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new Cp(0)}static ar(){return new Cp(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NR="LruGarbageCollector",xK=1048576;function DR([n,e],[t,i]){const r=it(n,t);return r===0?it(e,i):r}class EK{constructor(e){this.Pr=e,this.buffer=new kn(DR),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const i=this.buffer.last();DR(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}}class AK{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){xe(NR,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Vp(t)?xe(NR,"Ignoring IndexedDB error during garbage collection: ",t):await zp(t)}await this.Ar(3e5)})}}class TK{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(t===0)return he.resolve(D1.ce);const i=new EK(t);return this.Vr.forEachTarget(e,r=>i.Er(r.sequenceNumber)).next(()=>this.Vr.mr(e,r=>i.Er(r))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.Vr.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(xe("LruGarbageCollector","Garbage collection skipped; disabled"),he.resolve(PR)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(xe("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),PR):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let i,r,s,a,o,l,u;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(xe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),r=this.params.maximumSequenceNumbersToCollect):r=h,a=Date.now(),this.nthSequenceNumber(e,r))).next(h=>(i=h,o=Date.now(),this.removeTargets(e,i,t))).next(h=>(s=h,l=Date.now(),this.removeOrphanedDocuments(e,i))).next(h=>(u=Date.now(),Eh()<=nt.DEBUG&&xe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-c}ms
	Determined least recently used ${r} in `+(o-a)+`ms
	Removed ${s} targets in `+(l-o)+`ms
	Removed ${h} documents in `+(u-l)+`ms
Total Duration: ${u-c}ms`),he.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:h})))}}function SK(n,e){return new TK(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IK{constructor(){this.changes=new eh(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,vi.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?he.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CK{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kK{constructor(e,t,i,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=r}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(i=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(i!==null&&Lg(i.mutation,r,Ir.empty(),Ft.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,rt()).next(()=>i))}getLocalViewOfDocuments(e,t,i=rt()){const r=wc();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i).next(s=>{let a=Jm();return s.forEach((o,l)=>{a=a.insert(o,l.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const i=wc();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,rt()))}populateOverlays(e,t,i){const r=[];return i.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((a,o)=>{t.set(a,o)})})}computeViews(e,t,i,r){let s=Yo();const a=Og(),o=function(){return Og()}();return t.forEach((l,u)=>{const c=i.get(u.key);r.has(u.key)&&(c===void 0||c.mutation instanceof Du)?s=s.insert(u.key,u):c!==void 0?(a.set(u.key,c.mutation.getFieldMask()),Lg(c.mutation,u,c.mutation.getFieldMask(),Ft.now())):a.set(u.key,Ir.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((u,c)=>a.set(u,c)),t.forEach((u,c)=>o.set(u,new CK(c,a.get(u)??null))),o))}recalculateAndSaveOverlays(e,t){const i=Og();let r=new Jt((a,o)=>a-o),s=rt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const o of a)o.keys().forEach(l=>{const u=t.get(l);if(u===null)return;let c=i.get(l)||Ir.empty();c=o.applyToLocalView(u,c),i.set(l,c);const h=(r.get(o.batchId)||rt()).add(l);r=r.insert(o.batchId,h)})}).next(()=>{const a=[],o=r.getReverseIterator();for(;o.hasNext();){const l=o.getNext(),u=l.key,c=l.value,h=uF();c.forEach(f=>{if(!s.has(f)){const m=mF(t.get(f),i.get(f));m!==null&&h.set(f,m),s=s.add(f)}}),a.push(this.documentOverlayCache.saveOverlays(e,u,h))}return he.waitFor(a)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i,r){return k7(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):rF(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,r):this.getDocumentsMatchingCollectionQuery(e,t,i,r)}getNextDocuments(e,t,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,r).next(s=>{const a=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,r-s.size):he.resolve(wc());let o=cy,l=s;return a.next(u=>he.forEach(u,(c,h)=>(o<h.largestBatchId&&(o=h.largestBatchId),s.get(c)?he.resolve():this.remoteDocumentCache.getEntry(e,c).next(f=>{l=l.insert(c,f)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,l,u,rt())).next(c=>({batchId:o,changes:lF(c)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new De(t)).next(i=>{let r=Jm();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,i,r){const s=t.collectionGroup;let a=Jm();return this.indexManager.getCollectionParents(e,s).next(o=>he.forEach(o,l=>{const u=function(h,f){return new jp(f,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,i,r).next(c=>{c.forEach((h,f)=>{a=a.insert(h,f)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,i,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,s,r))).next(a=>{s.forEach((l,u)=>{const c=u.getKey();a.get(c)===null&&(a=a.insert(c,vi.newInvalidDocument(c)))});let o=Jm();return a.forEach((l,u)=>{const c=s.get(l);c!==void 0&&Lg(c.mutation,u,Ir.empty(),Ft.now()),F1(t,u)&&(o=o.insert(l,u))}),o})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $K{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return he.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,function(r){return{id:r.id,version:r.version,createTime:Ma(r.createTime)}}(t)),he.resolve()}getNamedQuery(e,t){return he.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,function(r){return{name:r.name,query:vK(r.bundledQuery),readTime:Ma(r.readTime)}}(t)),he.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RK{constructor(){this.overlays=new Jt(De.comparator),this.Lr=new Map}getOverlay(e,t){return he.resolve(this.overlays.get(t))}getOverlays(e,t){const i=wc();return he.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((r,s)=>{this.bt(e,t,s)}),he.resolve()}removeOverlaysForBatchId(e,t,i){const r=this.Lr.get(i);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.Lr.delete(i)),he.resolve()}getOverlaysForCollection(e,t,i){const r=wc(),s=t.length+1,a=new De(t.child("")),o=this.overlays.getIteratorFrom(a);for(;o.hasNext();){const l=o.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&l.largestBatchId>i&&r.set(l.getKey(),l)}return he.resolve(r)}getOverlaysForCollectionGroup(e,t,i,r){let s=new Jt((u,c)=>u-c);const a=this.overlays.getIterator();for(;a.hasNext();){const u=a.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>i){let c=s.get(u.largestBatchId);c===null&&(c=wc(),s=s.insert(u.largestBatchId,c)),c.set(u.getKey(),u)}}const o=wc(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,c)=>o.set(u,c)),!(o.size()>=r)););return he.resolve(o)}bt(e,t,i){const r=this.overlays.get(i.key);if(r!==null){const a=this.Lr.get(r.largestBatchId).delete(i.key);this.Lr.set(r.largestBatchId,a)}this.overlays=this.overlays.insert(i.key,new Y7(t,i));let s=this.Lr.get(t);s===void 0&&(s=rt(),this.Lr.set(t,s)),this.Lr.set(t,s.add(i.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PK{constructor(){this.sessionToken=ni.EMPTY_BYTE_STRING}getSessionToken(e){return he.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,he.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $I{constructor(){this.kr=new kn(Bn.Kr),this.qr=new kn(Bn.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const i=new Bn(e,t);this.kr=this.kr.add(i),this.qr=this.qr.add(i)}$r(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.Wr(new Bn(e,t))}Qr(e,t){e.forEach(i=>this.removeReference(i,t))}Gr(e){const t=new De(new Dt([])),i=new Bn(t,e),r=new Bn(t,e+1),s=[];return this.qr.forEachInRange([i,r],a=>{this.Wr(a),s.push(a.key)}),s}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new De(new Dt([])),i=new Bn(t,e),r=new Bn(t,e+1);let s=rt();return this.qr.forEachInRange([i,r],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new Bn(e,0),i=this.kr.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class Bn{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return De.comparator(e.key,t.key)||it(e.Hr,t.Hr)}static Ur(e,t){return it(e.Hr,t.Hr)||De.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NK{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new kn(Bn.Kr)}checkEmpty(e){return he.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,r){const s=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new K7(s,t,i,r);this.mutationQueue.push(a);for(const o of r)this.Jr=this.Jr.add(new Bn(o.key,s)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return he.resolve(a)}lookupMutationBatch(e,t){return he.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,r=this.Xr(i),s=r<0?0:r;return he.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return he.resolve(this.mutationQueue.length===0?wI:this.Yn-1)}getAllMutationBatches(e){return he.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new Bn(t,0),r=new Bn(t,Number.POSITIVE_INFINITY),s=[];return this.Jr.forEachInRange([i,r],a=>{const o=this.Zr(a.Hr);s.push(o)}),he.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new kn(it);return t.forEach(r=>{const s=new Bn(r,0),a=new Bn(r,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([s,a],o=>{i=i.add(o.Hr)})}),he.resolve(this.Yr(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,r=i.length+1;let s=i;De.isDocumentKey(s)||(s=s.child(""));const a=new Bn(new De(s),0);let o=new kn(it);return this.Jr.forEachWhile(l=>{const u=l.key.path;return!!i.isPrefixOf(u)&&(u.length===r&&(o=o.add(l.Hr)),!0)},a),he.resolve(this.Yr(o))}Yr(e){const t=[];return e.forEach(i=>{const r=this.Zr(i);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){wt(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let i=this.Jr;return he.forEach(t.mutations,r=>{const s=new Bn(r.key,t.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Jr=i})}nr(e){}containsKey(e,t){const i=new Bn(t,0),r=this.Jr.firstAfterOrEqual(i);return he.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,he.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DK{constructor(e){this.ti=e,this.docs=function(){return new Jt(De.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,r=this.docs.get(i),s=r?r.size:0,a=this.ti(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return he.resolve(i?i.document.mutableCopy():vi.newInvalidDocument(t))}getEntries(e,t){let i=Yo();return t.forEach(r=>{const s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():vi.newInvalidDocument(r))}),he.resolve(i)}getDocumentsMatchingQuery(e,t,i,r){let s=Yo();const a=t.path,o=new De(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(o);for(;l.hasNext();){const{key:u,value:{document:c}}=l.getNext();if(!a.isPrefixOf(u.path))break;u.path.length>a.length+1||s7(r7(c),i)<=0||(r.has(c.key)||F1(t,c))&&(s=s.insert(c.key,c.mutableCopy()))}return he.resolve(s)}getAllFromCollectionGroup(e,t,i,r){Ve(9500)}ni(e,t){return he.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new MK(this)}getSize(e){return he.resolve(this.size)}}class MK extends IK{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?t.push(this.Mr.addEntry(e,r)):this.Mr.removeEntry(i)}),he.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OK{constructor(e){this.persistence=e,this.ri=new eh(t=>EI(t),AI),this.lastRemoteSnapshotVersion=He.min(),this.highestTargetId=0,this.ii=0,this.si=new $I,this.targetCount=0,this.oi=Cp._r()}forEachTarget(e,t){return this.ri.forEach((i,r)=>t(r)),he.resolve()}getLastRemoteSnapshotVersion(e){return he.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return he.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),he.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.ii&&(this.ii=t),he.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new Cp(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,he.resolve()}updateTargetData(e,t){return this.lr(t),he.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,he.resolve()}removeTargets(e,t,i){let r=0;const s=[];return this.ri.forEach((a,o)=>{o.sequenceNumber<=t&&i.get(o.targetId)===null&&(this.ri.delete(a),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),he.waitFor(s).next(()=>r)}getTargetCount(e){return he.resolve(this.targetCount)}getTargetData(e,t){const i=this.ri.get(t)||null;return he.resolve(i)}addMatchingKeys(e,t,i){return this.si.$r(t,i),he.resolve()}removeMatchingKeys(e,t,i){this.si.Qr(t,i);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(a=>{s.push(r.markPotentiallyOrphaned(e,a))}),he.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),he.resolve()}getMatchingKeysForTargetId(e,t){const i=this.si.jr(t);return he.resolve(i)}containsKey(e,t){return he.resolve(this.si.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $F{constructor(e,t){this._i={},this.overlays={},this.ai=new D1(0),this.ui=!1,this.ui=!0,this.ci=new PK,this.referenceDelegate=e(this),this.li=new OK(this),this.indexManager=new wK,this.remoteDocumentCache=function(r){return new DK(r)}(i=>this.referenceDelegate.hi(i)),this.serializer=new _K(t),this.Pi=new $K(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new RK,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this._i[e.toKey()];return i||(i=new NK(t,this.referenceDelegate),this._i[e.toKey()]=i),i}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,i){xe("MemoryPersistence","Starting transaction:",e);const r=new LK(this.ai.next());return this.referenceDelegate.Ti(),i(r).next(s=>this.referenceDelegate.Ii(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Ei(e,t){return he.or(Object.values(this._i).map(i=>()=>i.containsKey(e,t)))}}class LK extends o7{constructor(e){super(),this.currentSequenceNumber=e}}class RI{constructor(e){this.persistence=e,this.Ri=new $I,this.Ai=null}static Vi(e){return new RI(e)}get di(){if(this.Ai)return this.Ai;throw Ve(60996)}addReference(e,t,i){return this.Ri.addReference(i,t),this.di.delete(i.toString()),he.resolve()}removeReference(e,t,i){return this.Ri.removeReference(i,t),this.di.add(i.toString()),he.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),he.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(r=>this.di.add(r.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(s=>this.di.add(s.toString()))}).next(()=>i.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return he.forEach(this.di,i=>{const r=De.fromPath(i);return this.mi(e,r).next(s=>{s||t.removeEntry(r,He.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(i=>{i?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return he.or([()=>he.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class Ab{constructor(e,t){this.persistence=e,this.fi=new eh(i=>c7(i.path),(i,r)=>i.isEqual(r)),this.garbageCollector=SK(this,t)}static Vi(e,t){return new Ab(e,t)}Ti(){}Ii(e){return he.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(i=>t.next(r=>i+r))}pr(e){let t=0;return this.mr(e,i=>{t++}).next(()=>t)}mr(e,t){return he.forEach(this.fi,(i,r)=>this.wr(e,i,r).next(s=>s?he.resolve():t(r)))}removeTargets(e,t,i){return this.persistence.getTargetCache().removeTargets(e,t,i)}removeOrphanedDocuments(e,t){let i=0;const r=this.persistence.getRemoteDocumentCache(),s=r.newChangeBuffer();return r.ni(e,a=>this.wr(e,a,t).next(o=>{o||(i++,s.removeEntry(a,He.min()))})).next(()=>s.apply(e)).next(()=>i)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),he.resolve()}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,i)}addReference(e,t,i){return this.fi.set(i,e.currentSequenceNumber),he.resolve()}removeReference(e,t,i){return this.fi.set(i,e.currentSequenceNumber),he.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),he.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=i0(e.data.value)),t}wr(e,t,i){return he.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.fi.get(t);return he.resolve(r!==void 0&&r>i)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PI{constructor(e,t,i,r){this.targetId=e,this.fromCache=t,this.Ts=i,this.Is=r}static Es(e,t){let i=rt(),r=rt();for(const s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new PI(e,t.fromCache,i,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FK{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zK{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=function(){return c9()?8:l7(xi())>0?6:4}()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,i,r){const s={result:null};return this.gs(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ps(e,t,r,i).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new FK;return this.ys(e,t,a).next(o=>{if(s.result=o,this.As)return this.ws(e,t,a,o.size)})}).next(()=>s.result)}ws(e,t,i,r){return i.documentReadCount<this.Vs?(Eh()<=nt.DEBUG&&xe("QueryEngine","SDK will not create cache indexes for query:",Ah(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),he.resolve()):(Eh()<=nt.DEBUG&&xe("QueryEngine","Query:",Ah(t),"scans",i.documentReadCount,"local documents and returns",r,"documents as results."),i.documentReadCount>this.ds*r?(Eh()<=nt.DEBUG&&xe("QueryEngine","The SDK decides to create cache indexes for query:",Ah(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Da(t))):he.resolve())}gs(e,t){if(xR(t))return he.resolve(null);let i=Da(t);return this.indexManager.getIndexType(e,i).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=ET(t,null,"F"),i=Da(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(s=>{const a=rt(...s);return this.fs.getDocuments(e,a).next(o=>this.indexManager.getMinOffset(e,i).next(l=>{const u=this.bs(t,o);return this.Ss(t,u,a,l.readTime)?this.gs(e,ET(t,null,"F")):this.Ds(e,u,t,l)}))})))}ps(e,t,i,r){return xR(t)||r.isEqual(He.min())?he.resolve(null):this.fs.getDocuments(e,i).next(s=>{const a=this.bs(t,s);return this.Ss(t,a,i,r)?he.resolve(null):(Eh()<=nt.DEBUG&&xe("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Ah(t)),this.Ds(e,a,t,i7(r,cy)).next(o=>o))})}bs(e,t){let i=new kn(aF(e));return t.forEach((r,s)=>{F1(e,s)&&(i=i.add(s))}),i}Ss(e,t,i,r){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}ys(e,t,i){return Eh()<=nt.DEBUG&&xe("QueryEngine","Using full collection scan to execute query:",Ah(t)),this.fs.getDocumentsMatchingQuery(e,t,_u.min(),i)}Ds(e,t,i,r){return this.fs.getDocumentsMatchingQuery(e,i,r).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NI="LocalStore",VK=3e8;class jK{constructor(e,t,i,r){this.persistence=e,this.Cs=t,this.serializer=r,this.vs=new Jt(it),this.Fs=new eh(s=>EI(s),AI),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(i)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new kK(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}function BK(n,e,t,i){return new jK(n,e,t,i)}async function RF(n,e){const t=We(n);return await t.persistence.runTransaction("Handle user change","readonly",i=>{let r;return t.mutationQueue.getAllMutationBatches(i).next(s=>(r=s,t.Os(e),t.mutationQueue.getAllMutationBatches(i))).next(s=>{const a=[],o=[];let l=rt();for(const u of r){a.push(u.batchId);for(const c of u.mutations)l=l.add(c.key)}for(const u of s){o.push(u.batchId);for(const c of u.mutations)l=l.add(c.key)}return t.localDocuments.getDocuments(i,l).next(u=>({Ns:u,removedBatchIds:a,addedBatchIds:o}))})})}function UK(n,e){const t=We(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const r=e.batch.keys(),s=t.xs.newChangeBuffer({trackRemovals:!0});return function(o,l,u,c){const h=u.batch,f=h.keys();let m=he.resolve();return f.forEach(y=>{m=m.next(()=>c.getEntry(l,y)).next(_=>{const x=u.docVersions.get(y);wt(x!==null,48541),_.version.compareTo(x)<0&&(h.applyToRemoteDocument(_,u),_.isValidDocument()&&(_.setReadTime(u.commitVersion),c.addEntry(_)))})}),m.next(()=>o.mutationQueue.removeMutationBatch(l,h))}(t,i,e,s).next(()=>s.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(o){let l=rt();for(let u=0;u<o.mutationResults.length;++u)o.mutationResults[u].transformResults.length>0&&(l=l.add(o.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(i,r))})}function PF(n){const e=We(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function HK(n,e){const t=We(n),i=e.snapshotVersion;let r=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.xs.newChangeBuffer({trackRemovals:!0});r=t.vs;const o=[];e.targetChanges.forEach((c,h)=>{const f=r.get(h);if(!f)return;o.push(t.li.removeMatchingKeys(s,c.removedDocuments,h).next(()=>t.li.addMatchingKeys(s,c.addedDocuments,h)));let m=f.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(h)!==null?m=m.withResumeToken(ni.EMPTY_BYTE_STRING,He.min()).withLastLimboFreeSnapshotVersion(He.min()):c.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(c.resumeToken,i)),r=r.insert(h,m),function(_,x,v){return _.resumeToken.approximateByteSize()===0||x.snapshotVersion.toMicroseconds()-_.snapshotVersion.toMicroseconds()>=VK?!0:v.addedDocuments.size+v.modifiedDocuments.size+v.removedDocuments.size>0}(f,m,c)&&o.push(t.li.updateTargetData(s,m))});let l=Yo(),u=rt();if(e.documentUpdates.forEach(c=>{e.resolvedLimboDocuments.has(c)&&o.push(t.persistence.referenceDelegate.updateLimboDocument(s,c))}),o.push(WK(s,a,e.documentUpdates).next(c=>{l=c.Bs,u=c.Ls})),!i.isEqual(He.min())){const c=t.li.getLastRemoteSnapshotVersion(s).next(h=>t.li.setTargetsMetadata(s,s.currentSequenceNumber,i));o.push(c)}return he.waitFor(o).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,u)).next(()=>l)}).then(s=>(t.vs=r,s))}function WK(n,e,t){let i=rt(),r=rt();return t.forEach(s=>i=i.add(s)),e.getEntries(n,i).next(s=>{let a=Yo();return t.forEach((o,l)=>{const u=s.get(o);l.isFoundDocument()!==u.isFoundDocument()&&(r=r.add(o)),l.isNoDocument()&&l.version.isEqual(He.min())?(e.removeEntry(o,l.readTime),a=a.insert(o,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),a=a.insert(o,l)):xe(NI,"Ignoring outdated watch update for ",o,". Current version:",u.version," Watch version:",l.version)}),{Bs:a,Ls:r}})}function qK(n,e){const t=We(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=wI),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function GK(n,e){const t=We(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return t.li.getTargetData(i,e).next(s=>s?(r=s,he.resolve(r)):t.li.allocateTargetId(i).next(a=>(r=new tu(e,a,"TargetPurposeListen",i.currentSequenceNumber),t.li.addTargetData(i,r).next(()=>r))))}).then(i=>{const r=t.vs.get(i.targetId);return(r===null||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.vs=t.vs.insert(i.targetId,i),t.Fs.set(e,i.targetId)),i})}async function CT(n,e,t){const i=We(n),r=i.vs.get(e),s=t?"readwrite":"readwrite-primary";try{t||await i.persistence.runTransaction("Release target",s,a=>i.persistence.referenceDelegate.removeTarget(a,r))}catch(a){if(!Vp(a))throw a;xe(NI,`Failed to update sequence numbers for target ${e}: ${a}`)}i.vs=i.vs.remove(e),i.Fs.delete(r.target)}function MR(n,e,t){const i=We(n);let r=He.min(),s=rt();return i.persistence.runTransaction("Execute query","readwrite",a=>function(l,u,c){const h=We(l),f=h.Fs.get(c);return f!==void 0?he.resolve(h.vs.get(f)):h.li.getTargetData(u,c)}(i,a,Da(e)).next(o=>{if(o)return r=o.lastLimboFreeSnapshotVersion,i.li.getMatchingKeysForTargetId(a,o.targetId).next(l=>{s=l})}).next(()=>i.Cs.getDocumentsMatchingQuery(a,e,t?r:He.min(),t?s:rt())).next(o=>(KK(i,P7(e),o),{documents:o,ks:s})))}function KK(n,e,t){let i=n.Ms.get(e)||He.min();t.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.Ms.set(e,i)}class OR{constructor(){this.activeTargetIds=F7()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class YK{constructor(){this.vo=new OR,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,i){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new OR,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XK{Mo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LR="ConnectivityMonitor";class FR{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){xe(LR,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){xe(LR,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yw=null;function kT(){return yw===null?yw=function(){return 268435456+Math.round(2147483648*Math.random())}():yw++,"0x"+yw.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iE="RestConnection",QK={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class JK{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${i}/databases/${r}`,this.$o=this.databaseId.database===vb?`project_id=${i}`:`project_id=${i}&database_id=${r}`}Wo(e,t,i,r,s){const a=kT(),o=this.Qo(e,t.toUriEncodedString());xe(iE,`Sending RPC '${e}' ${a}:`,o,i);const l={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(l,r,s);const{host:u}=new URL(o),c=Qd(u);return this.zo(e,o,l,i,c).then(h=>(xe(iE,`Received RPC '${e}' ${a}: `,h),h),h=>{throw Ap(iE,`RPC '${e}' ${a} failed with error: `,h,"url: ",o,"request:",i),h})}jo(e,t,i,r,s,a){return this.Wo(e,t,i,r,s)}Go(e,t,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Fp}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((r,s)=>e[s]=r),i&&i.headers.forEach((r,s)=>e[s]=r)}Qo(e,t){const i=QK[e];let r=`${this.qo}/v1/${t}:${i}`;return this.databaseInfo.apiKey&&(r=`${r}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),r}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZK{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oi="WebChannelConnection",Cm=(n,e,t)=>{n.listen(e,i=>{try{t(i)}catch(r){setTimeout(()=>{throw r},0)}})};class of extends JK{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!of.c_){const e=O4();Cm(e,M4.STAT_EVENT,t=>{t.stat===gT.PROXY?xe(oi,"STAT_EVENT: detected buffering proxy"):t.stat===gT.NOPROXY&&xe(oi,"STAT_EVENT: detected no buffering proxy")}),of.c_=!0}}zo(e,t,i,r,s){const a=kT();return new Promise((o,l)=>{const u=new N4;u.setWithCredentials(!0),u.listenOnce(D4.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case n0.NO_ERROR:const h=u.getResponseJson();xe(oi,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(h)),o(h);break;case n0.TIMEOUT:xe(oi,`RPC '${e}' ${a} timed out`),l(new we(ce.DEADLINE_EXCEEDED,"Request time out"));break;case n0.HTTP_ERROR:const f=u.getStatus();if(xe(oi,`RPC '${e}' ${a} failed with status:`,f,"response text:",u.getResponseText()),f>0){let m=u.getResponseJson();Array.isArray(m)&&(m=m[0]);const y=m==null?void 0:m.error;if(y&&y.status&&y.message){const _=function(v){const w=v.toLowerCase().replace(/_/g,"-");return Object.values(ce).indexOf(w)>=0?w:ce.UNKNOWN}(y.status);l(new we(_,y.message))}else l(new we(ce.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new we(ce.UNAVAILABLE,"Connection failed."));break;default:Ve(9055,{l_:e,streamId:a,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{xe(oi,`RPC '${e}' ${a} completed.`)}});const c=JSON.stringify(r);xe(oi,`RPC '${e}' ${a} sending request:`,r),u.send(t,"POST",c,i,15)})}T_(e,t,i){const r=kT(),s=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Go(o.initMessageHeaders,t,i),o.encodeInitMessageHeaders=!0;const u=s.join("");xe(oi,`Creating RPC '${e}' stream ${r}: ${u}`,o);const c=a.createWebChannel(u,o);this.I_(c);let h=!1,f=!1;const m=new ZK({Ho:y=>{f?xe(oi,`Not sending because RPC '${e}' stream ${r} is closed:`,y):(h||(xe(oi,`Opening RPC '${e}' stream ${r} transport.`),c.open(),h=!0),xe(oi,`RPC '${e}' stream ${r} sending:`,y),c.send(y))},Jo:()=>c.close()});return Cm(c,Qm.EventType.OPEN,()=>{f||(xe(oi,`RPC '${e}' stream ${r} transport opened.`),m.i_())}),Cm(c,Qm.EventType.CLOSE,()=>{f||(f=!0,xe(oi,`RPC '${e}' stream ${r} transport closed`),m.o_(),this.E_(c))}),Cm(c,Qm.EventType.ERROR,y=>{f||(f=!0,Ap(oi,`RPC '${e}' stream ${r} transport errored. Name:`,y.name,"Message:",y.message),m.o_(new we(ce.UNAVAILABLE,"The operation could not be completed")))}),Cm(c,Qm.EventType.MESSAGE,y=>{var _;if(!f){const x=y.data[0];wt(!!x,16349);const v=x,w=(v==null?void 0:v.error)||((_=v[0])==null?void 0:_.error);if(w){xe(oi,`RPC '${e}' stream ${r} received error:`,w);const E=w.status;let C=function(I){const k=pn[I];if(k!==void 0)return _F(k)}(E),D=w.message;C===void 0&&(C=ce.INTERNAL,D="Unknown error status: "+E+" with message "+w.message),f=!0,m.o_(new we(C,D)),c.close()}else xe(oi,`RPC '${e}' stream ${r} received:`,x),m.__(x)}}),of.u_(),setTimeout(()=>{m.s_()},0),m}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,i){super.Go(e,t,i),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return L4()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eY(n){return new of(n)}function rE(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B1(n){return new rK(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */of.c_=!1;class NF{constructor(e,t,i=1e3,r=1.5,s=6e4){this.Ci=e,this.timerId=t,this.R_=i,this.A_=r,this.V_=s,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),i=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-i);r>0&&xe("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zR="PersistentStream";class DF{constructor(e,t,i,r,s,a,o,l){this.Ci=e,this.b_=i,this.S_=r,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=o,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new NF(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===ce.RESOURCE_EXHAUSTED?(Ko(t.toString()),Ko("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===ce.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.D_===t&&this.G_(i,r)},i=>{e(()=>{const r=new we(ce.UNKNOWN,"Fetching auth token failed: "+i.message);return this.z_(r)})})}G_(e,t){const i=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{i(()=>this.listener.Zo())}),this.stream.Yo(()=>{i(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(r=>{i(()=>this.z_(r))}),this.stream.onMessage(r=>{i(()=>++this.F_==1?this.H_(r):this.onNext(r))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return xe(zR,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(xe(zR,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class tY extends DF{constructor(e,t,i,r,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,r,a),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=oK(this.serializer,e),i=function(s){if(!("targetChange"in s))return He.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?He.min():a.readTime?Ma(a.readTime):He.min()}(e);return this.listener.J_(t,i)}Z_(e){const t={};t.database=IT(this.serializer),t.addTarget=function(s,a){let o;const l=a.target;if(o=bT(l)?{documents:cK(s,l)}:{query:dK(s,l).ft},o.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){o.resumeToken=bF(s,a.resumeToken);const u=AT(s,a.expectedCount);u!==null&&(o.expectedCount=u)}else if(a.snapshotVersion.compareTo(He.min())>0){o.readTime=Eb(s,a.snapshotVersion.toTimestamp());const u=AT(s,a.expectedCount);u!==null&&(o.expectedCount=u)}return o}(this.serializer,e);const i=fK(this.serializer,e);i&&(t.labels=i),this.K_(t)}X_(e){const t={};t.database=IT(this.serializer),t.removeTarget=e,this.K_(t)}}class nY extends DF{constructor(e,t,i,r,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,r,a),this.serializer=s}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return wt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,wt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){wt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=uK(e.writeResults,e.commitTime),i=Ma(e.commitTime);return this.listener.na(i,t)}ra(){const e={};e.database=IT(this.serializer),this.K_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(i=>lK(this.serializer,i))};this.K_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iY{}class rY extends iY{constructor(e,t,i,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new we(ce.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,i,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Wo(e,TT(t,i),r,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===ce.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new we(ce.UNKNOWN,s.toString())})}jo(e,t,i,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.jo(e,TT(t,i),r,a,o,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===ce.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new we(ce.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}function sY(n,e,t,i){return new rY(n,e,t,i)}class aY{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ko(t),this.aa=!1):xe("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vd="RemoteStore";class oY{constructor(e,t,i,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=s,this.Aa.Mo(a=>{i.enqueueAndForget(async()=>{th(this)&&(xe(Vd,"Restarting streams for network reachability change."),await async function(l){const u=We(l);u.Ea.add(4),await lv(u),u.Va.set("Unknown"),u.Ea.delete(4),await U1(u)}(this))})}),this.Va=new aY(i,r)}}async function U1(n){if(th(n))for(const e of n.Ra)await e(!0)}async function lv(n){for(const e of n.Ra)await e(!1)}function MF(n,e){const t=We(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),LI(t)?OI(t):Bp(t).O_()&&MI(t,e))}function DI(n,e){const t=We(n),i=Bp(t);t.Ia.delete(e),i.O_()&&OF(t,e),t.Ia.size===0&&(i.O_()?i.L_():th(t)&&t.Va.set("Unknown"))}function MI(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(He.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Bp(n).Z_(e)}function OF(n,e){n.da.$e(e),Bp(n).X_(e)}function OI(n){n.da=new eK({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Bp(n).start(),n.Va.ua()}function LI(n){return th(n)&&!Bp(n).x_()&&n.Ia.size>0}function th(n){return We(n).Ea.size===0}function LF(n){n.da=void 0}async function lY(n){n.Va.set("Online")}async function uY(n){n.Ia.forEach((e,t)=>{MI(n,e)})}async function cY(n,e){LF(n),LI(n)?(n.Va.ha(e),OI(n)):n.Va.set("Unknown")}async function dY(n,e,t){if(n.Va.set("Online"),e instanceof wF&&e.state===2&&e.cause)try{await async function(r,s){const a=s.cause;for(const o of s.targetIds)r.Ia.has(o)&&(await r.remoteSyncer.rejectListen(o,a),r.Ia.delete(o),r.da.removeTarget(o))}(n,e)}catch(i){xe(Vd,"Failed to remove targets %s: %s ",e.targetIds.join(","),i),await Tb(n,i)}else if(e instanceof a0?n.da.Xe(e):e instanceof vF?n.da.st(e):n.da.tt(e),!t.isEqual(He.min()))try{const i=await PF(n.localStore);t.compareTo(i)>=0&&await function(s,a){const o=s.da.Tt(a);return o.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const c=s.Ia.get(u);c&&s.Ia.set(u,c.withResumeToken(l.resumeToken,a))}}),o.targetMismatches.forEach((l,u)=>{const c=s.Ia.get(l);if(!c)return;s.Ia.set(l,c.withResumeToken(ni.EMPTY_BYTE_STRING,c.snapshotVersion)),OF(s,l);const h=new tu(c.target,l,u,c.sequenceNumber);MI(s,h)}),s.remoteSyncer.applyRemoteEvent(o)}(n,t)}catch(i){xe(Vd,"Failed to raise snapshot:",i),await Tb(n,i)}}async function Tb(n,e,t){if(!Vp(e))throw e;n.Ea.add(1),await lv(n),n.Va.set("Offline"),t||(t=()=>PF(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{xe(Vd,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await U1(n)})}function FF(n,e){return e().catch(t=>Tb(n,t,e))}async function H1(n){const e=We(n),t=xu(e);let i=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:wI;for(;hY(e);)try{const r=await qK(e.localStore,i);if(r===null){e.Ta.length===0&&t.L_();break}i=r.batchId,fY(e,r)}catch(r){await Tb(e,r)}zF(e)&&VF(e)}function hY(n){return th(n)&&n.Ta.length<10}function fY(n,e){n.Ta.push(e);const t=xu(n);t.O_()&&t.Y_&&t.ea(e.mutations)}function zF(n){return th(n)&&!xu(n).x_()&&n.Ta.length>0}function VF(n){xu(n).start()}async function pY(n){xu(n).ra()}async function mY(n){const e=xu(n);for(const t of n.Ta)e.ea(t.mutations)}async function gY(n,e,t){const i=n.Ta.shift(),r=II.from(i,e,t);await FF(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),await H1(n)}async function yY(n,e){e&&xu(n).Y_&&await async function(i,r){if(function(a){return Q7(a)&&a!==ce.ABORTED}(r.code)){const s=i.Ta.shift();xu(i).B_(),await FF(i,()=>i.remoteSyncer.rejectFailedWrite(s.batchId,r)),await H1(i)}}(n,e),zF(n)&&VF(n)}async function VR(n,e){const t=We(n);t.asyncQueue.verifyOperationInProgress(),xe(Vd,"RemoteStore received new credentials");const i=th(t);t.Ea.add(3),await lv(t),i&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await U1(t)}async function _Y(n,e){const t=We(n);e?(t.Ea.delete(2),await U1(t)):e||(t.Ea.add(2),await lv(t),t.Va.set("Unknown"))}function Bp(n){return n.ma||(n.ma=function(t,i,r){const s=We(t);return s.sa(),new tY(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Zo:lY.bind(null,n),Yo:uY.bind(null,n),t_:cY.bind(null,n),J_:dY.bind(null,n)}),n.Ra.push(async e=>{e?(n.ma.B_(),LI(n)?OI(n):n.Va.set("Unknown")):(await n.ma.stop(),LF(n))})),n.ma}function xu(n){return n.fa||(n.fa=function(t,i,r){const s=We(t);return s.sa(),new nY(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),Yo:pY.bind(null,n),t_:yY.bind(null,n),ta:mY.bind(null,n),na:gY.bind(null,n)}),n.Ra.push(async e=>{e?(n.fa.B_(),await H1(n)):(await n.fa.stop(),n.Ta.length>0&&(xe(Vd,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FI{constructor(e,t,i,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new zo,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,r,s){const a=Date.now()+i,o=new FI(e,t,a,r,s);return o.start(i),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new we(ce.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function zI(n,e){if(Ko("AsyncQueue",`${e}: ${n}`),Vp(n))return new we(ce.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lf{static emptySet(e){return new lf(e.comparator)}constructor(e){this.comparator=e?(t,i)=>e(t,i)||De.comparator(t.key,i.key):(t,i)=>De.comparator(t.key,i.key),this.keyedMap=Jm(),this.sortedSet=new Jt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof lf)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const i=new lf;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jR{constructor(){this.ga=new Jt(De.comparator)}track(e){const t=e.doc.key,i=this.ga.get(t);i?e.type!==0&&i.type===3?this.ga=this.ga.insert(t,e):e.type===3&&i.type!==1?this.ga=this.ga.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.ga=this.ga.remove(t):e.type===1&&i.type===2?this.ga=this.ga.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Ve(63341,{Vt:e,pa:i}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,i)=>{e.push(i)}),e}}class kp{constructor(e,t,i,r,s,a,o,l,u){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=o,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,i,r,s){const a=[];return t.forEach(o=>{a.push({type:0,doc:o})}),new kp(e,t,lf.emptySet(t),a,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&L1(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==i[r].type||!t[r].doc.isEqual(i[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vY{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class wY{constructor(){this.queries=BR(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,i){const r=We(t),s=r.queries;r.queries=BR(),s.forEach((a,o)=>{for(const l of o.ba)l.onError(i)})})(this,new we(ce.ABORTED,"Firestore shutting down"))}}function BR(){return new eh(n=>sF(n),L1)}async function jF(n,e){const t=We(n);let i=3;const r=e.query;let s=t.queries.get(r);s?!s.Sa()&&e.Da()&&(i=2):(s=new vY,i=e.Da()?0:1);try{switch(i){case 0:s.wa=await t.onListen(r,!0);break;case 1:s.wa=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(a){const o=zI(a,`Initialization of query '${Ah(e.query)}' failed`);return void e.onError(o)}t.queries.set(r,s),s.ba.push(e),e.va(t.onlineState),s.wa&&e.Fa(s.wa)&&VI(t)}async function BF(n,e){const t=We(n),i=e.query;let r=3;const s=t.queries.get(i);if(s){const a=s.ba.indexOf(e);a>=0&&(s.ba.splice(a,1),s.ba.length===0?r=e.Da()?0:1:!s.Sa()&&e.Da()&&(r=2))}switch(r){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}}function bY(n,e){const t=We(n);let i=!1;for(const r of e){const s=r.query,a=t.queries.get(s);if(a){for(const o of a.ba)o.Fa(r)&&(i=!0);a.wa=r}}i&&VI(t)}function xY(n,e,t){const i=We(n),r=i.queries.get(e);if(r)for(const s of r.ba)s.onError(t);i.queries.delete(e)}function VI(n){n.Ca.forEach(e=>{e.next()})}var $T,UR;(UR=$T||($T={})).Ma="default",UR.Cache="cache";class UF{constructor(e,t,i){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=i||{}}Fa(e){if(!this.options.includeMetadataChanges){const i=[];for(const r of e.docChanges)r.type!==3&&i.push(r);e=new kp(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const i=t!=="Offline";return(!this.options.Ka||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=kp.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==$T.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HF{constructor(e){this.key=e}}class WF{constructor(e){this.key=e}}class EY{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=rt(),this.mutatedKeys=rt(),this.eu=aF(e),this.tu=new lf(this.eu)}get nu(){return this.Za}ru(e,t){const i=t?t.iu:new jR,r=t?t.tu:this.tu;let s=t?t.mutatedKeys:this.mutatedKeys,a=r,o=!1;const l=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,u=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((c,h)=>{const f=r.get(c),m=F1(this.query,h)?h:null,y=!!f&&this.mutatedKeys.has(f.key),_=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations);let x=!1;f&&m?f.data.isEqual(m.data)?y!==_&&(i.track({type:3,doc:m}),x=!0):this.su(f,m)||(i.track({type:2,doc:m}),x=!0,(l&&this.eu(m,l)>0||u&&this.eu(m,u)<0)&&(o=!0)):!f&&m?(i.track({type:0,doc:m}),x=!0):f&&!m&&(i.track({type:1,doc:f}),x=!0,(l||u)&&(o=!0)),x&&(m?(a=a.add(m),s=_?s.add(c):s.delete(c)):(a=a.delete(c),s=s.delete(c)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const c=this.query.limitType==="F"?a.last():a.first();a=a.delete(c.key),s=s.delete(c.key),i.track({type:1,doc:c})}return{tu:a,iu:i,Ss:o,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,r){const s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort((c,h)=>function(m,y){const _=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ve(20277,{Vt:x})}};return _(m)-_(y)}(c.type,h.type)||this.eu(c.doc,h.doc)),this.ou(i),r=r??!1;const o=t&&!r?this._u():[],l=this.Ya.size===0&&this.current&&!r?1:0,u=l!==this.Xa;return this.Xa=l,a.length!==0||u?{snapshot:new kp(this.query,e.tu,s,a,e.mutatedKeys,l===0,u,!1,!!i&&i.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new jR,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Za=this.Za.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Za=this.Za.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=rt(),this.tu.forEach(i=>{this.uu(i.key)&&(this.Ya=this.Ya.add(i.key))});const t=[];return e.forEach(i=>{this.Ya.has(i)||t.push(new WF(i))}),this.Ya.forEach(i=>{e.has(i)||t.push(new HF(i))}),t}cu(e){this.Za=e.ks,this.Ya=rt();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return kp.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const jI="SyncEngine";class AY{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class TY{constructor(e){this.key=e,this.hu=!1}}class SY{constructor(e,t,i,r,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new eh(o=>sF(o),L1),this.Iu=new Map,this.Eu=new Set,this.Ru=new Jt(De.comparator),this.Au=new Map,this.Vu=new $I,this.du={},this.mu=new Map,this.fu=Cp.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function IY(n,e,t=!0){const i=QF(n);let r;const s=i.Tu.get(e);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.lu()):r=await qF(i,e,t,!0),r}async function CY(n,e){const t=QF(n);await qF(t,e,!0,!1)}async function qF(n,e,t,i){const r=await GK(n.localStore,Da(e)),s=r.targetId,a=n.sharedClientState.addLocalQueryTarget(s,t);let o;return i&&(o=await kY(n,e,s,a==="current",r.resumeToken)),n.isPrimaryClient&&t&&MF(n.remoteStore,r),o}async function kY(n,e,t,i,r){n.pu=(h,f,m)=>async function(_,x,v,w){let E=x.view.ru(v);E.Ss&&(E=await MR(_.localStore,x.query,!1).then(({documents:I})=>x.view.ru(I,E)));const C=w&&w.targetChanges.get(x.targetId),D=w&&w.targetMismatches.get(x.targetId)!=null,V=x.view.applyChanges(E,_.isPrimaryClient,C,D);return WR(_,x.targetId,V.au),V.snapshot}(n,h,f,m);const s=await MR(n.localStore,e,!0),a=new EY(e,s.ks),o=a.ru(s.documents),l=ov.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",r),u=a.applyChanges(o,n.isPrimaryClient,l);WR(n,t,u.au);const c=new AY(e,t,a);return n.Tu.set(e,c),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),u.snapshot}async function $Y(n,e,t){const i=We(n),r=i.Tu.get(e),s=i.Iu.get(r.targetId);if(s.length>1)return i.Iu.set(r.targetId,s.filter(a=>!L1(a,e))),void i.Tu.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(r.targetId),i.sharedClientState.isActiveQueryTarget(r.targetId)||await CT(i.localStore,r.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(r.targetId),t&&DI(i.remoteStore,r.targetId),RT(i,r.targetId)}).catch(zp)):(RT(i,r.targetId),await CT(i.localStore,r.targetId,!0))}async function RY(n,e){const t=We(n),i=t.Tu.get(e),r=t.Iu.get(i.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),DI(t.remoteStore,i.targetId))}async function PY(n,e,t){const i=zY(n);try{const r=await function(a,o){const l=We(a),u=Ft.now(),c=o.reduce((m,y)=>m.add(y.key),rt());let h,f;return l.persistence.runTransaction("Locally write mutations","readwrite",m=>{let y=Yo(),_=rt();return l.xs.getEntries(m,c).next(x=>{y=x,y.forEach((v,w)=>{w.isValidDocument()||(_=_.add(v))})}).next(()=>l.localDocuments.getOverlayedDocuments(m,y)).next(x=>{h=x;const v=[];for(const w of o){const E=q7(w,h.get(w.key).overlayedDocument);E!=null&&v.push(new Du(w.key,E,Q4(E.value.mapValue),Vs.exists(!0)))}return l.mutationQueue.addMutationBatch(m,u,v,o)}).next(x=>{f=x;const v=x.applyToLocalDocumentSet(h,_);return l.documentOverlayCache.saveOverlays(m,x.batchId,v)})}).then(()=>({batchId:f.batchId,changes:lF(h)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(r.batchId),function(a,o,l){let u=a.du[a.currentUser.toKey()];u||(u=new Jt(it)),u=u.insert(o,l),a.du[a.currentUser.toKey()]=u}(i,r.batchId,t),await uv(i,r.changes),await H1(i.remoteStore)}catch(r){const s=zI(r,"Failed to persist write");t.reject(s)}}async function GF(n,e){const t=We(n);try{const i=await HK(t.localStore,e);e.targetChanges.forEach((r,s)=>{const a=t.Au.get(s);a&&(wt(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?a.hu=!0:r.modifiedDocuments.size>0?wt(a.hu,14607):r.removedDocuments.size>0&&(wt(a.hu,42227),a.hu=!1))}),await uv(t,i,e)}catch(i){await zp(i)}}function HR(n,e,t){const i=We(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const r=[];i.Tu.forEach((s,a)=>{const o=a.view.va(e);o.snapshot&&r.push(o.snapshot)}),function(a,o){const l=We(a);l.onlineState=o;let u=!1;l.queries.forEach((c,h)=>{for(const f of h.ba)f.va(o)&&(u=!0)}),u&&VI(l)}(i.eventManager,e),r.length&&i.Pu.J_(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function NY(n,e,t){const i=We(n);i.sharedClientState.updateQueryState(e,"rejected",t);const r=i.Au.get(e),s=r&&r.key;if(s){let a=new Jt(De.comparator);a=a.insert(s,vi.newNoDocument(s,He.min()));const o=rt().add(s),l=new j1(He.min(),new Map,new Jt(it),a,o);await GF(i,l),i.Ru=i.Ru.remove(s),i.Au.delete(e),BI(i)}else await CT(i.localStore,e,!1).then(()=>RT(i,e,t)).catch(zp)}async function DY(n,e){const t=We(n),i=e.batch.batchId;try{const r=await UK(t.localStore,e);YF(t,i,null),KF(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await uv(t,r)}catch(r){await zp(r)}}async function MY(n,e,t){const i=We(n);try{const r=await function(a,o){const l=We(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let c;return l.mutationQueue.lookupMutationBatch(u,o).next(h=>(wt(h!==null,37113),c=h.keys(),l.mutationQueue.removeMutationBatch(u,h))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,c,o)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,c)).next(()=>l.localDocuments.getDocuments(u,c))})}(i.localStore,e);YF(i,e,t),KF(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await uv(i,r)}catch(r){await zp(r)}}function KF(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function YF(n,e,t){const i=We(n);let r=i.du[i.currentUser.toKey()];if(r){const s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),i.du[i.currentUser.toKey()]=r}}function RT(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.Iu.get(e))n.Tu.delete(i),t&&n.Pu.yu(i,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach(i=>{n.Vu.containsKey(i)||XF(n,i)})}function XF(n,e){n.Eu.delete(e.path.canonicalString());const t=n.Ru.get(e);t!==null&&(DI(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),BI(n))}function WR(n,e,t){for(const i of t)i instanceof HF?(n.Vu.addReference(i.key,e),OY(n,i)):i instanceof WF?(xe(jI,"Document no longer in limbo: "+i.key),n.Vu.removeReference(i.key,e),n.Vu.containsKey(i.key)||XF(n,i.key)):Ve(19791,{wu:i})}function OY(n,e){const t=e.key,i=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(i)||(xe(jI,"New document in limbo: "+t),n.Eu.add(i),BI(n))}function BI(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new De(Dt.fromString(e)),i=n.fu.next();n.Au.set(i,new TY(t)),n.Ru=n.Ru.insert(t,i),MF(n.remoteStore,new tu(Da(TI(t.path)),i,"TargetPurposeLimboResolution",D1.ce))}}async function uv(n,e,t){const i=We(n),r=[],s=[],a=[];i.Tu.isEmpty()||(i.Tu.forEach((o,l)=>{a.push(i.pu(l,e,t).then(u=>{var c;if((u||t)&&i.isPrimaryClient){const h=u?!u.fromCache:(c=t==null?void 0:t.targetChanges.get(l.targetId))==null?void 0:c.current;i.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(u){r.push(u);const h=PI.Es(l.targetId,u);s.push(h)}}))}),await Promise.all(a),i.Pu.J_(r),await async function(l,u){const c=We(l);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>he.forEach(u,f=>he.forEach(f.Ts,m=>c.persistence.referenceDelegate.addReference(h,f.targetId,m)).next(()=>he.forEach(f.Is,m=>c.persistence.referenceDelegate.removeReference(h,f.targetId,m)))))}catch(h){if(!Vp(h))throw h;xe(NI,"Failed to update sequence numbers: "+h)}for(const h of u){const f=h.targetId;if(!h.fromCache){const m=c.vs.get(f),y=m.snapshotVersion,_=m.withLastLimboFreeSnapshotVersion(y);c.vs=c.vs.insert(f,_)}}}(i.localStore,s))}async function LY(n,e){const t=We(n);if(!t.currentUser.isEqual(e)){xe(jI,"User change. New user:",e.toKey());const i=await RF(t.localStore,e);t.currentUser=e,function(s,a){s.mu.forEach(o=>{o.forEach(l=>{l.reject(new we(ce.CANCELLED,a))})}),s.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await uv(t,i.Ns)}}function FY(n,e){const t=We(n),i=t.Au.get(e);if(i&&i.hu)return rt().add(i.key);{let r=rt();const s=t.Iu.get(e);if(!s)return r;for(const a of s){const o=t.Tu.get(a);r=r.unionWith(o.view.nu)}return r}}function QF(n){const e=We(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=GF.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=FY.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=NY.bind(null,e),e.Pu.J_=bY.bind(null,e.eventManager),e.Pu.yu=xY.bind(null,e.eventManager),e}function zY(n){const e=We(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=DY.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=MY.bind(null,e),e}class Sb{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=B1(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return BK(this.persistence,new zK,e.initialUser,this.serializer)}Cu(e){return new $F(RI.Vi,this.serializer)}Du(e){return new YK}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Sb.provider={build:()=>new Sb};class VY extends Sb{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){wt(this.persistence.referenceDelegate instanceof Ab,46915);const i=this.persistence.referenceDelegate.garbageCollector;return new AK(i,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Qi.withCacheSize(this.cacheSizeBytes):Qi.DEFAULT;return new $F(i=>Ab.Vi(i,t),this.serializer)}}class PT{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>HR(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=LY.bind(null,this.syncEngine),await _Y(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new wY}()}createDatastore(e){const t=B1(e.databaseInfo.databaseId),i=eY(e.databaseInfo);return sY(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return function(i,r,s,a,o){return new oY(i,r,s,a,o)}(this.localStore,this.datastore,e.asyncQueue,t=>HR(this.syncEngine,t,0),function(){return FR.v()?new FR:new XK}())}createSyncEngine(e,t){return function(r,s,a,o,l,u,c){const h=new SY(r,s,a,o,l,u);return c&&(h.gu=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(r){const s=We(r);xe(Vd,"RemoteStore shutting down."),s.Ea.add(5),await lv(s),s.Aa.shutdown(),s.Va.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}PT.provider={build:()=>new PT};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JF{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ko("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eu="FirestoreClient";class jY{constructor(e,t,i,r,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this._databaseInfo=r,this.user=gi.UNAUTHENTICATED,this.clientId=vI.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(i,async a=>{xe(Eu,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(i,a=>(xe(Eu,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new zo;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=zI(t,"Failed to shutdown persistence");e.reject(i)}}),e.promise}}async function sE(n,e){n.asyncQueue.verifyOperationInProgress(),xe(Eu,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(async r=>{i.isEqual(r)||(await RF(e.localStore,r),i=r)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function qR(n,e){n.asyncQueue.verifyOperationInProgress();const t=await BY(n);xe(Eu,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(i=>VR(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,r)=>VR(e.remoteStore,r)),n._onlineComponents=e}async function BY(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){xe(Eu,"Using user provided OfflineComponentProvider");try{await sE(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(r){return r.name==="FirebaseError"?r.code===ce.FAILED_PRECONDITION||r.code===ce.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(t))throw t;Ap("Error using user provided cache. Falling back to memory cache: "+t),await sE(n,new Sb)}}else xe(Eu,"Using default OfflineComponentProvider"),await sE(n,new VY(void 0));return n._offlineComponents}async function ZF(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(xe(Eu,"Using user provided OnlineComponentProvider"),await qR(n,n._uninitializedComponentsProvider._online)):(xe(Eu,"Using default OnlineComponentProvider"),await qR(n,new PT))),n._onlineComponents}function UY(n){return ZF(n).then(e=>e.syncEngine)}async function ez(n){const e=await ZF(n),t=e.eventManager;return t.onListen=IY.bind(null,e.syncEngine),t.onUnlisten=$Y.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=CY.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=RY.bind(null,e.syncEngine),t}function HY(n,e,t={}){const i=new zo;return n.asyncQueue.enqueueAndForget(async()=>function(s,a,o,l,u){const c=new JF({next:f=>{c.Nu(),a.enqueueAndForget(()=>BF(s,h));const m=f.docs.has(o);!m&&f.fromCache?u.reject(new we(ce.UNAVAILABLE,"Failed to get document because the client is offline.")):m&&f.fromCache&&l&&l.source==="server"?u.reject(new we(ce.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(f)},error:f=>u.reject(f)}),h=new UF(TI(o.path),c,{includeMetadataChanges:!0,Ka:!0});return jF(s,h)}(await ez(n),n.asyncQueue,e,t,i)),i.promise}function WY(n,e,t={}){const i=new zo;return n.asyncQueue.enqueueAndForget(async()=>function(s,a,o,l,u){const c=new JF({next:f=>{c.Nu(),a.enqueueAndForget(()=>BF(s,h)),f.fromCache&&l.source==="server"?u.reject(new we(ce.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(f)},error:f=>u.reject(f)}),h=new UF(o,c,{includeMetadataChanges:!0,Ka:!0});return jF(s,h)}(await ez(n),n.asyncQueue,e,t,i)),i.promise}function qY(n,e){const t=new zo;return n.asyncQueue.enqueueAndForget(async()=>PY(await UY(n),e,t)),t.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tz(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GY="ComponentProvider",GR=new Map;function KY(n,e,t,i,r){return new f7(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,tz(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator,i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nz="firestore.googleapis.com",KR=!0;class YR{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new we(ce.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=nz,this.ssl=KR}else this.host=e.host,this.ssl=e.ssl??KR;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=kF;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<xK)throw new we(ce.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}n7("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=tz(e.experimentalLongPollingOptions??{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new we(ce.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new we(ce.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new we(ce.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(i,r){return i.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class W1{constructor(e,t,i,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new YR({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new we(ce.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new we(ce.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new YR(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new qG;switch(i.type){case"firstParty":return new XG(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new we(ce.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const i=GR.get(t);i&&(xe(GY,"Removing Datastore"),GR.delete(t),i.terminate())}(this),Promise.resolve()}}function YY(n,e,t,i={}){var u;n=La(n,W1);const r=Qd(e),s=n._getSettings(),a={...s,emulatorOptions:n._getEmulatorOptions()},o=`${e}:${t}`;r&&(sI(`https://${o}`),aI("Firestore",!0)),s.host!==nz&&s.host!==o&&Ap("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...s,host:o,ssl:r,emulatorOptions:i};if(!Md(l,a)&&(n._setSettings(l),i.mockUserToken)){let c,h;if(typeof i.mockUserToken=="string")c=i.mockUserToken,h=gi.MOCK_USER;else{c=qL(i.mockUserToken,(u=n._app)==null?void 0:u.options.projectId);const f=i.mockUserToken.sub||i.mockUserToken.user_id;if(!f)throw new we(ce.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new gi(f)}n._authCredentials=new GG(new z4(c,h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nh{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new nh(this.firestore,e,this._query)}}class un{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new fu(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new un(this.firestore,e,this._key)}toJSON(){return{type:un._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,i){if(sv(t,un._jsonSchema))return new un(e,i||null,new De(Dt.fromString(t.referencePath)))}}un._jsonSchemaVersion="firestore/documentReference/1.0",un._jsonSchema={type:_n("string",un._jsonSchemaVersion),referencePath:_n("string")};class fu extends nh{constructor(e,t,i){super(e,t,TI(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new un(this.firestore,null,new De(e))}withConverter(e){return new fu(this.firestore,e,this._path)}}function bh(n,e,...t){if(n=Rn(n),V4("collection","path",e),n instanceof W1){const i=Dt.fromString(e,...t);return lR(i),new fu(n,null,i)}{if(!(n instanceof un||n instanceof fu))throw new we(ce.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(Dt.fromString(e,...t));return lR(i),new fu(n.firestore,null,i)}}function eg(n,e,...t){if(n=Rn(n),arguments.length===1&&(e=vI.newId()),V4("doc","path",e),n instanceof W1){const i=Dt.fromString(e,...t);return oR(i),new un(n,null,new De(i))}{if(!(n instanceof un||n instanceof fu))throw new we(ce.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(Dt.fromString(e,...t));return oR(i),new un(n.firestore,n instanceof fu?n.converter:null,new De(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XR="AsyncQueue";class QR{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new NF(this,"async_queue_retry"),this._c=()=>{const i=rE();i&&xe(XR,"Visibility state changed to "+i.visibilityState),this.M_.w_()},this.ac=e;const t=rE();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=rE();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new zo;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!Vp(e))throw e;xe(XR,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(i=>{throw this.nc=i,this.rc=!1,Ko("INTERNAL UNHANDLED ERROR: ",JR(i)),i}).then(i=>(this.rc=!1,i))));return this.ac=t,t}enqueueAfterDelay(e,t,i){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=FI.createAndSchedule(this,e,t,i,s=>this.hc(s));return this.tc.push(r),r}uc(){this.nc&&Ve(47125,{Pc:JR(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function JR(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class Up extends W1{constructor(e,t,i,r){super(e,t,i,r),this.type="firestore",this._queue=new QR,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new QR(e),this._firestoreClient=void 0,await e}}}function XY(n,e){const t=typeof n=="object"?n:uI(),i=typeof n=="string"?n:vb,r=k1(t,"firestore").getImmediate({identifier:i});if(!r._initialized){const s=UL("firestore");s&&YY(r,...s)}return r}function UI(n){if(n._terminated)throw new we(ce.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||QY(n),n._firestoreClient}function QY(n){var i,r,s,a;const e=n._freezeSettings(),t=KY(n._databaseId,((i=n._app)==null?void 0:i.options.appId)||"",n._persistenceKey,(r=n._app)==null?void 0:r.options.apiKey,e);n._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((a=e.localCache)!=null&&a._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new jY(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(l){const u=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(u),_online:u}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Gr(ni.fromBase64String(e))}catch(t){throw new we(ce.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Gr(ni.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Gr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(sv(e,Gr._jsonSchema))return Gr.fromBase64String(e.bytes)}}Gr._jsonSchemaVersion="firestore/bytes/1.0",Gr._jsonSchema={type:_n("string",Gr._jsonSchemaVersion),bytes:_n("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HI{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new we(ce.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Zn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q1{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oa{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new we(ce.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new we(ce.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return it(this._lat,e._lat)||it(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Oa._jsonSchemaVersion}}static fromJSON(e){if(sv(e,Oa._jsonSchema))return new Oa(e.latitude,e.longitude)}}Oa._jsonSchemaVersion="firestore/geoPoint/1.0",Oa._jsonSchema={type:_n("string",Oa._jsonSchemaVersion),latitude:_n("number"),longitude:_n("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class js{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(i,r){if(i.length!==r.length)return!1;for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:js._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(sv(e,js._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new js(e.vectorValues);throw new we(ce.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}js._jsonSchemaVersion="firestore/vectorValue/1.0",js._jsonSchema={type:_n("string",js._jsonSchemaVersion),vectorValues:_n("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JY=/^__.*__$/;class ZY{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new Du(e,this.data,this.fieldMask,t,this.fieldTransforms):new av(e,this.data,t,this.fieldTransforms)}}class iz{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new Du(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function rz(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ve(40011,{dataSource:n})}}class WI{constructor(e,t,i,r,s,a){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=r,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new WI({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var r;const t=(r=this.path)==null?void 0:r.child(e),i=this.contextWith({path:t,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var r;const t=(r=this.path)==null?void 0:r.child(e),i=this.contextWith({path:t,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return Ib(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(rz(this.dataSource)&&JY.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class eX{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||B1(e)}createContext(e,t,i,r=!1){return new WI({dataSource:e,methodName:t,targetDoc:i,path:Zn.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function G1(n){const e=n._freezeSettings(),t=B1(n._databaseId);return new eX(n._databaseId,!!e.ignoreUndefinedProperties,t)}function sz(n,e,t,i,r,s={}){const a=n.createContext(s.merge||s.mergeFields?2:0,e,t,r);GI("Data must be an object, but it was:",a,i);const o=az(i,a);let l,u;if(s.merge)l=new Ir(a.fieldMask),u=a.fieldTransforms;else if(s.mergeFields){const c=[];for(const h of s.mergeFields){const f=$p(e,h,t);if(!a.contains(f))throw new we(ce.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);uz(c,f)||c.push(f)}l=new Ir(c),u=a.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,u=a.fieldTransforms;return new ZY(new Zi(o),l,u)}class K1 extends q1{_toFieldTransform(e){if(e.dataSource!==2)throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof K1}}class qI extends q1{_toFieldTransform(e){return new B7(e.path,new my)}isEqual(e){return e instanceof qI}}function tX(n,e,t,i){const r=n.createContext(1,e,t);GI("Data must be an object, but it was:",r,i);const s=[],a=Zi.empty();Nu(i,(l,u)=>{const c=lz(e,l,t);u=Rn(u);const h=r.childContextForFieldPath(c);if(u instanceof K1)s.push(c);else{const f=cv(u,h);f!=null&&(s.push(c),a.set(c,f))}});const o=new Ir(s);return new iz(a,o,r.fieldTransforms)}function nX(n,e,t,i,r,s){const a=n.createContext(1,e,t),o=[$p(e,i,t)],l=[r];if(s.length%2!=0)throw new we(ce.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<s.length;f+=2)o.push($p(e,s[f])),l.push(s[f+1]);const u=[],c=Zi.empty();for(let f=o.length-1;f>=0;--f)if(!uz(u,o[f])){const m=o[f];let y=l[f];y=Rn(y);const _=a.childContextForFieldPath(m);if(y instanceof K1)u.push(m);else{const x=cv(y,_);x!=null&&(u.push(m),c.set(m,x))}}const h=new Ir(u);return new iz(c,h,a.fieldTransforms)}function iX(n,e,t,i=!1){return cv(t,n.createContext(i?4:3,e))}function cv(n,e){if(oz(n=Rn(n)))return GI("Unsupported field value:",e,n),az(n,e);if(n instanceof q1)return function(i,r){if(!rz(r.dataSource))throw r.createError(`${i._methodName}() can only be used with update() and set()`);if(!r.path)throw r.createError(`${i._methodName}() is not currently supported inside arrays`);const s=i._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return function(i,r){const s=[];let a=0;for(const o of i){let l=cv(o,r.childContextForArray(a));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}}(n,e)}return function(i,r){if((i=Rn(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return z7(r.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const s=Ft.fromDate(i);return{timestampValue:Eb(r.serializer,s)}}if(i instanceof Ft){const s=new Ft(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:Eb(r.serializer,s)}}if(i instanceof Oa)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof Gr)return{bytesValue:bF(r.serializer,i._byteString)};if(i instanceof un){const s=r.databaseId,a=i.firestore._databaseId;if(!a.isEqual(s))throw r.createError(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:kI(i.firestore._databaseId||r.databaseId,i._key.path)}}if(i instanceof js)return function(a,o){const l=a instanceof js?a.toArray():a;return{mapValue:{fields:{[Y4]:{stringValue:X4},[wb]:{arrayValue:{values:l.map(c=>{if(typeof c!="number")throw o.createError("VectorValues must only contain numeric values.");return SI(o.serializer,c)})}}}}}}(i,r);if(CF(i))return i._toProto(r.serializer);throw r.createError(`Unsupported field value: ${N1(i)}`)}(n,e)}function az(n,e){const t={};return U4(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Nu(n,(i,r)=>{const s=cv(r,e.childContextForField(i));s!=null&&(t[i]=s)}),{mapValue:{fields:t}}}function oz(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Ft||n instanceof Oa||n instanceof Gr||n instanceof un||n instanceof q1||n instanceof js||CF(n))}function GI(n,e,t){if(!oz(t)||!j4(t)){const i=N1(t);throw i==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+i)}}function $p(n,e,t){if((e=Rn(e))instanceof HI)return e._internalPath;if(typeof e=="string")return lz(n,e);throw Ib("Field path arguments must be of type string or ",n,!1,void 0,t)}const rX=new RegExp("[~\\*/\\[\\]]");function lz(n,e,t){if(e.search(rX)>=0)throw Ib(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new HI(...e.split("."))._internalPath}catch{throw Ib(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ib(n,e,t,i,r){const s=i&&!i.isEmpty(),a=r!==void 0;let o=`Function ${e}() called with invalid data`;t&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${i}`),a&&(l+=` in document ${r}`),l+=")"),new we(ce.INVALID_ARGUMENT,o+n+l)}function uz(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sX{convertValue(e,t="none"){switch(bu(e)){case 0:return null;case 1:return e.booleanValue;case 2:return on(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(wu(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ve(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const i={};return Nu(e,(r,s)=>{i[r]=this.convertValue(s,t)}),i}convertVectorValue(e){var i,r,s;const t=(s=(r=(i=e.fields)==null?void 0:i[wb].arrayValue)==null?void 0:r.values)==null?void 0:s.map(a=>on(a.doubleValue));return new js(t)}convertGeoPoint(e){return new Oa(on(e.latitude),on(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":const i=O1(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(dy(e));default:return null}}convertTimestamp(e){const t=vu(e);return new Ft(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=Dt.fromString(e);wt(IF(i),9688,{name:e});const r=new hy(i.get(1),i.get(3)),s=new De(i.popFirst(5));return r.isEqual(t)||Ko(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cz extends sX{constructor(e){super(),this.firestore=e}convertBytes(e){return new Gr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new un(this.firestore,null,t)}}function km(){return new qI("serverTimestamp")}const ZR="@firebase/firestore",eP="4.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dz{constructor(e,t,i,r,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new un(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new aX(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){var e;return((e=this._document)==null?void 0:e.data.clone().value.mapValue.fields)??void 0}get(e){if(this._document){const t=this._document.data.field($p("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class aX extends dz{data(){return super.data()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oX(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new we(ce.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class KI{}class hz extends KI{}function tP(n,e,...t){let i=[];e instanceof KI&&i.push(e),i=i.concat(t),function(s){const a=s.filter(l=>l instanceof XI).length,o=s.filter(l=>l instanceof YI).length;if(a>1||a>0&&o>0)throw new we(ce.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(const r of i)n=r._apply(n);return n}class YI extends hz{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new YI(e,t,i)}_apply(e){const t=this._parse(e);return fz(e._query,t),new nh(e.firestore,e.converter,xT(e._query,t))}_parse(e){const t=G1(e.firestore);return function(s,a,o,l,u,c,h){let f;if(u.isKeyField()){if(c==="array-contains"||c==="array-contains-any")throw new we(ce.INVALID_ARGUMENT,`Invalid Query. You can't perform '${c}' queries on documentId().`);if(c==="in"||c==="not-in"){rP(h,c);const y=[];for(const _ of h)y.push(iP(l,s,_));f={arrayValue:{values:y}}}else f=iP(l,s,h)}else c!=="in"&&c!=="not-in"&&c!=="array-contains-any"||rP(h,c),f=iX(o,a,h,c==="in"||c==="not-in");return gn.create(u,c,f)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class XI extends KI{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new XI(e,t)}_parse(e){const t=this._queryConstraints.map(i=>i._parse(e)).filter(i=>i.getFilters().length>0);return t.length===1?t[0]:Ws.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(r,s){let a=r;const o=s.getFlattenedFilters();for(const l of o)fz(a,l),a=xT(a,l)}(e._query,t),new nh(e.firestore,e.converter,xT(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class QI extends hz{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new QI(e,t)}_apply(e){const t=function(r,s,a){if(r.startAt!==null)throw new we(ce.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new we(ce.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new py(s,a)}(e._query,this._field,this._direction);return new nh(e.firestore,e.converter,R7(e._query,t))}}function nP(n,e="asc"){const t=e,i=$p("orderBy",n);return QI._create(i,t)}function iP(n,e,t){if(typeof(t=Rn(t))=="string"){if(t==="")throw new we(ce.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!rF(e)&&t.indexOf("/")!==-1)throw new we(ce.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const i=e.path.child(Dt.fromString(t));if(!De.isDocumentKey(i))throw new we(ce.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return gR(n,new De(i))}if(t instanceof un)return gR(n,t._key);throw new we(ce.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${N1(t)}.`)}function rP(n,e){if(!Array.isArray(n)||n.length===0)throw new we(ce.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function fz(n,e){const t=function(r,s){for(const a of r)for(const o of a.getFlattenedFilters())if(s.indexOf(o.op)>=0)return o.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new we(ce.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new we(ce.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function pz(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}class tg{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Id extends dz{constructor(e,t,i,r,s,a){super(e,t,i,r,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new o0(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field($p("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new we(ce.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Id._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Id._jsonSchemaVersion="firestore/documentSnapshot/1.0",Id._jsonSchema={type:_n("string",Id._jsonSchemaVersion),bundleSource:_n("string","DocumentSnapshot"),bundleName:_n("string"),bundle:_n("string")};class o0 extends Id{data(e={}){return super.data(e)}}class uf{constructor(e,t,i,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new tg(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new o0(this._firestore,this._userDataWriter,i.key,i,new tg(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new we(ce.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let a=0;return r._snapshot.docChanges.map(o=>{const l=new o0(r._firestore,r._userDataWriter,o.doc.key,o.doc,new tg(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);return o.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(o=>s||o.type!==3).map(o=>{const l=new o0(r._firestore,r._userDataWriter,o.doc.key,o.doc,new tg(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);let u=-1,c=-1;return o.type!==0&&(u=a.indexOf(o.doc.key),a=a.delete(o.doc.key)),o.type!==1&&(a=a.add(o.doc),c=a.indexOf(o.doc.key)),{type:lX(o.type),doc:l,oldIndex:u,newIndex:c}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new we(ce.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=uf._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=vI.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],i=[],r=[];return this.docs.forEach(s=>{s._document!==null&&(t.push(s._document),i.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),r.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function lX(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ve(61501,{type:n})}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */uf._jsonSchemaVersion="firestore/querySnapshot/1.0",uf._jsonSchema={type:_n("string",uf._jsonSchemaVersion),bundleSource:_n("string","QuerySnapshot"),bundleName:_n("string"),bundle:_n("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uX(n){n=La(n,un);const e=La(n.firestore,Up),t=UI(e);return HY(t,n._key).then(i=>dX(e,n,i))}function _w(n){n=La(n,nh);const e=La(n.firestore,Up),t=UI(e),i=new cz(e);return oX(n._query),WY(t,n._query).then(r=>new uf(e,i,n,r))}function sP(n,e,t){n=La(n,un);const i=La(n.firestore,Up),r=pz(n.converter,e,t),s=G1(i);return JI(i,[sz(s,"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,Vs.none())])}function cX(n,e,t,...i){n=La(n,un);const r=La(n.firestore,Up),s=G1(r);let a;return a=typeof(e=Rn(e))=="string"||e instanceof HI?nX(s,"updateDoc",n._key,e,t,i):tX(s,"updateDoc",n._key,e),JI(r,[a.toMutation(n._key,Vs.exists(!0))])}function aP(n,e){const t=La(n.firestore,Up),i=eg(n),r=pz(n.converter,e),s=G1(n.firestore);return JI(t,[sz(s,"addDoc",i._key,r,n.converter!==null,{}).toMutation(i._key,Vs.exists(!1))]).then(()=>i)}function JI(n,e){const t=UI(n);return qY(t,e)}function dX(n,e,t){const i=t.docs.get(e._key),r=new cz(n);return new Id(n,r,e._key,i,new tg(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){WG(Jd),Od(new yu("firestore",(i,{instanceIdentifier:r,options:s})=>{const a=i.getProvider("app").getImmediate(),o=new Up(new KG(i.getProvider("auth-internal")),new QG(a,i.getProvider("app-check-internal")),p7(a,r),a);return s={useFetchStreams:t,...s},o._setSettings(s),o},"PUBLIC").setMultipleInstances(!0)),Ra(ZR,eP,e),Ra(ZR,eP,"esm2020")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mz="firebasestorage.googleapis.com",hX="storageBucket",fX=2*60*1e3,pX=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ua extends Ba{constructor(e,t,i=0){super(aE(e),`Firebase Storage: ${t} (${aE(e)})`),this.status_=i,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Ua.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return aE(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var za;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(za||(za={}));function aE(n){return"storage/"+n}function mX(){const n="An unknown error occurred, please check the error payload for server response.";return new Ua(za.UNKNOWN,n)}function gX(){return new Ua(za.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function yX(){return new Ua(za.CANCELED,"User canceled the upload/download.")}function _X(n){return new Ua(za.INVALID_URL,"Invalid URL '"+n+"'.")}function vX(n){return new Ua(za.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function oP(n){return new Ua(za.INVALID_ARGUMENT,n)}function gz(){return new Ua(za.APP_DELETED,"The Firebase app was deleted.")}function wX(n){return new Ua(za.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Os{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let i;try{i=Os.makeFromUrl(e,t)}catch{return new Os(e,"")}if(i.path==="")return i;throw vX(e)}static makeFromUrl(e,t){let i=null;const r="([A-Za-z0-9.\\-_]+)";function s(C){C.path.charAt(C.path.length-1)==="/"&&(C.path_=C.path_.slice(0,-1))}const a="(/(.*))?$",o=new RegExp("^gs://"+r+a,"i"),l={bucket:1,path:3};function u(C){C.path_=decodeURIComponent(C.path)}const c="v[A-Za-z0-9_]+",h=t.replace(/[.]/g,"\\."),f="(/([^?#]*).*)?$",m=new RegExp(`^https?://${h}/${c}/b/${r}/o${f}`,"i"),y={bucket:1,path:3},_=t===mz?"(?:storage.googleapis.com|storage.cloud.google.com)":t,x="([^?#]*)",v=new RegExp(`^https?://${_}/${r}/${x}`,"i"),E=[{regex:o,indices:l,postModify:s},{regex:m,indices:y,postModify:u},{regex:v,indices:{bucket:1,path:2},postModify:u}];for(let C=0;C<E.length;C++){const D=E[C],V=D.regex.exec(e);if(V){const I=V[D.indices.bucket];let k=V[D.indices.path];k||(k=""),i=new Os(I,k),D.postModify(i);break}}if(i==null)throw _X(e);return i}}class bX{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xX(n,e,t){let i=1,r=null,s=null,a=!1,o=0;function l(){return o===2}let u=!1;function c(...x){u||(u=!0,e.apply(null,x))}function h(x){r=setTimeout(()=>{r=null,n(m,l())},x)}function f(){s&&clearTimeout(s)}function m(x,...v){if(u){f();return}if(x){f(),c.call(null,x,...v);return}if(l()||a){f(),c.call(null,x,...v);return}i<64&&(i*=2);let E;o===1?(o=2,E=0):E=(i+Math.random())*1e3,h(E)}let y=!1;function _(x){y||(y=!0,f(),!u&&(r!==null?(x||(o=2),clearTimeout(r),h(0)):x||(o=1)))}return h(0),s=setTimeout(()=>{a=!0,_(!0)},t),_}function EX(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AX(n){return n!==void 0}function lP(n,e,t,i){if(i<e)throw oP(`Invalid value for '${n}'. Expected ${e} or greater.`);if(i>t)throw oP(`Invalid value for '${n}'. Expected ${t} or less.`)}function TX(n){const e=encodeURIComponent;let t="?";for(const i in n)if(n.hasOwnProperty(i)){const r=e(i)+"="+e(n[i]);t=t+r+"&"}return t=t.slice(0,-1),t}var Cb;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Cb||(Cb={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SX(n,e){const t=n>=500&&n<600,r=[408,429].indexOf(n)!==-1,s=e.indexOf(n)!==-1;return t||r||s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IX{constructor(e,t,i,r,s,a,o,l,u,c,h,f=!0,m=!1){this.url_=e,this.method_=t,this.headers_=i,this.body_=r,this.successCodes_=s,this.additionalRetryCodes_=a,this.callback_=o,this.errorCallback_=l,this.timeout_=u,this.progressCallback_=c,this.connectionFactory_=h,this.retry=f,this.isUsingEmulator=m,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((y,_)=>{this.resolve_=y,this.reject_=_,this.start_()})}start_(){const e=(i,r)=>{if(r){i(!1,new vw(!1,null,!0));return}const s=this.connectionFactory_();this.pendingConnection_=s;const a=o=>{const l=o.loaded,u=o.lengthComputable?o.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,u)};this.progressCallback_!==null&&s.addUploadProgressListener(a),s.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(a),this.pendingConnection_=null;const o=s.getErrorCode()===Cb.NO_ERROR,l=s.getStatus();if(!o||SX(l,this.additionalRetryCodes_)&&this.retry){const c=s.getErrorCode()===Cb.ABORT;i(!1,new vw(!1,null,c));return}const u=this.successCodes_.indexOf(l)!==-1;i(!0,new vw(u,s))})},t=(i,r)=>{const s=this.resolve_,a=this.reject_,o=r.connection;if(r.wasSuccessCode)try{const l=this.callback_(o,o.getResponse());AX(l)?s(l):s()}catch(l){a(l)}else if(o!==null){const l=mX();l.serverResponse=o.getErrorText(),this.errorCallback_?a(this.errorCallback_(o,l)):a(l)}else if(r.canceled){const l=this.appDelete_?gz():yX();a(l)}else{const l=gX();a(l)}};this.canceled_?t(!1,new vw(!1,null,!0)):this.backoffId_=xX(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&EX(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class vw{constructor(e,t,i){this.wasSuccessCode=e,this.connection=t,this.canceled=!!i}}function CX(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function kX(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function $X(n,e){e&&(n["X-Firebase-GMPID"]=e)}function RX(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function PX(n,e,t,i,r,s,a=!0,o=!1){const l=TX(n.urlParams),u=n.url+l,c=Object.assign({},n.headers);return $X(c,e),CX(c,t),kX(c,s),RX(c,i),new IX(u,n.method,c,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,r,a,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NX(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function DX(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kb{constructor(e,t){this._service=e,t instanceof Os?this._location=t:this._location=Os.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new kb(e,t)}get root(){const e=new Os(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return DX(this._location.path)}get storage(){return this._service}get parent(){const e=NX(this._location.path);if(e===null)return null;const t=new Os(this._location.bucket,e);return new kb(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw wX(e)}}function uP(n,e){const t=e==null?void 0:e[hX];return t==null?null:Os.makeFromBucketSpec(t,n)}function MX(n,e,t,i={}){n.host=`${e}:${t}`;const r=Qd(e);r&&(sI(`https://${n.host}/b`),aI("Storage",!0)),n._isUsingEmulator=!0,n._protocol=r?"https":"http";const{mockUserToken:s}=i;s&&(n._overrideAuthToken=typeof s=="string"?s:qL(s,n.app.options.projectId))}class OX{constructor(e,t,i,r,s,a=!1){this.app=e,this._authProvider=t,this._appCheckProvider=i,this._url=r,this._firebaseVersion=s,this._isUsingEmulator=a,this._bucket=null,this._host=mz,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=fX,this._maxUploadRetryTime=pX,this._requests=new Set,r!=null?this._bucket=Os.makeFromBucketSpec(r,this._host):this._bucket=uP(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Os.makeFromBucketSpec(this._url,e):this._bucket=uP(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){lP("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){lP("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(Ar(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new kb(this,e)}_makeRequest(e,t,i,r,s=!0){if(this._deleted)return new bX(gz());{const a=PX(e,this._appId,i,r,t,this._firebaseVersion,s,this._isUsingEmulator);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}async makeRequestWithTokens(e,t){const[i,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,i,r).getPromise()}}const cP="@firebase/storage",dP="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yz="storage";function LX(n=uI(),e){n=Rn(n);const i=k1(n,yz).getImmediate({identifier:e}),r=UL("storage");return r&&FX(i,...r),i}function FX(n,e,t,i={}){MX(n,e,t,i)}function zX(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),i=n.getProvider("auth-internal"),r=n.getProvider("app-check-internal");return new OX(t,i,r,e,Jd)}function VX(){Od(new yu(yz,zX,"PUBLIC").setMultipleInstances(!0)),Ra(cP,dP,""),Ra(cP,dP,"esm2020")}VX();const jX={apiKey:"AIzaSyCRNLyBkav2ZbMNj9MakHKDdSzeabgFSTI",authDomain:"blood-fitness-app.firebaseapp.com",projectId:"blood-fitness-app",storageBucket:"blood-fitness-app.firebasestorage.app",messagingSenderId:"142443201042",appId:"1:142443201042:web:a962a38c46816d632b8ecb"},ZI=YL(jX),ec=jG(ZI),ra=XY(ZI);LX(ZI);const oE={async saveProfile(n,e){try{const t=eg(ra,"users",n);return await sP(t,{...e,updatedAt:km()},{merge:!0}),{success:!0}}catch(t){throw console.error("Error saving profile:",t),t}},async getProfile(n){try{const e=eg(ra,"users",n),t=await uX(e);return t.exists()?{success:!0,profile:{id:t.id,...t.data()}}:{success:!1,error:"Profile not found"}}catch(e){throw console.error("Error getting profile:",e),e}},async updateProfile(n,e){try{const t=eg(ra,"users",n);return await cX(t,{...e,updatedAt:km()}),{success:!0}}catch(t){throw console.error("Error updating profile:",t),t}},async saveBloodReport(n,e){try{const t=bh(ra,`users/${n}/bloodReports`);return{success:!0,reportId:(await aP(t,{...e,uploadDate:km()})).id}}catch(t){throw console.error("Error saving blood report:",t),t}},async getBloodReports(n){try{const e=bh(ra,`users/${n}/bloodReports`),t=tP(e,nP("uploadDate","desc")),i=await _w(t),r=[];return i.forEach(s=>{r.push({id:s.id,...s.data()})}),{success:!0,reports:r}}catch(e){throw console.error("Error getting blood reports:",e),e}},async savePrediction(n,e,t){try{const i=eg(ra,`users/${n}/bloodReports/${e}/predictions`,"latest");return await sP(i,{...t,predictionDate:km()}),{success:!0}}catch(i){throw console.error("Error saving prediction:",i),i}},async getPredictionHistory(n){try{const e=bh(ra,`users/${n}/bloodReports`),t=await _w(e),i=[];for(const r of t.docs){const s=bh(ra,`users/${n}/bloodReports/${r.id}/predictions`);(await _w(s)).forEach(o=>{i.push({reportId:r.id,...o.data()})})}return{success:!0,predictions:i}}catch(e){throw console.error("Error getting predictions:",e),e}},async saveWeightLog(n,e){try{const t=bh(ra,`users/${n}/weightLogs`);return await aP(t,{...e,timestamp:km()}),{success:!0}}catch(t){throw console.error("Error saving weight log:",t),t}},async getWeightLogs(n){try{const e=bh(ra,`users/${n}/weightLogs`),t=tP(e,nP("timestamp","asc")),i=await _w(t),r=[];return i.forEach(s=>{r.push({id:s.id,...s.data()})}),{success:!0,logs:r}}catch(e){throw console.error("Error getting weight logs:",e),e}}},ng={async register(n,e){try{const i=(await Tq(ec,n,e)).user;return await oE.saveProfile(i.uid,{email:i.email,name:n.split("@")[0],createdAt:new Date}),{success:!0,user:{email:i.email,id:i.uid}}}catch(t){return console.error("Registration error:",t),{success:!1,error:t.message||"Registration failed"}}},async login(n,e){try{const i=(await Sq(ec,n,e)).user;return{success:!0,user:{email:i.email,id:i.uid}}}catch(t){return console.error("Login error:",t),{success:!1,error:t.code==="auth/invalid-credential"?"Invalid email or password":t.message}}},async logout(){try{return await $q(ec),{success:!0}}catch(n){return console.error("Logout error:",n),{success:!1,error:n.message}}},async getProfile(){try{const n=ec.currentUser;return n?await oE.getProfile(n.uid):{success:!1,error:"No user logged in"}}catch(n){return console.error("Error getting profile:",n),{success:!1,error:n.message}}},async updateProfile(n){try{const e=ec.currentUser;return e?(await oE.saveProfile(e.uid,n),{success:!0,message:"Profile updated"}):{success:!1,error:"No user logged in"}}catch(e){return console.error("Error updating profile:",e),{success:!1,error:e.message}}},getCurrentUser(){return ec.currentUser},onAuthStateChange(n){return kq(ec,n)}},BX=Object.freeze(Object.defineProperty({__proto__:null,api:ng},Symbol.toStringTag,{value:"Module"})),UX=({onComplete:n})=>{const[e,t]=Ce.useState({name:"",age:"",gender:"male",weight:"",heightCm:"",heightFt:"",heightIn:""}),i=a=>{const{name:o,value:l}=a.target;t(u=>({...u,[o]:l}))},r=(a,o)=>Math.round(parseInt(a||0)*30.48+parseInt(o||0)*2.54),s=a=>{if(a.preventDefault(),!e.name||!e.age||!e.weight)return;const o={...e,heightCm:e.heightCm||r(e.heightFt,e.heightIn)};n(o)};return S.jsxs("div",{className:"profile-container fade-in",children:[S.jsxs("div",{className:"card profile-card",children:[S.jsxs("div",{className:"header",children:[S.jsx("h2",{children:"Let's know you better"}),S.jsx("p",{children:"Enter your details for personalized health insights."})]}),S.jsxs("form",{onSubmit:s,children:[S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:"Full Name"}),S.jsx("input",{type:"text",name:"name",className:"input-field",placeholder:"Your Name",value:e.name,onChange:i,required:!0})]}),S.jsxs("div",{className:"row",children:[S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:"Age"}),S.jsx("input",{type:"number",name:"age",className:"input-field",placeholder:"25",value:e.age,onChange:i,required:!0})]}),S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:"Gender"}),S.jsxs("select",{name:"gender",className:"input-field",value:e.gender,onChange:i,children:[S.jsx("option",{value:"male",children:"Male"}),S.jsx("option",{value:"female",children:"Female"}),S.jsx("option",{value:"other",children:"Other"})]})]})]}),S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:"Weight (kg)"}),S.jsx("input",{type:"number",name:"weight",className:"input-field",placeholder:"70.5",value:e.weight,onChange:i,step:"0.1",required:!0})]}),S.jsxs("div",{className:"height-section",children:[S.jsx("label",{children:"Height"}),S.jsx("div",{className:"tabs"}),S.jsxs("div",{className:"row",children:[S.jsxs("div",{className:"form-group",children:[S.jsx("label",{className:"sub-label",children:"CM"}),S.jsx("input",{type:"number",name:"heightCm",className:"input-field",placeholder:"175",value:e.heightCm,onChange:i})]}),S.jsx("div",{className:"or-divider",children:"OR"}),S.jsxs("div",{className:"form-group",children:[S.jsx("label",{className:"sub-label",children:"Feet"}),S.jsx("input",{type:"number",name:"heightFt",className:"input-field",placeholder:"5",value:e.heightFt,onChange:i})]}),S.jsxs("div",{className:"form-group",children:[S.jsx("label",{className:"sub-label",children:"Inches"}),S.jsx("input",{type:"number",name:"heightIn",className:"input-field",placeholder:"9",value:e.heightIn,onChange:i})]})]})]}),S.jsx("button",{type:"submit",className:"btn-primary",style:{marginTop:"2rem"},children:"Continue"})]})]}),S.jsx("style",{children:`
        .profile-container {
          padding: var(--spacing-md);
          min-height: 100vh;
          background-color: var(--color-background);
          display: flex;
          align-items: center;
          justify-content: center;
        }
        .profile-card {
           width: 100%;
           max-width: 450px;
        }
        .header {
          margin-bottom: var(--spacing-xl);
          text-align: center;
        }
        .header h2 {
          color: var(--color-text-main);
          margin-bottom: var(--spacing-xs);
        }
        .header p {
          color: var(--color-text-secondary);
          font-size: var(--font-size-sm);
        }
        .row {
          display: flex;
          gap: var(--spacing-md);
        }
        .row .form-group {
          flex: 1;
        }
        .form-group {
          margin-bottom: var(--spacing-md);
        }
        .form-group label {
          display: block;
          margin-bottom: var(--spacing-xs);
          font-size: var(--font-size-sm);
          font-weight: 500;
          color: var(--color-text-secondary);
        }
        .sub-label {
          font-size: var(--font-size-xs) !important;
          color: var(--color-text-muted) !important;
        }
        .or-divider {
          display: flex;
          align-items: center;
          font-size: var(--font-size-xs);
          color: var(--color-text-muted);
          font-weight: bold;
        }
        .height-section {
           background: #f1f5f9;
           padding: var(--spacing-md);
           border-radius: var(--radius-md);
        }
        .fade-in {
          animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
      `})]})};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var HX={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WX=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),ft=(n,e)=>{const t=Ce.forwardRef(({color:i="currentColor",size:r=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:o="",children:l,...u},c)=>Ce.createElement("svg",{ref:c,...HX,width:r,height:r,stroke:i,strokeWidth:a?Number(s)*24/Number(r):s,className:["lucide",`lucide-${WX(n)}`,o].join(" "),...u},[...e.map(([h,f])=>Ce.createElement(h,f)),...Array.isArray(l)?l:[l]]));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _z=ft("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vz=ft("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qX=ft("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GX=ft("Apple",[["path",{d:"M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z",key:"3s7exb"}],["path",{d:"M10 2c1 .5 2 2 2 5",key:"fcco2y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KX=ft("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hP=ft("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YX=ft("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XX=ft("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QX=ft("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JX=ft("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xo=ft("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fP=ft("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZX=ft("Dumbbell",[["path",{d:"m6.5 6.5 11 11",key:"f7oqzb"}],["path",{d:"m21 21-1-1",key:"cpc6if"}],["path",{d:"m3 3 1 1",key:"d3rpuf"}],["path",{d:"m18 22 4-4",key:"1e32o6"}],["path",{d:"m2 6 4-4",key:"189tqz"}],["path",{d:"m3 10 7-7",key:"1bxui2"}],["path",{d:"m14 21 7-7",key:"16x78n"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eQ=ft("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eC=ft("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pP=ft("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wz=ft("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tQ=ft("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nQ=ft("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iQ=ft("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rQ=ft("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sQ=ft("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aQ=ft("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oQ=ft("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lQ=ft("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uQ=ft("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cQ=ft("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dQ=ft("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bz=ft("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xz=ft("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fg=ft("Utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"1ogz0v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hQ=ft("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fQ=ft("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),pQ=({user:n,onClose:e,onLogout:t,onNavigate:i})=>{const[r,s]=Ce.useState("health"),[a,o]=Ce.useState(!1),[l,u]=Ce.useState({name:n.name||"",age:n.age||"",gender:n.gender||"Male",height:n.height||"",weight:n.weight||"",bloodGroup:n.bloodGroup||"",diseases:n.diseases||"",allergies:n.allergies||"",notes:n.notes||""}),[c,h]=Ce.useState([]);Ce.useEffect(()=>{const x=localStorage.getItem(`profile_${n.email}`);x&&u({...l,...JSON.parse(x)});const v=n.email?`reports_${n.email}`:"blood_reports",w=JSON.parse(localStorage.getItem(v)||"[]");h(w)},[n.email]);const f=()=>{localStorage.setItem(`profile_${n.email}`,JSON.stringify(l)),o(!1),alert("Profile saved successfully!")},m=x=>{if(!window.confirm("Are you sure you want to delete this report?"))return;const v=[...c];v.splice(x,1),h(v);const w=n.email?`reports_${n.email}`:"blood_reports";localStorage.setItem(w,JSON.stringify(v))},_=(()=>{if(!l.height||!l.weight)return null;const x=l.height/100;return(l.weight/(x*x)).toFixed(1)})();return S.jsxs("div",{className:"profile-dashboard fixed-fullscreen",children:[S.jsxs("div",{className:"profile-header",children:[S.jsx("button",{onClick:e,className:"p-back-btn",children:S.jsx(Xo,{size:24})}),S.jsx("h3",{children:"My Profile"}),S.jsx("button",{onClick:t,className:"p-logout",children:"Logout"})]}),S.jsxs("div",{className:"p-hero",children:[S.jsx("div",{className:"p-avatar",children:S.jsx(xz,{size:40,color:"white"})}),S.jsx("h2",{children:l.name||"User"}),S.jsxs("div",{className:"p-badges",children:[_&&S.jsxs("span",{className:"p-badge",children:["BMI: ",_]}),l.bloodGroup&&S.jsx("span",{className:"p-badge red",children:l.bloodGroup})]})]}),S.jsxs("div",{className:"p-tabs",children:[S.jsx("button",{className:`p-tab ${r==="health"?"active":""}`,onClick:()=>s("health"),children:"Health Profile"}),S.jsx("button",{className:`p-tab ${r==="reports"?"active":""}`,onClick:()=>s("reports"),children:"Reports"})]}),S.jsxs("div",{className:"p-content",children:[r==="health"&&S.jsxs("div",{className:"tab-pane fade-in",children:[S.jsxs("div",{className:"pane-header",children:[S.jsx("h4",{children:"Personal & Medical Data"}),!a&&S.jsx("button",{className:"edit-toggle",onClick:()=>o(!0),children:"Edit"})]}),S.jsxs("div",{className:"form-grid",style:{marginBottom:"20px"},children:[S.jsxs("div",{className:"field",children:[S.jsx("label",{children:"Age"}),S.jsx("input",{type:"number",disabled:!a,value:l.age,onChange:x=>u({...l,age:x.target.value})})]}),S.jsxs("div",{className:"field",children:[S.jsx("label",{children:"Blood Group"}),S.jsxs("select",{disabled:!a,value:l.bloodGroup,onChange:x=>u({...l,bloodGroup:x.target.value}),children:[S.jsx("option",{value:"",children:"Select"}),S.jsx("option",{children:"A+"}),S.jsx("option",{children:"A-"}),S.jsx("option",{children:"B+"}),S.jsx("option",{children:"B-"}),S.jsx("option",{children:"O+"}),S.jsx("option",{children:"O-"}),S.jsx("option",{children:"AB+"}),S.jsx("option",{children:"AB-"})]})]}),S.jsxs("div",{className:"field",children:[S.jsx("label",{children:"Weight (kg)"}),S.jsx("input",{type:"number",disabled:!a,value:l.weight,onChange:x=>u({...l,weight:x.target.value})})]}),S.jsxs("div",{className:"field",children:[S.jsx("label",{children:"Height (cm)"}),S.jsx("input",{type:"number",disabled:!a,value:l.height,onChange:x=>u({...l,height:x.target.value})})]})]}),S.jsxs("div",{className:"health-form",children:[S.jsx("label",{children:"Existing Conditions (Diseases)"}),S.jsx("textarea",{disabled:!a,placeholder:"e.g. Diabetes, Hypertension...",value:l.diseases,onChange:x=>u({...l,diseases:x.target.value})}),S.jsx("label",{children:"Allergies"}),S.jsx("textarea",{disabled:!a,placeholder:"e.g. Peanuts, Penicillin...",value:l.allergies,onChange:x=>u({...l,allergies:x.target.value})}),S.jsx("label",{children:"Health Notes"}),S.jsx("textarea",{className:"large-text",disabled:!a,placeholder:"Write your fitness goals here...",value:l.notes,onChange:x=>u({...l,notes:x.target.value})})]}),a&&S.jsxs("button",{className:"save-btn",onClick:f,children:[S.jsx(rQ,{size:18})," Save Health Data"]}),S.jsxs("div",{className:"milestones-preview",style:{marginTop:"20px",cursor:"pointer"},onClick:()=>i("weightprogress"),children:[S.jsxs("div",{className:"pane-header",style:{marginBottom:"10px"},children:[S.jsx("h5",{children:"Weight Tracker"}),S.jsx("span",{style:{fontSize:"12px",color:"var(--color-primary)"},children:"View Graph "})]}),S.jsx("p",{style:{fontSize:"12px",color:"#64748b"},children:"Track your weight journey over time."})]})]}),r==="reports"&&S.jsxs("div",{className:"tab-pane fade-in",children:[S.jsx("h4",{children:"Recent Blood Reports"}),c.length===0?S.jsx("p",{className:"empty-state",children:"No reports uploaded yet."}):S.jsx("div",{className:"reports-list",children:c.map((x,v)=>S.jsxs("div",{className:"report-item",children:[S.jsx("div",{className:"r-icon",children:S.jsx(eC,{size:20})}),S.jsxs("div",{className:"r-info",children:[S.jsx("span",{className:"r-date",children:x.date}),S.jsxs("span",{className:"r-summary",children:[x.results.length," Parameters Analyzed"]})]}),S.jsxs("div",{className:"r-actions-row",children:[S.jsx("button",{className:"icon-btn-small",onClick:()=>i("blood",x),title:"View Detail",children:S.jsx(eQ,{size:16,color:"var(--color-primary)"})}),S.jsx("button",{className:"icon-btn-small delete",onClick:()=>m(v),title:"Delete",children:S.jsx(uQ,{size:16,color:"#ef4444"})})]})]},v))})]})]}),S.jsx("style",{children:`
                .fixed-fullscreen {
                    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                    background: #f8fafc; z-index: 2000;
                    overflow-y: auto;
                    font-family: var(--font-family-body);
                }
                .profile-header {
                    display: flex; justify-content: space-between; align-items: center;
                    padding: 20px; background: white;
                }
                .profile-header h3 { margin: 0; font-size: 18px; }
                .p-back-btn { background: none; font-size: 24px; padding: 0; }
                .p-logout { color: #ef4444; background: none; font-weight: 600; font-size: 14px; }

                .p-hero {
                    background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
                    color: white; padding: 30px; text-align: center;
                    border-radius: 0 0 30px 30px; margin-bottom: 20px;
                    box-shadow: 0 10px 30px rgba(230, 57, 70, 0.2);
                }
                .p-avatar {
                    width: 80px; height: 80px; background: rgba(255,255,255,0.2);
                    border-radius: 50%; margin: 0 auto 15px;
                    display: flex; align-items: center; justify-content: center;
                    backdrop-filter: blur(5px); border: 2px solid rgba(255,255,255,0.4);
                }
                .p-badges { display: flex; justify-content: center; gap: 10px; margin-top: 10px; }
                .p-badge { background: rgba(0,0,0,0.2); padding: 4px 12px; border-radius: 99px; font-size: 12px; font-weight: 600; }
                .p-badge.red { background: #fee2e2; color: #991b1b; }

                .p-tabs {
                    display: flex; padding: 0 20px; gap: 10px; border-bottom: 1px solid #e2e8f0;
                }
                .p-tab {
                    flex: 1; padding: 12px; background: none; border-bottom: 3px solid transparent;
                    color: #64748b; font-weight: 600; font-size: 14px;
                }
                .p-tab.active { border-color: var(--color-primary); color: var(--color-primary); }

                .p-content { padding: 20px; }
                .tab-pane { animation: fadeIn 0.3s ease; }
                .pane-header { display: flex; justify-content: space-between; margin-bottom: 20px; align-items: center; }
                .edit-toggle { color: var(--color-primary); font-size: 14px; font-weight: 600; background: none; }

                .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
                .field label { display: block; font-size: 12px; color: #64748b; margin-bottom: 5px; }
                .field input, .field select {
                    width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px;
                    background: white; font-weight: 500;
                }
                .field input:disabled { background: #f1f5f9; color: #94a3b8; }

                .health-form label { display: block; font-size: 13px; font-weight: 600; margin-top: 15px; margin-bottom: 5px; }
                .health-form textarea {
                    width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 12px;
                    font-family: inherit; resize: none; height: 60px;
                }
                .health-form textarea.large-text { height: 100px; }

                .save-btn {
                    width: 100%; background: var(--color-primary); color: white;
                    padding: 14px; border-radius: 12px; margin-top: 25px;
                    font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px;
                    box-shadow: 0 4px 12px rgba(230, 57, 70, 0.2);
                }

                .reports-list { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
                .report-item {
                    background: white; padding: 15px; border-radius: 12px;
                    display: flex; align-items: center; gap: 15px;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
                }
                .r-icon {
                    width: 40px; height: 40px; background: #eff6ff; color: #3b82f6;
                    border-radius: 50%; display: flex; align-items: center; justify-content: center;
                }
                .r-info { flex: 1; display: flex; flex-direction: column; }
                .r-date { font-weight: 600; font-size: 14px; }
                .r-summary { font-size: 12px; color: #64748b; }
                .r-actions-row { display: flex; gap: 8px; }
                .icon-btn-small { 
                    background: #f1f5f9; border: none; padding: 6px; border-radius: 6px; 
                    cursor: pointer; display: flex; align-items: center; justify-content: center;
                }
                .icon-btn-small:hover { background: #e2e8f0; }
                .icon-btn-small.delete:hover { background: #fee2e2; }

                .export-btn {
                     width: 100%; margin-top: 20px; padding: 12px;
                     border: 1px dashed #cbd5e1; background: white; color: #475569;
                     border-radius: 12px; display: flex; justify-content: center; gap: 8px;
                     align-items: center;
                }

                .milestones-preview { margin-top: 30px; padding: 15px; background: #fff7ed; border-radius: 12px; }
                .milestone-badges { display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; }
                .m-badge { background: white; padding: 5px 10px; border-radius: 8px; font-size: 12px; font-weight: 600; color: #c2410c; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

                .fade-in { animation: fadeIn 0.4s ease; }
                @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
            `})]})},mQ=({userName:n,userProfile:e,onNavigate:t,onLogout:i})=>{const[r,s]=Ce.useState(!1);if(r)return S.jsx(pQ,{user:e||{name:n,email:"user@example.com"},onClose:()=>s(!1),onLogout:i,onNavigate:t});const a=[{id:"blood",title:"Blood Evaluation",desc:"Analyze reports & get insights",icon:S.jsx(eC,{size:24}),color:"#4361EE",bg:"#F0F4FF"},{id:"diet",title:"Specialized Diet",desc:"Meals based on Blood Report",icon:S.jsx(GX,{size:24}),color:"#10B981",bg:"#ECFDF5"},{id:"bmi",title:"BMI Calculator",desc:"Check your health risk & vitals",icon:S.jsx(YX,{size:24}),color:"var(--color-primary)",bg:"#FFF0F1"},{id:"fitness",title:"Fitness Helper",desc:"Diet plans & weight goals",icon:S.jsx(Fg,{size:24}),color:"#2A9D8F",bg:"#EDF7F6"},{id:"homeworkout",title:"Home Workout",desc:"8 Basic exercises & calories",icon:S.jsx(ZX,{size:24}),color:"#FF6B6B",bg:"#FFF0F1"},{id:"chat",title:"AI Health Bot",desc:"Ask questions & get advice",icon:S.jsx(tQ,{size:24}),color:"#7209B7",bg:"#F3E8FF"}];return S.jsxs("div",{className:"dashboard-container fade-in",children:[S.jsxs("header",{className:"dash-header",children:[S.jsx("div",{className:"avatar",onClick:()=>s(!0),style:{cursor:"pointer"},children:n?n.charAt(0).toUpperCase():"U"}),S.jsxs("div",{className:"welcome-text",children:[S.jsx("p",{children:"Welcome back,"}),S.jsx("h3",{children:n||"User"})]})]}),S.jsx("div",{className:"stats-preview",children:S.jsxs("div",{className:"stat-card",children:[S.jsx("h4",{children:"Stay Hydrated! "}),S.jsx("p",{children:"Drink 8 glasses of water today."})]})}),S.jsx("div",{className:"options-grid",children:a.map(o=>S.jsxs("button",{className:"option-card",onClick:()=>t(o.id),style:{"--hover-color":o.color},children:[S.jsx("div",{className:"icon-box",style:{color:o.color,backgroundColor:o.bg},children:o.icon}),S.jsxs("div",{className:"text-box",children:[S.jsx("h4",{children:o.title}),S.jsx("p",{children:o.desc})]}),S.jsx("div",{className:"arrow",children:""})]},o.id))}),S.jsx("style",{children:`
        .dashboard-container {
          padding: var(--spacing-md);
          padding-bottom: 80px; /* Space for bottom nav if added */
        }
        
        .dash-header {
          display: flex;
          align-items: center;
          gap: var(--spacing-md);
          margin-bottom: var(--spacing-xl);
        }

        .avatar {
          width: 50px;
          height: 50px;
          background: var(--color-primary);
          color: white;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
          font-size: var(--font-size-lg);
          box-shadow: var(--shadow-md);
        }

        .welcome-text {
          flex: 1;
        }

        .welcome-text p {
          color: var(--color-text-secondary);
          font-size: var(--font-size-xs);
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }

        .welcome-text h3 {
          color: var(--color-text-main);
        }

        .notif-btn {
          background: white;
          padding: 10px;
          border-radius: 50%;
          box-shadow: var(--shadow-sm);
          position: relative;
        }

        .badge {
          position: absolute;
          top: 8px;
          right: 8px;
          width: 8px;
          height: 8px;
          background: var(--color-danger);
          border-radius: 50%;
          border: 1px solid white;
        }

        .stats-preview {
          margin-bottom: var(--spacing-xl);
        }

        .stat-card {
           background: linear-gradient(135deg, #4CC9F0 0%, #4361EE 100%);
           color: white;
           padding: var(--spacing-lg);
           border-radius: var(--radius-lg);
           box-shadow: var(--shadow-md);
        }

        .options-grid {
          display: flex;
          flex-direction: column;
          gap: var(--spacing-md);
        }

        .option-card {
          display: flex;
          align-items: center;
          gap: var(--spacing-md);
          background: white;
          padding: var(--spacing-md);
          border-radius: var(--radius-lg);
          border: 1px solid rgba(0,0,0,0.04);
          box-shadow: var(--shadow-sm);
          text-align: left;
          width: 100%;
          transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .option-card:hover { /* Desktop hover */
           transform: translateY(-2px);
           box-shadow: var(--shadow-md);
           border-color: var(--hover-color);
        }

        .option-card:active {
           transform: scale(0.98);
        }

        .icon-box {
          width: 50px;
          height: 50px;
          border-radius: var(--radius-md);
          display: flex;
          align-items: center;
          justify-content: center;
          flex-shrink: 0;
        }

        .text-box {
          flex: 1;
        }

        .text-box h4 {
           margin-bottom: 2px;
           color: var(--color-text-main);
        }

        .text-box p {
           font-size: var(--font-size-xs);
           color: var(--color-text-secondary);
        }

        .arrow {
          color: var(--color-text-muted);
          font-weight: bold;
        }
      `})]})},gQ=({userProfile:n,onBack:e})=>{const[t,i]=Ce.useState("metric"),[r,s]=Ce.useState(""),[a,o]=Ce.useState(""),[l,u]=Ce.useState(""),[c,h]=Ce.useState(""),[f,m]=Ce.useState("male"),[y,_]=Ce.useState("sedentary"),[x,v]=Ce.useState(null),[w,E]=Ce.useState(""),[C,D]=Ce.useState(""),[V,I]=Ce.useState("");Ce.useEffect(()=>{n&&(n.height&&s(n.height),n.weight&&u(n.weight),n.age&&h(n.age),n.gender&&m(n.gender.toLowerCase()))},[n]);const k=()=>{let L=0,j=0;if(t==="metric"){if(!r||!l)return;L=parseFloat(r)/100,j=parseFloat(l)}else{if(!r||!l)return;L=(parseFloat(r)*12+(parseFloat(a)||0))*.0254,j=parseFloat(l)*.453592}if(L<=0||j<=0)return;const H=parseFloat((j/(L*L)).toFixed(1));v(H);let M="",se="",ue="";H<18.5?(M="Underweight",se="var(--color-accent)",ue="You may need to increase your calorie intake. Focus on nutrient-dense foods."):H<24.9?(M="Normal Weight",se="var(--color-success)",ue="Great job! You have a healthy body weight. Maintain it with balanced diet and exercise."):H<29.9?(M="Overweight",se="var(--color-warning)",ue="Try to incorporate more cardio and monitor portion sizes to reach a healthier range."):(M="Obese",se="var(--color-danger)",ue="It is recommended to consult a healthcare provider for a personalized weight management plan."),E({label:M,color:se}),I(ue);const ae=L/.0254-60;let J=0;f==="male"?J=52+1.9*Math.max(0,ae):J=49+1.7*Math.max(0,ae),D(`${J.toFixed(1)} - ${(J*1.1).toFixed(1)} kg`)},N=()=>{v(null),s(""),u(""),h("")};return S.jsxs("div",{className:"advanced-bmi-container fade-in",children:[S.jsxs("div",{className:"bmi-header",children:[S.jsx("button",{onClick:e,className:"btn-icon",children:S.jsx(Xo,{size:24})}),S.jsx("h2",{children:"Advanced BMI Calculator"}),S.jsx("div",{style:{width:24}})," "]}),S.jsxs("div",{className:"calculator-grid",children:[S.jsxs("div",{className:"card input-card",children:[S.jsxs("div",{className:"toggle-row",children:[S.jsx("button",{className:`toggle-btn ${t==="metric"?"active":""}`,onClick:()=>i("metric"),children:"Metric (cm/kg)"}),S.jsx("button",{className:`toggle-btn ${t==="imperial"?"active":""}`,onClick:()=>i("imperial"),children:"Imperial (ft/lbs)"})]}),S.jsxs("div",{className:"form-row",children:[S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:"Gender"}),S.jsxs("select",{value:f,onChange:L=>m(L.target.value),children:[S.jsx("option",{value:"male",children:"Male"}),S.jsx("option",{value:"female",children:"Female"})]})]}),S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:"Age (years)"}),S.jsx("input",{type:"number",value:c,onChange:L=>h(L.target.value),placeholder:"25"})]})]}),S.jsxs("div",{className:"form-row",children:[S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:t==="metric"?"Height (cm)":"Height (ft)"}),S.jsx("input",{type:"number",value:r,onChange:L=>s(L.target.value),placeholder:t==="metric"?"175":"5"})]}),t==="imperial"&&S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:"Inches"}),S.jsx("input",{type:"number",value:a,onChange:L=>o(L.target.value),placeholder:"10"})]}),S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:t==="metric"?"Weight (kg)":"Weight (lbs)"}),S.jsx("input",{type:"number",value:l,onChange:L=>u(L.target.value),placeholder:t==="metric"?"70":"150"})]})]}),S.jsxs("div",{className:"form-group",children:[S.jsx("label",{children:"Activity Level"}),S.jsxs("select",{value:y,onChange:L=>_(L.target.value),children:[S.jsx("option",{value:"sedentary",children:"Sedentary (Little or no exercise)"}),S.jsx("option",{value:"light",children:"Lightly active (1-3 days/week)"}),S.jsx("option",{value:"moderate",children:"Moderately active (3-5 days/week)"}),S.jsx("option",{value:"active",children:"Very active (6-7 days/week)"})]})]}),S.jsxs("div",{className:"action-row",children:[S.jsx("button",{className:"reset-btn",onClick:N,children:S.jsx(iQ,{size:18})}),S.jsx("button",{className:"calculate-btn",onClick:k,children:"Calculate BMI"})]})]}),x&&S.jsxs("div",{className:"card result-card fade-in",children:[S.jsxs("div",{className:"result-header",children:[S.jsx("h3",{children:"Your Result"}),S.jsx("div",{className:"bmi-badge",style:{backgroundColor:w.color},children:w.label})]}),S.jsxs("div",{className:"bmi-display",children:[S.jsx("span",{className:"bmi-number",style:{color:w.color},children:x}),S.jsx("span",{className:"bmi-label",children:"BMI Score"})]}),S.jsxs("div",{className:"progress-bar-container",children:[S.jsx("div",{className:"progress-track"}),S.jsx("div",{className:"progress-fill",style:{width:`${Math.min(Math.max(x/40*100,0),100)}%`,backgroundColor:w.color}}),S.jsxs("div",{className:"markers",children:[S.jsx("span",{style:{left:"46%"},children:"18.5"}),S.jsx("span",{style:{left:"62.5%"},children:"25"}),S.jsx("span",{style:{left:"75%"},children:"30"})]})]}),S.jsxs("div",{className:"health-insight",children:[S.jsxs("div",{className:"insight-item",children:[S.jsx(_z,{size:20,className:"icon"}),S.jsxs("div",{children:[S.jsx("h4",{children:"Ideal Weight"}),S.jsx("p",{children:C})]})]}),S.jsxs("div",{className:"insight-item",children:[S.jsx(wz,{size:20,className:"icon"}),S.jsxs("div",{children:[S.jsx("h4",{children:"Health Tip"}),S.jsx("p",{children:V})]})]})]})]})]}),S.jsx("style",{children:`
                .advanced-bmi-container {
                    padding: 20px;
                    max-width: 600px;
                    margin: 0 auto;
                }
                .bmi-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 25px;
                }
                .btn-icon { background: none; color: var(--color-text-main); padding: 0; }
                
                .toggle-row {
                    display: flex;
                    background: #f1f5f9;
                    border-radius: 12px;
                    padding: 4px;
                    margin-bottom: 20px;
                }
                .toggle-btn {
                    flex: 1;
                    padding: 10px;
                    border-radius: 8px;
                    background: transparent;
                    color: #64748b;
                    font-weight: 600;
                    font-size: 14px;
                    transition: all 0.2s;
                }
                .toggle-btn.active {
                    background: white;
                    color: var(--color-primary);
                    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                }

                .form-row {
                    display: flex;
                    gap: 15px;
                    margin-bottom: 15px;
                }
                .form-group { flex: 1; }
                .form-group label {
                    display: block;
                    font-size: 13px;
                    font-weight: 600;
                    color: #475569;
                    margin-bottom: 6px;
                }
                .form-group input, .form-group select {
                    width: 100%;
                    padding: 12px;
                    border: 1px solid #e2e8f0;
                    border-radius: 10px;
                    font-size: 16px;
                    background: #fff;
                    transition: border-color 0.2s;
                }
                .form-group input:focus, .form-group select:focus {
                    outline: none;
                    border-color: var(--color-primary);
                }

                .action-row {
                    display: flex;
                    gap: 10px;
                    margin-top: 25px;
                }
                .reset-btn {
                    width: 48px;
                    background: #f1f5f9;
                    color: #64748b;
                    border-radius: 12px;
                    display: flex; align-items: center; justify-content: center;
                }
                .calculate-btn {
                    flex: 1;
                    background: var(--color-primary);
                    color: white;
                    padding: 14px;
                    border-radius: 12px;
                    font-weight: 600;
                    font-size: 16px;
                    box-shadow: 0 4px 12px rgba(230, 57, 70, 0.25);
                }
                .calculate-btn:active { transform: scale(0.98); }

                /* Result Card Styles */
                .result-card {
                    margin-top: 25px;
                    border: 1px solid #e2e8f0;
                }
                .result-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    border-bottom: 1px solid #f1f5f9;
                    padding-bottom: 15px;
                    margin-bottom: 20px;
                }
                .bmi-badge {
                    padding: 6px 12px;
                    border-radius: 99px;
                    color: white;
                    font-size: 12px;
                    font-weight: 700;
                    text-transform: uppercase;
                }
                
                .bmi-display {
                    text-align: center;
                    margin-bottom: 25px;
                }
                .bmi-number {
                    display: block;
                    font-size: 4rem;
                    font-weight: 800;
                    line-height: 1;
                }
                .bmi-label {
                    color: #94a3b8;
                    font-size: 14px;
                    font-weight: 500;
                }

                .progress-bar-container {
                    position: relative;
                    height: 12px;
                    background: #f1f5f9;
                    border-radius: 99px;
                    margin-bottom: 30px;
                }
                .progress-fill {
                    height: 100%;
                    border-radius: 99px;
                    transition: width 1s ease-out;
                }
                .markers {
                    position: absolute;
                    top: 15px;
                    left: 0;
                    width: 100%;
                    height: 20px;
                }
                .markers span {
                    position: absolute;
                    transform: translateX(-50%);
                    font-size: 10px;
                    color: #94a3b8;
                    font-weight: 600;
                }
                .markers span::before {
                    content: '';
                    position: absolute;
                    top: -15px;
                    left: 50%;
                    width: 2px;
                    height: 12px;
                    background: white;
                    transform: translateX(-50%);
                }

                .health-insight {
                    background: #f8fafc;
                    border-radius: 12px;
                    padding: 15px;
                    display: flex;
                    flex-direction: column;
                    gap: 15px;
                }
                .insight-item {
                    display: flex;
                    gap: 15px;
                    align-items: flex-start;
                }
                .insight-item .icon {
                    color: var(--color-primary);
                    margin-top: 2px;
                }
                .insight-item h4 {
                    font-size: 14px;
                    margin-bottom: 4px;
                    color: var(--color-text-main);
                }
                .insight-item p {
                    font-size: 13px;
                    color: #64748b;
                    line-height: 1.4;
                }

                .fade-in { animation: fadeIn 0.4s ease-out; }
                @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
            `})]})};var yQ={exports:{}};(function(n){var e=function(t){var i=Object.prototype,r=i.hasOwnProperty,s=Object.defineProperty||function(q,G,U){q[G]=U.value},a,o=typeof Symbol=="function"?Symbol:{},l=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function h(q,G,U){return Object.defineProperty(q,G,{value:U,enumerable:!0,configurable:!0,writable:!0}),q[G]}try{h({},"")}catch{h=function(G,U,Y){return G[U]=Y}}function f(q,G,U,Y){var K=G&&G.prototype instanceof E?G:E,Z=Object.create(K.prototype),ge=new ee(Y||[]);return s(Z,"_invoke",{value:H(q,U,ge)}),Z}t.wrap=f;function m(q,G,U){try{return{type:"normal",arg:q.call(G,U)}}catch(Y){return{type:"throw",arg:Y}}}var y="suspendedStart",_="suspendedYield",x="executing",v="completed",w={};function E(){}function C(){}function D(){}var V={};h(V,l,function(){return this});var I=Object.getPrototypeOf,k=I&&I(I(ae([])));k&&k!==i&&r.call(k,l)&&(V=k);var N=D.prototype=E.prototype=Object.create(V);C.prototype=D,s(N,"constructor",{value:D,configurable:!0}),s(D,"constructor",{value:C,configurable:!0}),C.displayName=h(D,c,"GeneratorFunction");function L(q){["next","throw","return"].forEach(function(G){h(q,G,function(U){return this._invoke(G,U)})})}t.isGeneratorFunction=function(q){var G=typeof q=="function"&&q.constructor;return G?G===C||(G.displayName||G.name)==="GeneratorFunction":!1},t.mark=function(q){return Object.setPrototypeOf?Object.setPrototypeOf(q,D):(q.__proto__=D,h(q,c,"GeneratorFunction")),q.prototype=Object.create(N),q},t.awrap=function(q){return{__await:q}};function j(q,G){function U(Z,ge,ve,Q){var be=m(q[Z],q,ge);if(be.type==="throw")Q(be.arg);else{var vt=be.arg,mt=vt.value;return mt&&typeof mt=="object"&&r.call(mt,"__await")?G.resolve(mt.__await).then(function(nn){U("next",nn,ve,Q)},function(nn){U("throw",nn,ve,Q)}):G.resolve(mt).then(function(nn){vt.value=nn,ve(vt)},function(nn){return U("throw",nn,ve,Q)})}}var Y;function K(Z,ge){function ve(){return new G(function(Q,be){U(Z,ge,Q,be)})}return Y=Y?Y.then(ve,ve):ve()}s(this,"_invoke",{value:K})}L(j.prototype),h(j.prototype,u,function(){return this}),t.AsyncIterator=j,t.async=function(q,G,U,Y,K){K===void 0&&(K=Promise);var Z=new j(f(q,G,U,Y),K);return t.isGeneratorFunction(G)?Z:Z.next().then(function(ge){return ge.done?ge.value:Z.next()})};function H(q,G,U){var Y=y;return function(Z,ge){if(Y===x)throw new Error("Generator is already running");if(Y===v){if(Z==="throw")throw ge;return J()}for(U.method=Z,U.arg=ge;;){var ve=U.delegate;if(ve){var Q=M(ve,U);if(Q){if(Q===w)continue;return Q}}if(U.method==="next")U.sent=U._sent=U.arg;else if(U.method==="throw"){if(Y===y)throw Y=v,U.arg;U.dispatchException(U.arg)}else U.method==="return"&&U.abrupt("return",U.arg);Y=x;var be=m(q,G,U);if(be.type==="normal"){if(Y=U.done?v:_,be.arg===w)continue;return{value:be.arg,done:U.done}}else be.type==="throw"&&(Y=v,U.method="throw",U.arg=be.arg)}}}function M(q,G){var U=G.method,Y=q.iterator[U];if(Y===a)return G.delegate=null,U==="throw"&&q.iterator.return&&(G.method="return",G.arg=a,M(q,G),G.method==="throw")||U!=="return"&&(G.method="throw",G.arg=new TypeError("The iterator does not provide a '"+U+"' method")),w;var K=m(Y,q.iterator,G.arg);if(K.type==="throw")return G.method="throw",G.arg=K.arg,G.delegate=null,w;var Z=K.arg;if(!Z)return G.method="throw",G.arg=new TypeError("iterator result is not an object"),G.delegate=null,w;if(Z.done)G[q.resultName]=Z.value,G.next=q.nextLoc,G.method!=="return"&&(G.method="next",G.arg=a);else return Z;return G.delegate=null,w}L(N),h(N,c,"Generator"),h(N,l,function(){return this}),h(N,"toString",function(){return"[object Generator]"});function se(q){var G={tryLoc:q[0]};1 in q&&(G.catchLoc=q[1]),2 in q&&(G.finallyLoc=q[2],G.afterLoc=q[3]),this.tryEntries.push(G)}function ue(q){var G=q.completion||{};G.type="normal",delete G.arg,q.completion=G}function ee(q){this.tryEntries=[{tryLoc:"root"}],q.forEach(se,this),this.reset(!0)}t.keys=function(q){var G=Object(q),U=[];for(var Y in G)U.push(Y);return U.reverse(),function K(){for(;U.length;){var Z=U.pop();if(Z in G)return K.value=Z,K.done=!1,K}return K.done=!0,K}};function ae(q){if(q){var G=q[l];if(G)return G.call(q);if(typeof q.next=="function")return q;if(!isNaN(q.length)){var U=-1,Y=function K(){for(;++U<q.length;)if(r.call(q,U))return K.value=q[U],K.done=!1,K;return K.value=a,K.done=!0,K};return Y.next=Y}}return{next:J}}t.values=ae;function J(){return{value:a,done:!0}}return ee.prototype={constructor:ee,reset:function(q){if(this.prev=0,this.next=0,this.sent=this._sent=a,this.done=!1,this.delegate=null,this.method="next",this.arg=a,this.tryEntries.forEach(ue),!q)for(var G in this)G.charAt(0)==="t"&&r.call(this,G)&&!isNaN(+G.slice(1))&&(this[G]=a)},stop:function(){this.done=!0;var q=this.tryEntries[0],G=q.completion;if(G.type==="throw")throw G.arg;return this.rval},dispatchException:function(q){if(this.done)throw q;var G=this;function U(Q,be){return Z.type="throw",Z.arg=q,G.next=Q,be&&(G.method="next",G.arg=a),!!be}for(var Y=this.tryEntries.length-1;Y>=0;--Y){var K=this.tryEntries[Y],Z=K.completion;if(K.tryLoc==="root")return U("end");if(K.tryLoc<=this.prev){var ge=r.call(K,"catchLoc"),ve=r.call(K,"finallyLoc");if(ge&&ve){if(this.prev<K.catchLoc)return U(K.catchLoc,!0);if(this.prev<K.finallyLoc)return U(K.finallyLoc)}else if(ge){if(this.prev<K.catchLoc)return U(K.catchLoc,!0)}else if(ve){if(this.prev<K.finallyLoc)return U(K.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(q,G){for(var U=this.tryEntries.length-1;U>=0;--U){var Y=this.tryEntries[U];if(Y.tryLoc<=this.prev&&r.call(Y,"finallyLoc")&&this.prev<Y.finallyLoc){var K=Y;break}}K&&(q==="break"||q==="continue")&&K.tryLoc<=G&&G<=K.finallyLoc&&(K=null);var Z=K?K.completion:{};return Z.type=q,Z.arg=G,K?(this.method="next",this.next=K.finallyLoc,w):this.complete(Z)},complete:function(q,G){if(q.type==="throw")throw q.arg;return q.type==="break"||q.type==="continue"?this.next=q.arg:q.type==="return"?(this.rval=this.arg=q.arg,this.method="return",this.next="end"):q.type==="normal"&&G&&(this.next=G),w},finish:function(q){for(var G=this.tryEntries.length-1;G>=0;--G){var U=this.tryEntries[G];if(U.finallyLoc===q)return this.complete(U.completion,U.afterLoc),ue(U),w}},catch:function(q){for(var G=this.tryEntries.length-1;G>=0;--G){var U=this.tryEntries[G];if(U.tryLoc===q){var Y=U.completion;if(Y.type==="throw"){var K=Y.arg;ue(U)}return K}}throw new Error("illegal catch attempt")},delegateYield:function(q,G,U){return this.delegate={iterator:ae(q),resultName:G,nextLoc:U},this.method==="next"&&(this.arg=a),w}},t}(n.exports);try{regeneratorRuntime=e}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})(yQ);var tC=(n,e)=>`${n}-${e}-${Math.random().toString(16).slice(3,8)}`;const _Q=tC;let mP=0;var Ez=({id:n,action:e,payload:t={}})=>{let i=n;return typeof i>"u"&&(i=_Q("Job",mP),mP+=1),{id:i,action:e,payload:t}},Hp={};let nC=!1;Hp.logging=nC;Hp.setLogging=n=>{nC=n};Hp.log=(...n)=>nC?console.log.apply(void 0,n):null;const vQ=Ez,{log:ww}=Hp,wQ=tC;let gP=0;var bQ=()=>{const n=wQ("Scheduler",gP),e={},t={};let i=[];gP+=1;const r=()=>i.length,s=()=>Object.keys(e).length,a=()=>{if(i.length!==0){const h=Object.keys(e);for(let f=0;f<h.length;f+=1)if(typeof t[h[f]]>"u"){i[0](e[h[f]]);break}}},o=(h,f)=>new Promise((m,y)=>{const _=vQ({action:h,payload:f});i.push(async x=>{i.shift(),t[x.id]=_;try{m(await x[h].apply(void 0,[...f,_.id]))}catch(v){y(v)}finally{delete t[x.id],a()}}),ww(`[${n}]: Add ${_.id} to JobQueue`),ww(`[${n}]: JobQueue length=${i.length}`),a()});return{addWorker:h=>(e[h.id]=h,ww(`[${n}]: Add ${h.id}`),ww(`[${n}]: Number of workers=${s()}`),a(),h.id),addJob:async(h,...f)=>{if(s()===0)throw Error(`[${n}]: You need to have at least one worker before adding jobs`);return o(h,f)},terminate:async()=>{Object.keys(e).forEach(async h=>{await e[h].terminate()}),i=[]},getQueueLen:r,getNumWorkers:s}};function xQ(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}function EQ(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}var AQ=EQ;const TQ=AQ;var SQ=n=>{const e={};return typeof WorkerGlobalScope<"u"?e.type="webworker":TQ()?e.type="electron":typeof document=="object"?e.type="browser":typeof process=="object"&&typeof xQ=="function"&&(e.type="node"),typeof n>"u"?e:e[n]};const IQ=SQ("type")==="browser",CQ=IQ?n=>new URL(n,window.location.href).href:n=>n;var kQ=n=>{const e={...n};return["corePath","workerPath","langPath"].forEach(t=>{n[t]&&(e[t]=CQ(e[t]))}),e},$Q=n=>{const e=[],t=[],i=[],r=[],s=[];return n.blocks&&n.blocks.forEach(a=>{a.paragraphs.forEach(o=>{o.lines.forEach(l=>{l.words.forEach(u=>{u.symbols.forEach(c=>{s.push({...c,page:n,block:a,paragraph:o,line:l,word:u})}),r.push({...u,page:n,block:a,paragraph:o,line:l})}),i.push({...l,page:n,block:a,paragraph:o})}),t.push({...o,page:n,block:a})}),e.push({...a,page:n})}),{...n,blocks:e,paragraphs:t,lines:i,words:r,symbols:s}},Az={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const RQ="5.1.1",PQ={version:RQ};var NQ={workerBlobURL:!0,logger:()=>{}};const DQ=PQ.version,MQ=NQ;var OQ={...MQ,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${DQ}/dist/worker.min.js`},LQ=({workerPath:n,workerBlobURL:e})=>{let t;if(Blob&&URL&&e){const i=new Blob([`importScripts("${n}");`],{type:"application/javascript"});t=new Worker(URL.createObjectURL(i))}else t=new Worker(n);return t},FQ=n=>{n.terminate()},zQ=(n,e)=>{n.onmessage=({data:t})=>{e(t)}},VQ=async(n,e)=>{n.postMessage(e)};const lE=n=>new Promise((e,t)=>{const i=new FileReader;i.onload=()=>{e(i.result)},i.onerror=({target:{error:{code:r}}})=>{t(Error(`File could not be read! Code=${r}`))},i.readAsArrayBuffer(n)}),NT=async n=>{let e=n;if(typeof n>"u")return"undefined";if(typeof n=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(n)?e=atob(n.split(",")[1]).split("").map(t=>t.charCodeAt(0)):e=await(await fetch(n)).arrayBuffer();else if(typeof HTMLElement<"u"&&n instanceof HTMLElement)n.tagName==="IMG"&&(e=await NT(n.src)),n.tagName==="VIDEO"&&(e=await NT(n.poster)),n.tagName==="CANVAS"&&await new Promise(t=>{n.toBlob(async i=>{e=await lE(i),t()})});else if(typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas){const t=await n.convertToBlob();e=await lE(t)}else(n instanceof File||n instanceof Blob)&&(e=await lE(n));return new Uint8Array(e)};var jQ=NT;const BQ=OQ,UQ=LQ,HQ=FQ,WQ=zQ,qQ=VQ,GQ=jQ;var KQ={defaultOptions:BQ,spawnWorker:UQ,terminateWorker:HQ,onMessage:WQ,send:qQ,loadImage:GQ};const YQ=kQ,XQ=$Q,cs=Ez,{log:yP}=Hp,QQ=tC,tc=Az,{defaultOptions:JQ,spawnWorker:ZQ,terminateWorker:eJ,onMessage:tJ,loadImage:_P,send:nJ}=KQ;let vP=0;var Tz=async(n="eng",e=tc.LSTM_ONLY,t={},i={})=>{const r=QQ("Worker",vP),{logger:s,errorHandler:a,...o}=YQ({...JQ,...t}),l={},u={},c=typeof n=="string"?n.split("+"):n;let h=e,f=i;const m=[tc.DEFAULT,tc.LSTM_ONLY].includes(e)&&!o.legacyCore;let y,_;const x=new Promise((K,Z)=>{_=K,y=Z}),v=K=>{y(K.message)};let w=ZQ(o);w.onerror=v,vP+=1;const E=(K,Z)=>{l[K]=Z},C=(K,Z)=>{u[K]=Z},D=({id:K,action:Z,payload:ge})=>new Promise((ve,Q)=>{yP(`[${r}]: Start ${K}, action=${Z}`);const be=`${Z}-${K}`;E(be,ve),C(be,Q),nJ(w,{workerId:r,jobId:K,action:Z,payload:ge})}),V=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),I=K=>D(cs({id:K,action:"load",payload:{options:{lstmOnly:m,corePath:o.corePath,logging:o.logging}}})),k=(K,Z,ge)=>D(cs({id:ge,action:"FS",payload:{method:"writeFile",args:[K,Z]}})),N=(K,Z)=>D(cs({id:Z,action:"FS",payload:{method:"readFile",args:[K,{encoding:"utf8"}]}})),L=(K,Z)=>D(cs({id:Z,action:"FS",payload:{method:"unlink",args:[K]}})),j=(K,Z,ge)=>D(cs({id:ge,action:"FS",payload:{method:K,args:Z}})),H=()=>console.warn("`loadLanguage` is depreciated and should be removed from code (workers now come with language pre-loaded)"),M=(K,Z)=>D(cs({id:Z,action:"loadLanguage",payload:{langs:K,options:{langPath:o.langPath,dataPath:o.dataPath,cachePath:o.cachePath,cacheMethod:o.cacheMethod,gzip:o.gzip,lstmOnly:[tc.DEFAULT,tc.LSTM_ONLY].includes(h)&&!o.legacyLang}}})),se=()=>console.warn("`initialize` is depreciated and should be removed from code (workers now come pre-initialized)"),ue=(K,Z,ge,ve)=>D(cs({id:ve,action:"initialize",payload:{langs:K,oem:Z,config:ge}})),ee=(K="eng",Z,ge,ve)=>{if(m&&[tc.TESSERACT_ONLY,tc.TESSERACT_LSTM_COMBINED].includes(Z))throw Error("Legacy model requested but code missing.");const Q=Z||h;h=Q;const be=ge||f;f=be;const mt=(typeof K=="string"?K.split("+"):K).filter(nn=>!c.includes(nn));return c.push(...mt),mt.length>0?M(mt,ve).then(()=>ue(K,Q,be,ve)):ue(K,Q,be,ve)},ae=(K={},Z)=>D(cs({id:Z,action:"setParameters",payload:{params:K}})),J=async(K,Z={},ge={blocks:!0,text:!0,hocr:!0,tsv:!0},ve)=>D(cs({id:ve,action:"recognize",payload:{image:await _P(K),options:Z,output:ge}})),q=(K="Tesseract OCR Result",Z=!1,ge)=>(console.log("`getPDF` function is depreciated. `recognize` option `savePDF` should be used instead."),D(cs({id:ge,action:"getPDF",payload:{title:K,textonly:Z}}))),G=async(K,Z)=>{if(m)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return D(cs({id:Z,action:"detect",payload:{image:await _P(K)}}))},U=async()=>(w!==null&&(eJ(w),w=null),Promise.resolve());tJ(w,({workerId:K,jobId:Z,status:ge,action:ve,data:Q})=>{const be=`${ve}-${Z}`;if(ge==="resolve"){yP(`[${K}]: Complete ${Z}`);let vt=Q;ve==="recognize"?vt=XQ(Q):ve==="getPDF"&&(vt=Array.from({...Q,length:Object.keys(Q).length})),l[be]({jobId:Z,data:vt})}else if(ge==="reject")if(u[be](Q),ve==="load"&&y(Q),a)a(Q);else throw Error(Q);else ge==="progress"&&s({...Q,userJobId:Z})});const Y={id:r,worker:w,setResolve:E,setReject:C,load:V,writeText:k,readText:N,removeFile:L,FS:j,loadLanguage:H,initialize:se,reinitialize:ee,setParameters:ae,recognize:J,getPDF:q,detect:G,terminate:U};return I().then(()=>M(n)).then(()=>ue(n,e,i)).then(()=>_(Y)).catch(()=>{}),x};const Sz=Tz,iJ=async(n,e,t)=>{const i=await Sz(e,1,t);return i.recognize(n).finally(async()=>{await i.terminate()})},rJ=async(n,e)=>{const t=await Sz("osd",0,e);return t.detect(n).finally(async()=>{await t.terminate()})};var sJ={recognize:iJ,detect:rJ},aJ={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},oJ={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"};const lJ=bQ,uJ=Tz,cJ=sJ,dJ=aJ,hJ=Az,fJ=oJ,{setLogging:pJ}=Hp;var mJ={languages:dJ,OEM:hJ,PSM:fJ,createScheduler:lJ,createWorker:uJ,setLogging:pJ,...cJ};const DT=AO(mJ),wP={hemoglobin:["hemoglobin","haemoglobin","hb","hgb"],rbc_count:["rbc count","total rbc","red blood cells","erythrocyte count"],total_count:["total leucocyte count","tlc","wbc count","white blood cells","total count"],platelet_count:["platelet count","platelet","plt"],hematocrit:["hematocrit","hct","pcv","packed cell volume"],mcv:["mcv","mean corpuscular volume"],mch:["mch","mean corpuscular hemoglobin"],mchc:["mchc","mean corpuscular hemoglobin concentration"],rdw:["rdw","red cell distribution width","rdw-cv","rdw-sd"],neutrophil:["neutrophils","polymorphs","neutrophil","neutrophil %"],lymphocyte:["lymphocytes","lymphocyte","lymphocyte %"],monocyte:["monocytes","monocyte","monocyte %"],eosinophil:["eosinophils","eosinophil","eosinophil %"],basophil:["basophils","basophil","basophil %"],reticulocyte_count:["reticulocyte count","retic count"],esr:["esr","erythrocyte sedimentation rate"],absolute_neutrophil_count:["absolute neutrophil count","anc"],absolute_lymphocyte_count:["absolute lymphocyte count","alc"],absolute_monocyte_count:["absolute monocyte count"],absolute_eosinophil_count:["absolute eosinophil count","aec"],mpv:["mpv","mean platelet volume"],pdw:["pdw","platelet distribution width"],pct:["pct","plateletcrit"],bun:["blood urea nitrogen","bun"],creatinine:["serum creatinine","creatinine"],uric_acid:["serum uric acid","uric acid"],bun_creatinine_ratio:["bun/creatinine ratio","bun/creat ratio"],egfr:["egfr","estimated glomerular filtration rate"],urine_ph:["urine ph","reaction (ph)"],urine_specific_gravity:["urine specific gravity","sp. gravity"],urine_pus_cells:["pus cells","leukocytes (urine)"],urine_rbc:["rbc (urine)","red blood cells (urine)"],urine_protein:["albumin (urine)","protein (urine)"],urine_sugar:["sugar (urine)","glucose (urine)"],bilirubin_total:["total bilirubin","bilirubin total"],bilirubin_direct:["direct bilirubin","conjugated bilirubin"],bilirubin_indirect:["indirect bilirubin","unconjugated bilirubin"],sgot:["sgot","ast","aspartate aminotransferase"],sgpt:["sgpt","alt","alanine aminotransferase"],alkaline_phosphatase:["alkaline phosphatase","alp"],total_protein:["total protein","serum protein"],albumin:["albumin"],globulin:["globulin"],ag_ratio:["a/g ratio","albumin/globulin ratio"],ggt:["gamma gt","ggt","gamma-glutamyl transferase"],ldh:["ldh","lactate dehydrogenase"],ammonia:["ammonia"],sodium:["sodium","na+","serum sodium"],potassium:["potassium","k+","serum potassium"],chloride:["chloride","cl-","serum chloride"],bicarbonate:["bicarbonate","hco3","co2 content"],calcium:["calcium","total calcium"],ionized_calcium:["ionized calcium"],phosphorus:["phosphorus","phosphate","po4"],magnesium:["magnesium"],anion_gap:["anion gap"],glucose_fasting:["glucose fasting","fasting glucose","fbs","fasting blood sugar"],glucose_pp:["glucose pp","ppbs","post prandial"],glucose_random:["random glucose","rbs"],hba1c:["hba1c","glycated hemoglobin","glycosylated hemoglobin"],insulin:["insulin fasting","fasting insulin"],c_peptide:["c-peptide"],cholesterol:["total cholesterol","serum cholesterol"],hdl_cholesterol:["hdl cholesterol","hdl"],ldl_cholesterol:["ldl cholesterol","ldl"],triglycerides:["triglycerides"],vldl:["vldl"],ldl_hdl_ratio:["ldl/hdl ratio"],chol_hdl_ratio:["total cholesterol/hdl ratio","chol/hdl"],non_hdl_cholesterol:["non-hdl cholesterol"],tsh:["thyroid stimulating hormone","tsh","thyrotropin"],t3:["triiodothyronine","total t3","t3"],t4:["thyroxine","total t4","t4"],free_t3:["free t3","ft3"],free_t4:["free t4","ft4"],anti_tpo:["anti-tpo","thyroid peroxidase antibody"],vitamin_b12:["vitamin b12","cobalamin"],vitamin_d:["vitamin d","25-oh vitamin d","total vitamin d"],folate:["folate","folic acid"],testosterone:["testosterone","total testosterone"],estradiol:["estradiol","e2"],progesterone:["progesterone"],cortisol:["cortisol"],prolactin:["prolactin"],ferritin:["ferritin"],iron:["serum iron","iron"],tibc:["tibc","total iron binding capacity"],transferrin_saturation:["transferrin saturation","% saturation","transferrin sat"],crp:["crp","c-reactive protein"],hs_crp:["hs-crp","high sensitivity crp"],troponin_i:["troponin i"],troponin_t:["troponin t"],ck_total:["ck","cpk","creatine kinase"],ck_mb:["ck-mb"],amylase:["amylase","serum amylase"],lipase:["lipase","serum lipase"]},zg={hemoglobin:{min:13,max:17,unit:"g/dL",foods:["Spinach","Red Meat","Beetroot"],impact:{low:"Fatigue, low stamina. Focus on endurance cautiously.",high:"Dehydration risk. Hydrate well."}},rbc_count:{min:4.5,max:5.9,unit:"mil/L",foods:["Iron-rich foods","B12"],impact:{}},total_count:{min:4e3,max:11e3,unit:"/L",foods:["Vitamin C","Garlic"],impact:{low:"Low immunity. Avoid growing crowds/gyms.",high:"Body fighting infection. Rest."}},platelet_count:{min:1.5,max:4.5,unit:"Lakh/L",foods:["Papaya Leaf"],impact:{low:"Bleeding risk. Avoid contact sports."}},hematocrit:{min:38,max:50,unit:"%",foods:["Iron","Water"],impact:{}},mcv:{min:80,max:100,unit:"fL",foods:["B12","Folate"],impact:{low:"Microcytic anemia risk.",high:"Macrocytic (B12 deficiency) risk."}},mch:{min:27,max:33,unit:"pg",foods:[],impact:{}},mchc:{min:32,max:36,unit:"g/dL",foods:[],impact:{}},rdw:{min:11.5,max:14.5,unit:"%",foods:[],impact:{}},neutrophil:{min:40,max:75,unit:"%",foods:[],impact:{high:"Bacterial infection likely. Rest."}},lymphocyte:{min:20,max:45,unit:"%",foods:[],impact:{high:"Viral infection likely. Rest."}},monocyte:{min:2,max:10,unit:"%",foods:[],impact:{}},eosinophil:{min:1,max:6,unit:"%",foods:[],impact:{high:"Allergy or parasite. Monitor breathing."}},basophil:{min:0,max:1,unit:"%",foods:[],impact:{}},esr:{min:0,max:20,unit:"mm/hr",foods:["Anti-inflammatory","Turmeric"],impact:{high:"High Inflammation. Focus on recovery, light stretching."}},bun:{min:7,max:20,unit:"mg/dL",foods:["Low Protein","Water"],impact:{high:"Kidney load high. Hydrate."}},creatinine:{min:.6,max:1.3,unit:"mg/dL",foods:["Less Red Meat","Cucumber"],impact:{high:"Kidney stress. Avoid creatine supplements."}},uric_acid:{min:3.5,max:7.2,unit:"mg/dL",foods:["Cherries","No Alcohol"],impact:{high:"Gout risk. Avoid high-impact jumping."}},egfr:{min:90,max:150,unit:"mL/min",foods:[],impact:{low:"Kidney functionality concern. Consult doctor."}},bilirubin_total:{min:.3,max:1.2,unit:"mg/dL",foods:["Radish","Lemon"],impact:{high:"Jaundice risk. No heavy lifting."}},sgot:{min:10,max:40,unit:"U/L",foods:["Liver Detox"],impact:{high:"Liver/Muscle stress. Take rest days."}},sgpt:{min:7,max:56,unit:"U/L",foods:["Whole grains"],impact:{high:"Liver enzyme elevation. Avoid alcohol/painkillers."}},alkaline_phosphatase:{min:44,max:147,unit:"U/L",foods:[],impact:{}},total_protein:{min:6.3,max:8.2,unit:"g/dL",foods:["Lean Protein"],impact:{}},albumin:{min:3.5,max:5,unit:"g/dL",foods:[],impact:{}},sodium:{min:135,max:145,unit:"mmol/L",foods:["Balanced Salt"],impact:{low:"Hyponatremia risk. Salt intake needed.",high:"Dehydration."}},potassium:{min:3.5,max:5.1,unit:"mmol/L",foods:["Banana","Coconut Water"],impact:{low:"Cramp risk. Electrolytes needed.",high:"Heart rhythm risk. Medical attention."}},calcium:{min:8.5,max:10.5,unit:"mg/dL",foods:["Milk","Yogurt"],impact:{low:"Bone weakness. Resistance train carefully."}},magnesium:{min:1.7,max:2.4,unit:"mg/dL",foods:["Nuts","Seeds"],impact:{low:"Muscle twitching/cramps."}},glucose_fasting:{min:70,max:100,unit:"mg/dL",foods:["Fiber","Low GI"],impact:{high:"Diabetes risk. Cardio recommended."}},glucose_pp:{min:70,max:140,unit:"mg/dL",foods:["Vegetables"],impact:{high:"Insulin resistance."}},hba1c:{min:4,max:5.6,unit:"%",foods:["Low Carb"],impact:{high:"Long term sugar control poor."}},insulin:{min:2,max:25,unit:"IU/mL",foods:[],impact:{}},cholesterol:{min:0,max:200,unit:"mg/dL",foods:["Oats","Garlic"],impact:{high:"Cardiac risk. Steady state cardio."}},hdl_cholesterol:{min:40,max:100,unit:"mg/dL",foods:["Nuts","Fish"],impact:{low:"Good cholesterol low. Needs exercise."}},ldl_cholesterol:{min:0,max:100,unit:"mg/dL",foods:["Fiber"],impact:{high:"Bad cholesterol. Diet control needed."}},triglycerides:{min:0,max:150,unit:"mg/dL",foods:["No Sugar","Fish Oil"],impact:{high:"Metabolic syndrome risk."}},tsh:{min:.4,max:4,unit:"IU/mL",foods:[],impact:{high:"Hypothyroid (Slow metabolism).",low:"Hyperthyroid (Fast HR)."}},t3:{min:80,max:200,unit:"ng/dL",foods:[],impact:{}},t4:{min:5,max:12,unit:"g/dL",foods:[],impact:{}},vitamin_b12:{min:200,max:900,unit:"pg/mL",foods:["Meat","Eggs","Supplements"],impact:{low:"Nerve health/Energy low."}},vitamin_d:{min:30,max:100,unit:"ng/mL",foods:["Sunlight","Mushrooms","Supplements"],impact:{low:"Bone density/Immunity risk."}},testosterone:{min:300,max:1e3,unit:"ng/dL",foods:["Zinc","Strength Training"],impact:{low:"Muscle loss, fatigue."}},cortisol:{min:5,max:25,unit:"g/dL",foods:["Ashwagandha","Sleep"],impact:{high:"High stress. Reduce intensity."}},ferritin:{min:20,max:300,unit:"ng/mL",foods:[],impact:{low:"Iron stores low."}},iron:{min:60,max:170,unit:"g/dL",foods:["Spinach"],impact:{low:"Anemia."}},crp:{min:0,max:10,unit:"mg/L",foods:["Anti-inflammatory"],impact:{high:"Systemic inflammation."}},hs_crp:{min:0,max:1,unit:"mg/L",foods:[],impact:{high:"Cardiac risk marker."}},troponin_i:{min:0,max:.04,unit:"ng/mL",foods:[],impact:{high:"CRITICAL: Heart muscle damage. ER immediately."}},ck_total:{min:20,max:200,unit:"U/L",foods:[],impact:{high:"Muscle breakdown (could be hard training or rhabdo)."}},mpv:{min:7,max:11,unit:"fL",foods:[],impact:{}},pdw:{min:9,max:17,unit:"fL",foods:[],impact:{}},pct:{min:.1,max:.4,unit:"%",foods:[],impact:{}},absolute_neutrophil_count:{min:1500,max:8e3,unit:"/L",foods:[],impact:{low:"Neutropenia. Low immunity."}},absolute_lymphocyte_count:{min:1e3,max:4800,unit:"/L",foods:[],impact:{}},absolute_monocyte_count:{min:200,max:950,unit:"/L",foods:[],impact:{}},absolute_eosinophil_count:{min:0,max:500,unit:"/L",foods:[],impact:{high:"Allergy/Parasite."}},transferrin_saturation:{min:20,max:50,unit:"%",foods:[],impact:{low:"Iron deficiency."}},amylase:{min:30,max:110,unit:"U/L",foods:[],impact:{high:"Pancreas inflammation (Pancreatitis)."}},lipase:{min:0,max:160,unit:"U/L",foods:[],impact:{high:"Pancreas damage."}},urine_pus_cells:{min:0,max:5,unit:"/hpf",foods:["Cranberry"],impact:{high:"Urinary Tract Infection (UTI)."}},urine_rbc:{min:0,max:3,unit:"/hpf",foods:[],impact:{high:"Blood in urine. Consult urologist."}}},Iz=n=>{const e=[];return Object.keys(n).forEach(t=>{const i=parseFloat(n[t]);!zg[t]||isNaN(i)||(t==="hemoglobin"&&i<11&&e.push({condition:"Anemia",risk:"High",color:"#ef4444",advice:"Consult doctor for iron supplements."}),t==="glucose_fasting"&&i>126||t==="hba1c"&&i>6.5?e.push({condition:"Diabetes",risk:"High",color:"#ef4444",advice:"Manage sugar intake strictly."}):(t==="glucose_fasting"&&i>100||t==="hba1c">5.7)&&e.push({condition:"Pre-Diabetes",risk:"Medium",color:"#f59e0b",advice:"Lifestyle changes needed."}),t==="creatinine"&&i>1.4&&e.push({condition:"Renal Insufficiency Risk",risk:"High",color:"#ef4444",advice:"Kidney function concern."}),t==="troponin_i"&&i>.04&&e.push({condition:"Myocardial Injury Risk",risk:"CRITICAL",color:"#b91c1c",advice:"Seek immediate medical attention."}),t==="hs_crp"&&i>3&&e.push({condition:"High Cardiovascular Risk",risk:"High",color:"#ef4444",advice:"Inflammation marker high."}),t==="vitamin_d"&&i<20&&e.push({condition:"Vitamin D Deficiency",risk:"Medium",color:"#f59e0b",advice:"Supplementation recommended."}),t==="tsh"&&i>5&&e.push({condition:"Hypothyroidism Risk",risk:"Medium",color:"#f59e0b",advice:"Metabolism might be slow."}))}),e},Cz=(n,e=[])=>{const t=[],i=[];Object.keys(n).forEach(s=>{var c,h;const a=parseFloat(n[s]),o=zg[s];if(!o)return;let l="Normal";a<o.min&&(l="Low"),a>o.max&&(l="High");const u=l==="Low"?(c=o.impact)==null?void 0:c.low:l==="High"?(h=o.impact)==null?void 0:h.high:null;l!=="Normal"&&i.push({parameter:s,status:l,foods:o.foods,fitnessImpact:u}),t.push({parameter:s,value:a,unit:o.unit,range:`${o.min}-${o.max}`,status:l,fitnessImpact:u})});const r=e.length>0?e:Iz(n);return{date:new Date().toLocaleDateString(),values:n,results:t,suggestions:i,risks:r}};/*!
 * ONNX Runtime Web v1.23.2
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */var iC=Object.defineProperty,gJ=Object.getOwnPropertyDescriptor,yJ=Object.getOwnPropertyNames,_J=Object.prototype.hasOwnProperty,vJ=(n=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):n)(function(n){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+n+'" is not supported')}),fe=(n,e)=>()=>(n&&(e=n(n=0)),e),Wp=(n,e)=>{for(var t in e)iC(n,t,{get:e[t],enumerable:!0})},wJ=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of yJ(e))!_J.call(n,r)&&r!==t&&iC(n,r,{get:()=>e[r],enumerable:!(i=gJ(e,r))||i.enumerable});return n},_y=n=>wJ(iC({},"__esModule",{value:!0}),n),$m,cl,Gh,bP,kz,$z=fe(()=>{$m=new Map,cl=[],Gh=(n,e,t)=>{if(e&&typeof e.init=="function"&&typeof e.createInferenceSessionHandler=="function"){let i=$m.get(n);if(i===void 0)$m.set(n,{backend:e,priority:t});else{if(i.priority>t)return;if(i.priority===t&&i.backend!==e)throw new Error(`cannot register backend "${n}" using priority ${t}`)}if(t>=0){let r=cl.indexOf(n);r!==-1&&cl.splice(r,1);for(let s=0;s<cl.length;s++)if($m.get(cl[s]).priority<=t){cl.splice(s,0,n);return}cl.push(n)}return}throw new TypeError("not a valid backend")},bP=async n=>{let e=$m.get(n);if(!e)return"backend not found.";if(e.initialized)return e.backend;if(e.aborted)return e.error;{let t=!!e.initPromise;try{return t||(e.initPromise=e.backend.init(n)),await e.initPromise,e.initialized=!0,e.backend}catch(i){return t||(e.error=`${i}`,e.aborted=!0),e.error}finally{delete e.initPromise}}},kz=async n=>{let e=n.executionProviders||[],t=e.map(l=>typeof l=="string"?l:l.name),i=t.length===0?cl:t,r,s=[],a=new Set;for(let l of i){let u=await bP(l);typeof u=="string"?s.push({name:l,err:u}):(r||(r=u),r===u&&a.add(l))}if(!r)throw new Error(`no available backend found. ERR: ${s.map(l=>`[${l.name}] ${l.err}`).join(", ")}`);for(let{name:l,err:u}of s)t.includes(l)&&console.warn(`removing requested execution provider "${l}" from session options because it is not available: ${u}`);let o=e.filter(l=>a.has(typeof l=="string"?l:l.name));return[r,new Proxy(n,{get:(l,u)=>u==="executionProviders"?o:Reflect.get(l,u)})]}}),bJ=fe(()=>{$z()}),Rz,xJ=fe(()=>{Rz="1.23.2"}),uE,Dn,Pz=fe(()=>{xJ(),uE="warning",Dn={wasm:{},webgl:{},webgpu:{},versions:{common:Rz},set logLevel(n){if(n!==void 0){if(typeof n!="string"||["verbose","info","warning","error","fatal"].indexOf(n)===-1)throw new Error(`Unsupported logging level: ${n}`);uE=n}},get logLevel(){return uE}},Object.defineProperty(Dn,"logLevel",{enumerable:!0})}),Nt,EJ=fe(()=>{Pz(),Nt=Dn}),Nz,Dz,AJ=fe(()=>{Nz=(n,e)=>{let t=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);t.width=n.dims[3],t.height=n.dims[2];let i=t.getContext("2d");if(i!=null){let r,s;(e==null?void 0:e.tensorLayout)!==void 0&&e.tensorLayout==="NHWC"?(r=n.dims[2],s=n.dims[3]):(r=n.dims[3],s=n.dims[2]);let a=(e==null?void 0:e.format)!==void 0?e.format:"RGB",o=e==null?void 0:e.norm,l,u;o===void 0||o.mean===void 0?l=[255,255,255,255]:typeof o.mean=="number"?l=[o.mean,o.mean,o.mean,o.mean]:(l=[o.mean[0],o.mean[1],o.mean[2],0],o.mean[3]!==void 0&&(l[3]=o.mean[3])),o===void 0||o.bias===void 0?u=[0,0,0,0]:typeof o.bias=="number"?u=[o.bias,o.bias,o.bias,o.bias]:(u=[o.bias[0],o.bias[1],o.bias[2],0],o.bias[3]!==void 0&&(u[3]=o.bias[3]));let c=s*r,h=0,f=c,m=c*2,y=-1;a==="RGBA"?(h=0,f=c,m=c*2,y=c*3):a==="RGB"?(h=0,f=c,m=c*2):a==="RBG"&&(h=0,m=c,f=c*2);for(let _=0;_<s;_++)for(let x=0;x<r;x++){let v=(n.data[h++]-u[0])*l[0],w=(n.data[f++]-u[1])*l[1],E=(n.data[m++]-u[2])*l[2],C=y===-1?255:(n.data[y++]-u[3])*l[3];i.fillStyle="rgba("+v+","+w+","+E+","+C+")",i.fillRect(x,_,1,1)}if("toDataURL"in t)return t.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},Dz=(n,e)=>{let t=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),i;if(t!=null){let r,s,a;(e==null?void 0:e.tensorLayout)!==void 0&&e.tensorLayout==="NHWC"?(r=n.dims[2],s=n.dims[1],a=n.dims[3]):(r=n.dims[3],s=n.dims[2],a=n.dims[1]);let o=e!==void 0&&e.format!==void 0?e.format:"RGB",l=e==null?void 0:e.norm,u,c;l===void 0||l.mean===void 0?u=[255,255,255,255]:typeof l.mean=="number"?u=[l.mean,l.mean,l.mean,l.mean]:(u=[l.mean[0],l.mean[1],l.mean[2],255],l.mean[3]!==void 0&&(u[3]=l.mean[3])),l===void 0||l.bias===void 0?c=[0,0,0,0]:typeof l.bias=="number"?c=[l.bias,l.bias,l.bias,l.bias]:(c=[l.bias[0],l.bias[1],l.bias[2],0],l.bias[3]!==void 0&&(c[3]=l.bias[3]));let h=s*r;if(e!==void 0&&(e.format!==void 0&&a===4&&e.format!=="RGBA"||a===3&&e.format!=="RGB"&&e.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let f=4,m=0,y=1,_=2,x=3,v=0,w=h,E=h*2,C=-1;o==="RGBA"?(v=0,w=h,E=h*2,C=h*3):o==="RGB"?(v=0,w=h,E=h*2):o==="RBG"&&(v=0,E=h,w=h*2),i=t.createImageData(r,s);for(let D=0;D<s*r;m+=f,y+=f,_+=f,x+=f,D++)i.data[m]=(n.data[v++]-c[0])*u[0],i.data[y]=(n.data[w++]-c[1])*u[1],i.data[_]=(n.data[E++]-c[2])*u[2],i.data[x]=C===-1?255:(n.data[C++]-c[3])*u[3]}else throw new Error("Can not access image data");return i}}),bw,Mz,Oz,Lz,Fz,zz,TJ=fe(()=>{rC(),bw=(n,e)=>{if(n===void 0)throw new Error("Image buffer must be defined");if(e.height===void 0||e.width===void 0)throw new Error("Image height and width must be defined");if(e.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:t,width:i}=e,r=e.norm??{mean:255,bias:0},s,a;typeof r.mean=="number"?s=[r.mean,r.mean,r.mean,r.mean]:s=[r.mean[0],r.mean[1],r.mean[2],r.mean[3]??255],typeof r.bias=="number"?a=[r.bias,r.bias,r.bias,r.bias]:a=[r.bias[0],r.bias[1],r.bias[2],r.bias[3]??0];let o=e.format!==void 0?e.format:"RGBA",l=e.tensorFormat!==void 0&&e.tensorFormat!==void 0?e.tensorFormat:"RGB",u=t*i,c=l==="RGBA"?new Float32Array(u*4):new Float32Array(u*3),h=4,f=0,m=1,y=2,_=3,x=0,v=u,w=u*2,E=-1;o==="RGB"&&(h=3,f=0,m=1,y=2,_=-1),l==="RGBA"?E=u*3:l==="RBG"?(x=0,w=u,v=u*2):l==="BGR"&&(w=0,v=u,x=u*2);for(let C=0;C<u;C++,f+=h,y+=h,m+=h,_+=h)c[x++]=(n[f]+a[0])/s[0],c[v++]=(n[m]+a[1])/s[1],c[w++]=(n[y]+a[2])/s[2],E!==-1&&_!==-1&&(c[E++]=(n[_]+a[3])/s[3]);return l==="RGBA"?new xr("float32",c,[1,4,t,i]):new xr("float32",c,[1,3,t,i])},Mz=async(n,e)=>{let t=typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement,i=typeof ImageData<"u"&&n instanceof ImageData,r=typeof ImageBitmap<"u"&&n instanceof ImageBitmap,s=typeof n=="string",a,o=e??{},l=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},u=c=>typeof HTMLCanvasElement<"u"&&c instanceof HTMLCanvasElement||c instanceof OffscreenCanvas?c.getContext("2d"):null;if(t){let c=l();c.width=n.width,c.height=n.height;let h=u(c);if(h!=null){let f=n.height,m=n.width;if(e!==void 0&&e.resizedHeight!==void 0&&e.resizedWidth!==void 0&&(f=e.resizedHeight,m=e.resizedWidth),e!==void 0){if(o=e,e.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");o.tensorFormat="RGBA",o.height=f,o.width=m}else o.tensorFormat="RGBA",o.height=f,o.width=m;h.drawImage(n,0,0),a=h.getImageData(0,0,m,f).data}else throw new Error("Can not access image data")}else if(i){let c,h;if(e!==void 0&&e.resizedWidth!==void 0&&e.resizedHeight!==void 0?(c=e.resizedHeight,h=e.resizedWidth):(c=n.height,h=n.width),e!==void 0&&(o=e),o.format="RGBA",o.height=c,o.width=h,e!==void 0){let f=l();f.width=h,f.height=c;let m=u(f);if(m!=null)m.putImageData(n,0,0),a=m.getImageData(0,0,h,c).data;else throw new Error("Can not access image data")}else a=n.data}else if(r){if(e===void 0)throw new Error("Please provide image config with format for Imagebitmap");let c=l();c.width=n.width,c.height=n.height;let h=u(c);if(h!=null){let f=n.height,m=n.width;return h.drawImage(n,0,0,m,f),a=h.getImageData(0,0,m,f).data,o.height=f,o.width=m,bw(a,o)}else throw new Error("Can not access image data")}else{if(s)return new Promise((c,h)=>{let f=l(),m=u(f);if(!n||!m)return h();let y=new Image;y.crossOrigin="Anonymous",y.src=n,y.onload=()=>{f.width=y.width,f.height=y.height,m.drawImage(y,0,0,f.width,f.height);let _=m.getImageData(0,0,f.width,f.height);o.height=f.height,o.width=f.width,c(bw(_.data,o))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(a!==void 0)return bw(a,o);throw new Error("Input data provided is not supported - aborted tensor creation")},Oz=(n,e)=>{let{width:t,height:i,download:r,dispose:s}=e,a=[1,i,t,4];return new xr({location:"texture",type:"float32",texture:n,dims:a,download:r,dispose:s})},Lz=(n,e)=>{let{dataType:t,dims:i,download:r,dispose:s}=e;return new xr({location:"gpu-buffer",type:t??"float32",gpuBuffer:n,dims:i,download:r,dispose:s})},Fz=(n,e)=>{let{dataType:t,dims:i,download:r,dispose:s}=e;return new xr({location:"ml-tensor",type:t??"float32",mlTensor:n,dims:i,download:r,dispose:s})},zz=(n,e,t)=>new xr({location:"cpu-pinned",type:n,data:e,dims:t??[e.length]})}),hc,ig,cE,Vz,SJ=fe(()=>{hc=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),ig=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),cE=!1,Vz=()=>{if(!cE){cE=!0;let n=typeof BigInt64Array<"u"&&BigInt64Array.from,e=typeof BigUint64Array<"u"&&BigUint64Array.from,t=globalThis.Float16Array,i=typeof t<"u"&&t.from;n&&(hc.set("int64",BigInt64Array),ig.set(BigInt64Array,"int64")),e&&(hc.set("uint64",BigUint64Array),ig.set(BigUint64Array,"uint64")),i?(hc.set("float16",t),ig.set(t,"float16")):hc.set("float16",Uint16Array)}}}),jz,Bz,IJ=fe(()=>{rC(),jz=n=>{let e=1;for(let t=0;t<n.length;t++){let i=n[t];if(typeof i!="number"||!Number.isSafeInteger(i))throw new TypeError(`dims[${t}] must be an integer, got: ${i}`);if(i<0)throw new RangeError(`dims[${t}] must be a non-negative integer, got: ${i}`);e*=i}return e},Bz=(n,e)=>{switch(n.location){case"cpu":return new xr(n.type,n.data,e);case"cpu-pinned":return new xr({location:"cpu-pinned",data:n.data,type:n.type,dims:e});case"texture":return new xr({location:"texture",texture:n.texture,type:n.type,dims:e});case"gpu-buffer":return new xr({location:"gpu-buffer",gpuBuffer:n.gpuBuffer,type:n.type,dims:e});case"ml-tensor":return new xr({location:"ml-tensor",mlTensor:n.mlTensor,type:n.type,dims:e});default:throw new Error(`tensorReshape: tensor location ${n.location} is not supported`)}}}),xr,rC=fe(()=>{AJ(),TJ(),SJ(),IJ(),xr=class{constructor(n,e,t){Vz();let i,r;if(typeof n=="object"&&"location"in n)switch(this.dataLocation=n.location,i=n.type,r=n.dims,n.location){case"cpu-pinned":{let a=hc.get(i);if(!a)throw new TypeError(`unsupported type "${i}" to create tensor from pinned buffer`);if(!(n.data instanceof a))throw new TypeError(`buffer should be of type ${a.name}`);this.cpuData=n.data;break}case"texture":{if(i!=="float32")throw new TypeError(`unsupported type "${i}" to create tensor from texture`);this.gpuTextureData=n.texture,this.downloader=n.download,this.disposer=n.dispose;break}case"gpu-buffer":{if(i!=="float32"&&i!=="float16"&&i!=="int32"&&i!=="int64"&&i!=="uint32"&&i!=="uint8"&&i!=="bool"&&i!=="uint4"&&i!=="int4")throw new TypeError(`unsupported type "${i}" to create tensor from gpu buffer`);this.gpuBufferData=n.gpuBuffer,this.downloader=n.download,this.disposer=n.dispose;break}case"ml-tensor":{if(i!=="float32"&&i!=="float16"&&i!=="int32"&&i!=="int64"&&i!=="uint32"&&i!=="uint64"&&i!=="int8"&&i!=="uint8"&&i!=="bool"&&i!=="uint4"&&i!=="int4")throw new TypeError(`unsupported type "${i}" to create tensor from MLTensor`);this.mlTensorData=n.mlTensor,this.downloader=n.download,this.disposer=n.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let a,o;if(typeof n=="string")if(i=n,o=t,n==="string"){if(!Array.isArray(e))throw new TypeError("A string tensor's data must be a string array.");a=e}else{let l=hc.get(n);if(l===void 0)throw new TypeError(`Unsupported tensor type: ${n}.`);if(Array.isArray(e)){if(n==="float16"&&l===Uint16Array||n==="uint4"||n==="int4")throw new TypeError(`Creating a ${n} tensor from number array is not supported. Please use ${l.name} as data.`);n==="uint64"||n==="int64"?a=l.from(e,BigInt):a=l.from(e)}else if(e instanceof l)a=e;else if(e instanceof Uint8ClampedArray)if(n==="uint8")a=Uint8Array.from(e);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(n==="float16"&&e instanceof Uint16Array&&l!==Uint16Array)a=new globalThis.Float16Array(e.buffer,e.byteOffset,e.length);else throw new TypeError(`A ${i} tensor's data must be type of ${l}`)}else if(o=e,Array.isArray(n)){if(n.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let l=typeof n[0];if(l==="string")i="string",a=n;else if(l==="boolean")i="bool",a=Uint8Array.from(n);else throw new TypeError(`Invalid element type of data array: ${l}.`)}else if(n instanceof Uint8ClampedArray)i="uint8",a=Uint8Array.from(n);else{let l=ig.get(n.constructor);if(l===void 0)throw new TypeError(`Unsupported type for tensor data: ${n.constructor}.`);i=l,a=n}if(o===void 0)o=[a.length];else if(!Array.isArray(o))throw new TypeError("A tensor's dims must be a number array");r=o,this.cpuData=a,this.dataLocation="cpu"}let s=jz(r);if(this.cpuData&&s!==this.cpuData.length&&!((i==="uint4"||i==="int4")&&Math.ceil(s/2)===this.cpuData.length))throw new Error(`Tensor's size(${s}) does not match data length(${this.cpuData.length}).`);this.type=i,this.dims=r,this.size=s}static async fromImage(n,e){return Mz(n,e)}static fromTexture(n,e){return Oz(n,e)}static fromGpuBuffer(n,e){return Lz(n,e)}static fromMLTensor(n,e){return Fz(n,e)}static fromPinnedBuffer(n,e,t){return zz(n,e,t)}toDataURL(n){return Nz(this,n)}toImageData(n){return Dz(this,n)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(n){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let e=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=e,n&&this.disposer&&(this.disposer(),this.disposer=void 0),e}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(n){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return Bz(this,n)}}}),Ds,Uz=fe(()=>{rC(),Ds=xr}),$b,dE,Va,Bs,Cd,kd,Hz=fe(()=>{Pz(),$b=(n,e)=>{(typeof Dn.trace>"u"?!Dn.wasm.trace:!Dn.trace)||console.timeStamp(`${n}::ORT::${e}`)},dE=(n,e)=>{var r;let t=((r=new Error().stack)==null?void 0:r.split(/\r\n|\r|\n/g))||[],i=!1;for(let s=0;s<t.length;s++){if(i&&!t[s].includes("TRACE_FUNC")){let a=`FUNC_${n}::${t[s].trim().split(" ")[1]}`;e&&(a+=`::${e}`),$b("CPU",a);return}t[s].includes("TRACE_FUNC")&&(i=!0)}},Va=n=>{(typeof Dn.trace>"u"?!Dn.wasm.trace:!Dn.trace)||dE("BEGIN",n)},Bs=n=>{(typeof Dn.trace>"u"?!Dn.wasm.trace:!Dn.trace)||dE("END",n)},Cd=n=>{(typeof Dn.trace>"u"?!Dn.wasm.trace:!Dn.trace)||console.time(`ORT::${n}`)},kd=n=>{(typeof Dn.trace>"u"?!Dn.wasm.trace:!Dn.trace)||console.timeEnd(`ORT::${n}`)}}),Wz,CJ=fe(()=>{$z(),Uz(),Hz(),Wz=class qz{constructor(e){this.handler=e}async run(e,t,i){Va(),Cd("InferenceSession.run");let r={},s={};if(typeof e!="object"||e===null||e instanceof Ds||Array.isArray(e))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let a=!0;if(typeof t=="object"){if(t===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(t instanceof Ds)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(t)){if(t.length===0)throw new TypeError("'fetches' cannot be an empty array.");a=!1;for(let u of t){if(typeof u!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(u)===-1)throw new RangeError(`'fetches' contains invalid output name: ${u}.`);r[u]=null}if(typeof i=="object"&&i!==null)s=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else{let u=!1,c=Object.getOwnPropertyNames(t);for(let h of this.outputNames)if(c.indexOf(h)!==-1){let f=t[h];(f===null||f instanceof Ds)&&(u=!0,a=!1,r[h]=f)}if(u){if(typeof i=="object"&&i!==null)s=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else s=t}}else if(typeof t<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let u of this.inputNames)if(typeof e[u]>"u")throw new Error(`input '${u}' is missing in 'feeds'.`);if(a)for(let u of this.outputNames)r[u]=null;let o=await this.handler.run(e,r,s),l={};for(let u in o)if(Object.hasOwnProperty.call(o,u)){let c=o[u];c instanceof Ds?l[u]=c:l[u]=new Ds(c.type,c.data,c.dims)}return kd("InferenceSession.run"),Bs(),l}async release(){return this.handler.dispose()}static async create(e,t,i,r){Va(),Cd("InferenceSession.create");let s,a={};if(typeof e=="string"){if(s=e,typeof t=="object"&&t!==null)a=t;else if(typeof t<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof Uint8Array){if(s=e,typeof t=="object"&&t!==null)a=t;else if(typeof t<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer){let c=e,h=0,f=e.byteLength;if(typeof t=="object"&&t!==null)a=t;else if(typeof t=="number"){if(h=t,!Number.isSafeInteger(h))throw new RangeError("'byteOffset' must be an integer.");if(h<0||h>=c.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${c.byteLength}).`);if(f=e.byteLength-h,typeof i=="number"){if(f=i,!Number.isSafeInteger(f))throw new RangeError("'byteLength' must be an integer.");if(f<=0||h+f>c.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${c.byteLength-h}].`);if(typeof r=="object"&&r!==null)a=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(typeof i<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof t<"u")throw new TypeError("'options' must be an object.");s=new Uint8Array(c,h,f)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[o,l]=await kz(a),u=await o.createInferenceSessionHandler(s,l);return kd("InferenceSession.create"),Bs(),new qz(u)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),sC,kJ=fe(()=>{CJ(),sC=Wz}),$J=fe(()=>{}),RJ=fe(()=>{}),PJ=fe(()=>{}),NJ=fe(()=>{}),DJ={};Wp(DJ,{InferenceSession:()=>sC,TRACE:()=>$b,TRACE_EVENT_BEGIN:()=>Cd,TRACE_EVENT_END:()=>kd,TRACE_FUNC_BEGIN:()=>Va,TRACE_FUNC_END:()=>Bs,Tensor:()=>Ds,env:()=>Nt,registerBackend:()=>Gh});var ts=fe(()=>{bJ(),EJ(),kJ(),Uz(),$J(),RJ(),Hz(),PJ(),NJ()}),aC=fe(()=>{}),Gz={};Wp(Gz,{default:()=>Kz});var hE,fE,Kz,MJ=fe(()=>{var n;ZB(),ih(),oC(),hE="ort-wasm-proxy-worker",fE=((n=globalThis.self)==null?void 0:n.name)===hE,fE&&(self.onmessage=e=>{let{type:t,in:i}=e.data;try{switch(t){case"init-wasm":lC(i.wasm).then(()=>{TC(i).then(()=>{postMessage({type:t})},r=>{postMessage({type:t,err:r})})},r=>{postMessage({type:t,err:r})});break;case"init-ep":{let{epName:r,env:s}=i;SC(s,r).then(()=>{postMessage({type:t})},a=>{postMessage({type:t,err:a})});break}case"copy-from":{let{buffer:r}=i,s=Lb(r);postMessage({type:t,out:s});break}case"create":{let{model:r,options:s}=i;IC(r,s).then(a=>{postMessage({type:t,out:a})},a=>{postMessage({type:t,err:a})});break}case"release":CC(i),postMessage({type:t});break;case"run":{let{sessionId:r,inputIndices:s,inputs:a,outputIndices:o,options:l}=i;kC(r,s,a,o,new Array(o.length).fill(null),l).then(u=>{u.some(c=>c[3]!=="cpu")?postMessage({type:t,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:t,out:u},RC([...a,...u]))},u=>{postMessage({type:t,err:u})});break}case"end-profiling":$C(i),postMessage({type:t});break;default:}}catch(r){postMessage({type:t,err:r})}}),Kz=fE?null:e=>new Worker(e??or,{type:"module",name:hE})}),Yz={};Wp(Yz,{default:()=>Xz});var pE,Xz,xP,OJ=fe(()=>{var n,e;pE=async function(t={}){var gk;var i,r,s=t,a=new Promise((g,b)=>{i=g,r=b}),o=typeof window=="object",l=typeof WorkerGlobalScope<"u",u=l&&((gk=self.name)==null?void 0:gk.startsWith("em-pthread"));s.mountExternalData=(g,b)=>{g.startsWith("./")&&(g=g.substring(2)),(s.Fb||(s.Fb=new Map)).set(g,b)},s.unmountExternalData=()=>{delete s.Fb};var c=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,qc:!0}).buffer.constructor;let h=g=>async(...b)=>{var T;try{if(s.Gb)throw Error("Session already started");let $=s.Gb={ec:b[0],errors:[]},O=await g(...b);if(s.Gb!==$)throw Error("Session mismatch");(T=s.Kb)==null||T.flush();let W=$.errors;if(0<W.length){let X=await Promise.all(W);if(X=X.filter(ne=>ne),0<X.length)throw Error(X.join(`
`))}return O}finally{s.Gb=null}};s.jsepInit=(g,b)=>{if(g==="webgpu"){[s.Kb,s.Vb,s.Zb,s.Lb,s.Yb,s.Ab,s.$b,s.bc,s.Wb,s.Xb,s.ac]=b;let T=s.Kb;s.jsepRegisterBuffer=($,O,W,X)=>T.registerBuffer($,O,W,X),s.jsepGetBuffer=$=>T.getBuffer($),s.jsepCreateDownloader=($,O,W)=>T.createDownloader($,O,W),s.jsepOnCreateSession=$=>{T.onCreateSession($)},s.jsepOnReleaseSession=$=>{T.onReleaseSession($)},s.jsepOnRunStart=$=>T.onRunStart($),s.cc=($,O)=>{T.upload($,O)}}else if(g==="webnn"){let T=b[0];[s.oc,s.Ob,s.webnnEnsureTensor,s.Pb,s.webnnDownloadTensor,s.nc,s.webnnEnableTraceEvent]=b.slice(1),s.webnnReleaseTensorId=s.Ob,s.webnnUploadTensor=s.Pb,s.webnnRegisterMLContext=s.nc,s.webnnOnRunStart=$=>T.onRunStart($),s.webnnOnRunEnd=T.onRunEnd.bind(T),s.webnnOnReleaseSession=$=>{T.onReleaseSession($)},s.webnnCreateMLTensorDownloader=($,O)=>T.createMLTensorDownloader($,O),s.webnnRegisterMLTensor=($,O,W,X)=>T.registerMLTensor($,O,W,X),s.webnnCreateMLContext=$=>T.createMLContext($),s.webnnRegisterMLConstant=($,O,W,X,ne,de)=>T.registerMLConstant($,O,W,X,ne,s.Fb,de),s.webnnRegisterGraphInput=T.registerGraphInput.bind(T),s.webnnIsGraphInput=T.isGraphInput.bind(T),s.webnnRegisterGraphOutput=T.registerGraphOutput.bind(T),s.webnnIsGraphOutput=T.isGraphOutput.bind(T),s.webnnCreateTemporaryTensor=T.createTemporaryTensor.bind(T),s.webnnIsGraphInputOutputTypeSupported=T.isGraphInputOutputTypeSupported.bind(T)}};let f=()=>{let g=(b,T,$)=>(...O)=>{let W=ji,X=T==null?void 0:T();O=b(...O);let ne=T==null?void 0:T();return X!==ne&&(b=ne,$(X),T=$=null),ji!=W?new Promise((de,pe)=>{Yu={resolve:de,reject:pe}}):O};(()=>{for(let b of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])s[b]=g(s[b],()=>s[b],T=>s[b]=T)})(),h!==void 0&&(s._OrtRun=h(s._OrtRun),s._OrtRunWithBinding=h(s._OrtRunWithBinding)),f=void 0};s.asyncInit=()=>{f==null||f()};var m,y,_=(g,b)=>{throw b},x=import.meta.url,v="";if(o||l){try{v=new URL(".",x).href}catch{}l&&(y=g=>{var b=new XMLHttpRequest;return b.open("GET",g,!1),b.responseType="arraybuffer",b.send(null),new Uint8Array(b.response)}),m=async g=>{if(Y(g))return new Promise((T,$)=>{var O=new XMLHttpRequest;O.open("GET",g,!0),O.responseType="arraybuffer",O.onload=()=>{O.status==200||O.status==0&&O.response?T(O.response):$(O.status)},O.onerror=$,O.send(null)});var b=await fetch(g,{credentials:"same-origin"});if(b.ok)return b.arrayBuffer();throw Error(b.status+" : "+b.url)}}var w,E,C,D,V,I,k,N,L,j,H,M,se,ue,ee,ae=console.log.bind(console),J=console.error.bind(console),q=ae,G=J,U=!1,Y=g=>g.startsWith("file://");function K(){return E.buffer!=V.buffer&&at(),V}function Z(){return E.buffer!=V.buffer&&at(),I}function ge(){return E.buffer!=V.buffer&&at(),k}function ve(){return E.buffer!=V.buffer&&at(),N}function Q(){return E.buffer!=V.buffer&&at(),L}function be(){return E.buffer!=V.buffer&&at(),j}function vt(){return E.buffer!=V.buffer&&at(),H}function mt(){return E.buffer!=V.buffer&&at(),ue}if(u){let g=function(b){try{var T=b.data,$=T.Db;if($==="load"){let O=[];self.onmessage=W=>O.push(W),self.startWorker=()=>{postMessage({Db:"loaded"});for(let W of O)g(W);self.onmessage=g};for(let W of T.Sb)s[W]&&!s[W].proxy||(s[W]=(...X)=>{postMessage({Db:"callHandler",Rb:W,args:X})},W=="print"&&(q=s[W]),W=="printErr"&&(G=s[W]));E=T.kc,at(),ee(T.lc)}else if($==="run"){pv(T.Bb),gx(T.Bb,0,0,1,0,0),lh(),um(T.Bb),nn||(rk(),nn=!0);try{ch(T.hc,T.Jb)}catch(O){if(O!="unwind")throw O}}else T.target!=="setimmediate"&&($==="checkMailbox"?nn&&Js():$&&(G(`worker: received unknown command ${$}`),G(T)))}catch(O){throw sk(),O}};var nn=!1;self.onunhandledrejection=b=>{throw b.reason||b},self.onmessage=g}function at(){var g=E.buffer;s.HEAP8=V=new Int8Array(g),k=new Int16Array(g),s.HEAPU8=I=new Uint8Array(g),N=new Uint16Array(g),s.HEAP32=L=new Int32Array(g),s.HEAPU32=j=new Uint32Array(g),H=new Float32Array(g),ue=new Float64Array(g),M=new BigInt64Array(g),se=new BigUint64Array(g)}function Tt(){u?startWorker(s):oe.Da()}var ii,Ha=0,ns=null;function ah(){if(--Ha==0&&ns){var g=ns;ns=null,g()}}function is(g){throw G(g="Aborted("+g+")"),U=!0,g=new WebAssembly.RuntimeError(g+". Build with -sASSERTIONS for more info."),r(g),g}function wn(){return{a:{L:p5,Aa:f5,b:Vu,$:Pn,A:gv,pa:yv,X:Wa,Z:_v,qa:vv,na:ju,ga:Jp,ma:Zp,J:dh,Y:il,V:wv,oa:rs,W:em,va:nm,E:bv,Q:Uu,O:am,D:Ev,v:Av,s:rx,P:Hu,z:Tv,R:ax,ja:ox,T:Ga,aa:Sv,M:Iv,F:Cv,ia:um,sa:kv,r:lx,Ca:ux,w:cx,o:Nv,m:ea,c:rm,Ba:Mv,n:Qu,j:gh,u:Fv,p:yh,f:dx,t:zv,l:Ju,e:Vv,k:jv,h:dm,g:hm,d:Bv,da:_h,ea:Uv,fa:Hv,ba:mm,ca:gm,N:ym,xa:Wv,ua:p,i:B,C:te,G:re,ta:ol,x:ye,ra:Ge,U:rn,q:Ai,y:bt,K:dn,S:Mr,za:vh,ya:_m,ka:XC,la:QC,_:Fu,B:JC,I:ZC,ha:ek,H:tk,a:E,wa:oh}}}class bn{constructor(b){Le(this,"name","ExitStatus");this.message=`Program terminated with exit(${b})`,this.status=b}}var Lu=g=>{g.terminate(),g.onmessage=()=>{}},qp=[],Gp=g=>{Ys.length==0&&(Qs(),uh(Ys[0]));var b=Ys.pop();if(!b)return 6;zu.push(b),Xs[g.Bb]=b,b.Bb=g.Bb;var T={Db:"run",hc:g.fc,Jb:g.Jb,Bb:g.Bb};return b.postMessage(T,g.Nb),0},Ks=0,gt=(g,b,...T)=>{for(var $=2*T.length,O=vx(),W=_x(8*$),X=W>>>3,ne=0;ne<T.length;ne++){var de=T[ne];typeof de=="bigint"?(M[X+2*ne]=1n,M[X+2*ne+1]=de):(M[X+2*ne]=0n,mt()[X+2*ne+1>>>0]=de)}return g=ak(g,0,$,W,b),Kv(O),g};function oh(g){if(u)return gt(0,1,g);if(D=g,!(0<Ks)){for(var b of zu)Lu(b);for(b of Ys)Lu(b);Ys=[],zu=[],Xs={},U=!0}_(0,new bn(g))}function Kp(g){if(u)return gt(1,0,g);Fu(g)}var Fu=g=>{if(D=g,u)throw Kp(g),"unwind";oh(g)},Ys=[],zu=[],Yp=[],Xs={},tl=g=>{var b=g.Bb;delete Xs[b],Ys.push(g),zu.splice(zu.indexOf(g),1),g.Bb=0,ok(b)};function lh(){Yp.forEach(g=>g())}var uh=g=>new Promise(b=>{g.onmessage=O=>{var W=(O=O.data).Db;if(O.Hb&&O.Hb!=mx()){var X=Xs[O.Hb];X?X.postMessage(O,O.Nb):G(`Internal error! Worker sent a message "${W}" to target pthread ${O.Hb}, but that thread no longer exists!`)}else W==="checkMailbox"?Js():W==="spawnThread"?Gp(O):W==="cleanupThread"?tl(Xs[O.ic]):W==="loaded"?(g.loaded=!0,b(g)):O.target==="setimmediate"?g.postMessage(O):W==="callHandler"?s[O.Rb](...O.args):W&&G(`worker sent an unknown command ${W}`)},g.onerror=O=>{throw G(`worker sent an error! ${O.filename}:${O.lineno}: ${O.message}`),O};var T,$=[];for(T of[])s.propertyIsEnumerable(T)&&$.push(T);g.postMessage({Db:"load",Sb:$,kc:E,lc:C})});function Qs(){var g=new Worker((()=>{let b=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new b("ort.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});Ys.push(g)}var pv=g=>{at();var b=be()[g+52>>>2>>>0];g=be()[g+56>>>2>>>0],ck(b,b-g),Kv(b)},ch=(g,b)=>{Ks=0,g=dk(g,b),0<Ks?D=g:yx(g)};class mv{constructor(b){this.Ib=b-24}}function Vu(g,b,T){var $=new mv(g>>>=0);throw b>>>=0,T>>>=0,be()[$.Ib+16>>>2>>>0]=0,be()[$.Ib+4>>>2>>>0]=b,be()[$.Ib+8>>>2>>>0]=T,g}function Xp(g,b,T,$){return u?gt(2,1,g,b,T,$):Pn(g,b,T,$)}function Pn(g,b,T,$){if(g>>>=0,T>>>=0,$>>>=0,c===void 0)return 6;var O=[];return u&&O.length===0?Xp(g,b>>>=0,T,$):(g={fc:T,Bb:g,Jb:$,Nb:O},u?(g.Db="spawnThread",postMessage(g,O),0):Gp(g))}var Qp=typeof TextDecoder<"u"?new TextDecoder:void 0,nl=(g,b=0,T=NaN)=>{var $=(b>>>=0)+T;for(T=b;g[T]&&!(T>=$);)++T;if(16<T-b&&g.buffer&&Qp)return Qp.decode(g.buffer instanceof ArrayBuffer?g.subarray(b,T):g.slice(b,T));for($="";b<T;){var O=g[b++];if(128&O){var W=63&g[b++];if((224&O)==192)$+=String.fromCharCode((31&O)<<6|W);else{var X=63&g[b++];65536>(O=(240&O)==224?(15&O)<<12|W<<6|X:(7&O)<<18|W<<12|X<<6|63&g[b++])?$+=String.fromCharCode(O):(O-=65536,$+=String.fromCharCode(55296|O>>10,56320|1023&O))}}else $+=String.fromCharCode(O)}return $},kt=(g,b)=>(g>>>=0)?nl(Z(),g,b):"";function gv(g,b,T){return u?gt(3,1,g,b,T):0}function yv(g,b){if(u)return gt(4,1,g,b)}function Wa(g,b){if(u)return gt(5,1,g,b)}function _v(g,b,T){if(u)return gt(6,1,g,b,T)}function vv(g,b,T){return u?gt(7,1,g,b,T):0}function ju(g,b){if(u)return gt(8,1,g,b)}function Jp(g,b,T){if(u)return gt(9,1,g,b,T)}function Zp(g,b,T,$){if(u)return gt(10,1,g,b,T,$)}function dh(g,b,T,$){if(u)return gt(11,1,g,b,T,$)}function il(g,b,T,$){if(u)return gt(12,1,g,b,T,$)}function wv(g){if(u)return gt(13,1,g)}function rs(g,b){if(u)return gt(14,1,g,b)}function em(g,b,T){if(u)return gt(15,1,g,b,T)}var tm,nm=()=>is(""),zi=g=>{for(var b="";Z()[g>>>0];)b+=tm[Z()[g++>>>0]];return b},hh={},im={},qa=s.BindingError=class extends Error{constructor(g){super(g),this.name="BindingError"}};function ss(g,b,T={}){return function($,O,W={}){var X=O.name;if(!$)throw new qa(`type "${X}" must have a positive integer typeid pointer`);if(im.hasOwnProperty($)){if(W.Tb)return;throw new qa(`Cannot register type '${X}' twice`)}im[$]=O,hh.hasOwnProperty($)&&(O=hh[$],delete hh[$],O.forEach(ne=>ne()))}(g,b,T)}var Bu=(g,b,T)=>{switch(b){case 1:return T?$=>K()[$>>>0]:$=>Z()[$>>>0];case 2:return T?$=>ge()[$>>>1>>>0]:$=>ve()[$>>>1>>>0];case 4:return T?$=>Q()[$>>>2>>>0]:$=>be()[$>>>2>>>0];case 8:return T?$=>M[$>>>3]:$=>se[$>>>3];default:throw new TypeError(`invalid integer width (${b}): ${g}`)}};function bv(g,b,T){T>>>=0,ss(g>>>=0,{name:b=zi(b>>>0),fromWireType:$=>$,toWireType:function($,O){if(typeof O!="bigint"&&typeof O!="number")throw O=O===null?"null":($=typeof O)=="object"||$==="array"||$==="function"?O.toString():""+O,new TypeError(`Cannot convert "${O}" to ${this.name}`);return typeof O=="number"&&(O=BigInt(O)),O},Cb:Dr,readValueFromPointer:Bu(b,T,b.indexOf("u")==-1),Eb:null})}var Dr=8;function Uu(g,b,T,$){ss(g>>>=0,{name:b=zi(b>>>0),fromWireType:function(O){return!!O},toWireType:function(O,W){return W?T:$},Cb:Dr,readValueFromPointer:function(O){return this.fromWireType(Z()[O>>>0])},Eb:null})}var as=[],rr=[];function rm(g){9<(g>>>=0)&&--rr[g+1]==0&&(rr[g]=void 0,as.push(g))}var Nn=g=>{if(!g)throw new qa(`Cannot use deleted val. handle = ${g}`);return rr[g]},Ei=g=>{switch(g){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let b=as.pop()||rr.length;return rr[b]=g,rr[b+1]=1,b}};function fh(g){return this.fromWireType(be()[g>>>2>>>0])}var sm={name:"emscripten::val",fromWireType:g=>{var b=Nn(g);return rm(g),b},toWireType:(g,b)=>Ei(b),Cb:Dr,readValueFromPointer:fh,Eb:null};function am(g){return ss(g>>>0,sm)}var xv=(g,b)=>{switch(b){case 4:return function(T){return this.fromWireType(vt()[T>>>2>>>0])};case 8:return function(T){return this.fromWireType(mt()[T>>>3>>>0])};default:throw new TypeError(`invalid float width (${b}): ${g}`)}};function Ev(g,b,T){T>>>=0,ss(g>>>=0,{name:b=zi(b>>>0),fromWireType:$=>$,toWireType:($,O)=>O,Cb:Dr,readValueFromPointer:xv(b,T),Eb:null})}function Av(g,b,T,$,O){if(g>>>=0,T>>>=0,b=zi(b>>>0),O===-1&&(O=4294967295),O=ne=>ne,$===0){var W=32-8*T;O=ne=>ne<<W>>>W}var X=b.includes("unsigned")?function(ne,de){return de>>>0}:function(ne,de){return de};ss(g,{name:b,fromWireType:O,toWireType:X,Cb:Dr,readValueFromPointer:Bu(b,T,$!==0),Eb:null})}function rx(g,b,T){function $(W){var X=be()[W>>>2>>>0];return W=be()[W+4>>>2>>>0],new O(K().buffer,W,X)}var O=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][b];ss(g>>>=0,{name:T=zi(T>>>0),fromWireType:$,Cb:Dr,readValueFromPointer:$},{Tb:!0})}var ri=(g,b,T)=>{var $=Z();if(b>>>=0,0<T){var O=b;T=b+T-1;for(var W=0;W<g.length;++W){var X=g.charCodeAt(W);if(55296<=X&&57343>=X&&(X=65536+((1023&X)<<10)|1023&g.charCodeAt(++W)),127>=X){if(b>=T)break;$[b++>>>0]=X}else{if(2047>=X){if(b+1>=T)break;$[b++>>>0]=192|X>>6}else{if(65535>=X){if(b+2>=T)break;$[b++>>>0]=224|X>>12}else{if(b+3>=T)break;$[b++>>>0]=240|X>>18,$[b++>>>0]=128|X>>12&63}$[b++>>>0]=128|X>>6&63}$[b++>>>0]=128|63&X}}$[b>>>0]=0,g=b-O}else g=0;return g},Vi=g=>{for(var b=0,T=0;T<g.length;++T){var $=g.charCodeAt(T);127>=$?b++:2047>=$?b+=2:55296<=$&&57343>=$?(b+=4,++T):b+=3}return b};function Hu(g,b){ss(g>>>=0,{name:b=zi(b>>>0),fromWireType:function(T){for(var $,O=be()[T>>>2>>>0],W=T+4,X=W,ne=0;ne<=O;++ne){var de=W+ne;ne!=O&&Z()[de>>>0]!=0||(X=kt(X,de-X),$===void 0?$=X:($+="\0",$+=X),X=de+1)}return Ya(T),$},toWireType:function(T,$){$ instanceof ArrayBuffer&&($=new Uint8Array($));var O=typeof $=="string";if(!(O||ArrayBuffer.isView($)&&$.BYTES_PER_ELEMENT==1))throw new qa("Cannot pass non-string to std::string");var W=O?Vi($):$.length,X=Gv(4+W+1),ne=X+4;return be()[X>>>2>>>0]=W,O?ri($,ne,W+1):Z().set($,ne>>>0),T!==null&&T.push(Ya,X),X},Cb:Dr,readValueFromPointer:fh,Eb(T){Ya(T)}})}var rl=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,om=(g,b)=>{for(var T=g>>1,$=T+b/2;!(T>=$)&&ve()[T>>>0];)++T;if(32<(T<<=1)-g&&rl)return rl.decode(Z().slice(g,T));for(T="",$=0;!($>=b/2);++$){var O=ge()[g+2*$>>>1>>>0];if(O==0)break;T+=String.fromCharCode(O)}return T},$t=(g,b,T)=>{if(T??(T=2147483647),2>T)return 0;var $=b;T=(T-=2)<2*g.length?T/2:g.length;for(var O=0;O<T;++O){var W=g.charCodeAt(O);ge()[b>>>1>>>0]=W,b+=2}return ge()[b>>>1>>>0]=0,b-$},ph=g=>2*g.length,Wu=(g,b)=>{for(var T=0,$="";!(T>=b/4);){var O=Q()[g+4*T>>>2>>>0];if(O==0)break;++T,65536<=O?(O-=65536,$+=String.fromCharCode(55296|O>>10,56320|1023&O)):$+=String.fromCharCode(O)}return $},qu=(g,b,T)=>{if(b>>>=0,T??(T=2147483647),4>T)return 0;var $=b;T=$+T-4;for(var O=0;O<g.length;++O){var W=g.charCodeAt(O);if(55296<=W&&57343>=W&&(W=65536+((1023&W)<<10)|1023&g.charCodeAt(++O)),Q()[b>>>2>>>0]=W,(b+=4)+4>T)break}return Q()[b>>>2>>>0]=0,b-$},sx=g=>{for(var b=0,T=0;T<g.length;++T){var $=g.charCodeAt(T);55296<=$&&57343>=$&&++T,b+=4}return b};function Tv(g,b,T){if(g>>>=0,b>>>=0,T=zi(T>>>=0),b===2)var $=om,O=$t,W=ph,X=ne=>ve()[ne>>>1>>>0];else b===4&&($=Wu,O=qu,W=sx,X=ne=>be()[ne>>>2>>>0]);ss(g,{name:T,fromWireType:ne=>{for(var de,pe=be()[ne>>>2>>>0],Ae=ne+4,Me=0;Me<=pe;++Me){var qe=ne+4+Me*b;Me!=pe&&X(qe)!=0||(Ae=$(Ae,qe-Ae),de===void 0?de=Ae:(de+="\0",de+=Ae),Ae=qe+b)}return Ya(ne),de},toWireType:(ne,de)=>{if(typeof de!="string")throw new qa(`Cannot pass non-string to C++ string type ${T}`);var pe=W(de),Ae=Gv(4+pe+b);return be()[Ae>>>2>>>0]=pe/b,O(de,Ae+4,pe+b),ne!==null&&ne.push(Ya,Ae),Ae},Cb:Dr,readValueFromPointer:fh,Eb(ne){Ya(ne)}})}function ax(g,b){ss(g>>>=0,{Ub:!0,name:b=zi(b>>>0),Cb:0,fromWireType:()=>{},toWireType:()=>{}})}function ox(g){gx(g>>>0,!l,1,!o,131072,!1),lh()}var lm=g=>{if(!U)try{if(g(),!(0<Ks))try{u?yx(D):Fu(D)}catch(b){b instanceof bn||b=="unwind"||_(0,b)}}catch(b){b instanceof bn||b=="unwind"||_(0,b)}};function um(g){g>>>=0,typeof Atomics.jc=="function"&&(Atomics.jc(Q(),g>>>2,g).value.then(Js),g+=128,Atomics.store(Q(),g>>>2,1))}var Js=()=>{var g=mx();g&&(um(g),lm(uk))};function Ga(g,b){(g>>>=0)==b>>>0?setTimeout(Js):u?postMessage({Hb:g,Db:"checkMailbox"}):(g=Xs[g])&&g.postMessage({Db:"checkMailbox"})}var mh=[];function Sv(g,b,T,$,O){for(b>>>=0,$/=2,mh.length=$,T=O>>>0>>>3,O=0;O<$;O++)mh[O]=M[T+2*O]?M[T+2*O+1]:mt()[T+2*O+1>>>0];return(b?px[b]:h5[g])(...mh)}var Iv=()=>{Ks=0};function Cv(g){g>>>=0,u?postMessage({Db:"cleanupThread",ic:g}):tl(Xs[g])}function kv(g){}var os=(g,b)=>{var T=im[g];if(T===void 0)throw g=ik(g),T=zi(g),Ya(g),new qa(`${b} has unknown type ${T}`);return T},$v=(g,b,T)=>{var $=[];return g=g.toWireType($,T),$.length&&(be()[b>>>2>>>0]=Ei($)),g};function lx(g,b,T){return b>>>=0,T>>>=0,g=Nn(g>>>0),b=os(b,"emval::as"),$v(b,T,g)}function ux(g,b){return b>>>=0,g=Nn(g>>>0),(b=os(b,"emval::as")).toWireType(null,g)}var sr=g=>{try{g()}catch(b){is(b)}},Zs=0,ji=null,Gu=0,Ku=[],sl={},al={},Rv=0,Yu=null,Vt=[];function Pv(g){return function(b){if(!U){if(Zs===0){var T=!1,$=!1;b((O=0)=>{if(!U&&(Gu=O,T=!0,$)){Zs=2,sr(()=>pk(ji)),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.resume(),O=!1;try{var W=function(){var de=Q()[ji+8>>>2>>>0];return de=oe[al[de]],--Ks,de()}()}catch(de){W=de,O=!0}var X=!1;if(!ji){var ne=Yu;ne&&(Yu=null,(O?ne.reject:ne.resolve)(W),X=!0)}if(O&&!X)throw W}}),$=!0,T||(Zs=1,ji=function(){var O=Gv(65548),W=O+12;be()[O>>>2>>>0]=W,be()[O+4>>>2>>>0]=W+65536,W=Ku[0];var X=sl[W];return X===void 0&&(X=Rv++,sl[W]=X,al[X]=W),W=X,Q()[O+8>>>2>>>0]=W,O}(),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.pause(),sr(()=>hk(ji)))}else Zs===2?(Zs=0,sr(mk),Ya(ji),ji=null,Vt.forEach(lm)):is(`invalid state: ${Zs}`);return Gu}}(b=>{g().then(b)})}function cx(g){return g>>>=0,Pv(async()=>{var b=await Nn(g);return Ei(b)})}var Xu=[];function Nv(g,b,T,$){return T>>>=0,$>>>=0,(g=Xu[g>>>0])(null,b=Nn(b>>>0),T,$)}var Dv={},Ka=g=>{var b=Dv[g];return b===void 0?zi(g):b};function ea(g,b,T,$,O){return T>>>=0,$>>>=0,O>>>=0,(g=Xu[g>>>0])(b=Nn(b>>>0),b[T=Ka(T)],$,O)}function Mv(g,b){return b>>>=0,(g=Nn(g>>>0))==Nn(b)}var Ov=()=>typeof globalThis=="object"?globalThis:Function("return this")();function Qu(g){return(g>>>=0)==0?Ei(Ov()):(g=Ka(g),Ei(Ov()[g]))}var Lv=g=>{var b=Xu.length;return Xu.push(g),b},cm=(g,b)=>{for(var T=Array(g),$=0;$<g;++$)T[$]=os(be()[b+4*$>>>2>>>0],`parameter ${$}`);return T};function gh(g,b,T){var $=(b=cm(g,b>>>0)).shift();g--;var O=`return function (obj, func, destructorsRef, args) {
`,W=0,X=[];T===0&&X.push("obj");for(var ne=["retType"],de=[$],pe=0;pe<g;++pe)X.push(`arg${pe}`),ne.push(`argType${pe}`),de.push(b[pe]),O+=`  var arg${pe} = argType${pe}.readValueFromPointer(args${W?"+"+W:""});
`,W+=b[pe].Cb;return O+=`  var rv = ${T===1?"new func":"func.call"}(${X.join(", ")});
`,$.Ub||(ne.push("emval_returnValue"),de.push($v),O+=`  return emval_returnValue(retType, destructorsRef, rv);
`),g=new Function(...ne,O+`};
`)(...de),T=`methodCaller<(${b.map(Ae=>Ae.name).join(", ")}) => ${$.name}>`,Lv(Object.defineProperty(g,"name",{value:T}))}function Fv(g){return g=Ka(g>>>0),Ei(s[g])}function yh(g,b){return b>>>=0,g=Nn(g>>>0),b=Nn(b),Ei(g[b])}function dx(g){9<(g>>>=0)&&(rr[g+1]+=1)}function zv(){return Ei([])}function Ju(g){g=Nn(g>>>0);for(var b=Array(g.length),T=0;T<g.length;T++)b[T]=g[T];return Ei(b)}function Vv(g){return Ei(Ka(g>>>0))}function jv(){return Ei({})}function dm(g){for(var b=Nn(g>>>=0);b.length;){var T=b.pop();b.pop()(T)}rm(g)}function hm(g,b,T){b>>>=0,T>>>=0,g=Nn(g>>>0),b=Nn(b),T=Nn(T),g[b]=T}function Bv(g,b){return b>>>=0,g=(g=os(g>>>0,"_emval_take_value")).readValueFromPointer(b),Ei(g)}function _h(g,b){g=-9007199254740992>g||9007199254740992<g?NaN:Number(g),b>>>=0,g=new Date(1e3*g),Q()[b>>>2>>>0]=g.getUTCSeconds(),Q()[b+4>>>2>>>0]=g.getUTCMinutes(),Q()[b+8>>>2>>>0]=g.getUTCHours(),Q()[b+12>>>2>>>0]=g.getUTCDate(),Q()[b+16>>>2>>>0]=g.getUTCMonth(),Q()[b+20>>>2>>>0]=g.getUTCFullYear()-1900,Q()[b+24>>>2>>>0]=g.getUTCDay(),g=(g.getTime()-Date.UTC(g.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,Q()[b+28>>>2>>>0]=g}var fm=g=>g%4==0&&(g%100!=0||g%400==0),pm=[0,31,60,91,121,152,182,213,244,274,305,335],ta=[0,31,59,90,120,151,181,212,243,273,304,334];function Uv(g,b){g=-9007199254740992>g||9007199254740992<g?NaN:Number(g),b>>>=0,g=new Date(1e3*g),Q()[b>>>2>>>0]=g.getSeconds(),Q()[b+4>>>2>>>0]=g.getMinutes(),Q()[b+8>>>2>>>0]=g.getHours(),Q()[b+12>>>2>>>0]=g.getDate(),Q()[b+16>>>2>>>0]=g.getMonth(),Q()[b+20>>>2>>>0]=g.getFullYear()-1900,Q()[b+24>>>2>>>0]=g.getDay();var T=(fm(g.getFullYear())?pm:ta)[g.getMonth()]+g.getDate()-1|0;Q()[b+28>>>2>>>0]=T,Q()[b+36>>>2>>>0]=-60*g.getTimezoneOffset(),T=new Date(g.getFullYear(),6,1).getTimezoneOffset();var $=new Date(g.getFullYear(),0,1).getTimezoneOffset();g=0|(T!=$&&g.getTimezoneOffset()==Math.min($,T)),Q()[b+32>>>2>>>0]=g}function Hv(g){g>>>=0;var b=new Date(Q()[g+20>>>2>>>0]+1900,Q()[g+16>>>2>>>0],Q()[g+12>>>2>>>0],Q()[g+8>>>2>>>0],Q()[g+4>>>2>>>0],Q()[g>>>2>>>0],0),T=Q()[g+32>>>2>>>0],$=b.getTimezoneOffset(),O=new Date(b.getFullYear(),6,1).getTimezoneOffset(),W=new Date(b.getFullYear(),0,1).getTimezoneOffset(),X=Math.min(W,O);return 0>T?Q()[g+32>>>2>>>0]=+(O!=W&&X==$):0<T!=(X==$)&&(O=Math.max(W,O),b.setTime(b.getTime()+6e4*((0<T?X:O)-$))),Q()[g+24>>>2>>>0]=b.getDay(),T=(fm(b.getFullYear())?pm:ta)[b.getMonth()]+b.getDate()-1|0,Q()[g+28>>>2>>>0]=T,Q()[g>>>2>>>0]=b.getSeconds(),Q()[g+4>>>2>>>0]=b.getMinutes(),Q()[g+8>>>2>>>0]=b.getHours(),Q()[g+12>>>2>>>0]=b.getDate(),Q()[g+16>>>2>>>0]=b.getMonth(),Q()[g+20>>>2>>>0]=b.getYear(),g=b.getTime(),BigInt(isNaN(g)?-1:g/1e3)}function mm(g,b,T,$,O,W,X){return u?gt(16,1,g,b,T,$,O,W,X):-52}function gm(g,b,T,$,O,W){if(u)return gt(17,1,g,b,T,$,O,W)}var na={},Ai=()=>performance.timeOrigin+performance.now();function ym(g,b){if(u)return gt(18,1,g,b);if(na[g]&&(clearTimeout(na[g].id),delete na[g]),!b)return 0;var T=setTimeout(()=>{delete na[g],lm(()=>lk(g,performance.timeOrigin+performance.now()))},b);return na[g]={id:T,rc:b},0}function Wv(g,b,T,$){g>>>=0,b>>>=0,T>>>=0,$>>>=0;var O=new Date().getFullYear(),W=new Date(O,0,1).getTimezoneOffset();O=new Date(O,6,1).getTimezoneOffset();var X=Math.max(W,O);be()[g>>>2>>>0]=60*X,Q()[b>>>2>>>0]=+(W!=O),g=(b=ne=>{var de=Math.abs(ne);return`UTC${0<=ne?"-":"+"}${String(Math.floor(de/60)).padStart(2,"0")}${String(de%60).padStart(2,"0")}`})(W),b=b(O),O<W?(ri(g,T,17),ri(b,$,17)):(ri(g,$,17),ri(b,T,17))}var ol=()=>Date.now();function p(g,b,T){return 0<=g&&3>=g?(g===0?g=Date.now():g=performance.timeOrigin+performance.now(),M[T>>>0>>>3]=BigInt(Math.round(1e6*g)),0):28}var A=[],P=(g,b)=>{A.length=0;for(var T;T=Z()[g++>>>0];){var $=T!=105;b+=($&=T!=112)&&b%8?4:0,A.push(T==112?be()[b>>>2>>>0]:T==106?M[b>>>3]:T==105?Q()[b>>>2>>>0]:mt()[b>>>3>>>0]),b+=$?8:4}return A};function B(g,b,T){return g>>>=0,b=P(b>>>0,T>>>0),px[g](...b)}function te(g,b,T){return g>>>=0,b=P(b>>>0,T>>>0),px[g](...b)}var re=()=>{};function ye(g,b){return G(kt(g>>>0,b>>>0))}var Ge=()=>{throw Ks+=1,"unwind"};function rn(){return 4294901760}var bt=()=>navigator.hardwareConcurrency;function dn(){return is("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function Mr(g){g>>>=0;var b=Z().length;if(g<=b||4294901760<g)return!1;for(var T=1;4>=T;T*=2){var $=b*(1+.2/T);$=Math.min($,g+100663296);e:{$=(Math.min(4294901760,65536*Math.ceil(Math.max(g,$)/65536))-E.buffer.byteLength+65535)/65536|0;try{E.grow($),at();var O=1;break e}catch{}O=void 0}if(O)return!0}return!1}var Or=()=>(is("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),Bi={},ls=g=>{g.forEach(b=>{Or()})};function vh(){var g=Error().stack.toString().split(`
`);return g[0]=="Error"&&g.shift(),ls(g),Bi.Mb=Or(),Bi.dc=g,Bi.Mb}function _m(g,b,T){if(g>>>=0,b>>>=0,Bi.Mb==g)var $=Bi.dc;else($=Error().stack.toString().split(`
`))[0]=="Error"&&$.shift(),ls($);for(var O=3;$[O]&&Or()!=g;)++O;for(g=0;g<T&&$[g+O];++g)Q()[b+4*g>>>2>>>0]=Or();return g}var hx,fx={},YC=()=>{if(!hx){var g,b={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(g in fx)fx[g]===void 0?delete b[g]:b[g]=fx[g];var T=[];for(g in b)T.push(`${g}=${b[g]}`);hx=T}return hx};function XC(g,b){if(u)return gt(19,1,g,b);g>>>=0,b>>>=0;var T,$=0,O=0;for(T of YC()){var W=b+$;be()[g+O>>>2>>>0]=W,$+=ri(T,W,1/0)+1,O+=4}return 0}function QC(g,b){if(u)return gt(20,1,g,b);g>>>=0,b>>>=0;var T=YC();for(var $ of(be()[g>>>2>>>0]=T.length,g=0,T))g+=Vi($)+1;return be()[b>>>2>>>0]=g,0}function JC(g){return u?gt(21,1,g):52}function ZC(g,b,T,$){return u?gt(22,1,g,b,T,$):52}function ek(g,b,T,$){return u?gt(23,1,g,b,T,$):70}var d5=[null,[],[]];function tk(g,b,T,$){if(u)return gt(24,1,g,b,T,$);b>>>=0,T>>>=0,$>>>=0;for(var O=0,W=0;W<T;W++){var X=be()[b>>>2>>>0],ne=be()[b+4>>>2>>>0];b+=8;for(var de=0;de<ne;de++){var pe=g,Ae=Z()[X+de>>>0],Me=d5[pe];Ae===0||Ae===10?((pe===1?q:G)(nl(Me)),Me.length=0):Me.push(Ae)}O+=ne}return be()[$>>>2>>>0]=O,0}u||function(){for(var g=s.numThreads-1;g--;)Qs();qp.push(()=>{Ha++,function(b){u?b():Promise.all(Ys.map(uh)).then(b)}(()=>ah())})}();for(var nk=Array(256),qv=0;256>qv;++qv)nk[qv]=String.fromCharCode(qv);tm=nk,rr.push(0,1,void 0,1,null,1,!0,1,!1,1),s.count_emval_handles=()=>rr.length/2-5-as.length,u||(E=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),at()),s.wasmBinary&&(w=s.wasmBinary),s.stackSave=()=>vx(),s.stackRestore=g=>Kv(g),s.stackAlloc=g=>_x(g),s.setValue=function(g,b,T="i8"){switch(T.endsWith("*")&&(T="*"),T){case"i1":case"i8":K()[g>>>0]=b;break;case"i16":ge()[g>>>1>>>0]=b;break;case"i32":Q()[g>>>2>>>0]=b;break;case"i64":M[g>>>3]=BigInt(b);break;case"float":vt()[g>>>2>>>0]=b;break;case"double":mt()[g>>>3>>>0]=b;break;case"*":be()[g>>>2>>>0]=b;break;default:is(`invalid type for setValue: ${T}`)}},s.getValue=function(g,b="i8"){switch(b.endsWith("*")&&(b="*"),b){case"i1":case"i8":return K()[g>>>0];case"i16":return ge()[g>>>1>>>0];case"i32":return Q()[g>>>2>>>0];case"i64":return M[g>>>3];case"float":return vt()[g>>>2>>>0];case"double":return mt()[g>>>3>>>0];case"*":return be()[g>>>2>>>0];default:is(`invalid type for getValue: ${b}`)}},s.UTF8ToString=kt,s.stringToUTF8=ri,s.lengthBytesUTF8=Vi;var h5=[oh,Kp,Xp,gv,yv,Wa,_v,vv,ju,Jp,Zp,dh,il,wv,rs,em,mm,gm,ym,XC,QC,JC,ZC,ek,tk],px={893836:(g,b,T,$,O)=>{if(s===void 0||!s.Fb)return 1;if((g=kt(Number(g>>>0))).startsWith("./")&&(g=g.substring(2)),!(g=s.Fb.get(g)))return 2;if(b=Number(b>>>0),T=Number(T>>>0),$=Number($>>>0),b+T>g.byteLength)return 3;try{let W=g.subarray(b,b+T);switch(O){case 0:Z().set(W,$>>>0);break;case 1:s.mc?s.mc($,W):s.cc($,W);break;default:return 4}return 0}catch{return 4}},894660:(g,b,T)=>{s.Pb(g,Z().subarray(b>>>0,b+T>>>0))},894724:()=>s.oc(),894766:g=>{s.Ob(g)},894803:()=>{s.Wb()},894834:()=>{s.Xb()},894863:()=>{s.ac()},894888:g=>s.Vb(g),894921:g=>s.Zb(g),894953:(g,b,T)=>{s.Lb(Number(g),Number(b),Number(T),!0)},895016:(g,b,T)=>{s.Lb(Number(g),Number(b),Number(T))},895073:()=>typeof wasmOffsetConverter<"u",895130:g=>{s.Ab("Abs",g,void 0)},895181:g=>{s.Ab("Neg",g,void 0)},895232:g=>{s.Ab("Floor",g,void 0)},895285:g=>{s.Ab("Ceil",g,void 0)},895337:g=>{s.Ab("Reciprocal",g,void 0)},895395:g=>{s.Ab("Sqrt",g,void 0)},895447:g=>{s.Ab("Exp",g,void 0)},895498:g=>{s.Ab("Erf",g,void 0)},895549:g=>{s.Ab("Sigmoid",g,void 0)},895604:(g,b,T)=>{s.Ab("HardSigmoid",g,{alpha:b,beta:T})},895683:g=>{s.Ab("Log",g,void 0)},895734:g=>{s.Ab("Sin",g,void 0)},895785:g=>{s.Ab("Cos",g,void 0)},895836:g=>{s.Ab("Tan",g,void 0)},895887:g=>{s.Ab("Asin",g,void 0)},895939:g=>{s.Ab("Acos",g,void 0)},895991:g=>{s.Ab("Atan",g,void 0)},896043:g=>{s.Ab("Sinh",g,void 0)},896095:g=>{s.Ab("Cosh",g,void 0)},896147:g=>{s.Ab("Asinh",g,void 0)},896200:g=>{s.Ab("Acosh",g,void 0)},896253:g=>{s.Ab("Atanh",g,void 0)},896306:g=>{s.Ab("Tanh",g,void 0)},896358:g=>{s.Ab("Not",g,void 0)},896409:(g,b,T)=>{s.Ab("Clip",g,{min:b,max:T})},896478:g=>{s.Ab("Clip",g,void 0)},896530:(g,b)=>{s.Ab("Elu",g,{alpha:b})},896588:g=>{s.Ab("Gelu",g,void 0)},896640:g=>{s.Ab("Relu",g,void 0)},896692:(g,b)=>{s.Ab("LeakyRelu",g,{alpha:b})},896756:(g,b)=>{s.Ab("ThresholdedRelu",g,{alpha:b})},896826:(g,b)=>{s.Ab("Cast",g,{to:b})},896884:g=>{s.Ab("Add",g,void 0)},896935:g=>{s.Ab("Sub",g,void 0)},896986:g=>{s.Ab("Mul",g,void 0)},897037:g=>{s.Ab("Div",g,void 0)},897088:g=>{s.Ab("Pow",g,void 0)},897139:g=>{s.Ab("Equal",g,void 0)},897192:g=>{s.Ab("Greater",g,void 0)},897247:g=>{s.Ab("GreaterOrEqual",g,void 0)},897309:g=>{s.Ab("Less",g,void 0)},897361:g=>{s.Ab("LessOrEqual",g,void 0)},897420:(g,b,T,$,O)=>{s.Ab("ReduceMean",g,{keepDims:!!b,noopWithEmptyAxes:!!T,axes:$?Array.from(Q().subarray(Number($)>>>0,Number(O)>>>0)):[]})},897595:(g,b,T,$,O)=>{s.Ab("ReduceMax",g,{keepDims:!!b,noopWithEmptyAxes:!!T,axes:$?Array.from(Q().subarray(Number($)>>>0,Number(O)>>>0)):[]})},897769:(g,b,T,$,O)=>{s.Ab("ReduceMin",g,{keepDims:!!b,noopWithEmptyAxes:!!T,axes:$?Array.from(Q().subarray(Number($)>>>0,Number(O)>>>0)):[]})},897943:(g,b,T,$,O)=>{s.Ab("ReduceProd",g,{keepDims:!!b,noopWithEmptyAxes:!!T,axes:$?Array.from(Q().subarray(Number($)>>>0,Number(O)>>>0)):[]})},898118:(g,b,T,$,O)=>{s.Ab("ReduceSum",g,{keepDims:!!b,noopWithEmptyAxes:!!T,axes:$?Array.from(Q().subarray(Number($)>>>0,Number(O)>>>0)):[]})},898292:(g,b,T,$,O)=>{s.Ab("ReduceL1",g,{keepDims:!!b,noopWithEmptyAxes:!!T,axes:$?Array.from(Q().subarray(Number($)>>>0,Number(O)>>>0)):[]})},898465:(g,b,T,$,O)=>{s.Ab("ReduceL2",g,{keepDims:!!b,noopWithEmptyAxes:!!T,axes:$?Array.from(Q().subarray(Number($)>>>0,Number(O)>>>0)):[]})},898638:(g,b,T,$,O)=>{s.Ab("ReduceLogSum",g,{keepDims:!!b,noopWithEmptyAxes:!!T,axes:$?Array.from(Q().subarray(Number($)>>>0,Number(O)>>>0)):[]})},898815:(g,b,T,$,O)=>{s.Ab("ReduceSumSquare",g,{keepDims:!!b,noopWithEmptyAxes:!!T,axes:$?Array.from(Q().subarray(Number($)>>>0,Number(O)>>>0)):[]})},898995:(g,b,T,$,O)=>{s.Ab("ReduceLogSumExp",g,{keepDims:!!b,noopWithEmptyAxes:!!T,axes:$?Array.from(Q().subarray(Number($)>>>0,Number(O)>>>0)):[]})},899175:g=>{s.Ab("Where",g,void 0)},899228:(g,b,T)=>{s.Ab("Transpose",g,{perm:b?Array.from(Q().subarray(Number(b)>>>0,Number(T)>>>0)):[]})},899352:(g,b,T,$)=>{s.Ab("DepthToSpace",g,{blocksize:b,mode:kt(T),format:$?"NHWC":"NCHW"})},899485:(g,b,T,$)=>{s.Ab("DepthToSpace",g,{blocksize:b,mode:kt(T),format:$?"NHWC":"NCHW"})},899618:(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut,hn)=>{s.Ab("ConvTranspose",g,{format:de?"NHWC":"NCHW",autoPad:b,dilations:[T],group:$,kernelShape:[O],pads:[W,X],strides:[ne],wIsConst:()=>!!K()[pe>>>0],outputPadding:Ae?Array.from(Q().subarray(Number(Ae)>>>0,Number(Me)>>>0)):[],outputShape:qe?Array.from(Q().subarray(Number(qe)>>>0,Number(ut)>>>0)):[],activation:kt(hn)})},900051:(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut)=>{s.Ab("ConvTranspose",g,{format:ne?"NHWC":"NCHW",autoPad:b,dilations:Array.from(Q().subarray(Number(T)>>>0,2+(Number(T)>>>0)>>>0)),group:$,kernelShape:Array.from(Q().subarray(Number(O)>>>0,2+(Number(O)>>>0)>>>0)),pads:Array.from(Q().subarray(Number(W)>>>0,4+(Number(W)>>>0)>>>0)),strides:Array.from(Q().subarray(Number(X)>>>0,2+(Number(X)>>>0)>>>0)),wIsConst:()=>!!K()[de>>>0],outputPadding:pe?Array.from(Q().subarray(Number(pe)>>>0,Number(Ae)>>>0)):[],outputShape:Me?Array.from(Q().subarray(Number(Me)>>>0,Number(qe)>>>0)):[],activation:kt(ut)})},900712:(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut,hn)=>{s.Ab("ConvTranspose",g,{format:de?"NHWC":"NCHW",autoPad:b,dilations:[T],group:$,kernelShape:[O],pads:[W,X],strides:[ne],wIsConst:()=>!!K()[pe>>>0],outputPadding:Ae?Array.from(Q().subarray(Number(Ae)>>>0,Number(Me)>>>0)):[],outputShape:qe?Array.from(Q().subarray(Number(qe)>>>0,Number(ut)>>>0)):[],activation:kt(hn)})},901145:(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut)=>{s.Ab("ConvTranspose",g,{format:ne?"NHWC":"NCHW",autoPad:b,dilations:Array.from(Q().subarray(Number(T)>>>0,2+(Number(T)>>>0)>>>0)),group:$,kernelShape:Array.from(Q().subarray(Number(O)>>>0,2+(Number(O)>>>0)>>>0)),pads:Array.from(Q().subarray(Number(W)>>>0,4+(Number(W)>>>0)>>>0)),strides:Array.from(Q().subarray(Number(X)>>>0,2+(Number(X)>>>0)>>>0)),wIsConst:()=>!!K()[de>>>0],outputPadding:pe?Array.from(Q().subarray(Number(pe)>>>0,Number(Ae)>>>0)):[],outputShape:Me?Array.from(Q().subarray(Number(Me)>>>0,Number(qe)>>>0)):[],activation:kt(ut)})},901806:(g,b)=>{s.Ab("GlobalAveragePool",g,{format:b?"NHWC":"NCHW"})},901897:(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut)=>{s.Ab("AveragePool",g,{format:ut?"NHWC":"NCHW",auto_pad:b,ceil_mode:T,count_include_pad:$,storage_order:O,dilations:W?Array.from(Q().subarray(Number(W)>>>0,Number(X)>>>0)):[],kernel_shape:ne?Array.from(Q().subarray(Number(ne)>>>0,Number(de)>>>0)):[],pads:pe?Array.from(Q().subarray(Number(pe)>>>0,Number(Ae)>>>0)):[],strides:Me?Array.from(Q().subarray(Number(Me)>>>0,Number(qe)>>>0)):[]})},902376:(g,b)=>{s.Ab("GlobalAveragePool",g,{format:b?"NHWC":"NCHW"})},902467:(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut)=>{s.Ab("AveragePool",g,{format:ut?"NHWC":"NCHW",auto_pad:b,ceil_mode:T,count_include_pad:$,storage_order:O,dilations:W?Array.from(Q().subarray(Number(W)>>>0,Number(X)>>>0)):[],kernel_shape:ne?Array.from(Q().subarray(Number(ne)>>>0,Number(de)>>>0)):[],pads:pe?Array.from(Q().subarray(Number(pe)>>>0,Number(Ae)>>>0)):[],strides:Me?Array.from(Q().subarray(Number(Me)>>>0,Number(qe)>>>0)):[]})},902946:(g,b)=>{s.Ab("GlobalMaxPool",g,{format:b?"NHWC":"NCHW"})},903033:(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut)=>{s.Ab("MaxPool",g,{format:ut?"NHWC":"NCHW",auto_pad:b,ceil_mode:T,count_include_pad:$,storage_order:O,dilations:W?Array.from(Q().subarray(Number(W)>>>0,Number(X)>>>0)):[],kernel_shape:ne?Array.from(Q().subarray(Number(ne)>>>0,Number(de)>>>0)):[],pads:pe?Array.from(Q().subarray(Number(pe)>>>0,Number(Ae)>>>0)):[],strides:Me?Array.from(Q().subarray(Number(Me)>>>0,Number(qe)>>>0)):[]})},903508:(g,b)=>{s.Ab("GlobalMaxPool",g,{format:b?"NHWC":"NCHW"})},903595:(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut)=>{s.Ab("MaxPool",g,{format:ut?"NHWC":"NCHW",auto_pad:b,ceil_mode:T,count_include_pad:$,storage_order:O,dilations:W?Array.from(Q().subarray(Number(W)>>>0,Number(X)>>>0)):[],kernel_shape:ne?Array.from(Q().subarray(Number(ne)>>>0,Number(de)>>>0)):[],pads:pe?Array.from(Q().subarray(Number(pe)>>>0,Number(Ae)>>>0)):[],strides:Me?Array.from(Q().subarray(Number(Me)>>>0,Number(qe)>>>0)):[]})},904070:(g,b,T,$,O)=>{s.Ab("Gemm",g,{alpha:b,beta:T,transA:$,transB:O})},904174:g=>{s.Ab("MatMul",g,void 0)},904228:(g,b,T,$)=>{s.Ab("ArgMax",g,{keepDims:!!b,selectLastIndex:!!T,axis:$})},904336:(g,b,T,$)=>{s.Ab("ArgMin",g,{keepDims:!!b,selectLastIndex:!!T,axis:$})},904444:(g,b)=>{s.Ab("Softmax",g,{axis:b})},904507:(g,b)=>{s.Ab("Concat",g,{axis:b})},904567:(g,b,T,$,O)=>{s.Ab("Split",g,{axis:b,numOutputs:T,splitSizes:$?Array.from(Q().subarray(Number($)>>>0,Number(O)>>>0)):[]})},904723:g=>{s.Ab("Expand",g,void 0)},904777:(g,b)=>{s.Ab("Gather",g,{axis:Number(b)})},904848:(g,b)=>{s.Ab("GatherElements",g,{axis:Number(b)})},904927:(g,b)=>{s.Ab("GatherND",g,{batch_dims:Number(b)})},905006:(g,b,T,$,O,W,X,ne,de,pe,Ae)=>{s.Ab("Resize",g,{antialias:b,axes:T?Array.from(Q().subarray(Number(T)>>>0,Number($)>>>0)):[],coordinateTransformMode:kt(O),cubicCoeffA:W,excludeOutside:X,extrapolationValue:ne,keepAspectRatioPolicy:kt(de),mode:kt(pe),nearestMode:kt(Ae)})},905368:(g,b,T,$,O,W,X)=>{s.Ab("Slice",g,{starts:b?Array.from(Q().subarray(Number(b)>>>0,Number(T)>>>0)):[],ends:$?Array.from(Q().subarray(Number($)>>>0,Number(O)>>>0)):[],axes:W?Array.from(Q().subarray(Number(W)>>>0,Number(X)>>>0)):[]})},905632:g=>{s.Ab("Tile",g,void 0)},905684:(g,b,T)=>{s.Ab("InstanceNormalization",g,{epsilon:b,format:T?"NHWC":"NCHW"})},905798:(g,b,T)=>{s.Ab("InstanceNormalization",g,{epsilon:b,format:T?"NHWC":"NCHW"})},905912:g=>{s.Ab("Range",g,void 0)},905965:(g,b)=>{s.Ab("Einsum",g,{equation:kt(b)})},906046:(g,b,T,$,O)=>{s.Ab("Pad",g,{mode:b,value:T,pads:$?Array.from(Q().subarray(Number($)>>>0,Number(O)>>>0)):[]})},906189:(g,b,T,$,O,W)=>{s.Ab("BatchNormalization",g,{epsilon:b,momentum:T,spatial:!!O,trainingMode:!!$,format:W?"NHWC":"NCHW"})},906358:(g,b,T,$,O,W)=>{s.Ab("BatchNormalization",g,{epsilon:b,momentum:T,spatial:!!O,trainingMode:!!$,format:W?"NHWC":"NCHW"})},906527:(g,b,T)=>{s.Ab("CumSum",g,{exclusive:Number(b),reverse:Number(T)})},906624:(g,b,T)=>{s.Ab("DequantizeLinear",g,{axis:b,blockSize:T})},906714:(g,b,T,$,O)=>{s.Ab("GridSample",g,{align_corners:b,mode:kt(T),padding_mode:kt($),format:O?"NHWC":"NCHW"})},906884:(g,b,T,$,O)=>{s.Ab("GridSample",g,{align_corners:b,mode:kt(T),padding_mode:kt($),format:O?"NHWC":"NCHW"})},907054:(g,b)=>{s.Ab("ScatterND",g,{reduction:kt(b)})},907139:(g,b,T,$,O,W,X,ne,de)=>{s.Ab("Attention",g,{numHeads:b,isUnidirectional:T,maskFilterValue:$,scale:O,doRotary:W,qkvHiddenSizes:X?Array.from(Q().subarray(Number(ne)>>>0,Number(ne)+X>>>0)):[],pastPresentShareBuffer:!!de})},907411:g=>{s.Ab("BiasAdd",g,void 0)},907466:g=>{s.Ab("BiasSplitGelu",g,void 0)},907527:g=>{s.Ab("FastGelu",g,void 0)},907583:(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut,hn,ar)=>{s.Ab("Conv",g,{format:Me?"NHWC":"NCHW",auto_pad:b,dilations:T?Array.from(Q().subarray(Number(T)>>>0,Number($)>>>0)):[],group:O,kernel_shape:W?Array.from(Q().subarray(Number(W)>>>0,Number(X)>>>0)):[],pads:ne?Array.from(Q().subarray(Number(ne)>>>0,Number(de)>>>0)):[],strides:pe?Array.from(Q().subarray(Number(pe)>>>0,Number(Ae)>>>0)):[],w_is_const:()=>!!K()[Number(qe)>>>0],activation:kt(ut),activation_params:hn?Array.from(vt().subarray(Number(hn)>>>0,Number(ar)>>>0)):[]})},908167:g=>{s.Ab("Gelu",g,void 0)},908219:(g,b,T,$,O,W,X,ne,de)=>{s.Ab("GroupQueryAttention",g,{numHeads:b,kvNumHeads:T,scale:$,softcap:O,doRotary:W,rotaryInterleaved:X,smoothSoftmax:ne,localWindowSize:de})},908436:(g,b,T,$)=>{s.Ab("LayerNormalization",g,{axis:b,epsilon:T,simplified:!!$})},908547:(g,b,T,$)=>{s.Ab("LayerNormalization",g,{axis:b,epsilon:T,simplified:!!$})},908658:(g,b,T,$,O,W)=>{s.Ab("MatMulNBits",g,{k:b,n:T,accuracyLevel:$,bits:O,blockSize:W})},908785:(g,b,T,$,O,W)=>{s.Ab("MultiHeadAttention",g,{numHeads:b,isUnidirectional:T,maskFilterValue:$,scale:O,doRotary:W})},908944:(g,b)=>{s.Ab("QuickGelu",g,{alpha:b})},909008:(g,b,T,$,O)=>{s.Ab("RotaryEmbedding",g,{interleaved:!!b,numHeads:T,rotaryEmbeddingDim:$,scale:O})},909147:(g,b,T)=>{s.Ab("SkipLayerNormalization",g,{epsilon:b,simplified:!!T})},909249:(g,b,T)=>{s.Ab("SkipLayerNormalization",g,{epsilon:b,simplified:!!T})},909351:(g,b,T,$)=>{s.Ab("GatherBlockQuantized",g,{gatherAxis:b,quantizeAxis:T,blockSize:$})},909472:g=>{s.$b(g)},909506:(g,b)=>s.bc(Number(g),Number(b),s.Gb.ec,s.Gb.errors)};function f5(g,b,T){return Pv(async()=>{await s.Yb(Number(g),Number(b),Number(T))})}function p5(){return typeof wasmOffsetConverter<"u"}var oe=await async function(){function g($,O){return oe=$.exports,oe=function(){var W=oe,X={};for(let[ne,de]of Object.entries(W))X[ne]=typeof de=="function"?(...pe)=>{Ku.push(ne);try{return de(...pe)}finally{U||(Ku.pop(),ji&&Zs===1&&Ku.length===0&&(Zs=0,Ks+=1,sr(fk),typeof Fibers<"u"&&Fibers.sc()))}}:de;return X}(),oe=function(){var W=oe,X=de=>pe=>de(pe)>>>0,ne=de=>()=>de()>>>0;return(W=Object.assign({},W)).Ea=X(W.Ea),W.gb=ne(W.gb),W.ib=X(W.ib),W.tb=X(W.tb),W.ub=ne(W.ub),W.__cxa_get_exception_ptr=X(W.__cxa_get_exception_ptr),W}(),Yp.push(oe.jb),C=O,ah(),oe}Ha++;var b=wn();if(s.instantiateWasm)return new Promise($=>{s.instantiateWasm(b,(O,W)=>{$(g(O,W))})});if(u)return new Promise($=>{ee=O=>{var W=new WebAssembly.Instance(O,wn());$(g(W,O))}});ii??(ii=s.locateFile?s.locateFile?s.locateFile("ort-wasm-simd-threaded.jsep.wasm",v):v+"ort-wasm-simd-threaded.jsep.wasm":new URL("/blood-report-fitness-evaluation-system/assets/ort-wasm-simd-threaded.jsep-BGTZ4Y7F.wasm",import.meta.url).href);try{var T=await async function($){var O=ii;if(!w&&typeof WebAssembly.instantiateStreaming=="function"&&!Y(O))try{var W=fetch(O,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(W,$)}catch(X){G(`wasm streaming compile failed: ${X}`),G("falling back to ArrayBuffer instantiation")}return async function(X,ne){try{var de=await async function(pe){if(!w)try{var Ae=await m(pe);return new Uint8Array(Ae)}catch{}if(pe==ii&&w)pe=new Uint8Array(w);else{if(!y)throw"both async and sync fetching of the wasm failed";pe=y(pe)}return pe}(X);return await WebAssembly.instantiate(de,ne)}catch(pe){G(`failed to asynchronously prepare wasm: ${pe}`),is(pe)}}(O,$)}(b);return g(T.instance,T.module)}catch($){return r($),Promise.reject($)}}(),ik=g=>(ik=oe.Ea)(g),rk=()=>(rk=oe.Fa)();s._OrtInit=(g,b)=>(s._OrtInit=oe.Ga)(g,b),s._OrtGetLastError=(g,b)=>(s._OrtGetLastError=oe.Ha)(g,b),s._OrtCreateSessionOptions=(g,b,T,$,O,W,X,ne,de,pe)=>(s._OrtCreateSessionOptions=oe.Ia)(g,b,T,$,O,W,X,ne,de,pe),s._OrtAppendExecutionProvider=(g,b,T,$,O)=>(s._OrtAppendExecutionProvider=oe.Ja)(g,b,T,$,O),s._OrtAddFreeDimensionOverride=(g,b,T)=>(s._OrtAddFreeDimensionOverride=oe.Ka)(g,b,T),s._OrtAddSessionConfigEntry=(g,b,T)=>(s._OrtAddSessionConfigEntry=oe.La)(g,b,T),s._OrtReleaseSessionOptions=g=>(s._OrtReleaseSessionOptions=oe.Ma)(g),s._OrtCreateSession=(g,b,T)=>(s._OrtCreateSession=oe.Na)(g,b,T),s._OrtReleaseSession=g=>(s._OrtReleaseSession=oe.Oa)(g),s._OrtGetInputOutputCount=(g,b,T)=>(s._OrtGetInputOutputCount=oe.Pa)(g,b,T),s._OrtGetInputOutputMetadata=(g,b,T,$)=>(s._OrtGetInputOutputMetadata=oe.Qa)(g,b,T,$),s._OrtFree=g=>(s._OrtFree=oe.Ra)(g),s._OrtCreateTensor=(g,b,T,$,O,W)=>(s._OrtCreateTensor=oe.Sa)(g,b,T,$,O,W),s._OrtGetTensorData=(g,b,T,$,O)=>(s._OrtGetTensorData=oe.Ta)(g,b,T,$,O),s._OrtReleaseTensor=g=>(s._OrtReleaseTensor=oe.Ua)(g),s._OrtCreateRunOptions=(g,b,T,$)=>(s._OrtCreateRunOptions=oe.Va)(g,b,T,$),s._OrtAddRunConfigEntry=(g,b,T)=>(s._OrtAddRunConfigEntry=oe.Wa)(g,b,T),s._OrtReleaseRunOptions=g=>(s._OrtReleaseRunOptions=oe.Xa)(g),s._OrtCreateBinding=g=>(s._OrtCreateBinding=oe.Ya)(g),s._OrtBindInput=(g,b,T)=>(s._OrtBindInput=oe.Za)(g,b,T),s._OrtBindOutput=(g,b,T,$)=>(s._OrtBindOutput=oe._a)(g,b,T,$),s._OrtClearBoundOutputs=g=>(s._OrtClearBoundOutputs=oe.$a)(g),s._OrtReleaseBinding=g=>(s._OrtReleaseBinding=oe.ab)(g),s._OrtRunWithBinding=(g,b,T,$,O)=>(s._OrtRunWithBinding=oe.bb)(g,b,T,$,O),s._OrtRun=(g,b,T,$,O,W,X,ne)=>(s._OrtRun=oe.cb)(g,b,T,$,O,W,X,ne),s._OrtEndProfiling=g=>(s._OrtEndProfiling=oe.db)(g),s._JsepOutput=(g,b,T)=>(s._JsepOutput=oe.eb)(g,b,T),s._JsepGetNodeName=g=>(s._JsepGetNodeName=oe.fb)(g);var mx=()=>(mx=oe.gb)(),Ya=s._free=g=>(Ya=s._free=oe.hb)(g),Gv=s._malloc=g=>(Gv=s._malloc=oe.ib)(g),gx=(g,b,T,$,O,W)=>(gx=oe.kb)(g,b,T,$,O,W),sk=()=>(sk=oe.lb)(),ak=(g,b,T,$,O)=>(ak=oe.mb)(g,b,T,$,O),ok=g=>(ok=oe.nb)(g),yx=g=>(yx=oe.ob)(g),lk=(g,b)=>(lk=oe.pb)(g,b),uk=()=>(uk=oe.qb)(),ck=(g,b)=>(ck=oe.rb)(g,b),Kv=g=>(Kv=oe.sb)(g),_x=g=>(_x=oe.tb)(g),vx=()=>(vx=oe.ub)(),dk=s.dynCall_ii=(g,b)=>(dk=s.dynCall_ii=oe.vb)(g,b);s.dynCall_vii=(g,b,T)=>(s.dynCall_vii=oe.dynCall_vii)(g,b,T),s.dynCall_iiiii=(g,b,T,$,O)=>(s.dynCall_iiiii=oe.dynCall_iiiii)(g,b,T,$,O),s.dynCall_iii=(g,b,T)=>(s.dynCall_iii=oe.dynCall_iii)(g,b,T),s.dynCall_iiiiii=(g,b,T,$,O,W)=>(s.dynCall_iiiiii=oe.dynCall_iiiiii)(g,b,T,$,O,W),s.dynCall_iiiiiiii=(g,b,T,$,O,W,X,ne)=>(s.dynCall_iiiiiiii=oe.dynCall_iiiiiiii)(g,b,T,$,O,W,X,ne),s.dynCall_iiiiiii=(g,b,T,$,O,W,X)=>(s.dynCall_iiiiiii=oe.dynCall_iiiiiii)(g,b,T,$,O,W,X),s.dynCall_vi=(g,b)=>(s.dynCall_vi=oe.dynCall_vi)(g,b),s.dynCall_iiii=(g,b,T,$)=>(s.dynCall_iiii=oe.dynCall_iiii)(g,b,T,$),s.dynCall_i=g=>(s.dynCall_i=oe.dynCall_i)(g),s.dynCall_viiiiiiii=(g,b,T,$,O,W,X,ne,de)=>(s.dynCall_viiiiiiii=oe.dynCall_viiiiiiii)(g,b,T,$,O,W,X,ne,de),s.dynCall_viii=(g,b,T,$)=>(s.dynCall_viii=oe.dynCall_viii)(g,b,T,$),s.dynCall_viijj=(g,b,T,$,O)=>(s.dynCall_viijj=oe.dynCall_viijj)(g,b,T,$,O),s.dynCall_viiiiii=(g,b,T,$,O,W,X)=>(s.dynCall_viiiiii=oe.dynCall_viiiiii)(g,b,T,$,O,W,X),s.dynCall_viiii=(g,b,T,$,O)=>(s.dynCall_viiii=oe.dynCall_viiii)(g,b,T,$,O),s.dynCall_viiiii=(g,b,T,$,O,W)=>(s.dynCall_viiiii=oe.dynCall_viiiii)(g,b,T,$,O,W),s.dynCall_vfiii=(g,b,T,$,O)=>(s.dynCall_vfiii=oe.dynCall_vfiii)(g,b,T,$,O),s.dynCall_viiiiff=(g,b,T,$,O,W,X)=>(s.dynCall_viiiiff=oe.dynCall_viiiiff)(g,b,T,$,O,W,X),s.dynCall_viiiiiff=(g,b,T,$,O,W,X,ne)=>(s.dynCall_viiiiiff=oe.dynCall_viiiiiff)(g,b,T,$,O,W,X,ne),s.dynCall_ffff=(g,b,T,$)=>(s.dynCall_ffff=oe.dynCall_ffff)(g,b,T,$),s.dynCall_viiff=(g,b,T,$,O)=>(s.dynCall_viiff=oe.dynCall_viiff)(g,b,T,$,O),s.dynCall_fffffff=(g,b,T,$,O,W,X)=>(s.dynCall_fffffff=oe.dynCall_fffffff)(g,b,T,$,O,W,X),s.dynCall_jjjjjjj=(g,b,T,$,O,W,X)=>(s.dynCall_jjjjjjj=oe.dynCall_jjjjjjj)(g,b,T,$,O,W,X),s.dynCall_jjjjjj=(g,b,T,$,O,W)=>(s.dynCall_jjjjjj=oe.dynCall_jjjjjj)(g,b,T,$,O,W),s.dynCall_iijjii=(g,b,T,$,O,W)=>(s.dynCall_iijjii=oe.dynCall_iijjii)(g,b,T,$,O,W),s.dynCall_viiiiiiiiiiiii=(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut)=>(s.dynCall_viiiiiiiiiiiii=oe.dynCall_viiiiiiiiiiiii)(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut),s.dynCall_viiiiiiiiii=(g,b,T,$,O,W,X,ne,de,pe,Ae)=>(s.dynCall_viiiiiiiiii=oe.dynCall_viiiiiiiiii)(g,b,T,$,O,W,X,ne,de,pe,Ae),s.dynCall_viiiiiiiiiii=(g,b,T,$,O,W,X,ne,de,pe,Ae,Me)=>(s.dynCall_viiiiiiiiiii=oe.dynCall_viiiiiiiiiii)(g,b,T,$,O,W,X,ne,de,pe,Ae,Me),s.dynCall_viiiiiiiiiiii=(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe)=>(s.dynCall_viiiiiiiiiiii=oe.dynCall_viiiiiiiiiiii)(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe),s.dynCall_viiiiiiiiiiiiiiiiii=(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut,hn,ar,Xa,Zu,vm)=>(s.dynCall_viiiiiiiiiiiiiiiiii=oe.dynCall_viiiiiiiiiiiiiiiiii)(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut,hn,ar,Xa,Zu,vm),s.dynCall_viiiiiiiii=(g,b,T,$,O,W,X,ne,de,pe)=>(s.dynCall_viiiiiiiii=oe.dynCall_viiiiiiiii)(g,b,T,$,O,W,X,ne,de,pe),s.dynCall_viiiiiiiiiiiiiiiiiii=(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut,hn,ar,Xa,Zu,vm,wx)=>(s.dynCall_viiiiiiiiiiiiiiiiiii=oe.dynCall_viiiiiiiiiiiiiiiiiii)(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut,hn,ar,Xa,Zu,vm,wx),s.dynCall_viiiiiii=(g,b,T,$,O,W,X,ne)=>(s.dynCall_viiiiiii=oe.dynCall_viiiiiii)(g,b,T,$,O,W,X,ne),s.dynCall_viiiiiiiiiiiiiii=(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut,hn,ar)=>(s.dynCall_viiiiiiiiiiiiiii=oe.dynCall_viiiiiiiiiiiiiii)(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut,hn,ar),s.dynCall_jiji=(g,b,T,$)=>(s.dynCall_jiji=oe.dynCall_jiji)(g,b,T,$),s.dynCall_v=g=>(s.dynCall_v=oe.dynCall_v)(g),s.dynCall_iidiiii=(g,b,T,$,O,W,X)=>(s.dynCall_iidiiii=oe.dynCall_iidiiii)(g,b,T,$,O,W,X),s.dynCall_iiiiiiiii=(g,b,T,$,O,W,X,ne,de)=>(s.dynCall_iiiiiiiii=oe.dynCall_iiiiiiiii)(g,b,T,$,O,W,X,ne,de),s.dynCall_iiij=(g,b,T,$)=>(s.dynCall_iiij=oe.dynCall_iiij)(g,b,T,$),s.dynCall_iiiiiiiiii=(g,b,T,$,O,W,X,ne,de,pe)=>(s.dynCall_iiiiiiiiii=oe.dynCall_iiiiiiiiii)(g,b,T,$,O,W,X,ne,de,pe),s.dynCall_iiiiiiiiiiiii=(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe)=>(s.dynCall_iiiiiiiiiiiii=oe.dynCall_iiiiiiiiiiiii)(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe),s.dynCall_iiiiiiiiiii=(g,b,T,$,O,W,X,ne,de,pe,Ae)=>(s.dynCall_iiiiiiiiiii=oe.dynCall_iiiiiiiiiii)(g,b,T,$,O,W,X,ne,de,pe,Ae),s.dynCall_ji=(g,b)=>(s.dynCall_ji=oe.dynCall_ji)(g,b),s.dynCall_iijii=(g,b,T,$,O)=>(s.dynCall_iijii=oe.dynCall_iijii)(g,b,T,$,O),s.dynCall_vij=(g,b,T)=>(s.dynCall_vij=oe.dynCall_vij)(g,b,T),s.dynCall_viiijii=(g,b,T,$,O,W,X)=>(s.dynCall_viiijii=oe.dynCall_viiijii)(g,b,T,$,O,W,X),s.dynCall_viijiiiiiiiiiiiiii=(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut,hn,ar,Xa,Zu)=>(s.dynCall_viijiiiiiiiiiiiiii=oe.dynCall_viijiiiiiiiiiiiiii)(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut,hn,ar,Xa,Zu),s.dynCall_viiiji=(g,b,T,$,O,W)=>(s.dynCall_viiiji=oe.dynCall_viiiji)(g,b,T,$,O,W),s.dynCall_fiii=(g,b,T,$)=>(s.dynCall_fiii=oe.dynCall_fiii)(g,b,T,$),s.dynCall_viijii=(g,b,T,$,O,W)=>(s.dynCall_viijii=oe.dynCall_viijii)(g,b,T,$,O,W),s.dynCall_viij=(g,b,T,$)=>(s.dynCall_viij=oe.dynCall_viij)(g,b,T,$),s.dynCall_jiij=(g,b,T,$)=>(s.dynCall_jiij=oe.dynCall_jiij)(g,b,T,$),s.dynCall_fi=(g,b)=>(s.dynCall_fi=oe.dynCall_fi)(g,b),s.dynCall_fii=(g,b,T)=>(s.dynCall_fii=oe.dynCall_fii)(g,b,T),s.dynCall_jii=(g,b,T)=>(s.dynCall_jii=oe.dynCall_jii)(g,b,T),s.dynCall_dii=(g,b,T)=>(s.dynCall_dii=oe.dynCall_dii)(g,b,T),s.dynCall_fiiii=(g,b,T,$,O)=>(s.dynCall_fiiii=oe.dynCall_fiiii)(g,b,T,$,O),s.dynCall_fif=(g,b,T)=>(s.dynCall_fif=oe.dynCall_fif)(g,b,T),s.dynCall_jfi=(g,b,T)=>(s.dynCall_jfi=oe.dynCall_jfi)(g,b,T),s.dynCall_viiiiiiiiiiiiii=(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut,hn)=>(s.dynCall_viiiiiiiiiiiiii=oe.dynCall_viiiiiiiiiiiiii)(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut,hn),s.dynCall_viiiiiiiiiiiiiiiiiiii=(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut,hn,ar,Xa,Zu,vm,wx,m5)=>(s.dynCall_viiiiiiiiiiiiiiiiiiii=oe.dynCall_viiiiiiiiiiiiiiiiiiii)(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut,hn,ar,Xa,Zu,vm,wx,m5),s.dynCall_viiiiiiiiiiiiiiii=(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut,hn,ar,Xa)=>(s.dynCall_viiiiiiiiiiiiiiii=oe.dynCall_viiiiiiiiiiiiiiii)(g,b,T,$,O,W,X,ne,de,pe,Ae,Me,qe,ut,hn,ar,Xa),s.dynCall_iif=(g,b,T)=>(s.dynCall_iif=oe.dynCall_iif)(g,b,T),s.dynCall_jiiii=(g,b,T,$,O)=>(s.dynCall_jiiii=oe.dynCall_jiiii)(g,b,T,$,O),s.dynCall_jiii=(g,b,T,$)=>(s.dynCall_jiii=oe.dynCall_jiii)(g,b,T,$),s.dynCall_viif=(g,b,T,$)=>(s.dynCall_viif=oe.dynCall_viif)(g,b,T,$),s.dynCall_viiij=(g,b,T,$,O)=>(s.dynCall_viiij=oe.dynCall_viiij)(g,b,T,$,O),s.dynCall_viiiijii=(g,b,T,$,O,W,X,ne)=>(s.dynCall_viiiijii=oe.dynCall_viiiijii)(g,b,T,$,O,W,X,ne),s.dynCall_iiiiij=(g,b,T,$,O,W)=>(s.dynCall_iiiiij=oe.dynCall_iiiiij)(g,b,T,$,O,W),s.dynCall_iiiiid=(g,b,T,$,O,W)=>(s.dynCall_iiiiid=oe.dynCall_iiiiid)(g,b,T,$,O,W),s.dynCall_iiiiijj=(g,b,T,$,O,W,X)=>(s.dynCall_iiiiijj=oe.dynCall_iiiiijj)(g,b,T,$,O,W,X),s.dynCall_iiiiiijj=(g,b,T,$,O,W,X,ne)=>(s.dynCall_iiiiiijj=oe.dynCall_iiiiiijj)(g,b,T,$,O,W,X,ne);var hk=g=>(hk=oe.wb)(g),fk=()=>(fk=oe.xb)(),pk=g=>(pk=oe.yb)(g),mk=()=>(mk=oe.zb)();return function g(){if(0<Ha)ns=g;else if(u)i(s),Tt();else{for(;0<qp.length;)qp.shift()(s);0<Ha?ns=g:(s.calledRun=!0,U||(Tt(),i(s)))}}(),s.PTR_SIZE=4,a},Xz=pE,xP=(e=(n=globalThis.self)==null?void 0:n.name)==null?void 0:e.startsWith("em-pthread"),xP&&pE()}),mE,MT,EP,or,Qz,xw,AP,TP,gE,SP,yE,Jz,_E,Zz,oC=fe(()=>{aC(),mE=typeof location>"u"?void 0:location.origin,MT=import.meta.url>"file:"&&import.meta.url<"file;",EP=()=>{{if(MT){let n=URL;return new URL(new n("ort.bundle.min.mjs",import.meta.url).href,mE).href}return import.meta.url}},or=EP(),Qz=()=>{if(or&&!or.startsWith("blob:"))return or.substring(0,or.lastIndexOf("/")+1)},xw=(n,e)=>{try{let t=e??or;return(t?new URL(n,t):new URL(n)).origin===mE}catch{return!1}},AP=(n,e)=>{let t=e??or;try{return(t?new URL(n,t):new URL(n)).href}catch{return}},TP=(n,e)=>`${e??"./"}${n}`,gE=async n=>{let e=await(await fetch(n,{credentials:"same-origin"})).blob();return URL.createObjectURL(e)},SP=async n=>(await import(n)).default,yE=(MJ(),_y(Gz)).default,Jz=async()=>{if(!or)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(xw(or))return[void 0,yE()];let n=await gE(or);return[n,yE(n)]},_E=(OJ(),_y(Yz)).default,Zz=async(n,e,t,i)=>{let r=_E&&!(n||e);if(r)if(or)r=xw(or);else if(i&&!t)r=!0;else throw new Error("cannot determine the script source URL.");if(r)return[void 0,_E];{let s="ort-wasm-simd-threaded.jsep.mjs",a=n??AP(s,e),o=t&&a&&!xw(a,e),l=o?await gE(a):a??TP(s,e);return[o?l:void 0,await SP(l)]}}}),vE,Ew,Rm,wE,IP,CP,kP,lC,St,ih=fe(()=>{oC(),Ew=!1,Rm=!1,wE=!1,IP=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},CP=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},kP=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},lC=async n=>{if(Ew)return Promise.resolve();if(Rm)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(wE)throw new Error("previous call to 'initializeWebAssembly()' failed.");Rm=!0;let e=n.initTimeout,t=n.numThreads;if(n.simd!==!1){if(n.simd==="relaxed"){if(!kP())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!CP())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let i=IP();t>1&&!i&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+t+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),n.numThreads=t=1);let r=n.wasmPaths,s=typeof r=="string"?r:void 0,a=r==null?void 0:r.mjs,o=(a==null?void 0:a.href)??a,l=r==null?void 0:r.wasm,u=(l==null?void 0:l.href)??l,c=n.wasmBinary,[h,f]=await Zz(o,s,t>1,!!c||!!u),m=!1,y=[];if(e>0&&y.push(new Promise(_=>{setTimeout(()=>{m=!0,_()},e)})),y.push(new Promise((_,x)=>{let v={numThreads:t};if(c)v.wasmBinary=c;else if(u||s)v.locateFile=w=>u??s+w;else if(o&&o.indexOf("blob:")!==0)v.locateFile=w=>new URL(w,o).href;else if(h){let w=Qz();w&&(v.locateFile=E=>w+E)}f(v).then(w=>{Rm=!1,Ew=!0,vE=w,_(),h&&URL.revokeObjectURL(h)},w=>{Rm=!1,wE=!0,x(w)})})),await Promise.race(y),m)throw new Error(`WebAssembly backend initializing failed due to timeout: ${e}ms`)},St=()=>{if(Ew&&vE)return vE;throw new Error("WebAssembly is not initialized yet.")}}),Ns,Rb,_t,uC=fe(()=>{ih(),Ns=(n,e)=>{let t=St(),i=t.lengthBytesUTF8(n)+1,r=t._malloc(i);return t.stringToUTF8(n,r,i),e.push(r),r},Rb=(n,e,t,i)=>{if(typeof n=="object"&&n!==null){if(t.has(n))throw new Error("Circular reference in options");t.add(n)}Object.entries(n).forEach(([r,s])=>{let a=e?e+r:r;if(typeof s=="object")Rb(s,a+".",t,i);else if(typeof s=="string"||typeof s=="number")i(a,s.toString());else if(typeof s=="boolean")i(a,s?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof s}`)})},_t=n=>{let e=St(),t=e.stackSave();try{let i=e.PTR_SIZE,r=e.stackAlloc(2*i);e._OrtGetLastError(r,r+i);let s=Number(e.getValue(r,i===4?"i32":"i64")),a=e.getValue(r+i,"*"),o=a?e.UTF8ToString(a):"";throw new Error(`${n} ERROR_CODE: ${s}, ERROR_MESSAGE: ${o}`)}finally{e.stackRestore(t)}}}),eV,LJ=fe(()=>{ih(),uC(),eV=n=>{let e=St(),t=0,i=[],r=n||{};try{if((n==null?void 0:n.logSeverityLevel)===void 0)r.logSeverityLevel=2;else if(typeof n.logSeverityLevel!="number"||!Number.isInteger(n.logSeverityLevel)||n.logSeverityLevel<0||n.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${n.logSeverityLevel}`);if((n==null?void 0:n.logVerbosityLevel)===void 0)r.logVerbosityLevel=0;else if(typeof n.logVerbosityLevel!="number"||!Number.isInteger(n.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${n.logVerbosityLevel}`);(n==null?void 0:n.terminate)===void 0&&(r.terminate=!1);let s=0;return(n==null?void 0:n.tag)!==void 0&&(s=Ns(n.tag,i)),t=e._OrtCreateRunOptions(r.logSeverityLevel,r.logVerbosityLevel,!!r.terminate,s),t===0&&_t("Can't create run options."),(n==null?void 0:n.extra)!==void 0&&Rb(n.extra,"",new WeakSet,(a,o)=>{let l=Ns(a,i),u=Ns(o,i);e._OrtAddRunConfigEntry(t,l,u)!==0&&_t(`Can't set a run config entry: ${a} - ${o}.`)}),[t,i]}catch(s){throw t!==0&&e._OrtReleaseRunOptions(t),i.forEach(a=>e._free(a)),s}}}),$P,RP,PP,Pm,NP,tV,FJ=fe(()=>{ih(),uC(),$P=n=>{switch(n){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${n}`)}},RP=n=>{switch(n){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${n}`)}},PP=n=>{n.extra||(n.extra={}),n.extra.session||(n.extra.session={});let e=n.extra.session;e.use_ort_model_bytes_directly||(e.use_ort_model_bytes_directly="1"),n.executionProviders&&n.executionProviders.some(t=>(typeof t=="string"?t:t.name)==="webgpu")&&(n.enableMemPattern=!1)},Pm=(n,e,t,i)=>{let r=Ns(e,i),s=Ns(t,i);St()._OrtAddSessionConfigEntry(n,r,s)!==0&&_t(`Can't set a session config entry: ${e} - ${t}.`)},NP=async(n,e,t)=>{for(let i of e){let r=typeof i=="string"?i:i.name,s=[];switch(r){case"webnn":if(r="WEBNN",typeof i!="string"){let c=i==null?void 0:i.deviceType;c&&Pm(n,"deviceType",c,t)}break;case"webgpu":if(r="JS",typeof i!="string"){let c=i;if(c!=null&&c.preferredLayout){if(c.preferredLayout!=="NCHW"&&c.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${c.preferredLayout}`);Pm(n,"preferredLayout",c.preferredLayout,t)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${r}`)}let a=Ns(r,t),o=s.length,l=0,u=0;if(o>0){l=St()._malloc(o*St().PTR_SIZE),t.push(l),u=St()._malloc(o*St().PTR_SIZE),t.push(u);for(let c=0;c<o;c++)St().setValue(l+c*St().PTR_SIZE,s[c][0],"*"),St().setValue(u+c*St().PTR_SIZE,s[c][1],"*")}await St()._OrtAppendExecutionProvider(n,a,l,u,o)!==0&&_t(`Can't append execution provider: ${r}.`)}},tV=async n=>{let e=St(),t=0,i=[],r=n||{};PP(r);try{let s=$P(r.graphOptimizationLevel??"all"),a=RP(r.executionMode??"sequential"),o=typeof r.logId=="string"?Ns(r.logId,i):0,l=r.logSeverityLevel??2;if(!Number.isInteger(l)||l<0||l>4)throw new Error(`log severity level is not valid: ${l}`);let u=r.logVerbosityLevel??0;if(!Number.isInteger(u)||u<0||u>4)throw new Error(`log verbosity level is not valid: ${u}`);let c=typeof r.optimizedModelFilePath=="string"?Ns(r.optimizedModelFilePath,i):0;if(t=e._OrtCreateSessionOptions(s,!!r.enableCpuMemArena,!!r.enableMemPattern,a,!!r.enableProfiling,0,o,l,u,c),t===0&&_t("Can't create session options."),r.executionProviders&&await NP(t,r.executionProviders,i),r.enableGraphCapture!==void 0){if(typeof r.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${r.enableGraphCapture}`);Pm(t,"enableGraphCapture",r.enableGraphCapture.toString(),i)}if(r.freeDimensionOverrides)for(let[h,f]of Object.entries(r.freeDimensionOverrides)){if(typeof h!="string")throw new Error(`free dimension override name must be a string: ${h}`);if(typeof f!="number"||!Number.isInteger(f)||f<0)throw new Error(`free dimension override value must be a non-negative integer: ${f}`);let m=Ns(h,i);e._OrtAddFreeDimensionOverride(t,m,f)!==0&&_t(`Can't set a free dimension override: ${h} - ${f}.`)}return r.extra!==void 0&&Rb(r.extra,"",new WeakSet,(h,f)=>{Pm(t,h,f,i)}),[t,i]}catch(s){throw t!==0&&e._OrtReleaseSessionOptions(t)!==0&&_t("Can't release session options."),i.forEach(a=>e._free(a)),s}}}),fc,Ro,pc,Y1,Pb,cC,dC,OT,Oe=fe(()=>{fc=n=>{switch(n){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${n}`)}},Ro=n=>{switch(n){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${n}`)}},pc=(n,e)=>{let t=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][n],i=typeof e=="number"?e:e.reduce((r,s)=>r*s,1);return t>0?Math.ceil(i*t):void 0},Y1=n=>{switch(n){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${n}`)}},Pb=n=>{switch(n){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${n}`)}},cC=n=>n==="float32"||n==="float16"||n==="int32"||n==="int64"||n==="uint32"||n==="uint8"||n==="bool"||n==="uint4"||n==="int4",dC=n=>n==="float32"||n==="float16"||n==="int32"||n==="int64"||n==="uint32"||n==="uint64"||n==="int8"||n==="uint8"||n==="bool"||n==="uint4"||n==="int4",OT=n=>{switch(n){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${n}`)}}}),hC,nV=fe(()=>{aC(),hC=async n=>{if(typeof n=="string"){let e=await fetch(n);if(!e.ok)throw new Error(`failed to load external data file: ${n}`);let t=e.headers.get("Content-Length"),i=t?parseInt(t,10):0;if(i<1073741824)return new Uint8Array(await e.arrayBuffer());{if(!e.body)throw new Error(`failed to load external data file: ${n}, no response body.`);let r=e.body.getReader(),s;try{s=new ArrayBuffer(i)}catch(o){if(o instanceof RangeError){let l=Math.ceil(i/65536);s=new WebAssembly.Memory({initial:l,maximum:l}).buffer}else throw o}let a=0;for(;;){let{done:o,value:l}=await r.read();if(o)break;let u=l.byteLength;new Uint8Array(s,a,u).set(l),a+=u}return new Uint8Array(s,0,i)}}else return n instanceof Blob?new Uint8Array(await n.arrayBuffer()):n instanceof Uint8Array?n:new Uint8Array(n)}}),DP,MP,OP,LP,fC,FP,et,el=fe(()=>{Oe(),DP=["V","I","W","E","F"],MP=(n,e)=>{console.log(`[${DP[n]},${new Date().toISOString()}]${e}`)},fC=(n,e)=>{OP=n,LP=e},FP=(n,e)=>{let t=Pb(n),i=Pb(OP);t>=i&&MP(t,typeof e=="function"?e():e)},et=(...n)=>{LP&&FP(...n)}}),zP,Rp,ie,Nb,iV,rV,sV,je=fe(()=>{zP=class{static calcMatMulShape(n,e){return n[1]!==e[0]?void 0:[n[0],e[1]]}},Rp=class{static calcShape(n,e,t=!1){let i=n.length,r=e.length;if(i===0)return e;if(r===0)return n;let s=Math.max(n.length,e.length),a=new Array(s);if(t){if(i<2||r<2)return;let o=zP.calcMatMulShape([n[i-2],n[i-1]],[e[r-2],e[r-1]]);if(o===void 0)return;[a[s-2],a[s-1]]=o}for(let o=t?3:1;o<=s;o++){let l=i-o<0?1:n[i-o],u=r-o<0?1:e[r-o];if(l!==u&&l>1&&u>1)return;let c=Math.max(l,u);if(l&&u)a[s-o]=Math.max(l,u);else{if(c>1)return;a[s-o]=0}}return a}static isValidBroadcast(n,e){let t=n.length,i=e.length;if(t>i)return!1;for(let r=1;r<=t;r++)if(n[t-r]!==1&&n[t-r]!==e[i-r])return!1;return!0}},ie=class l0{static size(e){return l0.getSizeFromDimensionRange(e,0,e.length)}static convertShape(e,t=4){let i=e.length;if(i===0)return[];let r=new Array(i),s=i-1;for(;s>=0;){if(e[s]%t===0){r[s]=e[s]/t;break}if(t%e[s]!==0)throw new Error("cannot convert shape");r[s]=1,t/=e[s],s--}for(s--;s>=0;s--)r[s]=e[s];return r}static sizeFromDimension(e,t){if(t<0||t>e.length)throw new Error(`invalid dimension of ${t} for sizeFromDimension as Tensor has ${e.length} dimensions.`);return l0.getSizeFromDimensionRange(e,t,e.length)}static sizeToDimension(e,t){if(t<0||t>e.length)throw new Error(`invalid dimension of ${t} for sizeToDimension as Tensor has ${e.length} dimensions.`);return l0.getSizeFromDimensionRange(e,0,t)}static getSizeFromDimensionRange(e,t,i){let r=1;for(let s=t;s<i;s++){if(e[s]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");r*=Number(e[s])}return r}static computeStrides(e){let t=e.length;if(t===0)return[];if(t===1)return[1];let i=new Array(t);i[t-1]=1,i[t-2]=e[t-1];for(let r=t-3;r>=0;--r)i[r]=i[r+1]*e[r+1];return i}static normalizeAxis(e,t){if(e<-t&&e>=t)throw new Error("unsupported axis for this operation.");return e<0?e+t:e}static normalizeAxes(e,t){return e.map(i=>this.normalizeAxis(i,t??e.length))}static sortBasedOnPerm(e,t){return t?t.map(i=>e[i]):e.slice().reverse()}static padShape(e,t){let i=e.length;return e.map((r,s)=>r+t[s]+t[s+i])}static areEqual(e,t){return e.length!==t.length?!1:e.every((i,r)=>i===t[r])}},Nb=class rg{static adjustPoolAttributes(e,t,i,r,s,a){if(!e&&i.length!==t.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(e)for(let o=0;o<t.length-2;o++)o>=i.length?i.push(t[o+2]):i[o]=t[o+2];for(let o=0;o<i.length;o++)if(o<r.length){if(r[o]<0)throw new Error("strides should be greater than or equal to 1")}else r.push(1);for(let o=0;o<i.length;o++)if(o<s.length){if(s[o]<0)throw new Error("dilations should be greater than or equal to 1")}else s.push(1);for(let o=0;o<i.length*2;o++)if(o<a.length){if(a[o]<0)throw new Error("pad should be greater than or equal to 1")}else a.push(0);for(let o=0;o<i.length;o++){if(i[o]<=0)throw new Error("kernel shapes need to be greater than 0");if(a[o]>=i[o]||a[o+i.length]>=i[o])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(e,t,i,r,s,a,o){if(o){if(s.length!==2*(e.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(t.length!==e.length-2)throw new Error("length of strides should be the length of data dimensions");if(r.length!==e.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let l=0;l<e.length-2;l++)rg.adjustPadAndReturnShape(e[l+(a?1:2)],t[l],i[l],r[l],s,l,l+e.length-2,o)}}static computePoolOutputShape(e,t,i,r,s,a,o){if(t.length<=0)throw new Error("input shape must be of size greater than 0");let l=[t[0],t[1]];return rg.computeShapeHelper(e,t,l,i,r,s,a,o),l}static computeConvOutputShape(e,t,i,r,s,a,o){if(e.length<=0||t.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let l=[e[0],t[0]];return rg.computeShapeHelper(!1,e,l,i,r,s,a,o),l}static computeShapeHelper(e,t,i,r,s,a,o,l){if(e)for(let u=0;u<t.length-2;u++)i.push(1);else for(let u=0;u<t.length-2;u++)i.push(rg.adjustPadAndReturnShape(t[u+2],r[u],s[u],a[u],o,u,u+t.length-2,l))}static adjustPadAndReturnShape(e,t,i,r,s,a,o,l){let u=i*(r-1)+1;if(l&&l!=="NOTSET")switch(l){case"VALID":return s[a]=0,s[o]=0,Math.floor((e-u)/t+1);case"SAME_LOWER":case"SAME_UPPER":if(i!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let c=((e+t-1)/t-1)*t+r-e;return s[a]=Math.floor(l==="SAME_LOWER"?(c+1)/2:c/2),s[o]=c-s[a],Math.floor((e+c-r)/t+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((e+s[a]+s[o]-u)/t+1)}},iV=class{static getShapeOfGemmResult(n,e,t,i,r){if(n.length!==2||t.length!==2)throw new Error("shape need to be of size 2");let s,a,o;e?(s=n[1],a=n[0]):(s=n[0],a=n[1]);let l=-1;if(i?(o=t[0],l=1):(o=t[1],l=0),t[l]!==a)throw new Error("dimension mismatch");if(s<=0||o<=0||a<=0)throw new Error("invalid shape specified");if(r&&!Rp.isValidBroadcast(r,[s,o]))throw new Error("gemm: invalid bias shape for broadcast");return[s,o,a]}},rV=-34028234663852886e22,sV=34028234663852886e22}),pC,aV=fe(()=>{Oe(),pC=(n,e)=>new(Y1(e))(n)}),bE,LT,xE,VP,EE,jP,AE,TE,SE,BP,oV,zJ=fe(()=>{Oe(),el(),bE=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),LT=(n,e)=>{if(e==="int32")return n;let t=bE.get(e);if(!t)throw new Error(`WebNN backend does not support data type: ${e}`);let i=t/8;if(n.byteLength%i!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${i}.`);let r=n.byteLength/i,s=new(Y1(e))(n.buffer,n.byteOffset,r);switch(e){case"int64":case"uint64":{let a=new Int32Array(r);for(let o=0;o<r;o++){let l=s[o];if(l>2147483647n||l<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");a[o]=Number(l)}return new Uint8Array(a.buffer)}case"int8":case"uint8":case"uint32":{if(e==="uint32"&&s.some(o=>o>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let a=Int32Array.from(s,Number);return new Uint8Array(a.buffer)}default:throw new Error(`Unsupported data conversion from ${e} to 'int32'`)}},xE=(n,e)=>{if(e==="int32")return n;if(n.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let t=n.byteLength/4,i=new Int32Array(n.buffer,n.byteOffset,t);switch(e){case"int64":{let r=BigInt64Array.from(i,BigInt);return new Uint8Array(r.buffer)}case"uint64":{if(i.some(s=>s<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let r=BigUint64Array.from(i,BigInt);return new Uint8Array(r.buffer)}case"int8":{if(i.some(s=>s<-128||s>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let r=Int8Array.from(i,Number);return new Uint8Array(r.buffer)}case"uint8":{if(i.some(r=>r<0||r>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(i,Number)}case"uint32":{if(i.some(s=>s<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let r=Uint32Array.from(i,Number);return new Uint8Array(r.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${e}`)}},VP=1,EE=()=>VP++,jP=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),AE=(n,e)=>{let t=bE.get(n);if(!t)throw new Error(`WebNN backend does not support data type: ${n}`);return e.length>0?Math.ceil(e.reduce((i,r)=>i*r)*t/8):0},TE=class{constructor(n){this.isDataConverted=!1;let{sessionId:e,context:t,tensor:i,dataType:r,shape:s,fallbackDataType:a}=n;this.sessionId=e,this.mlContext=t,this.mlTensor=i,this.dataType=r,this.tensorShape=s,this.fallbackDataType=a}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return AE(this.dataType,this.tensorShape)}destroy(){et("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(n){this.mlContext.writeTensor(this.mlTensor,n)}async read(n){if(this.fallbackDataType){let e=await this.mlContext.readTensor(this.mlTensor),t=xE(new Uint8Array(e),this.dataType);if(n){(n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)).set(t);return}else return t.buffer}else return n?this.mlContext.readTensor(this.mlTensor,n):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(n,e,t){return this.mlContext===n&&this.dataType===e&&this.tensorShape.length===t.length&&this.tensorShape.every((i,r)=>i===t[r])}setIsDataConverted(n){this.isDataConverted=n}},SE=class{constructor(n,e){this.tensorManager=n,this.wrapper=e}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(n,e,t,i){let r=this.tensorManager.getMLContext(n),s;if(!r.opSupportLimits().input.dataTypes.includes(e)){if(s=jP.get(e),!s||!r.opSupportLimits().input.dataTypes.includes(s))throw new Error(`WebNN backend does not support data type: ${e}`);et("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${e} to ${s}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(r,e,t))return this.wrapper.tensor;if(i){if(this.wrapper.byteLength!==AE(e,t))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let a=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(n,e,t,a,!0,!0,s),i&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(n){let e=n;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")e=LT(n,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(n.byteLength===this.wrapper.byteLength){this.wrapper.write(e);return}else et("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(e):this.activeUpload=new Uint8Array(e)}async download(n){var e,t;if(this.activeUpload){let i=(e=this.wrapper)!=null&&e.isDataConverted?xE(this.activeUpload,(t=this.wrapper)==null?void 0:t.type):this.activeUpload;if(n){n instanceof ArrayBuffer?new Uint8Array(n).set(i):new Uint8Array(n.buffer,n.byteOffset,n.byteLength).set(i);return}else return i.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return n?this.wrapper.read(n):this.wrapper.read()}},BP=class{constructor(n){this.backend=n,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(n){let e=this.backend.getMLContext(n);if(!e)throw new Error("MLContext not found for session.");return e}reserveTensorId(){let n=EE();return this.tensorTrackersById.set(n,new SE(this)),n}releaseTensorId(n){let e=this.tensorTrackersById.get(n);e&&(this.tensorTrackersById.delete(n),e.tensorWrapper&&this.releaseTensor(e.tensorWrapper))}async ensureTensor(n,e,t,i,r){et("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${e}, dataType: ${t}, shape: ${i}, copyOld: ${r}}`);let s=this.tensorTrackersById.get(e);if(!s)throw new Error("Tensor not found.");return s.ensureTensor(n,t,i,r)}upload(n,e){let t=this.tensorTrackersById.get(n);if(!t)throw new Error("Tensor not found.");t.upload(e)}async download(n,e){et("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${n}, dstBuffer: ${e==null?void 0:e.byteLength}}`);let t=this.tensorTrackersById.get(n);if(!t)throw new Error("Tensor not found.");return t.download(e)}releaseTensorsForSession(n){for(let e of this.freeTensors)e.sessionId===n&&e.destroy();this.freeTensors=this.freeTensors.filter(e=>e.sessionId!==n)}registerTensor(n,e,t,i){let r=this.getMLContext(n),s=EE(),a=new TE({sessionId:n,context:r,tensor:e,dataType:t,shape:i});return this.tensorTrackersById.set(s,new SE(this,a)),this.externalTensors.add(a),s}async getCachedTensor(n,e,t,i,r,s,a){let o=this.getMLContext(n);for(let[u,c]of this.freeTensors.entries())if(c.canReuseTensor(o,e,t)){et("verbose",()=>`[WebNN] Reusing tensor {dataType: ${e}, ${a?`fallbackDataType: ${a},`:""} shape: ${t}`);let h=this.freeTensors.splice(u,1)[0];return h.sessionId=n,h}et("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${e}, ${a?`fallbackDataType: ${a},`:""} shape: ${t}}`);let l=await o.createTensor({dataType:a??e,shape:t,dimensions:t,usage:i,writable:r,readable:s});return new TE({sessionId:n,context:o,tensor:l,dataType:e,shape:t,fallbackDataType:a})}releaseTensor(n){this.externalTensors.has(n)&&this.externalTensors.delete(n),this.freeTensors.push(n)}},oV=(...n)=>new BP(...n)}),Nm,UP,lV,VJ=fe(()=>{Oe(),ih(),aV(),zJ(),el(),Nm=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),UP=(n,e)=>{if(n===e)return!0;if(n===void 0||e===void 0)return!1;let t=Object.keys(n).sort(),i=Object.keys(e).sort();return t.length===i.length&&t.every((r,s)=>r===i[s]&&n[r]===e[r])},lV=class{constructor(n){this.tensorManager=oV(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,fC(n.logLevel,!!n.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(n){et("verbose",()=>`[WebNN] onRunStart {sessionId: ${n}}`),this.activeSessionId=n}onRunEnd(n){et("verbose",()=>`[WebNN] onRunEnd {sessionId: ${n}}`);let e=this.temporarySessionTensorIds.get(n);if(e){for(let t of e)et("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${t}}`),this.tensorManager.releaseTensorId(t);this.temporarySessionTensorIds.delete(n),this.activeSessionId=void 0}}async createMLContext(n){if(n instanceof GPUDevice){let t=this.mlContextCache.findIndex(i=>i.gpuDevice===n);if(t!==-1)return this.mlContextCache[t].mlContext;{let i=await navigator.ml.createContext(n);return this.mlContextCache.push({gpuDevice:n,mlContext:i}),i}}else if(n===void 0){let t=this.mlContextCache.findIndex(i=>i.options===void 0&&i.gpuDevice===void 0);if(t!==-1)return this.mlContextCache[t].mlContext;{let i=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:i}),i}}let e=this.mlContextCache.findIndex(t=>UP(t.options,n));if(e!==-1)return this.mlContextCache[e].mlContext;{let t=await navigator.ml.createContext(n);return this.mlContextCache.push({options:n,mlContext:t}),t}}registerMLContext(n,e){this.mlContextBySessionId.set(n,e);let t=this.sessionIdsByMLContext.get(e);t||(t=new Set,this.sessionIdsByMLContext.set(e,t)),t.add(n),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(n,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(n,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(n){this.sessionGraphInputs.delete(n),this.sessionGraphOutputs.delete(n);let e=this.mlContextBySessionId.get(n);if(!e)return;this.tensorManager.releaseTensorsForSession(n),this.mlContextBySessionId.delete(n);let t=this.sessionIdsByMLContext.get(e);if(t.delete(n),t.size===0){this.sessionIdsByMLContext.delete(e);let i=this.mlContextCache.findIndex(r=>r.mlContext===e);i!==-1&&this.mlContextCache.splice(i,1)}}getMLContext(n){return this.mlContextBySessionId.get(n)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(n){et("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${n}}`),this.tensorManager.releaseTensorId(n)}async ensureTensor(n,e,t,i,r){let s=Nm.get(t);if(!s)throw new Error(`Unsupported ONNX data type: ${t}`);return this.tensorManager.ensureTensor(n??this.currentSessionId,e,s,i,r)}async createTemporaryTensor(n,e,t){et("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${e}, shape: ${t}}`);let i=Nm.get(e);if(!i)throw new Error(`Unsupported ONNX data type: ${e}`);let r=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(n,r,i,t,!1);let s=this.temporarySessionTensorIds.get(n);return s?s.push(r):this.temporarySessionTensorIds.set(n,[r]),r}uploadTensor(n,e){if(!St().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");et("verbose",()=>`[WebNN] uploadTensor {tensorId: ${n}, data: ${e.byteLength}}`),this.tensorManager.upload(n,e)}async downloadTensor(n,e){return this.tensorManager.download(n,e)}createMLTensorDownloader(n,e){return async()=>{let t=await this.tensorManager.download(n);return pC(t,e)}}registerMLTensor(n,e,t,i){let r=Nm.get(t);if(!r)throw new Error(`Unsupported ONNX data type: ${t}`);let s=this.tensorManager.registerTensor(n,e,r,i);return et("verbose",()=>`[WebNN] registerMLTensor {tensor: ${e}, dataType: ${r}, dimensions: ${i}} -> {tensorId: ${s}}`),s}registerMLConstant(n,e,t,i,r,s,a=!1){if(!s)throw new Error("External mounted files are not available.");let o=n;n.startsWith("./")&&(o=n.substring(2));let l=s.get(o);if(!l)throw new Error(`File with name ${o} not found in preloaded files.`);if(e+t>l.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let u=l.slice(e,e+t).buffer,c;switch(r.dataType){case"float32":c=new Float32Array(u);break;case"float16":c=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(u):new Uint16Array(u);break;case"int32":c=new Int32Array(u);break;case"uint32":c=new Uint32Array(u);break;case"int64":if(a){let h=LT(new Uint8Array(u),"int64");c=new Int32Array(h.buffer),r.dataType="int32"}else c=new BigInt64Array(u);break;case"uint64":c=new BigUint64Array(u);break;case"int8":c=new Int8Array(u);break;case"int4":case"uint4":case"uint8":c=new Uint8Array(u);break;default:throw new Error(`Unsupported data type: ${r.dataType} in creating WebNN Constant from external data.`)}return et("verbose",()=>`[WebNN] registerMLConstant {dataType: ${r.dataType}, shape: ${r.shape}}} ${a?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),i.constant(r,c)}registerGraphInput(n){this.temporaryGraphInputs.push(n)}registerGraphOutput(n){this.temporaryGraphOutputs.push(n)}isGraphInput(n,e){let t=this.sessionGraphInputs.get(n);return t?t.includes(e):!1}isGraphOutput(n,e){let t=this.sessionGraphOutputs.get(n);return t?t.includes(e):!1}isGraphInputOutputTypeSupported(n,e,t=!0){let i=this.mlContextBySessionId.get(n),r=Nm.get(fc(e));return typeof r>"u"?!1:t?!!(i!=null&&i.opSupportLimits().input.dataTypes.includes(r)):!!(i!=null&&i.opSupportLimits().output.dataTypes.includes(r))}flush(){}}}),mC=fe(()=>{}),IE,Aw,Tw,HP,WP,CE,FT,qP,uV,jJ=fe(()=>{el(),mC(),IE=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),Aw=[],Tw=n=>Math.ceil(Number(n)/16)*16,HP=n=>{for(let e=0;e<Aw.length;e++){let t=Aw[e];if(n<=t)return t}return Math.ceil(n/16)*16},WP=1,CE=()=>WP++,FT=async(n,e,t,i)=>{let r=Tw(t),s=n.device.createBuffer({size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let a=n.getCommandEncoder();n.endComputePass(),a.copyBufferToBuffer(e,0,s,0,r),n.flush(),await s.mapAsync(GPUMapMode.READ);let o=s.getMappedRange();if(i){let l=i();return l.set(new Uint8Array(o,0,t)),l}else return new Uint8Array(o.slice(0,t))}finally{s.destroy()}},qP=class{constructor(n){this.backend=n,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[e]of IE)Aw.push(e),this.freeBuffers.set(e,[]),this.freeUniformBuffers.set(e,[]);this.sessionCount=0}upload(n,e){let t=e.buffer,i=e.byteOffset,r=e.byteLength,s=Tw(r),a=this.storageCache.get(n);if(!a)throw new Error("gpu data for uploading does not exist");if(Number(a.originalSize)!==r)throw new Error(`inconsistent data size. gpu data size=${a.originalSize}, data size=${r}`);let o=this.backend.device.createBuffer({mappedAtCreation:!0,size:s,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),l=o.getMappedRange();new Uint8Array(l).set(new Uint8Array(t,i,r)),o.unmap();let u=this.backend.device.createCommandEncoder();u.copyBufferToBuffer(o,0,a.gpuData.buffer,0,s),this.backend.device.queue.submit([u.finish()]),o.destroy(),et("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${n})`)}memcpy(n,e){let t=this.storageCache.get(n);if(!t)throw new Error("source gpu data for memcpy does not exist");let i=this.storageCache.get(e);if(!i)throw new Error("destination gpu data for memcpy does not exist");if(t.originalSize!==i.originalSize)throw new Error("inconsistent source and destination gpu data size");let r=Tw(t.originalSize),s=this.backend.getCommandEncoder();this.backend.endComputePass(),s.copyBufferToBuffer(t.gpuData.buffer,0,i.gpuData.buffer,0,r)}registerExternalBuffer(n,e,t){let i;if(t){if(i=t[0],n===t[1])return et("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${e}) => id=${i}, buffer is the same, skip.`),i;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else i=CE();return this.storageCache.set(i,{gpuData:{id:i,type:0,buffer:n},originalSize:e}),et("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${e}) => id=${i}, registered.`),i}unregisterExternalBuffer(n){n!==void 0&&(this.storageCache.delete(n),et("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${n}`))}create(n,e=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let t=HP(n),i,r=(e&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,s=(e&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(r||s){let o=(r?this.freeBuffers:this.freeUniformBuffers).get(t);o?o.length>0?i=o.pop():i=this.backend.device.createBuffer({size:t,usage:e}):i=this.backend.device.createBuffer({size:t,usage:e})}else i=this.backend.device.createBuffer({size:t,usage:e});let a={id:CE(),type:0,buffer:i};return this.storageCache.set(a.id,{gpuData:a,originalSize:Number(n)}),et("verbose",()=>`[WebGPU] GpuDataManager.create(size=${n}) => id=${a.id}`),a}get(n){var e;return(e=this.storageCache.get(n))==null?void 0:e.gpuData}release(n){let e=typeof n=="bigint"?Number(n):n,t=this.storageCache.get(e);if(!t){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return et("verbose",()=>`[WebGPU] GpuDataManager.release(id=${e}), gpuDataId=${t.gpuData.id}`),this.storageCache.delete(e),this.buffersPending.push(t.gpuData.buffer),t.originalSize}async download(n,e){let t=this.storageCache.get(Number(n));if(!t)throw new Error("data does not exist");await FT(this.backend,t.gpuData.buffer,t.originalSize,e)}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let n of this.buffersPending){let e=IE.get(n.size);if((n.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let t=this.freeBuffers.get(n.size)||[];e===void 0||t.length>=e?n.destroy():t.push(n)}else if((n.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let t=this.freeUniformBuffers.get(n.size)||[];e===void 0||t.length>=e?n.destroy():t.push(n)}else n.destroy()}this.buffersPending=[]}else{let n=this.capturedPendingBuffers.get(this.backend.currentSessionId);n||(n=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,n));for(let e of this.buffersPending)n.push(e);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(n=>{n.forEach(e=>{e.destroy()})}),this.freeUniformBuffers.forEach(n=>{n.forEach(e=>{e.destroy()})}),this.storageCache.forEach(n=>{n.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(n=>{n.forEach(e=>{e.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(n){let e=this.capturedPendingBuffers.get(n);e&&(e.forEach(t=>{t.destroy()}),this.capturedPendingBuffers.delete(n)),this.sessionCount-=1,this.sessionCount===0&&(et("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(t=>{t.gpuData.buffer.destroy()}),this.storageCache=new Map)}},uV=(...n)=>new qP(...n)}),GP,ht,Zt=fe(()=>{GP=class{constructor(n){Object.assign(this,n)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(n=>`${this[n]}`).join(";")),this.key}},ht=n=>new GP(n)}),Pp,Sw,$n,mi,Re,Wt,zT,Kh,Au,$e,Dm,le,Te,cV,gC,KP,dV,Be=fe(()=>{Oe(),je(),Pp=64,Sw=(n,e)=>{if(e===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(n)){case 10:return e>1?`vec${e}<f16>`:"f16";case 1:return e>1?`vec${e}<f32>`:"f32";case 6:return e>1?`vec${e}<i32>`:"i32";case 12:return e>1?`vec${e}<u32>`:"u32";case 7:if(e>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(e>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(e!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${n}`)}},$n=(n,e=1)=>{let t=Sw(n,e);return typeof t=="string"?t:t[0]},mi=(n,e=1)=>{let t=Sw(n,e);return typeof t=="string"?t:t[1]},Re=(...n)=>{let e=[];return n.forEach(t=>{t.length!==0&&e.push({type:12,data:t},{type:12,data:ie.computeStrides(t)})}),e},Wt=n=>n%4===0?4:n%2===0?2:1,zT=(n="f32",e,t="0")=>!e||e===1?`${n}(${t})`:`vec${e}<${n}>(${t})`,Kh=(n,e,t)=>n==="f32"?t:e===1?`f32(${t})`:`vec${e}<f32>(${t})`,Au=(n,e)=>e===4?`(${n}.x + ${n}.y + ${n}.z + ${n}.w)`:e===2?`(${n}.x + ${n}.y)`:e===3?`(${n}.x + ${n}.y + ${n}.z)`:n,$e=(n,e,t,i)=>n.startsWith("uniforms.")&&t>4?typeof e=="string"?i==="f16"?`${n}[(${e}) / 8][(${e}) % 8 / 4][(${e}) % 8 % 4]`:`${n}[(${e}) / 4][(${e}) % 4]`:i==="f16"?`${n}[${Math.floor(e/8)}][${Math.floor(e%8/4)}][${e%8%4}]`:`${n}[${Math.floor(e/4)}][${e%4}]`:t>1?`${n}[${e}]`:n,Dm=(n,e,t,i,r)=>{let s=typeof t=="number",a=s?t:t.length,o=[...new Array(a).keys()],l=a<2?"u32":a<=4?`vec${a}<u32>`:`array<u32, ${a}>`,u=Sw(e,r),c=typeof u=="string"?u:u[1],h=typeof u=="string"?u:u[0],f={indices:l,value:c,storage:h,tensor:e},m=U=>typeof U=="string"?U:`${U}u`,y={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},_=s?"uniforms.":"",x=`${_}${n}_shape`,v=`${_}${n}_strides`,w="";for(let U=0;U<a-1;U++)w+=`
    let dim${U} = current / ${$e(v,U,a)};
    let rest${U} = current % ${$e(v,U,a)};
    indices[${U}] = dim${U};
    current = rest${U};
    `;w+=`indices[${a-1}] = current;`;let E=a<2?"":`
  fn o2i_${n}(offset: u32) -> ${f.indices} {
    var indices: ${f.indices};
    var current = offset;
    ${w}
    return indices;
  }`,C=U=>(y.offsetToIndices=!0,a<2?U:`o2i_${n}(${U})`),D=[];if(a>=2)for(let U=a-1;U>=0;U--)D.push(`${$e(v,U,a)} * (indices[${U}])`);let V=a<2?"":`
  fn i2o_${n}(indices: ${f.indices}) -> u32 {
    return ${D.join("+")};
  }`,I=U=>(y.indicesToOffset=!0,a<2?U:`i2o_${n}(${U})`),k=(...U)=>a===0?"0u":`${f.indices}(${U.map(m).join(",")})`,N=(U,Y)=>a<2?`${U}`:`${$e(U,Y,a)}`,L=(U,Y,K)=>a<2?`${U}=${K};`:`${$e(U,Y,a)}=${K};`,j={},H=(U,Y)=>{y.broadcastedIndicesToOffset=!0;let K=`${Y.name}broadcastedIndicesTo${n}Offset`;if(K in j)return`${K}(${U})`;let Z=[];for(let ge=a-1;ge>=0;ge--){let ve=Y.indicesGet("outputIndices",ge+Y.rank-a);Z.push(`${N(v,ge)} * (${ve} % ${N(x,ge)})`)}return j[K]=`fn ${K}(outputIndices: ${Y.type.indices}) -> u32 {
             return ${Z.length>0?Z.join("+"):"0u"};
           }`,`${K}(${U})`},M=(U,Y)=>(()=>{if(f.storage===f.value)return`${n}[${U}]=${Y};`;if(f.storage==="vec2<u32>"&&f.value==="i32")return`${n}[${U}]=vec2<u32>(u32(${Y}), select(0u, 0xFFFFFFFFu, ${Y} < 0));`;if(f.storage==="vec2<u32>"&&f.value==="u32")return`${n}[${U}]=vec2<u32>(u32(${Y}), 0u);`;if(f.storage==="u32"&&f.value==="vec4<bool>")return`${n}[${U}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${Y}));`;throw new Error(`not supported combination of storage type ${f.storage} and value type ${f.value} yet`)})(),se=U=>(()=>{if(f.storage===f.value)return`${n}[${U}]`;if(f.storage==="vec2<u32>"&&f.value==="i32")return`i32(${n}[${U}].x)`;if(f.storage==="vec2<u32>"&&f.value==="u32")return`u32(${n}[${U}].x)`;if(f.storage==="u32"&&f.value==="vec4<bool>")return`vec4<bool>(bool(${n}[${U}] & 0xFFu), bool(${n}[${U}] & 0xFF00u), bool(${n}[${U}] & 0xFF0000u), bool(${n}[${U}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${f.storage} and value type ${f.value} yet`)})(),ue=a<2?"":`
  fn get_${n}ByIndices(indices: ${f.indices}) -> ${c} {
    return ${se(`i2o_${n}(indices)`)};
  }`,ee=a<2?"":(()=>{let U=o.map(K=>`d${K}: u32`).join(", "),Y=o.map(K=>`d${K}`).join(", ");return`
  fn get_${n}(${U}) -> ${c} {
    return get_${n}ByIndices(${k(Y)});
  }`})(),ae=(...U)=>{if(U.length!==a)throw new Error(`indices length must be ${a}`);let Y=U.map(m).join(",");return a===0?se("0u"):a===1?se(Y[0]):(y.get=!0,y.getByIndices=!0,y.indicesToOffset=!0,`get_${n}(${Y})`)},J=U=>a<2?se(U):(y.getByIndices=!0,y.indicesToOffset=!0,`get_${n}ByIndices(${U})`),q=a<2?"":`
  fn set_${n}ByIndices(indices: ${f.indices}, value: ${c}) {
    ${M(`i2o_${n}(indices)`,"value")}
  }`,G=a<2?"":(()=>{let U=o.map(K=>`d${K}: u32`).join(", "),Y=o.map(K=>`d${K}`).join(", ");return`
  fn set_${n}(${U}, value: ${c}) {
    set_${n}ByIndices(${k(Y)}, value);
  }`})();return{impl:()=>{let U=[],Y=!1;return y.offsetToIndices&&(U.push(E),Y=!0),y.indicesToOffset&&(U.push(V),Y=!0),y.broadcastedIndicesToOffset&&(Object.values(j).forEach(K=>U.push(K)),Y=!0),y.set&&(U.push(G),Y=!0),y.setByIndices&&(U.push(q),Y=!0),y.get&&(U.push(ee),Y=!0),y.getByIndices&&(U.push(ue),Y=!0),!s&&Y&&U.unshift(`const ${x} = ${f.indices}(${t.join(",")});`,`const ${v} = ${f.indices}(${ie.computeStrides(t).join(",")});`),U.join(`
`)},type:f,offsetToIndices:C,indicesToOffset:I,broadcastedIndicesToOffset:H,indices:k,indicesGet:N,indicesSet:L,set:(...U)=>{if(U.length!==a+1)throw new Error(`indices length must be ${a}`);let Y=U[a];if(typeof Y!="string")throw new Error("value must be string");let K=U.slice(0,a).map(m).join(",");return a===0?M("0u",Y):a===1?M(K[0],Y):(y.set=!0,y.setByIndices=!0,y.indicesToOffset=!0,`set_${n}(${K}, ${Y})`)},setByOffset:M,setByIndices:(U,Y)=>a<2?M(U,Y):(y.setByIndices=!0,y.indicesToOffset=!0,`set_${n}ByIndices(${U}, ${Y});`),get:ae,getByOffset:se,getByIndices:J,usage:i,name:n,strides:v,shape:x,rank:a}},le=(n,e,t,i=1)=>Dm(n,e,t,"input",i),Te=(n,e,t,i=1)=>Dm(n,e,t,"output",i),cV=(n,e,t)=>Dm(n,e,t,"atomicOutput",1),gC=(n,e,t,i=1)=>Dm(n,e,t,"internal",i),KP=class{constructor(n,e){this.normalizedDispatchGroup=n,this.limits=e,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(n){return`if (global_idx >= ${typeof n=="number"?`${n}u`:n}) { return; }`}mainStart(n=Pp){let e=typeof n=="number"?n:n[0],t=typeof n=="number"?1:n[1],i=typeof n=="number"?1:n[2];if(e>this.limits.maxComputeWorkgroupSizeX||t>this.limits.maxComputeWorkgroupSizeY||i>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${e}, ${t}, ${i}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(e*t*i>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${e}, ${t}, ${i}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let r=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,s=r?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,a=r?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${e*t*i}u + local_idx;`;return`@compute @workgroup_size(${e}, ${t}, ${i})
  fn main(${s}) {
    ${a}
  `}appendVariableUniforms(n){n.rank!==0&&(n.shape.startsWith("uniforms.")&&this.uniforms.push({name:n.shape.replace("uniforms.",""),type:"u32",length:n.rank}),n.strides.startsWith("uniforms.")&&this.uniforms.push({name:n.strides.replace("uniforms.",""),type:"u32",length:n.rank}))}declareVariable(n,e){if(n.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(n),this.appendVariableUniforms(n);let t=n.usage==="input"?"read":"read_write",i=n.usage==="atomicOutput"?"atomic<i32>":n.type.storage;return`@group(0) @binding(${e}) var<storage, ${t}> ${n.name}: array<${i}>;`}declareVariables(...n){return n.map(e=>this.declareVariable(e,this.variableIndex++)).join(`
`)}registerInternalVariable(n){if(n.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(n),this.appendVariableUniforms(n)}registerInternalVariables(...n){return n.forEach(e=>this.registerInternalVariable(e)),this}registerUniform(n,e,t=1){return this.uniforms.push({name:n,type:e,length:t}),this}registerUniforms(n){return this.uniforms=this.uniforms.concat(n),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let n=[];for(let{name:e,type:t,length:i}of this.uniforms)if(i&&i>4)t==="f16"?n.push(`@align(16) ${e}:array<mat2x4<${t}>, ${Math.ceil(i/8)}>`):n.push(`${e}:array<vec4<${t}>, ${Math.ceil(i/4)}>`);else{let r=i==null||i===1?t:`vec${i}<${t}>`;n.push(`${e}:${r}`)}return`
      struct Uniforms { ${n.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(n=>n.impl()).join(`
`)+this.internalVariables.map(n=>n.impl()).join(`
`)}get variablesInfo(){if(this.uniforms.length===0)return;let n=e=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(e)];return this.uniforms.map(e=>[n(e.type),e.length??1])}},dV=(n,e)=>new KP(n,e)}),YP,kE,XP,QP,JP,ZP,kr,hV,fV,Mu=fe(()=>{Oe(),je(),Zt(),Be(),YP=(n,e)=>{if(!n||n.length!==1)throw new Error("Transpose requires 1 input.");if(e.length!==0&&e.length!==n[0].dims.length)throw new Error(`perm size ${e.length} does not match input rank ${n[0].dims.length}`)},kE=(n,e)=>e.length!==0?e:[...new Array(n).keys()].reverse(),XP=(n,e)=>ie.sortBasedOnPerm(n,kE(n.length,e)),QP=(n,e,t,i)=>{let r=`fn perm(i: ${i.type.indices}) -> ${t.type.indices} {
    var a: ${t.type.indices};`;for(let s=0;s<e;++s)r+=`a[${n[s]}]=i[${s}];`;return r+="return a;}"},JP=(n,e)=>{let t=[],i=[];for(let r=0;r<n.length;++r)n[r]!==1&&t.push(n[r]),n[e[r]]!==1&&i.push(e[r]);return{newShape:t,newPerm:i}},ZP=(n,e)=>{let t=0;for(let i=0;i<n.length;++i)if(e[n[i]]!==1){if(n[i]<t)return!1;t=n[i]}return!0},kr=(n,e)=>{let t=n.dataType,i=n.dims.length,r=kE(i,e),s=XP(n.dims,r),a=n.dims,o=s,l=i<2||ZP(r,n.dims),u;if(l)return u=y=>{let _=le("input",t,a,4),x=Te("output",t,o,4);return`
  ${y.registerUniform("output_size","u32").declareVariables(_,x)}
  ${y.mainStart()}
    ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let y=ie.size(s);return{outputs:[{dims:s,dataType:n.dataType}],dispatchGroup:{x:Math.ceil(y/64/4)},programUniforms:[{type:12,data:Math.ceil(y/4)}]}},getShaderSource:u};let{newShape:c,newPerm:h}=JP(n.dims,r),f=ie.areEqual(h,[2,3,1]),m=ie.areEqual(h,[3,1,2]);if(c.length===2||f||m){a=f?[c[0],c[1]*c[2]]:m?[c[0]*c[1],c[2]]:c,o=[a[1],a[0]];let y=16;return u=_=>{let x=le("a",t,a.length),v=Te("output",t,o.length);return`
  ${_.registerUniform("output_size","u32").declareVariables(x,v)}
  var<workgroup> tile : array<array<${v.type.value}, ${y+1}>, ${y}>;
  ${_.mainStart([y,y,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${y} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${y}u + local_id.x;
    let input_row = workgroup_id_x * ${y}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${x.getByIndices(`${x.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${y}u + local_id.x;
    let output_row = workgroup_id_y * ${y}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${v.setByIndices(`${v.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let _=ie.size(s);return{outputs:[{dims:s,dataType:n.dataType}],dispatchGroup:{x:Math.ceil(o[1]/y),y:Math.ceil(o[0]/y)},programUniforms:[{type:12,data:_},...Re(a,o)]}},getShaderSource:u}}return u=y=>{let _=le("a",t,a.length),x=Te("output",t,o.length);return`
  ${y.registerUniform("output_size","u32").declareVariables(_,x)}

  ${QP(r,i,_,x)}

  ${y.mainStart()}
    ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${x.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${x.setByOffset("global_idx",_.getByIndices("aIndices"))}
  }`},{name:"Transpose",shaderCache:{hint:`${e}`,inputDependencies:["rank"]},getRunData:()=>{let y=ie.size(s);return{outputs:[{dims:s,dataType:n.dataType}],dispatchGroup:{x:Math.ceil(y/64)},programUniforms:[{type:12,data:y},...Re(a,o)]}},getShaderSource:u}},hV=(n,e)=>{YP(n.inputs,e.perm),n.compute(kr(n.inputs[0],e.perm))},fV=n=>ht({perm:n.perm})}),eN,tN,nN,iN,rN,sN,aN,oN,lN,uN,ds,pV,mV,gV,yV,_V,vV,wV,bV,xV,EV,BJ=fe(()=>{Oe(),je(),Be(),yC(),Mu(),eN={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},tN={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},nN={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},iN={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},rN=(n,e)=>{let t=[];for(let i=e-n;i<e;++i)t.push(i);return t},sN=(n,e)=>{let t=[],i=n.length;for(let s=0;s<i;s++)e.indexOf(s)===-1&&t.push(n[s]);let r=e.map(s=>n[s]);return[t,r]},aN=(n,e)=>{let t=n.length+e.length,i=[],r=0;for(let s=0;s<t;s++)e.indexOf(s)===-1?i.push(n[r++]):i.push(1);return i},oN=(n,e)=>{for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0},lN=(n,e)=>{let t=[];if(!oN(n,e)){for(let i=0;i<e;++i)n.indexOf(i)===-1&&t.push(i);n.forEach(i=>t.push(i))}return t},uN=(n,e,t,i,r,s,a)=>{let o=t[0].dims,l=ie.size(s),u=ie.size(a),c=le("_A",t[0].dataType,o),h=Te("output",r,s),f=64;l===1&&(f=256);let m=`
          var<workgroup> aBestValues : array<f32, ${f}>;
       `,y=_=>`
        ${_.registerUniform("reduceSize","u32").declareVariables(c,h)}
        ${m}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${_.mainStart(f)}

          let outputIndex = global_idx / ${f};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${nN[i]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${f}) {
           let candidate = f32(${c.getByOffset("offset + k")});
           bestValue = ${eN[i]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${f}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${tN[i]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${h.setByOffset("outputIndex",`${i==="mean"?`${h.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${h.type.storage}(${iN[i]})`}`)};
         }
        }`;return{name:n,shaderCache:{hint:`${e};${f}`,inputDependencies:["type"]},getShaderSource:y,getRunData:()=>({outputs:[{dims:s,dataType:r}],dispatchGroup:{x:l},programUniforms:[{type:12,data:u}]})}},ds=(n,e,t,i)=>{let r=n.inputs.length===1?t:VT(n.inputs,t),s=r.axes;s.length===0&&!r.noopWithEmptyAxes&&(s=n.inputs[0].dims.map((m,y)=>y));let a=ie.normalizeAxes(s,n.inputs[0].dims.length),o=a,l=n.inputs[0],u=lN(o,n.inputs[0].dims.length);u.length>0&&(l=n.compute(kr(n.inputs[0],u),{inputs:[0],outputs:[-1]})[0],o=rN(o.length,l.dims.length));let[c,h]=sN(l.dims,o),f=c;r.keepDims&&(f=aN(c,a)),n.compute(uN(e,r.cacheKey,[l],i,n.inputs[0].dataType,f,h),{inputs:[l]})},pV=(n,e)=>{ds(n,"ReduceMeanShared",e,"mean")},mV=(n,e)=>{ds(n,"ReduceL1Shared",e,"l1")},gV=(n,e)=>{ds(n,"ReduceL2Shared",e,"l2")},yV=(n,e)=>{ds(n,"ReduceLogSumExpShared",e,"logSumExp")},_V=(n,e)=>{ds(n,"ReduceMaxShared",e,"max")},vV=(n,e)=>{ds(n,"ReduceMinShared",e,"min")},wV=(n,e)=>{ds(n,"ReduceProdShared",e,"prod")},bV=(n,e)=>{ds(n,"ReduceSumShared",e,"sum")},xV=(n,e)=>{ds(n,"ReduceSumSquareShared",e,"sumSquare")},EV=(n,e)=>{ds(n,"ReduceLogSumShared",e,"logSum")}}),hs,cN,Db,VT,fs,dN,hN,fN,pN,mN,gN,yN,_N,vN,wN,ps,AV,TV,SV,IV,CV,kV,$V,RV,PV,NV,yC=fe(()=>{Oe(),je(),Zt(),Be(),BJ(),hs=n=>{if(!n||n.length===0||n.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(n.length===2&&n[1].dims.length!==1)throw new Error("Invalid axes input dims.")},cN=n=>["","",`var value = ${n.getByIndices("input_indices")};`,""],Db=(n,e,t,i,r,s,a=!1,o=!1)=>{let l=[],u=t[0].dims,c=u.length,h=ie.normalizeAxes(r,c),f=!o&&h.length===0;u.forEach((_,x)=>{f||h.indexOf(x)>=0?a&&l.push(1):l.push(_)});let m=l.length,y=ie.size(l);return{name:n,shaderCache:e,getShaderSource:_=>{let x=[],v=le("_A",t[0].dataType,c),w=Te("output",s,m),E=i(v,w,h),C=E[2];for(let D=0,V=0;D<c;D++)f||h.indexOf(D)>=0?(a&&V++,C=`for(var j${D}: u32 = 0; j${D} < ${u[D]}; j${D}++) {
                  ${E[2].includes("last_index")?`let last_index = j${D};`:""}
                  ${v.indicesSet("input_indices",D,`j${D}`)}
                  ${C}
                }`):(x.push(`${v.indicesSet("input_indices",D,w.indicesGet("output_indices",V))};`),V++);return`

        ${_.registerUniform("output_size","u32").declareVariables(v,w)}

        ${_.mainStart()}
          ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${v.type.indices};
          let output_indices = ${w.offsetToIndices("global_idx")};

          ${x.join(`
`)}
          ${E[0]}       // init ops for reduce max/min
          ${E[1]}
          ${C}
          ${E[3]}
          ${E.length===4?w.setByOffset("global_idx","value"):E.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:l,dataType:s}],dispatchGroup:{x:Math.ceil(y/64)},programUniforms:[{type:12,data:y},...Re(u,l)]})}},VT=(n,e)=>{let t=[];return n[1].dims[0]>0&&n[1].getBigInt64Array().forEach(i=>t.push(Number(i))),ht({axes:t,keepDims:e.keepDims,noopWithEmptyAxes:e.noopWithEmptyAxes})},fs=(n,e,t,i)=>{let r=n.inputs,s=r.length===1?t:VT(r,t);n.compute(Db(e,{hint:s.cacheKey,inputDependencies:["rank"]},[r[0]],s.noopWithEmptyAxes&&s.axes.length===0?cN:i,s.axes,r[0].dataType,s.keepDims,s.noopWithEmptyAxes),{inputs:[0]})},dN=(n,e)=>{hs(n.inputs),fs(n,"ReduceLogSum",e,(t,i)=>[`var value = ${i.type.storage}(0);`,"",`value += ${t.getByIndices("input_indices")};`,"value = log(value);"])},hN=(n,e)=>{hs(n.inputs),fs(n,"ReduceL1",e,(t,i)=>[`var value = ${i.type.storage}(0);`,"",`value += abs(${t.getByIndices("input_indices")});`,""])},fN=(n,e)=>{hs(n.inputs),fs(n,"ReduceL2",e,(t,i)=>[`var t = ${i.type.value}(0); var value = ${i.type.value}(0);`,"",`t = ${t.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},pN=(n,e)=>{hs(n.inputs),fs(n,"ReduceLogSumExp",e,(t,i)=>[`var value = ${i.type.storage}(0);`,"",`value += exp(${t.getByIndices("input_indices")});`,"value = log(value);"])},mN=(n,e)=>{hs(n.inputs),fs(n,"ReduceMax",e,(t,i,r)=>{let s=[];for(let a=0;a<t.rank;a++)(r.indexOf(a)>=0||r.length===0)&&s.push(t.indicesSet("input_indices",a,0));return[`${s.join(`
`)}`,`var value = ${t.getByIndices("input_indices")};`,`value = max(value, ${t.getByIndices("input_indices")});`,""]})},gN=(n,e)=>{hs(n.inputs),fs(n,"ReduceMean",e,(t,i,r)=>{let s=1;for(let a=0;a<t.rank;a++)(r.indexOf(a)>=0||r.length===0)&&(s*=n.inputs[0].dims[a]);return["var sum = f32(0);","",`sum += f32(${t.getByIndices("input_indices")});`,`let value = ${i.type.value}(sum / ${s});`]})},yN=(n,e)=>{hs(n.inputs),fs(n,"ReduceMin",e,(t,i,r)=>{let s=[];for(let a=0;a<t.rank;a++)(r.indexOf(a)>=0||r.length===0)&&s.push(`input_indices[${a}] = 0;`);return[`${s.join(`
`)}`,`var value = ${t.getByIndices("input_indices")};`,`value = min(value, ${t.getByIndices("input_indices")});`,""]})},_N=(n,e)=>{hs(n.inputs),fs(n,"ReduceProd",e,(t,i)=>[`var value = ${i.type.storage}(1);`,"",`value *= ${t.getByIndices("input_indices")};`,""])},vN=(n,e)=>{hs(n.inputs),fs(n,"ReduceSum",e,(t,i)=>[`var value = ${i.type.storage}(0);`,"",`value += ${t.getByIndices("input_indices")};`,""])},wN=(n,e)=>{hs(n.inputs),fs(n,"ReduceSumSquare",e,(t,i)=>[`var t = ${i.type.value}(0); var value = ${i.type.value}(0);`,"",`t = ${t.getByIndices("input_indices")}; value += t * t;`,""])},ps=(n,e,t)=>{if(e.length===0)return t;let i=1,r=1;for(let s=0;s<e.length;s++)e.indexOf(s)===-1?i*=n[s]:r*=n[s];return r<32&&i>1024},AV=(n,e)=>{ps(n.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?gN(n,e):pV(n,e)},TV=(n,e)=>{ps(n.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?hN(n,e):mV(n,e)},SV=(n,e)=>{ps(n.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?fN(n,e):gV(n,e)},IV=(n,e)=>{ps(n.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?pN(n,e):yV(n,e)},CV=(n,e)=>{ps(n.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?mN(n,e):_V(n,e)},kV=(n,e)=>{ps(n.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?yN(n,e):vV(n,e)},$V=(n,e)=>{ps(n.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?_N(n,e):wV(n,e)},RV=(n,e)=>{ps(n.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?vN(n,e):bV(n,e)},PV=(n,e)=>{ps(n.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?wN(n,e):xV(n,e)},NV=(n,e)=>{ps(n.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?dN(n,e):EV(n,e)}}),$E,DV,MV,jT,UJ=fe(()=>{Oe(),Zt(),yC(),$E=n=>{if(!n||n.length===0||n.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(n[0].dataType!==1)throw new Error("Invalid input type.")},DV=(n,e)=>{$E(n.inputs);let t=(i,r,s)=>{let a=[];for(let o=0;o<i.rank;o++)(s.indexOf(o)>=0||s.length===0)&&a.push(`input_indices[${o}] = 0;`);return[`${a.join(`
`)}`,`var value = ${i.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${i.getByIndices("input_indices")} ${e.selectLastIndex>0?"<=":"<"} value) {
         value = ${i.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",r.setByOffset("global_idx","best_index")]};n.compute(Db("ArgMin",{hint:e.cacheKey,inputDependencies:["rank"]},[n.inputs[0]],t,[e.axis],7,e.keepDims),{inputs:[0]})},MV=(n,e)=>{$E(n.inputs);let t=(i,r,s)=>{let a=[];for(let o=0;o<i.rank;o++)(s.indexOf(o)>=0||s.length===0)&&a.push(`input_indices[${o}] = 0;`);return[`${a.join(`
`)}`,`var value = ${i.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${i.getByIndices("input_indices")} ${e.selectLastIndex>0?">=":">"} value) {
         value = ${i.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",r.setByOffset("global_idx","best_index")]};n.compute(Db("argMax",{hint:e.cacheKey,inputDependencies:["rank"]},[n.inputs[0]],t,[e.axis],7,e.keepDims),{inputs:[0]})},jT=n=>ht(n)}),bN,Iw,xN,EN,AN,vy,TN,OV,_C=fe(()=>{Oe(),je(),mC(),Be(),bN=(n,e)=>{let t=n[0],i=n[1],r=n[2],s=n[3],a=n[4],o=n[5];if(a&&o)throw new Error("Attention cannot have both past and attention_bias");if(t.dims.length!==3)throw new Error('Input "input" must have 3 dimensions');let l=t.dims[0],u=t.dims[1],c=t.dims[2];if(r.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimensions');if(i.dims.length!==2)throw new Error('Input "weights" is expected to have 2 dimensions');if(i.dims[0]!==c)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(r.dims[0]!==i.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let h=r.dims[0]/3,f=h,m=f;if(e.qkvHiddenSizes.length>0){if(e.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let E of e.qkvHiddenSizes)if(E%e.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");h=e.qkvHiddenSizes[0],f=e.qkvHiddenSizes[1],m=e.qkvHiddenSizes[2]}let y=u;if(h!==f)throw new Error("qkv_hidden_sizes first element should be same as the second");if(r.dims[0]!==h+f+m)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let _=0;if(a){if(f!==m)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(a.dims.length!==5)throw new Error('Input "past" must have 5 dimensions');if(a.dims[0]!==2)throw new Error('Input "past" first dimension must be 2');if(a.dims[1]!==l)throw new Error('Input "past" second dimension must be batch_size');if(a.dims[2]!==e.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(a.dims[4]!==f/e.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');e.pastPresentShareBuffer||(_=a.dims[3])}let x=y+_,v=-1,w=0;if(s)throw new Error("Mask not supported");if(a)throw new Error("past is not supported");if(o){if(o.dims.length!==4)throw new Error('Input "attention_bias" must have 4 dimensions');if(o.dims[0]!==l||o.dims[1]!==e.numHeads||o.dims[2]!==u||o.dims[3]!==x)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:l,sequenceLength:u,pastSequenceLength:_,kvSequenceLength:y,totalSequenceLength:x,maxSequenceLength:v,inputHiddenSize:c,hiddenSize:h,vHiddenSize:m,headSize:Math.floor(h/e.numHeads),vHeadSize:Math.floor(m/e.numHeads),numHeads:e.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:e.maskFilterValue,maskType:w,scale:e.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},Iw=(n,e,t)=>e&&n?`
      let total_sequence_length_input = u32(${e.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${n==null?void 0:n.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${t?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,xN=(n,e,t,i,r,s,a,o)=>{let l=Wt(a?1:s),u=64,c=s/l;c<u&&(u=32);let h=Math.ceil(s/l/u),f=[{type:12,data:e},{type:12,data:t},{type:12,data:i},{type:12,data:r},{type:12,data:c},{type:12,data:h}],m=$n(n.dataType,l),y=mi(1,l),_=["type"];a&&_.push("type"),o&&_.push("type");let x=v=>{let w=Te("x",n.dataType,n.dims,l),E=[w],C=a?le("seq_lens",a.dataType,a.dims):void 0;C&&E.push(C);let D=o?le("total_sequence_length_input",o.dataType,o.dims):void 0;D&&E.push(D);let V=mi(n.dataType),I=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${u}>;
  var<workgroup> thread_sum: array<f32, ${u}>;
  ${v.registerUniforms(I).declareVariables(...E)}
  ${v.mainStart([u,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${Iw(C,D,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${u}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${a?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${y}(-3.402823e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${y}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(l){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${l}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.402823e+38f);
    for (var i = 0u; i < ${u}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${y}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${y}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(l){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${l}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${u}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${w.type.value}(${V}(1.0) / ${V}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${y}(x[offset + i]);
        x[offset + i] = ${w.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${a?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${w.type.value}(${V}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${u};${m};${l}`,inputDependencies:_},getShaderSource:x,getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:r,z:e*t},programUniforms:f})}},EN=(n,e,t,i,r,s,a,o,l)=>{let u=a+s.kvSequenceLength,c=[s.batchSize,s.numHeads,s.sequenceLength,u],h=n>1&&i,f=s.kvNumHeads?s.kvNumHeads:s.numHeads,m=h?[s.batchSize,f,u,s.headSize]:void 0,y=s.nReps?s.nReps:1,_=s.scale===0?1/Math.sqrt(s.headSize):s.scale,x=Wt(s.headSize),v=s.headSize/x,w=12,E={x:Math.ceil(u/w),y:Math.ceil(s.sequenceLength/w),z:s.batchSize*s.numHeads},C=[{type:12,data:s.sequenceLength},{type:12,data:v},{type:12,data:u},{type:12,data:s.numHeads},{type:12,data:s.headSize},{type:1,data:_},{type:12,data:a},{type:12,data:s.kvSequenceLength},{type:12,data:y}],D=h&&i&&ie.size(i.dims)>0,V=["type","type"];D&&V.push("type"),r&&V.push("type"),o&&V.push("type"),l&&V.push("type");let I=[{dims:c,dataType:e.dataType,gpuDataType:0}];h&&I.push({dims:m,dataType:e.dataType,gpuDataType:0});let k=N=>{let L=le("q",e.dataType,e.dims,x),j=le("key",t.dataType,t.dims,x),H=[L,j];if(D){let q=le("past_key",i.dataType,i.dims,x);H.push(q)}r&&H.push(le("attention_bias",r.dataType,r.dims));let M=o?le("seq_lens",o.dataType,o.dims):void 0;M&&H.push(M);let se=l?le("total_sequence_length_input",l.dataType,l.dims):void 0;se&&H.push(se);let ue=Te("output",e.dataType,c),ee=[ue];h&&ee.push(Te("present_key",e.dataType,m,x));let ae=mi(1,x),J=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${w}u;

  var<workgroup> tileQ: array<${L.type.storage}, ${w*w}>;
  var<workgroup> tileK: array<${L.type.storage}, ${w*w}>;
  ${N.registerUniforms(J).declareVariables(...H,...ee)}
  ${N.mainStart([w,w,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${y===1?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${y===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${Iw(M,se,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${D&&h?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${h?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${ae}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${D&&h?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${h?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${ae}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch(x){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${x}`)}})()};
        output[outputIdx] = ${ue.type.value} (sum * uniforms.alpha) + ${r?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${x};${r!==void 0};${i!==void 0};${n}`,inputDependencies:V},getRunData:()=>({outputs:I,dispatchGroup:E,programUniforms:C}),getShaderSource:k}},AN=(n,e,t,i,r,s,a=void 0,o=void 0)=>{let l=s+r.kvSequenceLength,u=r.nReps?r.nReps:1,c=r.vHiddenSize*u,h=n>1&&i,f=r.kvNumHeads?r.kvNumHeads:r.numHeads,m=h?[r.batchSize,f,l,r.headSize]:void 0,y=[r.batchSize,r.sequenceLength,c],_=12,x={x:Math.ceil(r.vHeadSize/_),y:Math.ceil(r.sequenceLength/_),z:r.batchSize*r.numHeads},v=[{type:12,data:r.sequenceLength},{type:12,data:l},{type:12,data:r.vHeadSize},{type:12,data:r.numHeads},{type:12,data:r.headSize},{type:12,data:c},{type:12,data:s},{type:12,data:r.kvSequenceLength},{type:12,data:u}],w=h&&i&&ie.size(i.dims)>0,E=["type","type"];w&&E.push("type"),a&&E.push("type"),o&&E.push("type");let C=[{dims:y,dataType:e.dataType,gpuDataType:0}];h&&C.push({dims:m,dataType:e.dataType,gpuDataType:0});let D=V=>{let I=le("probs",e.dataType,e.dims),k=le("v",t.dataType,t.dims),N=[I,k];w&&N.push(le("past_value",i.dataType,i.dims));let L=a?le("seq_lens",a.dataType,a.dims):void 0;a&&N.push(L);let j=o?le("total_sequence_length_input",o.dataType,o.dims):void 0;o&&N.push(j);let H=[Te("output",e.dataType,y)];h&&H.push(Te("present_value",e.dataType,m));let M=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${_}u;
  var<workgroup> tileQ: array<${I.type.value}, ${_*_}>;
  var<workgroup> tileV: array<${I.type.value}, ${_*_}>;
  ${V.registerUniforms(M).declareVariables(...N,...H)}
  ${V.mainStart([_,_,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${u===1?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${u===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${Iw(L,j,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${w&&h?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${h?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${I.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${w&&h?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${h?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${i!==void 0};${n}`,inputDependencies:E},getRunData:()=>({outputs:C,dispatchGroup:x,programUniforms:v}),getShaderSource:D}},vy=(n,e,t,i,r,s,a,o,l,u,c=void 0,h=void 0)=>{let f=Math.min(n.outputCount,1+(a?1:0)+(o?1:0)),m=f>1?u.pastSequenceLength:0,y=m+u.kvSequenceLength,_=l&&ie.size(l.dims)>0?l:void 0,x=[e,t];f>1&&a&&ie.size(a.dims)>0&&x.push(a),_&&x.push(_),c&&x.push(c),h&&x.push(h);let v=n.compute(EN(f,e,t,a,_,u,m,c,h),{inputs:x,outputs:f>1?[-1,1]:[-1]})[0];n.compute(xN(v,u.batchSize,u.numHeads,m,u.sequenceLength,y,c,h),{inputs:c&&h?[v,c,h]:[v],outputs:[]});let w=[v,i];f>1&&o&&ie.size(o.dims)>0&&w.push(o),c&&w.push(c),h&&w.push(h),n.compute(AN(f,v,i,o,u,m,c,h),{inputs:w,outputs:f>1?[0,2]:[0]})},TN=(n,e)=>{let t=[e.batchSize,e.numHeads,e.sequenceLength,e.headSize],i=e.sequenceLength,r=e.inputHiddenSize,s=e.headSize,a=12,o={x:Math.ceil(e.headSize/a),y:Math.ceil(e.sequenceLength/a),z:e.batchSize*e.numHeads},l=[n.inputs[0],n.inputs[1],n.inputs[2]],u=[{type:12,data:i},{type:12,data:r},{type:12,data:s},{type:12,data:e.numHeads},{type:12,data:e.headSize},{type:12,data:e.hiddenSize},{type:12,data:e.hiddenSize+e.hiddenSize+e.vHiddenSize}],c=h=>{let f=Te("output_q",l[0].dataType,t),m=Te("output_k",l[0].dataType,t),y=Te("output_v",l[0].dataType,t),_=le("input",l[0].dataType,l[0].dims),x=le("weight",l[1].dataType,l[1].dims),v=le("bias",l[2].dataType,l[2].dims),w=_.type.storage,E=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${a}u;
  var<workgroup> tileInput: array<${w}, ${a*a}>;
  var<workgroup> tileWeightQ: array<${w}, ${a*a}>;
  var<workgroup> tileWeightK: array<${w}, ${a*a}>;
  var<workgroup> tileWeightV: array<${w}, ${a*a}>;
  ${h.registerUniforms(E).declareVariables(_,x,v,f,m,y)}
  ${h.mainStart([a,a,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${w}(0);
    var valueK = ${w}(0);
    var valueV = ${w}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return n.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:t,dataType:n.inputs[0].dataType,gpuDataType:0},{dims:t,dataType:n.inputs[0].dataType,gpuDataType:0},{dims:t,dataType:n.inputs[0].dataType,gpuDataType:0}],dispatchGroup:o,programUniforms:u}),getShaderSource:c},{inputs:l,outputs:[-1,-1,-1]})},OV=(n,e)=>{let t=bN(n.inputs,e),[i,r,s]=TN(n,t);return vy(n,i,r,s,n.inputs[4],void 0,void 0,void 0,n.inputs[5],t)}}),SN,IN,CN,LV,HJ=fe(()=>{ts(),Oe(),je(),Zt(),Be(),SN=(n,e)=>{if(!n||n.length!==5)throw new Error("BatchNormalization requires 5 inputs");let t=(i,r,s)=>{let a=r.length;if(a!==i.length)throw new Error(`${s}: num dimensions != ${a}`);r.forEach((o,l)=>{if(o!==i[l])throw new Error(`${s}: dim[${l}] do not match`)})};if(n[0].dims.length>1){let i=e.format==="NHWC"?e.spatial?n[0].dims.slice(-1):n[0].dims.slice(-1).concat(n[0].dims.slice(1,n[0].dims.length-1)):n[0].dims.slice(1,e.spatial?2:void 0);t(n[1].dims,i,"Invalid input scale"),t(n[2].dims,i,"Invalid input B"),t(n[3].dims,i,"Invalid input mean"),t(n[4].dims,i,"Invalid input var")}else t(n[1].dims,[1],"Invalid input scale"),t(n[2].dims,[1],"Invalid input B"),t(n[3].dims,[1],"Invalid input mean"),t(n[4].dims,[1],"Invalid input var")},IN=(n,e)=>{let{epsilon:t,spatial:i,format:r}=e,s=n[0].dims,a=i?Wt(s[s.length-1]):1,o=r==="NHWC"&&s.length>1?a:1,l=ie.size(s)/a,u=i,c=u?s.length:s,h=le("x",n[0].dataType,n[0].dims,a),f=le("scale",n[1].dataType,n[1].dims,o),m=le("bias",n[2].dataType,n[2].dims,o),y=le("inputMean",n[3].dataType,n[3].dims,o),_=le("inputVar",n[4].dataType,n[4].dims,o),x=Te("y",n[0].dataType,c,a),v=()=>{let E="";if(i)E=`let cOffset = ${s.length===1?"0u":r==="NHWC"?`outputIndices[${s.length-1}] / ${a}`:"outputIndices[1]"};`;else if(r==="NCHW")E=`
            ${x.indicesSet("outputIndices","0","0")}
            let cOffset = ${x.indicesToOffset("outputIndices")};`;else{E=`var cIndices = ${f.type.indices}(0);
                       cIndices[0] = outputIndices[${s.length-1}];`;for(let C=1;C<f.rank;C++)E+=`cIndices[${C}] = outputIndices[${C}];`;E+=`let cOffset = ${f.indicesToOffset("cIndices")};`}return E},w=E=>`
  const epsilon = ${t};
  ${E.registerUniform("outputSize","u32").declareVariables(h,f,m,y,_,x)}
  ${E.mainStart()}
  ${E.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${x.offsetToIndices(`global_idx * ${a}`)};
    ${v()}
    let scale = ${f.getByOffset("cOffset")};
    let bias = ${m.getByOffset("cOffset")};
    let inputMean = ${y.getByOffset("cOffset")};
    let inputVar = ${_.getByOffset("cOffset")};
    let x = ${h.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${x.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${e.epsilon}_${e.format}_${i}_${a}`,inputDependencies:u?["rank","type","type","type","type"]:void 0},getShaderSource:w,getRunData:()=>({outputs:[{dims:n[0].dims,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:u?[{type:12,data:l},...Re(s)]:[{type:12,data:l}]})}},CN=n=>ht(n),LV=(n,e)=>{let{inputs:t,outputCount:i}=n,r=CN({...e,outputCount:i});if(Nt.webgpu.validateInputContent&&SN(t,r),e.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");n.compute(IN(t,r))}}),kN,$N,FV,WJ=fe(()=>{je(),Be(),kN=n=>{if(n[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(n[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(n[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(n[0].dims[2]!==n[1].dims[0])throw new Error("last dimension of input and bias are not the same")},$N=n=>{let e=n[0].dims,t=n[0].dims[2],i=ie.size(e)/4,r=n[0].dataType,s=le("input",r,e,4),a=le("bias",r,[t],4),o=le("residual",r,e,4),l=Te("output",r,e,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:e,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(i/64)}}),getShaderSource:u=>`
  const channels = ${t}u / 4;
  ${u.declareVariables(s,a,o,l)}

  ${u.mainStart()}
    ${u.guardAgainstOutOfBoundsWorkgroupSizes(i)}
    let value = ${s.getByOffset("global_idx")}
      + ${a.getByOffset("global_idx % channels")} + ${o.getByOffset("global_idx")};
    ${l.setByOffset("global_idx","value")}
  }`}},FV=n=>{kN(n.inputs),n.compute($N(n.inputs))}}),RN,lt,zV,VV,jV,BV,UV,HV,WV,qV,GV,PN,KV,YV,XV,QV,sg,JV,u0,ZV,ej,tj,nj,ij,rj,sj,aj,oj,lj,uj,cj,dj,hj,fj,pj,RE,mj,BT,UT,gj,yj,_j,NN,DN,vj,vC=fe(()=>{Oe(),je(),Zt(),Be(),RN=(n,e,t,i,r,s,a)=>{let o=Math.ceil(e/4),l="";typeof r=="string"?l=`${r}(a)`:l=r("a");let u=le("inputData",t,[o],4),c=Te("outputData",i,[o],4),h=[{name:"vec_size",type:"u32"}];return a&&h.push(...a),`
      ${n.registerUniforms(h).declareVariables(u,c)}

  ${s??""}

  ${n.mainStart()}
    ${n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${u.getByOffset("global_idx")};
    ${c.setByOffset("global_idx",l)}
  }`},lt=(n,e,t,i,r,s=n.dataType,a,o)=>{let l=[{type:12,data:Math.ceil(ie.size(n.dims)/4)}];return a&&l.push(...a),{name:e,shaderCache:{hint:r,inputDependencies:["type"]},getShaderSource:u=>RN(u,ie.size(n.dims),n.dataType,s,t,i,o),getRunData:u=>({outputs:[{dims:n.dims,dataType:s}],dispatchGroup:{x:Math.ceil(ie.size(u[0].dims)/64/4)},programUniforms:l})}},zV=n=>{n.compute(lt(n.inputs[0],"Abs","abs"))},VV=n=>{n.compute(lt(n.inputs[0],"Acos","acos"))},jV=n=>{n.compute(lt(n.inputs[0],"Acosh","acosh"))},BV=n=>{n.compute(lt(n.inputs[0],"Asin","asin"))},UV=n=>{n.compute(lt(n.inputs[0],"Asinh","asinh"))},HV=n=>{n.compute(lt(n.inputs[0],"Atan","atan"))},WV=n=>{n.compute(lt(n.inputs[0],"Atanh","atanh"))},qV=n=>ht(n),GV=(n,e)=>{let t;switch(e.to){case 10:t="vec4<f16>";break;case 1:t="vec4<f32>";break;case 12:t="vec4<u32>";break;case 6:t="vec4<i32>";break;case 9:t="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${e.to}`)}n.compute(lt(n.inputs[0],"Cast",t,void 0,e.cacheKey,e.to))},PN=n=>{let e,t,i=n.length>=2&&n[1].data!==0,r=n.length>=3&&n[2].data!==0;switch(n[0].dataType){case 1:e=i?n[1].getFloat32Array()[0]:-34028234663852886e22,t=r?n[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:e=i?n[1].getUint16Array()[0]:64511,t=r?n[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return ht({min:e,max:t})},KV=(n,e)=>{let t=e||PN(n.inputs),i=mi(n.inputs[0].dataType);n.compute(lt(n.inputs[0],"Clip",r=>`clamp(${r}, vec4<${i}>(uniforms.min), vec4<${i}>(uniforms.max))`,void 0,t.cacheKey,void 0,[{type:n.inputs[0].dataType,data:t.min},{type:n.inputs[0].dataType,data:t.max}],[{name:"min",type:i},{name:"max",type:i}]),{inputs:[0]})},YV=n=>{n.compute(lt(n.inputs[0],"Ceil","ceil"))},XV=n=>{n.compute(lt(n.inputs[0],"Cos","cos"))},QV=n=>{n.compute(lt(n.inputs[0],"Cosh","cosh"))},sg=n=>ht(n),JV=(n,e)=>{let t=mi(n.inputs[0].dataType);n.compute(lt(n.inputs[0],"Elu",i=>`elu_vf32(${i})`,`
  const elu_alpha_ = ${t}(${e.alpha});

  fn elu_f32(a: ${t}) -> ${t} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${t}>) -> vec4<${t}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,e.cacheKey))},u0=(n="f32")=>`
const r0: ${n} = 0.3275911;
const r1: ${n} = 0.254829592;
const r2: ${n} = -0.284496736;
const r3: ${n} = 1.421413741;
const r4: ${n} = -1.453152027;
const r5: ${n} = 1.061405429;

fn erf_vf32(v: vec4<${n}>) -> vec4<${n}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,ZV=n=>{let e=mi(n.inputs[0].dataType);n.compute(lt(n.inputs[0],"Erf",t=>`erf_vf32(${t})`,u0(e)))},ej=n=>{n.compute(lt(n.inputs[0],"Exp","exp"))},tj=n=>{n.compute(lt(n.inputs[0],"Floor","floor"))},nj=n=>{let e=mi(n.inputs[0].dataType);n.compute(lt(n.inputs[0],"Gelu",t=>`0.5 * ${t} * (1.0 + erf_vf32(${t} * 0.7071067811865475))`,u0(e)))},ij=(n,e)=>{let t=mi(n.inputs[0].dataType);n.compute(lt(n.inputs[0],"LeakyRelu",i=>`select(leaky_relu_alpha_ * ${i}, ${i}, ${i} >= vec4<${t}>(0.0))`,`const leaky_relu_alpha_ = ${t}(${e.alpha});`,e.cacheKey))},rj=n=>{n.compute(lt(n.inputs[0],"Not",e=>`!${e}`))},sj=n=>{n.compute(lt(n.inputs[0],"Neg",e=>`-${e}`))},aj=n=>{n.compute(lt(n.inputs[0],"Reciprocal",e=>`1.0/${e}`))},oj=n=>{let e=mi(n.inputs[0].dataType);n.compute(lt(n.inputs[0],"Relu",t=>`select(vec4<${e}>(0.0), ${t}, ${t} > vec4<${e}>(0.0))`))},lj=n=>{n.compute(lt(n.inputs[0],"Sigmoid",e=>`(1.0 / (1.0 + exp(-${e})))`))},uj=n=>ht(n),cj=(n,e)=>{let t=mi(n.inputs[0].dataType);n.compute(lt(n.inputs[0],"HardSigmoid",i=>`max(vec4<${t}>(0.0), min(vec4<${t}>(1.0), ${e.alpha} * ${i} + vec4<${t}>(${e.beta})))`,void 0,e.cacheKey))},dj=n=>{n.compute(lt(n.inputs[0],"Sin","sin"))},hj=n=>{n.compute(lt(n.inputs[0],"Sinh","sinh"))},fj=n=>{n.compute(lt(n.inputs[0],"Sqrt","sqrt"))},pj=n=>{n.compute(lt(n.inputs[0],"Tan","tan"))},RE=n=>`sign(${n}) * (1 - exp(-2 * abs(${n}))) / (1 + exp(-2 * abs(${n})))`,mj=n=>{n.compute(lt(n.inputs[0],"Tanh",RE))},BT=(n="f32")=>`
const fast_gelu_a: ${n} = 0.5;
const fast_gelu_b: ${n} = 0.7978845608028654;
const fast_gelu_c: ${n} = 0.035677408136300125;

fn tanh_v(v: vec4<${n}>) -> vec4<${n}> {
  return ${RE("v")};
}
`,UT=n=>`(fast_gelu_a + fast_gelu_a * tanh_v(${n} * (fast_gelu_c * ${n} * ${n} + fast_gelu_b))) * ${n}`,gj=n=>{let e=mi(n.inputs[0].dataType);n.compute(lt(n.inputs[0],"FastGelu",UT,BT(e),void 0,n.inputs[0].dataType))},yj=(n,e)=>{let t=mi(n.inputs[0].dataType);return n.compute(lt(n.inputs[0],"ThresholdedRelu",i=>`select(vec4<${t}>(0.0), ${i}, ${i} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${t}>(${e.alpha});`,e.cacheKey)),0},_j=n=>{n.compute(lt(n.inputs[0],"Log","log"))},NN=(n,e)=>`
const alpha = vec4<${n}>(${e});
const one = ${n}(1.0);
const zero = ${n}(0.0);

fn quick_gelu_impl(x: vec4<${n}>) -> vec4<${n}> {
  let v = x *alpha;
  var x1 : vec4<${n}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,DN=n=>`quick_gelu_impl(${n})`,vj=(n,e)=>{let t=mi(n.inputs[0].dataType);n.compute(lt(n.inputs[0],"QuickGelu",DN,NN(t,e.alpha),e.cacheKey,n.inputs[0].dataType))}}),MN,ON,wj,qJ=fe(()=>{je(),Be(),vC(),MN=n=>{if(n[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(n[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(n[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(n[0].dims[2]!==n[1].dims[0])throw new Error("last dimension of input and bias are not the same")},ON=n=>{let e=n[0].dims.slice();e[2]=e[2]/2;let t=le("input",n[0].dataType,n[0].dims,4),i=le("bias",n[0].dataType,[n[0].dims[2]],4),r=Te("output",n[0].dataType,e,4),s=ie.size(e)/4,a=$n(n[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:e,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)}}),getShaderSource:o=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${n[0].dims[2]/4/2}u;

  ${o.declareVariables(t,i,r)}

  ${u0(a)}

  ${o.mainStart()}
    ${o.guardAgainstOutOfBoundsWorkgroupSizes(s)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${r.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},wj=n=>{MN(n.inputs),n.compute(ON(n.inputs))}}),LN,FN,ms,bj,xj,Ej,Aj,Tj,Sj,Ij,Cj,kj,$j,GJ=fe(()=>{Oe(),je(),Be(),LN=(n,e,t,i,r,s,a,o,l,u,c,h)=>{let f,m;typeof o=="string"?f=m=(w,E)=>`${o}((${w}),(${E}))`:typeof o=="function"?f=m=o:(f=o.scalar,m=o.vector);let y=Te("outputData",c,i.length,4),_=le("aData",l,e.length,4),x=le("bData",u,t.length,4),v;if(r)if(s){let w=ie.size(e)===1,E=ie.size(t)===1,C=e.length>0&&e[e.length-1]%4===0,D=t.length>0&&t[t.length-1]%4===0;w||E?v=y.setByOffset("global_idx",m(w?`${_.type.value}(${_.getByOffset("0")}.x)`:_.getByOffset("global_idx"),E?`${x.type.value}(${x.getByOffset("0")}.x)`:x.getByOffset("global_idx"))):v=`
            let outputIndices = ${y.offsetToIndices("global_idx * 4u")};
            let offsetA = ${_.broadcastedIndicesToOffset("outputIndices",y)};
            let offsetB = ${x.broadcastedIndicesToOffset("outputIndices",y)};
            ${y.setByOffset("global_idx",m(a||C?_.getByOffset("offsetA / 4u"):`${_.type.value}(${_.getByOffset("offsetA / 4u")}[offsetA % 4u])`,a||D?x.getByOffset("offsetB / 4u"):`${x.type.value}(${x.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else v=y.setByOffset("global_idx",m(_.getByOffset("global_idx"),x.getByOffset("global_idx")));else{if(!s)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let w=(E,C,D="")=>{let V=`aData[indexA${C}][componentA${C}]`,I=`bData[indexB${C}][componentB${C}]`;return`
            let outputIndices${C} = ${y.offsetToIndices(`global_idx * 4u + ${C}u`)};
            let offsetA${C} = ${_.broadcastedIndicesToOffset(`outputIndices${C}`,y)};
            let offsetB${C} = ${x.broadcastedIndicesToOffset(`outputIndices${C}`,y)};
            let indexA${C} = offsetA${C} / 4u;
            let indexB${C} = offsetB${C} / 4u;
            let componentA${C} = offsetA${C} % 4u;
            let componentB${C} = offsetB${C} % 4u;
            ${E}[${C}] = ${D}(${f(V,I)});
          `};c===9?v=`
            var data = vec4<u32>(0);
            ${w("data",0,"u32")}
            ${w("data",1,"u32")}
            ${w("data",2,"u32")}
            ${w("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:v=`
            ${w("outputData[global_idx]",0)}
            ${w("outputData[global_idx]",1)}
            ${w("outputData[global_idx]",2)}
            ${w("outputData[global_idx]",3)}
          `}return`
        ${n.registerUniform("vec_size","u32").declareVariables(_,x,y)}

        ${h??""}

        ${n.mainStart()}
        ${n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${v}
      }`},FN=(n,e,t,i,r,s,a=t.dataType)=>{let o=t.dims.map(_=>Number(_)??1),l=i.dims.map(_=>Number(_)??1),u=!ie.areEqual(o,l),c=o,h=ie.size(o),f=!1,m=!1,y=[u];if(u){let _=Rp.calcShape(o,l,!1);if(!_)throw new Error("Can't perform binary op on the given tensors");c=_.slice(),h=ie.size(c);let x=ie.size(o)===1,v=ie.size(l)===1,w=o.length>0&&o[o.length-1]%4===0,E=l.length>0&&l[l.length-1]%4===0;y.push(x),y.push(v),y.push(w),y.push(E);let C=1;for(let D=1;D<c.length;D++){let V=o[o.length-D],I=l[l.length-D];if(V===I)C*=V;else break}C%4===0?(m=!0,f=!0):(x||v||w||E)&&(f=!0)}else f=!0;return y.push(f),{name:n,shaderCache:{hint:e+y.map(_=>_.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:_=>LN(_,o,l,c,f,u,m,r,t.dataType,i.dataType,a,s),getRunData:()=>({outputs:[{dims:c,dataType:a}],dispatchGroup:{x:Math.ceil(h/64/4)},programUniforms:[{type:12,data:Math.ceil(ie.size(c)/4)},...Re(o,l,c)]})}},ms=(n,e,t,i,r,s)=>{n.compute(FN(e,r??"",n.inputs[0],n.inputs[1],t,i,s))},bj=n=>{ms(n,"Add",(e,t)=>`${e}+${t}`)},xj=n=>{ms(n,"Div",(e,t)=>`${e}/${t}`)},Ej=n=>{ms(n,"Equal",{scalar:(e,t)=>`u32(${e}==${t})`,vector:(e,t)=>`vec4<u32>(${e}==${t})`},void 0,void 0,9)},Aj=n=>{ms(n,"Mul",(e,t)=>`${e}*${t}`)},Tj=n=>{let e=le("input",n.inputs[0].dataType,n.inputs[0].dims).type.value;ms(n,"Pow",{scalar:(t,i)=>`pow_custom(${t},${i})`,vector:(t,i)=>`pow_vector_custom(${t},${i})`},`
    fn pow_custom(a : ${e}, b : ${e}) -> ${e} {
      if (b == ${e}(0.0)) {
        return ${e}(1.0);
      } else if (a < ${e}(0.0) && f32(b) != floor(f32(b))) {
        return ${e}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${e}(1.0), round(f32(abs(b) % ${e}(2.0))) != 1.0) * ${e}(${e==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${e}>, b : vec4<${e}>) -> vec4<${e}> {
      // TODO: implement vectorized pow
      return vec4<${e}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},Sj=n=>{ms(n,"Sub",(e,t)=>`${e}-${t}`)},Ij=n=>{ms(n,"Greater",{scalar:(e,t)=>`u32(${e}>${t})`,vector:(e,t)=>`vec4<u32>(${e}>${t})`},void 0,void 0,9)},Cj=n=>{ms(n,"Less",{scalar:(e,t)=>`u32(${e}<${t})`,vector:(e,t)=>`vec4<u32>(${e}<${t})`},void 0,void 0,9)},kj=n=>{ms(n,"GreaterOrEqual",{scalar:(e,t)=>`u32(${e}>=${t})`,vector:(e,t)=>`vec4<u32>(${e}>=${t})`},void 0,void 0,9)},$j=n=>{ms(n,"LessOrEqual",{scalar:(e,t)=>`u32(${e}<=${t})`,vector:(e,t)=>`vec4<u32>(${e}<=${t})`},void 0,void 0,9)}}),zN,VN,jN,BN,Rj,Pj,KJ=fe(()=>{Oe(),je(),Zt(),Be(),zN=(n,e)=>{if(!n||n.length<1)throw new Error("too few inputs");let t=0,i=n[t],r=i.dataType,s=i.dims.length;n.forEach((a,o)=>{if(o!==t){if(a.dataType!==r)throw new Error("input tensors should be one type");if(a.dims.length!==s)throw new Error("input tensors should have the same shape");a.dims.forEach((l,u)=>{if(u!==e&&l!==i.dims[u])throw new Error("non concat dimensions must match")})}})},VN=(n,e)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${n}u>(${e});
    for (var i: u32 = 0u; i < ${n}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${n}u;
  }`,jN=(n,e)=>{let t=n.length,i=[];for(let r=0;r<t;++r){let s=e.setByOffset("global_idx",n[r].getByIndices("indices"));t===1?i.push(s):r===0?i.push(`if (inputIndex == ${r}u) { ${s} }`):r===t-1?i.push(`else { ${s} }`):i.push(`else if (inputIndex == ${r}) { ${s} }`)}return i.join(`
`)},BN=(n,e,t,i)=>{let r=ie.size(t),s=new Array(n.length),a=new Array(n.length),o=0,l=[],u=[],c=[{type:12,data:r}];for(let _=0;_<n.length;++_)o+=n[_].dims[e],s[_]=o,u.push(n[_].dims.length),a[_]=le(`input${_}`,i,u[_]),l.push("rank"),c.push({type:12,data:s[_]});for(let _=0;_<n.length;++_)c.push(...Re(n[_].dims));c.push(...Re(t));let h=Te("output",i,t.length),f=h.indicesGet("indices",e),m=Array.from(Array(s.length).keys()).map(_=>`uniforms.sizeInConcatAxis${_}`).join(","),y=_=>`

  ${(()=>{_.registerUniform("outputSize","u32");for(let x=0;x<n.length;x++)_.registerUniform(`sizeInConcatAxis${x}`,"u32");return _.declareVariables(...a,h)})()}

  ${VN(s.length,m)}

  ${_.mainStart()}
    ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${h.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${f});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${s.length}u>(${m});
      ${f} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${jN(a,h)}
  }`;return{name:"Concat",shaderCache:{hint:`${e}`,inputDependencies:l},getRunData:()=>({outputs:[{dims:t,dataType:i}],dispatchGroup:{x:Math.ceil(r/64)},programUniforms:c}),getShaderSource:y}},Rj=(n,e)=>{let t=n.inputs,i=t[0].dims,r=ie.normalizeAxis(e.axis,i.length);zN(t,r);let s=i.slice();s[r]=t.reduce((o,l)=>o+(l.dims.length>r?l.dims[r]:0),0);let a=t.filter(o=>ie.size(o.dims)>0);n.compute(BN(a,r,s,t[0].dataType),{inputs:a})},Pj=n=>ht({axis:n.axis})}),jd,Bd,Ud,wC,rh=fe(()=>{Oe(),je(),jd=(n,e,t="f32")=>{switch(n.activation){case"Relu":return`value = max(value, ${e}(0.0));`;case"Sigmoid":return`value = (${e}(1.0) / (${e}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${e}(${t}(uniforms.clip_min)), ${e}(${t}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${e}(0.0), min(${e}(1.0), ${t}(uniforms.alpha) * value + ${t}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${t}(uniforms.alpha) * value, value, value >= ${e}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw new Error(`Unsupported activation ${n.activation}`)}},Bd=(n,e)=>{n.activation==="Clip"?e.push({type:1,data:n.clipMax},{type:1,data:n.clipMin}):n.activation==="HardSigmoid"?e.push({type:1,data:n.alpha},{type:1,data:n.beta}):n.activation==="LeakyRelu"&&e.push({type:1,data:n.alpha})},Ud=(n,e)=>{n.activation==="Clip"?e.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):n.activation==="HardSigmoid"?e.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):n.activation==="LeakyRelu"&&e.push({name:"alpha",type:"f32"})},wC=n=>{let e=(n==null?void 0:n.activation)||"";if(e==="HardSigmoid"){let[t,i]=(n==null?void 0:n.activation_params)||[.2,.5];return{activation:e,alpha:t,beta:i}}else if(e==="Clip"){let[t,i]=(n==null?void 0:n.activation_params)||[rV,sV];return{activation:e,clipMax:i,clipMin:t}}else if(e==="LeakyRelu"){let[t]=(n==null?void 0:n.activation_params)||[.01];return{activation:e,alpha:t}}return{activation:e}}}),jn,Nj,bC=fe(()=>{jn=(n,e)=>{switch(n){case 1:return e;case 2:return`vec2<${e}>`;case 3:return`vec3<${e}>`;case 4:return`vec4<${e}>`;default:throw new Error(`${n}-component is not supported.`)}},Nj=n=>`
      ${n?"value = value + getBiasByOutputCoords(coords);":""}
      `}),Dj,YJ=fe(()=>{Dj=n=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${n}.x), i32(${n}.y), i32(${n}.z), 1));
}
`}),Vg,xC,EC=fe(()=>{Oe(),je(),Be(),rh(),Vg=(n,e,t,i,r)=>{let s=i-t;return`
      ${Array.from({length:t}).map((a,o)=>`
      if (${$e(e.shape,o,e.rank)} != 1) {
        ${e.indicesSet(n,o,$e(r,o+s,i))}
      } else {
        ${e.indicesSet(n,o,0)}
      }`).join("")}
`},xC=(n,e,t,i,r=!1,s)=>{let a=n[0].dims,o=n[1].dims,l=a[a.length-2],u=o[o.length-1],c=a[a.length-1],h=Wt(u),f=Wt(c),m=Wt(l),y=ie.size(t)/h/m,_=n.length>2,x=i?i.slice(0,-2):t.slice(0,-2),v=[ie.size(x),l,u],w=[{type:12,data:y},{type:12,data:l},{type:12,data:u},{type:12,data:c}];Bd(e,w),w.push(...Re(x,a,o)),_&&w.push(...Re(n[2].dims)),w.push(...Re(v));let E=C=>{let D=gC("batch_dims",n[0].dataType,x.length),V=le("a",n[0].dataType,a.length,f),I=le("b",n[1].dataType,o.length,h),k=Te("output",n[0].dataType,v.length,h),N=$n(k.type.tensor),L=jd(e,k.type.value,N),j=[V,I],H="";if(_){let ue=r?h:1;j.push(le("bias",n[2].dataType,n[2].dims.length,ue)),H=`${r?`value += bias[col / ${ue}];`:`value += ${k.type.value}(bias[row + i]);`}`}let M=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];Ud(e,M);let se=()=>{let ue=`var a_data: ${V.type.value};`;for(let ee=0;ee<f;ee++)ue+=`
              let b_data${ee} = b[(b_offset + (k + ${ee}) * uniforms.N + col) / ${h}];`;for(let ee=0;ee<m;ee++){ue+=`a_data = a[(a_offset + (row + ${ee}) * uniforms.K + k) / ${f}];`;for(let ae=0;ae<f;ae++)ue+=`
            values[${ee}] = fma(${I.type.value}(a_data${f===1?"":`[${ae}]`}), b_data${ae}, values[${ee}]);
`}return ue};return`
  ${C.registerUniforms(M).registerInternalVariables(D).declareVariables(...j,k)}
  ${C.mainStart()}
    ${C.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${h})) * ${h};
    var index1 = global_idx / (uniforms.N / ${h});
    let stride1 = uniforms.M / ${m};
    let row = (index1 % stride1) * ${m};
    let batch = index1 / stride1;

    ${t.length===2?"":`let batch_indices = ${D.offsetToIndices("batch")};`}

    var a_indices: ${V.type.indices};
    ${Vg("a_indices",V,V.rank-2,D.rank,"batch_indices")}
    ${V.indicesSet("a_indices",V.rank-2,0)}
    ${V.indicesSet("a_indices",V.rank-1,0)}
    let a_offset = ${V.indicesToOffset("a_indices")};

    var b_indices: ${I.type.indices};
    ${Vg("b_indices",I,I.rank-2,D.rank,"batch_indices")}
    ${I.indicesSet("b_indices",I.rank-2,0)}
    ${I.indicesSet("b_indices",I.rank-1,0)}
    let b_offset = ${I.indicesToOffset("b_indices")};
    var values: array<${k.type.value}, ${m}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${f}) {
      ${se()}
    }
    for (var i = 0u; i < ${m}u; i++) {
      var value = values[i];
      ${H}
      ${L}
      let cur_indices = ${k.type.indices}(batch, row + i, col);
      let offset = ${k.indicesToOffset("cur_indices")};
      ${k.setByOffset(`offset / ${h}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${e.activation};${h};${f};${m};${r}`,inputDependencies:_?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:s?s(t):t,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(y/64)},programUniforms:w}),getShaderSource:E}}}),UN,HN,HT,PE,WN,WT,qN,Mb,AC=fe(()=>{Oe(),je(),Be(),rh(),EC(),bC(),UN=(n,e)=>n?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${e?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${e?", batchIndices":""});
        `,HN=(n,e)=>n?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${e===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${e===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${e===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,HT=(n,e,t="f32",i,r=!1,s=32,a=!1,o=32)=>{let l=e[1]*n[1],u=e[0]*n[0],c=r?l:s,h=r?s:l,f=c/e[0],m=s/e[1];if(!((r&&f===4&&n[1]===4||!r&&(f===3||f===4))&&c%e[0]===0&&s%e[1]===0&&n[0]===4))throw new Error(`If transposeA ${r} is true, innerElementSize ${f} and workPerThread[1] ${n[1]} must be 4.
      Otherwise, innerElementSize ${f} must be 3 or 4.
  tileAWidth ${c} must be divisible by workgroupSize[0]${e[0]}. tileInner ${s} must be divisible by workgroupSize[1] ${e[1]}. colPerThread ${n[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${f}<${t}>, ${c/f}>, ${h}>;
var<workgroup> mm_Bsub: array<array<vec4<${t}>, ${u/n[0]}>, ${s}>;

const rowPerThread = ${n[1]};
const colPerThread = ${n[0]};
const innerElementSize = ${f};
const tileInner = ${s};

@compute @workgroup_size(${e[0]}, ${e[1]}, ${e[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${a?"0":"i32(globalId.z)"};
  ${i?`let batchIndices = ${i.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${l};

  let num_tiles = ${a?`${Math.ceil(o/s)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${a?`i32(globalId.z) * ${o}`:"0"};

  var acc: array<vec4<${t}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${m};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${UN(r,i)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${m}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${i?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${f===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${HN(r,f)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},PE=(n,e)=>n?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${e?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${e?", batchIndices":""});
            `,WN=n=>n?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",WT=(n,e,t="f32",i,r=!1,s=32,a=!1,o=32,l=!1)=>{let u=n[1]*e[1],c=n[0]*e[0],h=r?u:s,f=r?s:u;if(!(f%e[1]===0&&h%e[0]===0&&s%e[1]===0))throw new Error(`tileAHight ${f} must be divisible by workgroupSize[1]${e[1]}, tileAWidth ${h} must be divisible by workgroupSize[0]${e[0]}, tileInner ${s} must be divisible by workgroupSize[1]${e[1]}`);let m=f/e[1],y=h/e[0],_=s/e[1],x=l?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${u};
    let globalColStart = i32(workgroupId.x) * ${c};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${f}; inputRow = inputRow + ${e[1]}) {
        for (var inputCol = localCol; inputCol < ${h}; inputCol = inputCol + ${e[0]}) {
          ${PE(r,i)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${s}; inputRow = inputRow + ${e[1]}) {
            for (var inputCol = localCol; inputCol < ${c}; inputCol = inputCol + ${e[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${i?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${t}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${e[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${r?`mm_Asub[k][localRow + innerRow * ${e[1]}];`:`mm_Asub[localRow + innerRow * ${e[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${e[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${e[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${u};

let tileRowA = i32(localId.y) * ${m};
let tileColA = i32(localId.x) * ${y};
let tileRowB = i32(localId.y) * ${_};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${m}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${y}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${PE(r,i)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${_}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${i?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${t}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${WN(r)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${t}, ${h}>, ${f}>;
  var<workgroup> mm_Bsub : array<array<${t}, ${c}>, ${s}>;
  const rowPerThread = ${n[1]};
  const colPerThread = ${n[0]};
  const tileInner = ${s};

@compute @workgroup_size(${e[0]}, ${e[1]}, ${e[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${a?"0":"i32(globalId.z)"};
    ${i?`let batchIndices = ${i.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${a?`${Math.ceil(o/s)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${a?`i32(globalId.z) * ${o}`:"0"};

    var acc : array<array<${t}, colPerThread>, rowPerThread>;
    ${x}
  }
`},qN=(n,e,t,i,r=!1)=>{let[s,a,o,l]=i,u=$n(i[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${s.type.indices}) -> ${jn(n,u)} {
      var value = ${jn(n,u)}(0.0);
      let col = colIn * ${n};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${a.type.indices};
        ${Vg("aIndices",a,a.rank-2,s.rank,"batchIndices")}
        ${a.indicesSet("aIndices",a.rank-2,"u32(row)")}
        ${a.indicesSet("aIndices",a.rank-1,"u32(colIn)")}
        value = ${a.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${s.type.indices}) -> ${jn(n,u)} {
      var value = ${jn(n,u)}(0.0);
      let col = colIn * ${n};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${o.type.indices};
        ${Vg("bIndices",o,o.rank-2,s.rank,"batchIndices")}
        ${o.indicesSet("bIndices",o.rank-2,"u32(row)")}
        ${o.indicesSet("bIndices",o.rank-1,"u32(colIn)")}
        value = ${o.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${jn(n,u)}) {
      let col = colIn * ${n};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${e?`value = value + ${r?"bias[colIn]":`${jn(n,u)}(bias[row])`};`:""}
        ${t}
        ${l.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},Mb=(n,e,t,i,r=!1,s)=>{let a=n[0].dims,o=n[1].dims,l=a.slice(0,-2),u=o.slice(0,-2),c=i?i.slice(0,-2):t.slice(0,-2),h=ie.size(c),f=a[a.length-2],m=a[a.length-1],y=o[o.length-1],_=m%4===0&&y%4===0,x=f<=8?[4,1,1]:[4,4,1],v=[8,8,1],w=[Math.ceil(y/v[0]/x[0]),Math.ceil(f/v[1]/x[1]),Math.ceil(h/v[2]/x[2])],E=_?4:1,C=[...l,f,m/E],D=C.length,V=[...u,m,y/E],I=V.length,k=[h,f,y/E],N=[{type:6,data:f},{type:6,data:y},{type:6,data:m}];Bd(e,N),N.push(...Re(c,C,V));let L=["rank","rank"],j=n.length>2;j&&(N.push(...Re(n[2].dims)),L.push("rank")),N.push(...Re(k));let H=M=>{let se=c.length,ue=gC("batchDims",n[0].dataType,se,1),ee=$n(n[0].dataType),ae=le("a",n[0].dataType,D,E),J=le("b",n[1].dataType,I,E),q=Te("result",n[0].dataType,k.length,E),G=[ae,J];if(j){let ge=r?E:1;G.push(le("bias",n[2].dataType,n[2].dims.length,ge))}let U=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];Ud(e,U);let Y=$n(q.type.tensor),K=jd(e,q.type.value,Y),Z=qN(E,j,K,[ue,ae,J,q],r);return`
  ${M.registerUniforms(U).registerInternalVariables(ue).declareVariables(...G,q)}
  ${Z}
  ${_?HT(x,v,ee,ue):WT(x,v,ee,ue)}
                   `};return{name:"MatMul",shaderCache:{hint:`${x};${e.activation};${_};${r}`,inputDependencies:L},getRunData:()=>({outputs:[{dims:s?s(t):t,dataType:n[0].dataType}],dispatchGroup:{x:w[0],y:w[1],z:w[2]},programUniforms:N}),getShaderSource:H}}}),GN,Mj,XJ=fe(()=>{Oe(),el(),Be(),rh(),bC(),YJ(),AC(),GN=(n,e,t,i,r=!1,s,a=4,o=4,l=4,u="f32")=>{let c=N=>{switch(N){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${u}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${N} is not supported.`)}},h=N=>{switch(N){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${N} is not supported.`)}},f=n?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,m=n?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,y=n?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",_=n?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",x=n?"row":"col",v=n?"col":"row",w=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${n?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${x} / outWidth;
    let outCol = ${x} % outWidth;

    let WRow = ${v} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${v} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${v} % inChannels;
    var resData = ${jn(a,u)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${y} && xCol >= 0 && xCol < ${_}) {
      ${f}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${c(a)}
    }
    return resData;`,E=n?e&&i?`
    let col = colIn * ${a};
    ${w}`:`
    let col = colIn * ${a};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${w}
    }
    return ${jn(a,u)}(0.0);`:i&&t?`
    let col = colIn * ${a};
    ${w}`:`
    let col = colIn * ${a};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${w}
    }
    return ${jn(a,u)}(0.0);`,C=n?i&&t?h(o):`
    let col = colIn * ${o};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${h(o)}
    }
    return ${jn(o,u)}(0.0);`:`
    let col = colIn * ${o};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${h(o)}
    }
    return ${jn(o,u)}(0.0);`,D=jn(l,u),V=jn(n?a:o,u),I=jn(n?o:a,u),k=jd(s,D,u);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${V} {
      ${n?E:C}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${I} {
      ${n?C:E}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${D}) {
      let col = colIn * ${l};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${n?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${m}
      ${Nj(r)}
      ${k}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},Mj=(n,e,t,i,r,s,a,o,l)=>{let u=e.format==="NHWC",c=u?n[0].dims[3]:n[0].dims[1],h=t[0],f=u?t[2]:t[3],m=u?t[1]:t[2],y=u?t[3]:t[1],_=u&&(c%4===0||c%3===0)&&y%4===0,x=u?y:f*m,v=u?f*m:y,w=[8,8,1],E=i<=8?[4,1,1]:[4,4,1],C=[Math.ceil(x/w[0]/E[0]),Math.ceil(v/w[1]/E[1]),Math.ceil(h/w[2]/E[2])];et("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${C}`);let D=_?u&&c%4!==0?3:4:1,V=w[1]*E[1],I=w[0]*E[0],k=Math.max(w[0]*D,w[1]),N=i%V===0,L=r%I===0,j=s%k===0,H=_?[D,4,4]:[1,1,1],M=[{type:6,data:i},{type:6,data:r},{type:6,data:s},{type:6,data:[e.pads[0],e.pads[1]]},{type:6,data:e.strides},{type:6,data:e.dilations}];Bd(e,M),M.push(...Re(n[0].dims,n[1].dims));let se=["rank","rank"];a&&(M.push(...Re(n[2].dims)),se.push("rank")),M.push(...Re(t));let ue=ee=>{let ae=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];Ud(e,ae);let J=_?4:1,q=$n(n[0].dataType),G=`
      fn setOutputAtIndex(flatIndex : i32, value : ${_?`vec4<${q}>`:q}) {
        result[flatIndex] = ${_?`vec4<${q}>`:q}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${_?`vec4<${q}>`:q}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${_?"/ 4":""}, value);
      }`,U=le("x",n[0].dataType,n[0].dims.length,D===3?1:D),Y=le("w",n[1].dataType,n[1].dims.length,J),K=[U,Y],Z=Te("result",n[0].dataType,t.length,J);if(a){let ge=le("bias",n[2].dataType,n[2].dims.length,J);K.push(ge),G+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${_?`vec4<${q}>`:q} {
          return bias[coords.${u?"w":"y"}${_?"/ 4":""}];
        }`}return`
        ${Dj("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${ee.registerUniforms(ae).declareVariables(...K,Z)}
        ${G}
        ${GN(u,N,L,j,a,e,H[0],H[1],H[2],q)}
        ${_?HT(E,w,q,void 0,!u,k):WT(E,w,q,void 0,!u,k,!1,void 0,o)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${e.cacheKey};${D};${_};${N};${L};${j};${V};${I};${k}`,inputDependencies:se},getRunData:()=>({outputs:[{dims:l?l(t):t,dataType:n[0].dataType}],dispatchGroup:{x:C[0],y:C[1],z:C[2]},programUniforms:M}),getShaderSource:ue}}}),KN,NE,Mm,YN,DE,XN,Oj,Lj,QJ=fe(()=>{Oe(),el(),je(),Be(),rh(),bC(),KN=n=>{let e=1;for(let t=0;t<n.length;t++)e*=n[t];return e},NE=n=>typeof n=="number"?[n,n,n]:n,Mm=(n,e)=>e<=1?n:n+(n-1)*(e-1),YN=(n,e,t,i=1)=>{let r=Mm(e,i);return Math.floor((n[0]*(t-1)-t+r)/2)},DE=(n,e,t,i,r)=>{r==null&&(r=YN(n,e[0],i[0]));let s=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*r>=e[a]&&(s[a]=Math.trunc((n[a]-e[a]+2*r)/i[a]+1));return s},XN=(n,e,t,i,r,s,a,o,l,u)=>{let c,h,f,m;if(n==="VALID"&&(n=0),typeof n=="number"){c={top:n,bottom:n,left:n,right:n,front:n,back:n};let y=DE([e,t,i,1],[o,l,u],1,[r,s,a],n);h=y[0],f=y[1],m=y[2]}else if(Array.isArray(n)){if(!n.every((_,x,v)=>_===v[0]))throw Error(`Unsupported padding parameter: ${n}`);c={top:n[0],bottom:n[1],left:n[2],right:n[3],front:n[4],back:n[5]};let y=DE([e,t,i,1],[o,l,u],1,[r,s,a],n[0]);h=y[0],f=y[1],m=y[2]}else if(n==="SAME_UPPER"){h=Math.ceil(e/r),f=Math.ceil(t/s),m=Math.ceil(i/a);let y=(h-1)*r+o-e,_=(f-1)*s+l-t,x=(m-1)*a+u-i,v=Math.floor(y/2),w=y-v,E=Math.floor(_/2),C=_-E,D=Math.floor(x/2),V=x-D;c={top:E,bottom:C,left:D,right:V,front:v,back:w}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:c,outDepth:h,outHeight:f,outWidth:m}},Oj=(n,e,t,i,r,s=!1,a="channelsLast")=>{let o,l,u,c,h;if(a==="channelsLast")[o,l,u,c,h]=n;else if(a==="channelsFirst")[o,h,l,u,c]=n;else throw new Error(`Unknown dataFormat ${a}`);let[f,,m,y,_]=e,[x,v,w]=NE(t),[E,C,D]=NE(i),V=Mm(m,E),I=Mm(y,C),k=Mm(_,D),{padInfo:N,outDepth:L,outHeight:j,outWidth:H}=XN(r,l,u,c,x,v,w,V,I,k),M=s?f*h:f,se=[0,0,0,0,0];return a==="channelsFirst"?se=[o,M,L,j,H]:a==="channelsLast"&&(se=[o,L,j,H,M]),{batchSize:o,dataFormat:a,inDepth:l,inHeight:u,inWidth:c,inChannels:h,outDepth:L,outHeight:j,outWidth:H,outChannels:M,padInfo:N,strideDepth:x,strideHeight:v,strideWidth:w,filterDepth:m,filterHeight:y,filterWidth:_,effectiveFilterDepth:V,effectiveFilterHeight:I,effectiveFilterWidth:k,dilationDepth:E,dilationHeight:C,dilationWidth:D,inShape:n,outShape:se,filterShape:e}},Lj=(n,e,t,i,r,s)=>{let a=s==="channelsLast";a?n[0].dims[3]:n[0].dims[1];let o=[64,1,1],l={x:t.map((x,v)=>v)},u=[Math.ceil(KN(l.x.map(x=>t[x]))/o[0]),1,1];et("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${u}`);let c=1,h=ie.size(t),f=[{type:12,data:h},{type:12,data:i},{type:12,data:r},{type:12,data:e.strides},{type:12,data:e.dilations}];Bd(e,f),f.push(...Re(n[0].dims,n[1].dims));let m=["rank","rank"],y=n.length===3;y&&(f.push(...Re(n[2].dims)),m.push("rank")),f.push(...Re(t));let _=x=>{let v=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:i.length},{name:"pads",type:"u32",length:r.length},{name:"strides",type:"u32",length:e.strides.length},{name:"dilations",type:"u32",length:e.dilations.length}];Ud(e,v);let w=1,E=$n(n[0].dataType),C=le("x",n[0].dataType,n[0].dims.length,c),D=le("W",n[1].dataType,n[1].dims.length,w),V=[C,D],I=Te("result",n[0].dataType,t.length,w),k="";if(y){let j=le("bias",n[2].dataType,n[2].dims.length,w);V.push(j),k+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${E} {
          return bias[${a?$e("coords",4,5):$e("coords",1,5)}];
        }`}let N=jn(c,E),L=jd(e,N,E);return`
            ${k}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${C.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${D.getByIndices("aIndices")};
            }
          ${x.registerUniforms(v).declareVariables(...V,I)}
          ${x.mainStart()}
          ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${I.offsetToIndices("global_idx")};
              let batch = ${$e("coords",0,C.rank)};
              let d2 = ${a?$e("coords",C.rank-1,C.rank):$e("coords",1,C.rank)};
              let xFRCCorner = vec3<u32>(${a?$e("coords",1,C.rank):$e("coords",2,C.rank)},
              ${a?$e("coords",2,C.rank):$e("coords",3,C.rank)},
              ${a?$e("coords",3,C.rank):$e("coords",4,C.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${a?$e("uniforms.x_shape",1,C.rank):$e("uniforms.x_shape",2,C.rank)};
              let xShapeZ = ${a?$e("uniforms.x_shape",2,C.rank):$e("uniforms.x_shape",3,C.rank)};
              let xShapeW = ${a?$e("uniforms.x_shape",3,C.rank):$e("uniforms.x_shape",4,C.rank)};
              let xShapeU = ${a?$e("uniforms.x_shape",4,C.rank):$e("uniforms.x_shape",1,C.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${a?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${a?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${a?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${a?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${y?"value = value + getBiasByOutputCoords(coords)":""};
              ${L}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${e.cacheKey};${a};${c};${y}`,inputDependencies:m},getRunData:()=>({outputs:[{dims:t,dataType:n[0].dataType}],dispatchGroup:{x:u[0],y:u[1],z:u[2]},programUniforms:f}),getShaderSource:_}}}),Fj,zj,JJ=fe(()=>{Oe(),je(),Be(),rh(),Fj=(n,e,t,i)=>{let r=n.length>2,s=r?"value += b[output_channel];":"",a=n[0].dims,o=n[1].dims,l=e.format==="NHWC",u=l?t[3]:t[1],c=u/e.group,h=l&&c>=4?Wt(u):1,f=ie.size(t)/h,m=[{type:12,data:f},{type:12,data:e.dilations},{type:12,data:[e.strides[0],e.strides[1]]},{type:12,data:[e.pads[0],e.pads[1]]},{type:12,data:c}];Bd(e,m),m.push(...Re(a,[o[0],o[1],o[2],o[3]/h]));let y=r?["rank","rank","rank"]:["rank","rank"];m.push(...Re([t[0],t[1],t[2],t[3]/h]));let _=x=>{let v=Te("output",n[0].dataType,t.length,h),w=$n(v.type.tensor),E=jd(e,v.type.value,w),C=le("x",n[0].dataType,a.length),D=le("w",n[1].dataType,o.length,h),V=[C,D];r&&V.push(le("b",n[2].dataType,n[2].dims,h));let I=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:e.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];Ud(e,I);let k=l?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${C.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${D.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${C.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${D.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${x.registerUniforms(I).declareVariables(...V,v)}

  ${x.mainStart()}
    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${v.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${l?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${l?1:2}], outputIndices[${l?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${h} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${l?2:1}];

    var value: ${v.type.value} = ${v.type.value}(0);
    ${k}
    ${s}
    ${E}
    ${v.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${e.cacheKey}_${h}`,inputDependencies:y},getRunData:()=>({outputs:[{dims:i?i(t):t,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:m}),getShaderSource:_}},zj=(n,e,t,i)=>{let r=n.length>2,s=Wt(t[3]),a=Wt(t[2]),o=ie.size(t)/s/a,l=[n[0].dims[0],n[0].dims[1],n[0].dims[2],n[0].dims[3]/s],u=[n[1].dims[0],n[1].dims[1],n[1].dims[2],n[1].dims[3]/s],c=[t[0],t[1],t[2],t[3]/s],h=[{type:12,data:o},{type:6,data:[e.strides[0],e.strides[1]]},{type:6,data:[e.pads[0],e.pads[1]]}];Bd(e,h),h.push(...Re(l,u,c));let f=(a-1)*e.strides[1]+u[1],m=y=>{let _=Te("output",n[0].dataType,c.length,s),x=$n(_.type.tensor),v=jd(e,_.type.value,x),w=le("x",n[0].dataType,l.length,s),E=le("w",n[1].dataType,u.length,s),C=[w,E];r&&C.push(le("b",n[2].dataType,n[2].dims,s));let D=r?"value += b[output_channel];":"",V=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return Ud(e,V),`
  ${y.registerUniforms(V).declareVariables(...C,_)}
  ${y.mainStart()}
    ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${a}u;
    let col = (index1 % width1) * ${a}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${w.type.value}, ${f}>;
    var values: array<${_.type.value}, ${a}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${u[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${f}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${w.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${w.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${u[1]}; w_width++) {
          let w_val = ${E.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${a}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${a}u; i++) {
      var value = values[i];
      ${D}
      ${v}
      ${_.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${e.cacheKey};${s};${a};${f};${u[0]};${u[1]}`,inputDependencies:r?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:i?i(t):t,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:h}),getShaderSource:m}}}),QN,Cw,JN,kw,qT,ME,ZN,eD,GT,ZJ=fe(()=>{je(),XJ(),QJ(),AC(),JJ(),rh(),EC(),Mu(),QN=(n,e,t,i,r,s)=>{let a=n[0],o=n.slice(s?1:2,s?3:4),l=o.length,u=e[0],c=e.slice(2).map((f,m)=>f+(f-1)*(t[m]-1)),h=o.map((f,m)=>f+i[m]+i[m+l]).map((f,m)=>Math.floor((f-c[m]+r[m])/r[m]));return h.splice(0,0,a),h.splice(s?3:1,0,u),h},Cw=[2,3,1,0],JN=(n,e)=>{if(!n||n.length!==2&&n.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(n[0].dims.length>5)throw new Error("greater than 5D is not supported");if(n[0].dims.length!==n[1].dims.length)throw new Error("filter does not have same dimension as input");let t=n[0].dims[e.format==="NHWC"?n[0].dims.length-1:1],i=n[1].dims[1]*e.group;if(t!==i)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(n.length===3&&(n[2].dims.length!==1||n[1].dims[0]!==n[2].dims[0]))throw new Error("invalid bias");let r=n[0].dims.length-2;if(e.dilations.length!==r)throw new Error(`dilations should be ${r}D`);if(e.strides.length!==r)throw new Error(`strides should be ${r}D`);if(e.pads.length!==r*2)throw new Error(`pads should be ${r*2}D`);if(e.kernelShape.length!==0&&e.kernelShape.length!==n[1].dims.length-2)throw new Error("invalid kernel shape")},kw=(n,e)=>{let t=n.kernelShape.slice();t.length<e[1].dims.length-2&&t.push(...Array(e[1].dims.length-2-t.length).fill(0));for(let s=2;s<e[1].dims.length;++s)t[s-2]===0&&(t[s-2]=e[1].dims[s]);let i=n.pads.slice();Nb.adjustPadsBasedOnAutoPad(e[0].dims,n.strides,n.dilations,t,i,n.format==="NHWC",n.autoPad);let r=Object.assign({},n);return Object.assign(r,{kernelShape:t,pads:i}),r},qT=n=>{let e=wC(n),t=n.format,i=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][n.auto_pad],r=n.dilations,s=n.group,a=n.kernel_shape,o=n.pads,l=n.strides,u=n.w_is_const();return{autoPad:i,format:t,dilations:r,group:s,kernelShape:a,pads:o,strides:l,wIsConst:u,...e,cacheKey:`${n.format};${e.activation};`}},ME=(n,e,t,i)=>{let r=t.format==="NHWC",s=QN(e[0].dims,e[1].dims,t.dilations,t.pads,t.strides,r);if(t.group!==1){let V=[e[0]];if(r){let I=n.kernelCustomData.wT??n.compute(kr(e[1],Cw),{inputs:[1],outputs:[t.wIsConst?-2:-1]})[0];t.wIsConst&&!n.kernelCustomData.wT&&(n.kernelCustomData.wT=I),V.push(I)}else V.push(e[1]);e.length===3&&V.push(e[2]),!n.adapterInfo.isArchitecture("ampere")&&r&&e[1].dims[0]===t.group&&e[1].dims[1]===1&&t.dilations[0]===1&&t.dilations[1]===1?n.compute(zj(V,t,s,i),{inputs:V}):n.compute(Fj(V,t,s,i),{inputs:V});return}let a=e.length===3,o=e[0].dims[r?1:2],l=e[0].dims[r?2:3],u=e[0].dims[r?3:1],c=e[1].dims[2],h=e[1].dims[3],f=s[r?1:2],m=s[r?2:3],y=s[r?3:1],_=r&&c===o&&h===l&&t.pads[0]===0&&t.pads[1]===0;if(_||c===1&&h===1&&t.dilations[0]===1&&t.dilations[1]===1&&t.strides[0]===1&&t.strides[1]===1&&t.pads[0]===0&&t.pads[1]===0){let V=s[0],I,k,N,L=[];if(r){let M=n.kernelCustomData.wT??n.compute(kr(e[1],Cw),{inputs:[1],outputs:[t.wIsConst?-2:-1]})[0];if(t.wIsConst&&!n.kernelCustomData.wT&&(n.kernelCustomData.wT=M),_){let se=o*l*u;I=e[0].reshape([1,V,se]),k=M.reshape([1,se,y]),N=[1,V,y]}else I=e[0].reshape([V,o*l,u]),k=M.reshape([1,u,y]),N=[V,f*m,y];L.push(I),L.push(k)}else I=e[0].reshape([V,u,o*l]),k=e[1].reshape([1,y,u]),N=[V,y,f*m],L.push(k),L.push(I);a&&L.push(e[2]);let j=N[2],H=L[0].dims[L[0].dims.length-1];j<8&&H<8?n.compute(xC(L,t,s,N,r,i),{inputs:L}):n.compute(Mb(L,t,s,N,r,i),{inputs:L});return}let x=!0,v=n.kernelCustomData.wT??n.compute(kr(e[1],Cw),{inputs:[1],outputs:[t.wIsConst?-2:-1]})[0];t.wIsConst&&!n.kernelCustomData.wT&&(n.kernelCustomData.wT=v);let w=[e[0],v];a&&w.push(e[2]);let E=r?f*m:y,C=r?y:f*m,D=c*h*u;n.compute(Mj(w,t,s,E,C,D,a,x,i),{inputs:w})},ZN=(n,e)=>{let t=e.format==="NHWC",i=[n.inputs[0].reshape(t?[n.inputs[0].dims[0],1,n.inputs[0].dims[1],n.inputs[0].dims[2]]:[n.inputs[0].dims[0],n.inputs[0].dims[1],1,n.inputs[0].dims[2]]),n.inputs[1].reshape([n.inputs[1].dims[0],n.inputs[1].dims[1],1,n.inputs[1].dims[2]])];n.inputs.length===3&&i.push(n.inputs[2]);let r=[0,e.pads[0],0,e.pads[1]],s=[1].concat(e.strides),a=[1].concat(e.dilations),o=[1].concat(e.kernelShape),l=kw({...e,pads:r,strides:s,dilations:a,kernelShape:o},i);ME(n,i,l,u=>t?[u[0],u[2],u[3]]:[u[0],u[1],u[3]])},eD=(n,e,t)=>{let i=t.format==="NHWC"?"channelsLast":"channelsFirst",r=kw(t,e),s=t.autoPad==="NOTSET"?t.pads:t.autoPad,a=Oj(e[0].dims,e[1].dims,t.strides,t.dilations,s,!1,i);n.compute(Lj(e,r,a.outShape,[a.filterDepth,a.filterHeight,a.filterWidth],[a.padInfo.front,a.padInfo.top,a.padInfo.left],i))},GT=(n,e)=>{if(JN(n.inputs,e),n.inputs[0].dims.length===3)ZN(n,e);else if(n.inputs[0].dims.length===5)eD(n,n.inputs,e);else{let t=kw(e,n.inputs);ME(n,n.inputs,t)}}}),Vj,eZ=fe(()=>{Oe(),el(),je(),Be(),Vj=(n,e,t)=>{let i=n.length>2,r=e.outputShape,s=e.format==="NHWC",a=e.group,o=n[1].dims,l=o[2]/a,u=o[3],c=s?Wt(l):1,h=s&&u===1&&l>=4,f=h?Math.floor(l/4)*4:Math.floor(l/c)*c,m=l-f,y=s?Wt(u):1,_=s?u===1?c:y:1,x=ie.size(r)/y,v=[Math.ceil(x/64),1,1];et("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${v}`);let w=["rank","rank"],E=[e.strides[0],e.strides[1]],C=[e.kernelShape[s?1:2],e.kernelShape[s?2:3]],D=[e.dilations[0],e.dilations[1]],V=[C[0]+(e.dilations[0]<=1?0:(e.kernelShape[s?1:2]-1)*(e.dilations[0]-1)),C[1]+(e.dilations[1]<=1?0:(e.kernelShape[s?2:3]-1)*(e.dilations[1]-1))],I=[V[0]-1-Math.floor((e.pads[0]+e.pads[2])/2),V[1]-1-Math.floor((e.pads[1]+e.pads[3])/2)],k=[{type:12,data:x},{type:12,data:E},{type:12,data:C},{type:12,data:D},{type:12,data:V},{type:6,data:I},{type:12,data:f},{type:12,data:l},{type:12,data:u},...Re(n[0].dims,n[1].dims)];i&&(k.push(...Re(n[2].dims)),w.push("rank")),k.push(...Re(r));let N=L=>{let j=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:E.length},{name:"filter_dims",type:"u32",length:C.length},{name:"dilations",type:"u32",length:C.length},{name:"effective_filter_dims",type:"u32",length:V.length},{name:"pads",type:"i32",length:I.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],H=$n(n[0].dataType),M=s?1:2,se=s?2:3,ue=s?3:1,ee=le("W",n[1].dataType,n[1].dims.length,_),ae=le("Dy",n[0].dataType,n[0].dims.length,c),J=[ae,ee];i&&J.push(le("bias",n[2].dataType,[r[ue]].length,y));let q=Te("result",n[0].dataType,r.length,y),G=()=>{let K="";if(h)c===4?K+=`
        let xValue = ${ae.getByOffset("x_offset")};
        let wValue = ${ee.getByOffset("w_offset")};
        dotProd = dotProd + dot(xValue, wValue);
        x_offset += 1u;
        w_offset += 1u;`:c===2?K+=`
          dotProd = dotProd + dot(vec4<${H}>(${ae.getByOffset("x_offset")}, ${ae.getByOffset("x_offset + 1u")}), vec4<${H}>(${ee.getByOffset("w_offset")}, ${ee.getByOffset("w_offset + 1u")}));
          x_offset += 2u;
          w_offset += 2u;`:c===1&&(K+=`
          dotProd = dotProd + dot(vec4<${H}>(${ae.getByOffset("x_offset")}, ${ae.getByOffset("x_offset + 1u")}, ${ae.getByOffset("x_offset + 2u")}, ${ae.getByOffset("x_offset + 3u")}), vec4<${H}>(${ee.getByOffset("w_offset")}, ${ee.getByOffset("w_offset + 1u")}, ${ee.getByOffset("w_offset + 2u")}, ${ee.getByOffset("w_offset + 3u")}));
          x_offset += 4u;
          w_offset += 4u;`);else if(K+=`
                  let xValue = ${s?ae.getByOffset(`${ae.indicesToOffset(`${ae.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${c}`):ae.get("batch","inputChannel","idyR","idyC")};
        `,c===1)K+=`
          let w_offset = ${ee.indicesToOffset(`${ee.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
          let wValue = ${ee.getByOffset(`w_offset / ${_}`)};
          dotProd = dotProd + xValue * wValue;`;else for(let Z=0;Z<c;Z++)K+=`
            let wValue${Z} = ${ee.getByOffset(`${ee.indicesToOffset(`${ee.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${Z}, wOutChannel)`)} / ${_}`)};
            dotProd = dotProd + xValue[${Z}] * wValue${Z};`;return K},U=()=>{if(m===0)return"";if(!h)throw new Error(`packInputAs4 ${h} is not true.`);let K="";if(c===1){K+="dotProd = dotProd";for(let Z=0;Z<m;Z++)K+=`
            + ${ae.getByOffset(`x_offset + ${Z}`)} * ${ee.getByOffset(`w_offset + ${Z}`)}`;K+=";"}else if(c===2){if(m!==2)throw new Error(`Invalid inputChannelsRemainder ${m}.`);K+=`
          let xValue = ${ae.getByOffset("x_offset")};
          let wValue = ${ee.getByOffset("w_offset")};
          dotProd = dotProd + dot(xValue, wValue);`}return K},Y=`
            let outputIndices = ${q.offsetToIndices(`global_idx * ${y}`)};
            let batch = ${q.indicesGet("outputIndices",0)};
            let d1 = ${q.indicesGet("outputIndices",ue)};
            let r = ${q.indicesGet("outputIndices",M)};
            let c = ${q.indicesGet("outputIndices",se)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${q.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${H}(dyRCorner) + ${H}(wR)) / ${H}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${H}(uniforms.Dy_shape[${M}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }
              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${H}(dyCCorner) + ${H}(wC)) / ${H}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${H}(uniforms.Dy_shape[${se}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                ${h?`
                var x_offset = ${ae.indicesToOffset(`${ae.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${c};
                var w_offset = ${ee.indicesToOffset(`${ee.type.indices}(wRPerm, wCPerm, inputChannel, wOutChannel)`)} / ${_};
                  `:""}
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ${h?4:c}) {
                  ${G()}
                  inputChannel = inputChannel + ${h?4:c};
                }
                ${U()}
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${i?` + bias[d1 / ${y}]`:""};
            ${q.setByOffset("global_idx","value")};
          `;return`
    ${L.registerUniforms(j).declareVariables(...J,q)}
      ${L.mainStart()}
      ${L.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${Y}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${e.cacheKey};${c}${_}${y}${h}${m}`,inputDependencies:w},getRunData:()=>({dispatchGroup:{x:v[0],y:v[1],z:v[2]},outputs:[{dims:t?t(r):r,dataType:n[0].dataType}],programUniforms:k}),getShaderSource:N}}}),tD,nD,iD,OE,jj,rD,LE,sD,Bj,tZ=fe(()=>{eZ(),rh(),Mu(),tD=(n,e,t,i,r,s)=>(n-1)*e+t+(i-1)*r+1-s,nD=(n,e,t,i,r)=>{let s=Math.floor(n/2);e==="SAME_UPPER"?(t[i]=s,t[r]=n-s):e==="SAME_LOWER"&&(t[i]=n-s,t[r]=s)},iD=(n,e,t,i,r,s,a,o,l,u)=>{let c=n.length-2,h=u.length===0;l.length<c&&l.push(...Array(c-l.length).fill(0));let f=n[0],m=e[o?3:1]*r;for(let y=0,_=n.length-c-(o?1:0);y<c;++y,++_){let x=n[_],v=h?x*a[y]:u[y],w=tD(x,a[y],s[y],e[_],t[y],v);nD(w,i,s,y,y+c),h&&u.push(a[y]*(x-1)+l[y]+(e[_]-1)*t[y]+1-s[y]-s[y+c])}u.splice(0,0,f),u.splice(o?3:1,0,m)},OE=(n,e)=>{let t=n.kernelShape.slice();if(n.kernelShape.length===0||n.kernelShape.reduce((h,f)=>h*f,1)===0){t.length=0;for(let h=2;h<e[1].dims.length;++h)t.push(e[1].dims[h])}let i=n.format==="NHWC";t.splice(0,0,e[1].dims[0]),t.splice(i?3:1,0,e[1].dims[1]);let r=n.pads.slice(),s=n.outputShape.slice(),a=n.outputPadding.slice(),o=e[0].dims,l=n.dilations.slice();if(l.reduce((h,f)=>h+f,0)===0){let h=e[0].dims.length-2;l=new Array(h).fill(1)}let u=n.strides.slice();if(u.reduce((h,f)=>h+f,0)===0){let h=e[0].dims.length-2;u=new Array(h).fill(1)}iD(o,t,l,n.autoPad,n.group,r,u,i,a,s);let c=Object.assign({},n);return Object.assign(c,{kernelShape:t,pads:r,outputPadding:a,outputShape:s,dilations:l,strides:u}),c},jj=n=>{let e=wC(n),t=n.format,i=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof n.autoPad>"u"?0:n.autoPad],r=n.dilations,s=n.group,a=n.kernelShape,o=n.pads,l=n.strides,u=n.wIsConst(),c=n.outputPadding,h=n.outputShape;return{autoPad:i,format:t,dilations:r,group:s,kernelShape:a,outputPadding:c,outputShape:h,pads:o,strides:l,wIsConst:u,...e,cacheKey:`${n.format};${e.activation};`}},rD=(n,e)=>{if(!n||n.length!==2&&n.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(n[0].dims.length!==4&&n[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(n[0].dims.length!==n[1].dims.length)throw new Error("filter does not have same dimension as input");let t=n[0].dims[e.format==="NHWC"?n[0].dims.length-1:1],i=n[1].dims[0];if(t!==i)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let r=n[1].dims[1]*e.group;if(n.length===3&&(n[2].dims.length!==1||n[2].dims[0]!==r))throw new Error("invalid bias");let s=n[0].dims.length-2;if(e.dilations.reduce((a,o)=>a+o,0)>0&&e.dilations.length!==s)throw new Error(`dilations should be ${s}D`);if(e.strides.reduce((a,o)=>a+o,0)>0&&e.strides.length!==s)throw new Error(`strides should be ${s}D`);if(e.pads.reduce((a,o)=>a+o,0)>0&&e.pads.length!==s*2)throw new Error(`pads should be ${s*2}D`);if(e.outputPadding.length!==s&&e.outputPadding.length!==0)throw new Error(`output_padding should be ${s}D`);if(e.kernelShape.reduce((a,o)=>a+o,0)>0&&e.kernelShape.length!==0&&e.kernelShape.length!==n[1].dims.length-2)throw new Error("invalid kernel shape");if(e.outputShape.length!==0&&e.outputShape.length!==n[0].dims.length-2)throw new Error("invalid output shape")},LE=(n,e,t,i)=>{let r=n.kernelCustomData.wT??n.compute(kr(e[1],[2,3,0,1]),{inputs:[1],outputs:[t.wIsConst?-2:-1]})[0];t.wIsConst&&!n.kernelCustomData.wT&&(n.kernelCustomData.wT=r);let s=[e[0],r];e.length===3&&s.push(e[2]),n.compute(Vj(s,t,i),{inputs:s})},sD=(n,e)=>{let t=e.format==="NHWC",i=[n.inputs[0].reshape(t?[n.inputs[0].dims[0],1,n.inputs[0].dims[1],n.inputs[0].dims[2]]:[n.inputs[0].dims[0],n.inputs[0].dims[1],1,n.inputs[0].dims[2]]),n.inputs[1].reshape([n.inputs[1].dims[0],n.inputs[1].dims[1],1,n.inputs[1].dims[2]])];n.inputs.length===3&&i.push(n.inputs[2]);let r=e.kernelShape;(r.length===0||r[0]===0)&&(r=[n.inputs[1].dims[2]]);let s=e.dilations;(s.length===0||s[0]===0)&&(s=[1]);let a=e.strides;(a.length===0||a[0]===0)&&(a=[1]);let o=e.pads;o.length===0&&(o=[0,0]),o=[0,o[0],0,o[1]],a=[1].concat(a),s=[1].concat(s),r=[1].concat(r);let l=e.outputPadding;l=[0].concat(l);let u=OE({...e,pads:o,strides:a,dilations:s,kernelShape:r,outputPadding:l},i);LE(n,i,u,c=>t?[c[0],c[2],c[3]]:[c[0],c[1],c[3]])},Bj=(n,e)=>{if(rD(n.inputs,e),n.inputs[0].dims.length===3)sD(n,e);else{let t=OE(e,n.inputs);LE(n,n.inputs,t)}}}),aD,Uj,Hj,nZ=fe(()=>{Oe(),je(),Zt(),Be(),aD=(n,e,t,i)=>{let r=ie.size(e),s=e.length,a=le("input",n,s),o=Te("output",n,s),l=t.dataType===6?t.getInt32Array()[0]:Number(t.getBigInt64Array()[0]),u=ie.normalizeAxis(l,s),c=h=>{let f=` i32(${a.indicesGet("inputIndices","uniforms.axis")}) `,m=$e("uniforms.input_shape","uniforms.axis",s),y=i.reverse?f+(i.exclusive?" + 1":""):"0",_=i.reverse?m:f+(i.exclusive?"":" + 1");return`
                ${h.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(a,o)}
                ${h.mainStart()}
                  ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${o.offsetToIndices("global_idx")};
                  var sum = ${o.type.value}(0);
                  let first : i32 = ${y};
                  let last : i32 = ${_};
                  for (var i : i32 = first; i < last; i++) {
                    ${a.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${a.getByIndices("inputIndices")};
                  }
                  ${o.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:i.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:e,dataType:n}],dispatchGroup:{x:Math.ceil(r/64)},programUniforms:[{type:12,data:r},{type:12,data:u},...Re(e,e)]}),getShaderSource:c}},Uj=(n,e)=>{let t=n.inputs[0].dims,i=n.inputs[0].dataType,r=n.inputs[1];n.compute(aD(i,t,r,e),{inputs:[0]})},Hj=n=>{let e=n.exclusive===1,t=n.reverse===1;return ht({exclusive:e,reverse:t})}}),oD,lD,uD,Wj,qj,iZ=fe(()=>{Oe(),je(),Zt(),Be(),oD=n=>{if(!n||n.length!==1)throw new Error("DepthToSpace requires 1 input.");if(n[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},lD=(n,e,t,i)=>{let r=[];r.push(`fn perm(i: ${i.type.indices}) -> ${t.type.indices} {
    var a: ${t.type.indices};`);for(let s=0;s<e;++s)r.push(t.indicesSet("a",n[s],`i[${s}]`));return r.push("return a;}"),r.join(`
`)},uD=(n,e)=>{let t,i,r,s,a,o,l=e.format==="NHWC",u=e.blocksize,c=e.mode==="DCR";l?([t,i,r,s]=n.dims,a=c?[t,i,r,u,u,s/u**2]:[t,i,r,s/u**2,u,u],o=c?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([t,i,r,s]=[n.dims[0],n.dims[2],n.dims[3],n.dims[1]],a=c?[t,u,u,s/u**2,i,r]:[t,s/u**2,u,u,i,r],o=c?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let h=n.reshape(a),f=h.dims.length,m=n.dataType,y=le("a",m,f),_=Te("output",m,f),x=v=>`
  ${v.registerUniform("output_size","u32").declareVariables(y,_)}

  ${lD(o,f,y,_)}

  ${v.mainStart()}
    ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${_.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${_.setByOffset("global_idx",y.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${n.dims};${e.blocksize};${e.mode}`,inputDependencies:["rank"]},getRunData:v=>{let w=l?[t,i*u,r*u,s/u**2]:[t,s/u**2,i*u,r*u],E=ie.size(w),C=h.dims,D=ie.sortBasedOnPerm(C,o);return{outputs:[{dims:w,dataType:v[0].dataType}],dispatchGroup:{x:Math.ceil(E/64)},programUniforms:[{type:12,data:E},...Re(C,D)]}},getShaderSource:x}},Wj=(n,e)=>{oD(n.inputs),n.compute(uD(n.inputs[0],e))},qj=n=>ht({blocksize:n.blocksize,mode:n.mode,format:n.format})}),$w,Om,FE,cD,dD,hD,fD,zE,pD,Gj,Kj,rZ=fe(()=>{Oe(),je(),Zt(),Be(),$w="[a-zA-Z]|\\.\\.\\.",Om="("+$w+")+",FE="^"+Om+"$",cD="("+Om+",)*"+Om,dD="^"+cD+"$",hD=class{constructor(n=-1){this.symbolToIndices=new Map,this.inputIndex=n}addSymbol(n,e){let t=this.symbolToIndices.get(n);t===void 0?t=[e]:t.push(e),this.symbolToIndices.set(n,t)}},fD=class{constructor(n,e){var r;this.equation=e,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[t,i]=e.includes("->")?e.split("->",2):[e,""];if(!t.match(RegExp(dD)))throw new Error("Invalid LHS term");if(t.split(",").forEach((s,a)=>{let o=n[a].dims.slice();if(!s.match(RegExp(FE)))throw new Error("Invalid LHS term");let l=this.processTerm(s,!0,o,a);this.lhs.push(l)}),i==="")i+=[...this.symbolToInfo.entries()].filter(([s,a])=>a.count===1||s==="...").map(([s])=>s).join("");else if(!i.match(RegExp(Om)))throw new Error("Invalid RHS");(r=i.match(RegExp($w,"g")))==null||r.forEach(s=>{if(s==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let a=this.symbolToInfo.get(s);if(a===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(a.dimValue)}}),this.rhs=this.processTerm(i,!1,this.outputDims)}addSymbol(n,e,t){let i=this.symbolToInfo.get(n);if(i!==void 0){if(i.dimValue!==e&&i.count!==1)throw new Error("Dimension mismatch");i.count++,i.inputIndices.push(t)}else i={count:1,dimValue:e,inputIndices:[t]};this.symbolToInfo.set(n,i)}processTerm(n,e,t,i=-1){let r=t.length,s=!1,a=[],o=0;if(!n.match(RegExp(FE))&&!e&&n!=="")throw new Error("Invalid LHS term");let l=n.match(RegExp($w,"g")),u=new hD(i);return l==null||l.forEach((c,h)=>{if(c==="..."){if(s)throw new Error("Only one ellipsis is allowed per input term");s=!0;let f=r-l.length+1;if(f<0)throw new Error("Ellipsis out of bounds");if(a=t.slice(o,o+f),this.hasEllipsis){if(this.ellipsisDims.length!==a.length||this.ellipsisDims.toString()!==a.toString())throw new Error("Ellipsis dimensions mismatch")}else if(e)this.hasEllipsis=!0,this.ellipsisDims=a;else throw new Error("Ellipsis must be specified in the LHS");for(let m=0;m<a.length;m++){let y=String.fromCharCode(48+m);u.addSymbol(y,h+m),this.addSymbol(y,t[o++],i)}}else u.addSymbol(c,h+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(c,t[o++],i)}),u}},zE=n=>n+"_max",pD=(n,e,t,i)=>{let r=n.map(u=>u.length).map((u,c)=>le(`input${c}`,e,u)),s=ie.size(i),a=Te("output",e,i.length),o=[...t.symbolToInfo.keys()].filter(u=>!t.rhs.symbolToIndices.has(u)),l=u=>{let c=[],h="var prod = 1.0;",f="var sum = 0.0;",m="sum += prod;",y=[],_=[],x=[],v=[],w=t.symbolToInfo.size===t.rhs.symbolToIndices.size;t.symbolToInfo.forEach((C,D)=>{var V;if(t.rhs.symbolToIndices.has(D)){let I=(V=t.rhs.symbolToIndices.get(D))==null?void 0:V[0];I!==void 0&&t.lhs.forEach((k,N)=>{if(C.inputIndices.includes(N)){let L=k.symbolToIndices.get(D);if(L===void 0)throw new Error("Invalid symbol error");L.forEach(j=>{c.push(`${r[N].indicesSet(`input${N}Indices`,j,a.indicesGet("outputIndices",I))}`)})}})}else t.lhs.forEach((I,k)=>{if(C.inputIndices.includes(k)){let N=I.symbolToIndices.get(D);if(N===void 0)throw new Error("Invalid symbol error");N.forEach(L=>{y.push(`${r[k].indicesSet(`input${k}Indices`,L,`${D}`)}`)}),v.push(`prod *= ${r[k].getByIndices(`input${k}Indices`)};`)}}),_.push(`for(var ${D}: u32 = 0; ${D} < uniforms.${zE(D)}; ${D}++) {`),x.push("}")});let E=w?[...c,`let sum = ${r.map((C,D)=>C.getByIndices(`input${D}Indices`)).join(" * ")};`]:[...c,f,..._,...y,h,...v,m,...x];return`
            ${u.registerUniforms(o.map(C=>({name:`${zE(C)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...r,a)}

            ${u.mainStart()}
            ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${a.offsetToIndices("global_idx")};
            ${r.map((C,D)=>`var input${D}Indices: ${r[D].type.indices};`).join(`
`)}
            ${E.join(`
`)};
            ${a.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:t.equation,inputDependencies:n.map(()=>"rank")},getRunData:()=>{let u=o.filter(h=>t.symbolToInfo.has(h)).map(h=>{var f;return{type:12,data:((f=t.symbolToInfo.get(h))==null?void 0:f.dimValue)||0}});u.push({type:12,data:s});let c=n.map((h,f)=>[...Re(h)]).reduce((h,f)=>h.concat(f),u);return c.push(...Re(i)),{outputs:[{dims:i,dataType:e}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:c}},getShaderSource:l}},Gj=(n,e)=>{let t=new fD(n.inputs,e.equation),i=t.outputDims,r=n.inputs.map((s,a)=>s.dims);n.compute(pD(r,n.inputs[0].dataType,t,i))},Kj=n=>{let e=n.equation.replace(/\s+/g,"");return ht({equation:e})}}),mD,VE,gD,yD,Yj,sZ=fe(()=>{Oe(),je(),Be(),mD=n=>{if(!n||n.length!==2)throw new Error("Expand requires 2 input.");let e=n[0].dims,t=Array.from(n[1].getBigInt64Array(),Number),i=t.length<e.length?0:t.length-e.length,r=e.length<t.length?0:e.length-t.length;for(;i<t.length&&r<e.length;++i,++r)if(t[i]!==e[r]&&t[i]!==1&&e[r]!==1)throw new Error("Expand requires shape to be broadcastable to input")},VE=(n,e)=>{let t=n.length-e.length,i=[];for(let r=0;r<t;++r)i.push(n[r]);for(let r=0;r<e.length;++r)i.push(e[r]===1?n[r+t]:e[r]);return i},gD=(n,e)=>n.length>e.length?VE(n,e):VE(e,n),yD=n=>{let e=n[0].dims,t=Array.from(n[1].getBigInt64Array(),Number),i=gD(e,t),r=n[0].dataType,s=r===9||ie.size(e)===1,a=r===9||e.length>0&&e[e.length-1]%4===0?4:1,o=s||i.length>0&&i[i.length-1]%4===0?4:1,l=Math.ceil(ie.size(i)/o),u=h=>{let f=le("input",r,e.length,a),m=Te("output",r,i.length,o),y;if(r===9){let _=(x,v,w="")=>`
          let outputIndices${v} = ${m.offsetToIndices(`outputOffset + ${v}u`)};
          let offset${v} = ${f.broadcastedIndicesToOffset(`outputIndices${v}`,m)};
          let index${v} = offset${v} / 4u;
          let component${v} = offset${v} % 4u;
          ${x}[${v}] = ${w}(${f.getByOffset(`index${v}`)}[component${v}]);
        `;y=`
        let outputOffset = global_idx * ${o};
        var data = vec4<u32>(0);
        ${_("data",0,"u32")}
        ${_("data",1,"u32")}
        ${_("data",2,"u32")}
        ${_("data",3,"u32")}
        ${m.setByOffset("global_idx","data")}
      }`}else y=`
        let outputIndices = ${m.offsetToIndices(`global_idx * ${o}`)};
        let inputOffset = ${f.broadcastedIndicesToOffset("outputIndices",m)};
        let data = ${m.type.value}(${f.getByOffset(`inputOffset / ${a}`)});
        ${m.setByOffset("global_idx","data")}
      }`;return`
    ${h.registerUniform("vec_size","u32").declareVariables(f,m)}
    ${h.mainStart()}
    ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${y}`},c=[{type:12,data:l},...Re(e,i)];return{name:"Expand",shaderCache:{hint:`${i.length};${a}${o}`,inputDependencies:["rank"]},getShaderSource:u,getRunData:()=>({outputs:[{dims:i,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:c})}},Yj=n=>{mD(n.inputs),n.compute(yD(n.inputs),{inputs:[0]})}}),_D,Xj,aZ=fe(()=>{Oe(),je(),Be(),vC(),_D=n=>{let e=n[0].dataType,t=ie.size(n[0].dims),i=ie.size(n[1].dims),r=i%4===0,s=a=>{let o=le("x",e,[1],4),l=le("bias",e,[1],4),u=Te("y",e,[1],4),c=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],h=m=>`
      let bias${m}_offset: u32 = (global_idx * 4 + ${m}) % uniforms.bias_size;
      let bias${m} = ${l.getByOffset(`bias${m}_offset / 4`)}[bias${m}_offset % 4];`,f=r?`
      let bias = ${l.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${h(0)}${h(1)}${h(2)}${h(3)}
      let bias = ${o.type.value}(bias0, bias1, bias2, bias3);`;return`${a.registerUniforms(c).declareVariables(o,l,u)}

    ${BT(mi(e))}

    ${a.mainStart(Pp)}
      ${a.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${o.getByOffset("global_idx")};
      ${f}
      let x_in = x + bias;
      ${u.setByOffset("global_idx",UT("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${r}`,inputDependencies:["type","type"]},getShaderSource:s,getRunData:a=>({outputs:[{dims:a[0].dims,dataType:a[0].dataType}],programUniforms:[{type:12,data:Math.ceil(t/4)},{type:12,data:i}],dispatchGroup:{x:Math.ceil(t/Pp/4)}})}},Xj=n=>{n.inputs.length<2||ie.size(n.inputs[1].dims)===0?gj(n):n.compute(_D(n.inputs))}}),vD,wD,Qj,Jj,oZ=fe(()=>{Oe(),je(),Zt(),Be(),vD=n=>{if(!n||n.length!==2)throw new Error("Gather requires 2 inputs.")},wD=(n,e)=>{let t=n[0].dims,i=n[1].dims,r=t.length,s=ie.normalizeAxis(e.axis,r),a=t.slice(0);a.splice(s,1,...i);let o=t[s],l=n[0].dataType===9?4:1,u=Math.ceil(ie.size(a)/l),c=[{type:12,data:u},{type:6,data:o},{type:12,data:s},...Re(n[0].dims,n[1].dims,a)],h=f=>{let m=le("data",n[0].dataType,n[0].dims.length,l),y=le("inputIndices",n[1].dataType,n[1].dims.length),_=Te("output",n[0].dataType,a.length,l),x=w=>{let E=i.length,C=`var indicesIndices${w}  = ${y.type.indices}(0);`;for(let D=0;D<E;D++)C+=`${E>1?`indicesIndices${w}[${D}]`:`indicesIndices${w}`} = ${a.length>1?`outputIndices${w}[uniforms.axis + ${D}]`:`outputIndices${w}`};`;C+=`
          var idx${w} = ${y.getByIndices(`indicesIndices${w}`)};
          if (idx${w} < 0) {
            idx${w} = idx${w} + uniforms.axisDimLimit;
          }
          var dataIndices${w} : ${m.type.indices};
        `;for(let D=0,V=0;D<r;D++)D===s?(C+=`${r>1?`dataIndices${w}[${D}]`:`dataIndices${w}`} = u32(idx${w});`,V+=E):(C+=`${r>1?`dataIndices${w}[${D}]`:`dataIndices${w}`} = ${a.length>1?`outputIndices${w}[${V}]`:`outputIndices${w}`};`,V++);return C},v;if(n[0].dataType===9){let w=(E,C,D="")=>`
          let outputIndices${C} = ${_.offsetToIndices(`outputOffset + ${C}u`)};
          ${x(C)};
          let offset${C} = ${m.indicesToOffset(`dataIndices${C}`)};
          let index${C} = offset${C} / 4u;
          let component${C} = offset${C} % 4u;
          ${E}[${C}] = ${D}(${m.getByOffset(`index${C}`)}[component${C}]);
        `;v=`
        let outputOffset = global_idx * ${l};
        var value = vec4<u32>(0);
        ${w("value",0,"u32")}
        ${w("value",1,"u32")}
        ${w("value",2,"u32")}
        ${w("value",3,"u32")}
        ${_.setByOffset("global_idx","value")}
      `}else v=`
      let outputIndices = ${_.offsetToIndices("global_idx")};
      ${x("")};
      let value = ${m.getByIndices("dataIndices")};
      ${_.setByOffset("global_idx","value")};
      `;return`
      ${f.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(m,y,_)}
      ${f.mainStart()}
        ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${v}
      }`};return{name:"Gather",shaderCache:{hint:e.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:a,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:c}),getShaderSource:h}},Qj=n=>ht({axis:n.axis}),Jj=(n,e)=>{let t=n.inputs;vD(t),n.compute(wD(n.inputs,e))}}),bD,Zj,eB,lZ=fe(()=>{Oe(),je(),Be(),bD=(n,e,t,i,r,s,a,o,l)=>{let u=[{type:12,data:s},{type:12,data:i},{type:12,data:r},{type:12,data:t},{type:12,data:a},{type:12,data:o},{type:12,data:l}],c=[s];u.push(...Re(e.dims,c));let h=f=>{let m=le("indices_data",e.dataType,e.dims.length),y=Te("input_slice_offsets_data",12,1,1),_=[m,y],x=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:r.length},{name:"sizes_from_slice_dims_data",type:"u32",length:t.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${f.registerUniforms(x).declareVariables(..._)}
  ${f.mainStart()}
    ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${r.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${t.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return n.compute({name:"computeSliceOffsets",shaderCache:{hint:`${r.length}_${t.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:c,dataType:n.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:u}),getShaderSource:h},{inputs:[e],outputs:[-1]})[0]},Zj=(n,e)=>{let t=n.inputs,i=t[0].dims,r=t[0].dataType,s=t[1].dims,a=s[s.length-1],o=ie.sizeToDimension(s,s.length-1),l=ie.sizeFromDimension(i,e.batchDims+a),u=ie.sizeToDimension(i,e.batchDims),c=ie.sizeFromDimension(i,e.batchDims),h=o/u,f=new Array(a),m=l;for(let C=0;C<a;++C)f[a-1-C]=m,m*=i[e.batchDims+a-1-C];let y=bD(n,t[1],f,e.batchDims,i,o,h,c,a),_=e.batchDims+a;if(_>i.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let x=s.slice(0,-1).concat(i.slice(_)),v=ie.size(x),w=[{type:12,data:v},{type:12,data:l},...Re(t[0].dims,y.dims,x)],E=C=>{let D=le("data",t[0].dataType,t[0].dims.length),V=le("slice_offsets",12,y.dims.length),I=Te("output",t[0].dataType,x.length);return`
          ${C.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(D,V,I)}
            ${C.mainStart()}
            ${C.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};n.compute({name:"GatherND",shaderCache:{hint:e.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:x,dataType:r}],dispatchGroup:{x:Math.ceil(v/64)},programUniforms:w}),getShaderSource:E},{inputs:[t[0],y]})},eB=n=>({batchDims:n.batch_dims,cacheKey:""})}),xD,ED,tB,nB,uZ=fe(()=>{Oe(),je(),Zt(),Be(),xD=(n,e)=>{if(n.length<3||n.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let t=ie.normalizeAxis(e.quantizeAxis,n[0].dims.length),i=e.blockSize,r=n[0],s=n[2],a=n.length===4?n[3]:void 0;if(s.dims.length!==r.dims.length||!r.dims.map((o,l)=>l===t?Math.ceil(o/i)===s.dims[l]:o===s.dims[l]).reduce((o,l)=>o&&l,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(a){if(a.dataType!==r.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(a.dims.length!==s.dims.length||!a.dims.map((o,l)=>o===s.dims[l]).reduce((o,l)=>o&&l,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},ED=(n,e)=>{let t=n[0].dims,i=n[1].dims,r=t.length,s=ie.normalizeAxis(e.gatherAxis,r),a=ie.normalizeAxis(e.quantizeAxis,r),o=t.slice(0);o.splice(s,1,...i);let l=ie.size(o),u=n[2].dataType,c=n[0].dataType===22,h=[{type:12,data:l},{type:12,data:a},{type:12,data:s},{type:12,data:e.blockSize},...Re(...n.map((m,y)=>m.dims),o)],f=m=>{let y=le("data",n[0].dataType,n[0].dims.length),_=le("inputIndices",n[1].dataType,n[1].dims.length),x=le("scales",n[2].dataType,n[2].dims.length),v=n.length>3?le("zeroPoint",n[3].dataType,n[3].dims.length):void 0,w=Te("output",u,o.length),E=[y,_,x];v&&E.push(v);let C=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${m.registerUniforms(C).declareVariables(...E,w)}
        ${m.mainStart()}
        let output_indices = ${w.offsetToIndices("global_idx")};
        var indices_indices = ${_.type.indices}(0);
        ${i.length>1?`
          for (var i: u32 = 0; i < ${i.length}; i++) {
            let index = ${w.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${_.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${w.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${y.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${w.indicesGet("output_indices","i")};
          ${y.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${_.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${t[s]};
        }
        ${y.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${o.length}; i++) {
          let index = ${w.indicesGet("output_indices",`i + ${i.length} - 1`)};
          ${y.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${y.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${y.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${c?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${x.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${x.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${x.getByIndices("scale_indices")};
        ${v?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${v.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${v.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${c?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${mi(u)}(quantized_data - zero_point) * scale;
        ${w.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${e.cacheKey};${n.filter((m,y)=>y!==1).map(m=>m.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:n.length},(m,y)=>"rank")},getRunData:()=>({outputs:[{dims:o,dataType:u}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:h}),getShaderSource:f}},tB=(n,e)=>{let t=n.inputs;xD(t,e),n.compute(ED(n.inputs,e))},nB=n=>ht({blockSize:n.blockSize,gatherAxis:n.gatherAxis,quantizeAxis:n.quantizeAxis})}),AD,TD,iB,rB,cZ=fe(()=>{Oe(),je(),Zt(),Be(),AD=n=>{if(!n||n.length!==2)throw new Error("GatherElements requires 2 inputs.");if(n[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(n[0].dims.length!==n[1].dims.length)throw new Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},TD=(n,e)=>{let t=n[0].dims,i=n[0].dataType,r=t.length,s=n[1].dims,a=n[1].dataType,o=ie.normalizeAxis(e.axis,r),l=t[o],u=s.slice(0),c=ie.size(u),h=le("input",i,r),f=le("indicesInput",a,s.length),m=Te("output",i,u.length),y=[{type:12,data:c},{type:6,data:l},{type:12,data:o}];return y.push(...Re(t,s,u)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:u,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:y}),getShaderSource:_=>`
      ${_.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(h,f,m)}
      ${_.mainStart()}
      ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${m.offsetToIndices("global_idx")};

      var idx = ${f.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${h.type.indices}(outputIndices);
      ${h.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${h.getByIndices("inputIndices")};

      ${m.setByOffset("global_idx","value")};
  }`}},iB=n=>ht({axis:n.axis}),rB=(n,e)=>{let t=n.inputs;AD(t),n.compute(TD(n.inputs,e))}}),SD,ID,sB,aB,dZ=fe(()=>{Oe(),je(),Be(),SD=n=>{if(!n)throw new Error("Input is missing");if(n.length<2||n.length>3)throw new Error("Invaid input number.");if(n.length===3&&n[2].dims.length>2)throw new Error("Invalid input shape of C");if(n[0].dataType!==n[1].dataType||n.length===3&&n[0].dataType!==n[2].dataType)throw new Error("Input types are mismatched")},ID=(n,e)=>{let t=n[0].dims.slice(),i=n[1].dims.slice(),[r,s,a]=iV.getShapeOfGemmResult(t,e.transA,i,e.transB,n.length===3?n[2].dims:void 0),o=[r,s];if(!o)throw new Error("Can't use gemm on the given tensors");let l=16,u=Math.ceil(s/l),c=Math.ceil(r/l),h=!0,f=ie.size(o),m=[{type:12,data:h?u:f},{type:12,data:r},{type:12,data:s},{type:12,data:a},{type:1,data:e.alpha},{type:1,data:e.beta}],y=["type","type"];n.length===3&&(m.push(...Re(n[2].dims)),y.push("rank")),m.push(...Re(o));let _=v=>{let w="";e.transA&&e.transB?w="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":e.transA&&!e.transB?w="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!e.transA&&e.transB?w="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!e.transA&&!e.transB&&(w="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let E=e.alpha===1?"":"value *= uniforms.alpha;",C=le("a",n[0].dataType,n[0].dims),D=le("b",n[1].dataType,n[1].dims),V=C.type.value,I=null,k=[C,D];n.length===3&&(I=le("c",n[2].dataType,n[2].dims.length),k.push(I));let N=Te("output",n[0].dataType,o.length);k.push(N);let L=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`
  ${v.registerUniforms(L).declareVariables(...k)}

  ${v.mainStart()}
    ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let m = global_idx / uniforms.N;
    let n = global_idx % uniforms.N;

    var value = ${V}(0);
    for (var k: u32 = 0u; k < uniforms.K; k++) {
      ${w}
    }

    ${E}
    ${I!=null?`let cOffset = ${I.broadcastedIndicesToOffset("vec2(m, n)",N)}; value += ${V}(uniforms.beta) * ${I.getByOffset("cOffset")};`:""}
    output[global_idx] = value;
  }`},x=v=>{let w=le("a",n[0].dataType,n[0].dims),E=le("b",n[1].dataType,n[1].dims),C=null,D=[w,E];n.length===3&&(C=le("c",n[2].dataType,n[2].dims.length),D.push(C));let V=Te("output",n[0].dataType,o.length);D.push(V);let I=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],k="",N="";e.transA&&e.transB?(N=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${w.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${E.type.value}(0);
      }
      `,k="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):e.transA&&!e.transB?(N=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${w.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${E.type.value}(0);
      }
      `,k="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!e.transA&&e.transB?(N=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${w.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${E.type.value}(0);
      }
      `,k="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!e.transA&&!e.transB&&(N=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${w.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${E.type.value}(0);
      }
      `,k="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let L=e.alpha===1?"":"value *= uniforms.alpha;";return`
  ${v.registerUniforms(I).declareVariables(...D)}
  var<workgroup> tile_a: array<array<${w.type.storage}, ${l}>, ${l}>;
  var<workgroup> tile_b: array<array<${E.type.storage}, ${l}>, ${l}>;
  ${v.mainStart([l,l,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${l};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${l};
    let num_tiles = (uniforms.K - 1) / ${l} + 1;
    var k_start = 0u;
    var value = ${V.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${N}
      k_start = k_start + ${l};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${l}; k++) {
        ${k}
      }
      workgroupBarrier();
    }

    ${L}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${C!=null?`let cOffset = ${C.broadcastedIndicesToOffset("vec2(m, n)",V)}; value += ${V.type.value}(uniforms.beta) * ${C.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return h?{name:"GemmShared",shaderCache:{hint:`${e.cacheKey}`,inputDependencies:y},getRunData:()=>({outputs:[{dims:o,dataType:n[0].dataType}],dispatchGroup:{x:u*c},programUniforms:m}),getShaderSource:x}:{name:"Gemm",shaderCache:{hint:`${e.cacheKey}`,inputDependencies:y},getRunData:()=>({outputs:[{dims:o,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:m}),getShaderSource:_}},sB=n=>{let e=n.transA,t=n.transB,i=n.alpha,r=n.beta;return{transA:e,transB:t,alpha:i,beta:r,cacheKey:`${n.transA};${n.transB};${n.alpha===1}`}},aB=(n,e)=>{SD(n.inputs),n.compute(ID(n.inputs,e))}}),sa,Qa,nc,ic,CD,kD,$D,RD,PD,ND,DD,MD,oB,lB,hZ=fe(()=>{Oe(),je(),Zt(),Be(),[sa,Qa,nc,ic]=[0,1,2,3],CD=n=>{if(n[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(n[0].dims.length!==n[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(n[0].dims.length-2!==n[1].dims[n[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${n[0].dims.length-2}`);if(n[0].dims[0]!==n[1].dims[0])throw new Error("grid batch size must match input batch size")},kD=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,$D=n=>`
  fn gs_bicubic_interpolate(p: mat4x4<${n}>, x: f32, y: f32) -> ${n} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${n}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,RD=n=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${n.alignCorners===0?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,PD=n=>`
  ${n.paddingMode==="reflection"?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,ND=(n,e,t)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${e} {
     var pixel = ${e}(0);
     var indices = vec4<u32>(0);
     indices[${sa}] = batch;
     indices[${Qa}] = channel;`+(()=>{switch(t.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${nc}] = u32(r);
            indices[${ic}] = u32(c);
          } else {
            return ${e}(0);
          }
        `;case"border":return`
          indices[${nc}] = u32(clamp(r, 0, H - 1));
          indices[${ic}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${nc}] = gs_reflect(r, border[1], border[3]);
          indices[${ic}] = gs_reflect(c, border[0], border[2]);
        `;default:throw new Error(`padding mode ${t.paddingMode} is not supported`)}})()+`
    return ${n.getByIndices("indices")};
  }
`,DD=(n,e,t)=>(()=>{switch(t.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${sa}], indices[${Qa}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${sa}], indices[${Qa}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${sa}], indices[${Qa}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${sa}], indices[${Qa}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${sa}], indices[${Qa}], border);

          let dx2 = ${e}(f32(x2) - x);
          let dx1 = ${e}(x - f32(x1));
          let dy2 = ${e}(f32(y2) - y);
          let dy1 = ${e}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${e}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${sa}], indices[${Qa}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw new Error(`mode ${t.mode} is not supported`)}})()+`${n.setByOffset("global_idx","result")}`,MD=(n,e)=>{let t=le("x",n[0].dataType,n[0].dims.length),i=[n[1].dims[0],n[1].dims[1],n[1].dims[2]],r=le("grid",n[1].dataType,i.length,2),s=[n[0].dims[0],n[0].dims[1],n[1].dims[1],n[1].dims[2]];e.format==="NHWC"&&(s=[n[0].dims[0],n[1].dims[1],n[1].dims[2],n[0].dims[3]],[sa,Qa,nc,ic]=[0,3,1,2]);let a=Te("output",n[0].dataType,s.length),o=t.type.value,l=ie.size(s),u=[{type:12,data:l},...Re(n[0].dims,i,s)],c=h=>`
  ${h.registerUniform("output_size","u32").declareVariables(t,r,a)}
  ${kD}
  ${$D(o)}
  ${RD(e)}
  ${PD(e)}
  ${ND(t,o,e)}

  ${h.mainStart()}
    ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${nc}]);
      let W_in = i32(uniforms.x_shape[${ic}]);

      ${e.alignCorners===0?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${a.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${sa}], indices[${nc}], indices[${ic}]);
      let nxy = ${r.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${DD(a,o,e)}
  }`;return{name:"GridSample",shaderCache:{hint:`${e.cacheKey}`,inputDependencies:["type","type"]},getRunData:h=>{let f=ie.size(s);return{outputs:[{dims:s,dataType:h[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:u}},getShaderSource:c}},oB=(n,e)=>{CD(n.inputs),n.compute(MD(n.inputs,e))},lB=n=>ht({alignCorners:n.align_corners,mode:n.mode,paddingMode:n.padding_mode,format:n.format})}),Si,OD,uB,jE,LD,ag,cB,dB=fe(()=>{Oe(),je(),Zt(),mC(),_C(),Be(),Mu(),Si=(n,e)=>n.length>e&&n[e].dims.length>0?n[e]:void 0,OD=(n,e)=>{let t=n[0],i=Si(n,1),r=Si(n,2),s=Si(n,3),a=Si(n,4),o=Si(n,5),l=Si(n,6),u=Si(n,7);if(t.dims.length!==3&&t.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let c=t.dims[0],h=t.dims[1],f=t.dims.length===3?t.dims[2]:e.numHeads*t.dims[4],m=h,y=0,_=0,x=Math.floor(f/e.numHeads);if(l&&u&&ie.size(l.dims)&&ie.size(u.dims)){if(l.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(l.dims[0]!==c||l.dims[1]!==e.numHeads||l.dims[3]!==x)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(u.dims[0]!==c||u.dims[1]!==e.numHeads||u.dims[3]!==x)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(l.dims[2]!==u.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(u.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');y=l.dims[2],_=l.dims[2]}else if(l&&ie.size(l.dims)||u&&ie.size(u.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let v;if(i&&ie.size(i.dims)>0){if(t.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(i.dims.length<3||i.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(t.dims[0]!==i.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(i.dims.length===3){if(i.dims[2]!==t.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');v=2,m=i.dims[1]}else if(i.dims.length===5){if(i.dims[2]!==e.numHeads||i.dims[3]!==2||i.dims[4]!==x)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(r)throw new Error('Expect "value" be none when "key" has packed kv format.');v=5,m=i.dims[1]}else{if(i.dims[1]!==e.numHeads||i.dims[3]!==x)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');v=0,m=i.dims[2]}}else{if(t.dims.length!==5)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(t.dims[2]!==e.numHeads||t.dims[3]!==3)throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');v=3}if(s&&ie.size(s.dims)>0){if(s.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimension');if(i&&i.dims.length===5&&i.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let w=y+m,E=0;if(a&&ie.size(a.dims)>0){E=8;let I=a.dims;throw I.length===1?I[0]===c?E=1:I[0]===3*c+2&&(E=3):I.length===2&&I[0]===c&&I[1]===w&&(E=5),E===8?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let C=!1,D=f;if(r&&ie.size(r.dims)>0){if(r.dims.length!==3&&r.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(t.dims[0]!==r.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(r.dims.length===3){if(m!==r.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');D=r.dims[2]}else{if(m!==r.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');D=r.dims[1]*r.dims[3],C=!0}}let V=!1;if(a&&ie.size(a.dims)>0)throw new Error("Key padding mask is not supported");if(o&&ie.size(o.dims)>0){if(o.dims.length!==4)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(o.dims[0]!==c||o.dims[1]!==e.numHeads||o.dims[2]!==h||o.dims[3]!==w)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:c,sequenceLength:h,pastSequenceLength:y,kvSequenceLength:m,totalSequenceLength:w,maxSequenceLength:_,inputHiddenSize:0,hiddenSize:f,vHiddenSize:D,headSize:x,vHeadSize:Math.floor(D/e.numHeads),numHeads:e.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:e.maskFilterValue,maskType:E,scale:e.scale,broadcastResPosBias:V,passPastInKv:C,qkvFormat:v}},uB=n=>ht({...n}),jE=ht({perm:[0,2,1,3]}),LD=(n,e,t,i,r,s,a)=>{let o=[i,r,s],l=ie.size(o),u=[{type:12,data:l},{type:12,data:a},{type:12,data:s}],c=h=>{let f=Te("qkv_with_bias",e.dataType,o),m=le("qkv",e.dataType,o),y=le("bias",t.dataType,o),_=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${h.registerUniforms(_).declareVariables(m,y,f)}
  ${h.mainStart()}
    ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return n.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:o,dataType:e.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:u}),getShaderSource:c},{inputs:[e,t],outputs:[-1]})[0]},ag=(n,e,t,i,r,s,a,o)=>{let l=s;if(a&&ie.size(a.dims)>0){if(i===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return l=LD(n,s,a,e,i,t*r,o),l=l.reshape([e,i,t,r]),t===1||i===1?l:n.compute(kr(l,jE.perm),{inputs:[l],outputs:[-1]})[0]}else return s.dims.length===3&&(l=s.reshape([e,i,t,r])),t===1||i===1?l:n.compute(kr(l,jE.perm),{inputs:[l],outputs:[-1]})[0]},cB=(n,e)=>{let t=OD(n.inputs,e),i=n.inputs[0],r=Si(n.inputs,1),s=Si(n.inputs,2),a=Si(n.inputs,3),o=Si(n.inputs,4),l=Si(n.inputs,5),u=Si(n.inputs,6),c=Si(n.inputs,7);if(i.dims.length===5)throw new Error("Packed QKV is not implemented");if((r==null?void 0:r.dims.length)===5)throw new Error("Packed KV is not implemented");let h=r&&s&&r.dims.length===4&&s.dims.length===4,f=ag(n,t.batchSize,t.numHeads,t.sequenceLength,t.headSize,i,a,0);if(h)return vy(n,f,r,s,o,void 0,u,c,l,t);if(!r||!s)throw new Error("key and value must be provided");let m=ag(n,t.batchSize,t.numHeads,t.kvSequenceLength,t.headSize,r,a,t.hiddenSize),y=ag(n,t.batchSize,t.numHeads,t.kvSequenceLength,t.vHeadSize,s,a,2*t.hiddenSize);vy(n,f,m,y,o,void 0,u,c,l,t)}}),FD,zD,VD,jD,KT,hB,fB,pB=fe(()=>{Oe(),je(),Zt(),Be(),FD=n=>{if(!n||n.length<1)throw new Error("too few inputs")},zD=(n,e)=>{let t=[],i=e.numOutputs;return n[1].dims[0]>0&&(n[1].getBigInt64Array().forEach(r=>t.push(Number(r))),i=t.length),ht({numOutputs:i,axis:e.axis,splitSizes:t})},VD=n=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${n}u; i += 1u ) {
    if (index < ${$e("uniforms.size_in_split_axis","i",n)}) {
        return i;
    }
    }
    return ${n}u;
}`,jD=n=>{let e=n.length,t=[];for(let i=0;i<e;++i){let r=n[i].setByIndices("indices","input[global_idx]");e===1?t.push(r):i===0?t.push(`if (output_number == ${i}u) { ${r} }`):i===e-1?t.push(`else { ${r} }`):t.push(`else if (output_number == ${i}) { ${r} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${n[0].type.indices}, global_idx: u32) {
        ${t.join(`
`)}
      }`},KT=(n,e)=>{let t=n[0].dims,i=ie.size(t),r=n[0].dataType,s=ie.normalizeAxis(e.axis,t.length),a=new Array(e.numOutputs),o=le("input",r,t.length),l=new Array(e.numOutputs),u=[],c=[],h=0,f=[{type:12,data:i}];for(let y=0;y<e.numOutputs;y++){h+=e.splitSizes[y],l[y]=h;let _=t.slice();_[s]=e.splitSizes[y],c.push(_),a[y]=Te(`output${y}`,r,_.length),u.push({dims:c[y],dataType:n[0].dataType})}f.push({type:12,data:l},...Re(t,...c));let m=y=>`
  ${y.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",l.length).declareVariables(o,...a)}
  ${VD(l.length)}
  ${jD(a)}

  ${y.mainStart()}
    ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${o.offsetToIndices("global_idx")};
    var index = ${o.indicesGet("indices",s)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${$e("uniforms.size_in_split_axis","output_number - 1u",l.length)};
      ${o.indicesSet("indices",s,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:e.cacheKey,inputDependencies:["rank"]},getShaderSource:m,getRunData:()=>({outputs:u,dispatchGroup:{x:Math.ceil(i/64)},programUniforms:f})}},hB=(n,e)=>{FD(n.inputs);let t=n.inputs.length===1?e:zD(n.inputs,e);n.compute(KT(n.inputs,t),{inputs:[0]})},fB=n=>{let e=n.axis,t=n.splitSizes,i=n.numOutputs<0?t.length:n.numOutputs;if(i!==t.length)throw new Error("numOutputs and splitSizes length must be equal");return ht({axis:e,numOutputs:i,splitSizes:t})}}),BD,Ob,mB,gB=fe(()=>{Oe(),je(),Zt(),Be(),BD=(n,e)=>{let[t,i,r,s]=n,{numHeads:a,rotaryEmbeddingDim:o}=e;if(t.dims.length!==3&&t.dims.length!==4)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${t.dims.length}`);if(!ie.areEqual(i.dims,[])&&!ie.areEqual(i.dims,[1])&&i.dims.length!==2)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${i.dims.length}`);if(r.dims.length!==2)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${r.dims.length}`);if(s.dims.length!==2)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${s.dims.length}`);if(!ie.areEqual(r.dims,s.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(o>0&&a===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let l=t.dims[0],u=t.dims[t.dims.length-2],c=r.dims[0],h=ie.sizeFromDimension(t.dims,1)/u,f=o===0?r.dims[1]*2:h/a;if(o>f)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(i.dims.length===2){if(l!==i.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${i.dims[0]}`);if(u!==i.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${i.dims[1]}`)}if(f/2!==r.dims[1]&&o/2!==r.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${r.dims[1]}`);if(u>c)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},Ob=(n,e)=>{let{interleaved:t,numHeads:i,rotaryEmbeddingDim:r,scale:s}=e,a=n[0].dims[0],o=ie.sizeFromDimension(n[0].dims,1),l=n[0].dims[n[0].dims.length-2],u=o/l,c=n[2].dims[1],h=r===0?c*2:u/i,f=new Array(a,l,u/h,h-c),m=ie.computeStrides(f),y=[{type:1,data:s},{type:12,data:f},{type:12,data:m},...n[0].dims.length===3?new Array({type:12,data:[o,u,h,1]}):[],...n[0].dims.length===4?new Array({type:12,data:[o,h,l*h,1]}):[],...Re(n[0].dims,n[1].dims,n[2].dims,n[3].dims,n[0].dims)],_=x=>{let v=le("input",n[0].dataType,n[0].dims.length),w=le("position_ids",n[1].dataType,n[1].dims.length),E=le("cos_cache",n[2].dataType,n[2].dims.length),C=le("sin_cache",n[3].dataType,n[3].dims.length),D=Te("output",n[0].dataType,n[0].dims.length);return x.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:f.length},{name:"global_strides",type:"u32",length:m.length},{name:"input_output_strides",type:"u32",length:m.length}]),`
        ${x.declareVariables(v,w,E,C,D)}

        ${x.mainStart(Pp)}
          let half_rotary_emb_dim = uniforms.${E.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${x.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${w.broadcastedIndicesToOffset("bsnh.xy",Te("",w.type.tensor,2))};
            let position_id =
                u32(${w.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${t});
            let j = i + select(half_rotary_emb_dim, 1, ${t});
            let re = ${v.getByOffset("i")} * ${E.get("position_id","bsnh[3]")} -
                ${v.getByOffset("j")} * ${C.get("position_id","bsnh[3]")};
            ${D.setByOffset("i","re")}
            let im = ${v.getByOffset("i")} * ${C.get("position_id","bsnh[3]")} +
                ${v.getByOffset("j")} * ${E.get("position_id","bsnh[3]")};
            ${D.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${D.setByOffset("k",v.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:ht({interleaved:t}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:_,getRunData:()=>({outputs:[{dims:n[0].dims,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(ie.size(f)/Pp)},programUniforms:y})}},mB=(n,e)=>{BD(n.inputs,e),n.compute(Ob(n.inputs,e))}}),UD,HD,BE,WD,yB,fZ=fe(()=>{Zt(),Oe(),_C(),dB(),pB(),Mu(),gB(),Be(),UD=(n,e)=>{if(e.doRotary&&n.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let t=n[0],i=n[1],r=n[2],s=n[3],a=n[4];if(e.doRotary!==0&&n.length<=7)throw new Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(e.localWindowSize!==-1)throw new Error("Local attention is not supported");if(e.softcap!==0)throw new Error("Softcap is not supported");if(e.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(e.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(t.dims.length!==3&&t.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let o=!1,l=t.dims[0],u=t.dims[1],c=t.dims.length===3?o?t.dims[2]/3:t.dims[2]:e.numHeads*t.dims[4],h=u,f=0,m=!i||i.dims.length===0,y=Math.floor(m?c/(e.numHeads+2*e.kvNumHeads):c/e.numHeads);m&&(c=y*e.numHeads);let _=s&&s.dims.length!==0,x=a&&a.dims.length!==0;if(_&&s.dims.length===4&&s.dims[0]===l&&s.dims[1]!==e.kvNumHeads&&s.dims[2]===e.kvNumHeads&&s.dims[3]===y)throw new Error("BSNH pastKey/pastValue is not supported");if(_&&x){if(s.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(a.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');f=s.dims[2]}else if(_||x)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let v=1;if(i&&i.dims.length>0){if(t.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(i.dims.length<3||i.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(t.dims[0]!==i.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(i.dims.length===3){if(t.dims[2]%i.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');h=i.dims[1]}else if(i.dims.length===5){if(i.dims[2]!==e.numHeads||i.dims[3]!==2||i.dims[4]!==y)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(r)throw new Error('Expect "value" be none when "key" has packed kv format.');h=i.dims[1]}else{if(i.dims[1]!==e.numHeads||i.dims[3]!==y)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');h=i.dims[2]}}else{if(t.dims.length!==3&&t.dims.length!==5)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(t.dims.length===5&&(t.dims[2]!==e.numHeads||t.dims[3]!==3))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');v=3}let w=0,E=!1,C=e.kvNumHeads?y*e.kvNumHeads:c;if(r&&r.dims.length>0){if(r.dims.length!==3&&r.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(t.dims[0]!==r.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(r.dims.length===3){if(h!==r.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');C=r.dims[2]}else{if(h!==r.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');C=r.dims[1]*r.dims[3],E=!0}}let D=n.length>4?n[5]:void 0;if(D&&D.dims.length!==1&&D.dims[0]!==l)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:l,sequenceLength:u,pastSequenceLength:f,kvSequenceLength:h,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:c,vHiddenSize:C,headSize:y,vHeadSize:Math.floor(C/e.kvNumHeads),numHeads:e.numHeads,kvNumHeads:e.kvNumHeads,nReps:e.numHeads/e.kvNumHeads,pastPresentShareBuffer:!1,maskType:w,scale:e.scale,broadcastResPosBias:!1,passPastInKv:E,qkvFormat:v}},HD=ht({perm:[0,2,1,3]}),BE=(n,e,t)=>{let i=e,r=t.kvNumHeads;return e.dims.length===3&&t.kvSequenceLength!==0&&(i=e.reshape([t.batchSize,t.kvSequenceLength,r,t.headSize]),i=n.compute(kr(i,HD.perm),{inputs:[i],outputs:[-1]})[0]),i},WD=(n,e,t,i)=>{let r=7,s=["type","type"],a=[n*e],o=n*e,l=[{type:12,data:o},{type:12,data:e},{type:12,data:n}],u=c=>{let h=le("seq_lens",t.dataType,t.dims),f=le("total_seq_lens",i.dataType,i.dims),m=Te("pos_ids",r,a),y=[{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}];return`
  ${c.registerUniforms(y).declareVariables(h,f,m)}
  ${c.mainStart()}
    ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let total_sequence_length = u32(${f.getByOffset("0")});
    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;
    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;
    let batch_idx = global_idx / uniforms.sequence_length;
    let sequence_idx = i32(global_idx % uniforms.sequence_length);
    var pos_id: i32 = 0;
    let seqlen = ${h.getByOffset("batch_idx")};
    let total_seqlen = seqlen + 1;
    if (is_first_prompt) {
      if (sequence_idx < total_seqlen) {
        pos_id = sequence_idx;
      } else {
        pos_id = 1;
      }
      ${m.setByOffset("global_idx","pos_id")}
    } else if (is_subsequent_prompt) {
      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);
      if (past_seqlen + sequence_idx < total_seqlen) {
        pos_id = past_seqlen + sequence_idx;
      } else {
        pos_id = 1;
      }
      ${m.setByOffset("global_idx","pos_id")}
    } else if (global_idx < uniforms.batch_size) {
      ${m.setByOffset("global_idx","seqlen")}
    };
  }
  `};return{name:"GeneratePositionIds",shaderCache:{hint:`${n};${e}`,inputDependencies:s},getRunData:()=>({outputs:[{dims:a,dataType:r}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:l}),getShaderSource:u}},yB=(n,e)=>{var C;let t=UD(n.inputs,e);if(n.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(((C=n.inputs[1])==null?void 0:C.dims.length)===5)throw new Error("Packed KV is not implemented");let i=n.inputs[0],r=n.inputs[1]&&n.inputs[1].dims.length>0?n.inputs[1]:void 0,s=n.inputs[2]&&n.inputs[2].dims.length>0?n.inputs[2]:void 0,a=n.inputs[3]&&n.inputs[3].dims.length!==0?n.inputs[3]:void 0,o=n.inputs[4]&&n.inputs[4].dims.length!==0?n.inputs[4]:void 0,l=n.inputs.length>4?n.inputs[5]:void 0,u=n.inputs.length>5?n.inputs[6]:void 0,c=t.kvNumHeads?t.kvNumHeads:t.numHeads,h=ht({axis:2,numOutputs:3,splitSizes:[t.numHeads*t.headSize,c*t.headSize,c*t.headSize]}),[f,m,y]=!r&&!s?n.compute(KT([i],h),{inputs:[i],outputs:[-1,-1,-1]}):[i,r,s],_,x;if(e.doRotary){let D=n.compute(WD(t.batchSize,t.sequenceLength,l,u),{inputs:[l,u],outputs:[-1]})[0],V=n.inputs[7],I=n.inputs[8],k=ht({interleaved:e.rotaryInterleaved!==0,numHeads:t.numHeads,rotaryEmbeddingDim:0,scale:e.scale}),N=[f,D,V,I],L=[-1];_=n.compute(Ob(N,k),{inputs:N,outputs:L})[0],N.splice(0,1,m);let j=ht({interleaved:e.rotaryInterleaved!==0,numHeads:t.kvNumHeads,rotaryEmbeddingDim:0,scale:e.scale});x=n.compute(Ob(N,j),{inputs:N,outputs:L})[0]}let v=ag(n,t.batchSize,t.numHeads,t.sequenceLength,t.headSize,e.doRotary?_:f,void 0,0),w=BE(n,e.doRotary?x:m,t),E=BE(n,y,t);vy(n,v,w,E,void 0,void 0,a,o,void 0,t,l,u)}}),UE,qD,GD,_B,pZ=fe(()=>{Oe(),je(),Mu(),Be(),UE=(n,e,t,i,r,s,a,o)=>{let l=Wt(s),u=l===1?"f32":`vec${l}f`,c=l===1?"vec2f":`mat2x${l}f`,h=r*a,f=64;h===1&&(f=256);let m=[r,a,s/l],y=[r,a,2],_=["rank","type","type"],x=[];x.push(...Re(m,y));let v=w=>{let E=le("x",e.dataType,3,l),C=le("scale",t.dataType,t.dims),D=le("bias",i.dataType,i.dims),V=Te("output",1,3,2),I=[E,C,D,V];return`
  var<workgroup> workgroup_shared : array<${c}, ${f}>;
  const workgroup_size = ${f}u;
  ${w.declareVariables(...I)}
  ${w.mainStart(f)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${u}(0);
    var squared_sum = ${u}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${u}(${E.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${c}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${Au("workgroup_shared[0][0]",l)} / f32(hight * ${l});
      let squared_sum_final = ${Au("workgroup_shared[0][1]",l)} / f32(hight * ${l});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${o}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return n.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${l};${o};${f}`,inputDependencies:_},getRunData:()=>({outputs:[{dims:y,dataType:1}],dispatchGroup:{x:h},programUniforms:x}),getShaderSource:v},{inputs:[e,t,i],outputs:[-1]})[0]},qD=(n,e,t)=>{let i=e[0].dims,r=i,s=2,a=i[0],o=i[1],l=ie.sizeFromDimension(i,s),u=Wt(l),c=ie.size(r)/u,h=UE(n,e[0],e[1],e[2],a,l,o,t.epsilon),f=[a,o,l/u],m=[a,o],y=["type","none"],_=x=>{let v=le("x",e[0].dataType,f.length,u),w=le("scale_shift",1,m.length,2),E=Te("output",e[0].dataType,f.length,u),C=[v,w,E];return`
  ${x.registerUniform("output_size","u32").declareVariables(...C)}
  ${x.mainStart()}
  ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${E.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${w.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${v.getByOffset("global_idx")} * ${E.type.value}(scale_shift.x) + ${E.type.value}(scale_shift.y);
      ${E.setByOffset("global_idx","value")};
  }`};n.compute({name:"InstanceNormalization",shaderCache:{hint:`${u}`,inputDependencies:y},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:[{type:12,data:c},...Re(f,m,f)]}),getShaderSource:_},{inputs:[e[0],h]})},GD=(n,e,t)=>{let i=e[0].dims,r=i,s=i[0],a=i[i.length-1],o=ie.sizeFromDimension(i,1)/a,l=Wt(a),u=ie.size(r)/l,c=[{type:12,data:o},{type:12,data:Math.floor(a/l)}],h=["type","type"],f=!1,m=[0,i.length-1];for(let v=0;v<i.length-2;v++)f=f||i[v+1]!==1,m.push(v+1);f=f&&i[i.length-1]!==1;let y=f?n.compute(kr(n.inputs[0],m),{inputs:[n.inputs[0]],outputs:[-1]})[0]:n.inputs[0].reshape(Array.from({length:i.length},(v,w)=>i[m[w]])),_=UE(n,y,e[1],e[2],s,o,a,t.epsilon),x=v=>{let w=$n(e[0].dataType),E=l===1?"vec2f":`mat${l}x2f`,C=I=>{let k=I===0?"x":"y",N=l===1?"f32":`vec${l}f`;switch(l){case 1:return`${w}(${N}(scale.${k}))`;case 2:return`vec2<${w}>(${N}(scale[0].${k}, scale[1].${k}))`;case 4:return`vec4<${w}>(${N}(scale[0].${k}, scale[1].${k}, scale[2].${k}, scale[3].${k}))`;default:throw new Error(`Not supported compoents ${l}`)}},D=le("input",e[0].dataType,e[0].dims,l),V=Te("output",e[0].dataType,r,l);return`
  @group(0) @binding(0) var<storage, read> input : array<${D.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${E}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${V.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${v.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${C(0)}, ${C(1)});
  }`};n.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${l}`,inputDependencies:h},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:c}),getShaderSource:x},{inputs:[e[0],_]})},_B=(n,e)=>{e.format==="NHWC"?GD(n,n.inputs,e):qD(n,n.inputs,e)}}),KD,YD,vB,mZ=fe(()=>{Oe(),je(),Be(),KD=n=>{if(!n||n.length<2)throw new Error("layerNorm requires at least 2 inputs.")},YD=(n,e,t)=>{let i=e.simplified,r=n[0].dims,s=n[1],a=!i&&n[2],o=r,l=ie.normalizeAxis(e.axis,r.length),u=ie.sizeToDimension(r,l),c=ie.sizeFromDimension(r,l),h=ie.size(s.dims),f=a?ie.size(a.dims):0;if(h!==c||a&&f!==c)throw new Error(`Size of X.shape()[axis:] == ${c}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${h} and bias size of ${f}`);let m=[];for(let D=0;D<r.length;++D)D<l?m.push(r[D]):m.push(1);let y=Wt(c),_=["type","type"],x=[{type:12,data:u},{type:1,data:c},{type:12,data:Math.floor(c/y)},{type:1,data:e.epsilon}];a&&_.push("type");let v=t>1,w=t>2,E=D=>{let V=$n(n[0].dataType),I=[le("x",n[0].dataType,n[0].dims,y),le("scale",s.dataType,s.dims,y)];a&&I.push(le("bias",a.dataType,a.dims,y)),I.push(Te("output",n[0].dataType,o,y)),v&&I.push(Te("mean_data_output",1,m)),w&&I.push(Te("inv_std_output",1,m));let k=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${D.registerUniforms(k).declareVariables(...I)}
  ${D.mainStart()}
    ${D.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${zT("f32",y)};
    var mean_square_vector = ${zT("f32",y)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${Kh(V,y,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${Au("mean_vector",y)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${Au("mean_square_vector",y)} / uniforms.norm_size ${i?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${Kh(V,y,"x[j + offset]")};
      let f32scale = ${Kh(V,y,"scale[j]")};
      output[j + offset] = ${I[0].type.value}((f32input ${i?"":"- mean"}) * inv_std_dev * f32scale
        ${a?`+ ${Kh(V,y,"bias[j]")}`:""}
      );
    }

    ${v?"mean_data_output[global_idx] = mean":""};
    ${w?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},C=[{dims:o,dataType:n[0].dataType}];return v&&C.push({dims:m,dataType:1}),w&&C.push({dims:m,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${y};${t};${i}`,inputDependencies:_},getRunData:()=>({outputs:C,dispatchGroup:{x:Math.ceil(u/64)},programUniforms:x}),getShaderSource:E}},vB=(n,e)=>{KD(n.inputs),n.compute(YD(n.inputs,e,n.outputCount))}}),XD,wB,gZ=fe(()=>{je(),EC(),AC(),XD=n=>{if(!n||n.length!==2)throw new Error("MatMul requires 2 inputs.");if(n[0].dims[n[0].dims.length-1]!==n[1].dims[n[1].dims.length-2])throw new Error("shared dimension does not match.")},wB=n=>{XD(n.inputs);let e=Rp.calcShape(n.inputs[0].dims,n.inputs[1].dims,!0);if(!e)throw new Error("Can't use matmul on the given tensors");let t=e[e.length-1],i=n.inputs[0].dims[n.inputs[0].dims.length-1];if(t<8&&i<8)n.compute(xC(n.inputs,{activation:""},e));else{let r=e[e.length-2],s=ie.size(n.inputs[0].dims.slice(0,-2)),a=ie.size(n.inputs[1].dims.slice(0,-2));if(s!==1&&r===1&&a===1){let o=n.inputs[0].reshape([1,s,i]),l=n.inputs[1].reshape([1,i,t]),u=[1,s,t],c=[o,l];n.compute(Mb(c,{activation:""},e,u),{inputs:c})}else n.compute(Mb(n.inputs,{activation:""},e))}}}),QD,JD,ZD,bB,xB,yZ=fe(()=>{Oe(),je(),Zt(),Be(),QD=(n,e)=>{if(n.length<3||n.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let t=n[0],i=t.dims.length;if(t.dims[i-1]!==e.k)throw new Error("The last dim of input shape does not match the k value");let r=Math.floor((e.k+e.blockSize-1)/e.blockSize),s=e.blockSize/8*e.bits,a=n[1];if(!ie.areEqual(a.dims,[e.n,r,s]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let o=n[2].dims;if(ie.size(o)!==e.n*r)throw new Error("scales input size error.");if(n.length===4){let l=n[3].dims,u=e.n*(e.bits===8?r:Math.floor((r*e.bits+7)/8));if(ie.size(l)!==u)throw new Error("zeroPoints input size error.")}},JD=(n,e)=>{let t=n[0].dims,i=t.length,r=t[i-2],s=e.k,a=e.n,o=t.slice(0,i-2),l=ie.size(o),u=n[1].dims[2]/4,c=n[0].dataType,h=Wt(e.k),f=Wt(u),m=Wt(a),y=o.concat([r,a]),_=r>1&&a/m%2===0?2:1,x=ie.size(y)/m/_,v=64,w=[],E=[l,r,s/h],C=ie.convertShape(n[1].dims).slice();C.splice(-1,1,u/f),w.push(...Re(E)),w.push(...Re(C)),w.push(...Re(n[2].dims)),n.length===4&&w.push(...Re(ie.convertShape(n[3].dims)));let D=[l,r,a/m];w.push(...Re(D));let V=I=>{let k=E.length,N=le("a",n[0].dataType,k,h),L=le("b",12,C.length,f),j=le("scales",n[2].dataType,n[2].dims.length),H=[N,L,j],M=n.length===4?le("zero_points",12,n[3].dims.length):void 0;M&&H.push(M);let se=D.length,ue=Te("output",n[0].dataType,se,m),ee=$n(n[0].dataType),ae=(()=>{switch(h){case 1:return`array<${ee}, 8>`;case 2:return`mat4x2<${ee}>`;case 4:return`mat2x4<${ee}>`;default:throw new Error(`${h}-component is not supported.`)}})(),J=()=>{let U=`
          // reuse a data
            var input_offset = ${N.indicesToOffset(`${N.type.indices}(batch, row, word_offset)`)};
            var a_data: ${ae};
            for (var j: u32 = 0; j < ${8/h}; j++) {
              a_data[j] = ${N.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let Y=0;Y<m*_;Y++)U+=`
            b_value = ${f===1?`b${Y}_data`:`b${Y}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${ae}(${Array.from({length:4},(K,Z)=>`${ee}(b_value_lower[${Z}]), ${ee}(b_value_upper[${Z}])`).join(", ")});
            b_dequantized_values = ${h===1?`${ae}(${Array.from({length:8},(K,Z)=>`(b_quantized_values[${Z}] - ${M?`zero_point${Y}`:"zero_point"}) * scale${Y}`).join(", ")});`:`(b_quantized_values - ${ae}(${Array(8).fill(`${M?`zero_point${Y}`:"zero_point"}`).join(",")})) * scale${Y};`};
            workgroup_shared[local_id.x * ${_} + ${Math.floor(Y/m)}]${m>1?`[${Y%m}]`:""} += ${Array.from({length:8/h},(K,Z)=>`${h===1?`a_data[${Z}] * b_dequantized_values[${Z}]`:`dot(a_data[${Z}], b_dequantized_values[${Z}])`}`).join(" + ")};
          `;return U},q=()=>{let U=`
            var col_index = col * ${m};
            ${M?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${ee}(8);`}
            `;for(let Y=0;Y<m*_;Y++)U+=`
            let scale${Y} = ${j.getByOffset("col_index * nBlocksPerCol + block")};
            ${M?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${M.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${Y} = ${ee}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return U},G=()=>{let U=`col_index = col * ${m};`;for(let Y=0;Y<m*_;Y++)U+=`
            let b${Y}_data = ${L.getByIndices(`${L.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return U+=`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${ae};
            var b_dequantized_values: ${ae};`,U};return`
        var<workgroup> workgroup_shared: array<${ue.type.value}, ${_*v}>;
        ${I.declareVariables(...H,ue)}
        ${I.mainStart([v,1,1])}
          let output_indices = ${ue.offsetToIndices(`(global_idx / ${v}) * ${_}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${v}) {
            //process one block
            var word_offset: u32 = block * ${e.blockSize/h};
            ${q()}
            for (var word: u32 = 0; word < ${u}; word += ${f}) {
              ${G()}
              for (var i: u32 = 0; i < ${f}; i++) {
                ${J()}
                word_offset += ${8/h};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${_}) {
            var output_value: ${ue.type.value} = ${ue.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${v}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${_};
            }
            ${ue.setByIndices(`${ue.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${e.blockSize};${e.bits};${h};${f};${m};${_};${v}`,inputDependencies:Array(n.length).fill("rank")},getRunData:()=>({outputs:[{dims:y,dataType:c}],dispatchGroup:{x},programUniforms:w}),getShaderSource:V}},ZD=(n,e)=>{let t=n[0].dims,i=t.length,r=t[i-2],s=e.k,a=e.n,o=t.slice(0,i-2),l=ie.size(o),u=n[1].dims[2]/4,c=n[0].dataType,h=Wt(e.k),f=Wt(u),m=o.concat([r,a]),y=128,_=a%8===0?8:a%4===0?4:1,x=y/_,v=x*f*8,w=v/h,E=v/e.blockSize,C=ie.size(m)/_,D=[],V=[l,r,s/h],I=ie.convertShape(n[1].dims).slice();I.splice(-1,1,u/f),D.push(...Re(V)),D.push(...Re(I)),D.push(...Re(n[2].dims)),n.length===4&&D.push(...Re(ie.convertShape(n[3].dims)));let k=[l,r,a];D.push(...Re(k));let N=L=>{let j=V.length,H=le("a",n[0].dataType,j,h),M=le("b",12,I.length,f),se=le("scales",n[2].dataType,n[2].dims.length),ue=[H,M,se],ee=n.length===4?le("zero_points",12,n[3].dims.length):void 0;ee&&ue.push(ee);let ae=k.length,J=Te("output",n[0].dataType,ae),q=$n(n[0].dataType),G=()=>{switch(h){case 1:return`
          let a_data0 = vec4<${q}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${q}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${q}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${q}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${h}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${H.type.value}, ${w}>;
        var<workgroup> inter_results: array<array<${J.type.value}, ${x}>, ${_}>;
        ${L.declareVariables(...ue,J)}
        ${L.mainStart([x,_,1])}
          let output_indices = ${J.offsetToIndices(`workgroup_index * ${_}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${E} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${w};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${w}; a_offset += ${y})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${H.getByIndices(`${H.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${H.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${E} + local_id.x;
            ${ee?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${ee.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${q}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${q}(8);`}
            let scale = ${se.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${M.getByIndices(`${M.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${e.blockSize/h};
            for (var i: u32 = 0; i < ${f}; i++) {
              ${G()}
              let b_value = ${f===1?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${q}>(${Array.from({length:4},(U,Y)=>`${q}(b_value_lower[${Y}]), ${q}(b_value_upper[${Y}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${q}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(U,Y)=>`${`dot(a_data${Y}, b_dequantized_values[${Y}])`}`).join(" + ")};
              word_offset += ${8/h};
            }
            workgroupBarrier();
          }

          if (local_idx < ${_}) {
            var output_value: ${J.type.value} = ${J.type.value}(0);
            for (var b = 0u; b < ${x}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${J.setByIndices(`${J.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${e.blockSize};${h};${f};${x};${_}`,inputDependencies:Array(n.length).fill("rank")},getRunData:()=>({outputs:[{dims:m,dataType:c}],dispatchGroup:{x:C},programUniforms:D}),getShaderSource:N}},bB=(n,e)=>{QD(n.inputs,e),e.blockSize===32&&n.adapterInfo.isVendor("intel")&&n.adapterInfo.isArchitecture("gen-12lp")?n.compute(ZD(n.inputs,e)):n.compute(JD(n.inputs,e))},xB=n=>ht(n)}),eM,tM,nM,iM,rM,sM,aM,oM,EB,_Z=fe(()=>{Oe(),je(),Be(),eM=n=>{if(!n||n.length<1)throw new Error("Too few inputs");if(n[0].dataType!==1&&n[0].dataType!==10)throw new Error("Input type must be float or float16.");if(n.length>=2){let e=n[0].dims.length*2===n[1].dims[0];if(n.length===4&&(e=n[3].dims[0]*2===n[1].dims[0]),!e)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},tM=(n,e,t)=>{let i="";for(let r=e-1;r>=0;--r)i+=`
            k = i32(${n.indicesGet("indices",r)}) - ${$e("uniforms.pads",r,t)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${$e("uniforms.x_shape",r,e)})) {
              break;
            }
            offset += k * i32(${$e("uniforms.x_strides",r,e)});
        `;return`
          value = ${n.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${i}
            value = x[offset];
          }
      `},nM=(n,e,t)=>{let i="";for(let r=e-1;r>=0;--r)i+=`
                k = i32(${n.indicesGet("indices",r)}) - ${$e("uniforms.pads",r,t)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${$e("uniforms.x_shape",r,e)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${$e("uniforms.x_shape",r,e)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${$e("uniforms.x_strides",r,e)});
            `;return`
              var offset = 0;
              var k = 0;
              ${i}
              value = x[offset];
          `},iM=(n,e,t)=>{let i="";for(let r=e-1;r>=0;--r)i+=`
                k = i32(${n.indicesGet("indices",r)}) - ${$e("uniforms.pads",r,t)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${$e("uniforms.x_shape",r,e)})) {
                  k = i32(${$e("uniforms.x_shape",r,e)}) - 1;
                }
                offset += k * i32(${$e("uniforms.x_strides",r,e)});
            `;return`
              var offset = 0;
              var k = 0;
              ${i}
              value = x[offset];
          `},rM=(n,e,t)=>{let i="";for(let r=e-1;r>=0;--r)i+=`
                k = i32(${n.indicesGet("indices",r)}) - ${$e("uniforms.pads",r,t)};
                if (k < 0)  {
                  k += i32(${$e("uniforms.x_shape",r,e)}]);
                }
                if (k >= i32(${$e("uniforms.x_shape",r,e)})) {
                  k -= i32(${$e("uniforms.x_shape",r,e)});
                }
                offset += k * i32(${$e("uniforms.x_strides",r,e)});
            `;return`
              var offset = 0;
              var k = 0;
              ${i}
              value = x[offset];
          `},sM=(n,e,t)=>{switch(t.mode){case 0:return tM(n,e,t.pads.length);case 1:return nM(n,e,t.pads.length);case 2:return iM(n,e,t.pads.length);case 3:return rM(n,e,t.pads.length);default:throw new Error("Invalid mode")}},aM=(n,e)=>{let t=ie.padShape(n[0].dims.slice(),e.pads),i=n[0].dims,r=ie.size(t),s=[{type:12,data:r},{type:6,data:e.pads}],a=n.length>=3&&n[2].data;e.mode===0&&s.push({type:a?n[2].dataType:1,data:e.value}),s.push(...Re(n[0].dims,t));let o=["rank"],l=u=>{let c=Te("output",n[0].dataType,t.length),h=le("x",n[0].dataType,i.length),f=h.type.value,m=sM(c,i.length,e),y=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:e.pads.length}];return e.mode===0&&y.push({name:"constant_value",type:a?f:"f32"}),`
            ${u.registerUniforms(y).declareVariables(h,c)}
            ${u.mainStart()}
            ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${c.offsetToIndices("global_idx")};

            var value = ${f}(0);
            ${m}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${e.mode}${a}`,inputDependencies:o},getRunData:()=>({outputs:[{dims:t,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(ie.size(t)/64)},programUniforms:s}),getShaderSource:l}},oM=(n,e)=>{if(n.length>1){let t=n[1].getBigInt64Array(),i=n.length>=3&&n[2].data?n[2].dataType===10?n[2].getUint16Array()[0]:n[2].getFloat32Array()[0]:0,r=n[0].dims.length,s=new Int32Array(2*r).fill(0);if(n.length>=4){let o=n[3].getBigInt64Array();for(let l=0;l<o.length;l++)s[Number(o[l])]=Number(t[l]),s[Number(o[l])+r]=Number(t[l+o.length])}else t.forEach((o,l)=>s[Number(l)]=Number(o));let a=[];return s.forEach(o=>a.push(o)),{mode:e.mode,value:i,pads:a}}else return e},EB=(n,e)=>{eM(n.inputs);let t=oM(n.inputs,e);n.compute(aM(n.inputs,t),{inputs:[0]})}}),Lm,HE,WE,qE,GE,lM,uM,KE,YE,AB,TB,XE,SB,IB,QE,CB,kB,$B,RB,vZ=fe(()=>{ts(),Oe(),je(),Be(),Lm=n=>{if(Nt.webgpu.validateInputContent&&(!n||n.length!==1))throw new Error("Pool ops requires 1 input.")},HE=(n,e,t)=>{let i=e.format==="NHWC",r=n.dims.slice();i&&r.splice(1,0,r.pop());let s=Object.hasOwnProperty.call(e,"dilations"),a=e.kernelShape.slice(),o=e.strides.slice(),l=s?e.dilations.slice():[],u=e.pads.slice();Nb.adjustPoolAttributes(t,r,a,o,l,u);let c=Nb.computePoolOutputShape(t,r,o,l,a,u,e.autoPad),h=Object.assign({},e);s?Object.assign(h,{kernelShape:a,strides:o,pads:u,dilations:l,cacheKey:e.cacheKey}):Object.assign(h,{kernelShape:a,strides:o,pads:u,cacheKey:e.cacheKey});let f=c.slice();return f.push(f.splice(1,1)[0]),[h,i?f:c]},WE=(n,e)=>{let t=e.format==="NHWC",i=ie.size(n),r=ie.size(e.kernelShape),s=[{type:12,data:i},{type:12,data:r}],a=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(e.kernelShape.length<=2){let o=e.kernelShape[e.kernelShape.length-1],l=e.strides[e.strides.length-1],u=e.pads[e.pads.length/2-1],c=e.pads[e.pads.length-1],h=!!(u+c);s.push({type:12,data:o},{type:12,data:l},{type:12,data:u},{type:12,data:c}),a.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let f=!1;if(e.kernelShape.length===2){let m=e.kernelShape[e.kernelShape.length-2],y=e.strides[e.strides.length-2],_=e.pads[e.pads.length/2-2],x=e.pads[e.pads.length-2];f=!!(_+x),s.push({type:12,data:m},{type:12,data:y},{type:12,data:_},{type:12,data:x}),a.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[s,a,!0,h,f]}else{if(t)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let o=ie.computeStrides(e.kernelShape);s.push({type:12,data:o},{type:12,data:e.pads},{type:12,data:e.strides}),a.push({name:"kernelStrides",type:"u32",length:o.length},{name:"pads",type:"u32",length:e.pads.length},{name:"strides",type:"u32",length:e.strides.length});let l=e.pads.reduce((u,c)=>u+c);return[s,a,!!l,!1,!1]}},qE=(n,e,t,i,r,s,a,o,l,u,c,h)=>{let f=r.format==="NHWC",m=e.type.value,y=Te("output",e.type.tensor,i);if(r.kernelShape.length<=2){let _="",x="",v="",w=t-(f?2:1);if(c?_=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${w}] = indices[${w}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${w}] < 0 || xIndices[${w}]
                      >= uniforms.x_shape[${w}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${e.indicesToOffset("xIndices")}];
                  ${s}
                }`:_=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${w}] = indices[${w}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${e.indicesToOffset("xIndices")}];
                  ${s}
                }`,r.kernelShape.length===2){let E=t-(f?3:2);h?x=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${E}] = indices[${E}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${E}] < 0 || xIndices[${E}] >= uniforms.x_shape[${E}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:x=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${E}] = indices[${E}] * uniforms.sh - uniforms.phStart + j;
                `,v=`
              }
            `}return`
            ${n.registerUniforms(l).declareVariables(e,y)}

            ${n.mainStart()}
              ${n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${y.offsetToIndices("global_idx")};
              var xIndices = ${y.offsetToIndices("global_idx")};

              var value = ${m}(${o});
              var pad = 0;
              ${x}
              ${_}
              ${v}
              ${a}

              output[global_idx] = value;
            }`}else{if(f)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let _=r.kernelShape.length,x=r.pads.length,v="";return u?v=`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${e.indicesToOffset("xIndices")}];
                ${s}
              }`:v=`
              }
              let x_val = x[${e.indicesToOffset("xIndices")}];
              ${s}
            `,`
            ${n.registerUniforms(l).declareVariables(e,y)}

            ${n.mainStart()}
              ${n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${y.offsetToIndices("global_idx")};
              var xIndices = ${y.offsetToIndices("global_idx")};

              var offsets: array<u32, ${_}>;

              var value = ${m}(${o});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${_-1}u; j++) {
                  offsets[j] = offset / ${$e("uniforms.kernelStrides","j",_)};
                  offset -= offsets[j] * ${$e("uniforms.kernelStrides","j",_)};
                }
                offsets[${_-1}] = offset;

                isPad = false;
                for (var j = ${t-_}u; j < ${t}u; j++) {
                  xIndices[j] = indices[j] * ${$e("uniforms.strides",`j - ${t-_}u`,_)}
                    + offsets[j - ${t-_}u] - ${$e("uniforms.pads","j - 2u",x)};
                  ${v}
              }
              ${a}

              output[global_idx] = value;
            }`}},GE=n=>`${n.format};${n.ceilMode};${n.autoPad};${n.kernelShape.length}`,lM=n=>`${GE(n)};${n.countIncludePad}`,uM=n=>`${GE(n)};${n.storageOrder};${n.dilations}`,KE=n=>({format:n.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][n.auto_pad],ceilMode:n.ceil_mode,kernelShape:n.kernel_shape,strides:n.strides,pads:n.pads}),YE=(n,e,t,i)=>{let[r,s]=HE(e,i,t),a=le("x",e.dataType,e.dims.length),o=a.type.value,l="value += x_val;",u="";r.countIncludePad?u+=`value /= ${o}(uniforms.kernelSize);`:u+=`value /= ${o}(i32(uniforms.kernelSize) - pad);`;let[c,h,f,m,y]=WE(s,r);c.push(...Re(e.dims,s));let _=["rank"];return{name:n,shaderCache:{hint:`${i.cacheKey};${f};${m};${y}`,inputDependencies:_},getRunData:()=>({outputs:[{dims:s,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(ie.size(s)/64)},programUniforms:c}),getShaderSource:x=>qE(x,a,e.dims.length,s.length,r,l,u,0,h,f,m,y)}},AB=n=>{let e=n.count_include_pad!==0,t=KE(n);if(t.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let i={countIncludePad:e,...t,cacheKey:""};return{...i,cacheKey:lM(i)}},TB=(n,e)=>{Lm(n.inputs),n.compute(YE("AveragePool",n.inputs[0],!1,e))},XE={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},SB=n=>{let e=n.format;return{format:e,...XE,cacheKey:e}},IB=(n,e)=>{Lm(n.inputs),n.compute(YE("GlobalAveragePool",n.inputs[0],!0,e))},QE=(n,e,t,i)=>{let[r,s]=HE(e,i,t),a=`
      value = max(x_val, value);
    `,o="",l=le("x",e.dataType,e.dims.length),u=["rank"],[c,h,f,m,y]=WE(s,r);return c.push(...Re(e.dims,s)),{name:n,shaderCache:{hint:`${i.cacheKey};${f};${m};${y}`,inputDependencies:u},getRunData:()=>({outputs:[{dims:s,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(ie.size(s)/64)},programUniforms:c}),getShaderSource:_=>qE(_,l,e.dims.length,s.length,r,a,o,e.dataType===10?-65504:-1e5,h,f,m,y)}},CB=(n,e)=>{Lm(n.inputs),n.compute(QE("MaxPool",n.inputs[0],!1,e))},kB=n=>{let e=n.storage_order,t=n.dilations,i=KE(n);if(e!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(i.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let r={storageOrder:e,dilations:t,...i,cacheKey:""};return{...r,cacheKey:uM(r)}},$B=n=>{let e=n.format;return{format:e,...XE,cacheKey:e}},RB=(n,e)=>{Lm(n.inputs),n.compute(QE("GlobalMaxPool",n.inputs[0],!0,e))}}),cM,dM,PB,NB,wZ=fe(()=>{Oe(),je(),Zt(),Be(),cM=(n,e)=>{if(n.length<2||n.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(n.length===3&&n[1].dims===n[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(n.length===3&&n[0].dataType!==n[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(n[0].dataType===6&&n.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(n[1].dims.length!==0&&n[1].dims.length!==1&&n[1].dims.length!==n[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(n.length>2){if(n[0].dataType!==n[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(n[1].dims.length!==n[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!n[1].dims.map((t,i)=>t===n[2].dims[i]).reduce((t,i)=>t&&i,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(e.blockSize>0){if(n[1].dims.length===0||n[1].dims.length===1&&n[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!n[1].dims.map((r,s)=>s===e.axis||r===n[0].dims[s]).reduce((r,s)=>r&&s,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(n[1].dims.length!==n[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let t=n[0].dims[e.axis],i=n[1].dims[e.axis];if(e.blockSize<Math.ceil(t/i)||e.blockSize>Math.ceil(t/(i-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},dM=(n,e)=>{let t=ie.normalizeAxis(e.axis,n[0].dims.length),i=n[0].dataType,r=i===3,s=n[0].dims,a=n[1].dataType,o=ie.size(s),l=i===3||i===2,u=l?[Math.ceil(ie.size(n[0].dims)/4)]:n[0].dims,c=n[1].dims,h=n.length>2?n[2]:void 0,f=h?l?[Math.ceil(ie.size(h.dims)/4)]:h.dims:void 0,m=c.length===0||c.length===1&&c[0]===1,y=m===!1&&c.length===1,_=Wt(o),x=m&&(!l||_===4),v=x?_:1,w=x&&!l?_:1,E=le("input",l?12:i,u.length,w),C=le("scale",a,c.length),D=h?le("zero_point",l?12:i,f.length):void 0,V=Te("output",a,s.length,v),I=[E,C];D&&I.push(D);let k=[u,c];h&&k.push(f);let N=[{type:12,data:o/v},{type:12,data:t},{type:12,data:e.blockSize},...Re(...k,s)],L=j=>{let H=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${j.registerUniforms(H).declareVariables(...I,V)}
      ${j.mainStart()}
          ${j.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${V.offsetToIndices("global_idx")};

          // Set input x
          ${l?`
            let input = ${E.getByOffset("global_idx / 4")};
            let x_vec = ${r?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${v===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${E.getByOffset("global_idx")};`};

          // Set scale input
          ${m?`let scale_value= ${C.getByOffset("0")}`:y?`
            let scale_index = ${V.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${C.getByOffset("scale_index")};`:`
            var scale_indices: ${C.type.indices} = output_indices;
            let index = ${C.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${C.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${C.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${D?m?l?`
                let zero_point_input = ${D.getByOffset("0")};
                let zero_point_vec =  ${r?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${D.getByOffset("0")}`:y?l?`
                let zero_point_index = ${V.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${D.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${r?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${V.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${D.getByOffset("zero_point_index")};`:l?`
                let zero_point_offset = ${C.indicesToOffset("scale_indices")};
                let zero_point_input = ${D.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${r?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${D.getByIndices("scale_indices")};`:`let zero_point_value = ${l?r?"i32":"u32":E.type.value}(0);`};
      // Compute and write output
      ${V.setByOffset("global_idx",`${V.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:e.cacheKey,inputDependencies:D?["rank","rank","rank"]:["rank","rank"]},getShaderSource:L,getRunData:()=>({outputs:[{dims:s,dataType:a}],dispatchGroup:{x:Math.ceil(o/v/64),y:1,z:1},programUniforms:N})}},PB=(n,e)=>{cM(n.inputs,e),n.compute(dM(n.inputs,e))},NB=n=>ht({axis:n.axis,blockSize:n.blockSize})}),hM,fM,DB,bZ=fe(()=>{ts(),Oe(),Be(),hM=(n,e,t)=>{let i=n===e,r=n<e&&t<0,s=n>e&&t>0;if(i||r||s)throw new Error("Range these inputs' contents are invalid.")},fM=(n,e,t,i)=>{let r=Math.abs(Math.ceil((e-n)/t)),s=[r],a=r,o=[{type:12,data:a},{type:i,data:n},{type:i,data:t},...Re(s)],l=u=>{let c=Te("output",i,s.length),h=c.type.value,f=[{name:"outputSize",type:"u32"},{name:"start",type:h},{name:"delta",type:h}];return`
        ${u.registerUniforms(f).declareVariables(c)}
        ${u.mainStart()}
        ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${h}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${i}`},getShaderSource:l,getRunData:()=>({outputs:[{dims:s,dataType:i}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:o})}},DB=n=>{let e=0,t=0,i=0;n.inputs[0].dataType===6?(e=n.inputs[0].getInt32Array()[0],t=n.inputs[1].getInt32Array()[0],i=n.inputs[2].getInt32Array()[0]):n.inputs[0].dataType===1&&(e=n.inputs[0].getFloat32Array()[0],t=n.inputs[1].getFloat32Array()[0],i=n.inputs[2].getFloat32Array()[0]),Nt.webgpu.validateInputContent&&hM(e,t,i),n.compute(fM(e,t,i,n.inputs[0].dataType),{inputs:[]})}}),pM,mM,MB,OB,xZ=fe(()=>{Oe(),je(),Zt(),Be(),pM=(n,e,t,i)=>{if(n!=="none"&&i!=="i32"&&i!=="u32"&&i!=="f32")throw new Error(`Input ${i} is not supported with reduction ${n}.`);let r=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,s=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${e}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(n){case"none":return`${e}=${t};`;case"add":return i==="i32"||i==="u32"?`atomicAdd(&${e}, bitcast<${i}>(${t}));`:`
              ${r}bitcast<${i}>(oldValue) + (${t})${s}`;case"max":return i==="i32"||i==="u32"?`atomicMax(&${e}, bitcast<${i}>(${t}));`:`
                ${r}max(bitcast<f32>(oldValue), (${t}))${s}`;case"min":return i==="i32"||i==="u32"?`atomicMin(&${e}, bitcast<${i}>(${t}));`:`${r}min(bitcast<${i}>(oldValue), (${t}))${s}`;case"mul":return`${r}(bitcast<${i}>(oldValue) * (${t}))${s}`;default:throw new Error(`Reduction ${n} is not supported.`)}},mM=(n,e)=>{let t=n[0].dims,i=n[1].dims,r=t,s=1,a=Math.ceil(ie.sizeToDimension(i,i.length-1)/s),o=i[i.length-1],l=ie.sizeFromDimension(t,o),u=[{type:12,data:a},{type:12,data:o},{type:12,data:l},...Re(n[1].dims,n[2].dims,r)],c=h=>{let f=le("indices",n[1].dataType,n[1].dims.length),m=le("updates",n[2].dataType,n[2].dims.length,s),y=e.reduction!=="none"&&e.reduction!==""?cV("output",n[0].dataType,r.length):Te("output",n[0].dataType,r.length,s);return`
      ${h.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(f,m,y)}
      ${h.mainStart()}
        ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var data_offset = 0u;
  let indices_start = uniforms.last_index_dimension * global_idx;
  let indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${n[0].dims.length===1?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[i - indices_start];
    let dim_value = uniforms.output_shape[i - indices_start];`}
    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));
  }

  for (var i = 0u; i < uniforms.num_updates_elements; i++) {
    let value = updates[uniforms.num_updates_elements * global_idx + i];
    ${pM(e.reduction,"output[data_offset + i]","value",y.type.value)}
  }

      }`};return{name:"ScatterND",shaderCache:{hint:`${e.cacheKey}_${e.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:r,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:u}),getShaderSource:c}},MB=n=>ht({reduction:n.reduction}),OB=(n,e)=>{n.compute(mM(n.inputs,e),{inputs:[n.inputs[1],n.inputs[2]],outputs:[]})}}),gM,yM,_M,JE,vM,wM,bM,xM,EM,AM,TM,SM,ZE,IM,CM,kM,$M,RM,LB,FB,EZ=fe(()=>{Oe(),je(),Zt(),Be(),gM=(n,e)=>{if(n.every(t=>t>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),n.length>0){if(e.mode==="linear"){if(!(n.length===2||n.length===3||n.length===4&&n[0]===1&&n[1]===1||n.length===4&&n[0]===1&&n[3]===1||n.length===5&&n[0]===1&&n[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(e.mode==="cubic"&&!(n.length===2||n.length===4&&n[0]===1&&n[1]===1||n.length===4&&n[0]===1&&n[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},yM=(n,e,t)=>{e.every(r=>r>=0&&r<t||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let i=new Array(t).fill(1);return e.forEach((r,s)=>i[r]=n[s]),i},_M=(n,e,t,i,r,s)=>{let[a,o,l]=t>10?[1,2,3]:[-1,n.length>1?1:-1,-1],u=n[0].dims.length;if(a>0&&n.length>a&&n[a].dims.length>0)n[a].getFloat32Array().forEach(c=>s.push(c));else if(e.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(o>0&&n.length>o&&n[o].dims.length===1&&n[o].dims[0]>0){if(n[o].getFloat32Array().forEach(c=>i.push(c)),i.length!==0&&i.length!==u&&t>=18&&i.length!==e.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");gM(i,e),e.axes.length>0&&yM(i,e.axes,u).forEach((c,h)=>i[h]=c)}if(l>0&&n.length>l&&n[l].dims.length===1&&n[l].dims[0]>0&&(n[l].getBigInt64Array().forEach(c=>r.push(Number(c))),r.length!==0&&r.length!==u&&t>=18&&r.length!==e.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(e.axes.length>0){if(i.length!==0&&i.length!==e.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(r.length!==0&&r.length!==e.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof i<"u"&&typeof r<"u"&&i.length>0&&r.length>u)throw new Error("Resize requires only of scales or sizes to be specified")},JE=(n,e,t,i)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${n}) * (${e});
  let whole = ${i}(big / (${t}));
  let fract = ${i}(big % (${t})) / ${i}(${t});
  return whole + fract;
`,vM=(n,e)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${e} { `+(()=>{switch(n){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${e}(xResized) / ${e}(xScale);
          } else {
            ${JE("xResized","lengthOriginal","lengthResized",e)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${e}(xResized) + 0.5) / ${e}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${e}(xResized) + 0.5) / ${e}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${JE("xResized","lengthOriginal - 1","lengthResized - 1",e)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${e}(roiStart) * ${e}(lengthOriginal - 1) +
                        (${e}(xResized) * ${e}(roiEnd - roiStart) * ${e}(lengthOriginal - 1)) /
                        ${e}(lengthResized - 1);
                  } else {
                    return 0.5 * ${e}(roiStart + roiEnd) * ${e}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${e}xScale * ${e}(lengthResized);
                  const adjustment = ${e}(lengthResized) / outputWidth;
                  const center = ${e}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${e}(xResized) + 0.5) / ${e}(xScale)) - 0.5;`;case"half_pixel":return`return ((${e}(xResized) + 0.5) / ${e}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${n} is not supported`)}})()+"}",wM=(n,e,t)=>`fn getNearestPixelFromOriginal(xOriginal: ${t}, isDownSample: bool) -> ${t} {`+(()=>{switch(n){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(e<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${n} is not supported`)}})()+"}",bM=(n,e,t)=>{let i=new Array(t).fill(0).concat(new Array(t).fill(1)),r=n.length===0?i:n.slice();return e.length>0?(e.forEach((s,a)=>{i[s]=r[a],i[a+t]=r[e.length+a]}),i):r},xM=(n,e,t,i)=>{let r=[];if(t.length>0)if(i.length>0){if(n.forEach(s=>r.push(s)),Math.max(...i)>n.length)throw new Error("axes is out of bound");i.forEach((s,a)=>r[s]=t[a])}else t.forEach(s=>r.push(s));else{if(e.length===0)throw new Error("Resize requires either scales or sizes.");r=n.map((s,a)=>Math.round(s*e[a]))}return r},EM=(n,e,t)=>{let i=(()=>{switch(t.keepAspectRatioPolicy){case"not_larger":return t.axes.length>0?Math.min(...t.axes.map(s=>e[s]),Number.MAX_VALUE):Math.min(...e,Number.MAX_VALUE);case"not_smaller":return t.axes.length>0?Math.max(...t.axes.map(s=>e[s]),Number.MIN_VALUE):Math.max(...e,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${t.keepAspectRatioPolicy} is not supported`)}})();e.fill(1,0,e.length);let r=n.slice();return t.axes.length>0?(t.axes.forEach(s=>e[s]=i),t.axes.forEach(s=>r[s]=Math.round(n[s]*e[s]))):(e.fill(i,0,e.length),r.forEach((s,a)=>r[a]=Math.round(s*e[a]))),r},AM=(n,e,t,i,r)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${n.type.indices}) -> array<${n.type.value}, ${t.length}> {
      var original_indices: array<${n.type.value}, ${t.length}>;
      for (var i:u32 = 0; i < ${t.length}; i++) {
        var output_index = ${n.indicesGet("output_indices","i")};
        var scale = ${$e("uniforms.scales","i",i)};
        var roi_low = ${$e("uniforms.roi","i",r)};
        var roi_hi = ${$e("uniforms.roi",`i + ${e.length}`,r)};
        if (scale == 1.0) {
          original_indices[i] = ${n.type.value}(output_index);
        } else {
          var input_shape_i = ${$e("uniforms.input_shape","i",e.length)};
          var output_shape_i = ${$e("uniforms.output_shape","i",t.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,TM=(n,e,t,i,r,s,a)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${e.type.indices}) -> ${n.type.indices} {
      var input_indices: ${n.type.indices};
      for (var i:u32 = 0; i < ${i.length}; i++) {
        var output_index = ${e.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${$e("uniforms.scales","i",r)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${$e("uniforms.roi","i",s)};
          var roi_hi = ${$e("uniforms.roi",`i + ${t.length}`,s)};
          var input_shape_i = ${$e("uniforms.input_shape","i",t.length)};
          var output_shape_i = ${$e("uniforms.output_shape","i",i.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${a} || (original_idx >= 0 && original_idx < ${e.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${e.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${n.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,SM=(n,e)=>`
    fn checkInputIndices(input_indices: ${n.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${e.length}; i++) {
        var input_index = ${n.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${$e("uniforms.input_shape","i",e.length)}) {
          return false;
        }
      }
      return true;
    }`,ZE=(n,e,t,i)=>n.rank>i?`
    ${n.indicesSet("input_indices",e,"channel")};
    ${n.indicesSet("input_indices",t,"batch")};
`:"",IM=(n,e,t,i,r)=>{let[s,a,o,l]=t.length===2?[-1,0,1,-1]:[0,2,3,1],u=n.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${u} {
      var input_indices: ${n.type.indices};
      ${n.indicesSet("input_indices",a,`max(0, min(row, ${t[a]} - 1))`)};
      ${n.indicesSet("input_indices",o,`max(0, min(col, ${t[o]} - 1))`)};
      ${ZE(n,l,s,2)}
      return ${n.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${e.type.indices}) -> ${u} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${u} = originalIndices[${a}];
      var col:${u} = originalIndices[${o}];
      ${i?`if (row < 0 || row > (${t[a]} - 1) || col < 0 || col > (${t[o]} - 1)) {
        return ${r};
      }`:""};
      row = max(0, min(row, ${t[a]} - 1));
      col = max(0, min(col, ${t[o]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${t.length>2?`u32(originalIndices[${l}])`:"0"};
      var batch: u32 =  ${t.length>2?`u32(originalIndices[${s}])`:"0"};
      var x11: ${u} = getInputValue(batch, channel, row1, col1);
      var x12: ${u} = getInputValue(batch, channel, row1, col2);
      var x21: ${u} = getInputValue(batch, channel, row2, col1);
      var x22: ${u} = getInputValue(batch, channel, row2, col2);
      var dx1: ${u} = abs(row - ${u}(row1));
      var dx2: ${u} = abs(${u}(row2) - row);
      var dy1: ${u} = abs(col - ${u}(col1));
      var dy2: ${u} = abs(${u}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},CM=(n,e,t,i,r,s,a,o,l,u)=>{let c=t.length===2,[h,f]=c?[0,1]:[2,3],m=n.type.value,y=_=>{let x=_===h?"row":"col";return`
      fn ${x}CubicInterpolation(input_indices: ${n.type.indices}, output_indices: ${e.type.indices}) -> ${m} {
        var output_index = ${e.indicesGet("output_indices",_)};
        var originalIdx: ${m} = getOriginalCoordinateFromResizedCoordinate(output_index, ${r[_]},
        ${i[_]}, ${t[_]}, ${s[_]}, ${s[_]} + ${t.length});
        var fractOriginalIdx: ${m} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${o} && (originalIdx < 0 || originalIdx > (${t[_]} - 1))) {
          return ${l};
        }
        var data: array<${m}, 4> = array<${m}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${x}: ${m} = originalIdx + ${m}(i);
          if (${x} < 0 || ${x} >= ${t[_]}) {
            ${u?`coefs[i + 1] = 0.0;
                        continue;`:o?`return ${l};`:`${x} = max(0, min(${x}, ${t[_]} - 1));`};
          }
        var input_indices_copy: ${n.type.indices} = input_indices;
          ${n.indicesSet("input_indices_copy",_,`u32(${x})`)};
          data[i + 1] = ${_===h?n.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${y(h)};
    ${y(f)};
  fn getCubicInterpolationCoefs(s: ${m}) -> array<${m}, 4> {
    var absS = abs(s);
    var coeffs: array<${m}, 4> = array<${m}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${m} = 1.0 - absS;
    var twoMinusAbsS: ${m} = 2.0 - absS;
    var onePlusAbsS: ${m} = 1.0 + absS;
    coeffs[0] = ((${a} * onePlusAbsS - 5 * ${a}) * onePlusAbsS + 8 * ${a}) * onePlusAbsS - 4 * ${a};
    coeffs[1] = ((${a} + 2) * absS - (${a} + 3)) * absS * absS + 1;
    coeffs[2] = ((${a} + 2) * oneMinusAbsS - (${a} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${a} * twoMinusAbsS - 5 * ${a}) * twoMinusAbsS + 8 * ${a}) * twoMinusAbsS - 4 * ${a};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${m}, 4>, coefs: array<${m}, 4>) -> ${m} {
    var coefsSum: ${m} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${e.type.indices}) -> ${m} {
    var input_indices: ${n.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},kM=(n,e,t,i,r)=>{let[s,a,o,l,u]=t.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],c=n.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${c} {
      var input_indices: ${n.type.indices};
      ${n.indicesSet("input_indices",a,`max(0, min(depth, ${t[a]} - 1))`)};
      ${n.indicesSet("input_indices",o,`max(0, min(height, ${t[o]} - 1))`)};
      ${n.indicesSet("input_indices",l,`max(0, min(width, ${t[l]} - 1))`)};
      ${ZE(n,u,s,3)}
      return ${n.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${e.type.indices}) -> ${c} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${c} = originalIndices[${a}];
      var height:${c} = originalIndices[${o}];
      var width:${c} = originalIndices[${l}];
      ${i?`if (depth < 0 || depth > (${t[a]} - 1) || height < 0 || height > (${t[o]} - 1) || width < 0 || (width > ${t[l]} - 1)) {
      return ${r};
        }`:""};

    depth = max(0, min(depth, ${t[a]} - 1));
      height = max(0, min(height, ${t[o]} - 1));
      width = max(0, min(width, ${t[l]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${t.length>3?`u32(originalIndices[${u}])`:"0"};
      var batch: u32 =  ${t.length>3?`u32(originalIndices[${s}])`:"0"};

      var x111: ${c} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${c} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${c} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${c} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${c} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${c} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${c} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${c} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${c} = abs(depth - ${c}(depth1));
      var dx2: ${c} = abs(${c}(depth2) - depth);
      var dy1: ${c} = abs(height - ${c}(height1));
      var dy2: ${c} = abs(${c}(height2) - height);
      var dz1: ${c} = abs(width - ${c}(width1));
      var dz2: ${c} = abs(${c}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},$M=(n,e,t,i,r,s)=>{let a=n.dims,o=bM(s,e.axes,a.length),l=xM(a,i,r,e.axes),u=i.slice();i.length===0&&(u=a.map((w,E)=>w===0?1:l[E]/w),e.keepAspectRatioPolicy!=="stretch"&&(l=EM(a,u,e)));let c=Te("output",n.dataType,l.length),h=le("input",n.dataType,a.length),f=ie.size(l),m=a.length===l.length&&a.every((w,E)=>w===l[E]),y=e.coordinateTransformMode==="tf_crop_and_resize",_=e.extrapolationValue,x=h.type.value,v=w=>`
      ${m?"":`
      ${vM(e.coordinateTransformMode,x)};
      ${(()=>{switch(e.mode){case"nearest":return`
              ${SM(h,a)};
              ${wM(e.nearestMode,t,x)};
              ${TM(h,c,a,l,u.length,o.length,y)};
              `;case"linear":return`
              ${AM(c,a,l,u.length,o.length)};
              ${(()=>{if(a.length===2||a.length===4)return`${IM(h,c,a,y,_)}`;if(a.length===3||a.length===5)return`${kM(h,c,a,y,_)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(a.length===2||a.length===4)return`${CM(h,c,a,l,u,o,e.cubicCoeffA,y,e.extrapolationValue,e.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${w.registerUniform("output_size","u32").registerUniform("scales","f32",u.length).registerUniform("roi","f32",o.length).declareVariables(h,c)}
      ${w.mainStart()}
        ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${m?"output[global_idx] = input[global_idx];":`
        let output_indices = ${c.offsetToIndices("global_idx")};
        var input_indices: ${h.type.indices};
        ${(()=>{switch(e.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${h.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${e.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${a.length===2||a.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${e.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${e.cacheKey}|${t}|${u.length>0?e.mode==="cubic"?u:u.length:""}|${r.length>0?r:""}|${o.length>0?o:""}|${m}|${e.mode==="nearest"?a.length:a}`,inputDependencies:["rank"]},getShaderSource:v,getRunData:()=>({outputs:[{dims:l,dataType:n.dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:[{type:12,data:f},{type:1,data:u},{type:1,data:o},...Re(a,l)]})}},RM=n=>{let e=n.customDataBuffer;return new Uint32Array(e,e.byteOffset,1)[0]},LB=(n,e)=>{let t=[],i=[],r=[],s=RM(n);if(e.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");_M(n.inputs,e,s,t,i,r),n.compute($M(n.inputs[0],e,s,t,i,r),{inputs:[0]})},FB=n=>{let e=n.antialias,t=n.axes,i=n.coordinateTransformMode,r=n.cubicCoeffA,s=n.excludeOutside!==0,a=n.extrapolationValue,o=n.keepAspectRatioPolicy,l=n.mode,u=n.nearestMode===""?"simple":n.nearestMode;return ht({antialias:e,axes:t,coordinateTransformMode:i,cubicCoeffA:r,excludeOutside:s,extrapolationValue:a,keepAspectRatioPolicy:o,mode:l,nearestMode:u})}}),PM,NM,zB,AZ=fe(()=>{Oe(),je(),Be(),PM=n=>{if(!n||n.length<3)throw new Error("layerNorm requires at least 3 inputs.");let e=n[0],t=n[1],i=n[2];if(e.dataType!==t.dataType||e.dataType!==i.dataType)throw new Error("All inputs must have the same data type");if(e.dims.length!==3&&e.dims.length!==2)throw new Error("Input must be 2D or 3D");if(t.dims.length!==3&&t.dims.length!==2)throw new Error("Skip must be 2D or 3D");let r=e.dims[e.dims.length-1],s=e.dims[e.dims.length-2];if(t.dims[t.dims.length-1]!==r)throw new Error("Skip must have the same hidden size as input");if(t.dims[t.dims.length-2]!==s)throw new Error("Skip must have the same sequence length as input");if(i.dims.length!==1)throw new Error("Gamma must be 1D");if(i.dims[i.dims.length-1]!==r)throw new Error("Gamma must have the same hidden size as input");if(n.length>3){let a=n[3];if(a.dims.length!==1)throw new Error("Beta must be 1D");if(a.dims[a.dims.length-1]!==r)throw new Error("Beta must have the same hidden size as input")}if(n.length>4){let a=n[4];if(a.dims.length!==1)throw new Error("Bias must be 1D");if(a.dims[a.dims.length-1]!==r)throw new Error("Bias must have the same hidden size as input")}},NM=(n,e,t,i)=>{let r=e.simplified,s=n[0].dims,a=ie.size(s),o=s,l=a,u=s.slice(-1)[0],c=i?s.slice(0,-1).concat(1):[],h=!r&&n.length>3,f=n.length>4,m=i&&t>1,y=i&&t>2,_=t>3,x=64,v=Wt(u),w=[{type:12,data:l},{type:12,data:v},{type:12,data:u},{type:1,data:e.epsilon}],E=D=>{let V=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],I=[le("x",n[0].dataType,n[0].dims,v),le("skip",n[1].dataType,n[1].dims,v),le("gamma",n[2].dataType,n[2].dims,v)];h&&I.push(le("beta",n[3].dataType,n[3].dims,v)),f&&I.push(le("bias",n[4].dataType,n[4].dims,v)),I.push(Te("output",n[0].dataType,o,v)),m&&I.push(Te("mean_output",1,c)),y&&I.push(Te("inv_std_output",1,c)),_&&I.push(Te("input_skip_bias_sum",n[0].dataType,o,v));let k=$n(n[0].dataType),N=$n(1,v);return`

      ${D.registerUniforms(V).declareVariables(...I)}
      var<workgroup> sum_shared : array<${N}, ${x}>;
      var<workgroup> sum_squared_shared : array<${N}, ${x}>;

      ${D.mainStart([x,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${x};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${x};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${x-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${f?"bias[offset1d + i]":k+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${_?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${Kh(k,v,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${x};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${Au("sum",v)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${Au("square_sum",v)} / f32(uniforms.hidden_size) ${r?"":"- mean * mean"} + uniforms.epsilon);
        ${m?"mean_output[global_idx] = mean;":""}
        ${y?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${r?"":`- ${k}(mean)`}) *
            ${k}(inv_std_dev) * gamma[offset1d + i]
            ${h?"+ beta[offset1d + i]":""};
        }
      }`},C=[{dims:o,dataType:n[0].dataType}];return t>1&&C.push({dims:c,dataType:1}),t>2&&C.push({dims:c,dataType:1}),t>3&&C.push({dims:s,dataType:n[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${v};${m};${y};${_}`,inputDependencies:n.map((D,V)=>"type")},getShaderSource:E,getRunData:()=>({outputs:C,dispatchGroup:{x:Math.ceil(l/u)},programUniforms:w})}},zB=(n,e)=>{PM(n.inputs);let t=[0];n.outputCount>1&&t.push(-3),n.outputCount>2&&t.push(-3),n.outputCount>3&&t.push(3),n.compute(NM(n.inputs,e,n.outputCount,!1),{outputs:t})}}),DM,Fm,MM,eA,OM,LM,VB,jB,TZ=fe(()=>{Oe(),je(),Zt(),Be(),DM=(n,e)=>{if(!n||n.length<1)throw new Error("too few inputs");if(e.axes.length!==0){if(e.axes.length!==e.starts.length||e.axes.length!==e.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(e.starts.length!==e.ends.length)throw new Error("starts and ends must have the same length");n.slice(1).forEach((t,i)=>{if(n[i+1].dataType!==6&&n[i+1].dataType!==7)throw new Error(`Input ${i} must be an array of int32 or int64`)})},Fm=(n,e)=>{let t=[];if(n.length>e)if(n[e].dataType===7)n[e].getBigInt64Array().forEach(i=>t.push(Number(i)));else if(n[e].dataType===6)n[e].getInt32Array().forEach(i=>t.push(Number(i)));else throw new Error(`Input ${e} must be an array of int32 or int64`);return t},MM=(n,e)=>{if(n.length>1){let t=Fm(n,1),i=Fm(n,2),r=Fm(n,3);return r.length===0&&(r=[...Array(n[0].dims.length).keys()]),ht({starts:t,ends:i,axes:r})}else return e},eA=(n,e,t,i,r)=>{let s=n;return n<0&&(s+=t[i[e]]),r[e]<0?Math.max(0,Math.min(s,t[i[e]]-1)):Math.max(0,Math.min(s,t[i[e]]))},OM=(n,e,t)=>`fn calculateInputIndices(output_indices: ${e.type.indices}) -> ${n.type.indices} {
          var input_indices: ${n.type.indices};
          var carry = 0u;
          for (var i = ${t.length-1}; i >= 0; i--) {
            let input_shape_i = ${$e("uniforms.input_shape","i",t.length)};
            let steps_i = ${$e("uniforms.steps","i",t.length)};
            let signs_i = ${$e("uniforms.signs","i",t.length)};
            let starts_i = ${$e("uniforms.starts","i",t.length)};
            var output_index = ${e.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${n.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,LM=(n,e)=>{let t=n[0].dims,i=ie.size(t),r=e.axes.length>0?ie.normalizeAxes(e.axes,t.length):[...Array(t.length).keys()],s=Fm(n,4);s.forEach(v=>v!==0||(()=>{throw new Error("step cannot be 0")})),s.length===0&&(s=Array(r.length).fill(1));let a=e.starts.map((v,w)=>eA(v,w,t,r,s)),o=e.ends.map((v,w)=>eA(v,w,t,r,s));if(r.length!==a.length||r.length!==o.length)throw new Error("start, ends and axes should have the same number of elements");if(r.length!==t.length)for(let v=0;v<t.length;++v)r.includes(v)||(a.splice(v,0,0),o.splice(v,0,t[v]),s.splice(v,0,1));let l=s.map(v=>Math.sign(v));s.forEach((v,w,E)=>{if(v<0){let C=(o[w]-a[w])/v,D=a[w],V=D+C*s[w];a[w]=V,o[w]=D,E[w]=-v}});let u=t.slice(0);r.forEach((v,w)=>{u[v]=Math.ceil((o[v]-a[v])/s[v])});let c={dims:u,dataType:n[0].dataType},h=Te("output",n[0].dataType,u.length),f=le("input",n[0].dataType,n[0].dims.length),m=ie.size(u),y=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:a.length},{name:"signs",type:"i32",length:l.length},{name:"steps",type:"u32",length:s.length}],_=[{type:12,data:m},{type:12,data:a},{type:6,data:l},{type:12,data:s},...Re(n[0].dims,u)],x=v=>`
      ${v.registerUniforms(y).declareVariables(f,h)}
        ${OM(f,h,t)}
        ${v.mainStart()}
          ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${h.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${h.setByOffset("global_idx",f.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${l.length}_${a.length}_${s.length}`,inputDependencies:["rank"]},getShaderSource:x,getRunData:()=>({outputs:[c],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:_})}},VB=(n,e)=>{DM(n.inputs,e);let t=MM(n.inputs,e);n.compute(LM(n.inputs,t),{inputs:[0]})},jB=n=>{let e=n.starts,t=n.ends,i=n.axes;return ht({starts:e,ends:t,axes:i})}}),FM,zM,BB,UB,SZ=fe(()=>{Oe(),je(),Zt(),Mu(),Be(),FM=n=>{if(!n||n.length!==1)throw new Error("Softmax op requires 1 input.")},zM=(n,e)=>{let t=n.inputs[0],i=t.dims,r=ie.size(i),s=i.length,a=ie.normalizeAxis(e.axis,s),o=a<i.length-1,l,u=[];o?(u=Array.from({length:s},(I,k)=>k),u[a]=s-1,u[s-1]=a,l=n.compute(kr(t,u),{inputs:[t],outputs:[-1]})[0]):l=t;let c=l.dims,h=c[s-1],f=r/h,m=Wt(h),y=h/m,_=64;f===1&&(_=256);let x=(I,k)=>k===4?`max(max(${I}.x, ${I}.y), max(${I}.z, ${I}.w))`:k===2?`max(${I}.x, ${I}.y)`:k===3?`max(max(${I}.x, ${I}.y), ${I}.z)`:I,v=le("x",l.dataType,l.dims,m),w=Te("result",l.dataType,l.dims,m),E=v.type.value,C=$n(l.dataType)==="f32"?`var threadMax = ${E}(-3.402823e+38f);`:`var threadMax = ${E}(-65504.0h);`,D=I=>`
      var<workgroup> rowMaxShared : ${E};
      var<workgroup> rowSumShared : ${E};
      var<workgroup> threadShared : array<${E}, ${_}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${E} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${E}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${I.registerUniform("packedCols","i32").declareVariables(v,w)}
      ${I.mainStart(_)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${_};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${C}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${E}(${x("threadShared[0]",m)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${E}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${E}(${Au("threadShared[0]",m)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          var value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          // max operation protects against NaN since all values should be >=0
          value = max(value, ${E}(0.0));
          setValue(row, col, row_stride, value);
        }
      }`,V=n.compute({name:"Softmax",shaderCache:{hint:`${m};${_}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:c,dataType:l.dataType}],dispatchGroup:{x:f},programUniforms:[{type:6,data:y}]}),getShaderSource:D},{inputs:[l],outputs:[o?-1:0]})[0];o&&n.compute(kr(V,u),{inputs:[V]})},BB=(n,e)=>{FM(n.inputs),zM(n,e)},UB=n=>ht({axis:n.axis})}),tA,VM,jM,BM,HB,IZ=fe(()=>{Oe(),je(),Be(),tA=n=>Array.from(n.getBigInt64Array(),Number),VM=n=>{if(!n||n.length!==2)throw new Error("Tile requires 2 inputs.");if(n[0].dataType!==1&&n[0].dataType!==10&&n[0].dataType!==6&&n[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(n[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(n[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(tA(n[1]).length!==n[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},jM=(n,e)=>{let t=[];for(let i=0;i<n.length;++i)t.push(n[i]*e[i]);return t},BM=(n,e)=>{let t=n[0].dims,i=e??tA(n[1]),r=jM(t,i),s=ie.size(r),a=n[0].dataType,o=le("input",a,t.length),l=Te("output",a,r.length),u=c=>`
      const inputShape = ${o.indices(...t)};
      ${c.registerUniform("output_size","u32").declareVariables(o,l)}
      ${c.mainStart()}
      ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${l.offsetToIndices("global_idx")};
      var input_indices: ${o.type.indices};
      for (var i = 0; i < ${t.length}; i++) {
        let input_dim_i = ${o.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${l.indicesGet("output_indices","i")}  % input_dim_i;

        ${o.indicesSet("input_indices","i","input_dim_value")}
      }
      ${l.setByOffset("global_idx",o.getByIndices("input_indices"))}
    }`;return{name:"Tile",shaderCache:{hint:`${i}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:r,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:[{type:12,data:s},...Re(n[0].dims,r)]}),getShaderSource:u}},HB=n=>{VM(n.inputs),n.compute(BM(n.inputs),{inputs:[0]})}}),UM,HM,WB,CZ=fe(()=>{Oe(),je(),Be(),UM=(n,e,t,i,r)=>{let s=Te("output_data",r,t.length,4),a=le("a_data",e[1].dataType,e[1].dims.length,4),o=le("b_data",e[2].dataType,e[2].dims.length,4),l=le("c_data",e[0].dataType,e[0].dims.length,4),u,c=(h,f,m)=>`select(${f}, ${h}, ${m})`;if(!i)u=s.setByOffset("global_idx",c(a.getByOffset("global_idx"),o.getByOffset("global_idx"),l.getByOffset("global_idx")));else{let h=(f,m,y="")=>{let _=`a_data[index_a${m}][component_a${m}]`,x=`b_data[index_b${m}][component_b${m}]`,v=`bool(c_data[index_c${m}] & (0xffu << (component_c${m} * 8)))`;return`
            let output_indices${m} = ${s.offsetToIndices(`global_idx * 4u + ${m}u`)};
            let offset_a${m} = ${a.broadcastedIndicesToOffset(`output_indices${m}`,s)};
            let offset_b${m} = ${o.broadcastedIndicesToOffset(`output_indices${m}`,s)};
            let offset_c${m} = ${l.broadcastedIndicesToOffset(`output_indices${m}`,s)};
            let index_a${m} = offset_a${m} / 4u;
            let index_b${m} = offset_b${m} / 4u;
            let index_c${m} = offset_c${m} / 4u;
            let component_a${m} = offset_a${m} % 4u;
            let component_b${m} = offset_b${m} % 4u;
            let component_c${m} = offset_c${m} % 4u;
            ${f}[${m}] = ${y}(${c(_,x,v)});
          `};r===9?u=`
            var data = vec4<u32>(0);
            ${h("data",0,"u32")}
            ${h("data",1,"u32")}
            ${h("data",2,"u32")}
            ${h("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:u=`
            ${h("output_data[global_idx]",0)}
            ${h("output_data[global_idx]",1)}
            ${h("output_data[global_idx]",2)}
            ${h("output_data[global_idx]",3)}
          `}return`
        ${n.registerUniform("vec_size","u32").declareVariables(l,a,o,s)}
        ${n.mainStart()}
        ${n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${u}
      }`},HM=n=>{let e=n[1].dims,t=n[2].dims,i=n[0].dims,r=n[1].dataType,s=!(ie.areEqual(e,t)&&ie.areEqual(t,i)),a=e,o=ie.size(e);if(s){let u=Rp.calcShape(Rp.calcShape(e,t,!1),i,!1);if(!u)throw new Error("Can't perform where op on the given tensors");a=u,o=ie.size(a)}let l=Math.ceil(o/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:u=>UM(u,n,a,s,r),getRunData:()=>({outputs:[{dims:a,dataType:r}],dispatchGroup:{x:Math.ceil(o/64/4)},programUniforms:[{type:12,data:l},...Re(i,e,t,a)]})}},WB=n=>{n.compute(HM(n.inputs))}}),qB,kZ=fe(()=>{UJ(),_C(),HJ(),WJ(),qJ(),GJ(),KJ(),ZJ(),tZ(),nZ(),iZ(),rZ(),sZ(),aZ(),oZ(),lZ(),uZ(),cZ(),dZ(),hZ(),fZ(),pZ(),mZ(),gZ(),yZ(),dB(),_Z(),vZ(),wZ(),bZ(),xZ(),yC(),EZ(),gB(),AZ(),TZ(),SZ(),pB(),IZ(),Mu(),vC(),CZ(),qB=new Map([["Abs",[zV]],["Acos",[VV]],["Acosh",[jV]],["Add",[bj]],["ArgMax",[MV,jT]],["ArgMin",[DV,jT]],["Asin",[BV]],["Asinh",[UV]],["Atan",[HV]],["Atanh",[WV]],["Attention",[OV]],["AveragePool",[TB,AB]],["BatchNormalization",[LV]],["BiasAdd",[FV]],["BiasSplitGelu",[wj]],["Cast",[GV,qV]],["Ceil",[YV]],["Clip",[KV]],["Concat",[Rj,Pj]],["Conv",[GT,qT]],["ConvTranspose",[Bj,jj]],["Cos",[XV]],["Cosh",[QV]],["CumSum",[Uj,Hj]],["DepthToSpace",[Wj,qj]],["DequantizeLinear",[PB,NB]],["Div",[xj]],["Einsum",[Gj,Kj]],["Elu",[JV,sg]],["Equal",[Ej]],["Erf",[ZV]],["Exp",[ej]],["Expand",[Yj]],["FastGelu",[Xj]],["Floor",[tj]],["FusedConv",[GT,qT]],["Gather",[Jj,Qj]],["GatherElements",[rB,iB]],["GatherBlockQuantized",[tB,nB]],["GatherND",[Zj,eB]],["Gelu",[nj]],["Gemm",[aB,sB]],["GlobalAveragePool",[IB,SB]],["GlobalMaxPool",[RB,$B]],["Greater",[Ij]],["GreaterOrEqual",[kj]],["GridSample",[oB,lB]],["GroupQueryAttention",[yB]],["HardSigmoid",[cj,uj]],["InstanceNormalization",[_B]],["LayerNormalization",[vB]],["LeakyRelu",[ij,sg]],["Less",[Cj]],["LessOrEqual",[$j]],["Log",[_j]],["MatMul",[wB]],["MatMulNBits",[bB,xB]],["MaxPool",[CB,kB]],["Mul",[Aj]],["MultiHeadAttention",[cB,uB]],["Neg",[sj]],["Not",[rj]],["Pad",[EB]],["Pow",[Tj]],["QuickGelu",[vj,sg]],["Range",[DB]],["Reciprocal",[aj]],["ReduceMin",[kV]],["ReduceMean",[AV]],["ReduceMax",[CV]],["ReduceSum",[RV]],["ReduceProd",[$V]],["ReduceL1",[TV]],["ReduceL2",[SV]],["ReduceLogSum",[NV]],["ReduceLogSumExp",[IV]],["ReduceSumSquare",[PV]],["Relu",[oj]],["Resize",[LB,FB]],["RotaryEmbedding",[mB]],["ScatterND",[OB,MB]],["Sigmoid",[lj]],["Sin",[dj]],["Sinh",[hj]],["Slice",[VB,jB]],["SkipLayerNormalization",[zB]],["Split",[hB,fB]],["Sqrt",[fj]],["Softmax",[BB,UB]],["Sub",[Sj]],["Tan",[pj]],["Tanh",[mj]],["ThresholdedRelu",[yj,sg]],["Tile",[HB]],["Transpose",[hV,fV]],["Where",[WB]]])}),GB,$Z=fe(()=>{ts(),el(),Be(),GB=class{constructor(n){this.backend=n,this.repo=new Map,this.attributesBound=!1}getArtifact(n){return this.repo.get(n)}setArtifact(n,e){this.repo.set(n,e)}run(n,e,t,i,r){Va(n.programInfo.name);let s=this.backend.device,a=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let o=[];for(let u of e)o.push({binding:o.length,resource:{buffer:u.buffer}});for(let u of t)o.push({binding:o.length,resource:{buffer:u.buffer}});r&&o.push({binding:o.length,resource:r});let l=s.createBindGroup({layout:n.computePipeline.getBindGroupLayout(0),entries:o,label:n.programInfo.name});if(this.backend.sessionStatus==="capturing"){let u={kernelId:this.backend.currentKernelId,computePipeline:n.computePipeline,bindGroup:l,dispatchGroup:i};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(u)}a.setPipeline(n.computePipeline),a.setBindGroup(0,l),a.dispatchWorkgroups(...i),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),Bs(n.programInfo.name)}dispose(){}build(n,e){Va(n.name);let t=this.backend.device,i=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(u=>{t.features.has(u.feature)&&i.push(`enable ${u.extension};`)});let r=dV(e,this.backend.device.limits),s=n.getShaderSource(r),a=`${i.join(`
`)}
${r.additionalImplementations}
${s}`,o=t.createShaderModule({code:a,label:n.name});et("verbose",()=>`[WebGPU] ${n.name} shader code: ${a}`);let l=t.createComputePipeline({compute:{module:o,entryPoint:"main"},layout:"auto",label:n.name});return Bs(n.name),{programInfo:n,computePipeline:l,uniformVariablesInfo:r.variablesInfo}}normalizeDispatchGroupSize(n){let e=typeof n=="number"?n:n.x,t=typeof n=="number"?1:n.y||1,i=typeof n=="number"?1:n.z||1,r=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(e<=r&&t<=r&&i<=r)return[e,t,i];let s=e*t*i,a=Math.ceil(Math.sqrt(s));if(a>r){if(a=Math.ceil(Math.cbrt(s)),a>r)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[a,a,a]}else return[a,a,1]}}}),KB={};Wp(KB,{WebGpuBackend:()=>YB});var WM,qM,GM,YB,RZ=fe(()=>{ts(),Oe(),el(),aV(),jJ(),kZ(),$Z(),WM=(n,e)=>{if(e.length!==n.length)throw new Error(`inputDependencies length ${e.length} is not equal to inputTensors length ${n.length}.`);let t=[];for(let i=0;i<n.length;++i){let r=n[i].dataType;switch(e[i]){case"none":{t.push("");break}case"type":{t.push(`${r}`);break}case"rank":{let s=n[i].dims.length;t.push(`${r};${s}`);break}case"dims":{let s=n[i].dims.join(",");t.push(`${r};${s}`);break}default:throw new Error(`unsupported input dependency: ${e[i]}`)}}return t.join("|")},qM=(n,e,t)=>{var r,s;let i=n.name;return(r=n.shaderCache)!=null&&r.hint&&(i+="["+n.shaderCache.hint+"]"),i+=":"+t+`:${WM(e,((s=n.shaderCache)==null?void 0:s.inputDependencies)??new Array(e.length).fill("dims"))}`,i},GM=class{constructor(n){n&&(this.architecture=n.architecture,this.vendor=n.vendor)}isArchitecture(n){return this.architecture===n}isVendor(n){return this.vendor===n}},YB=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let n=this.kernelCustomData.get(this.currentKernelId);return n||(n={},this.kernelCustomData.set(this.currentKernelId,n)),n}async initialize(n,e){this.env=n;let t=[],i={requiredLimits:{maxComputeWorkgroupStorageSize:e.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:e.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:e.limits.maxStorageBufferBindingSize,maxBufferSize:e.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:e.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:e.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:e.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:e.limits.maxComputeWorkgroupSizeZ},requiredFeatures:t},r=s=>e.features.has(s)&&t.push(s)&&!0;r("chromium-experimental-timestamp-query-inside-passes")||r("timestamp-query"),r("shader-f16"),r("subgroups"),this.device=await e.requestDevice(i),this.adapterInfo=new GM(e.info||await e.requestAdapterInfo()),this.gpuDataManager=uV(this),this.programManager=new GB(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,fC(n.logLevel,!!n.debug),this.device.onuncapturederror=s=>{s.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${s.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:e,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let n=this.getCommandEncoder(),e={};this.queryType==="at-passes"&&(e.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=n.beginComputePass(e)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;Va(),this.endComputePass();let n;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),n=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(n,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,n,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&n.mapAsync(GPUMapMode.READ).then(()=>{var i;let e=new BigUint64Array(n.getMappedRange()),t=this.pendingQueries.get(n);for(let r=0;r<e.length/2;r++){let s=t[r],a=s.kernelId,o=this.kernels.get(a),l=o.kernelType,u=o.kernelName,c=s.programName,h=s.inputTensorViews,f=s.outputTensorViews,m=e[r*2],y=e[r*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=m);let _=Number(m-this.queryTimeBase),x=Number(y-this.queryTimeBase);if(!Number.isSafeInteger(_)||!Number.isSafeInteger(x))throw new RangeError("incorrect timestamp range");if((i=this.env.webgpu.profiling)!=null&&i.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:h.map(v=>({dims:v.dims,dataType:Ro(v.dataType)})),outputsMetadata:f.map(v=>({dims:v.dims,dataType:Ro(v.dataType)})),kernelId:a,kernelType:l,kernelName:u,programName:c,startTime:_,endTime:x});else{let v="";h.forEach((E,C)=>{v+=`input[${C}]: [${E.dims}] | ${Ro(E.dataType)}, `});let w="";f.forEach((E,C)=>{w+=`output[${C}]: [${E.dims}] | ${Ro(E.dataType)}, `}),console.log(`[profiling] kernel "${a}|${l}|${u}|${c}" ${v}${w}start time: ${_} ns, execution time: ${x-_} ns`)}$b("GPU",`${c}::${m}::${y}`)}n.unmap(),this.pendingQueries.delete(n)}),Bs()}run(n,e,t,i,r,s){Va(n.name);let a=[];for(let w=0;w<e.length;++w){let E=e[w].data;if(E===0)continue;let C=this.gpuDataManager.get(E);if(!C)throw new Error(`no GPU data for input: ${E}`);a.push(C)}let{outputs:o,dispatchGroup:l,programUniforms:u}=n.getRunData(e),c=t.length===0?o.map((w,E)=>E):t;if(c.length!==o.length)throw new Error(`Output size ${c.length} must be equal to ${o.length}.`);let h=[],f=[];for(let w=0;w<o.length;++w){if(!Number.isInteger(c[w])||c[w]<-3||c[w]>=s)throw new Error(`Invalid output index: ${c[w]}`);if(c[w]===-3)continue;let E=c[w]===-1,C=c[w]===-2,D=E||C?r(o[w].dataType,o[w].dims):i(c[w],o[w].dataType,o[w].dims);if(h.push(D),D.data===0)continue;let V=this.gpuDataManager.get(D.data);if(!V)throw new Error(`no GPU data for output: ${D.data}`);if(E&&this.temporaryData.push(V),C){let I=this.kernelPersistentData.get(this.currentKernelId);I||(I=[],this.kernelPersistentData.set(this.currentKernelId,I)),I.push(V)}f.push(V)}if(a.length!==e.length||f.length!==h.length){if(f.length===0)return Bs(n.name),h;throw new Error(`Program ${n.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let m;if(u){let w=0,E=[];u.forEach(I=>{let k=typeof I.data=="number"?[I.data]:I.data;if(k.length===0)return;let N=I.type===10?2:4,L,j;I.type===10?(j=k.length>4?16:k.length>2?8:k.length*N,L=k.length>4?16:N*k.length):(j=k.length<=2?k.length*N:16,L=16),w=Math.ceil(w/j)*j,E.push(w);let H=I.type===10?8:4;w+=k.length>4?Math.ceil(k.length/H)*L:k.length*N});let C=16;w=Math.ceil(w/C)*C;let D=new ArrayBuffer(w);u.forEach((I,k)=>{let N=E[k],L=typeof I.data=="number"?[I.data]:I.data;if(I.type===6)new Int32Array(D,N,L.length).set(L);else if(I.type===12)new Uint32Array(D,N,L.length).set(L);else if(I.type===10)new Uint16Array(D,N,L.length).set(L);else if(I.type===1)new Float32Array(D,N,L.length).set(L);else throw new Error(`Unsupported uniform type: ${Ro(I.type)}`)});let V=this.gpuDataManager.create(w,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(V.buffer,0,D,0,w),this.gpuDataManager.release(V.id),m={offset:0,size:w,buffer:V.buffer}}let y=this.programManager.normalizeDispatchGroupSize(l),_=y[1]===1&&y[2]===1,x=qM(n,e,_),v=this.programManager.getArtifact(x);if(v||(v=this.programManager.build(n,y),this.programManager.setArtifact(x,v),et("info",()=>`[artifact] key: ${x}, programName: ${n.name}`)),u&&v.uniformVariablesInfo){if(u.length!==v.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${v.uniformVariablesInfo.length}, got ${u.length} in program "${v.programInfo.name}".`);for(let w=0;w<u.length;w++){let E=u[w],C=E.type,D=typeof E.data=="number"?1:E.data.length,[V,I]=v.uniformVariablesInfo[w];if(C!==V||D!==I)throw new Error(`Uniform variable ${w} mismatch: expect type ${V} with size ${I}, got type ${C} with size ${D} in program "${v.programInfo.name}".`)}}if(et("info",()=>`[ProgramManager] run "${n.name}" (key=${x}) with ${y[0]}x${y[1]}x${y[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let w={kernelId:this.currentKernelId,programName:v.programInfo.name,inputTensorViews:e,outputTensorViews:h};this.pendingKernels.push(w),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push(w)}return this.programManager.run(v,a,f,y,m),Bs(n.name),h}upload(n,e){this.gpuDataManager.upload(n,e)}memcpy(n,e){this.gpuDataManager.memcpy(n,e)}async download(n,e){await this.gpuDataManager.download(n,e)}alloc(n){return this.gpuDataManager.create(n).id}free(n){return this.gpuDataManager.release(n)}createKernel(n,e,t,i){let r=qB.get(n);if(!r)throw new Error(`kernel not implemented: ${n}`);let s={kernelType:n,kernelName:i,kernelEntry:r[0],attributes:[r[1],t]};this.kernels.set(e,s)}releaseKernel(n){let e=this.kernelPersistentData.get(n);if(e){for(let t of e)this.gpuDataManager.release(t.id);this.kernelPersistentData.delete(n)}this.kernelCustomData.delete(n),this.kernels.delete(n)}computeKernel(n,e,t){let i=this.kernels.get(n);if(!i)throw new Error(`kernel not created: ${n}`);let r=i.kernelType,s=i.kernelName,a=i.kernelEntry,o=i.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${r}] ${s}" is not allowed to be called recursively`);this.currentKernelId=n,o[0]&&(o[1]=o[0](o[1]),o[0]=void 0),et("info",()=>`[WebGPU] Start to run kernel "[${r}] ${s}"...`);let l=this.env.debug;this.temporaryData=[];try{return l&&this.device.pushErrorScope("validation"),a(e,o[1]),0}catch(u){return t.push(Promise.resolve(`[WebGPU] Kernel "[${r}] ${s}" failed. ${u}`)),1}finally{l&&t.push(this.device.popErrorScope().then(u=>u?`GPU validation error for kernel "[${r}] ${s}": ${u.message}`:null));for(let u of this.temporaryData)this.gpuDataManager.release(u.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(n,e,t,i){let r=this.sessionExternalDataMapping.get(n);r||(r=new Map,this.sessionExternalDataMapping.set(n,r));let s=r.get(e),a=this.gpuDataManager.registerExternalBuffer(t,i,s);return r.set(e,[a,t]),a}unregisterBuffers(n){let e=this.sessionExternalDataMapping.get(n);e&&(e.forEach(t=>this.gpuDataManager.unregisterExternalBuffer(t[0])),this.sessionExternalDataMapping.delete(n))}getBuffer(n){let e=this.gpuDataManager.get(n);if(!e)throw new Error(`no GPU data for buffer: ${n}`);return e.buffer}createDownloader(n,e,t){return async()=>{let i=await FT(this,n,e);return pC(i.buffer,t)}}writeTimestamp(n){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,n)}setQueryType(){var n;this.queryType="none",(((n=this.env.webgpu.profiling)==null?void 0:n.mode)==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){et("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){et("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){et("info","replay"),this.sessionStatus="replaying";let n=this.capturedCommandList.get(this.currentSessionId),e=this.capturedPendingKernels.get(this.currentSessionId),t=n.length;this.pendingKernels=[];for(let i=0;i<t;i++){let r=this.getComputePassEncoder(),s=n[i];this.writeTimestamp(this.pendingDispatchNumber*2),r.setPipeline(s.computePipeline),r.setBindGroup(0,s.bindGroup),r.dispatchWorkgroups(...s.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(e[i]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(n){this.unregisterBuffers(n),this.capturedCommandList.has(n)&&this.capturedCommandList.delete(n),this.capturedPendingKernels.has(n)&&this.capturedPendingKernels.delete(n),this.gpuDataManager.onReleaseSession(n)}onRunStart(n){this.currentSessionId=n,this.setQueryType()}}}),XB={};Wp(XB,{init:()=>QB});var Rw,KM,QB,PZ=fe(()=>{Oe(),el(),je(),VJ(),Rw=class JB{constructor(e,t,i,r){this.module=e,this.dataType=t,this.data=i,this.dims=r}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let e=ie.size(this.dims);return e===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,e)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let e=ie.size(this.dims);return e===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,e)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let e=ie.size(this.dims);return e===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,e)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let e=ie.size(this.dims);return e===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,e)}reshape(e){if(ie.size(e)!==ie.size(this.dims))throw new Error("Invalid new shape");return new JB(this.module,this.dataType,this.data,e)}},KM=class{constructor(n,e,t){this.module=n,this.backend=e,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=e.adapterInfo;let i=n.PTR_SIZE,r=t/n.PTR_SIZE,s=i===4?"i32":"i64";this.opKernelContext=Number(n.getValue(i*r++,s));let a=Number(n.getValue(i*r++,s));this.outputCount=Number(n.getValue(i*r++,s)),this.customDataOffset=Number(n.getValue(i*r++,"*")),this.customDataSize=Number(n.getValue(i*r++,s));let o=[];for(let l=0;l<a;l++){let u=Number(n.getValue(i*r++,s)),c=Number(n.getValue(i*r++,"*")),h=Number(n.getValue(i*r++,s)),f=[];for(let m=0;m<h;m++)f.push(Number(n.getValue(i*r++,s)));o.push(new Rw(n,u,c,f))}this.inputs=o}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(n,e){var a;let t=((a=e==null?void 0:e.inputs)==null?void 0:a.map(o=>typeof o=="number"?this.inputs[o]:o))??this.inputs,i=(e==null?void 0:e.outputs)??[],r=(o,l,u)=>new Rw(this.module,l,this.output(o,u),u),s=(o,l)=>{let u=pc(o,l);if(!u)throw new Error(`Unsupported data type: ${o}`);let c=u>0?this.backend.gpuDataManager.create(u).id:0;return new Rw(this.module,o,c,l)};return this.backend.run(n,t,i,r,s,this.outputCount)}output(n,e){let t=this.module.stackSave();try{let i=this.module.PTR_SIZE,r=i===4?"i32":"i64",s=this.module.stackAlloc((1+e.length)*i);this.module.setValue(s,e.length,r);for(let a=0;a<e.length;a++)this.module.setValue(s+i*(a+1),e[a],r);return this.module._JsepOutput(this.opKernelContext,n,s)}catch(i){throw new Error(`Failed to generate kernel's output[${n}] with dims [${e}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${i}`)}finally{this.module.stackRestore(t)}}},QB=async(n,e,t,i)=>{let r=e.jsepInit;if(!r)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(n==="webgpu"){let s=(RZ(),_y(KB)).WebGpuBackend,a=new s;await a.initialize(t,i),r("webgpu",[a,o=>a.alloc(Number(o)),o=>a.free(o),(o,l,u,c=!1)=>{if(c)et("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(o)}, dst=${Number(l)}, size=${Number(u)}`),a.memcpy(Number(o),Number(l));else{et("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(o)}, gpuDataId=${Number(l)}, size=${Number(u)}`);let h=e.HEAPU8.subarray(Number(o>>>0),Number(o>>>0)+Number(u));a.upload(Number(l),h)}},async(o,l,u)=>{et("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${o}, dataOffset=${l}, size=${u}`),await a.download(Number(o),()=>e.HEAPU8.subarray(Number(l)>>>0,Number(l+u)>>>0))},(o,l,u)=>a.createKernel(o,Number(l),u,e.UTF8ToString(e._JsepGetNodeName(Number(l)))),o=>a.releaseKernel(o),(o,l,u,c)=>{et("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${u}, kernel=${o}, contextDataOffset=${l}`);let h=new KM(e,a,Number(l));return a.computeKernel(Number(o),h,c)},()=>a.captureBegin(),()=>a.captureEnd(),()=>a.replay()])}else{let s=new lV(t);r("webnn",[s,()=>s.reserveTensorId(),a=>s.releaseTensorId(a),async(a,o,l,u,c)=>s.ensureTensor(a,o,l,u,c),(a,o)=>{s.uploadTensor(a,o)},async(a,o)=>s.downloadTensor(a,o),(a,o)=>s.registerMLContext(a,o),!!t.trace])}}}),YM,TC,SC,dl,XM,nA,Lb,IC,CC,iA,kC,$C,RC,ZB=fe(()=>{ts(),LJ(),FJ(),Oe(),ih(),uC(),nV(),YM=(n,e)=>{St()._OrtInit(n,e)!==0&&_t("Can't initialize onnxruntime.")},TC=async n=>{YM(n.wasm.numThreads,Pb(n.logLevel))},SC=async(n,e)=>{var i,r;(r=(i=St()).asyncInit)==null||r.call(i);let t=n.webgpu.adapter;if(e==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(t){if(typeof t.limits!="object"||typeof t.features!="object"||typeof t.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let s=n.webgpu.powerPreference;if(s!==void 0&&s!=="low-power"&&s!=="high-performance")throw new Error(`Invalid powerPreference setting: "${s}"`);let a=n.webgpu.forceFallbackAdapter;if(a!==void 0&&typeof a!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${a}"`);if(t=await navigator.gpu.requestAdapter({powerPreference:s,forceFallbackAdapter:a}),!t)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(e==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");{let s=(PZ(),_y(XB)).init;e==="webgpu"&&await s("webgpu",St(),n,t),e==="webnn"&&await s("webnn",St(),n)}},dl=new Map,XM=n=>{let e=St(),t=e.stackSave();try{let i=e.PTR_SIZE,r=e.stackAlloc(2*i);e._OrtGetInputOutputCount(n,r,r+i)!==0&&_t("Can't get session input/output count.");let s=i===4?"i32":"i64";return[Number(e.getValue(r,s)),Number(e.getValue(r+i,s))]}finally{e.stackRestore(t)}},nA=(n,e)=>{let t=St(),i=t.stackSave(),r=0;try{let s=t.PTR_SIZE,a=t.stackAlloc(2*s);t._OrtGetInputOutputMetadata(n,e,a,a+s)!==0&&_t("Can't get session input/output metadata.");let o=Number(t.getValue(a,"*"));r=Number(t.getValue(a+s,"*"));let l=t.HEAP32[r/4];if(l===0)return[o,0];let u=t.HEAPU32[r/4+1],c=[];for(let h=0;h<u;h++){let f=Number(t.getValue(r+8+h*s,"*"));c.push(f!==0?t.UTF8ToString(f):Number(t.getValue(r+8+(h+u)*s,"*")))}return[o,l,c]}finally{t.stackRestore(i),r!==0&&t._OrtFree(r)}},Lb=n=>{let e=St(),t=e._malloc(n.byteLength);if(t===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${n.byteLength}.`);return e.HEAPU8.set(n,t),[t,n.byteLength]},IC=async(n,e)=>{var h,f,m,y;let t,i,r=St();Array.isArray(n)?[t,i]=n:n.buffer===r.HEAPU8.buffer?[t,i]=[n.byteOffset,n.byteLength]:[t,i]=Lb(n);let s=0,a=0,o=0,l=[],u=[],c=[];try{if([a,l]=await tV(e),(e==null?void 0:e.externalData)&&r.mountExternalData){let k=[];for(let N of e.externalData){let L=typeof N=="string"?N:N.path;k.push(hC(typeof N=="string"?N:N.data).then(j=>{r.mountExternalData(L,j)}))}await Promise.all(k)}for(let k of(e==null?void 0:e.executionProviders)??[])if((typeof k=="string"?k:k.name)==="webnn"){if(r.shouldTransferToMLTensor=!1,typeof k!="string"){let N=k,L=N==null?void 0:N.context,j=N==null?void 0:N.gpuDevice,H=N==null?void 0:N.deviceType,M=N==null?void 0:N.powerPreference;L?r.currentContext=L:j?r.currentContext=await r.webnnCreateMLContext(j):r.currentContext=await r.webnnCreateMLContext({deviceType:H,powerPreference:M})}else r.currentContext=await r.webnnCreateMLContext();break}s=await r._OrtCreateSession(t,i,a),(h=r.webgpuOnCreateSession)==null||h.call(r,s),s===0&&_t("Can't create a session."),(f=r.jsepOnCreateSession)==null||f.call(r),r.currentContext&&(r.webnnRegisterMLContext(s,r.currentContext),r.currentContext=void 0,r.shouldTransferToMLTensor=!0);let[_,x]=XM(s),v=!!(e!=null&&e.enableGraphCapture),w=[],E=[],C=[],D=[],V=[];for(let k=0;k<_;k++){let[N,L,j]=nA(s,k);N===0&&_t("Can't get an input name."),u.push(N);let H=r.UTF8ToString(N);w.push(H),C.push(L===0?{name:H,isTensor:!1}:{name:H,isTensor:!0,type:Ro(L),shape:j})}for(let k=0;k<x;k++){let[N,L,j]=nA(s,k+_);N===0&&_t("Can't get an output name."),c.push(N);let H=r.UTF8ToString(N);E.push(H),D.push(L===0?{name:H,isTensor:!1}:{name:H,isTensor:!0,type:Ro(L),shape:j});{if(v&&(e==null?void 0:e.preferredOutputLocation)===void 0){V.push("gpu-buffer");continue}let M=typeof(e==null?void 0:e.preferredOutputLocation)=="string"?e.preferredOutputLocation:((m=e==null?void 0:e.preferredOutputLocation)==null?void 0:m[H])??"cpu",se=r.webnnIsGraphOutput;if(M==="cpu"&&se&&se(s,H)){V.push("ml-tensor-cpu-output");continue}if(M!=="cpu"&&M!=="cpu-pinned"&&M!=="gpu-buffer"&&M!=="ml-tensor")throw new Error(`Not supported preferred output location: ${M}.`);if(v&&M!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${M}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);V.push(M)}}let I=null;return V.some(k=>k==="gpu-buffer"||k==="ml-tensor"||k==="ml-tensor-cpu-output")&&(o=r._OrtCreateBinding(s),o===0&&_t("Can't create IO binding."),I={handle:o,outputPreferredLocations:V,outputPreferredLocationsEncoded:V.map(k=>k==="ml-tensor-cpu-output"?"ml-tensor":k).map(k=>OT(k))}),dl.set(s,[s,u,c,I,v,!1]),[s,w,E,C,D]}catch(_){throw u.forEach(x=>r._OrtFree(x)),c.forEach(x=>r._OrtFree(x)),o!==0&&r._OrtReleaseBinding(o)!==0&&_t("Can't release IO binding."),s!==0&&r._OrtReleaseSession(s)!==0&&_t("Can't release session."),_}finally{r._free(t),a!==0&&r._OrtReleaseSessionOptions(a)!==0&&_t("Can't release session options."),l.forEach(_=>r._free(_)),(y=r.unmountExternalData)==null||y.call(r)}},CC=n=>{var l,u,c;let e=St(),t=dl.get(n);if(!t)throw new Error(`cannot release session. invalid session id: ${n}`);let[i,r,s,a,o]=t;a&&(o&&e._OrtClearBoundOutputs(a.handle)!==0&&_t("Can't clear bound outputs."),e._OrtReleaseBinding(a.handle)!==0&&_t("Can't release IO binding.")),(l=e.jsepOnReleaseSession)==null||l.call(e,n),(u=e.webnnOnReleaseSession)==null||u.call(e,n),(c=e.webgpuOnReleaseSession)==null||c.call(e,n),r.forEach(h=>e._OrtFree(h)),s.forEach(h=>e._OrtFree(h)),e._OrtReleaseSession(i)!==0&&_t("Can't release session."),dl.delete(n)},iA=async(n,e,t,i,r,s,a=!1)=>{if(!n){e.push(0);return}let o=St(),l=o.PTR_SIZE,u=n[0],c=n[1],h=n[3],f=h,m,y;if(u==="string"&&(h==="gpu-buffer"||h==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(a&&h!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${s} when enableGraphCapture is true.`);if(h==="gpu-buffer"){let v=n[2].gpuBuffer;y=pc(fc(u),c);{let w=o.jsepRegisterBuffer;if(!w)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');m=w(i,s,v,y)}}else if(h==="ml-tensor"){let v=n[2].mlTensor;y=pc(fc(u),c);let w=o.webnnRegisterMLTensor;if(!w)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');m=w(i,v,fc(u),c)}else{let v=n[2];if(Array.isArray(v)){y=l*v.length,m=o._malloc(y),t.push(m);for(let w=0;w<v.length;w++){if(typeof v[w]!="string")throw new TypeError(`tensor data at index ${w} is not a string`);o.setValue(m+w*l,Ns(v[w],t),"*")}}else{let w=o.webnnIsGraphInput,E=o.webnnIsGraphOutput;if(u!=="string"&&w&&E){let C=o.UTF8ToString(r);if(w(i,C)||E(i,C)){let D=fc(u);y=pc(D,c),f="ml-tensor";let V=o.webnnCreateTemporaryTensor,I=o.webnnUploadTensor;if(!V||!I)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let k=await V(i,D,c);I(k,new Uint8Array(v.buffer,v.byteOffset,v.byteLength)),m=k}else y=v.byteLength,m=o._malloc(y),t.push(m),o.HEAPU8.set(new Uint8Array(v.buffer,v.byteOffset,y),m)}else y=v.byteLength,m=o._malloc(y),t.push(m),o.HEAPU8.set(new Uint8Array(v.buffer,v.byteOffset,y),m)}}let _=o.stackSave(),x=o.stackAlloc(4*c.length);try{c.forEach((w,E)=>o.setValue(x+E*l,w,l===4?"i32":"i64"));let v=o._OrtCreateTensor(fc(u),m,y,x,c.length,OT(f));v===0&&_t(`Can't create tensor for input/output. session=${i}, index=${s}.`),e.push(v)}finally{o.stackRestore(_)}},kC=async(n,e,t,i,r,s)=>{var j,H,M,se;let a=St(),o=a.PTR_SIZE,l=dl.get(n);if(!l)throw new Error(`cannot run inference. invalid session id: ${n}`);let u=l[0],c=l[1],h=l[2],f=l[3],m=l[4],y=l[5],_=e.length,x=i.length,v=0,w=[],E=[],C=[],D=[],V=a.stackSave(),I=a.stackAlloc(_*o),k=a.stackAlloc(_*o),N=a.stackAlloc(x*o),L=a.stackAlloc(x*o);try{[v,w]=eV(s),Cd("wasm prepareInputOutputTensor");for(let J=0;J<_;J++)await iA(t[J],E,D,n,c[e[J]],e[J],m);for(let J=0;J<x;J++)await iA(r[J],C,D,n,h[i[J]],_+i[J],m);kd("wasm prepareInputOutputTensor");for(let J=0;J<_;J++)a.setValue(I+J*o,E[J],"*"),a.setValue(k+J*o,c[e[J]],"*");for(let J=0;J<x;J++)a.setValue(N+J*o,C[J],"*"),a.setValue(L+J*o,h[i[J]],"*");if(f&&!y){let{handle:J,outputPreferredLocations:q,outputPreferredLocationsEncoded:G}=f;if(c.length!==_)throw new Error(`input count from feeds (${_}) is expected to be always equal to model's input count (${c.length}).`);Cd("wasm bindInputsOutputs");for(let U=0;U<_;U++){let Y=e[U];await a._OrtBindInput(J,c[Y],E[U])!==0&&_t(`Can't bind input[${U}] for session=${n}.`)}for(let U=0;U<x;U++){let Y=i[U];(j=r[U])!=null&&j[3]?a._OrtBindOutput(J,h[Y],C[U],0)!==0&&_t(`Can't bind pre-allocated output[${U}] for session=${n}.`):a._OrtBindOutput(J,h[Y],0,G[Y])!==0&&_t(`Can't bind output[${U}] to ${q[U]} for session=${n}.`)}kd("wasm bindInputsOutputs"),dl.set(n,[u,c,h,f,m,!0])}(H=a.jsepOnRunStart)==null||H.call(a,u),(M=a.webnnOnRunStart)==null||M.call(a,u);let ue;f?ue=await a._OrtRunWithBinding(u,f.handle,x,N,v):ue=await a._OrtRun(u,k,I,_,L,x,N,v),ue!==0&&_t("failed to call OrtRun().");let ee=[],ae=[];Cd("wasm ProcessOutputTensor");for(let J=0;J<x;J++){let q=Number(a.getValue(N+J*o,"*"));if(q===C[J]){ee.push(r[J]);continue}let G=a.stackSave(),U=a.stackAlloc(4*o),Y=!1,K,Z=0;try{a._OrtGetTensorData(q,U,U+o,U+2*o,U+3*o)!==0&&_t(`Can't access output tensor data on index ${J}.`);let ge=o===4?"i32":"i64",ve=Number(a.getValue(U,ge));Z=a.getValue(U+o,"*");let Q=a.getValue(U+o*2,"*"),be=Number(a.getValue(U+o*3,ge)),vt=[];for(let at=0;at<be;at++)vt.push(Number(a.getValue(Q+at*o,ge)));a._OrtFree(Q)!==0&&_t("Can't free memory for tensor dims.");let mt=vt.reduce((at,Tt)=>at*Tt,1);K=Ro(ve);let nn=f==null?void 0:f.outputPreferredLocations[i[J]];if(K==="string"){if(nn==="gpu-buffer"||nn==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let at=[];for(let Tt=0;Tt<mt;Tt++){let ii=a.getValue(Z+Tt*o,"*"),Ha=a.getValue(Z+(Tt+1)*o,"*"),ns=Tt===mt-1?void 0:Ha-ii;at.push(a.UTF8ToString(ii,ns))}ee.push([K,vt,at,"cpu"])}else if(nn==="gpu-buffer"&&mt>0){let at=a.jsepGetBuffer;if(!at)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let Tt=at(Z),ii=pc(ve,mt);if(ii===void 0||!cC(K))throw new Error(`Unsupported data type: ${K}`);Y=!0,ee.push([K,vt,{gpuBuffer:Tt,download:a.jsepCreateDownloader(Tt,ii,K),dispose:()=>{a._OrtReleaseTensor(q)!==0&&_t("Can't release tensor.")}},"gpu-buffer"])}else if(nn==="ml-tensor"&&mt>0){let at=a.webnnEnsureTensor,Tt=a.webnnIsGraphInputOutputTypeSupported;if(!at||!Tt)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(pc(ve,mt)===void 0||!dC(K))throw new Error(`Unsupported data type: ${K}`);if(!Tt(n,K,!1))throw new Error(`preferredLocation "ml-tensor" for ${K} output is not supported by current WebNN Context.`);let ii=await at(n,Z,ve,vt,!1);Y=!0,ee.push([K,vt,{mlTensor:ii,download:a.webnnCreateMLTensorDownloader(Z,K),dispose:()=>{a.webnnReleaseTensorId(Z),a._OrtReleaseTensor(q)}},"ml-tensor"])}else if(nn==="ml-tensor-cpu-output"&&mt>0){let at=a.webnnCreateMLTensorDownloader(Z,K)(),Tt=ee.length;Y=!0,ae.push((async()=>{let ii=[Tt,await at];return a.webnnReleaseTensorId(Z),a._OrtReleaseTensor(q),ii})()),ee.push([K,vt,[],"cpu"])}else{let at=Y1(K),Tt=new at(mt);new Uint8Array(Tt.buffer,Tt.byteOffset,Tt.byteLength).set(a.HEAPU8.subarray(Z,Z+Tt.byteLength)),ee.push([K,vt,Tt,"cpu"])}}finally{a.stackRestore(G),K==="string"&&Z&&a._free(Z),Y||a._OrtReleaseTensor(q)}}f&&!m&&(a._OrtClearBoundOutputs(f.handle)!==0&&_t("Can't clear bound outputs."),dl.set(n,[u,c,h,f,m,!1]));for(let[J,q]of await Promise.all(ae))ee[J][2]=q;return kd("wasm ProcessOutputTensor"),ee}finally{(se=a.webnnOnRunEnd)==null||se.call(a,u),a.stackRestore(V),E.forEach(ue=>a._OrtReleaseTensor(ue)),C.forEach(ue=>a._OrtReleaseTensor(ue)),D.forEach(ue=>a._free(ue)),v!==0&&a._OrtReleaseRunOptions(v),w.forEach(ue=>a._free(ue))}},$C=n=>{let e=St(),t=dl.get(n);if(!t)throw new Error("invalid session id");let i=t[0],r=e._OrtEndProfiling(i);r===0&&_t("Can't get an profile file name."),e._OrtFree(r)},RC=n=>{let e=[];for(let t of n){let i=t[2];!Array.isArray(i)&&"buffer"in i&&e.push(i.buffer)}return e}}),hl,Ui,xh,zm,Vm,Pw,rA,Nw,rc,sc,QM,eU,tU,nU,iU,rU,sU,aU,oU=fe(()=>{ts(),ZB(),ih(),oC(),hl=()=>!!Nt.wasm.proxy&&typeof document<"u",xh=!1,zm=!1,Vm=!1,Nw=new Map,rc=(n,e)=>{let t=Nw.get(n);t?t.push(e):Nw.set(n,[e])},sc=()=>{if(xh||!zm||Vm||!Ui)throw new Error("worker not ready")},QM=n=>{switch(n.data.type){case"init-wasm":xh=!1,n.data.err?(Vm=!0,rA[1](n.data.err)):(zm=!0,rA[0]()),Pw&&(URL.revokeObjectURL(Pw),Pw=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let e=Nw.get(n.data.type);n.data.err?e.shift()[1](n.data.err):e.shift()[0](n.data.out);break}}},eU=async()=>{if(!zm){if(xh)throw new Error("multiple calls to 'initWasm()' detected.");if(Vm)throw new Error("previous call to 'initWasm()' failed.");if(xh=!0,hl())return new Promise((n,e)=>{Ui==null||Ui.terminate(),Jz().then(([t,i])=>{try{Ui=i,Ui.onerror=s=>e(s),Ui.onmessage=QM,rA=[n,e];let r={type:"init-wasm",in:Nt};!r.in.wasm.wasmPaths&&(t||MT)&&(r.in.wasm.wasmPaths={wasm:new URL("/blood-report-fitness-evaluation-system/assets/ort-wasm-simd-threaded.jsep-BGTZ4Y7F.wasm",import.meta.url).href}),Ui.postMessage(r),Pw=t}catch(r){e(r)}},e)});try{await lC(Nt.wasm),await TC(Nt),zm=!0}catch(n){throw Vm=!0,n}finally{xh=!1}}},tU=async n=>{if(hl())return sc(),new Promise((e,t)=>{rc("init-ep",[e,t]);let i={type:"init-ep",in:{epName:n,env:Nt}};Ui.postMessage(i)});await SC(Nt,n)},nU=async n=>hl()?(sc(),new Promise((e,t)=>{rc("copy-from",[e,t]);let i={type:"copy-from",in:{buffer:n}};Ui.postMessage(i,[n.buffer])})):Lb(n),iU=async(n,e)=>{if(hl()){if(e!=null&&e.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return sc(),new Promise((t,i)=>{rc("create",[t,i]);let r={type:"create",in:{model:n,options:{...e}}},s=[];n instanceof Uint8Array&&s.push(n.buffer),Ui.postMessage(r,s)})}else return IC(n,e)},rU=async n=>{if(hl())return sc(),new Promise((e,t)=>{rc("release",[e,t]);let i={type:"release",in:n};Ui.postMessage(i)});CC(n)},sU=async(n,e,t,i,r,s)=>{if(hl()){if(t.some(a=>a[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(r.some(a=>a))throw new Error("pre-allocated output tensor is not supported for proxy.");return sc(),new Promise((a,o)=>{rc("run",[a,o]);let l=t,u={type:"run",in:{sessionId:n,inputIndices:e,inputs:l,outputIndices:i,options:s}};Ui.postMessage(u,RC(l))})}else return kC(n,e,t,i,r,s)},aU=async n=>{if(hl())return sc(),new Promise((e,t)=>{rc("end-profiling",[e,t]);let i={type:"end-profiling",in:n};Ui.postMessage(i)});$C(n)}}),sA,JM,lU,NZ=fe(()=>{ts(),oU(),Oe(),aC(),nV(),sA=(n,e)=>{switch(n.location){case"cpu":return[n.type,n.dims,n.data,"cpu"];case"gpu-buffer":return[n.type,n.dims,{gpuBuffer:n.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[n.type,n.dims,{mlTensor:n.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${n.location} for ${e()}`)}},JM=n=>{switch(n[3]){case"cpu":return new Ds(n[0],n[2],n[1]);case"gpu-buffer":{let e=n[0];if(!cC(e))throw new Error(`not supported data type: ${e} for deserializing GPU tensor`);let{gpuBuffer:t,download:i,dispose:r}=n[2];return Ds.fromGpuBuffer(t,{dataType:e,dims:n[1],download:i,dispose:r})}case"ml-tensor":{let e=n[0];if(!dC(e))throw new Error(`not supported data type: ${e} for deserializing MLTensor tensor`);let{mlTensor:t,download:i,dispose:r}=n[2];return Ds.fromMLTensor(t,{dataType:e,dims:n[1],download:i,dispose:r})}default:throw new Error(`invalid data location: ${n[3]}`)}},lU=class{async fetchModelAndCopyToWasmMemory(n){return nU(await hC(n))}async loadModel(n,e){Va();let t;typeof n=="string"?t=await this.fetchModelAndCopyToWasmMemory(n):t=n,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await iU(t,e),Bs()}async dispose(){return rU(this.sessionId)}async run(n,e,t){Va();let i=[],r=[];Object.entries(n).forEach(h=>{let f=h[0],m=h[1],y=this.inputNames.indexOf(f);if(y===-1)throw new Error(`invalid input '${f}'`);i.push(m),r.push(y)});let s=[],a=[];Object.entries(e).forEach(h=>{let f=h[0],m=h[1],y=this.outputNames.indexOf(f);if(y===-1)throw new Error(`invalid output '${f}'`);s.push(m),a.push(y)});let o=i.map((h,f)=>sA(h,()=>`input "${this.inputNames[r[f]]}"`)),l=s.map((h,f)=>h?sA(h,()=>`output "${this.outputNames[a[f]]}"`):null),u=await sU(this.sessionId,r,o,a,l,t),c={};for(let h=0;h<u.length;h++)c[this.outputNames[a[h]]]=s[h]??JM(u[h]);return Bs(),c}startProfiling(){}endProfiling(){aU(this.sessionId)}}}),uU={};Wp(uU,{OnnxruntimeWebAssemblyBackend:()=>XT,initializeFlags:()=>YT,wasmBackend:()=>cU});var YT,XT,cU,DZ=fe(()=>{ts(),oU(),NZ(),YT=()=>{(typeof Nt.wasm.initTimeout!="number"||Nt.wasm.initTimeout<0)&&(Nt.wasm.initTimeout=0);let n=Nt.wasm.simd;if(typeof n!="boolean"&&n!==void 0&&n!=="fixed"&&n!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${n}". Reset it to \`false\` and ignore SIMD feature checking.`),Nt.wasm.simd=!1),typeof Nt.wasm.proxy!="boolean"&&(Nt.wasm.proxy=!1),typeof Nt.wasm.trace!="boolean"&&(Nt.wasm.trace=!1),typeof Nt.wasm.numThreads!="number"||!Number.isInteger(Nt.wasm.numThreads)||Nt.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)Nt.wasm.numThreads=1;else{let e=typeof navigator>"u"?vJ("node:os").cpus().length:navigator.hardwareConcurrency;Nt.wasm.numThreads=Math.min(4,Math.ceil((e||1)/2))}},XT=class{async init(n){YT(),await eU(),await tU(n)}async createInferenceSessionHandler(n,e){let t=new lU;return await t.loadModel(n,e),t}},cU=new XT});ts();ts();ts();var MZ="1.23.2";{let n=(DZ(),_y(uU)).wasmBackend;Gh("webgpu",n,5),Gh("webnn",n,5),Gh("cpu",n,10),Gh("wasm",n,10)}Object.defineProperty(Nt.versions,"web",{value:MZ,enumerable:!0});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OZ="/blood-report-fitness-evaluation-system/models/disease_prediction_model.onnx",LZ=["hemoglobin","wbc","rbc","platelets","glucose","cholesterol","creatinine","tsh"],FZ=[{key:"has_diabetes",label:"Diabetes",warning:"High glucose levels detected. Consult a doctor."},{key:"has_anemia",label:"Anemia",warning:"Hemoglobin levels are low. Eat iron-rich foods."},{key:"has_thyroid",label:"Thyroid Issue",warning:"TSH levels are abnormal. Thyroid checkup recommended."},{key:"has_kidney_issue",label:"Kidney Issue",warning:"Creatinine levels are high. Kidney function check advised."}];let jg=null;const zZ=async()=>{try{return jg||(console.log(" Loading ML Model..."),jg=await sC.create(OZ),console.log(" ML Model Loaded")),!0}catch(n){return console.error(" Failed to load ML model:",n),!1}},VZ=async n=>{if(!jg&&!await zZ())return null;try{const e=Float32Array.from(LZ.map(u=>{const c=parseFloat(n[u]);return isNaN(c)?0:c})),i={float_input:new Ds("float32",e,[1,8])},r=await jg.run(i),s=[],a=jg.outputNames;console.log("Model Outputs:",a);const o=[];let l=0;for(const u of FZ){let c=!1;r[a[l]]&&r[a[l]].data[0]===1&&(c=!0),u.key==="has_diabetes"&&n.glucose>126&&(c=!0),u.key==="has_anemia"&&n.hemoglobin<11&&(c=!0),u.key==="has_thyroid"&&(n.tsh<.4||n.tsh>4)&&(c=!0),u.key==="has_kidney_issue"&&n.creatinine>1.4&&(c=!0),c&&o.push(u),l++}return o}catch(e){return console.error("Prediction Error:",e),[]}},jZ=({predictions:n})=>!n||n.length===0?S.jsxs("div",{className:"prediction-card safe fade-in",children:[S.jsx("div",{className:"status-icon",children:""}),S.jsxs("div",{className:"content",children:[S.jsx("h3",{children:"Great News!"}),S.jsx("p",{children:"Our AI didn't detect any high-risk patterns in your report."})]})]}):S.jsxs("div",{className:"prediction-container fade-in",children:[S.jsx("h3",{children:"AI Health Insights "}),S.jsx("p",{className:"disclaimer",children:"Based on your blood values, we identified potential risks:"}),S.jsx("div",{className:"prediction-list",children:n.map((e,t)=>S.jsxs("div",{className:"prediction-card warning",children:[S.jsx("div",{className:"status-icon",children:""}),S.jsxs("div",{className:"content",children:[S.jsx("h4",{children:e.label}),S.jsx("p",{children:e.warning})]})]},t))}),S.jsx("div",{className:"recommendation",children:S.jsxs("p",{children:[S.jsx("strong",{children:"Recommendation:"})," Please consult a certified doctor for precise diagnosis."]})}),S.jsx("style",{children:`
                .prediction-container {
                    margin-top: 20px;
                    padding: 20px;
                    background: #fff;
                    border-radius: 16px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
                    border: 1px solid #f1f5f9;
                }
                .prediction-container h3 {
                    margin: 0 0 10px 0;
                    color: #1e293b;
                    font-size: 18px;
                }
                .disclaimer {
                    color: #64748b;
                    font-size: 13px;
                    margin-bottom: 15px;
                }
                .prediction-list {
                    display: flex;
                    flex-direction: column;
                    gap: 12px;
                }
                .prediction-card {
                    display: flex;
                    align-items: flex-start;
                    gap: 15px;
                    padding: 16px;
                    border-radius: 12px;
                }
                .prediction-card.safe {
                    background: #f0fdf4;
                    border: 1px solid #dcfce7;
                }
                .prediction-card.warning {
                    background: #fef2f2;
                    border: 1px solid #fee2e2;
                }
                .status-icon {
                    font-size: 24px;
                }
                .content h3, .content h4 {
                    margin: 0 0 5px 0;
                    color: #1e293b;
                }
                .content p {
                    margin: 0;
                    font-size: 13px;
                    color: #475569;
                    line-height: 1.4;
                }
                .recommendation {
                    margin-top: 20px;
                    padding-top: 15px;
                    border-top: 1px solid #e2e8f0;
                    font-size: 13px;
                    color: #334155;
                }
            `})]});var Bg={};Bg.d=(n,e)=>{for(var t in e)Bg.o(e,t)&&!Bg.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})};Bg.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var Ue=globalThis.pdfjsLib={};Bg.d(Ue,{AbortException:()=>Tu,AnnotationEditorLayer:()=>s2,AnnotationEditorParamsType:()=>st,AnnotationEditorType:()=>Ye,AnnotationEditorUIManager:()=>Wd,AnnotationLayer:()=>Ote,AnnotationMode:()=>xl,ColorPicker:()=>Ub,DOMSVGFactory:()=>VC,DrawLayer:()=>l2,FeatureTest:()=>Di,GlobalWorkerOptions:()=>Po,ImageKind:()=>c0,InvalidPDFException:()=>JT,MissingPDFException:()=>wy,OPS:()=>_s,OutputScale:()=>eS,PDFDataRangeTransport:()=>h6,PDFDateString:()=>OC,PDFWorker:()=>df,PasswordResponses:()=>WZ,PermissionFlag:()=>HZ,PixelsPerInch:()=>Su,RenderingCancelledException:()=>DC,TextLayer:()=>by,TouchManager:()=>jb,UnexpectedResponseException:()=>Fb,Util:()=>Ne,VerbosityLevel:()=>X1,XfaLayer:()=>p6,build:()=>gte,createValidAbsoluteUrl:()=>YZ,fetchData:()=>ex,getDocument:()=>ote,getFilenameFromUrl:()=>ree,getPdfFilenameFromUrl:()=>see,getXfaPageViewport:()=>aee,isDataScheme:()=>tx,isPdfFile:()=>MC,noContextMenu:()=>qs,normalizeUnicode:()=>tee,setLayerDimensions:()=>Hd,shadow:()=>Ze,stopEvent:()=>Tr,version:()=>mte});const wi=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),dU=[1,0,0,1,0,0],QT=[.001,0,0,.001,0,0],BZ=1e7,aA=1.35,wr={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},xl={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},UZ="pdfjs_internal_editor_",Ye={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},st={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},HZ={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},li={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},c0={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},xn={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,WIDGET:20},jm={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},X1={ERRORS:0,WARNINGS:1,INFOS:5},_s={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},WZ={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Q1=X1.WARNINGS;function qZ(n){Number.isInteger(n)&&(Q1=n)}function GZ(){return Q1}function J1(n){Q1>=X1.INFOS&&console.log(`Info: ${n}`)}function Xe(n){Q1>=X1.WARNINGS&&console.log(`Warning: ${n}`)}function Rt(n){throw new Error(n)}function yn(n,e){n||Rt(e)}function KZ(n){switch(n==null?void 0:n.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function YZ(n,e=null,t=null){if(!n)return null;try{if(t&&typeof n=="string"){if(t.addDefaultProtocol&&n.startsWith("www.")){const r=n.match(/\./g);(r==null?void 0:r.length)>=2&&(n=`http://${n}`)}if(t.tryConvertEncoding)try{n=eee(n)}catch{}}const i=e?new URL(n,e):new URL(n);if(KZ(i))return i}catch{}return null}function Ze(n,e,t,i=!1){return Object.defineProperty(n,e,{value:t,enumerable:!i,configurable:!0,writable:!1}),t}const Ou=function(){function e(t,i){this.message=t,this.name=i}return e.prototype=new Error,e.constructor=e,e}();class ZM extends Ou{constructor(e,t){super(e,"PasswordException"),this.code=t}}class oA extends Ou{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class JT extends Ou{constructor(e){super(e,"InvalidPDFException")}}class wy extends Ou{constructor(e){super(e,"MissingPDFException")}}class Fb extends Ou{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}}class XZ extends Ou{constructor(e){super(e,"FormatError")}}class Tu extends Ou{constructor(e){super(e,"AbortException")}}function hU(n){(typeof n!="object"||(n==null?void 0:n.length)===void 0)&&Rt("Invalid argument for bytesToString");const e=n.length,t=8192;if(e<t)return String.fromCharCode.apply(null,n);const i=[];for(let r=0;r<e;r+=t){const s=Math.min(r+t,e),a=n.subarray(r,s);i.push(String.fromCharCode.apply(null,a))}return i.join("")}function Z1(n){typeof n!="string"&&Rt("Invalid argument for stringToBytes");const e=n.length,t=new Uint8Array(e);for(let i=0;i<e;++i)t[i]=n.charCodeAt(i)&255;return t}function QZ(n){return String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,n&255)}function PC(n){const e=Object.create(null);for(const[t,i]of n)e[t]=i;return e}function JZ(){const n=new Uint8Array(4);return n[0]=1,new Uint32Array(n.buffer,0,1)[0]===1}function ZZ(){try{return new Function(""),!0}catch{return!1}}class Di{static get isLittleEndian(){return Ze(this,"isLittleEndian",JZ())}static get isEvalSupported(){return Ze(this,"isEvalSupported",ZZ())}static get isOffscreenCanvasSupported(){return Ze(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Ze(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.platform)=="string"?Ze(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof(navigator==null?void 0:navigator.userAgent)=="string"&&navigator.userAgent.includes("Firefox")}):Ze(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var e,t;return Ze(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const lA=Array.from(Array(256).keys(),n=>n.toString(16).padStart(2,"0"));var Vo,d0,ZT;class Ne{static makeHexColor(e,t,i){return`#${lA[e]}${lA[t]}${lA[i]}`}static scaleMinMax(e,t){let i;e[0]?(e[0]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[3],t[3]*=e[3]):(i=t[0],t[0]=t[1],t[1]=i,i=t[2],t[2]=t[3],t[3]=i,e[1]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){const i=e[0]*t[0]+e[1]*t[2]+t[4],r=e[0]*t[1]+e[1]*t[3]+t[5];return[i,r]}static applyInverseTransform(e,t){const i=t[0]*t[3]-t[1]*t[2],r=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/i,s=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/i;return[r,s]}static getAxialAlignedBoundingBox(e,t){const i=this.applyTransform(e,t),r=this.applyTransform(e.slice(2,4),t),s=this.applyTransform([e[0],e[3]],t),a=this.applyTransform([e[2],e[1]],t);return[Math.min(i[0],r[0],s[0],a[0]),Math.min(i[1],r[1],s[1],a[1]),Math.max(i[0],r[0],s[0],a[0]),Math.max(i[1],r[1],s[1],a[1])]}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){const t=[e[0],e[2],e[1],e[3]],i=e[0]*t[0]+e[1]*t[2],r=e[0]*t[1]+e[1]*t[3],s=e[2]*t[0]+e[3]*t[2],a=e[2]*t[1]+e[3]*t[3],o=(i+a)/2,l=Math.sqrt((i+a)**2-4*(i*a-s*r))/2,u=o+l||1,c=o-l||1;return[Math.sqrt(u),Math.sqrt(c)]}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const i=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),r=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(i>r)return null;const s=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return s>a?null:[i,s,r,a]}static bezierBoundingBox(e,t,i,r,s,a,o,l,u){return u?(u[0]=Math.min(u[0],e,o),u[1]=Math.min(u[1],t,l),u[2]=Math.max(u[2],e,o),u[3]=Math.max(u[3],t,l)):u=[Math.min(e,o),Math.min(t,l),Math.max(e,o),Math.max(t,l)],z(this,Vo,ZT).call(this,e,i,s,o,t,r,a,l,3*(-e+3*(i-s)+o),6*(e-2*i+s),3*(i-e),u),z(this,Vo,ZT).call(this,e,i,s,o,t,r,a,l,3*(-t+3*(r-a)+l),6*(t-2*r+a),3*(r-t),u),u}}Vo=new WeakSet,d0=function(e,t,i,r,s,a,o,l,u,c){if(u<=0||u>=1)return;const h=1-u,f=u*u,m=f*u,y=h*(h*(h*e+3*u*t)+3*f*i)+m*r,_=h*(h*(h*s+3*u*a)+3*f*o)+m*l;c[0]=Math.min(c[0],y),c[1]=Math.min(c[1],_),c[2]=Math.max(c[2],y),c[3]=Math.max(c[3],_)},ZT=function(e,t,i,r,s,a,o,l,u,c,h,f){if(Math.abs(u)<1e-12){Math.abs(c)>=1e-12&&z(this,Vo,d0).call(this,e,t,i,r,s,a,o,l,-h/c,f);return}const m=c**2-4*h*u;if(m<0)return;const y=Math.sqrt(m),_=2*u;z(this,Vo,d0).call(this,e,t,i,r,s,a,o,l,(-c+y)/_,f),z(this,Vo,d0).call(this,e,t,i,r,s,a,o,l,(-c-y)/_,f)},F(Ne,Vo);function eee(n){return decodeURIComponent(escape(n))}let uA=null,eO=null;function tee(n){return uA||(uA=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,eO=new Map([["","t"]])),n.replaceAll(uA,(e,t,i)=>t?t.normalize("NFKC"):eO.get(i))}function nee(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const n=new Uint8Array(32);return crypto.getRandomValues(n),hU(n)}const NC="pdfjs_internal_id_";function iee(n){return Uint8Array.prototype.toBase64?n.toBase64():btoa(hU(n))}typeof Promise.try!="function"&&(Promise.try=function(n,...e){return new Promise(t=>{t(n(...e))})});const Ja="http://www.w3.org/2000/svg",mc=class mc{};Le(mc,"CSS",96),Le(mc,"PDF",72),Le(mc,"PDF_TO_CSS_UNITS",mc.CSS/mc.PDF);let Su=mc;async function ex(n,e="text"){if(og(n,document.baseURI)){const t=await fetch(n);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,i)=>{const r=new XMLHttpRequest;r.open("GET",n,!0),r.responseType=e,r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE){if(r.status===200||r.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(r.response);return}t(r.responseText);return}i(new Error(r.statusText))}},r.send(null)})}class dv{constructor({viewBox:e,userUnit:t,scale:i,rotation:r,offsetX:s=0,offsetY:a=0,dontFlip:o=!1}){this.viewBox=e,this.userUnit=t,this.scale=i,this.rotation=r,this.offsetX=s,this.offsetY=a,i*=t;const l=(e[2]+e[0])/2,u=(e[3]+e[1])/2;let c,h,f,m;switch(r%=360,r<0&&(r+=360),r){case 180:c=-1,h=0,f=0,m=1;break;case 90:c=0,h=1,f=1,m=0;break;case 270:c=0,h=-1,f=-1,m=0;break;case 0:c=1,h=0,f=0,m=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(f=-f,m=-m);let y,_,x,v;c===0?(y=Math.abs(u-e[1])*i+s,_=Math.abs(l-e[0])*i+a,x=(e[3]-e[1])*i,v=(e[2]-e[0])*i):(y=Math.abs(l-e[0])*i+s,_=Math.abs(u-e[1])*i+a,x=(e[2]-e[0])*i,v=(e[3]-e[1])*i),this.transform=[c*i,h*i,f*i,m*i,y-c*i*l-f*i*u,_-h*i*l-m*i*u],this.width=x,this.height=v}get rawDims(){const{userUnit:e,viewBox:t}=this,i=t.map(r=>r*e);return Ze(this,"rawDims",{pageWidth:i[2]-i[0],pageHeight:i[3]-i[1],pageX:i[0],pageY:i[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:i=this.offsetX,offsetY:r=this.offsetY,dontFlip:s=!1}={}){return new dv({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:i,offsetY:r,dontFlip:s})}convertToViewportPoint(e,t){return Ne.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=Ne.applyTransform([e[0],e[1]],this.transform),i=Ne.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],i[0],i[1]]}convertToPdfPoint(e,t){return Ne.applyInverseTransform([e,t],this.transform)}}class DC extends Ou{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function tx(n){const e=n.length;let t=0;for(;t<e&&n[t].trim()==="";)t++;return n.substring(t,t+5).toLowerCase()==="data:"}function MC(n){return typeof n=="string"&&/\.pdf$/i.test(n)}function ree(n){return[n]=n.split(/[#?]/,1),n.substring(n.lastIndexOf("/")+1)}function see(n,e="document.pdf"){if(typeof n!="string")return e;if(tx(n))return Xe('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,i=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,r=t.exec(n);let s=i.exec(r[1])||i.exec(r[2])||i.exec(r[3]);if(s&&(s=s[0],s.includes("%")))try{s=i.exec(decodeURIComponent(s))[0]}catch{}return s||e}class tO{constructor(){Le(this,"started",Object.create(null));Le(this,"times",[])}time(e){e in this.started&&Xe(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||Xe(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:i}of this.times)t=Math.max(i.length,t);for(const{name:i,start:r,end:s}of this.times)e.push(`${i.padEnd(t)} ${s-r}ms
`);return e.join("")}}function og(n,e){try{const{protocol:t}=e?new URL(n,e):new URL(n);return t==="http:"||t==="https:"}catch{return!1}}function qs(n){n.preventDefault()}function Tr(n){n.preventDefault(),n.stopPropagation()}var Ey;class OC{static toDateObject(e){if(!e||typeof e!="string")return null;d(this,Ey)||R(this,Ey,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=d(this,Ey).exec(e);if(!t)return null;const i=parseInt(t[1],10);let r=parseInt(t[2],10);r=r>=1&&r<=12?r-1:0;let s=parseInt(t[3],10);s=s>=1&&s<=31?s:1;let a=parseInt(t[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(t[5],10);o=o>=0&&o<=59?o:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;const u=t[7]||"Z";let c=parseInt(t[8],10);c=c>=0&&c<=23?c:0;let h=parseInt(t[9],10)||0;return h=h>=0&&h<=59?h:0,u==="-"?(a+=c,o+=h):u==="+"&&(a-=c,o-=h),new Date(Date.UTC(i,r,s,a,o,l))}}Ey=new WeakMap,F(OC,Ey);function aee(n,{scale:e=1,rotation:t=0}){const{width:i,height:r}=n.attributes.style,s=[0,0,parseInt(i),parseInt(r)];return new dv({viewBox:s,userUnit:1,scale:e,rotation:t})}function LC(n){if(n.startsWith("#")){const e=parseInt(n.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return n.startsWith("rgb(")?n.slice(4,-1).split(",").map(e=>parseInt(e)):n.startsWith("rgba(")?n.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(Xe(`Not a valid color format: "${n}"`),[0,0,0])}function oee(n){const e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(const t of n.keys()){e.style.color=t;const i=window.getComputedStyle(e).color;n.set(t,LC(i))}e.remove()}function Bt(n){const{a:e,b:t,c:i,d:r,e:s,f:a}=n.getTransform();return[e,t,i,r,s,a]}function aa(n){const{a:e,b:t,c:i,d:r,e:s,f:a}=n.getTransform().invertSelf();return[e,t,i,r,s,a]}function Hd(n,e,t=!1,i=!0){if(e instanceof dv){const{pageWidth:r,pageHeight:s}=e.rawDims,{style:a}=n,o=Di.isCSSRoundSupported,l=`var(--scale-factor) * ${r}px`,u=`var(--scale-factor) * ${s}px`,c=o?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,h=o?`round(down, ${u}, var(--scale-round-y, 1px))`:`calc(${u})`;!t||e.rotation%180===0?(a.width=c,a.height=h):(a.width=h,a.height=c)}i&&n.setAttribute("data-main-rotation",e.rotation)}class eS{constructor(){const e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}}var El,bc,vs,xc,Ay,Ty,Gb,fU,Mi,pU,mU,h0,gU,nS;const no=class no{constructor(e){F(this,Mi);F(this,El,null);F(this,bc,null);F(this,vs);F(this,xc,null);F(this,Ay,null);R(this,vs,e),d(no,Ty)||R(no,Ty,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){const e=R(this,El,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=d(this,vs)._uiManager._signal;e.addEventListener("contextmenu",qs,{signal:t}),e.addEventListener("pointerdown",z(no,Gb,fU),{signal:t});const i=R(this,xc,document.createElement("div"));i.className="buttons",e.append(i);const r=d(this,vs).toolbarPosition;if(r){const{style:s}=e,a=d(this,vs)._uiManager.direction==="ltr"?1-r[0]:r[0];s.insetInlineEnd=`${100*a}%`,s.top=`calc(${100*r[1]}% + var(--editor-toolbar-vert-offset))`}return z(this,Mi,gU).call(this),e}get div(){return d(this,El)}hide(){var e;d(this,El).classList.add("hidden"),(e=d(this,bc))==null||e.hideDropdown()}show(){var e;d(this,El).classList.remove("hidden"),(e=d(this,Ay))==null||e.shown()}async addAltText(e){const t=await e.render();z(this,Mi,h0).call(this,t),d(this,xc).prepend(t,d(this,Mi,nS)),R(this,Ay,e)}addColorPicker(e){R(this,bc,e);const t=e.renderButton();z(this,Mi,h0).call(this,t),d(this,xc).prepend(t,d(this,Mi,nS))}remove(){var e;d(this,El).remove(),(e=d(this,bc))==null||e.destroy(),R(this,bc,null)}};El=new WeakMap,bc=new WeakMap,vs=new WeakMap,xc=new WeakMap,Ay=new WeakMap,Ty=new WeakMap,Gb=new WeakSet,fU=function(e){e.stopPropagation()},Mi=new WeakSet,pU=function(e){d(this,vs)._focusEventsAllowed=!1,Tr(e)},mU=function(e){d(this,vs)._focusEventsAllowed=!0,Tr(e)},h0=function(e){const t=d(this,vs)._uiManager._signal;e.addEventListener("focusin",z(this,Mi,pU).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",z(this,Mi,mU).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",qs,{signal:t})},gU=function(){const{editorType:e,_uiManager:t}=d(this,vs),i=document.createElement("button");i.className="delete",i.tabIndex=0,i.setAttribute("data-l10n-id",d(no,Ty)[e]),z(this,Mi,h0).call(this,i),i.addEventListener("click",r=>{t.delete()},{signal:t._signal}),d(this,xc).append(i)},nS=function(){const e=document.createElement("div");return e.className="divider",e},F(no,Gb),F(no,Ty,null);let tS=no;var Sy,Ec,Ac,Iu,yU,_U,vU;class lee{constructor(e){F(this,Iu);F(this,Sy,null);F(this,Ec,null);F(this,Ac);R(this,Ac,e)}show(e,t,i){const[r,s]=z(this,Iu,_U).call(this,t,i),{style:a}=d(this,Ec)||R(this,Ec,z(this,Iu,yU).call(this));e.append(d(this,Ec)),a.insetInlineEnd=`${100*r}%`,a.top=`calc(${100*s}% + var(--editor-toolbar-vert-offset))`}hide(){d(this,Ec).remove()}}Sy=new WeakMap,Ec=new WeakMap,Ac=new WeakMap,Iu=new WeakSet,yU=function(){const e=R(this,Ec,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",qs,{signal:d(this,Ac)._signal});const t=R(this,Sy,document.createElement("div"));return t.className="buttons",e.append(t),z(this,Iu,vU).call(this),e},_U=function(e,t){let i=0,r=0;for(const s of e){const a=s.y+s.height;if(a<i)continue;const o=s.x+(t?s.width:0);if(a>i){r=o,i=a;continue}t?o>r&&(r=o):o<r&&(r=o)}return[t?1-r:r,i]},vU=function(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const i=d(this,Ac)._signal;e.addEventListener("contextmenu",qs,{signal:i}),e.addEventListener("click",()=>{d(this,Ac).highlightSelection("floating_button")},{signal:i}),d(this,Sy).append(e)};function zb(n,e,t){for(const i of t)e.addEventListener(i,n[i].bind(n))}var Kb;class uee{constructor(){F(this,Kb,0)}get id(){return`${UZ}${Ti(this,Kb)._++}`}}Kb=new WeakMap;var hf,Iy,di,ff,f0;const UC=class UC{constructor(){F(this,ff);F(this,hf,nee());F(this,Iy,0);F(this,di,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',i=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),r=new Image;r.src=e;const s=r.decode().then(()=>(i.drawImage(r,0,0,1,1,0,0,1,3),new Uint32Array(i.getImageData(0,0,1,1).data.buffer)[0]===0));return Ze(this,"_isSVGFittingCanvas",s)}async getFromFile(e){const{lastModified:t,name:i,size:r,type:s}=e;return z(this,ff,f0).call(this,`${t}_${i}_${r}_${s}`,e)}async getFromUrl(e){return z(this,ff,f0).call(this,e,e)}async getFromBlob(e,t){const i=await t;return z(this,ff,f0).call(this,e,i)}async getFromId(e){d(this,di)||R(this,di,new Map);const t=d(this,di).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:i}=t;return delete t.blobPromise,this.getFromBlob(t.id,i)}return this.getFromUrl(t.url)}getFromCanvas(e,t){d(this,di)||R(this,di,new Map);let i=d(this,di).get(e);if(i!=null&&i.bitmap)return i.refCounter+=1,i;const r=new OffscreenCanvas(t.width,t.height);return r.getContext("2d").drawImage(t,0,0),i={bitmap:r.transferToImageBitmap(),id:`image_${d(this,hf)}_${Ti(this,Iy)._++}`,refCounter:1,isSvg:!1},d(this,di).set(e,i),d(this,di).set(i.id,i),i}getSvgUrl(e){const t=d(this,di).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var r;d(this,di)||R(this,di,new Map);const t=d(this,di).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:i}=t;if(!t.url&&!t.file){const s=new OffscreenCanvas(i.width,i.height);s.getContext("bitmaprenderer").transferFromImageBitmap(i),t.blobPromise=s.convertToBlob()}(r=i.close)==null||r.call(i),t.bitmap=null}isValidId(e){return e.startsWith(`image_${d(this,hf)}_`)}};hf=new WeakMap,Iy=new WeakMap,di=new WeakMap,ff=new WeakSet,f0=async function(e,t){d(this,di)||R(this,di,new Map);let i=d(this,di).get(e);if(i===null)return null;if(i!=null&&i.bitmap)return i.refCounter+=1,i;try{i||(i={bitmap:null,id:`image_${d(this,hf)}_${Ti(this,Iy)._++}`,refCounter:0,isSvg:!1});let r;if(typeof t=="string"?(i.url=t,r=await ex(t,"blob")):t instanceof File?r=i.file=t:t instanceof Blob&&(r=t),r.type==="image/svg+xml"){const s=UC._isSVGFittingCanvas,a=new FileReader,o=new Image,l=new Promise((u,c)=>{o.onload=()=>{i.bitmap=o,i.isSvg=!0,u()},a.onload=async()=>{const h=i.svgUrl=a.result;o.src=await s?`${h}#svgView(preserveAspectRatio(none))`:h},o.onerror=a.onerror=c});a.readAsDataURL(r),await l}else i.bitmap=await createImageBitmap(r);i.refCounter=1}catch(r){Xe(r),i=null}return d(this,di).set(e,i),i&&d(this,di).set(i.id,i),i};let iS=UC;var sn,Al,Cy,qt;class cee{constructor(e=128){F(this,sn,[]);F(this,Al,!1);F(this,Cy);F(this,qt,-1);R(this,Cy,e)}add({cmd:e,undo:t,post:i,mustExec:r,type:s=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(r&&e(),d(this,Al))return;const l={cmd:e,undo:t,post:i,type:s};if(d(this,qt)===-1){d(this,sn).length>0&&(d(this,sn).length=0),R(this,qt,0),d(this,sn).push(l);return}if(a&&d(this,sn)[d(this,qt)].type===s){o&&(l.undo=d(this,sn)[d(this,qt)].undo),d(this,sn)[d(this,qt)]=l;return}const u=d(this,qt)+1;u===d(this,Cy)?d(this,sn).splice(0,1):(R(this,qt,u),u<d(this,sn).length&&d(this,sn).splice(u)),d(this,sn).push(l)}undo(){if(d(this,qt)===-1)return;R(this,Al,!0);const{undo:e,post:t}=d(this,sn)[d(this,qt)];e(),t==null||t(),R(this,Al,!1),R(this,qt,d(this,qt)-1)}redo(){if(d(this,qt)<d(this,sn).length-1){R(this,qt,d(this,qt)+1),R(this,Al,!0);const{cmd:e,post:t}=d(this,sn)[d(this,qt)];e(),t==null||t(),R(this,Al,!1)}}hasSomethingToUndo(){return d(this,qt)!==-1}hasSomethingToRedo(){return d(this,qt)<d(this,sn).length-1}cleanType(e){if(d(this,qt)!==-1){for(let t=d(this,qt);t>=0;t--)if(d(this,sn)[t].type!==e){d(this,sn).splice(t+1,d(this,qt)-t),R(this,qt,t);return}d(this,sn).length=0,R(this,qt,-1)}}destroy(){R(this,sn,null)}}sn=new WeakMap,Al=new WeakMap,Cy=new WeakMap,qt=new WeakMap;var Yb,wU;class hv{constructor(e){F(this,Yb);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=Di.platform;for(const[i,r,s={}]of e)for(const a of i){const o=a.startsWith("mac+");t&&o?(this.callbacks.set(a.slice(4),{callback:r,options:s}),this.allKeys.add(a.split("+").at(-1))):!t&&!o&&(this.callbacks.set(a,{callback:r,options:s}),this.allKeys.add(a.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const i=this.callbacks.get(z(this,Yb,wU).call(this,t));if(!i)return;const{callback:r,options:{bubbles:s=!1,args:a=[],checker:o=null}}=i;o&&!o(e,t)||(r.bind(e,...a,t)(),s||Tr(t))}}Yb=new WeakSet,wU=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const Xb=class Xb{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return oee(e),Ze(this,"_colors",e)}convert(e){const t=LC(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[i,r]of this._colors)if(r.every((s,a)=>s===t[a]))return Xb._colorsMapping.get(i);return t}getHexCode(e){const t=this._colors.get(e);return t?Ne.makeHexColor(...t):e}};Le(Xb,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let rS=Xb;var pf,lr,An,Wn,mf,so,gf,Fr,Tl,Tc,yf,Sc,da,ws,Ic,ky,$y,_f,Ry,ha,Sl,vf,Il,fa,Qb,Cl,Py,kl,Cc,Ny,Dy,Mn,xt,ao,kc,My,Oy,$l,pa,oo,Ly,zr,_e,p0,sS,bU,xU,m0,EU,AU,TU,aS,SU,oS,lS,IU,Ii,Za,CU,kU,uS,$U,lg,cS;const Yh=class Yh{constructor(e,t,i,r,s,a,o,l,u,c,h,f,m){F(this,_e);F(this,pf,new AbortController);F(this,lr,null);F(this,An,new Map);F(this,Wn,new Map);F(this,mf,null);F(this,so,null);F(this,gf,null);F(this,Fr,new cee);F(this,Tl,null);F(this,Tc,null);F(this,yf,0);F(this,Sc,new Set);F(this,da,null);F(this,ws,null);F(this,Ic,new Set);Le(this,"_editorUndoBar",null);F(this,ky,!1);F(this,$y,!1);F(this,_f,!1);F(this,Ry,null);F(this,ha,null);F(this,Sl,null);F(this,vf,null);F(this,Il,!1);F(this,fa,null);F(this,Qb,new uee);F(this,Cl,!1);F(this,Py,!1);F(this,kl,null);F(this,Cc,null);F(this,Ny,null);F(this,Dy,null);F(this,Mn,Ye.NONE);F(this,xt,new Set);F(this,ao,null);F(this,kc,null);F(this,My,null);F(this,Oy,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});F(this,$l,[0,0]);F(this,pa,null);F(this,oo,null);F(this,Ly,null);F(this,zr,null);const y=this._signal=d(this,pf).signal;R(this,oo,e),R(this,Ly,t),R(this,mf,i),this._eventBus=r,r._on("editingaction",this.onEditingAction.bind(this),{signal:y}),r._on("pagechanging",this.onPageChanging.bind(this),{signal:y}),r._on("scalechanging",this.onScaleChanging.bind(this),{signal:y}),r._on("rotationchanging",this.onRotationChanging.bind(this),{signal:y}),r._on("setpreference",this.onSetPreference.bind(this),{signal:y}),r._on("switchannotationeditorparams",_=>this.updateParams(_.type,_.value),{signal:y}),z(this,_e,EU).call(this),z(this,_e,IU).call(this),z(this,_e,aS).call(this),R(this,so,s.annotationStorage),R(this,Ry,s.filterFactory),R(this,kc,a),R(this,vf,o||null),R(this,ky,l),R(this,$y,u),R(this,_f,c),R(this,Dy,h||null),this.viewParameters={realScale:Su.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=f||null,this._supportsPinchToZoom=m!==!1}static get _keyboardManager(){const e=Yh.prototype,t=a=>d(a,oo).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),i=(a,{target:o})=>{if(o instanceof HTMLInputElement){const{type:l}=o;return l!=="text"&&l!=="number"}return!0},r=this.TRANSLATE_SMALL,s=this.TRANSLATE_BIG;return Ze(this,"_keyboardManager",new hv([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:i}],[["ctrl+z","mac+meta+z"],e.undo,{checker:i}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:i}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:i}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&d(a,oo).contains(o)&&!a.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&d(a,oo).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}]]))}destroy(){var e,t,i,r,s;(e=d(this,zr))==null||e.resolve(),R(this,zr,null),(t=d(this,pf))==null||t.abort(),R(this,pf,null),this._signal=null;for(const a of d(this,Wn).values())a.destroy();d(this,Wn).clear(),d(this,An).clear(),d(this,Ic).clear(),R(this,lr,null),d(this,xt).clear(),d(this,Fr).destroy(),(i=d(this,mf))==null||i.destroy(),(r=d(this,fa))==null||r.hide(),R(this,fa,null),d(this,ha)&&(clearTimeout(d(this,ha)),R(this,ha,null)),d(this,pa)&&(clearTimeout(d(this,pa)),R(this,pa,null)),(s=this._editorUndoBar)==null||s.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return d(this,Dy)}get useNewAltTextFlow(){return d(this,$y)}get useNewAltTextWhenAddingImage(){return d(this,_f)}get hcmFilter(){return Ze(this,"hcmFilter",d(this,kc)?d(this,Ry).addHCMFilter(d(this,kc).foreground,d(this,kc).background):"none")}get direction(){return Ze(this,"direction",getComputedStyle(d(this,oo)).direction)}get highlightColors(){return Ze(this,"highlightColors",d(this,vf)?new Map(d(this,vf).split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return Ze(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),R(this,Tc,e)}setMainHighlightColorPicker(e){R(this,Ny,e)}editAltText(e,t=!1){var i;(i=d(this,mf))==null||i.editAltText(this,e,t)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":R(this,_f,t);break}}onPageChanging({pageNumber:e}){R(this,yf,e-1)}focusMainContainer(){d(this,oo).focus()}findParent(e,t){for(const i of d(this,Wn).values()){const{x:r,y:s,width:a,height:o}=i.div.getBoundingClientRect();if(e>=r&&e<=r+a&&t>=s&&t<=s+o)return i}return null}disableUserSelect(e=!1){d(this,Ly).classList.toggle("noUserSelect",e)}addShouldRescale(e){d(this,Ic).add(e)}removeShouldRescale(e){d(this,Ic).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*Su.PDF_TO_CSS_UNITS;for(const i of d(this,Ic))i.onScaleChanging();(t=d(this,Tc))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:i,anchorOffset:r,focusNode:s,focusOffset:a}=t,o=t.toString(),u=z(this,_e,p0).call(this,t).closest(".textLayer"),c=this.getSelectionBoxes(u);if(!c)return;t.empty();const h=z(this,_e,sS).call(this,u),f=d(this,Mn)===Ye.NONE,m=()=>{h==null||h.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:c,anchorNode:i,anchorOffset:r,focusNode:s,focusOffset:a,text:o}),f&&this.showAllEditors("highlight",!0,!0)};if(f){this.switchToMode(Ye.HIGHLIGHT,m);return}m()}addToAnnotationStorage(e){!e.isEmpty()&&d(this,so)&&!d(this,so).has(e.id)&&d(this,so).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,d(this,Il)&&(R(this,Il,!1),z(this,_e,m0).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of d(this,xt))if(t.div.contains(e)){R(this,Cc,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!d(this,Cc))return;const[e,t]=d(this,Cc);R(this,Cc,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){z(this,_e,aS).call(this),z(this,_e,oS).call(this)}removeEditListeners(){z(this,_e,SU).call(this),z(this,_e,lS).call(this)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const i of d(this,ws))if(i.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const i of d(this,ws))if(i.isHandlingMimeForPasting(t.type)){i.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var i;if(e.preventDefault(),(i=d(this,lr))==null||i.commitOrRemove(),!this.hasSelection)return;const t=[];for(const r of d(this,xt)){const s=r.serialize(!0);s&&t.push(s)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const s of t.items)for(const a of d(this,ws))if(a.isHandlingMimeForPasting(s.type)){a.paste(s,this.currentLayer);return}let i=t.getData("application/pdfjs");if(!i)return;try{i=JSON.parse(i)}catch(s){Xe(`paste: "${s.message}".`);return}if(!Array.isArray(i))return;this.unselectAll();const r=this.currentLayer;try{const s=[];for(const l of i){const u=await r.deserialize(l);if(!u)return;s.push(u)}const a=()=>{for(const l of s)z(this,_e,uS).call(this,l);z(this,_e,cS).call(this,s)},o=()=>{for(const l of s)l.remove()};this.addCommands({cmd:a,undo:o,mustExec:!0})}catch(s){Xe(`paste: "${s.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),d(this,Mn)!==Ye.NONE&&!this.isEditorHandlingKeyboard&&Yh._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,d(this,Il)&&(R(this,Il,!1),z(this,_e,m0).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(z(this,_e,AU).call(this),z(this,_e,oS).call(this),z(this,_e,Ii).call(this,{isEditing:d(this,Mn)!==Ye.NONE,isEmpty:z(this,_e,lg).call(this),hasSomethingToUndo:d(this,Fr).hasSomethingToUndo(),hasSomethingToRedo:d(this,Fr).hasSomethingToRedo(),hasSelectedEditor:!1})):(z(this,_e,TU).call(this),z(this,_e,lS).call(this),z(this,_e,Ii).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!d(this,ws)){R(this,ws,e);for(const t of d(this,ws))z(this,_e,Za).call(this,t.defaultPropertiesToUpdate)}}getId(){return d(this,Qb).id}get currentLayer(){return d(this,Wn).get(d(this,yf))}getLayer(e){return d(this,Wn).get(e)}get currentPageIndex(){return d(this,yf)}addLayer(e){d(this,Wn).set(e.pageIndex,e),d(this,Cl)?e.enable():e.disable()}removeLayer(e){d(this,Wn).delete(e.pageIndex)}async updateMode(e,t=null,i=!1){var r;if(d(this,Mn)!==e&&!(d(this,zr)&&(await d(this,zr).promise,!d(this,zr)))){if(R(this,zr,Promise.withResolvers()),R(this,Mn,e),e===Ye.NONE){this.setEditingState(!1),z(this,_e,kU).call(this),(r=this._editorUndoBar)==null||r.hide(),d(this,zr).resolve();return}this.setEditingState(!0),await z(this,_e,CU).call(this),this.unselectAll();for(const s of d(this,Wn).values())s.updateMode(e);if(!t){i&&this.addNewEditorFromKeyboard(),d(this,zr).resolve();return}for(const s of d(this,An).values())s.annotationElementId===t?(this.setSelected(s),s.enterInEditMode()):s.unselect();d(this,zr).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==d(this,Mn)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){var i;if(d(this,ws)){switch(e){case st.CREATE:this.currentLayer.addNewEditor();return;case st.HIGHLIGHT_DEFAULT_COLOR:(i=d(this,Ny))==null||i.updateColor(t);break;case st.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(d(this,My)||R(this,My,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(const r of d(this,xt))r.updateParams(e,t);for(const r of d(this,ws))r.updateDefaultParams(e,t)}}showAllEditors(e,t,i=!1){var s;for(const a of d(this,An).values())a.editorType===e&&a.show(t);(((s=d(this,My))==null?void 0:s.get(st.HIGHLIGHT_SHOW_ALL))??!0)!==t&&z(this,_e,Za).call(this,[[st.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(d(this,Py)!==e){R(this,Py,e);for(const t of d(this,Wn).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){const t=[];for(const i of d(this,An).values())i.pageIndex===e&&t.push(i);return t}getEditor(e){return d(this,An).get(e)}addEditor(e){d(this,An).set(e.id,e)}removeEditor(e){var t;e.div.contains(document.activeElement)&&(d(this,ha)&&clearTimeout(d(this,ha)),R(this,ha,setTimeout(()=>{this.focusMainContainer(),R(this,ha,null)},0))),d(this,An).delete(e.id),this.unselect(e),(!e.annotationElementId||!d(this,Sc).has(e.annotationElementId))&&((t=d(this,so))==null||t.remove(e.id))}addDeletedAnnotationElement(e){d(this,Sc).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return d(this,Sc).has(e)}removeDeletedAnnotationElement(e){d(this,Sc).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){d(this,lr)!==e&&(R(this,lr,e),e&&z(this,_e,Za).call(this,e.propertiesToUpdate))}updateUI(e){d(this,_e,$U)===e&&z(this,_e,Za).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){z(this,_e,Za).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(d(this,xt).has(e)){d(this,xt).delete(e),e.unselect(),z(this,_e,Ii).call(this,{hasSelectedEditor:this.hasSelection});return}d(this,xt).add(e),e.select(),z(this,_e,Za).call(this,e.propertiesToUpdate),z(this,_e,Ii).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;(t=d(this,Tc))==null||t.commitOrRemove();for(const i of d(this,xt))i!==e&&i.unselect();d(this,xt).clear(),d(this,xt).add(e),e.select(),z(this,_e,Za).call(this,e.propertiesToUpdate),z(this,_e,Ii).call(this,{hasSelectedEditor:!0})}isSelected(e){return d(this,xt).has(e)}get firstSelectedEditor(){return d(this,xt).values().next().value}unselect(e){e.unselect(),d(this,xt).delete(e),z(this,_e,Ii).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return d(this,xt).size!==0}get isEnterHandled(){return d(this,xt).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;d(this,Fr).undo(),z(this,_e,Ii).call(this,{hasSomethingToUndo:d(this,Fr).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:z(this,_e,lg).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){d(this,Fr).redo(),z(this,_e,Ii).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:d(this,Fr).hasSomethingToRedo(),isEmpty:z(this,_e,lg).call(this)})}addCommands(e){d(this,Fr).add(e),z(this,_e,Ii).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:z(this,_e,lg).call(this)})}cleanUndoStack(e){d(this,Fr).cleanType(e)}delete(){var s;this.commitOrRemove();const e=(s=this.currentLayer)==null?void 0:s.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...d(this,xt)],i=()=>{var a;(a=this._editorUndoBar)==null||a.show(r,t.length===1?t[0].editorType:t.length);for(const o of t)o.remove()},r=()=>{for(const a of t)z(this,_e,uS).call(this,a)};this.addCommands({cmd:i,undo:r,mustExec:!0})}commitOrRemove(){var e;(e=d(this,lr))==null||e.commitOrRemove()}hasSomethingToControl(){return d(this,lr)||this.hasSelection}selectAll(){for(const e of d(this,xt))e.commit();z(this,_e,cS).call(this,d(this,An).values())}unselectAll(){var e;if(!(d(this,lr)&&(d(this,lr).commitOrRemove(),d(this,Mn)!==Ye.NONE))&&!((e=d(this,Tc))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of d(this,xt))t.unselect();d(this,xt).clear(),z(this,_e,Ii).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,i=!1){if(i||this.commitOrRemove(),!this.hasSelection)return;d(this,$l)[0]+=e,d(this,$l)[1]+=t;const[r,s]=d(this,$l),a=[...d(this,xt)],o=1e3;d(this,pa)&&clearTimeout(d(this,pa)),R(this,pa,setTimeout(()=>{R(this,pa,null),d(this,$l)[0]=d(this,$l)[1]=0,this.addCommands({cmd:()=>{for(const l of a)d(this,An).has(l.id)&&l.translateInPage(r,s)},undo:()=>{for(const l of a)d(this,An).has(l.id)&&l.translateInPage(-r,-s)},mustExec:!1})},o));for(const l of a)l.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),R(this,da,new Map);for(const e of d(this,xt))d(this,da).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!d(this,da))return!1;this.disableUserSelect(!1);const e=d(this,da);R(this,da,null);let t=!1;for(const[{x:r,y:s,pageIndex:a},o]of e)o.newX=r,o.newY=s,o.newPageIndex=a,t||(t=r!==o.savedX||s!==o.savedY||a!==o.savedPageIndex);if(!t)return!1;const i=(r,s,a,o)=>{if(d(this,An).has(r.id)){const l=d(this,Wn).get(o);l?r._setParentAndPosition(l,s,a):(r.pageIndex=o,r.x=s,r.y=a)}};return this.addCommands({cmd:()=>{for(const[r,{newX:s,newY:a,newPageIndex:o}]of e)i(r,s,a,o)},undo:()=>{for(const[r,{savedX:s,savedY:a,savedPageIndex:o}]of e)i(r,s,a,o)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(d(this,da))for(const i of d(this,da).keys())i.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||d(this,xt).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return d(this,lr)===e}getActive(){return d(this,lr)}getMode(){return d(this,Mn)}get imageManager(){return Ze(this,"imageManager",new iS)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let u=0,c=t.rangeCount;u<c;u++)if(!e.contains(t.getRangeAt(u).commonAncestorContainer))return null;const{x:i,y:r,width:s,height:a}=e.getBoundingClientRect();let o;switch(e.getAttribute("data-main-rotation")){case"90":o=(u,c,h,f)=>({x:(c-r)/a,y:1-(u+h-i)/s,width:f/a,height:h/s});break;case"180":o=(u,c,h,f)=>({x:1-(u+h-i)/s,y:1-(c+f-r)/a,width:h/s,height:f/a});break;case"270":o=(u,c,h,f)=>({x:1-(c+f-r)/a,y:(u-i)/s,width:f/a,height:h/s});break;default:o=(u,c,h,f)=>({x:(u-i)/s,y:(c-r)/a,width:h/s,height:f/a});break}const l=[];for(let u=0,c=t.rangeCount;u<c;u++){const h=t.getRangeAt(u);if(!h.collapsed)for(const{x:f,y:m,width:y,height:_}of h.getClientRects())y===0||_===0||l.push(o(f,m,y,_))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(d(this,gf)||R(this,gf,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=d(this,gf))==null||t.delete(e)}renderAnnotationElement(e){var r;const t=(r=d(this,gf))==null?void 0:r.get(e.data.id);if(!t)return;const i=d(this,so).getRawValue(t);i&&(d(this,Mn)===Ye.NONE&&!i.hasBeenModified||i.renderAnnotationElement(e))}};pf=new WeakMap,lr=new WeakMap,An=new WeakMap,Wn=new WeakMap,mf=new WeakMap,so=new WeakMap,gf=new WeakMap,Fr=new WeakMap,Tl=new WeakMap,Tc=new WeakMap,yf=new WeakMap,Sc=new WeakMap,da=new WeakMap,ws=new WeakMap,Ic=new WeakMap,ky=new WeakMap,$y=new WeakMap,_f=new WeakMap,Ry=new WeakMap,ha=new WeakMap,Sl=new WeakMap,vf=new WeakMap,Il=new WeakMap,fa=new WeakMap,Qb=new WeakMap,Cl=new WeakMap,Py=new WeakMap,kl=new WeakMap,Cc=new WeakMap,Ny=new WeakMap,Dy=new WeakMap,Mn=new WeakMap,xt=new WeakMap,ao=new WeakMap,kc=new WeakMap,My=new WeakMap,Oy=new WeakMap,$l=new WeakMap,pa=new WeakMap,oo=new WeakMap,Ly=new WeakMap,zr=new WeakMap,_e=new WeakSet,p0=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},sS=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const i of d(this,Wn).values())if(i.hasTextLayer(e))return i;return null},bU=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const i=z(this,_e,p0).call(this,e).closest(".textLayer"),r=this.getSelectionBoxes(i);r&&(d(this,fa)||R(this,fa,new lee(this)),d(this,fa).show(i,r,this.direction==="ltr"))},xU=function(){var s,a,o;const e=document.getSelection();if(!e||e.isCollapsed){d(this,ao)&&((s=d(this,fa))==null||s.hide(),R(this,ao,null),z(this,_e,Ii).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===d(this,ao))return;const r=z(this,_e,p0).call(this,e).closest(".textLayer");if(!r){d(this,ao)&&((a=d(this,fa))==null||a.hide(),R(this,ao,null),z(this,_e,Ii).call(this,{hasSelectedText:!1}));return}if((o=d(this,fa))==null||o.hide(),R(this,ao,t),z(this,_e,Ii).call(this,{hasSelectedText:!0}),!(d(this,Mn)!==Ye.HIGHLIGHT&&d(this,Mn)!==Ye.NONE)&&(d(this,Mn)===Ye.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),R(this,Il,this.isShiftKeyDown),!this.isShiftKeyDown)){const l=d(this,Mn)===Ye.HIGHLIGHT?z(this,_e,sS).call(this,r):null;l==null||l.toggleDrawing();const u=new AbortController,c=this.combinedSignal(u),h=f=>{f.type==="pointerup"&&f.button!==0||(u.abort(),l==null||l.toggleDrawing(!0),f.type==="pointerup"&&z(this,_e,m0).call(this,"main_toolbar"))};window.addEventListener("pointerup",h,{signal:c}),window.addEventListener("blur",h,{signal:c})}},m0=function(e=""){d(this,Mn)===Ye.HIGHLIGHT?this.highlightSelection(e):d(this,ky)&&z(this,_e,bU).call(this)},EU=function(){document.addEventListener("selectionchange",z(this,_e,xU).bind(this),{signal:this._signal})},AU=function(){if(d(this,Sl))return;R(this,Sl,new AbortController);const e=this.combinedSignal(d(this,Sl));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},TU=function(){var e;(e=d(this,Sl))==null||e.abort(),R(this,Sl,null)},aS=function(){if(d(this,kl))return;R(this,kl,new AbortController);const e=this.combinedSignal(d(this,kl));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},SU=function(){var e;(e=d(this,kl))==null||e.abort(),R(this,kl,null)},oS=function(){if(d(this,Tl))return;R(this,Tl,new AbortController);const e=this.combinedSignal(d(this,Tl));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},lS=function(){var e;(e=d(this,Tl))==null||e.abort(),R(this,Tl,null)},IU=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},Ii=function(e){Object.entries(e).some(([i,r])=>d(this,Oy)[i]!==r)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(d(this,Oy),e)}),d(this,Mn)===Ye.HIGHLIGHT&&e.hasSelectedEditor===!1&&z(this,_e,Za).call(this,[[st.HIGHLIGHT_FREE,!0]]))},Za=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},CU=async function(){if(!d(this,Cl)){R(this,Cl,!0);const e=[];for(const t of d(this,Wn).values())e.push(t.enable());await Promise.all(e);for(const t of d(this,An).values())t.enable()}},kU=function(){if(this.unselectAll(),d(this,Cl)){R(this,Cl,!1);for(const e of d(this,Wn).values())e.disable();for(const e of d(this,An).values())e.disable()}},uS=function(e){const t=d(this,Wn).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},$U=function(){let e=null;for(e of d(this,xt));return e},lg=function(){if(d(this,An).size===0)return!0;if(d(this,An).size===1)for(const e of d(this,An).values())return e.isEmpty();return!1},cS=function(e){for(const t of d(this,xt))t.unselect();d(this,xt).clear();for(const t of e)t.isEmpty()||(d(this,xt).add(t),t.select());z(this,_e,Ii).call(this,{hasSelectedEditor:this.hasSelection})},Le(Yh,"TRANSLATE_SMALL",1),Le(Yh,"TRANSLATE_BIG",10);let Wd=Yh;var On,ma,bs,wf,ga,ur,bf,ya,Gi,lo,$c,_a,Rl,Ls,ug,g0;const Ci=class Ci{constructor(e){F(this,Ls);F(this,On,null);F(this,ma,!1);F(this,bs,null);F(this,wf,null);F(this,ga,null);F(this,ur,null);F(this,bf,!1);F(this,ya,null);F(this,Gi,null);F(this,lo,null);F(this,$c,null);F(this,_a,!1);R(this,Gi,e),R(this,_a,e._uiManager.useNewAltTextFlow),d(Ci,Rl)||R(Ci,Rl,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){Ci._l10n??(Ci._l10n=e)}async render(){const e=R(this,bs,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=R(this,wf,document.createElement("span"));e.append(t),d(this,_a)?(e.classList.add("new"),e.setAttribute("data-l10n-id",d(Ci,Rl).missing),t.setAttribute("data-l10n-id",d(Ci,Rl)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const i=d(this,Gi)._uiManager._signal;e.addEventListener("contextmenu",qs,{signal:i}),e.addEventListener("pointerdown",s=>s.stopPropagation(),{signal:i});const r=s=>{s.preventDefault(),d(this,Gi)._uiManager.editAltText(d(this,Gi)),d(this,_a)&&d(this,Gi)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:d(this,Ls,ug)}})};return e.addEventListener("click",r,{capture:!0,signal:i}),e.addEventListener("keydown",s=>{s.target===e&&s.key==="Enter"&&(R(this,bf,!0),r(s))},{signal:i}),await z(this,Ls,g0).call(this),e}finish(){d(this,bs)&&(d(this,bs).focus({focusVisible:d(this,bf)}),R(this,bf,!1))}isEmpty(){return d(this,_a)?d(this,On)===null:!d(this,On)&&!d(this,ma)}hasData(){return d(this,_a)?d(this,On)!==null||!!d(this,lo):this.isEmpty()}get guessedText(){return d(this,lo)}async setGuessedText(e){d(this,On)===null&&(R(this,lo,e),R(this,$c,await Ci._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),z(this,Ls,g0).call(this))}toggleAltTextBadge(e=!1){var t;if(!d(this,_a)||d(this,On)){(t=d(this,ya))==null||t.remove(),R(this,ya,null);return}if(!d(this,ya)){const i=R(this,ya,document.createElement("div"));i.className="noAltTextBadge",d(this,Gi).div.append(i)}d(this,ya).classList.toggle("hidden",!e)}serialize(e){let t=d(this,On);return!e&&d(this,lo)===t&&(t=d(this,$c)),{altText:t,decorative:d(this,ma),guessedText:d(this,lo),textWithDisclaimer:d(this,$c)}}get data(){return{altText:d(this,On),decorative:d(this,ma)}}set data({altText:e,decorative:t,guessedText:i,textWithDisclaimer:r,cancel:s=!1}){i&&(R(this,lo,i),R(this,$c,r)),!(d(this,On)===e&&d(this,ma)===t)&&(s||(R(this,On,e),R(this,ma,t)),z(this,Ls,g0).call(this))}toggle(e=!1){d(this,bs)&&(!e&&d(this,ur)&&(clearTimeout(d(this,ur)),R(this,ur,null)),d(this,bs).disabled=!e)}shown(){d(this,Gi)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:d(this,Ls,ug)}})}destroy(){var e,t;(e=d(this,bs))==null||e.remove(),R(this,bs,null),R(this,wf,null),R(this,ga,null),(t=d(this,ya))==null||t.remove(),R(this,ya,null)}};On=new WeakMap,ma=new WeakMap,bs=new WeakMap,wf=new WeakMap,ga=new WeakMap,ur=new WeakMap,bf=new WeakMap,ya=new WeakMap,Gi=new WeakMap,lo=new WeakMap,$c=new WeakMap,_a=new WeakMap,Rl=new WeakMap,Ls=new WeakSet,ug=function(){return d(this,On)&&"added"||d(this,On)===null&&this.guessedText&&"review"||"missing"},g0=async function(){var r,s,a;const e=d(this,bs);if(!e)return;if(d(this,_a)){if(e.classList.toggle("done",!!d(this,On)),e.setAttribute("data-l10n-id",d(Ci,Rl)[d(this,Ls,ug)]),(r=d(this,wf))==null||r.setAttribute("data-l10n-id",d(Ci,Rl)[`${d(this,Ls,ug)}-label`]),!d(this,On)){(s=d(this,ga))==null||s.remove();return}}else{if(!d(this,On)&&!d(this,ma)){e.classList.remove("done"),(a=d(this,ga))==null||a.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=d(this,ga);if(!t){R(this,ga,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${d(this,Gi).id}`;const o=100,l=d(this,Gi)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(d(this,ur)),R(this,ur,null)},{once:!0}),e.addEventListener("mouseenter",()=>{R(this,ur,setTimeout(()=>{R(this,ur,null),d(this,ga).classList.add("show"),d(this,Gi)._reportTelemetry({action:"alt_text_tooltip"})},o))},{signal:l}),e.addEventListener("mouseleave",()=>{var u;d(this,ur)&&(clearTimeout(d(this,ur)),R(this,ur,null)),(u=d(this,ga))==null||u.classList.remove("show")},{signal:l})}d(this,ma)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=d(this,On)),t.parentNode||e.append(t);const i=d(this,Gi).getImageForAltText();i==null||i.setAttribute("aria-describedby",t.id)},F(Ci,Rl,null),Le(Ci,"_l10n",null);let Vb=Ci;var Fy,Rc,zy,Vy,jy,By,Uy,xf,uo,Pc,Pl,Qo,RU,PU,dS;const HC=class HC{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:i=null,onPinchStart:r=null,onPinching:s=null,onPinchEnd:a=null,signal:o}){F(this,Qo);F(this,Fy);F(this,Rc,!1);F(this,zy,null);F(this,Vy);F(this,jy);F(this,By);F(this,Uy);F(this,xf);F(this,uo,null);F(this,Pc);F(this,Pl,null);R(this,Fy,e),R(this,zy,i),R(this,Vy,t),R(this,jy,r),R(this,By,s),R(this,Uy,a),R(this,Pc,new AbortController),R(this,xf,AbortSignal.any([o,d(this,Pc).signal])),e.addEventListener("touchstart",z(this,Qo,RU).bind(this),{passive:!1,signal:d(this,xf)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return Ze(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}destroy(){var e;(e=d(this,Pc))==null||e.abort(),R(this,Pc,null)}};Fy=new WeakMap,Rc=new WeakMap,zy=new WeakMap,Vy=new WeakMap,jy=new WeakMap,By=new WeakMap,Uy=new WeakMap,xf=new WeakMap,uo=new WeakMap,Pc=new WeakMap,Pl=new WeakMap,Qo=new WeakSet,RU=function(e){var r,s,a;if((r=d(this,Vy))!=null&&r.call(this)||e.touches.length<2)return;if(!d(this,Pl)){R(this,Pl,new AbortController);const o=AbortSignal.any([d(this,xf),d(this,Pl).signal]),l=d(this,Fy),u={signal:o,passive:!1};l.addEventListener("touchmove",z(this,Qo,PU).bind(this),u),l.addEventListener("touchend",z(this,Qo,dS).bind(this),u),l.addEventListener("touchcancel",z(this,Qo,dS).bind(this),u),(s=d(this,jy))==null||s.call(this)}if(Tr(e),e.touches.length!==2||(a=d(this,zy))!=null&&a.call(this)){R(this,uo,null);return}let[t,i]=e.touches;t.identifier>i.identifier&&([t,i]=[i,t]),R(this,uo,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:i.screenX,touch1Y:i.screenY})},PU=function(e){var C;if(!d(this,uo)||e.touches.length!==2)return;let[t,i]=e.touches;t.identifier>i.identifier&&([t,i]=[i,t]);const{screenX:r,screenY:s}=t,{screenX:a,screenY:o}=i,l=d(this,uo),{touch0X:u,touch0Y:c,touch1X:h,touch1Y:f}=l,m=h-u,y=f-c,_=a-r,x=o-s,v=Math.hypot(_,x)||1,w=Math.hypot(m,y)||1;if(!d(this,Rc)&&Math.abs(w-v)<=HC.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=r,l.touch0Y=s,l.touch1X=a,l.touch1Y=o,e.preventDefault(),!d(this,Rc)){R(this,Rc,!0);return}const E=[(r+a)/2,(s+o)/2];(C=d(this,By))==null||C.call(this,E,w,v)},dS=function(e){var t;d(this,Pl).abort(),R(this,Pl,null),(t=d(this,Uy))==null||t.call(this),d(this,uo)&&(e.preventDefault(),R(this,uo,null),R(this,Rc,!1))};let jb=HC;var Nc,xs,Lt,Ef,Nl,Hy,Dc,qn,Mc,co,Dl,Wy,Oc,cr,qy,Lc,ho,va,Af,Tf,Vr,Fc,Gy,Jb,Fe,hS,Ky,fS,y0,NU,DU,pS,_0,mS,MU,OU,LU,gS,FU,yS,zU,VU,jU,_S,cg;const Qe=class Qe{constructor(e){F(this,Fe);F(this,Nc,null);F(this,xs,null);F(this,Lt,null);F(this,Ef,!1);F(this,Nl,null);F(this,Hy,"");F(this,Dc,!1);F(this,qn,null);F(this,Mc,null);F(this,co,null);F(this,Dl,null);F(this,Wy,"");F(this,Oc,!1);F(this,cr,null);F(this,qy,!1);F(this,Lc,!1);F(this,ho,!1);F(this,va,null);F(this,Af,0);F(this,Tf,0);F(this,Vr,null);F(this,Fc,null);Le(this,"_editToolbar",null);Le(this,"_initialOptions",Object.create(null));Le(this,"_initialData",null);Le(this,"_isVisible",!0);Le(this,"_uiManager",null);Le(this,"_focusEventsAllowed",!0);F(this,Gy,!1);F(this,Jb,Qe._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:i,pageHeight:r,pageX:s,pageY:a}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,r],this.pageTranslation=[s,a];const[o,l]=this.parentDimensions;this.x=e.x/o,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=Qe.prototype._resizeWithKeyboard,t=Wd.TRANSLATE_SMALL,i=Wd.TRANSLATE_BIG;return Ze(this,"_resizerKeyboardManager",new hv([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,i]}],[["Escape","mac+Escape"],Qe.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return Ze(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new dee({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(Qe._l10n??(Qe._l10n=e),Qe._l10nResizer||(Qe._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),Qe._borderLineWidth!==-1)return;const i=getComputedStyle(document.documentElement);Qe._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){Rt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return d(this,Gy)}set _isDraggable(e){var t;R(this,Gy,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=d(this,Jb)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):z(this,Fe,cg).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(d(this,Oc)?R(this,Oc,!1):this.parent.setSelected(this))}focusout(e){var i;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(i=this.parent)!=null&&i.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,i,r){const[s,a]=this.parentDimensions;[i,r]=this.screenToPageTranslation(i,r),this.x=(e+i)/s,this.y=(t+r)/a,this.fixAndSetPosition()}translate(e,t){z(this,Fe,hS).call(this,this.parentDimensions,e,t)}translateInPage(e,t){d(this,cr)||R(this,cr,[this.x,this.y,this.width,this.height]),z(this,Fe,hS).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){d(this,cr)||R(this,cr,[this.x,this.y,this.width,this.height]);const{div:i,parentDimensions:[r,s]}=this;if(this.x+=e/r,this.y+=t/s,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:h,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,h,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:o}=this;const[l,u]=this.getBaseTranslation();a+=l,o+=u;const{style:c}=i;c.left=`${(100*a).toFixed(2)}%`,c.top=`${(100*o).toFixed(2)}%`,this._onTranslating(a,o),i.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!d(this,cr)&&(d(this,cr)[0]!==this.x||d(this,cr)[1]!==this.y)}get _hasBeenResized(){return!!d(this,cr)&&(d(this,cr)[2]!==this.width||d(this,cr)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:i}=Qe,r=i/e,s=i/t;switch(this.rotation){case 90:return[-r,s];case 180:return[r,s];case 270:return[r,-s];default:return[-r,-s]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[i,r]}=this;let{x:s,y:a,width:o,height:l}=this;if(o*=i,l*=r,s*=i,a*=r,this._mustFixPosition)switch(e){case 0:s=Math.max(0,Math.min(i-o,s)),a=Math.max(0,Math.min(r-l,a));break;case 90:s=Math.max(0,Math.min(i-l,s)),a=Math.min(r,Math.max(o,a));break;case 180:s=Math.min(i,Math.max(o,s)),a=Math.min(r,Math.max(l,a));break;case 270:s=Math.min(i,Math.max(l,s)),a=Math.max(0,Math.min(r-o,a));break}this.x=s/=i,this.y=a/=r;const[u,c]=this.getBaseTranslation();s+=u,a+=c,t.left=`${(100*s).toFixed(2)}%`,t.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var i;return z(i=Qe,Ky,fS).call(i,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var i;return z(i=Qe,Ky,fS).call(i,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,i]}=this;return[t*e,i*e]}setDims(e,t){const[i,r]=this.parentDimensions,{style:s}=this.div;s.width=`${(100*e/i).toFixed(2)}%`,d(this,Dc)||(s.height=`${(100*t/r).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:i}=e,r=i.endsWith("%"),s=!d(this,Dc)&&t.endsWith("%");if(r&&s)return;const[a,o]=this.parentDimensions;r||(e.width=`${(100*parseFloat(i)/a).toFixed(2)}%`),!d(this,Dc)&&!s&&(e.height=`${(100*parseFloat(t)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=d(this,Lt))==null||e.finish()}async addEditToolbar(){return this._editToolbar||d(this,Lc)?this._editToolbar:(this._editToolbar=new tS(this),this.div.append(this._editToolbar.render()),d(this,Lt)&&await this._editToolbar.addAltText(d(this,Lt)),this._editToolbar)}removeEditToolbar(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(e=d(this,Lt))==null||e.destroy())}addContainer(e){var i;const t=(i=this._editToolbar)==null?void 0:i.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){d(this,Lt)||(Vb.initialize(Qe._l10n),R(this,Lt,new Vb(this)),d(this,Nc)&&(d(this,Lt).data=d(this,Nc),R(this,Nc,null)),await this.addEditToolbar())}get altTextData(){var e;return(e=d(this,Lt))==null?void 0:e.data}set altTextData(e){d(this,Lt)&&(d(this,Lt).data=e)}get guessedAltText(){var e;return(e=d(this,Lt))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=d(this,Lt))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=d(this,Lt))==null?void 0:t.serialize(e)}hasAltText(){return!!d(this,Lt)&&!d(this,Lt).isEmpty()}hasAltTextData(){var e;return((e=d(this,Lt))==null?void 0:e.hasData())??!1}render(){var s;this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=d(this,Ef)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),z(this,Fe,yS).call(this);const[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);const[i,r]=this.getInitialTranslation();return this.translate(i,r),zb(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(d(this,Fc)||R(this,Fc,new jb({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:z(this,Fe,MU).bind(this),onPinching:z(this,Fe,OU).bind(this),onPinchEnd:z(this,Fe,LU).bind(this),signal:this._uiManager._signal}))),(s=this._uiManager._editorUndoBar)==null||s.hide(),this.div}pointerdown(e){const{isMac:t}=Di.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(R(this,Oc,!0),this._isDraggable){z(this,Fe,FU).call(this,e);return}z(this,Fe,gS).call(this,e)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){d(this,va)&&clearTimeout(d(this,va)),R(this,va,setTimeout(()=>{var e;R(this,va,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,i){e.changeParent(this),this.x=t,this.y=i,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,i=this.rotation){const r=this.parentScale,[s,a]=this.pageDimensions,[o,l]=this.pageTranslation,u=e/r,c=t/r,h=this.x*s,f=this.y*a,m=this.width*s,y=this.height*a;switch(i){case 0:return[h+u+o,a-f-c-y+l,h+u+m+o,a-f-c+l];case 90:return[h+c+o,a-f+u+l,h+c+y+o,a-f+u+m+l];case 180:return[h-u-m+o,a-f+c+l,h-u+o,a-f+c+y+l];case 270:return[h-c-y+o,a-f-u-m+l,h-c+o,a-f-u+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[i,r,s,a]=e,o=s-i,l=a-r;switch(this.rotation){case 0:return[i,t-a,o,l];case 90:return[i,t-r,l,o];case 180:return[s,t-r,o,l];case 270:return[s,t-a,l,o];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){R(this,Lc,!0)}disableEditMode(){R(this,Lc,!1)}isInEditMode(){return d(this,Lc)}shouldGetKeyboardEvents(){return d(this,ho)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:i,right:r}=this.getClientDimensions(),{innerHeight:s,innerWidth:a}=window;return t<a&&r>0&&e<s&&i>0}rebuild(){z(this,Fe,yS).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){Rt("An editor must be serializable")}static async deserialize(e,t,i){const r=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:i});r.rotation=e.rotation,R(r,Nc,e.accessibilityData);const[s,a]=r.pageDimensions,[o,l,u,c]=r.getRectInCurrentCoords(e.rect,a);return r.x=o/s,r.y=l/a,r.width=u/s,r.height=c/a,r}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t;if((e=d(this,Dl))==null||e.abort(),R(this,Dl,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),d(this,va)&&(clearTimeout(d(this,va)),R(this,va,null)),z(this,Fe,cg).call(this),this.removeEditToolbar(),d(this,Vr)){for(const i of d(this,Vr).values())clearTimeout(i);R(this,Vr,null)}this.parent=null,(t=d(this,Fc))==null||t.destroy(),R(this,Fc,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(z(this,Fe,NU).call(this),d(this,qn).classList.remove("hidden"),zb(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),R(this,co,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=d(this,qn).children;if(!d(this,xs)){R(this,xs,Array.from(t));const a=z(this,Fe,zU).bind(this),o=z(this,Fe,VU).bind(this),l=this._uiManager._signal;for(const u of d(this,xs)){const c=u.getAttribute("data-resizer-name");u.setAttribute("role","spinbutton"),u.addEventListener("keydown",a,{signal:l}),u.addEventListener("blur",o,{signal:l}),u.addEventListener("focus",z(this,Fe,jU).bind(this,c),{signal:l}),u.setAttribute("data-l10n-id",Qe._l10nResizer[c])}}const i=d(this,xs)[0];let r=0;for(const a of t){if(a===i)break;r++}const s=(360-this.rotation+this.parentRotation)%360/90*(d(this,xs).length/4);if(s!==r){if(s<r)for(let o=0;o<r-s;o++)d(this,qn).append(d(this,qn).firstChild);else if(s>r)for(let o=0;o<s-r;o++)d(this,qn).firstChild.before(d(this,qn).lastChild);let a=0;for(const o of t){const u=d(this,xs)[a++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",Qe._l10nResizer[u])}}z(this,Fe,_S).call(this,0),R(this,ho,!0),d(this,qn).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){d(this,ho)&&z(this,Fe,mS).call(this,d(this,Wy),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){z(this,Fe,cg).call(this),this.div.focus()}select(){var e,t,i;if(this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var r,s;(r=this.div)!=null&&r.classList.contains("selectedEditor")&&((s=this._editToolbar)==null||s.show())});return}(t=this._editToolbar)==null||t.show(),(i=d(this,Lt))==null||i.toggleAltTextBadge(!1)}unselect(){var e,t,i,r,s;(e=d(this,qn))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(i=this.div)!=null&&i.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(r=this._editToolbar)==null||r.hide(),(s=d(this,Lt))==null||s.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return d(this,qy)}set isEditing(e){R(this,qy,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){R(this,Dc,!0);const i=e/t,{style:r}=this.div;r.aspectRatio=i,r.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){d(this,Vr)||R(this,Vr,new Map);const{action:i}=e;let r=d(this,Vr).get(i);r&&clearTimeout(r),r=setTimeout(()=>{this._reportTelemetry(e),d(this,Vr).delete(i),d(this,Vr).size===0&&R(this,Vr,null)},Qe._telemetryTimeout),d(this,Vr).set(i,r);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),R(this,Ef,!1)}disable(){this.div&&(this.div.tabIndex=-1),R(this,Ef,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const i=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),i.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};Nc=new WeakMap,xs=new WeakMap,Lt=new WeakMap,Ef=new WeakMap,Nl=new WeakMap,Hy=new WeakMap,Dc=new WeakMap,qn=new WeakMap,Mc=new WeakMap,co=new WeakMap,Dl=new WeakMap,Wy=new WeakMap,Oc=new WeakMap,cr=new WeakMap,qy=new WeakMap,Lc=new WeakMap,ho=new WeakMap,va=new WeakMap,Af=new WeakMap,Tf=new WeakMap,Vr=new WeakMap,Fc=new WeakMap,Gy=new WeakMap,Jb=new WeakMap,Fe=new WeakSet,hS=function([e,t],i,r){[i,r]=this.screenToPageTranslation(i,r),this.x+=i/e,this.y+=r/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},Ky=new WeakSet,fS=function(e,t,i){switch(i){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},y0=function(e){switch(e){case 90:{const[t,i]=this.pageDimensions;return[0,-t/i,i/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,i]=this.pageDimensions;return[0,t/i,-i/t,0]}default:return[1,0,0,1]}},NU=function(){if(d(this,qn))return;R(this,qn,document.createElement("div")),d(this,qn).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const i of e){const r=document.createElement("div");d(this,qn).append(r),r.classList.add("resizer",i),r.setAttribute("data-resizer-name",i),r.addEventListener("pointerdown",z(this,Fe,DU).bind(this,i),{signal:t}),r.addEventListener("contextmenu",qs,{signal:t}),r.tabIndex=-1}this.div.prepend(d(this,qn))},DU=function(e,t){var c;t.preventDefault();const{isMac:i}=Di.platform;if(t.button!==0||t.ctrlKey&&i)return;(c=d(this,Lt))==null||c.toggle(!1);const r=this._isDraggable;this._isDraggable=!1,R(this,Mc,[t.screenX,t.screenY]);const s=new AbortController,a=this._uiManager.combinedSignal(s);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",z(this,Fe,mS).bind(this,e),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",Tr,{passive:!1,signal:a}),window.addEventListener("contextmenu",qs,{signal:a}),R(this,co,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const o=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const u=()=>{var h;s.abort(),this.parent.togglePointerEvents(!0),(h=d(this,Lt))==null||h.toggle(!0),this._isDraggable=r,this.parent.div.style.cursor=o,this.div.style.cursor=l,z(this,Fe,_0).call(this)};window.addEventListener("pointerup",u,{signal:a}),window.addEventListener("blur",u,{signal:a})},pS=function(e,t,i,r){this.width=i,this.height=r,this.x=e,this.y=t;const[s,a]=this.parentDimensions;this.setDims(s*i,a*r),this.fixAndSetPosition(),this._onResized()},_0=function(){if(!d(this,co))return;const{savedX:e,savedY:t,savedWidth:i,savedHeight:r}=d(this,co);R(this,co,null);const s=this.x,a=this.y,o=this.width,l=this.height;s===e&&a===t&&o===i&&l===r||this.addCommands({cmd:z(this,Fe,pS).bind(this,s,a,o,l),undo:z(this,Fe,pS).bind(this,e,t,i,r),mustExec:!0})},mS=function(e,t){const[i,r]=this.parentDimensions,s=this.x,a=this.y,o=this.width,l=this.height,u=Qe.MIN_SIZE/i,c=Qe.MIN_SIZE/r,h=z(this,Fe,y0).call(this,this.rotation),f=(ee,ae)=>[h[0]*ee+h[2]*ae,h[1]*ee+h[3]*ae],m=z(this,Fe,y0).call(this,360-this.rotation),y=(ee,ae)=>[m[0]*ee+m[2]*ae,m[1]*ee+m[3]*ae];let _,x,v=!1,w=!1;switch(e){case"topLeft":v=!0,_=(ee,ae)=>[0,0],x=(ee,ae)=>[ee,ae];break;case"topMiddle":_=(ee,ae)=>[ee/2,0],x=(ee,ae)=>[ee/2,ae];break;case"topRight":v=!0,_=(ee,ae)=>[ee,0],x=(ee,ae)=>[0,ae];break;case"middleRight":w=!0,_=(ee,ae)=>[ee,ae/2],x=(ee,ae)=>[0,ae/2];break;case"bottomRight":v=!0,_=(ee,ae)=>[ee,ae],x=(ee,ae)=>[0,0];break;case"bottomMiddle":_=(ee,ae)=>[ee/2,ae],x=(ee,ae)=>[ee/2,0];break;case"bottomLeft":v=!0,_=(ee,ae)=>[0,ae],x=(ee,ae)=>[ee,0];break;case"middleLeft":w=!0,_=(ee,ae)=>[0,ae/2],x=(ee,ae)=>[ee,ae/2];break}const E=_(o,l),C=x(o,l);let D=f(...C);const V=Qe._round(s+D[0]),I=Qe._round(a+D[1]);let k=1,N=1,L,j;if(t.fromKeyboard)({deltaX:L,deltaY:j}=t);else{const{screenX:ee,screenY:ae}=t,[J,q]=d(this,Mc);[L,j]=this.screenToPageTranslation(ee-J,ae-q),d(this,Mc)[0]=ee,d(this,Mc)[1]=ae}if([L,j]=y(L/i,j/r),v){const ee=Math.hypot(o,l);k=N=Math.max(Math.min(Math.hypot(C[0]-E[0]-L,C[1]-E[1]-j)/ee,1/o,1/l),u/o,c/l)}else w?k=Math.max(u,Math.min(1,Math.abs(C[0]-E[0]-L)))/o:N=Math.max(c,Math.min(1,Math.abs(C[1]-E[1]-j)))/l;const H=Qe._round(o*k),M=Qe._round(l*N);D=f(...x(H,M));const se=V-D[0],ue=I-D[1];d(this,cr)||R(this,cr,[this.x,this.y,this.width,this.height]),this.width=H,this.height=M,this.x=se,this.y=ue,this.setDims(i*H,r*M),this.fixAndSetPosition(),this._onResizing()},MU=function(){var e;R(this,co,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=d(this,Lt))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},OU=function(e,t,i){let s=.7*(i/t)+1-.7;if(s===1)return;const a=z(this,Fe,y0).call(this,this.rotation),o=(V,I)=>[a[0]*V+a[2]*I,a[1]*V+a[3]*I],[l,u]=this.parentDimensions,c=this.x,h=this.y,f=this.width,m=this.height,y=Qe.MIN_SIZE/l,_=Qe.MIN_SIZE/u;s=Math.max(Math.min(s,1/f,1/m),y/f,_/m);const x=Qe._round(f*s),v=Qe._round(m*s);if(x===f&&v===m)return;d(this,cr)||R(this,cr,[c,h,f,m]);const w=o(f/2,m/2),E=Qe._round(c+w[0]),C=Qe._round(h+w[1]),D=o(x/2,v/2);this.x=E-D[0],this.y=C-D[1],this.width=x,this.height=v,this.setDims(l*x,u*v),this.fixAndSetPosition(),this._onResizing()},LU=function(){var e;(e=d(this,Lt))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),z(this,Fe,_0).call(this)},gS=function(e){const{isMac:t}=Di.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},FU=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let i=!1;const r=new AbortController,s=this._uiManager.combinedSignal(r),a={capture:!0,passive:!1,signal:s},o=u=>{r.abort(),R(this,Nl,null),R(this,Oc,!1),this._uiManager.endDragSession()||z(this,Fe,gS).call(this,u),i&&this._onStopDragging()};t&&(R(this,Af,e.clientX),R(this,Tf,e.clientY),R(this,Nl,e.pointerId),R(this,Hy,e.pointerType),window.addEventListener("pointermove",u=>{i||(i=!0,this._onStartDragging());const{clientX:c,clientY:h,pointerId:f}=u;if(f!==d(this,Nl)){Tr(u);return}const[m,y]=this.screenToPageTranslation(c-d(this,Af),h-d(this,Tf));R(this,Af,c),R(this,Tf,h),this._uiManager.dragSelectedEditors(m,y)},a),window.addEventListener("touchmove",Tr,a),window.addEventListener("pointerdown",u=>{u.pointerType===d(this,Hy)&&(d(this,Fc)||u.isPrimary)&&o(u),Tr(u)},a));const l=u=>{if(!d(this,Nl)||d(this,Nl)===u.pointerId){o(u);return}Tr(u)};window.addEventListener("pointerup",l,{signal:s}),window.addEventListener("blur",l,{signal:s})},yS=function(){if(d(this,Dl)||!this.div)return;R(this,Dl,new AbortController);const e=this._uiManager.combinedSignal(d(this,Dl));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},zU=function(e){Qe._resizerKeyboardManager.exec(this,e)},VU=function(e){var t;d(this,ho)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==d(this,qn)&&z(this,Fe,cg).call(this)},jU=function(e){R(this,Wy,d(this,ho)?e:"")},_S=function(e){if(d(this,xs))for(const t of d(this,xs))t.tabIndex=e},cg=function(){R(this,ho,!1),z(this,Fe,_S).call(this,-1),z(this,Fe,_0).call(this)},F(Qe,Ky),Le(Qe,"_l10n",null),Le(Qe,"_l10nResizer",null),Le(Qe,"_borderLineWidth",-1),Le(Qe,"_colorManager",new rS),Le(Qe,"_zIndex",1),Le(Qe,"_telemetryTimeout",1e3);let Yt=Qe;class dee extends Yt{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const nO=3285377520,Lr=4294901760,oa=65535;class BU{constructor(e){this.h1=e?e&4294967295:nO,this.h2=e?e&4294967295:nO}update(e){let t,i;if(typeof e=="string"){t=new Uint8Array(e.length*2),i=0;for(let _=0,x=e.length;_<x;_++){const v=e.charCodeAt(_);v<=255?t[i++]=v:(t[i++]=v>>>8,t[i++]=v&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),i=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const r=i>>2,s=i-r*4,a=new Uint32Array(t.buffer,0,r);let o=0,l=0,u=this.h1,c=this.h2;const h=3432918353,f=461845907,m=h&oa,y=f&oa;for(let _=0;_<r;_++)_&1?(o=a[_],o=o*h&Lr|o*m&oa,o=o<<15|o>>>17,o=o*f&Lr|o*y&oa,u^=o,u=u<<13|u>>>19,u=u*5+3864292196):(l=a[_],l=l*h&Lr|l*m&oa,l=l<<15|l>>>17,l=l*f&Lr|l*y&oa,c^=l,c=c<<13|c>>>19,c=c*5+3864292196);switch(o=0,s){case 3:o^=t[r*4+2]<<16;case 2:o^=t[r*4+1]<<8;case 1:o^=t[r*4],o=o*h&Lr|o*m&oa,o=o<<15|o>>>17,o=o*f&Lr|o*y&oa,r&1?u^=o:c^=o}this.h1=u,this.h2=c}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&Lr|e*36045&oa,t=t*4283543511&Lr|((t<<16|e>>>16)*2950163797&Lr)>>>16,e^=t>>>1,e=e*444984403&Lr|e*60499&oa,t=t*3301882366&Lr|((t<<16|e>>>16)*3120437893&Lr)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const vS=Object.freeze({map:null,hash:"",transfer:void 0});var zc,Vc,Ln,Zb,UU;class FC{constructor(){F(this,Zb);F(this,zc,!1);F(this,Vc,null);F(this,Ln,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const i=d(this,Ln).get(e);return i===void 0?t:Object.assign(t,i)}getRawValue(e){return d(this,Ln).get(e)}remove(e){if(d(this,Ln).delete(e),d(this,Ln).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const t of d(this,Ln).values())if(t instanceof Yt)return;this.onAnnotationEditor(null)}}setValue(e,t){const i=d(this,Ln).get(e);let r=!1;if(i!==void 0)for(const[s,a]of Object.entries(t))i[s]!==a&&(r=!0,i[s]=a);else r=!0,d(this,Ln).set(e,t);r&&z(this,Zb,UU).call(this),t instanceof Yt&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return d(this,Ln).has(e)}getAll(){return d(this,Ln).size>0?PC(d(this,Ln)):null}setAll(e){for(const[t,i]of Object.entries(e))this.setValue(t,i)}get size(){return d(this,Ln).size}resetModified(){d(this,zc)&&(R(this,zc,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new HU(this)}get serializable(){if(d(this,Ln).size===0)return vS;const e=new Map,t=new BU,i=[],r=Object.create(null);let s=!1;for(const[a,o]of d(this,Ln)){const l=o instanceof Yt?o.serialize(!1,r):o;l&&(e.set(a,l),t.update(`${a}:${JSON.stringify(l)}`),s||(s=!!l.bitmap))}if(s)for(const a of e.values())a.bitmap&&i.push(a.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:i}:vS}get editorStats(){let e=null;const t=new Map;for(const i of d(this,Ln).values()){if(!(i instanceof Yt))continue;const r=i.telemetryFinalData;if(!r)continue;const{type:s}=r;t.has(s)||t.set(s,Object.getPrototypeOf(i).constructor),e||(e=Object.create(null));const a=e[s]||(e[s]=new Map);for(const[o,l]of Object.entries(r)){if(o==="type")continue;let u=a.get(o);u||(u=new Map,a.set(o,u));const c=u.get(l)??0;u.set(l,c+1)}}for(const[i,r]of t)e[i]=r.computeTelemetryFinalData(e[i]);return e}resetModifiedIds(){R(this,Vc,null)}get modifiedIds(){if(d(this,Vc))return d(this,Vc);const e=[];for(const t of d(this,Ln).values())!(t instanceof Yt)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return R(this,Vc,{ids:new Set(e),hash:e.join(",")})}}zc=new WeakMap,Vc=new WeakMap,Ln=new WeakMap,Zb=new WeakSet,UU=function(){d(this,zc)||(R(this,zc,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var Yy;class HU extends FC{constructor(t){super();F(this,Yy);const{map:i,hash:r,transfer:s}=t.serializable,a=structuredClone(i,s?{transfer:s}:null);R(this,Yy,{map:a,hash:r,transfer:s})}get print(){Rt("Should not call PrintAnnotationStorage.print")}get serializable(){return d(this,Yy)}get modifiedIds(){return Ze(this,"modifiedIds",{ids:new Set,hash:""})}}Yy=new WeakMap;var Sf;class hee{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){F(this,Sf,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),d(this,Sf).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,_inspectFont:t}){if(!(!e||d(this,Sf).has(e.loadedName))){if(yn(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:r,style:s}=e,a=new FontFace(i,r,s);this.addNativeFontFace(a);try{await a.load(),d(this,Sf).add(i),t==null||t(e)}catch{Xe(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}Rt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const i=e.createNativeFontFace();if(i){this.addNativeFontFace(i);try{await i.loaded}catch(r){throw Xe(`Failed to load font '${i.family}': '${r}'.`),e.disableFontFace=!0,r}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(i=>{const r=this._queueLoadingCallback(i);this._prepareFontLoadEvent(e,r)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return Ze(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(wi||typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),Ze(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(yn(!r.done,"completeRequest() cannot be called twice."),r.done=!0;i.length>0&&i[0].done;){const s=i.shift();setTimeout(s.callback,0)}}const{loadingRequests:i}=this,r={done:!1,complete:t,callback:e};return i.push(r),r}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Ze(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function i(C,D){return C.charCodeAt(D)<<24|C.charCodeAt(D+1)<<16|C.charCodeAt(D+2)<<8|C.charCodeAt(D+3)&255}function r(C,D,V,I){const k=C.substring(0,D),N=C.substring(D+V);return k+I+N}let s,a;const o=this._document.createElement("canvas");o.width=1,o.height=1;const l=o.getContext("2d");let u=0;function c(C,D){if(++u>30){Xe("Load test font never loaded."),D();return}if(l.font="30px "+C,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){D();return}setTimeout(c.bind(null,C,D))}const h=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=r(f,976,h.length,h);const y=16,_=1482184792;let x=i(f,y);for(s=0,a=h.length-3;s<a;s+=4)x=x-_+i(h,s)|0;s<h.length&&(x=x-_+i(h+"XXX",s)|0),f=r(f,y,4,QZ(x));const v=`url(data:font/opentype;base64,${btoa(f)});`,w=`@font-face {font-family:"${h}";src:${v}}`;this.insertRule(w);const E=this._document.createElement("div");E.style.visibility="hidden",E.style.width=E.style.height="10px",E.style.position="absolute",E.style.top=E.style.left="0px";for(const C of[e.loadedName,h]){const D=this._document.createElement("span");D.textContent="Hi",D.style.fontFamily=C,E.append(D)}this._document.body.append(E),c(h,()=>{E.remove(),t.complete()})}}Sf=new WeakMap;class fee{constructor(e,{disableFontFace:t=!1,fontExtraProperties:i=!1,inspectFont:r=null}){this.compiledGlyphs=Object.create(null);for(const s in e)this[s]=e[s];this.disableFontFace=t===!0,this.fontExtraProperties=i===!0,this._inspectFont=r}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const i={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(i.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,i)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var i;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${iee(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let r=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(r+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${r}src:${e}}`}return(i=this._inspectFont)==null||i.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const i=this.loadedName+"_path_"+t;let r;try{r=e.get(i)}catch(a){Xe(`getPathGenerator - ignoring character: "${a}".`)}const s=new Path2D(r||"");return this.fontExtraProperties||e.delete(i),this.compiledGlyphs[t]=s}}const Dw={DATA:1,ERROR:2},fn={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function iO(){}function Wi(n){if(n instanceof Tu||n instanceof JT||n instanceof wy||n instanceof ZM||n instanceof Fb||n instanceof oA)return n;switch(n instanceof Error||typeof n=="object"&&n!==null||Rt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),n.name){case"AbortException":return new Tu(n.message);case"InvalidPDFException":return new JT(n.message);case"MissingPDFException":return new wy(n.message);case"PasswordException":return new ZM(n.message,n.code);case"UnexpectedResponseException":return new Fb(n.message,n.status);case"UnknownErrorException":return new oA(n.message,n.details)}return new oA(n.message,n.toString())}var If,Jr,WU,qU,GU,v0;class dg{constructor(e,t,i){F(this,Jr);F(this,If,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),i.addEventListener("message",z(this,Jr,WU).bind(this),{signal:d(this,If).signal})}on(e,t){const i=this.actionHandler;if(i[e])throw new Error(`There is already an actionName called "${e}"`);i[e]=t}send(e,t,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},i)}sendWithPromise(e,t,i){const r=this.callbackId++,s=Promise.withResolvers();this.callbackCapabilities[r]=s;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:r,data:t},i)}catch(a){s.reject(a)}return s.promise}sendWithStream(e,t,i,r){const s=this.streamId++,a=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:u=>{const c=Promise.withResolvers();return this.streamControllers[s]={controller:u,startCall:c,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:a,targetName:o,action:e,streamId:s,data:t,desiredSize:u.desiredSize},r),c.promise},pull:u=>{const c=Promise.withResolvers();return this.streamControllers[s].pullCall=c,l.postMessage({sourceName:a,targetName:o,stream:fn.PULL,streamId:s,desiredSize:u.desiredSize}),c.promise},cancel:u=>{yn(u instanceof Error,"cancel must have a valid reason");const c=Promise.withResolvers();return this.streamControllers[s].cancelCall=c,this.streamControllers[s].isClosed=!0,l.postMessage({sourceName:a,targetName:o,stream:fn.CANCEL,streamId:s,reason:Wi(u)}),c.promise}},i)}destroy(){var e;(e=d(this,If))==null||e.abort(),R(this,If,null)}}If=new WeakMap,Jr=new WeakSet,WU=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){z(this,Jr,GU).call(this,e);return}if(e.callback){const i=e.callbackId,r=this.callbackCapabilities[i];if(!r)throw new Error(`Cannot resolve callback ${i}`);if(delete this.callbackCapabilities[i],e.callback===Dw.DATA)r.resolve(e.data);else if(e.callback===Dw.ERROR)r.reject(Wi(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const i=this.sourceName,r=e.sourceName,s=this.comObj;Promise.try(t,e.data).then(function(a){s.postMessage({sourceName:i,targetName:r,callback:Dw.DATA,callbackId:e.callbackId,data:a})},function(a){s.postMessage({sourceName:i,targetName:r,callback:Dw.ERROR,callbackId:e.callbackId,reason:Wi(a)})});return}if(e.streamId){z(this,Jr,qU).call(this,e);return}t(e.data)},qU=function(e){const t=e.streamId,i=this.sourceName,r=e.sourceName,s=this.comObj,a=this,o=this.actionHandler[e.action],l={enqueue(u,c=1,h){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=c,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),s.postMessage({sourceName:i,targetName:r,stream:fn.ENQUEUE,streamId:t,chunk:u},h)},close(){this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:i,targetName:r,stream:fn.CLOSE,streamId:t}),delete a.streamSinks[t])},error(u){yn(u instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,s.postMessage({sourceName:i,targetName:r,stream:fn.ERROR,streamId:t,reason:Wi(u)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(o,e.data,l).then(function(){s.postMessage({sourceName:i,targetName:r,stream:fn.START_COMPLETE,streamId:t,success:!0})},function(u){s.postMessage({sourceName:i,targetName:r,stream:fn.START_COMPLETE,streamId:t,reason:Wi(u)})})},GU=function(e){const t=e.streamId,i=this.sourceName,r=e.sourceName,s=this.comObj,a=this.streamControllers[t],o=this.streamSinks[t];switch(e.stream){case fn.START_COMPLETE:e.success?a.startCall.resolve():a.startCall.reject(Wi(e.reason));break;case fn.PULL_COMPLETE:e.success?a.pullCall.resolve():a.pullCall.reject(Wi(e.reason));break;case fn.PULL:if(!o){s.postMessage({sourceName:i,targetName:r,stream:fn.PULL_COMPLETE,streamId:t,success:!0});break}o.desiredSize<=0&&e.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=e.desiredSize,Promise.try(o.onPull||iO).then(function(){s.postMessage({sourceName:i,targetName:r,stream:fn.PULL_COMPLETE,streamId:t,success:!0})},function(u){s.postMessage({sourceName:i,targetName:r,stream:fn.PULL_COMPLETE,streamId:t,reason:Wi(u)})});break;case fn.ENQUEUE:if(yn(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case fn.CLOSE:if(yn(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),z(this,Jr,v0).call(this,a,t);break;case fn.ERROR:yn(a,"error should have stream controller"),a.controller.error(Wi(e.reason)),z(this,Jr,v0).call(this,a,t);break;case fn.CANCEL_COMPLETE:e.success?a.cancelCall.resolve():a.cancelCall.reject(Wi(e.reason)),z(this,Jr,v0).call(this,a,t);break;case fn.CANCEL:if(!o)break;const l=Wi(e.reason);Promise.try(o.onCancel||iO,l).then(function(){s.postMessage({sourceName:i,targetName:r,stream:fn.CANCEL_COMPLETE,streamId:t,success:!0})},function(u){s.postMessage({sourceName:i,targetName:r,stream:fn.CANCEL_COMPLETE,streamId:t,reason:Wi(u)})}),o.sinkCapability.reject(l),o.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},v0=async function(e,t){var i,r,s;await Promise.allSettled([(i=e.startCall)==null?void 0:i.promise,(r=e.pullCall)==null?void 0:r.promise,(s=e.cancelCall)==null?void 0:s.promise]),delete this.streamControllers[t]};var Xy;class KU{constructor({enableHWA:e=!1}){F(this,Xy,!1);R(this,Xy,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const i=this._createCanvas(e,t);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!d(this,Xy)})}}reset(e,t,i){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||i<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=i}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){Rt("Abstract method `_createCanvas` called.")}}Xy=new WeakMap;class pee extends KU{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const i=this._document.createElement("canvas");return i.width=e,i.height=t,i}}class YU{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(i=>({cMapData:i,isCompressed:this.isCompressed})).catch(i=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){Rt("Abstract method `_fetch` called.")}}class XU extends YU{async _fetch(e){const t=await ex(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):Z1(t)}}class QU{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,i,r,s){return"none"}destroy(e=!1){}}var jc,Cf,fo,po,hi,Bc,Uc,Ee,ui,hg,Ih,w0,Ch,JU,wS,kh,fg,pg,bS,mg;class mee extends QU{constructor({docId:t,ownerDocument:i=globalThis.document}){super();F(this,Ee);F(this,jc);F(this,Cf);F(this,fo);F(this,po);F(this,hi);F(this,Bc);F(this,Uc,0);R(this,po,t),R(this,hi,i)}addFilter(t){if(!t)return"none";let i=d(this,Ee,ui).get(t);if(i)return i;const[r,s,a]=z(this,Ee,w0).call(this,t),o=t.length===1?r:`${r}${s}${a}`;if(i=d(this,Ee,ui).get(o),i)return d(this,Ee,ui).set(t,i),i;const l=`g_${d(this,po)}_transfer_map_${Ti(this,Uc)._++}`,u=z(this,Ee,Ch).call(this,l);d(this,Ee,ui).set(t,u),d(this,Ee,ui).set(o,u);const c=z(this,Ee,kh).call(this,l);return z(this,Ee,pg).call(this,r,s,a,c),u}addHCMFilter(t,i){var y;const r=`${t}-${i}`,s="base";let a=d(this,Ee,hg).get(s);if((a==null?void 0:a.key)===r||(a?((y=a.filter)==null||y.remove(),a.key=r,a.url="none",a.filter=null):(a={key:r,url:"none",filter:null},d(this,Ee,hg).set(s,a)),!t||!i))return a.url;const o=z(this,Ee,mg).call(this,t);t=Ne.makeHexColor(...o);const l=z(this,Ee,mg).call(this,i);if(i=Ne.makeHexColor(...l),d(this,Ee,Ih).style.color="",t==="#000000"&&i==="#ffffff"||t===i)return a.url;const u=new Array(256);for(let _=0;_<=255;_++){const x=_/255;u[_]=x<=.03928?x/12.92:((x+.055)/1.055)**2.4}const c=u.join(","),h=`g_${d(this,po)}_hcm_filter`,f=a.filter=z(this,Ee,kh).call(this,h);z(this,Ee,pg).call(this,c,c,c,f),z(this,Ee,wS).call(this,f);const m=(_,x)=>{const v=o[_]/255,w=l[_]/255,E=new Array(x+1);for(let C=0;C<=x;C++)E[C]=v+C/x*(w-v);return E.join(",")};return z(this,Ee,pg).call(this,m(0,5),m(1,5),m(2,5),f),a.url=z(this,Ee,Ch).call(this,h),a.url}addAlphaFilter(t){let i=d(this,Ee,ui).get(t);if(i)return i;const[r]=z(this,Ee,w0).call(this,[t]),s=`alpha_${r}`;if(i=d(this,Ee,ui).get(s),i)return d(this,Ee,ui).set(t,i),i;const a=`g_${d(this,po)}_alpha_map_${Ti(this,Uc)._++}`,o=z(this,Ee,Ch).call(this,a);d(this,Ee,ui).set(t,o),d(this,Ee,ui).set(s,o);const l=z(this,Ee,kh).call(this,a);return z(this,Ee,bS).call(this,r,l),o}addLuminosityFilter(t){let i=d(this,Ee,ui).get(t||"luminosity");if(i)return i;let r,s;if(t?([r]=z(this,Ee,w0).call(this,[t]),s=`luminosity_${r}`):s="luminosity",i=d(this,Ee,ui).get(s),i)return d(this,Ee,ui).set(t,i),i;const a=`g_${d(this,po)}_luminosity_map_${Ti(this,Uc)._++}`,o=z(this,Ee,Ch).call(this,a);d(this,Ee,ui).set(t,o),d(this,Ee,ui).set(s,o);const l=z(this,Ee,kh).call(this,a);return z(this,Ee,JU).call(this,l),t&&z(this,Ee,bS).call(this,r,l),o}addHighlightHCMFilter(t,i,r,s,a){var w;const o=`${i}-${r}-${s}-${a}`;let l=d(this,Ee,hg).get(t);if((l==null?void 0:l.key)===o||(l?((w=l.filter)==null||w.remove(),l.key=o,l.url="none",l.filter=null):(l={key:o,url:"none",filter:null},d(this,Ee,hg).set(t,l)),!i||!r))return l.url;const[u,c]=[i,r].map(z(this,Ee,mg).bind(this));let h=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),f=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),[m,y]=[s,a].map(z(this,Ee,mg).bind(this));f<h&&([h,f,m,y]=[f,h,y,m]),d(this,Ee,Ih).style.color="";const _=(E,C,D)=>{const V=new Array(256),I=(f-h)/D,k=E/255,N=(C-E)/(255*D);let L=0;for(let j=0;j<=D;j++){const H=Math.round(h+j*I),M=k+j*N;for(let se=L;se<=H;se++)V[se]=M;L=H+1}for(let j=L;j<256;j++)V[j]=V[L-1];return V.join(",")},x=`g_${d(this,po)}_hcm_${t}_filter`,v=l.filter=z(this,Ee,kh).call(this,x);return z(this,Ee,wS).call(this,v),z(this,Ee,pg).call(this,_(m[0],y[0],5),_(m[1],y[1],5),_(m[2],y[2],5),v),l.url=z(this,Ee,Ch).call(this,x),l.url}destroy(t=!1){var i,r,s,a;t&&((i=d(this,Bc))!=null&&i.size)||((r=d(this,fo))==null||r.parentNode.parentNode.remove(),R(this,fo,null),(s=d(this,Cf))==null||s.clear(),R(this,Cf,null),(a=d(this,Bc))==null||a.clear(),R(this,Bc,null),R(this,Uc,0))}}jc=new WeakMap,Cf=new WeakMap,fo=new WeakMap,po=new WeakMap,hi=new WeakMap,Bc=new WeakMap,Uc=new WeakMap,Ee=new WeakSet,ui=function(){return d(this,Cf)||R(this,Cf,new Map)},hg=function(){return d(this,Bc)||R(this,Bc,new Map)},Ih=function(){if(!d(this,fo)){const t=d(this,hi).createElement("div"),{style:i}=t;i.visibility="hidden",i.contain="strict",i.width=i.height=0,i.position="absolute",i.top=i.left=0,i.zIndex=-1;const r=d(this,hi).createElementNS(Ja,"svg");r.setAttribute("width",0),r.setAttribute("height",0),R(this,fo,d(this,hi).createElementNS(Ja,"defs")),t.append(r),r.append(d(this,fo)),d(this,hi).body.append(t)}return d(this,fo)},w0=function(t){if(t.length===1){const u=t[0],c=new Array(256);for(let f=0;f<256;f++)c[f]=u[f]/255;const h=c.join(",");return[h,h,h]}const[i,r,s]=t,a=new Array(256),o=new Array(256),l=new Array(256);for(let u=0;u<256;u++)a[u]=i[u]/255,o[u]=r[u]/255,l[u]=s[u]/255;return[a.join(","),o.join(","),l.join(",")]},Ch=function(t){if(d(this,jc)===void 0){R(this,jc,"");const i=d(this,hi).URL;i!==d(this,hi).baseURI&&(tx(i)?Xe('#createUrl: ignore "data:"-URL for performance reasons.'):R(this,jc,i.split("#",1)[0]))}return`url(${d(this,jc)}#${t})`},JU=function(t){const i=d(this,hi).createElementNS(Ja,"feColorMatrix");i.setAttribute("type","matrix"),i.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(i)},wS=function(t){const i=d(this,hi).createElementNS(Ja,"feColorMatrix");i.setAttribute("type","matrix"),i.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(i)},kh=function(t){const i=d(this,hi).createElementNS(Ja,"filter");return i.setAttribute("color-interpolation-filters","sRGB"),i.setAttribute("id",t),d(this,Ee,Ih).append(i),i},fg=function(t,i,r){const s=d(this,hi).createElementNS(Ja,i);s.setAttribute("type","discrete"),s.setAttribute("tableValues",r),t.append(s)},pg=function(t,i,r,s){const a=d(this,hi).createElementNS(Ja,"feComponentTransfer");s.append(a),z(this,Ee,fg).call(this,a,"feFuncR",t),z(this,Ee,fg).call(this,a,"feFuncG",i),z(this,Ee,fg).call(this,a,"feFuncB",r)},bS=function(t,i){const r=d(this,hi).createElementNS(Ja,"feComponentTransfer");i.append(r),z(this,Ee,fg).call(this,r,"feFuncA",t)},mg=function(t){return d(this,Ee,Ih).style.color=t,LC(getComputedStyle(d(this,Ee,Ih)).getPropertyValue("color"))};class ZU{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(i=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){Rt("Abstract method `_fetch` called.")}}class e6 extends ZU{async _fetch(e){const t=await ex(e,"arraybuffer");return new Uint8Array(t)}}wi&&Xe("Please use the `legacy` build in Node.js environments.");async function t6(n){const t=await process.getBuiltinModule("fs").promises.readFile(n);return new Uint8Array(t)}class gee extends QU{}class yee extends KU{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class _ee extends YU{async _fetch(e){return t6(e)}}class vee extends ZU{async _fetch(e){return t6(e)}}const yi={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function xS(n,e){if(!e)return;const t=e[2]-e[0],i=e[3]-e[1],r=new Path2D;r.rect(e[0],e[1],t,i),n.clip(r)}class zC{getPattern(){Rt("Abstract method `getPattern` called.")}}class wee extends zC{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const i of this._colorStops)t.addColorStop(i[0],i[1]);return t}getPattern(e,t,i,r){let s;if(r===yi.STROKE||r===yi.FILL){const a=t.current.getClippedPathBoundingBox(r,Bt(e))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,l=Math.ceil(a[3]-a[1])||1,u=t.cachedCanvases.getCanvas("pattern",o,l),c=u.context;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.beginPath(),c.rect(0,0,c.canvas.width,c.canvas.height),c.translate(-a[0],-a[1]),i=Ne.transform(i,[1,0,0,1,a[0],a[1]]),c.transform(...t.baseTransform),this.matrix&&c.transform(...this.matrix),xS(c,this._bbox),c.fillStyle=this._createGradient(c),c.fill(),s=e.createPattern(u.canvas,"no-repeat");const h=new DOMMatrix(i);s.setTransform(h)}else xS(e,this._bbox),s=this._createGradient(e);return s}}function cA(n,e,t,i,r,s,a,o){const l=e.coords,u=e.colors,c=n.data,h=n.width*4;let f;l[t+1]>l[i+1]&&(f=t,t=i,i=f,f=s,s=a,a=f),l[i+1]>l[r+1]&&(f=i,i=r,r=f,f=a,a=o,o=f),l[t+1]>l[i+1]&&(f=t,t=i,i=f,f=s,s=a,a=f);const m=(l[t]+e.offsetX)*e.scaleX,y=(l[t+1]+e.offsetY)*e.scaleY,_=(l[i]+e.offsetX)*e.scaleX,x=(l[i+1]+e.offsetY)*e.scaleY,v=(l[r]+e.offsetX)*e.scaleX,w=(l[r+1]+e.offsetY)*e.scaleY;if(y>=w)return;const E=u[s],C=u[s+1],D=u[s+2],V=u[a],I=u[a+1],k=u[a+2],N=u[o],L=u[o+1],j=u[o+2],H=Math.round(y),M=Math.round(w);let se,ue,ee,ae,J,q,G,U;for(let Y=H;Y<=M;Y++){if(Y<x){const Q=Y<y?0:(y-Y)/(y-x);se=m-(m-_)*Q,ue=E-(E-V)*Q,ee=C-(C-I)*Q,ae=D-(D-k)*Q}else{let Q;Y>w?Q=1:x===w?Q=0:Q=(x-Y)/(x-w),se=_-(_-v)*Q,ue=V-(V-N)*Q,ee=I-(I-L)*Q,ae=k-(k-j)*Q}let K;Y<y?K=0:Y>w?K=1:K=(y-Y)/(y-w),J=m-(m-v)*K,q=E-(E-N)*K,G=C-(C-L)*K,U=D-(D-j)*K;const Z=Math.round(Math.min(se,J)),ge=Math.round(Math.max(se,J));let ve=h*Y+Z*4;for(let Q=Z;Q<=ge;Q++)K=(se-Q)/(se-J),K<0?K=0:K>1&&(K=1),c[ve++]=ue-(ue-q)*K|0,c[ve++]=ee-(ee-G)*K|0,c[ve++]=ae-(ae-U)*K|0,c[ve++]=255}}function bee(n,e,t){const i=e.coords,r=e.colors;let s,a;switch(e.type){case"lattice":const o=e.verticesPerRow,l=Math.floor(i.length/o)-1,u=o-1;for(s=0;s<l;s++){let c=s*o;for(let h=0;h<u;h++,c++)cA(n,t,i[c],i[c+1],i[c+o],r[c],r[c+1],r[c+o]),cA(n,t,i[c+o+1],i[c+1],i[c+o],r[c+o+1],r[c+1],r[c+o])}break;case"triangles":for(s=0,a=i.length;s<a;s+=3)cA(n,t,i[s],i[s+1],i[s+2],r[s],r[s+1],r[s+2]);break;default:throw new Error("illegal figure")}}class xee extends zC{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,i){const o=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),u=Math.ceil(this._bounds[2])-o,c=Math.ceil(this._bounds[3])-l,h=Math.min(Math.ceil(Math.abs(u*e[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(c*e[1]*1.1)),3e3),m=u/h,y=c/f,_={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-l,scaleX:1/m,scaleY:1/y},x=h+2*2,v=f+2*2,w=i.getCanvas("mesh",x,v),E=w.context,C=E.createImageData(h,f);if(t){const V=C.data;for(let I=0,k=V.length;I<k;I+=4)V[I]=t[0],V[I+1]=t[1],V[I+2]=t[2],V[I+3]=255}for(const V of this._figures)bee(C,V,_);return E.putImageData(C,2,2),{canvas:w.canvas,offsetX:o-2*m,offsetY:l-2*y,scaleX:m,scaleY:y}}getPattern(e,t,i,r){xS(e,this._bbox);let s;if(r===yi.SHADING)s=Ne.singularValueDecompose2dScale(Bt(e));else if(s=Ne.singularValueDecompose2dScale(t.baseTransform),this.matrix){const o=Ne.singularValueDecompose2dScale(this.matrix);s=[s[0]*o[0],s[1]*o[1]]}const a=this._createMeshCanvas(s,r===yi.SHADING?null:this._background,t.cachedCanvases);return r!==yi.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(a.offsetX,a.offsetY),e.scale(a.scaleX,a.scaleY),e.createPattern(a.canvas,"no-repeat")}}class Eee extends zC{getPattern(){return"hotpink"}}function Aee(n){switch(n[0]){case"RadialAxial":return new wee(n);case"Mesh":return new xee(n);case"Dummy":return new Eee}throw new Error(`Unknown IR type: ${n[0]}`)}const rO={COLORED:1,UNCOLORED:2},e1=class e1{constructor(e,t,i,r,s){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=i,this.canvasGraphicsFactory=r,this.baseTransform=s}createPatternCanvas(e){const{bbox:t,operatorList:i,paintType:r,tilingType:s,color:a,canvasGraphicsFactory:o}=this;let{xstep:l,ystep:u}=this;l=Math.abs(l),u=Math.abs(u),J1("TilingType: "+s);const c=t[0],h=t[1],f=t[2],m=t[3],y=f-c,_=m-h,x=Ne.singularValueDecompose2dScale(this.matrix),v=Ne.singularValueDecompose2dScale(this.baseTransform),w=x[0]*v[0],E=x[1]*v[1];let C=y,D=_,V=!1,I=!1;const k=Math.ceil(l*w),N=Math.ceil(u*E),L=Math.ceil(y*w),j=Math.ceil(_*E);k>=L?C=l:V=!0,N>=j?D=u:I=!0;const H=this.getSizeAndScale(C,this.ctx.canvas.width,w),M=this.getSizeAndScale(D,this.ctx.canvas.height,E),se=e.cachedCanvases.getCanvas("pattern",H.size,M.size),ue=se.context,ee=o.createCanvasGraphics(ue);if(ee.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(ee,r,a),ue.translate(-H.scale*c,-M.scale*h),ee.transform(H.scale,0,0,M.scale,0,0),ue.save(),this.clipBbox(ee,c,h,f,m),ee.baseTransform=Bt(ee.ctx),ee.executeOperatorList(i),ee.endDrawing(),ue.restore(),V||I){const ae=se.canvas;V&&(C=l),I&&(D=u);const J=this.getSizeAndScale(C,this.ctx.canvas.width,w),q=this.getSizeAndScale(D,this.ctx.canvas.height,E),G=J.size,U=q.size,Y=e.cachedCanvases.getCanvas("pattern-workaround",G,U),K=Y.context,Z=V?Math.floor(y/l):0,ge=I?Math.floor(_/u):0;for(let ve=0;ve<=Z;ve++)for(let Q=0;Q<=ge;Q++)K.drawImage(ae,G*ve,U*Q,G,U,0,0,G,U);return{canvas:Y.canvas,scaleX:J.scale,scaleY:q.scale,offsetX:c,offsetY:h}}return{canvas:se.canvas,scaleX:H.scale,scaleY:M.scale,offsetX:c,offsetY:h}}getSizeAndScale(e,t,i){const r=Math.max(e1.MAX_PATTERN_SIZE,t);let s=Math.ceil(e*i);return s>=r?s=r:i=s/e,{scale:i,size:s}}clipBbox(e,t,i,r,s){const a=r-t,o=s-i;e.ctx.rect(t,i,a,o),e.current.updateRectMinMax(Bt(e.ctx),[t,i,r,s]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,i){const r=e.ctx,s=e.current;switch(t){case rO.COLORED:const a=this.ctx;r.fillStyle=a.fillStyle,r.strokeStyle=a.strokeStyle,s.fillColor=a.fillStyle,s.strokeColor=a.strokeStyle;break;case rO.UNCOLORED:const o=Ne.makeHexColor(i[0],i[1],i[2]);r.fillStyle=o,r.strokeStyle=o,s.fillColor=o,s.strokeColor=o;break;default:throw new XZ(`Unsupported paint type: ${t}`)}}getPattern(e,t,i,r){let s=i;r!==yi.SHADING&&(s=Ne.transform(s,t.baseTransform),this.matrix&&(s=Ne.transform(s,this.matrix)));const a=this.createPatternCanvas(t);let o=new DOMMatrix(s);o=o.translate(a.offsetX,a.offsetY),o=o.scale(1/a.scaleX,1/a.scaleY);const l=e.createPattern(a.canvas,"repeat");return l.setTransform(o),l}};Le(e1,"MAX_PATTERN_SIZE",3e3);let ES=e1;function Tee({src:n,srcPos:e=0,dest:t,width:i,height:r,nonBlackColor:s=4294967295,inverseDecode:a=!1}){const o=Di.isLittleEndian?4278190080:255,[l,u]=a?[s,o]:[o,s],c=i>>3,h=i&7,f=n.length;t=new Uint32Array(t.buffer);let m=0;for(let y=0;y<r;y++){for(const x=e+c;e<x;e++){const v=e<f?n[e]:255;t[m++]=v&128?u:l,t[m++]=v&64?u:l,t[m++]=v&32?u:l,t[m++]=v&16?u:l,t[m++]=v&8?u:l,t[m++]=v&4?u:l,t[m++]=v&2?u:l,t[m++]=v&1?u:l}if(h===0)continue;const _=e<f?n[e++]:255;for(let x=0;x<h;x++)t[m++]=_&1<<7-x?u:l}return{srcPos:e,destPos:m}}const sO=16,aO=100,See=15,oO=10,lO=1e3,Xi=16;function Iee(n,e){if(n._removeMirroring)throw new Error("Context is already forwarding operations.");n.__originalSave=n.save,n.__originalRestore=n.restore,n.__originalRotate=n.rotate,n.__originalScale=n.scale,n.__originalTranslate=n.translate,n.__originalTransform=n.transform,n.__originalSetTransform=n.setTransform,n.__originalResetTransform=n.resetTransform,n.__originalClip=n.clip,n.__originalMoveTo=n.moveTo,n.__originalLineTo=n.lineTo,n.__originalBezierCurveTo=n.bezierCurveTo,n.__originalRect=n.rect,n.__originalClosePath=n.closePath,n.__originalBeginPath=n.beginPath,n._removeMirroring=()=>{n.save=n.__originalSave,n.restore=n.__originalRestore,n.rotate=n.__originalRotate,n.scale=n.__originalScale,n.translate=n.__originalTranslate,n.transform=n.__originalTransform,n.setTransform=n.__originalSetTransform,n.resetTransform=n.__originalResetTransform,n.clip=n.__originalClip,n.moveTo=n.__originalMoveTo,n.lineTo=n.__originalLineTo,n.bezierCurveTo=n.__originalBezierCurveTo,n.rect=n.__originalRect,n.closePath=n.__originalClosePath,n.beginPath=n.__originalBeginPath,delete n._removeMirroring},n.save=function(){e.save(),this.__originalSave()},n.restore=function(){e.restore(),this.__originalRestore()},n.translate=function(i,r){e.translate(i,r),this.__originalTranslate(i,r)},n.scale=function(i,r){e.scale(i,r),this.__originalScale(i,r)},n.transform=function(i,r,s,a,o,l){e.transform(i,r,s,a,o,l),this.__originalTransform(i,r,s,a,o,l)},n.setTransform=function(i,r,s,a,o,l){e.setTransform(i,r,s,a,o,l),this.__originalSetTransform(i,r,s,a,o,l)},n.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},n.rotate=function(i){e.rotate(i),this.__originalRotate(i)},n.clip=function(i){e.clip(i),this.__originalClip(i)},n.moveTo=function(t,i){e.moveTo(t,i),this.__originalMoveTo(t,i)},n.lineTo=function(t,i){e.lineTo(t,i),this.__originalLineTo(t,i)},n.bezierCurveTo=function(t,i,r,s,a,o){e.bezierCurveTo(t,i,r,s,a,o),this.__originalBezierCurveTo(t,i,r,s,a,o)},n.rect=function(t,i,r,s){e.rect(t,i,r,s),this.__originalRect(t,i,r,s)},n.closePath=function(){e.closePath(),this.__originalClosePath()},n.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class Cee{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,i){let r;return this.cache[e]!==void 0?(r=this.cache[e],this.canvasFactory.reset(r,t,i)):(r=this.canvasFactory.create(t,i),this.cache[e]=r),r}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Mw(n,e,t,i,r,s,a,o,l,u){const[c,h,f,m,y,_]=Bt(n);if(h===0&&f===0){const w=a*c+y,E=Math.round(w),C=o*m+_,D=Math.round(C),V=(a+l)*c+y,I=Math.abs(Math.round(V)-E)||1,k=(o+u)*m+_,N=Math.abs(Math.round(k)-D)||1;return n.setTransform(Math.sign(c),0,0,Math.sign(m),E,D),n.drawImage(e,t,i,r,s,0,0,I,N),n.setTransform(c,h,f,m,y,_),[I,N]}if(c===0&&m===0){const w=o*f+y,E=Math.round(w),C=a*h+_,D=Math.round(C),V=(o+u)*f+y,I=Math.abs(Math.round(V)-E)||1,k=(a+l)*h+_,N=Math.abs(Math.round(k)-D)||1;return n.setTransform(0,Math.sign(h),Math.sign(f),0,E,D),n.drawImage(e,t,i,r,s,0,0,N,I),n.setTransform(c,h,f,m,y,_),[N,I]}n.drawImage(e,t,i,r,s,a,o,l,u);const x=Math.hypot(c,h),v=Math.hypot(f,m);return[x*l,v*u]}function kee(n){const{width:e,height:t}=n;if(e>lO||t>lO)return null;const i=1e3,r=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),s=e+1;let a=new Uint8Array(s*(t+1)),o,l,u;const c=e+7&-8;let h=new Uint8Array(c*t),f=0;for(const v of n.data){let w=128;for(;w>0;)h[f++]=v&w?0:255,w>>=1}let m=0;for(f=0,h[f]!==0&&(a[0]=1,++m),l=1;l<e;l++)h[f]!==h[f+1]&&(a[l]=h[f]?2:1,++m),f++;for(h[f]!==0&&(a[l]=2,++m),o=1;o<t;o++){f=o*c,u=o*s,h[f-c]!==h[f]&&(a[u]=h[f]?1:8,++m);let v=(h[f]?4:0)+(h[f-c]?8:0);for(l=1;l<e;l++)v=(v>>2)+(h[f+1]?4:0)+(h[f-c+1]?8:0),r[v]&&(a[u+l]=r[v],++m),f++;if(h[f-c]!==h[f]&&(a[u+l]=h[f]?2:4,++m),m>i)return null}for(f=c*(t-1),u=o*s,h[f]!==0&&(a[u]=8,++m),l=1;l<e;l++)h[f]!==h[f+1]&&(a[u+l]=h[f]?4:8,++m),f++;if(h[f]!==0&&(a[u+l]=4,++m),m>i)return null;const y=new Int32Array([0,s,-1,0,-s,0,0,0,1]),_=new Path2D;for(o=0;m&&o<=t;o++){let v=o*s;const w=v+e;for(;v<w&&!a[v];)v++;if(v===w)continue;_.moveTo(v%s,o);const E=v;let C=a[v];do{const D=y[C];do v+=D;while(!a[v]);const V=a[v];V!==5&&V!==10?(C=V,a[v]=0):(C=V&51*C>>4,a[v]&=C>>2|C<<2),_.lineTo(v%s,v/s|0),a[v]||--m}while(E!==v);--o}return h=null,a=null,function(v){v.save(),v.scale(1/e,-1/t),v.translate(0,-t),v.fill(_),v.beginPath(),v.restore()}}class uO{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=dU,this.textMatrixScale=1,this.fontMatrix=QT,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=li.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,i){[t,i]=Ne.applyTransform([t,i],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,i),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,i)}updateRectMinMax(e,t){const i=Ne.applyTransform(t,e),r=Ne.applyTransform(t.slice(2),e),s=Ne.applyTransform([t[0],t[3]],e),a=Ne.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,i[0],r[0],s[0],a[0]),this.minY=Math.min(this.minY,i[1],r[1],s[1],a[1]),this.maxX=Math.max(this.maxX,i[0],r[0],s[0],a[0]),this.maxY=Math.max(this.maxY,i[1],r[1],s[1],a[1])}updateScalingPathMinMax(e,t){Ne.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,i,r,s,a,o,l,u,c){const h=Ne.bezierBoundingBox(t,i,r,s,a,o,l,u,c);c||this.updateRectMinMax(e,h)}getPathBoundingBox(e=yi.FILL,t=null){const i=[this.minX,this.minY,this.maxX,this.maxY];if(e===yi.STROKE){t||Rt("Stroke bounding box must include transform.");const r=Ne.singularValueDecompose2dScale(t),s=r[0]*this.lineWidth/2,a=r[1]*this.lineWidth/2;i[0]-=s,i[1]-=a,i[2]+=s,i[3]+=a}return i}updateClipFromPath(){const e=Ne.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=yi.FILL,t=null){return Ne.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function cO(n,e){if(e instanceof ImageData){n.putImageData(e,0,0);return}const t=e.height,i=e.width,r=t%Xi,s=(t-r)/Xi,a=r===0?s:s+1,o=n.createImageData(i,Xi);let l=0,u;const c=e.data,h=o.data;let f,m,y,_;if(e.kind===c0.GRAYSCALE_1BPP){const x=c.byteLength,v=new Uint32Array(h.buffer,0,h.byteLength>>2),w=v.length,E=i+7>>3,C=4294967295,D=Di.isLittleEndian?4278190080:255;for(f=0;f<a;f++){for(y=f<s?Xi:r,u=0,m=0;m<y;m++){const V=x-l;let I=0;const k=V>E?i:V*8-7,N=k&-8;let L=0,j=0;for(;I<N;I+=8)j=c[l++],v[u++]=j&128?C:D,v[u++]=j&64?C:D,v[u++]=j&32?C:D,v[u++]=j&16?C:D,v[u++]=j&8?C:D,v[u++]=j&4?C:D,v[u++]=j&2?C:D,v[u++]=j&1?C:D;for(;I<k;I++)L===0&&(j=c[l++],L=128),v[u++]=j&L?C:D,L>>=1}for(;u<w;)v[u++]=0;n.putImageData(o,0,f*Xi)}}else if(e.kind===c0.RGBA_32BPP){for(m=0,_=i*Xi*4,f=0;f<s;f++)h.set(c.subarray(l,l+_)),l+=_,n.putImageData(o,0,m),m+=Xi;f<a&&(_=i*r*4,h.set(c.subarray(l,l+_)),n.putImageData(o,0,m))}else if(e.kind===c0.RGB_24BPP)for(y=Xi,_=i*y,f=0;f<a;f++){for(f>=s&&(y=r,_=i*y),u=0,m=_;m--;)h[u++]=c[l++],h[u++]=c[l++],h[u++]=c[l++],h[u++]=255;n.putImageData(o,0,f*Xi)}else throw new Error(`bad image kind: ${e.kind}`)}function dO(n,e){if(e.bitmap){n.drawImage(e.bitmap,0,0);return}const t=e.height,i=e.width,r=t%Xi,s=(t-r)/Xi,a=r===0?s:s+1,o=n.createImageData(i,Xi);let l=0;const u=e.data,c=o.data;for(let h=0;h<a;h++){const f=h<s?Xi:r;({srcPos:l}=Tee({src:u,srcPos:l,dest:c,width:i,height:f,nonBlackColor:0})),n.putImageData(o,0,h*Xi)}}function Bm(n,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of t)n[i]!==void 0&&(e[i]=n[i]);n.setLineDash!==void 0&&(e.setLineDash(n.getLineDash()),e.lineDashOffset=n.lineDashOffset)}function Ow(n){if(n.strokeStyle=n.fillStyle="#000000",n.fillRule="nonzero",n.globalAlpha=1,n.lineWidth=1,n.lineCap="butt",n.lineJoin="miter",n.miterLimit=10,n.globalCompositeOperation="source-over",n.font="10px sans-serif",n.setLineDash!==void 0&&(n.setLineDash([]),n.lineDashOffset=0),!wi){const{filter:e}=n;e!=="none"&&e!==""&&(n.filter="none")}}function hO(n,e){if(e)return!0;const t=Ne.singularValueDecompose2dScale(n);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);const i=Math.fround((globalThis.devicePixelRatio||1)*Su.PDF_TO_CSS_UNITS);return t[0]<=i&&t[1]<=i}const $ee=["butt","round","square"],Ree=["miter","round","bevel"],Pee={},fO={};var Gs,AS,TS,SS;const WC=class WC{constructor(e,t,i,r,s,{optionalContentConfig:a,markedContentStack:o=null},l,u){F(this,Gs);this.ctx=e,this.current=new uO(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=i,this.canvasFactory=r,this.filterFactory=s,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new Cee(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=u,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:i=!1,background:r=null}){const s=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=r||"#ffffff",this.ctx.fillRect(0,0,s,a),this.ctx.fillStyle=o,i){const l=this.cachedCanvases.getCanvas("transparent",s,a);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...Bt(this.compositeCtx))}this.ctx.save(),Ow(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Bt(this.ctx)}executeOperatorList(e,t,i,r){const s=e.argsArray,a=e.fnArray;let o=t||0;const l=s.length;if(l===o)return o;const u=l-o>oO&&typeof i=="function",c=u?Date.now()+See:0;let h=0;const f=this.commonObjs,m=this.objs;let y;for(;;){if(r!==void 0&&o===r.nextBreakPoint)return r.breakIt(o,i),o;if(y=a[o],y!==_s.dependency)this[y].apply(this,s[o]);else for(const _ of s[o]){const x=_.startsWith("g_")?f:m;if(!x.has(_))return x.get(_,i),o}if(o++,o===l)return o;if(u&&++h>oO){if(Date.now()>c)return i(),o;h=0}}}endDrawing(){z(this,Gs,AS).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),z(this,Gs,TS).call(this)}_scaleImage(e,t){const i=e.width??e.displayWidth,r=e.height??e.displayHeight;let s=Math.max(Math.hypot(t[0],t[1]),1),a=Math.max(Math.hypot(t[2],t[3]),1),o=i,l=r,u="prescale1",c,h;for(;s>2&&o>1||a>2&&l>1;){let f=o,m=l;s>2&&o>1&&(f=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),s/=o/f),a>2&&l>1&&(m=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,a/=l/m),c=this.cachedCanvases.getCanvas(u,f,m),h=c.context,h.clearRect(0,0,f,m),h.drawImage(e,0,0,o,l,0,0,f,m),e=c.canvas,o=f,l=m,u=u==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:o,paintHeight:l}}_createMaskCanvas(e){const t=this.ctx,{width:i,height:r}=e,s=this.current.fillColor,a=this.current.patternFill,o=Bt(t);let l,u,c,h;if((e.bitmap||e.data)&&e.count>1){const k=e.bitmap||e.data.buffer;u=JSON.stringify(a?o:[o.slice(0,4),s]),l=this._cachedBitmapsMap.get(k),l||(l=new Map,this._cachedBitmapsMap.set(k,l));const N=l.get(u);if(N&&!a){const L=Math.round(Math.min(o[0],o[2])+o[4]),j=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:N,offsetX:L,offsetY:j}}c=N}c||(h=this.cachedCanvases.getCanvas("maskCanvas",i,r),dO(h.context,e));let f=Ne.transform(o,[1/i,0,0,-1/r,0,0]);f=Ne.transform(f,[1,0,0,1,0,-r]);const[m,y,_,x]=Ne.getAxialAlignedBoundingBox([0,0,i,r],f),v=Math.round(_-m)||1,w=Math.round(x-y)||1,E=this.cachedCanvases.getCanvas("fillCanvas",v,w),C=E.context,D=m,V=y;C.translate(-D,-V),C.transform(...f),c||(c=this._scaleImage(h.canvas,aa(C)),c=c.img,l&&a&&l.set(u,c)),C.imageSmoothingEnabled=hO(Bt(C),e.interpolate),Mw(C,c,0,0,c.width,c.height,0,0,i,r),C.globalCompositeOperation="source-in";const I=Ne.transform(aa(C),[1,0,0,1,-D,-V]);return C.fillStyle=a?s.getPattern(t,this,I,yi.FILL):s,C.fillRect(0,0,i,r),l&&!a&&(this.cachedCanvases.delete("fillCanvas"),l.set(u,E.canvas)),{canvas:E.canvas,offsetX:Math.round(D),offsetY:Math.round(V)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=$ee[e]}setLineJoin(e){this.ctx.lineJoin=Ree[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(e),i.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,i]of e)switch(t){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i[0],i[1]);break;case"CA":this.current.strokeAlpha=i;break;case"ca":this.current.fillAlpha=i,this.ctx.globalAlpha=i;break;case"BM":this.ctx.globalCompositeOperation=i;break;case"SMask":this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(i,e,t);this.suspendedCtx=this.ctx,this.ctx=r.context;const s=this.ctx;s.setTransform(...Bt(this.suspendedCtx)),Bm(this.suspendedCtx,s),Iee(s,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Bm(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,i=this.suspendedCtx;this.composeSMask(i,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,i,r){const s=r[0],a=r[1],o=r[2]-s,l=r[3]-a;o===0||l===0||(this.genericComposeSMask(t.context,i,o,l,t.subtype,t.backdrop,t.transferMap,s,a,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(i.canvas,0,0),e.restore())}genericComposeSMask(e,t,i,r,s,a,o,l,u,c,h){let f=e.canvas,m=l-c,y=u-h;if(a){const x=Ne.makeHexColor(...a);if(m<0||y<0||m+i>f.width||y+r>f.height){const v=this.cachedCanvases.getCanvas("maskExtension",i,r),w=v.context;w.drawImage(f,-m,-y),w.globalCompositeOperation="destination-atop",w.fillStyle=x,w.fillRect(0,0,i,r),w.globalCompositeOperation="source-over",f=v.canvas,m=y=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const v=new Path2D;v.rect(m,y,i,r),e.clip(v),e.globalCompositeOperation="destination-atop",e.fillStyle=x,e.fillRect(m,y,i,r),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),s==="Alpha"&&o?t.filter=this.filterFactory.addAlphaFilter(o):s==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(o));const _=new Path2D;_.rect(l,u,i,r),t.clip(_),t.globalCompositeOperation="destination-in",t.drawImage(f,m,y,i,r,l,u,i,r),t.restore()}save(){this.inSMaskMode?(Bm(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Bm(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,i,r,s,a){this.ctx.transform(e,t,i,r,s,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,i){const r=this.ctx,s=this.current;let a=s.x,o=s.y,l,u;const c=Bt(r),h=c[0]===0&&c[3]===0||c[1]===0&&c[2]===0,f=h?i.slice(0):null;for(let m=0,y=0,_=e.length;m<_;m++)switch(e[m]|0){case _s.rectangle:a=t[y++],o=t[y++];const x=t[y++],v=t[y++],w=a+x,E=o+v;r.moveTo(a,o),x===0||v===0?r.lineTo(w,E):(r.lineTo(w,o),r.lineTo(w,E),r.lineTo(a,E)),h||s.updateRectMinMax(c,[a,o,w,E]),r.closePath();break;case _s.moveTo:a=t[y++],o=t[y++],r.moveTo(a,o),h||s.updatePathMinMax(c,a,o);break;case _s.lineTo:a=t[y++],o=t[y++],r.lineTo(a,o),h||s.updatePathMinMax(c,a,o);break;case _s.curveTo:l=a,u=o,a=t[y+4],o=t[y+5],r.bezierCurveTo(t[y],t[y+1],t[y+2],t[y+3],a,o),s.updateCurvePathMinMax(c,l,u,t[y],t[y+1],t[y+2],t[y+3],a,o,f),y+=6;break;case _s.curveTo2:l=a,u=o,r.bezierCurveTo(a,o,t[y],t[y+1],t[y+2],t[y+3]),s.updateCurvePathMinMax(c,l,u,a,o,t[y],t[y+1],t[y+2],t[y+3],f),a=t[y+2],o=t[y+3],y+=4;break;case _s.curveTo3:l=a,u=o,a=t[y+2],o=t[y+3],r.bezierCurveTo(t[y],t[y+1],a,o,a,o),s.updateCurvePathMinMax(c,l,u,t[y],t[y+1],a,o,a,o,f),y+=4;break;case _s.closePath:r.closePath();break}h&&s.updateScalingPathMinMax(c,f),s.setCurrentPoint(a,o)}closePath(){this.ctx.closePath()}stroke(e=!0){const t=this.ctx,i=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof i=="object"&&(i!=null&&i.getPattern)?(t.save(),t.strokeStyle=i.getPattern(t,this,aa(t),yi.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){const t=this.ctx,i=this.current.fillColor,r=this.current.patternFill;let s=!1;r&&(t.save(),t.fillStyle=i.getPattern(t,this,aa(t),yi.FILL),s=!0);const a=this.current.getClippedPathBoundingBox();this.contentVisible&&a!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),s&&t.restore(),e&&this.consumePath(a)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=Pee}eoClip(){this.pendingClip=fO}beginText(){this.current.textMatrix=dU,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}const i=new Path2D,r=t.getTransform().invertSelf();for(const{transform:s,x:a,y:o,fontSize:l,path:u}of e)i.addPath(u,new DOMMatrix(s).preMultiplySelf(r).translate(a,o).scale(l,-l));t.clip(i),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var c;const i=this.commonObjs.get(e),r=this.current;if(!i)throw new Error(`Can't find font for ${e}`);if(r.fontMatrix=i.fontMatrix||QT,(r.fontMatrix[0]===0||r.fontMatrix[3]===0)&&Xe("Invalid font matrix for font "+e),t<0?(t=-t,r.fontDirection=-1):r.fontDirection=1,this.current.font=i,this.current.fontSize=t,i.isType3Font)return;const s=i.loadedName||"sans-serif",a=((c=i.systemFontInfo)==null?void 0:c.css)||`"${s}", ${i.fallbackName}`;let o="normal";i.black?o="900":i.bold&&(o="bold");const l=i.italic?"italic":"normal";let u=t;t<sO?u=sO:t>aO&&(u=aO),this.current.fontSizeScale=t/u,this.ctx.font=`${l} ${o} ${u}px ${a}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,i,r,s,a){this.current.textMatrix=[e,t,i,r,s,a],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,i,r,s){const a=this.ctx,o=this.current,l=o.font,u=o.textRenderingMode,c=o.fontSize/o.fontSizeScale,h=u&li.FILL_STROKE_MASK,f=!!(u&li.ADD_TO_PATH_FLAG),m=o.patternFill&&!l.missingFile,y=o.patternStroke&&!l.missingFile;let _;if((l.disableFontFace||f||m||y)&&(_=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||m||y){if(a.save(),a.translate(t,i),a.scale(c,-c),h===li.FILL||h===li.FILL_STROKE)if(r){const x=a.getTransform();a.setTransform(...r),a.fill(z(this,Gs,SS).call(this,_,x,r))}else a.fill(_);if(h===li.STROKE||h===li.FILL_STROKE)if(s){const x=a.getTransform();a.setTransform(...s),a.stroke(z(this,Gs,SS).call(this,_,x,s))}else a.lineWidth/=c,a.stroke(_);a.restore()}else(h===li.FILL||h===li.FILL_STROKE)&&a.fillText(e,t,i),(h===li.STROKE||h===li.FILL_STROKE)&&a.strokeText(e,t,i);f&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Bt(a),x:t,y:i,fontSize:c,path:_})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let i=!1;for(let r=3;r<t.length;r+=4)if(t[r]>0&&t[r]<255){i=!0;break}return Ze(this,"isFontSubpixelAAEnabled",i)}showText(e){const t=this.current,i=t.font;if(i.isType3Font)return this.showType3Text(e);const r=t.fontSize;if(r===0)return;const s=this.ctx,a=t.fontSizeScale,o=t.charSpacing,l=t.wordSpacing,u=t.fontDirection,c=t.textHScale*u,h=e.length,f=i.vertical,m=f?1:-1,y=i.defaultVMetrics,_=r*t.fontMatrix[0],x=t.textRenderingMode===li.FILL&&!i.disableFontFace&&!t.patternFill;s.save(),s.transform(...t.textMatrix),s.translate(t.x,t.y+t.textRise),u>0?s.scale(c,-1):s.scale(c,1);let v,w;if(t.patternFill){s.save();const I=t.fillColor.getPattern(s,this,aa(s),yi.FILL);v=Bt(s),s.restore(),s.fillStyle=I}if(t.patternStroke){s.save();const I=t.strokeColor.getPattern(s,this,aa(s),yi.STROKE);w=Bt(s),s.restore(),s.strokeStyle=I}let E=t.lineWidth;const C=t.textMatrixScale;if(C===0||E===0){const I=t.textRenderingMode&li.FILL_STROKE_MASK;(I===li.STROKE||I===li.FILL_STROKE)&&(E=this.getSinglePixelWidth())}else E/=C;if(a!==1&&(s.scale(a,a),E/=a),s.lineWidth=E,i.isInvalidPDFjsFont){const I=[];let k=0;for(const N of e)I.push(N.unicode),k+=N.width;s.fillText(I.join(""),0,0),t.x+=k*_*c,s.restore(),this.compose();return}let D=0,V;for(V=0;V<h;++V){const I=e[V];if(typeof I=="number"){D+=m*I*r/1e3;continue}let k=!1;const N=(I.isSpace?l:0)+o,L=I.fontChar,j=I.accent;let H,M,se=I.width;if(f){const ee=I.vmetric||y,ae=-(I.vmetric?ee[1]:se*.5)*_,J=ee[2]*_;se=ee?-ee[0]:se,H=ae/a,M=(D+J)/a}else H=D/a,M=0;if(i.remeasure&&se>0){const ee=s.measureText(L).width*1e3/r*a;if(se<ee&&this.isFontSubpixelAAEnabled){const ae=se/ee;k=!0,s.save(),s.scale(ae,1),H/=ae}else se!==ee&&(H+=(se-ee)/2e3*r/a)}if(this.contentVisible&&(I.isInFont||i.missingFile)){if(x&&!j)s.fillText(L,H,M);else if(this.paintChar(L,H,M,v,w),j){const ee=H+r*j.offset.x/a,ae=M-r*j.offset.y/a;this.paintChar(j.fontChar,ee,ae,v,w)}}const ue=f?se*_-N*u:se*_+N*u;D+=ue,k&&s.restore()}f?t.y-=D:t.x+=D*c,s.restore(),this.compose()}showType3Text(e){const t=this.ctx,i=this.current,r=i.font,s=i.fontSize,a=i.fontDirection,o=r.vertical?1:-1,l=i.charSpacing,u=i.wordSpacing,c=i.textHScale*a,h=i.fontMatrix||QT,f=e.length,m=i.textRenderingMode===li.INVISIBLE;let y,_,x,v;if(!(m||s===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...i.textMatrix),t.translate(i.x,i.y),t.scale(c,a),y=0;y<f;++y){if(_=e[y],typeof _=="number"){v=o*_*s/1e3,this.ctx.translate(v,0),i.x+=v*c;continue}const w=(_.isSpace?u:0)+l,E=r.charProcOperatorList[_.operatorListId];if(!E){Xe(`Type3 character "${_.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=_,this.save(),t.scale(s,s),t.transform(...h),this.executeOperatorList(E),this.restore()),x=Ne.applyTransform([_.width,0],h)[0]*s+w,t.translate(x,0),i.x+=x*c}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,i,r,s,a){this.ctx.rect(i,r,s-i,a-r),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){const i=e[1],r=this.baseTransform||Bt(this.ctx),s={createCanvasGraphics:a=>new WC(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new ES(e,i,this.ctx,s,r)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,i){this.ctx.strokeStyle=this.current.strokeColor=Ne.makeHexColor(e,t,i),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,i){this.ctx.fillStyle=this.current.fillColor=Ne.makeHexColor(e,t,i),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let i;return this.cachedPatterns.has(e)?i=this.cachedPatterns.get(e):(i=Aee(this.getObject(e)),this.cachedPatterns.set(e,i)),t&&(i.matrix=t),i}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const i=this._getPattern(e);t.fillStyle=i.getPattern(t,this,aa(t),yi.SHADING);const r=aa(t);if(r){const{width:s,height:a}=t.canvas,[o,l,u,c]=Ne.getAxialAlignedBoundingBox([0,0,s,a],r);this.ctx.fillRect(o,l,u-o,c-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){Rt("Should not call beginInlineImage")}beginImageData(){Rt("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=Bt(this.ctx),t)){const i=t[2]-t[0],r=t[3]-t[1];this.ctx.rect(t[0],t[1],i,r),this.current.updateRectMinMax(Bt(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||J1("TODO: Support non-isolated groups."),e.knockout&&Xe("Knockout groups not supported.");const i=Bt(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let r=Ne.getAxialAlignedBoundingBox(e.bbox,Bt(t));const s=[0,0,t.canvas.width,t.canvas.height];r=Ne.intersect(r,s)||[0,0,0,0];const a=Math.floor(r[0]),o=Math.floor(r[1]),l=Math.max(Math.ceil(r[2])-a,1),u=Math.max(Math.ceil(r[3])-o,1);this.current.startNewPathAndClipBox([0,0,l,u]);let c="groupAt"+this.groupLevel;e.smask&&(c+="_smask_"+this.smaskCounter++%2);const h=this.cachedCanvases.getCanvas(c,l,u),f=h.context;f.translate(-a,-o),f.transform(...i),e.smask?this.smaskStack.push({canvas:h.canvas,context:f,offsetX:a,offsetY:o,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(a,o),t.save()),Bm(t,f),this.ctx=f,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const r=Bt(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...r);const s=Ne.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],r);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(s)}}beginAnnotation(e,t,i,r,s){if(z(this,Gs,AS).call(this),Ow(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const a=t[2]-t[0],o=t[3]-t[1];if(s&&this.annotationCanvasMap){i=i.slice(),i[4]-=t[0],i[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=a,t[3]=o;const[l,u]=Ne.singularValueDecompose2dScale(Bt(this.ctx)),{viewportScale:c}=this,h=Math.ceil(a*this.outputScaleX*c),f=Math.ceil(o*this.outputScaleY*c);this.annotationCanvas=this.canvasFactory.create(h,f);const{canvas:m,context:y}=this.annotationCanvas;this.annotationCanvasMap.set(e,m),this.annotationCanvas.savedCtx=this.ctx,this.ctx=y,this.ctx.save(),this.ctx.setTransform(l,0,0,-u,0,o*u),Ow(this.ctx)}else Ow(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],a,o),this.ctx.clip(),this.ctx.beginPath()}this.current=new uO(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...i),this.transform(...r)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),z(this,Gs,TS).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;e=this.getObject(e.data,e),e.count=t;const i=this.ctx,r=this.processingType3;if(r&&(r.compiled===void 0&&(r.compiled=kee(e)),r.compiled)){r.compiled(i);return}const s=this._createMaskCanvas(e),a=s.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(a,s.offsetX,s.offsetY),i.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,i=0,r=0,s,a){if(!this.contentVisible)return;e=this.getObject(e.data,e);const o=this.ctx;o.save();const l=Bt(o);o.transform(t,i,r,s,0,0);const u=this._createMaskCanvas(e);o.setTransform(1,0,0,1,u.offsetX-l[4],u.offsetY-l[5]);for(let c=0,h=a.length;c<h;c+=2){const f=Ne.transform(l,[t,i,r,s,a[c],a[c+1]]),[m,y]=Ne.applyTransform([0,0],f);o.drawImage(u.canvas,m,y)}o.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,i=this.current.fillColor,r=this.current.patternFill;for(const s of e){const{data:a,width:o,height:l,transform:u}=s,c=this.cachedCanvases.getCanvas("maskCanvas",o,l),h=c.context;h.save();const f=this.getObject(a,s);dO(h,f),h.globalCompositeOperation="source-in",h.fillStyle=r?i.getPattern(h,this,aa(t),yi.FILL):i,h.fillRect(0,0,o,l),h.restore(),t.save(),t.transform(...u),t.scale(1,-1),Mw(t,c.canvas,0,0,o,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);if(!t){Xe("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,i,r){if(!this.contentVisible)return;const s=this.getObject(e);if(!s){Xe("Dependent image isn't ready yet");return}const a=s.width,o=s.height,l=[];for(let u=0,c=r.length;u<c;u+=2)l.push({transform:[t,0,0,i,r[u],r[u+1]],x:0,y:0,w:a,h:o});this.paintInlineImageXObjectGroup(s,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:i,height:r}=e,s=this.cachedCanvases.getCanvas("inlineImage",i,r),a=s.context;return a.filter=this.current.transferMaps,a.drawImage(t,0,0),a.filter="none",s.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,i=e.height,r=this.ctx;if(this.save(),!wi){const{filter:o}=r;o!=="none"&&o!==""&&(r.filter="none")}r.scale(1/t,-1/i);let s;if(e.bitmap)s=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)s=e;else{const l=this.cachedCanvases.getCanvas("inlineImage",t,i).context;cO(l,e),s=this.applyTransferMapsToCanvas(l)}const a=this._scaleImage(s,aa(r));r.imageSmoothingEnabled=hO(Bt(r),e.interpolate),Mw(r,a.img,0,0,a.paintWidth,a.paintHeight,0,-i,t,i),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const i=this.ctx;let r;if(e.bitmap)r=e.bitmap;else{const s=e.width,a=e.height,l=this.cachedCanvases.getCanvas("inlineImage",s,a).context;cO(l,e),r=this.applyTransferMapsToCanvas(l)}for(const s of t)i.save(),i.transform(...s.transform),i.scale(1,-1),Mw(i,r,s.x,s.y,s.w,s.h,0,-1,1,1),i.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){const t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const i=this.ctx;this.pendingClip&&(t||(this.pendingClip===fO?i.clip("evenodd"):i.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),i.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=Bt(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),i=Math.hypot(e[0],e[2]),r=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(i,r)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:i,c:r,d:s}=this.ctx.getTransform();let a,o;if(i===0&&r===0){const l=Math.abs(t),u=Math.abs(s);if(l===u)if(e===0)a=o=1/l;else{const c=l*e;a=o=c<1?1/c:1}else if(e===0)a=1/l,o=1/u;else{const c=l*e,h=u*e;a=c<1?1/c:1,o=h<1?1/h:1}}else{const l=Math.abs(t*s-i*r),u=Math.hypot(t,i),c=Math.hypot(r,s);if(e===0)a=c/l,o=u/l;else{const h=e*l;a=c>h?c/h:1,o=u>h?u/h:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(e){const{ctx:t}=this,{lineWidth:i}=this.current,[r,s]=this.getScaleForStroking();if(t.lineWidth=i||1,r===1&&s===1){t.stroke();return}const a=t.getLineDash();if(e&&t.save(),t.scale(r,s),a.length>0){const o=Math.max(r,s);t.setLineDash(a.map(l=>l/o)),t.lineDashOffset/=o}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};Gs=new WeakSet,AS=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},TS=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},SS=function(e,t,i){const r=new Path2D;return r.addPath(e,new DOMMatrix(i).invertSelf().multiplySelf(t)),r};let cf=WC;for(const n in _s)cf.prototype[n]!==void 0&&(cf.prototype[_s[n]]=cf.prototype[n]);var Qy,Jy;class Po{static get workerPort(){return d(this,Qy)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");R(this,Qy,e)}static get workerSrc(){return d(this,Jy)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");R(this,Jy,e)}}Qy=new WeakMap,Jy=new WeakMap,F(Po,Qy,null),F(Po,Jy,"");var Hc,Zy;class Nee{constructor({parsedData:e,rawData:t}){F(this,Hc);F(this,Zy);R(this,Hc,e),R(this,Zy,t)}getRaw(){return d(this,Zy)}get(e){return d(this,Hc).get(e)??null}getAll(){return PC(d(this,Hc))}has(e){return d(this,Hc).has(e)}}Hc=new WeakMap,Zy=new WeakMap;const $h=Symbol("INTERNAL");var e_,t_,n_,kf;class Dee{constructor(e,{name:t,intent:i,usage:r,rbGroups:s}){F(this,e_,!1);F(this,t_,!1);F(this,n_,!1);F(this,kf,!0);R(this,e_,!!(e&wr.DISPLAY)),R(this,t_,!!(e&wr.PRINT)),this.name=t,this.intent=i,this.usage=r,this.rbGroups=s}get visible(){if(d(this,n_))return d(this,kf);if(!d(this,kf))return!1;const{print:e,view:t}=this.usage;return d(this,e_)?(t==null?void 0:t.viewState)!=="OFF":d(this,t_)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,i=!1){e!==$h&&Rt("Internal method `_setVisible` called."),R(this,n_,i),R(this,kf,t)}}e_=new WeakMap,t_=new WeakMap,n_=new WeakMap,kf=new WeakMap;var Ml,Et,$f,Rf,i_,IS;class Mee{constructor(e,t=wr.DISPLAY){F(this,i_);F(this,Ml,null);F(this,Et,new Map);F(this,$f,null);F(this,Rf,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,R(this,Rf,e.order);for(const i of e.groups)d(this,Et).set(i.id,new Dee(t,i));if(e.baseState==="OFF")for(const i of d(this,Et).values())i._setVisible($h,!1);for(const i of e.on)d(this,Et).get(i)._setVisible($h,!0);for(const i of e.off)d(this,Et).get(i)._setVisible($h,!1);R(this,$f,this.getHash())}}isVisible(e){if(d(this,Et).size===0)return!0;if(!e)return J1("Optional content group not defined."),!0;if(e.type==="OCG")return d(this,Et).has(e.id)?d(this,Et).get(e.id).visible:(Xe(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return z(this,i_,IS).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!d(this,Et).has(t))return Xe(`Optional content group not found: ${t}`),!0;if(d(this,Et).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!d(this,Et).has(t))return Xe(`Optional content group not found: ${t}`),!0;if(!d(this,Et).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!d(this,Et).has(t))return Xe(`Optional content group not found: ${t}`),!0;if(!d(this,Et).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!d(this,Et).has(t))return Xe(`Optional content group not found: ${t}`),!0;if(d(this,Et).get(t).visible)return!1}return!0}return Xe(`Unknown optional content policy ${e.policy}.`),!0}return Xe(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,i=!0){var s;const r=d(this,Et).get(e);if(!r){Xe(`Optional content group not found: ${e}`);return}if(i&&t&&r.rbGroups.length)for(const a of r.rbGroups)for(const o of a)o!==e&&((s=d(this,Et).get(o))==null||s._setVisible($h,!1,!0));r._setVisible($h,!!t,!0),R(this,Ml,null)}setOCGState({state:e,preserveRB:t}){let i;for(const r of e){switch(r){case"ON":case"OFF":case"Toggle":i=r;continue}const s=d(this,Et).get(r);if(s)switch(i){case"ON":this.setVisibility(r,!0,t);break;case"OFF":this.setVisibility(r,!1,t);break;case"Toggle":this.setVisibility(r,!s.visible,t);break}}R(this,Ml,null)}get hasInitialVisibility(){return d(this,$f)===null||this.getHash()===d(this,$f)}getOrder(){return d(this,Et).size?d(this,Rf)?d(this,Rf).slice():[...d(this,Et).keys()]:null}getGroups(){return d(this,Et).size>0?PC(d(this,Et)):null}getGroup(e){return d(this,Et).get(e)||null}getHash(){if(d(this,Ml)!==null)return d(this,Ml);const e=new BU;for(const[t,i]of d(this,Et))e.update(`${t}:${i.visible}`);return R(this,Ml,e.hexdigest())}}Ml=new WeakMap,Et=new WeakMap,$f=new WeakMap,Rf=new WeakMap,i_=new WeakSet,IS=function(e){const t=e.length;if(t<2)return!0;const i=e[0];for(let r=1;r<t;r++){const s=e[r];let a;if(Array.isArray(s))a=z(this,i_,IS).call(this,s);else if(d(this,Et).has(s))a=d(this,Et).get(s).visible;else return Xe(`Optional content group not found: ${s}`),!0;switch(i){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return i==="And"};class Oee{constructor(e,{disableRange:t=!1,disableStream:i=!1}){yn(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:r,initialData:s,progressiveDone:a,contentDispositionFilename:o}=e;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,(s==null?void 0:s.length)>0){const l=s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength?s.buffer:new Uint8Array(s).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!i,this._isRangeSupported=!t,this._contentLength=r,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,u)=>{this._onReceiveData({begin:l,chunk:u})}),e.addProgressListener((l,u)=>{this._onProgress({loaded:l,total:u})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const i=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{const r=this._rangeReaders.some(function(s){return s._begin!==e?!1:(s._enqueue(i),!0)});yn(r,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,i,r,s;e.total===void 0?(i=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||i.call(t,{loaded:e.loaded}):(s=(r=this._fullRequestReader)==null?void 0:r.onProgress)==null||s.call(r,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){yn(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new Lee(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new Fee(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(i),i}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const i of this._rangeReaders.slice(0))i.cancel(e);this._pdfDataRangeTransport.abort()}}class Lee{constructor(e,t,i=!1,r=null){this._stream=e,this._done=i||!1,this._filename=MC(r)?r:null,this._queuedChunks=t||[],this._loaded=0;for(const s of this._queuedChunks)this._loaded+=s.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class Fee{constructor(e,t,i){this._stream=e,this._begin=t,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function zee(n){let e=!0,t=i("filename\\*","i").exec(n);if(t){t=t[1];let c=o(t);return c=unescape(c),c=l(c),c=u(c),s(c)}if(t=a(n),t){const c=u(t);return s(c)}if(t=i("filename","i").exec(n),t){t=t[1];let c=o(t);return c=u(c),s(c)}function i(c,h){return new RegExp("(?:^|;)\\s*"+c+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',h)}function r(c,h){if(c){if(!/^[\x00-\xFF]+$/.test(h))return h;try{const f=new TextDecoder(c,{fatal:!0}),m=Z1(h);h=f.decode(m),e=!1}catch{}}return h}function s(c){return e&&/[\x80-\xff]/.test(c)&&(c=r("utf-8",c),e&&(c=r("iso-8859-1",c))),c}function a(c){const h=[];let f;const m=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=m.exec(c))!==null;){let[,_,x,v]=f;if(_=parseInt(_,10),_ in h){if(_===0)break;continue}h[_]=[x,v]}const y=[];for(let _=0;_<h.length&&_ in h;++_){let[x,v]=h[_];v=o(v),x&&(v=unescape(v),_===0&&(v=l(v))),y.push(v)}return y.join("")}function o(c){if(c.startsWith('"')){const h=c.slice(1).split('\\"');for(let f=0;f<h.length;++f){const m=h[f].indexOf('"');m!==-1&&(h[f]=h[f].slice(0,m),h.length=f+1),h[f]=h[f].replaceAll(/\\(.)/g,"$1")}c=h.join('"')}return c}function l(c){const h=c.indexOf("'");if(h===-1)return c;const f=c.slice(0,h),y=c.slice(h+1).replace(/^[^']*'/,"");return r(f,y)}function u(c){return!c.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(c)?c:c.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(h,f,m,y){if(m==="q"||m==="Q")return y=y.replaceAll("_"," "),y=y.replaceAll(/=([0-9a-fA-F]{2})/g,function(_,x){return String.fromCharCode(parseInt(x,16))}),r(f,y);try{y=atob(y)}catch{}return r(f,y)})}return""}function n6(n,e){const t=new Headers;if(!n||!e||typeof e!="object")return t;for(const i in e){const r=e[i];r!==void 0&&t.append(i,r)}return t}function nx(n){try{return new URL(n).origin}catch{}return null}function i6({responseHeaders:n,isHttp:e,rangeChunkSize:t,disableRange:i}){const r={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(n.get("Content-Length"),10);return!Number.isInteger(s)||(r.suggestedLength=s,s<=2*t)||i||!e||n.get("Accept-Ranges")!=="bytes"||(n.get("Content-Encoding")||"identity")!=="identity"||(r.allowRangeRequests=!0),r}function r6(n){const e=n.get("Content-Disposition");if(e){let t=zee(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(MC(t))return t}return null}function ix(n,e){return n===404||n===0&&e.startsWith("file:")?new wy('Missing PDF "'+e+'".'):new Fb(`Unexpected server response (${n}) while retrieving PDF "${e}".`,n)}function s6(n){return n===200||n===206}function a6(n,e,t){return{method:"GET",headers:n,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function o6(n){return n instanceof Uint8Array?n.buffer:n instanceof ArrayBuffer?n:(Xe(`getArrayBuffer - unexpected data format: ${n}`),new Uint8Array(n).buffer)}class pO{constructor(e){Le(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=n6(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return yn(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Vee(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new jee(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const i of this._rangeRequestReaders.slice(0))i.cancel(e)}}class Vee{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const i=new Headers(e.headers),r=t.url;fetch(r,a6(i,this._withCredentials,this._abortController)).then(s=>{if(e._responseOrigin=nx(s.url),!s6(s.status))throw ix(s.status,r);this._reader=s.body.getReader(),this._headersCapability.resolve();const a=s.headers,{allowRangeRequests:o,suggestedLength:l}=i6({responseHeaders:a,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=l||this._contentLength,this._filename=r6(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Tu("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded,total:this._contentLength}),{value:o6(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class jee{constructor(e,t,i){this._stream=e,this._reader=null,this._loaded=0;const r=e.source;this._withCredentials=r.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!r.disableStream,this._abortController=new AbortController;const s=new Headers(e.headers);s.append("Range",`bytes=${t}-${i-1}`);const a=r.url;fetch(a,a6(s,this._withCredentials,this._abortController)).then(o=>{const l=nx(o.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!s6(o.status))throw ix(o.status,a);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded}),{value:o6(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const dA=200,hA=206;function Bee(n){const e=n.response;return typeof e!="string"?e:Z1(e).buffer}class Uee{constructor({url:e,httpHeaders:t,withCredentials:i}){Le(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=n6(this.isHttp,t),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,i=this.currXhrId++,r=this.pendingRequests[i]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[s,a]of this.headers)t.setRequestHeader(s,a);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),r.expectedStatus=hA):r.expectedStatus=dA,t.responseType="arraybuffer",yn(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,i),t.onprogress=this.onProgress.bind(this,i),r.onHeadersReceived=e.onHeadersReceived,r.onDone=e.onDone,r.onError=e.onError,r.onProgress=e.onProgress,t.send(null),i}onProgress(e,t){var r;const i=this.pendingRequests[e];i&&((r=i.onProgress)==null||r.call(i,t))}onStateChange(e,t){const i=this.pendingRequests[e];if(!i)return;const r=i.xhr;if(r.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),r.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],r.status===0&&this.isHttp){i.onError(r.status);return}const s=r.status||dA;if(!(s===dA&&i.expectedStatus===hA)&&s!==i.expectedStatus){i.onError(r.status);return}const o=Bee(r);if(s===hA){const l=r.getResponseHeader("Content-Range"),u=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);u?i.onDone({begin:parseInt(u[1],10),chunk:o}):(Xe('Missing or invalid "Content-Range" header.'),i.onError(0))}else o?i.onDone({begin:0,chunk:o}):i.onError(r.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class Hee{constructor(e){this._source=e,this._manager=new Uee(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return yn(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Wee(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const i=new qee(this._manager,e,t);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const i of this._rangeRequestReaders.slice(0))i.cancel(e)}}class Wee{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=nx(t.responseURL);const i=t.getAllResponseHeaders(),r=new Headers(i?i.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{const[l,...u]=o.split(": ");return[l,u.join(": ")]}):[]),{allowRangeRequests:s,suggestedLength:a}=i6({responseHeaders:r,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});s&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=r6(r),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=ix(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class qee{constructor(e,t,i){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:i,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=nx((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=ix(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const Gee=/^[a-z][a-z0-9\-+.]+:/i;function Kee(n){if(Gee.test(n))return new URL(n);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(n))}class Yee{constructor(e){this.source=e,this.url=Kee(e.url),yn(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return yn(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Xee(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new Qee(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const i of this._rangeRequestReaders.slice(0))i.cancel(e)}}class Xee{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const i=process.getBuiltinModule("fs");i.promises.lstat(this._url).then(r=>{this._contentLength=r.size,this._setReadableStream(i.createReadStream(this._url)),this._headersCapability.resolve()},r=>{r.code==="ENOENT"&&(r=new wy(`Missing PDF "${this._url}".`)),this._storedError=r,this._headersCapability.reject(r)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Tu("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Qee{constructor(e,t,i){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const r=e.source;this._isStreamingSupported=!r.disableStream;const s=process.getBuiltinModule("fs");this._setReadableStream(s.createReadStream(this._url,{start:t,end:i-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Jee=1e5,Hi=30,Zee=.8;var EO,Ol,Ki,r_,s_,Wc,mo,a_,o_,qc,Pf,Nf,Ll,Df,l_,Mf,Gc,u_,c_,Kc,Yc,d_,Fl,Of,Jo,l6,u6,CS,$r,b0,kS,c6,d6;const En=class En{constructor({textContentSource:e,container:t,viewport:i}){F(this,Jo);F(this,Ol,Promise.withResolvers());F(this,Ki,null);F(this,r_,!1);F(this,s_,!!((EO=globalThis.FontInspector)!=null&&EO.enabled));F(this,Wc,null);F(this,mo,null);F(this,a_,0);F(this,o_,0);F(this,qc,null);F(this,Pf,null);F(this,Nf,0);F(this,Ll,0);F(this,Df,Object.create(null));F(this,l_,[]);F(this,Mf,null);F(this,Gc,[]);F(this,u_,new WeakMap);F(this,c_,null);var l;if(e instanceof ReadableStream)R(this,Mf,e);else if(typeof e=="object")R(this,Mf,new ReadableStream({start(u){u.enqueue(e),u.close()}}));else throw new Error('No "textContentSource" parameter specified.');R(this,Ki,R(this,Pf,t)),R(this,Ll,i.scale*(globalThis.devicePixelRatio||1)),R(this,Nf,i.rotation),R(this,mo,{div:null,properties:null,ctx:null});const{pageWidth:r,pageHeight:s,pageX:a,pageY:o}=i.rawDims;R(this,c_,[1,0,0,-1,-a,o+s]),R(this,o_,r),R(this,a_,s),z(l=En,$r,c6).call(l),Hd(t,i),d(this,Ol).promise.finally(()=>{d(En,Of).delete(this),R(this,mo,null),R(this,Df,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=Di.platform;return Ze(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{d(this,qc).read().then(({value:t,done:i})=>{if(i){d(this,Ol).resolve();return}d(this,Wc)??R(this,Wc,t.lang),Object.assign(d(this,Df),t.styles),z(this,Jo,l6).call(this,t.items),e()},d(this,Ol).reject)};return R(this,qc,d(this,Mf).getReader()),d(En,Of).add(this),e(),d(this,Ol).promise}update({viewport:e,onBefore:t=null}){var s;const i=e.scale*(globalThis.devicePixelRatio||1),r=e.rotation;if(r!==d(this,Nf)&&(t==null||t(),R(this,Nf,r),Hd(d(this,Pf),{rotation:r})),i!==d(this,Ll)){t==null||t(),R(this,Ll,i);const a={div:null,properties:null,ctx:z(s=En,$r,b0).call(s,d(this,Wc))};for(const o of d(this,Gc))a.properties=d(this,u_).get(o),a.div=o,z(this,Jo,CS).call(this,a)}}cancel(){var t;const e=new Tu("TextLayer task cancelled.");(t=d(this,qc))==null||t.cancel(e).catch(()=>{}),R(this,qc,null),d(this,Ol).reject(e)}get textDivs(){return d(this,Gc)}get textContentItemsStr(){return d(this,l_)}static cleanup(){if(!(d(this,Of).size>0)){d(this,Kc).clear();for(const{canvas:e}of d(this,Yc).values())e.remove();d(this,Yc).clear()}}};Ol=new WeakMap,Ki=new WeakMap,r_=new WeakMap,s_=new WeakMap,Wc=new WeakMap,mo=new WeakMap,a_=new WeakMap,o_=new WeakMap,qc=new WeakMap,Pf=new WeakMap,Nf=new WeakMap,Ll=new WeakMap,Df=new WeakMap,l_=new WeakMap,Mf=new WeakMap,Gc=new WeakMap,u_=new WeakMap,c_=new WeakMap,Kc=new WeakMap,Yc=new WeakMap,d_=new WeakMap,Fl=new WeakMap,Of=new WeakMap,Jo=new WeakSet,l6=function(e){var r,s;if(d(this,r_))return;(s=d(this,mo)).ctx??(s.ctx=z(r=En,$r,b0).call(r,d(this,Wc)));const t=d(this,Gc),i=d(this,l_);for(const a of e){if(t.length>Jee){Xe("Ignoring additional textDivs for performance reasons."),R(this,r_,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){const o=d(this,Ki);R(this,Ki,document.createElement("span")),d(this,Ki).classList.add("markedContent"),a.id!==null&&d(this,Ki).setAttribute("id",`${a.id}`),o.append(d(this,Ki))}else a.type==="endMarkedContent"&&R(this,Ki,d(this,Ki).parentNode);continue}i.push(a.str),z(this,Jo,u6).call(this,a)}},u6=function(e){var _;const t=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};d(this,Gc).push(t);const r=Ne.transform(d(this,c_),e.transform);let s=Math.atan2(r[1],r[0]);const a=d(this,Df)[e.fontName];a.vertical&&(s+=Math.PI/2);let o=d(this,s_)&&a.fontSubstitution||a.fontFamily;o=En.fontFamilyMap.get(o)||o;const l=Math.hypot(r[2],r[3]),u=l*z(_=En,$r,d6).call(_,o,d(this,Wc));let c,h;s===0?(c=r[4],h=r[5]-u):(c=r[4]+u*Math.sin(s),h=r[5]-u*Math.cos(s));const f="calc(var(--scale-factor)*",m=t.style;d(this,Ki)===d(this,Pf)?(m.left=`${(100*c/d(this,o_)).toFixed(2)}%`,m.top=`${(100*h/d(this,a_)).toFixed(2)}%`):(m.left=`${f}${c.toFixed(2)}px)`,m.top=`${f}${h.toFixed(2)}px)`),m.fontSize=`${f}${(d(En,Fl)*l).toFixed(2)}px)`,m.fontFamily=o,i.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,d(this,s_)&&(t.dataset.fontName=a.fontSubstitutionLoadedName||e.fontName),s!==0&&(i.angle=s*(180/Math.PI));let y=!1;if(e.str.length>1)y=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const x=Math.abs(e.transform[0]),v=Math.abs(e.transform[3]);x!==v&&Math.max(x,v)/Math.min(x,v)>1.5&&(y=!0)}if(y&&(i.canvasWidth=a.vertical?e.height:e.width),d(this,u_).set(t,i),d(this,mo).div=t,d(this,mo).properties=i,z(this,Jo,CS).call(this,d(this,mo)),i.hasText&&d(this,Ki).append(t),i.hasEOL){const x=document.createElement("br");x.setAttribute("role","presentation"),d(this,Ki).append(x)}},CS=function(e){var o;const{div:t,properties:i,ctx:r}=e,{style:s}=t;let a="";if(d(En,Fl)>1&&(a=`scale(${1/d(En,Fl)})`),i.canvasWidth!==0&&i.hasText){const{fontFamily:l}=s,{canvasWidth:u,fontSize:c}=i;z(o=En,$r,kS).call(o,r,c*d(this,Ll),l);const{width:h}=r.measureText(t.textContent);h>0&&(a=`scaleX(${u*d(this,Ll)/h}) ${a}`)}i.angle!==0&&(a=`rotate(${i.angle}deg) ${a}`),a.length>0&&(s.transform=a)},$r=new WeakSet,b0=function(e=null){let t=d(this,Yc).get(e||(e=""));if(!t){const i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=e,document.body.append(i),t=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),d(this,Yc).set(e,t),d(this,d_).set(t,{size:0,family:""})}return t},kS=function(e,t,i){const r=d(this,d_).get(e);t===r.size&&i===r.family||(e.font=`${t}px ${i}`,r.size=t,r.family=i)},c6=function(){if(d(this,Fl)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),R(this,Fl,e.getBoundingClientRect().height),e.remove()},d6=function(e,t){const i=d(this,Kc).get(e);if(i)return i;const r=z(this,$r,b0).call(this,t);r.canvas.width=r.canvas.height=Hi,z(this,$r,kS).call(this,r,Hi,e);const s=r.measureText("");let a=s.fontBoundingBoxAscent,o=Math.abs(s.fontBoundingBoxDescent);if(a){const c=a/(a+o);return d(this,Kc).set(e,c),r.canvas.width=r.canvas.height=0,c}r.strokeStyle="red",r.clearRect(0,0,Hi,Hi),r.strokeText("g",0,0);let l=r.getImageData(0,0,Hi,Hi).data;o=0;for(let c=l.length-1-3;c>=0;c-=4)if(l[c]>0){o=Math.ceil(c/4/Hi);break}r.clearRect(0,0,Hi,Hi),r.strokeText("A",0,Hi),l=r.getImageData(0,0,Hi,Hi).data,a=0;for(let c=0,h=l.length;c<h;c+=4)if(l[c]>0){a=Hi-Math.floor(c/4/Hi);break}r.canvas.width=r.canvas.height=0;const u=a?a/(a+o):Zee;return d(this,Kc).set(e,u),u},F(En,$r),F(En,Kc,new Map),F(En,Yc,new Map),F(En,d_,new WeakMap),F(En,Fl,null),F(En,Of,new Set);let by=En;class xy{static textContent(e){const t=[],i={items:t,styles:Object.create(null)};function r(s){var l;if(!s)return;let a=null;const o=s.name;if(o==="#text")a=s.value;else if(xy.shouldBuildText(o))(l=s==null?void 0:s.attributes)!=null&&l.textContent?a=s.attributes.textContent:s.value&&(a=s.value);else return;if(a!==null&&t.push({str:a}),!!s.children)for(const u of s.children)r(u)}return r(e),i}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}const ete=65536,tte=100,nte=5e3,ite=wi?yee:pee,rte=wi?_ee:XU,ste=wi?gee:mee,ate=wi?vee:e6;function ote(n={}){typeof n=="string"||n instanceof URL?n={url:n}:(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n={data:n});const e=new $S,{docId:t}=e,i=n.url?lte(n.url):null,r=n.data?ute(n.data):null,s=n.httpHeaders||null,a=n.withCredentials===!0,o=n.password??null,l=n.range instanceof h6?n.range:null,u=Number.isInteger(n.rangeChunkSize)&&n.rangeChunkSize>0?n.rangeChunkSize:ete;let c=n.worker instanceof df?n.worker:null;const h=n.verbosity,f=typeof n.docBaseUrl=="string"&&!tx(n.docBaseUrl)?n.docBaseUrl:null,m=typeof n.cMapUrl=="string"?n.cMapUrl:null,y=n.cMapPacked!==!1,_=n.CMapReaderFactory||rte,x=typeof n.standardFontDataUrl=="string"?n.standardFontDataUrl:null,v=n.StandardFontDataFactory||ate,w=n.stopAtErrors!==!0,E=Number.isInteger(n.maxImageSize)&&n.maxImageSize>-1?n.maxImageSize:-1,C=n.isEvalSupported!==!1,D=typeof n.isOffscreenCanvasSupported=="boolean"?n.isOffscreenCanvasSupported:!wi,V=typeof n.isImageDecoderSupported=="boolean"?n.isImageDecoderSupported:!wi&&(Di.platform.isFirefox||!globalThis.chrome),I=Number.isInteger(n.canvasMaxAreaInBytes)?n.canvasMaxAreaInBytes:-1,k=typeof n.disableFontFace=="boolean"?n.disableFontFace:wi,N=n.fontExtraProperties===!0,L=n.enableXfa===!0,j=n.ownerDocument||globalThis.document,H=n.disableRange===!0,M=n.disableStream===!0,se=n.disableAutoFetch===!0,ue=n.pdfBug===!0,ee=n.CanvasFactory||ite,ae=n.FilterFactory||ste,J=n.enableHWA===!0,q=l?l.length:n.length??NaN,G=typeof n.useSystemFonts=="boolean"?n.useSystemFonts:!wi&&!k,U=typeof n.useWorkerFetch=="boolean"?n.useWorkerFetch:_===XU&&v===e6&&m&&x&&og(m,document.baseURI)&&og(x,document.baseURI),Y=null;qZ(h);const K={canvasFactory:new ee({ownerDocument:j,enableHWA:J}),filterFactory:new ae({docId:t,ownerDocument:j}),cMapReaderFactory:U?null:new _({baseUrl:m,isCompressed:y}),standardFontDataFactory:U?null:new v({baseUrl:x})};if(!c){const ve={verbosity:h,port:Po.workerPort};c=ve.port?df.fromPort(ve):new df(ve),e._worker=c}const Z={docId:t,apiVersion:"4.10.38",data:r,password:o,disableAutoFetch:se,rangeChunkSize:u,length:q,docBaseUrl:f,enableXfa:L,evaluatorOptions:{maxImageSize:E,disableFontFace:k,ignoreErrors:w,isEvalSupported:C,isOffscreenCanvasSupported:D,isImageDecoderSupported:V,canvasMaxAreaInBytes:I,fontExtraProperties:N,useSystemFonts:G,cMapUrl:U?m:null,standardFontDataUrl:U?x:null}},ge={disableFontFace:k,fontExtraProperties:N,ownerDocument:j,pdfBug:ue,styleElement:Y,loadingParams:{disableAutoFetch:se,enableXfa:L}};return c.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const ve=c.messageHandler.sendWithPromise("GetDocRequest",Z,r?[r.buffer]:null);let Q;if(l)Q=new Oee(l,{disableRange:H,disableStream:M});else if(!r){if(!i)throw new Error("getDocument - no `url` parameter provided.");let be;if(wi)if(og(i)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");be=pO}else be=Yee;else be=og(i)?pO:Hee;Q=new be({url:i,length:q,httpHeaders:s,withCredentials:a,rangeChunkSize:u,disableRange:H,disableStream:M})}return ve.then(be=>{if(e.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const vt=new dg(t,be,c.port),mt=new fte(vt,e,Q,ge,K);e._transport=mt,vt.send("Ready",null)})}).catch(e._capability.reject),e}function lte(n){if(n instanceof URL)return n.href;try{return new URL(n,window.location).href}catch{if(wi&&typeof n=="string")return n}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function ute(n){if(wi&&typeof Buffer<"u"&&n instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength)return n;if(typeof n=="string")return Z1(n);if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)||typeof n=="object"&&!isNaN(n==null?void 0:n.length))return new Uint8Array(n);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function mO(n){return typeof n=="object"&&Number.isInteger(n==null?void 0:n.num)&&n.num>=0&&Number.isInteger(n==null?void 0:n.gen)&&n.gen>=0}var t1;const n1=class n1{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${Ti(n1,t1)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var e,t,i,r;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(s){throw(i=this._worker)!=null&&i.port&&delete this._worker._pendingDestroy,s}this._transport=null,(r=this._worker)==null||r.destroy(),this._worker=null}};t1=new WeakMap,F(n1,t1,0);let $S=n1;class h6{constructor(e,t,i=!1,r=null){this.length=e,this.initialData=t,this.progressiveDone=i,this.contentDispositionFilename=r,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const i of this._rangeListeners)i(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(const i of this._progressListeners)i(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(const t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){Rt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class cte{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Ze(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var zl,go,Kr,Rh,x0;class dte{constructor(e,t,i,r=!1){F(this,Kr);F(this,zl,null);F(this,go,!1);this._pageIndex=e,this._pageInfo=t,this._transport=i,this._stats=r?new tO:null,this._pdfBug=r,this.commonObjs=i.commonObjs,this.objs=new f6,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:i=0,offsetY:r=0,dontFlip:s=!1}={}){return new dv({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:i,offsetY:r,dontFlip:s})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Ze(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,viewport:t,intent:i="display",annotationMode:r=xl.ENABLE,transform:s=null,background:a=null,optionalContentConfigPromise:o=null,annotationCanvasMap:l=null,pageColors:u=null,printAnnotationStorage:c=null,isEditing:h=!1}){var C,D;(C=this._stats)==null||C.time("Overall");const f=this._transport.getRenderingIntent(i,r,c,h),{renderingIntent:m,cacheKey:y}=f;R(this,go,!1),z(this,Kr,x0).call(this),o||(o=this._transport.getOptionalContentConfig(m));let _=this._intentStates.get(y);_||(_=Object.create(null),this._intentStates.set(y,_)),_.streamReaderCancelTimeout&&(clearTimeout(_.streamReaderCancelTimeout),_.streamReaderCancelTimeout=null);const x=!!(m&wr.PRINT);_.displayReadyCapability||(_.displayReadyCapability=Promise.withResolvers(),_.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(D=this._stats)==null||D.time("Page Request"),this._pumpOperatorList(f));const v=V=>{var I;_.renderTasks.delete(w),(this._maybeCleanupAfterRender||x)&&R(this,go,!0),z(this,Kr,Rh).call(this,!x),V?(w.capability.reject(V),this._abortOperatorList({intentState:_,reason:V instanceof Error?V:new Error(V)})):w.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(I=globalThis.Stats)!=null&&I.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},w=new PS({callback:v,params:{canvasContext:e,viewport:t,transform:s,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:_.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!x,pdfBug:this._pdfBug,pageColors:u});(_.renderTasks||(_.renderTasks=new Set)).add(w);const E=w.task;return Promise.all([_.displayReadyCapability.promise,o]).then(([V,I])=>{var k;if(this.destroyed){v();return}if((k=this._stats)==null||k.time("Rendering"),!(I.renderingIntent&m))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");w.initializeGraphics({transparency:V,optionalContentConfig:I}),w.operatorListChanged()}).catch(v),E}getOperatorList({intent:e="display",annotationMode:t=xl.ENABLE,printAnnotationStorage:i=null,isEditing:r=!1}={}){var u;function s(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(l))}const a=this._transport.getRenderingIntent(e,t,i,r,!0);let o=this._intentStates.get(a.cacheKey);o||(o=Object.create(null),this._intentStates.set(a.cacheKey,o));let l;return o.opListReadCapability||(l=Object.create(null),l.operatorListChanged=s,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||(o.renderTasks=new Set)).add(l),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(u=this._stats)==null||u.time("Page Request"),this._pumpOperatorList(a)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(r){return r.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>xy.textContent(i));const t=this.streamTextContent(e);return new Promise(function(i,r){function s(){a.read().then(function({value:l,done:u}){if(u){i(o);return}o.lang??(o.lang=l.lang),Object.assign(o.styles,l.styles),o.items.push(...l.items),s()},r)}const a=t.getReader(),o={items:[],styles:Object.create(null),lang:null};s()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const i of t.renderTasks)e.push(i.completed),i.cancel();return this.objs.clear(),R(this,go,!1),z(this,Kr,x0).call(this),Promise.all(e)}cleanup(e=!1){R(this,go,!0);const t=z(this,Kr,Rh).call(this,!1);return e&&t&&this._stats&&(this._stats=new tO),t}_startRenderPage(e,t){var r,s;const i=this._intentStates.get(t);i&&((r=this._stats)==null||r.timeEnd("Page Request"),(s=i.displayReadyCapability)==null||s.resolve(e))}_renderPageChunk(e,t){for(let i=0,r=e.length;i<r;i++)t.operatorList.fnArray.push(e.fnArray[i]),t.operatorList.argsArray.push(e.argsArray[i]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const i of t.renderTasks)i.operatorListChanged();e.lastChunk&&z(this,Kr,Rh).call(this,!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:i,modifiedIds:r}){const{map:s,transfer:a}=i,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:s,modifiedIds:r},a).getReader(),u=this._intentStates.get(t);u.streamReader=l;const c=()=>{l.read().then(({value:h,done:f})=>{if(f){u.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(h,u),c())},h=>{if(u.streamReader=null,!this._transport.destroyed){if(u.operatorList){u.operatorList.lastChunk=!0;for(const f of u.renderTasks)f.operatorListChanged();z(this,Kr,Rh).call(this,!0)}if(u.displayReadyCapability)u.displayReadyCapability.reject(h);else if(u.opListReadCapability)u.opListReadCapability.reject(h);else throw h}})};c()}_abortOperatorList({intentState:e,reason:t,force:i=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!i){if(e.renderTasks.size>0)return;if(t instanceof DC){let r=tte;t.extraDelay>0&&t.extraDelay<1e3&&(r+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},r);return}}if(e.streamReader.cancel(new Tu(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[r,s]of this._intentStates)if(s===e){this._intentStates.delete(r);break}this.cleanup()}}}get stats(){return this._stats}}zl=new WeakMap,go=new WeakMap,Kr=new WeakSet,Rh=function(e=!1){if(z(this,Kr,x0).call(this),!d(this,go)||this.destroyed)return!1;if(e)return R(this,zl,setTimeout(()=>{R(this,zl,null),z(this,Kr,Rh).call(this,!1)},nte)),!1;for(const{renderTasks:t,operatorList:i}of this._intentStates.values())if(t.size>0||!i.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),R(this,go,!1),!0},x0=function(){d(this,zl)&&(clearTimeout(d(this,zl)),R(this,zl,null))};var yo,i1;class hte{constructor(){F(this,yo,new Map);F(this,i1,Promise.resolve())}postMessage(e,t){const i={data:structuredClone(e,t?{transfer:t}:null)};d(this,i1).then(()=>{for(const[r]of d(this,yo))r.call(this,i)})}addEventListener(e,t,i=null){let r=null;if((i==null?void 0:i.signal)instanceof AbortSignal){const{signal:s}=i;if(s.aborted){Xe("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(e,t);r=()=>s.removeEventListener("abort",a),s.addEventListener("abort",a)}d(this,yo).set(t,r)}removeEventListener(e,t){const i=d(this,yo).get(t);i==null||i(),d(this,yo).delete(t)}terminate(){for(const[,e]of d(this,yo))e==null||e();d(this,yo).clear()}}yo=new WeakMap,i1=new WeakMap;var r1,Xc,Qc,Lf,E0,Ff,A0;const jt=class jt{constructor({name:e=null,port:t=null,verbosity:i=GZ()}={}){F(this,Lf);var r;if(this.name=e,this.destroyed=!1,this.verbosity=i,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if((r=d(jt,Qc))!=null&&r.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(d(jt,Qc)||R(jt,Qc,new WeakMap)).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new dg("main","worker",e),this._messageHandler.on("ready",function(){}),z(this,Lf,E0).call(this)}_initialize(){if(d(jt,Xc)||d(jt,Ff,A0)){this._setupFakeWorker();return}let{workerSrc:e}=jt;try{jt._isSameOrigin(window.location.href,e)||(e=jt._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),i=new dg("main","worker",t),r=()=>{s.abort(),i.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},s=new AbortController;t.addEventListener("error",()=>{this._webWorker||r()},{signal:s.signal}),i.on("test",o=>{if(s.abort(),this.destroyed||!o){r();return}this._messageHandler=i,this._port=t,this._webWorker=t,z(this,Lf,E0).call(this)}),i.on("ready",o=>{if(s.abort(),this.destroyed){r();return}try{a()}catch{this._setupFakeWorker()}});const a=()=>{const o=new Uint8Array;i.send("test",o,[o.buffer])};a();return}catch{J1("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){d(jt,Xc)||(Xe("Setting up fake worker."),R(jt,Xc,!0)),jt._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const t=new hte;this._port=t;const i=`fake${Ti(jt,r1)._++}`,r=new dg(i+"_worker",i,t);e.setup(r,t),this._messageHandler=new dg(i,i+"_worker",t),z(this,Lf,E0).call(this)}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){var e,t,i;this.destroyed=!0,(e=this._webWorker)==null||e.terminate(),this._webWorker=null,(t=d(jt,Qc))==null||t.delete(this._port),this._port=null,(i=this._messageHandler)==null||i.destroy(),this._messageHandler=null}static fromPort(e){var i;if(!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const t=(i=d(this,Qc))==null?void 0:i.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new jt(e)}static get workerSrc(){if(Po.workerSrc)return Po.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Ze(this,"_setupFakeWorkerGlobal",(async()=>d(this,Ff,A0)?d(this,Ff,A0):(await import(this.workerSrc)).WorkerMessageHandler)())}};r1=new WeakMap,Xc=new WeakMap,Qc=new WeakMap,Lf=new WeakSet,E0=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},Ff=new WeakSet,A0=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},F(jt,Ff),F(jt,r1,0),F(jt,Xc,!1),F(jt,Qc),wi&&(R(jt,Xc,!0),Po.workerSrc||(Po.workerSrc="./pdf.worker.mjs")),jt._isSameOrigin=(e,t)=>{let i;try{if(i=new URL(e),!i.origin||i.origin==="null")return!1}catch{return!1}const r=new URL(t,i);return i.origin===r.origin},jt._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};let df=jt;var _o,wa,zf,Vf,vo,Jc,gg;class fte{constructor(e,t,i,r,s){F(this,Jc);F(this,_o,new Map);F(this,wa,new Map);F(this,zf,new Map);F(this,Vf,new Map);F(this,vo,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new f6,this.fontLoader=new hee({ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this.loadingParams=r.loadingParams,this._params=r,this.canvasFactory=s.canvasFactory,this.filterFactory=s.filterFactory,this.cMapReaderFactory=s.cMapReaderFactory,this.standardFontDataFactory=s.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return Ze(this,"annotationStorage",new FC)}getRenderingIntent(e,t=xl.ENABLE,i=null,r=!1,s=!1){let a=wr.DISPLAY,o=vS;switch(e){case"any":a=wr.ANY;break;case"display":break;case"print":a=wr.PRINT;break;default:Xe(`getRenderingIntent - invalid intent: ${e}`)}const l=a&wr.PRINT&&i instanceof HU?i:this.annotationStorage;switch(t){case xl.DISABLE:a+=wr.ANNOTATIONS_DISABLE;break;case xl.ENABLE:break;case xl.ENABLE_FORMS:a+=wr.ANNOTATIONS_FORMS;break;case xl.ENABLE_STORAGE:a+=wr.ANNOTATIONS_STORAGE,o=l.serializable;break;default:Xe(`getRenderingIntent - invalid annotationMode: ${t}`)}r&&(a+=wr.IS_EDITING),s&&(a+=wr.OPLIST);const{ids:u,hash:c}=l.modifiedIds,h=[a,o.hash,c];return{renderingIntent:a,cacheKey:h.join("_"),annotationStorageSerializable:o,modifiedIds:u}}destroy(){var i;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(i=d(this,vo))==null||i.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const r of d(this,wa).values())e.push(r._destroy());d(this,wa).clear(),d(this,zf).clear(),d(this,Vf).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var r,s;this.commonObjs.clear(),this.fontLoader.clear(),d(this,_o).clear(),this.filterFactory.destroy(),by.cleanup(),(r=this._networkStream)==null||r.cancelAllRequests(new Tu("Worker was terminated.")),(s=this.messageHandler)==null||s.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(i,r)=>{yn(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=s=>{this._lastProgress={loaded:s.loaded,total:s.total}},r.onPull=()=>{this._fullReader.read().then(function({value:s,done:a}){if(a){r.close();return}yn(s instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(s),1,[s])}).catch(s=>{r.error(s)})},r.onCancel=s=>{this._fullReader.cancel(s),r.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("ReaderHeadersReady",async i=>{var o;await this._fullReader.headersReady;const{isStreamingSupported:r,isRangeSupported:s,contentLength:a}=this._fullReader;return(!r||!s)&&(this._lastProgress&&((o=t.onProgress)==null||o.call(t,this._lastProgress)),this._fullReader.onProgress=l=>{var u;(u=t.onProgress)==null||u.call(t,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:r,isRangeSupported:s,contentLength:a}}),e.on("GetRangeReader",(i,r)=>{yn(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const s=this._networkStream.getRangeReader(i.begin,i.end);if(!s){r.close();return}r.onPull=()=>{s.read().then(function({value:a,done:o}){if(o){r.close();return}yn(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{r.error(a)})},r.onCancel=a=>{s.cancel(a),r.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,t._capability.resolve(new cte(i,this))}),e.on("DocException",i=>{t._capability.reject(Wi(i))}),e.on("PasswordRequest",i=>{R(this,vo,Promise.withResolvers());try{if(!t.onPassword)throw Wi(i);const r=s=>{s instanceof Error?d(this,vo).reject(s):d(this,vo).resolve({password:s})};t.onPassword(r,i.code)}catch(r){d(this,vo).reject(r)}return d(this,vo).promise}),e.on("DataLoaded",i=>{var r;(r=t.onProgress)==null||r.call(t,{loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),e.on("StartRenderPage",i=>{if(this.destroyed)return;d(this,wa).get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),e.on("commonobj",([i,r,s])=>{var a;if(this.destroyed||this.commonObjs.has(i))return null;switch(r){case"Font":const{disableFontFace:o,fontExtraProperties:l,pdfBug:u}=this._params;if("error"in s){const m=s.error;Xe(`Error during font loading: ${m}`),this.commonObjs.resolve(i,m);break}const c=u&&((a=globalThis.FontInspector)!=null&&a.enabled)?(m,y)=>globalThis.FontInspector.fontAdded(m,y):null,h=new fee(s,{disableFontFace:o,fontExtraProperties:l,inspectFont:c});this.fontLoader.bind(h).catch(()=>e.sendWithPromise("FontFallback",{id:i})).finally(()=>{!l&&h.data&&(h.data=null),this.commonObjs.resolve(i,h)});break;case"CopyLocalImage":const{imageRef:f}=s;yn(f,"The imageRef must be defined.");for(const m of d(this,wa).values())for(const[,y]of m.objs)if((y==null?void 0:y.ref)===f)return y.dataLen?(this.commonObjs.resolve(i,structuredClone(y)),y.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(i,s);break;default:throw new Error(`Got unknown common object type ${r}`)}return null}),e.on("obj",([i,r,s,a])=>{var l;if(this.destroyed)return;const o=d(this,wa).get(r);if(!o.objs.has(i)){if(o._intentStates.size===0){(l=a==null?void 0:a.bitmap)==null||l.close();return}switch(s){case"Image":o.objs.resolve(i,a),(a==null?void 0:a.dataLen)>BZ&&(o._maybeCleanupAfterRender=!0);break;case"Pattern":o.objs.resolve(i,a);break;default:throw new Error(`Got unknown object type ${s}`)}}}),e.on("DocProgress",i=>{var r;this.destroyed||(r=t.onProgress)==null||r.call(t,{loaded:i.loaded,total:i.total})}),e.on("FetchBuiltInCMap",async i=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(i)}),e.on("FetchStandardFontData",async i=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(i)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var i;this.annotationStorage.size<=0&&Xe("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((i=this._fullReader)==null?void 0:i.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,i=d(this,zf).get(t);if(i)return i;const r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(s=>{if(this.destroyed)throw new Error("Transport destroyed");s.refStr&&d(this,Vf).set(s.refStr,e);const a=new dte(t,s,this,this._params.pdfBug);return d(this,wa).set(t,a),a});return d(this,zf).set(t,r),r}getPageIndex(e){return mO(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return z(this,Jc,gg).call(this,"GetFieldObjects")}hasJSActions(){return z(this,Jc,gg).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return z(this,Jc,gg).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return z(this,Jc,gg).call(this,"GetOptionalContentConfig").then(t=>new Mee(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=d(this,_o).get(e);if(t)return t;const i=this.messageHandler.sendWithPromise(e,null).then(r=>{var s,a;return{info:r[0],metadata:r[1]?new Nee(r[1]):null,contentDispositionFilename:((s=this._fullReader)==null?void 0:s.filename)??null,contentLength:((a=this._fullReader)==null?void 0:a.contentLength)??null}});return d(this,_o).set(e,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of d(this,wa).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),d(this,_o).clear(),this.filterFactory.destroy(!0),by.cleanup()}}cachedPageNumber(e){if(!mO(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return d(this,Vf).get(t)??null}}_o=new WeakMap,wa=new WeakMap,zf=new WeakMap,Vf=new WeakMap,vo=new WeakMap,Jc=new WeakSet,gg=function(e,t=null){const i=d(this,_o).get(e);if(i)return i;const r=this.messageHandler.sendWithPromise(e,t);return d(this,_o).set(e,r),r};const Um=Symbol("INITIAL_DATA");var dr,h_,RS;class f6{constructor(){F(this,h_);F(this,dr,Object.create(null))}get(e,t=null){if(t){const r=z(this,h_,RS).call(this,e);return r.promise.then(()=>t(r.data)),null}const i=d(this,dr)[e];if(!i||i.data===Um)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return i.data}has(e){const t=d(this,dr)[e];return!!t&&t.data!==Um}delete(e){const t=d(this,dr)[e];return!t||t.data===Um?!1:(delete d(this,dr)[e],!0)}resolve(e,t=null){const i=z(this,h_,RS).call(this,e);i.data=t,i.resolve()}clear(){var e;for(const t in d(this,dr)){const{data:i}=d(this,dr)[t];(e=i==null?void 0:i.bitmap)==null||e.close()}R(this,dr,Object.create(null))}*[Symbol.iterator](){for(const e in d(this,dr)){const{data:t}=d(this,dr)[e];t!==Um&&(yield[e,t])}}}dr=new WeakMap,h_=new WeakSet,RS=function(e){var t;return(t=d(this,dr))[e]||(t[e]={...Promise.withResolvers(),data:Um})};var Vl;class pte{constructor(e){F(this,Vl,null);R(this,Vl,e),this.onContinue=null}get promise(){return d(this,Vl).capability.promise}cancel(e=0){d(this,Vl).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=d(this,Vl).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=d(this,Vl);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}Vl=new WeakMap;var jl,Zc;const gc=class gc{constructor({callback:e,params:t,objs:i,commonObjs:r,annotationCanvasMap:s,operatorList:a,pageIndex:o,canvasFactory:l,filterFactory:u,useRequestAnimationFrame:c=!1,pdfBug:h=!1,pageColors:f=null}){F(this,jl,null);this.callback=e,this.params=t,this.objs=i,this.commonObjs=r,this.annotationCanvasMap=s,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=u,this._pdfBug=h,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=c===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new pte(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var o,l;if(this.cancelled)return;if(this._canvas){if(d(gc,Zc).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");d(gc,Zc).add(this._canvas)}this._pdfBug&&((o=globalThis.StepperManager)!=null&&o.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:i,viewport:r,transform:s,background:a}=this.params;this.gfx=new cf(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:s,viewport:r,transparency:e,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(e=null,t=0){var i;this.running=!1,this.cancelled=!0,(i=this.gfx)==null||i.endDrawing(),d(this,jl)&&(window.cancelAnimationFrame(d(this,jl)),R(this,jl,null)),d(gc,Zc).delete(this._canvas),this.callback(e||new DC(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){var e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?R(this,jl,window.requestAnimationFrame(()=>{R(this,jl,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),d(gc,Zc).delete(this._canvas),this.callback())))}};jl=new WeakMap,Zc=new WeakMap,F(gc,Zc,new WeakSet);let PS=gc;const mte="4.10.38",gte="f9bea397f";function gO(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0")}function Hm(n){return Math.max(0,Math.min(255,255*n))}class yO{static CMYK_G([e,t,i,r]){return["G",1-Math.min(1,.3*e+.59*i+.11*t+r)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=Hm(e),[e,e,e]}static G_HTML([e]){const t=gO(e);return`#${t}${t}${t}`}static RGB_G([e,t,i]){return["G",.3*e+.59*t+.11*i]}static RGB_rgb(e){return e.map(Hm)}static RGB_HTML(e){return`#${e.map(gO).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,i,r]){return["RGB",1-Math.min(1,e+r),1-Math.min(1,i+r),1-Math.min(1,t+r)]}static CMYK_rgb([e,t,i,r]){return[Hm(1-Math.min(1,e+r)),Hm(1-Math.min(1,i+r)),Hm(1-Math.min(1,t+r))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,i]){const r=1-e,s=1-t,a=1-i,o=Math.min(r,s,a);return["CMYK",r,s,a,o]}}class yte{create(e,t,i=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const r=this._createSVG("svg:svg");return r.setAttribute("version","1.1"),i||(r.setAttribute("width",`${e}px`),r.setAttribute("height",`${t}px`)),r.setAttribute("preserveAspectRatio","none"),r.setAttribute("viewBox",`0 0 ${e} ${t}`),r}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){Rt("Abstract method `_createSVG` called.")}}class VC extends yte{_createSVG(e){return document.createElementNS(Ja,e)}}class p6{static setupStorage(e,t,i,r,s){const a=r.getValue(t,{value:null});switch(i.name){case"textarea":if(a.value!==null&&(e.textContent=a.value),s==="print")break;e.addEventListener("input",o=>{r.setValue(t,{value:o.target.value})});break;case"input":if(i.attributes.type==="radio"||i.attributes.type==="checkbox"){if(a.value===i.attributes.xfaOn?e.setAttribute("checked",!0):a.value===i.attributes.xfaOff&&e.removeAttribute("checked"),s==="print")break;e.addEventListener("change",o=>{r.setValue(t,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&e.setAttribute("value",a.value),s==="print")break;e.addEventListener("input",o=>{r.setValue(t,{value:o.target.value})})}break;case"select":if(a.value!==null){e.setAttribute("value",a.value);for(const o of i.children)o.attributes.value===a.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}e.addEventListener("input",o=>{const l=o.target.options,u=l.selectedIndex===-1?"":l[l.selectedIndex].value;r.setValue(t,{value:u})});break}}static setAttributes({html:e,element:t,storage:i=null,intent:r,linkService:s}){const{attributes:a}=t,o=e instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${r}`);for(const[l,u]of Object.entries(a))if(u!=null)switch(l){case"class":u.length&&e.setAttribute(l,u.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",u);break;case"style":Object.assign(e.style,u);break;case"textContent":e.textContent=u;break;default:(!o||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,u)}o&&s.addLinkAttributes(e,a.href,a.newWindow),i&&a.dataId&&this.setupStorage(e,a.dataId,t,i)}static render(e){var h,f;const t=e.annotationStorage,i=e.linkService,r=e.xfaHtml,s=e.intent||"display",a=document.createElement(r.name);r.attributes&&this.setAttributes({html:a,element:r,intent:s,linkService:i});const o=s!=="richText",l=e.div;if(l.append(a),e.viewport){const m=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=m}o&&l.setAttribute("class","xfaLayer xfaFont");const u=[];if(r.children.length===0){if(r.value){const m=document.createTextNode(r.value);a.append(m),o&&xy.shouldBuildText(r.name)&&u.push(m)}return{textDivs:u}}const c=[[r,-1,a]];for(;c.length>0;){const[m,y,_]=c.at(-1);if(y+1===m.children.length){c.pop();continue}const x=m.children[++c.at(-1)[1]];if(x===null)continue;const{name:v}=x;if(v==="#text"){const E=document.createTextNode(x.value);u.push(E),_.append(E);continue}const w=(h=x==null?void 0:x.attributes)!=null&&h.xmlns?document.createElementNS(x.attributes.xmlns,v):document.createElement(v);if(_.append(w),x.attributes&&this.setAttributes({html:w,element:x,storage:t,intent:s,linkService:i}),((f=x.children)==null?void 0:f.length)>0)c.push([x,-1,w]);else if(x.value){const E=document.createTextNode(x.value);o&&xy.shouldBuildText(v)&&u.push(E),w.append(E)}}for(const m of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))m.setAttribute("readOnly",!0);return{textDivs:u}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const fv=1e3,_te=9,qd=new WeakSet;function pu(n){return{width:n[2]-n[0],height:n[3]-n[1]}}class vte{static create(e){switch(e.data.annotationType){case xn.LINK:return new m6(e);case xn.TEXT:return new wte(e);case xn.WIDGET:switch(e.data.fieldType){case"Tx":return new bte(e);case"Btn":return e.data.radioButton?new _6(e):e.data.checkBox?new Ete(e):new Ate(e);case"Ch":return new Tte(e);case"Sig":return new xte(e)}return new sh(e);case xn.POPUP:return new DS(e);case xn.FREETEXT:return new E6(e);case xn.LINE:return new Ite(e);case xn.SQUARE:return new Cte(e);case xn.CIRCLE:return new kte(e);case xn.POLYLINE:return new A6(e);case xn.CARET:return new Rte(e);case xn.INK:return new jC(e);case xn.POLYGON:return new $te(e);case xn.HIGHLIGHT:return new T6(e);case xn.UNDERLINE:return new Pte(e);case xn.SQUIGGLY:return new Nte(e);case xn.STRIKEOUT:return new Dte(e);case xn.STAMP:return new S6(e);case xn.FILEATTACHMENT:return new Mte(e);default:return new cn(e)}}}var ed,jf,Bf,f_,NS;const qC=class qC{constructor(e,{isRenderable:t=!1,ignoreBorder:i=!1,createQuadrilaterals:r=!1}={}){F(this,f_);F(this,ed,null);F(this,jf,!1);F(this,Bf,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(i)),r&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:i}){return!!(e!=null&&e.str||t!=null&&t.str||i!=null&&i.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return qC._hasPopupData(this.data)}updateEdited(e){var i;if(!this.container)return;d(this,ed)||R(this,ed,{rect:this.data.rect.slice(0)});const{rect:t}=e;t&&z(this,f_,NS).call(this,t),(i=d(this,Bf))==null||i.popup.updateEdited(e)}resetEdited(){var e;d(this,ed)&&(z(this,f_,NS).call(this,d(this,ed).rect),(e=d(this,Bf))==null||e.popup.resetEdited(),R(this,ed,null))}_createContainer(e){const{data:t,parent:{page:i,viewport:r}}=this,s=document.createElement("section");s.setAttribute("data-annotation-id",t.id),this instanceof sh||(s.tabIndex=fv);const{style:a}=s;if(a.zIndex=this.parent.zIndex++,t.alternativeText&&(s.title=t.alternativeText),t.noRotate&&s.classList.add("norotate"),!t.rect||this instanceof DS){const{rotation:_}=t;return!t.hasOwnCanvas&&_!==0&&this.setRotation(_,s),s}const{width:o,height:l}=pu(t.rect);if(!e&&t.borderStyle.width>0){a.borderWidth=`${t.borderStyle.width}px`;const _=t.borderStyle.horizontalCornerRadius,x=t.borderStyle.verticalCornerRadius;if(_>0||x>0){const w=`calc(${_}px * var(--scale-factor)) / calc(${x}px * var(--scale-factor))`;a.borderRadius=w}else if(this instanceof _6){const w=`calc(${o}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;a.borderRadius=w}switch(t.borderStyle.style){case jm.SOLID:a.borderStyle="solid";break;case jm.DASHED:a.borderStyle="dashed";break;case jm.BEVELED:Xe("Unimplemented border style: beveled");break;case jm.INSET:Xe("Unimplemented border style: inset");break;case jm.UNDERLINE:a.borderBottomStyle="solid";break}const v=t.borderColor||null;v?(R(this,jf,!0),a.borderColor=Ne.makeHexColor(v[0]|0,v[1]|0,v[2]|0)):a.borderWidth=0}const u=Ne.normalizeRect([t.rect[0],i.view[3]-t.rect[1]+i.view[1],t.rect[2],i.view[3]-t.rect[3]+i.view[1]]),{pageWidth:c,pageHeight:h,pageX:f,pageY:m}=r.rawDims;a.left=`${100*(u[0]-f)/c}%`,a.top=`${100*(u[1]-m)/h}%`;const{rotation:y}=t;return t.hasOwnCanvas||y===0?(a.width=`${100*o/c}%`,a.height=`${100*l/h}%`):this.setRotation(y,s),s}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:i,pageHeight:r}=this.parent.viewport.rawDims,{width:s,height:a}=pu(this.data.rect);let o,l;e%180===0?(o=100*s/i,l=100*a/r):(o=100*a/i,l=100*s/r),t.style.width=`${o}%`,t.style.height=`${l}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,i,r)=>{const s=r.detail[t],a=s[0],o=s.slice(1);r.target.style[i]=yO[`${a}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[i]:yO[`${a}_rgb`](o)})};return Ze(this,"_commonActions",{display:t=>{const{display:i}=t.detail,r=i%2===1;this.container.style.visibility=r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:r,noPrint:i===1||i===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:i}=t.detail;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:i,noView:i})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const i=t.detail.rotation;this.setRotation(i),this.annotationStorage.setValue(this.data.id,{rotation:i})}})}_dispatchEventFromSandbox(e,t){const i=this._commonActions;for(const r of Object.keys(t.detail)){const s=e[r]||i[r];s==null||s(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const i=this._commonActions;for(const[r,s]of Object.entries(t)){const a=i[r];if(a){const o={detail:{[r]:s},target:e};a(o),delete t[r]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,i,r,s]=this.data.rect.map(_=>Math.fround(_));if(e.length===8){const[_,x,v,w]=e.subarray(2,6);if(r===_&&s===x&&t===v&&i===w)return}const{style:a}=this.container;let o;if(d(this,jf)){const{borderColor:_,borderWidth:x}=a;a.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${_}" stroke-width="${x}">`],this.container.classList.add("hasBorder")}const l=r-t,u=s-i,{svgFactory:c}=this,h=c.createElement("svg");h.classList.add("quadrilateralsContainer"),h.setAttribute("width",0),h.setAttribute("height",0);const f=c.createElement("defs");h.append(f);const m=c.createElement("clipPath"),y=`clippath_${this.data.id}`;m.setAttribute("id",y),m.setAttribute("clipPathUnits","objectBoundingBox"),f.append(m);for(let _=2,x=e.length;_<x;_+=8){const v=e[_],w=e[_+1],E=e[_+2],C=e[_+3],D=c.createElement("rect"),V=(E-t)/l,I=(s-w)/u,k=(v-E)/l,N=(w-C)/u;D.setAttribute("x",V),D.setAttribute("y",I),D.setAttribute("width",k),D.setAttribute("height",N),m.append(D),o==null||o.push(`<rect vector-effect="non-scaling-stroke" x="${V}" y="${I}" width="${k}" height="${N}"/>`)}d(this,jf)&&(o.push("</g></svg>')"),a.backgroundImage=o.join("")),this.container.append(h),this.container.style.clipPath=`url(#${y})`}_createPopup(){const{data:e}=this,t=R(this,Bf,new DS({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){Rt("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const i=[];if(this._fieldObjects){const r=this._fieldObjects[e];if(r)for(const{page:s,id:a,exportValues:o}of r){if(s===-1||a===t)continue;const l=typeof o=="string"?o:null,u=document.querySelector(`[data-element-id="${a}"]`);if(u&&!qd.has(u)){Xe(`_getElementsByName - element not allowed: ${a}`);continue}i.push({id:a,exportValue:l,domElement:u})}return i}for(const r of document.getElementsByName(e)){const{exportValue:s}=r,a=r.getAttribute("data-element-id");a!==t&&qd.has(r)&&i.push({id:a,exportValue:s,domElement:r})}return i}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var i;(i=this.linkService.eventBus)==null||i.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}};ed=new WeakMap,jf=new WeakMap,Bf=new WeakMap,f_=new WeakSet,NS=function(e){const{container:{style:t},data:{rect:i,rotation:r},parent:{viewport:{rawDims:{pageWidth:s,pageHeight:a,pageX:o,pageY:l}}}}=this;i==null||i.splice(0,4,...e);const{width:u,height:c}=pu(e);t.left=`${100*(e[0]-o)/s}%`,t.top=`${100*(a-e[3]+l)/a}%`,r===0?(t.width=`${100*u/s}%`,t.height=`${100*c/a}%`):this.setRotation(r)};let cn=qC;var Er,uc,g6,y6;class m6 extends cn{constructor(t,i=null){super(t,{isRenderable:!0,ignoreBorder:!!(i!=null&&i.ignoreBorder),createQuadrilaterals:!0});F(this,Er);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:i}=this,r=document.createElement("a");r.setAttribute("data-element-id",t.id);let s=!1;return t.url?(i.addLinkAttributes(r,t.url,t.newWindow),s=!0):t.action?(this._bindNamedAction(r,t.action),s=!0):t.attachment?(z(this,Er,g6).call(this,r,t.attachment,t.attachmentDest),s=!0):t.setOCGState?(z(this,Er,y6).call(this,r,t.setOCGState),s=!0):t.dest?(this._bindLink(r,t.dest),s=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(r,t),s=!0),t.resetForm?(this._bindResetFormAction(r,t.resetForm),s=!0):this.isTooltipOnly&&!s&&(this._bindLink(r,""),s=!0)),this.container.classList.add("linkAnnotation"),s&&this.container.append(r),this.container}_bindLink(t,i){t.href=this.linkService.getDestinationHash(i),t.onclick=()=>(i&&this.linkService.goToDestination(i),!1),(i||i==="")&&z(this,Er,uc).call(this)}_bindNamedAction(t,i){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(i),!1),z(this,Er,uc).call(this)}_bindJSAction(t,i){t.href=this.linkService.getAnchorUrl("");const r=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const s of Object.keys(i.actions)){const a=r.get(s);a&&(t[a]=()=>{var o;return(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:i.id,name:s}}),!1})}t.onclick||(t.onclick=()=>!1),z(this,Er,uc).call(this)}_bindResetFormAction(t,i){const r=t.onclick;if(r||(t.href=this.linkService.getAnchorUrl("")),z(this,Er,uc).call(this),!this._fieldObjects){Xe('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),r||(t.onclick=()=>!1);return}t.onclick=()=>{var h;r==null||r();const{fields:s,refs:a,include:o}=i,l=[];if(s.length!==0||a.length!==0){const f=new Set(a);for(const m of s){const y=this._fieldObjects[m]||[];for(const{id:_}of y)f.add(_)}for(const m of Object.values(this._fieldObjects))for(const y of m)f.has(y.id)===o&&l.push(y)}else for(const f of Object.values(this._fieldObjects))l.push(...f);const u=this.annotationStorage,c=[];for(const f of l){const{id:m}=f;switch(c.push(m),f.type){case"text":{const _=f.defaultValue||"";u.setValue(m,{value:_});break}case"checkbox":case"radiobutton":{const _=f.defaultValue===f.exportValues;u.setValue(m,{value:_});break}case"combobox":case"listbox":{const _=f.defaultValue||"";u.setValue(m,{value:_});break}default:continue}const y=document.querySelector(`[data-element-id="${m}"]`);if(y){if(!qd.has(y)){Xe(`_bindResetFormAction - element not allowed: ${m}`);continue}}else continue;y.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((h=this.linkService.eventBus)==null||h.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:c,name:"ResetForm"}})),!1}}}Er=new WeakSet,uc=function(){this.container.setAttribute("data-internal-link","")},g6=function(t,i,r=null){t.href=this.linkService.getAnchorUrl(""),i.description&&(t.title=i.description),t.onclick=()=>{var s;return(s=this.downloadManager)==null||s.openOrDownloadData(i.content,i.filename,r),!1},z(this,Er,uc).call(this)},y6=function(t,i){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(i),!1),z(this,Er,uc).call(this)};class wte extends cn{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class sh extends cn{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Di.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,i,r,s){i.includes("mouse")?e.addEventListener(i,a=>{var o;(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:s(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):e.addEventListener(i,a=>{var o;if(i==="blur"){if(!t.focused||!a.relatedTarget)return;t.focused=!1}else if(i==="focus"){if(t.focused)return;t.focused=!0}s&&((o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:s(a)}}))})}_setEventListeners(e,t,i,r){var s,a,o;for(const[l,u]of i)(u==="Action"||(s=this.data.actions)!=null&&s[u])&&((u==="Focus"||u==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,l,u,r),u==="Focus"&&!((a=this.data.actions)!=null&&a.Blur)?this._setEventListener(e,t,"blur","Blur",null):u==="Blur"&&!((o=this.data.actions)!=null&&o.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":Ne.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:i}=this.data.defaultAppearanceData,r=this.data.defaultAppearanceData.fontSize||_te,s=e.style;let a;const o=2,l=u=>Math.round(10*u)/10;if(this.data.multiLine){const u=Math.abs(this.data.rect[3]-this.data.rect[1]-o),c=Math.round(u/(aA*r))||1,h=u/c;a=Math.min(r,l(h/aA))}else{const u=Math.abs(this.data.rect[3]-this.data.rect[1]-o);a=Math.min(r,l(u/aA))}s.fontSize=`calc(${a}px * var(--scale-factor))`,s.color=Ne.makeHexColor(i[0],i[1],i[2]),this.data.textAlignment!==null&&(s.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class bte extends sh{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,i,r){const s=this.annotationStorage;for(const a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[t]=i),s.setValue(a.id,{[r]:i})}render(){var r,s;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){const a=e.getValue(t,{value:this.data.fieldValue});let o=a.value||"";const l=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;l&&o.length>l&&(o=o.slice(0,l));let u=a.formattedValue||((r=this.data.textContent)==null?void 0:r.join(`
`))||null;u&&this.data.comb&&(u=u.replaceAll(/\s+/g,""));const c={userValue:o,formattedValue:u,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=u??o,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type="text",i.setAttribute("value",u??o),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),qd.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=fv,this._setRequired(i,this.data.required),l&&(i.maxLength=l),i.addEventListener("input",f=>{e.setValue(t,{value:f.target.value}),this.setPropertyOnSiblings(i,"value",f.target.value,"value"),c.formattedValue=null}),i.addEventListener("resetform",f=>{const m=this.data.defaultFieldValue??"";i.value=c.userValue=m,c.formattedValue=null});let h=f=>{const{formattedValue:m}=c;m!=null&&(f.target.value=m),f.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",m=>{var _;if(c.focused)return;const{target:y}=m;c.userValue&&(y.value=c.userValue),c.lastCommittedValue=y.value,c.commitKey=1,(_=this.data.actions)!=null&&_.Focus||(c.focused=!0)}),i.addEventListener("updatefromsandbox",m=>{this.showElementAndHideCanvas(m.target);const y={value(_){c.userValue=_.detail.value??"",e.setValue(t,{value:c.userValue.toString()}),_.target.value=c.userValue},formattedValue(_){const{formattedValue:x}=_.detail;c.formattedValue=x,x!=null&&_.target!==document.activeElement&&(_.target.value=x),e.setValue(t,{formattedValue:x})},selRange(_){_.target.setSelectionRange(..._.detail.selRange)},charLimit:_=>{var E;const{charLimit:x}=_.detail,{target:v}=_;if(x===0){v.removeAttribute("maxLength");return}v.setAttribute("maxLength",x);let w=c.userValue;!w||w.length<=x||(w=w.slice(0,x),v.value=c.userValue=w,e.setValue(t,{value:w}),(E=this.linkService.eventBus)==null||E.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:w,willCommit:!0,commitKey:1,selStart:v.selectionStart,selEnd:v.selectionEnd}}))}};this._dispatchEventFromSandbox(y,m)}),i.addEventListener("keydown",m=>{var x;c.commitKey=1;let y=-1;if(m.key==="Escape"?y=0:m.key==="Enter"&&!this.data.multiLine?y=2:m.key==="Tab"&&(c.commitKey=3),y===-1)return;const{value:_}=m.target;c.lastCommittedValue!==_&&(c.lastCommittedValue=_,c.userValue=_,(x=this.linkService.eventBus)==null||x.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:_,willCommit:!0,commitKey:y,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}}))});const f=h;h=null,i.addEventListener("blur",m=>{var _,x;if(!c.focused||!m.relatedTarget)return;(_=this.data.actions)!=null&&_.Blur||(c.focused=!1);const{value:y}=m.target;c.userValue=y,c.lastCommittedValue!==y&&((x=this.linkService.eventBus)==null||x.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:y,willCommit:!0,commitKey:c.commitKey,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}})),f(m)}),(s=this.data.actions)!=null&&s.Keystroke&&i.addEventListener("beforeinput",m=>{var D;c.lastCommittedValue=null;const{data:y,target:_}=m,{value:x,selectionStart:v,selectionEnd:w}=_;let E=v,C=w;switch(m.inputType){case"deleteWordBackward":{const V=x.substring(0,v).match(/\w*[^\w]*$/);V&&(E-=V[0].length);break}case"deleteWordForward":{const V=x.substring(v).match(/^[^\w]*\w*/);V&&(C+=V[0].length);break}case"deleteContentBackward":v===w&&(E-=1);break;case"deleteContentForward":v===w&&(C+=1);break}m.preventDefault(),(D=this.linkService.eventBus)==null||D.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:x,change:y||"",willCommit:!1,selStart:E,selEnd:C}})}),this._setEventListeners(i,c,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],m=>m.target.value)}if(h&&i.addEventListener("blur",h),this.data.comb){const m=(this.data.rect[2]-this.data.rect[0])/l;i.classList.add("comb"),i.style.letterSpacing=`calc(${m}px * var(--scale-factor) - 1ch)`}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class xte extends sh{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class Ete extends sh{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,i=t.id;let r=e.getValue(i,{value:t.exportValue===t.fieldValue}).value;typeof r=="string"&&(r=r!=="Off",e.setValue(i,{value:r})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const s=document.createElement("input");return qd.add(s),s.setAttribute("data-element-id",i),s.disabled=t.readOnly,this._setRequired(s,this.data.required),s.type="checkbox",s.name=t.fieldName,r&&s.setAttribute("checked",!0),s.setAttribute("exportValue",t.exportValue),s.tabIndex=fv,s.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const u of this._getElementsByName(o,i)){const c=l&&u.exportValue===t.exportValue;u.domElement&&(u.domElement.checked=c),e.setValue(u.id,{value:c})}e.setValue(i,{value:l})}),s.addEventListener("resetform",a=>{const o=t.defaultFieldValue||"Off";a.target.checked=o===t.exportValue}),this.enableScripting&&this.hasJSActions&&(s.addEventListener("updatefromsandbox",a=>{const o={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(i,{value:l.target.checked})}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class _6 extends sh{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,i=t.id;let r=e.getValue(i,{value:t.fieldValue===t.buttonValue}).value;if(typeof r=="string"&&(r=r!==t.buttonValue,e.setValue(i,{value:r})),r)for(const a of this._getElementsByName(t.fieldName,i))e.setValue(a.id,{value:!1});const s=document.createElement("input");if(qd.add(s),s.setAttribute("data-element-id",i),s.disabled=t.readOnly,this._setRequired(s,this.data.required),s.type="radio",s.name=t.fieldName,r&&s.setAttribute("checked",!0),s.tabIndex=fv,s.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const u of this._getElementsByName(o,i))e.setValue(u.id,{value:!1});e.setValue(i,{value:l})}),s.addEventListener("resetform",a=>{const o=t.defaultFieldValue;a.target.checked=o!=null&&o===t.buttonValue}),this.enableScripting&&this.hasJSActions){const a=t.buttonValue;s.addEventListener("updatefromsandbox",o=>{const l={value:u=>{const c=a===u.detail.value;for(const h of this._getElementsByName(u.target.name)){const f=c&&h.id===i;h.domElement&&(h.domElement.checked=f),e.setValue(h.id,{value:f})}}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Ate extends m6{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({},i)})),e}}class Tte extends sh{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,i=e.getValue(t,{value:this.data.fieldValue}),r=document.createElement("select");qd.add(r),r.setAttribute("data-element-id",t),r.disabled=this.data.readOnly,this._setRequired(r,this.data.required),r.name=this.data.fieldName,r.tabIndex=fv;let s=this.data.combo&&this.data.options.length>0;this.data.combo||(r.size=this.data.options.length,this.data.multiSelect&&(r.multiple=!0)),r.addEventListener("resetform",c=>{const h=this.data.defaultFieldValue;for(const f of r.options)f.selected=f.value===h});for(const c of this.data.options){const h=document.createElement("option");h.textContent=c.displayValue,h.value=c.exportValue,i.value.includes(c.exportValue)&&(h.setAttribute("selected",!0),s=!1),r.append(h)}let a=null;if(s){const c=document.createElement("option");c.value=" ",c.setAttribute("hidden",!0),c.setAttribute("selected",!0),r.prepend(c),a=()=>{c.remove(),r.removeEventListener("input",a),a=null},r.addEventListener("input",a)}const o=c=>{const h=c?"value":"textContent",{options:f,multiple:m}=r;return m?Array.prototype.filter.call(f,y=>y.selected).map(y=>y[h]):f.selectedIndex===-1?null:f[f.selectedIndex][h]};let l=o(!1);const u=c=>{const h=c.target.options;return Array.prototype.map.call(h,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(r.addEventListener("updatefromsandbox",c=>{const h={value(f){a==null||a();const m=f.detail.value,y=new Set(Array.isArray(m)?m:[m]);for(const _ of r.options)_.selected=y.has(_.value);e.setValue(t,{value:o(!0)}),l=o(!1)},multipleSelection(f){r.multiple=!0},remove(f){const m=r.options,y=f.detail.remove;m[y].selected=!1,r.remove(y),m.length>0&&Array.prototype.findIndex.call(m,x=>x.selected)===-1&&(m[0].selected=!0),e.setValue(t,{value:o(!0),items:u(f)}),l=o(!1)},clear(f){for(;r.length!==0;)r.remove(0);e.setValue(t,{value:null,items:[]}),l=o(!1)},insert(f){const{index:m,displayValue:y,exportValue:_}=f.detail.insert,x=r.children[m],v=document.createElement("option");v.textContent=y,v.value=_,x?x.before(v):r.append(v),e.setValue(t,{value:o(!0),items:u(f)}),l=o(!1)},items(f){const{items:m}=f.detail;for(;r.length!==0;)r.remove(0);for(const y of m){const{displayValue:_,exportValue:x}=y,v=document.createElement("option");v.textContent=_,v.value=x,r.append(v)}r.options.length>0&&(r.options[0].selected=!0),e.setValue(t,{value:o(!0),items:u(f)}),l=o(!1)},indices(f){const m=new Set(f.detail.indices);for(const y of f.target.options)y.selected=m.has(y.index);e.setValue(t,{value:o(!0)}),l=o(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(h,c)}),r.addEventListener("input",c=>{var m;const h=o(!0),f=o(!1);e.setValue(t,{value:h}),c.preventDefault(),(m=this.linkService.eventBus)==null||m.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:f,changeEx:h,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(r,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],c=>c.target.value)):r.addEventListener("input",function(c){e.setValue(t,{value:o(!0)})}),this.data.combo&&this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class DS extends cn{constructor(e){const{data:t,elements:i}=e;super(e,{isRenderable:cn._hasPopupData(t)}),this.elements=i,this.popup=null}render(){this.container.classList.add("popupAnnotation");const e=this.popup=new Ste({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(const i of this.elements)i.popup=e,i.container.ariaHasPopup="dialog",t.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(i=>`${NC}${i}`).join(",")),this.container}}var Uf,s1,a1,Hf,td,en,wo,Wf,p_,m_,qf,bo,Es,xo,g_,Eo,y_,nd,id,Ct,T0,MS,v6,w6,b6,x6,S0,I0,OS;class Ste{constructor({container:e,color:t,elements:i,titleObj:r,modificationDate:s,contentsObj:a,richText:o,parent:l,rect:u,parentRect:c,open:h}){F(this,Ct);F(this,Uf,z(this,Ct,b6).bind(this));F(this,s1,z(this,Ct,OS).bind(this));F(this,a1,z(this,Ct,I0).bind(this));F(this,Hf,z(this,Ct,S0).bind(this));F(this,td,null);F(this,en,null);F(this,wo,null);F(this,Wf,null);F(this,p_,null);F(this,m_,null);F(this,qf,null);F(this,bo,!1);F(this,Es,null);F(this,xo,null);F(this,g_,null);F(this,Eo,null);F(this,y_,null);F(this,nd,null);F(this,id,!1);var f;R(this,en,e),R(this,y_,r),R(this,wo,a),R(this,Eo,o),R(this,m_,l),R(this,td,t),R(this,g_,u),R(this,qf,c),R(this,p_,i),R(this,Wf,OC.toDateObject(s)),this.trigger=i.flatMap(m=>m.getElementsToTriggerPopup());for(const m of this.trigger)m.addEventListener("click",d(this,Hf)),m.addEventListener("mouseenter",d(this,a1)),m.addEventListener("mouseleave",d(this,s1)),m.classList.add("popupTriggerArea");for(const m of i)(f=m.container)==null||f.addEventListener("keydown",d(this,Uf));d(this,en).hidden=!0,h&&z(this,Ct,S0).call(this)}render(){if(d(this,Es))return;const e=R(this,Es,document.createElement("div"));if(e.className="popup",d(this,td)){const s=e.style.outlineColor=Ne.makeHexColor(...d(this,td));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${s} 30%, white)`:e.style.backgroundColor=Ne.makeHexColor(...d(this,td).map(o=>Math.floor(.7*(255-o)+o)))}const t=document.createElement("span");t.className="header";const i=document.createElement("h1");if(t.append(i),{dir:i.dir,str:i.textContent}=d(this,y_),e.append(t),d(this,Wf)){const s=document.createElement("span");s.classList.add("popupDate"),s.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),s.setAttribute("data-l10n-args",JSON.stringify({dateObj:d(this,Wf).valueOf()})),t.append(s)}const r=d(this,Ct,T0);if(r)p6.render({xfaHtml:r,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const s=this._formatContents(d(this,wo));e.append(s)}d(this,en).append(e)}_formatContents({str:e,dir:t}){const i=document.createElement("p");i.classList.add("popupContent"),i.dir=t;const r=e.split(/(?:\r\n?|\n)/);for(let s=0,a=r.length;s<a;++s){const o=r[s];i.append(document.createTextNode(o)),s<a-1&&i.append(document.createElement("br"))}return i}updateEdited({rect:e,popupContent:t}){var i;d(this,nd)||R(this,nd,{contentsObj:d(this,wo),richText:d(this,Eo)}),e&&R(this,xo,null),t&&(R(this,Eo,z(this,Ct,w6).call(this,t)),R(this,wo,null)),(i=d(this,Es))==null||i.remove(),R(this,Es,null)}resetEdited(){var e;d(this,nd)&&({contentsObj:Ti(this,wo)._,richText:Ti(this,Eo)._}=d(this,nd),R(this,nd,null),(e=d(this,Es))==null||e.remove(),R(this,Es,null),R(this,xo,null))}forceHide(){R(this,id,this.isVisible),d(this,id)&&(d(this,en).hidden=!0)}maybeShow(){d(this,id)&&(d(this,Es)||z(this,Ct,I0).call(this),R(this,id,!1),d(this,en).hidden=!1)}get isVisible(){return d(this,en).hidden===!1}}Uf=new WeakMap,s1=new WeakMap,a1=new WeakMap,Hf=new WeakMap,td=new WeakMap,en=new WeakMap,wo=new WeakMap,Wf=new WeakMap,p_=new WeakMap,m_=new WeakMap,qf=new WeakMap,bo=new WeakMap,Es=new WeakMap,xo=new WeakMap,g_=new WeakMap,Eo=new WeakMap,y_=new WeakMap,nd=new WeakMap,id=new WeakMap,Ct=new WeakSet,T0=function(){const e=d(this,Eo),t=d(this,wo);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&d(this,Eo).html||null},MS=function(){var e,t,i;return((i=(t=(e=d(this,Ct,T0))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:i.fontSize)||0},v6=function(){var e,t,i;return((i=(t=(e=d(this,Ct,T0))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:i.color)||null},w6=function(e){const t=[],i={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},r={style:{color:d(this,Ct,v6),fontSize:d(this,Ct,MS)?`calc(${d(this,Ct,MS)}px * var(--scale-factor))`:""}};for(const s of e.split(`
`))t.push({name:"span",value:s,attributes:r});return i},b6=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&d(this,bo))&&z(this,Ct,S0).call(this)},x6=function(){if(d(this,xo)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:i,pageX:r,pageY:s}}}=d(this,m_);let a=!!d(this,qf),o=a?d(this,qf):d(this,g_);for(const y of d(this,p_))if(!o||Ne.intersect(y.data.rect,o)!==null){o=y.data.rect,a=!0;break}const l=Ne.normalizeRect([o[0],e[3]-o[1]+e[1],o[2],e[3]-o[3]+e[1]]),c=a?o[2]-o[0]+5:0,h=l[0]+c,f=l[1];R(this,xo,[100*(h-r)/t,100*(f-s)/i]);const{style:m}=d(this,en);m.left=`${d(this,xo)[0]}%`,m.top=`${d(this,xo)[1]}%`},S0=function(){R(this,bo,!d(this,bo)),d(this,bo)?(z(this,Ct,I0).call(this),d(this,en).addEventListener("click",d(this,Hf)),d(this,en).addEventListener("keydown",d(this,Uf))):(z(this,Ct,OS).call(this),d(this,en).removeEventListener("click",d(this,Hf)),d(this,en).removeEventListener("keydown",d(this,Uf)))},I0=function(){d(this,Es)||this.render(),this.isVisible?d(this,bo)&&d(this,en).classList.add("focused"):(z(this,Ct,x6).call(this),d(this,en).hidden=!1,d(this,en).style.zIndex=parseInt(d(this,en).style.zIndex)+1e3)},OS=function(){d(this,en).classList.remove("focused"),!(d(this,bo)||!this.isVisible)&&(d(this,en).hidden=!0,d(this,en).style.zIndex=parseInt(d(this,en).style.zIndex)-1e3)};class E6 extends cn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=Ye.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const i=document.createElement("span");i.textContent=t,e.append(i)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var __;class Ite extends cn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});F(this,__,null)}render(){this.container.classList.add("lineAnnotation");const t=this.data,{width:i,height:r}=pu(t.rect),s=this.svgFactory.create(i,r,!0),a=R(this,__,this.svgFactory.createElement("svg:line"));return a.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),a.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),a.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),a.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),a.setAttribute("stroke-width",t.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,__)}addHighlightArea(){this.container.classList.add("highlightArea")}}__=new WeakMap;var v_;class Cte extends cn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});F(this,v_,null)}render(){this.container.classList.add("squareAnnotation");const t=this.data,{width:i,height:r}=pu(t.rect),s=this.svgFactory.create(i,r,!0),a=t.borderStyle.width,o=R(this,v_,this.svgFactory.createElement("svg:rect"));return o.setAttribute("x",a/2),o.setAttribute("y",a/2),o.setAttribute("width",i-a),o.setAttribute("height",r-a),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),s.append(o),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,v_)}addHighlightArea(){this.container.classList.add("highlightArea")}}v_=new WeakMap;var w_;class kte extends cn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});F(this,w_,null)}render(){this.container.classList.add("circleAnnotation");const t=this.data,{width:i,height:r}=pu(t.rect),s=this.svgFactory.create(i,r,!0),a=t.borderStyle.width,o=R(this,w_,this.svgFactory.createElement("svg:ellipse"));return o.setAttribute("cx",i/2),o.setAttribute("cy",r/2),o.setAttribute("rx",i/2-a/2),o.setAttribute("ry",r/2-a/2),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),s.append(o),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,w_)}addHighlightArea(){this.container.classList.add("highlightArea")}}w_=new WeakMap;var b_;class A6 extends cn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});F(this,b_,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:i,borderStyle:r,popupRef:s}}=this;if(!i)return this.container;const{width:a,height:o}=pu(t),l=this.svgFactory.create(a,o,!0);let u=[];for(let h=0,f=i.length;h<f;h+=2){const m=i[h]-t[0],y=t[3]-i[h+1];u.push(`${m},${y}`)}u=u.join(" ");const c=R(this,b_,this.svgFactory.createElement(this.svgElementName));return c.setAttribute("points",u),c.setAttribute("stroke-width",r.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),l.append(c),this.container.append(l),!s&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,b_)}addHighlightArea(){this.container.classList.add("highlightArea")}}b_=new WeakMap;class $te extends A6{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Rte extends cn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var x_,rd,E_,LS;class jC extends cn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});F(this,E_);F(this,x_,null);F(this,rd,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Ye.HIGHLIGHT:Ye.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:i,inkLists:r,borderStyle:s,popupRef:a}}=this,{transform:o,width:l,height:u}=z(this,E_,LS).call(this,i,t),c=this.svgFactory.create(l,u,!0),h=R(this,x_,this.svgFactory.createElement("svg:g"));c.append(h),h.setAttribute("stroke-width",s.width||1),h.setAttribute("stroke-linecap","round"),h.setAttribute("stroke-linejoin","round"),h.setAttribute("stroke-miterlimit",10),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),h.setAttribute("transform",o);for(let f=0,m=r.length;f<m;f++){const y=this.svgFactory.createElement(this.svgElementName);d(this,rd).push(y),y.setAttribute("points",r[f].join(",")),h.append(y)}return!a&&this.hasPopupData&&this._createPopup(),this.container.append(c),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:i,points:r,rect:s}=t,a=d(this,x_);if(i>=0&&a.setAttribute("stroke-width",i||1),r)for(let o=0,l=d(this,rd).length;o<l;o++)d(this,rd)[o].setAttribute("points",r[o].join(","));if(s){const{transform:o,width:l,height:u}=z(this,E_,LS).call(this,this.data.rotation,s);a.parentElement.setAttribute("viewBox",`0 0 ${l} ${u}`),a.setAttribute("transform",o)}}getElementsToTriggerPopup(){return d(this,rd)}addHighlightArea(){this.container.classList.add("highlightArea")}}x_=new WeakMap,rd=new WeakMap,E_=new WeakSet,LS=function(t,i){switch(t){case 90:return{transform:`rotate(90) translate(${-i[0]},${i[1]}) scale(1,-1)`,width:i[3]-i[1],height:i[2]-i[0]};case 180:return{transform:`rotate(180) translate(${-i[2]},${i[1]}) scale(1,-1)`,width:i[2]-i[0],height:i[3]-i[1]};case 270:return{transform:`rotate(270) translate(${-i[2]},${i[3]}) scale(1,-1)`,width:i[3]-i[1],height:i[2]-i[0]};default:return{transform:`translate(${-i[0]},${i[3]}) scale(1,-1)`,width:i[2]-i[0],height:i[3]-i[1]}}};class T6 extends cn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Ye.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class Pte extends cn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class Nte extends cn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class Dte extends cn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class S6 extends cn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Ye.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var A_,T_,FS;class Mte extends cn{constructor(t){var r;super(t,{isRenderable:!0});F(this,T_);F(this,A_,null);const{file:i}=this.data;this.filename=i.filename,this.content=i.content,(r=this.linkService.eventBus)==null||r.dispatch("fileattachmentannotation",{source:this,...i})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:i}=this;let r;i.hasAppearance||i.fillAlpha===0?r=document.createElement("div"):(r=document.createElement("img"),r.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(i.name)?"paperclip":"pushpin"}.svg`,i.fillAlpha&&i.fillAlpha<1&&(r.style=`filter: opacity(${Math.round(i.fillAlpha*100)}%);`)),r.addEventListener("dblclick",z(this,T_,FS).bind(this)),R(this,A_,r);const{isMac:s}=Di.platform;return t.addEventListener("keydown",a=>{a.key==="Enter"&&(s?a.metaKey:a.ctrlKey)&&z(this,T_,FS).call(this)}),!i.popupRef&&this.hasPopupData?this._createPopup():r.classList.add("popupTriggerArea"),t.append(r),t}getElementsToTriggerPopup(){return d(this,A_)}addHighlightArea(){this.container.classList.add("highlightArea")}}A_=new WeakMap,T_=new WeakSet,FS=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var S_,sd,ad,I_,Kd,I6,zS;class Ote{constructor({div:e,accessibilityManager:t,annotationCanvasMap:i,annotationEditorUIManager:r,page:s,viewport:a,structTreeLayer:o}){F(this,Kd);F(this,S_,null);F(this,sd,null);F(this,ad,new Map);F(this,I_,null);this.div=e,R(this,S_,t),R(this,sd,i),R(this,I_,o||null),this.page=s,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=r}hasEditableAnnotations(){return d(this,ad).size>0}async render(e){var a;const{annotations:t}=e,i=this.div;Hd(i,this.viewport);const r=new Map,s={data:null,layer:i,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new VC,annotationStorage:e.annotationStorage||new FC,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const o of t){if(o.noHTML)continue;const l=o.annotationType===xn.POPUP;if(l){const h=r.get(o.id);if(!h)continue;s.elements=h}else{const{width:h,height:f}=pu(o.rect);if(h<=0||f<=0)continue}s.data=o;const u=vte.create(s);if(!u.isRenderable)continue;if(!l&&o.popupRef){const h=r.get(o.popupRef);h?h.push(u):r.set(o.popupRef,[u])}const c=u.render();o.hidden&&(c.style.visibility="hidden"),await z(this,Kd,I6).call(this,c,o.id),u._isEditable&&(d(this,ad).set(u.data.id,u),(a=this._annotationEditorUIManager)==null||a.renderAnnotationElement(u))}z(this,Kd,zS).call(this)}update({viewport:e}){const t=this.div;this.viewport=e,Hd(t,{rotation:e.rotation}),z(this,Kd,zS).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(d(this,ad).values())}getEditableAnnotation(e){return d(this,ad).get(e)}}S_=new WeakMap,sd=new WeakMap,ad=new WeakMap,I_=new WeakMap,Kd=new WeakSet,I6=async function(e,t){var a,o;const i=e.firstChild||e,r=i.id=`${NC}${t}`,s=await((a=d(this,I_))==null?void 0:a.getAriaAttributes(r));if(s)for(const[l,u]of s)i.setAttribute(l,u);this.div.append(e),(o=d(this,S_))==null||o.moveElementInDOM(this.div,e,i,!1)},zS=function(){if(!d(this,sd))return;const e=this.div;for(const[t,i]of d(this,sd)){const r=e.querySelector(`[data-annotation-id="${t}"]`);if(!r)continue;i.className="annotationContent";const{firstChild:s}=r;s?s.nodeName==="CANVAS"?s.replaceWith(i):s.classList.contains("annotationContent")?s.after(i):s.before(i):r.append(i)}d(this,sd).clear()};const Lw=/\r\n?|\n/g;var As,hr,C_,od,fr,vn,C6,k6,$6,C0,jo,k0,$0,R6,jS,P6;const Pt=class Pt extends Yt{constructor(t){super({...t,name:"freeTextEditor"});F(this,vn);F(this,As);F(this,hr,"");F(this,C_,`${this.id}-editor`);F(this,od,null);F(this,fr);R(this,As,t.color||Pt._defaultColor||Yt._defaultLineColor),R(this,fr,t.fontSize||Pt._defaultFontSize)}static get _keyboardManager(){const t=Pt.prototype,i=a=>a.isEmpty(),r=Wd.TRANSLATE_SMALL,s=Wd.TRANSLATE_BIG;return Ze(this,"_keyboardManager",new hv([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:i}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:i}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[r,0],checker:i}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[s,0],checker:i}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:i}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:i}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,r],checker:i}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,s],checker:i}]]))}static initialize(t,i){Yt.initialize(t,i);const r=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(r.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,i){switch(t){case st.FREETEXT_SIZE:Pt._defaultFontSize=i;break;case st.FREETEXT_COLOR:Pt._defaultColor=i;break}}updateParams(t,i){switch(t){case st.FREETEXT_SIZE:z(this,vn,C6).call(this,i);break;case st.FREETEXT_COLOR:z(this,vn,k6).call(this,i);break}}static get defaultPropertiesToUpdate(){return[[st.FREETEXT_SIZE,Pt._defaultFontSize],[st.FREETEXT_COLOR,Pt._defaultColor||Yt._defaultLineColor]]}get propertiesToUpdate(){return[[st.FREETEXT_SIZE,d(this,fr)],[st.FREETEXT_COLOR,d(this,As)]]}_translateEmpty(t,i){this._uiManager.translateSelectedEditors(t,i,!0)}getInitialTranslation(){const t=this.parentScale;return[-Pt._internalPadding*t,-(Pt._internalPadding+d(this,fr))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(Ye.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),R(this,od,new AbortController);const t=this._uiManager.combinedSignal(d(this,od));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){var t;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",d(this,C_)),this._isDraggable=!0,(t=d(this,od))==null||t.abort(),R(this,od,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var i;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(i=this._initialOptions)!=null&&i.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=d(this,hr),i=R(this,hr,z(this,vn,$6).call(this).trimEnd());if(t===i)return;const r=s=>{if(R(this,hr,s),!s){this.remove();return}z(this,vn,$0).call(this),this._uiManager.rebuild(this),z(this,vn,C0).call(this)};this.addCommands({cmd:()=>{r(i)},undo:()=>{r(t)},mustExec:!1}),z(this,vn,C0).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){Pt._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,i;this.width&&(t=this.x,i=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",d(this,C_)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:r}=this.editorDiv;if(r.fontSize=`calc(${d(this,fr)}px * var(--scale-factor))`,r.color=d(this,As),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),zb(this,this.div,["dblclick","keydown"]),this.width){const[s,a]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[l,u]=this.getInitialTranslation();[l,u]=this.pageTranslationToScreen(l,u);const[c,h]=this.pageDimensions,[f,m]=this.pageTranslation;let y,_;switch(this.rotation){case 0:y=t+(o[0]-f)/c,_=i+this.height-(o[1]-m)/h;break;case 90:y=t+(o[0]-f)/c,_=i-(o[1]-m)/h,[l,u]=[u,-l];break;case 180:y=t-this.width+(o[0]-f)/c,_=i-(o[1]-m)/h,[l,u]=[-l,-u];break;case 270:y=t+(o[0]-f-this.height*h)/c,_=i+(o[1]-m-this.width*c)/h,[l,u]=[-u,l];break}this.setAt(y*s,_*a,l,u)}else this.setAt(t*s,i*a,this.width*s,this.height*a);z(this,vn,$0).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var y,_,x;const i=t.clipboardData||window.clipboardData,{types:r}=i;if(r.length===1&&r[0]==="text/plain")return;t.preventDefault();const s=z(y=Pt,jo,jS).call(y,i.getData("text")||"").replaceAll(Lw,`
`);if(!s)return;const a=window.getSelection();if(!a.rangeCount)return;this.editorDiv.normalize(),a.deleteFromDocument();const o=a.getRangeAt(0);if(!s.includes(`
`)){o.insertNode(document.createTextNode(s)),this.editorDiv.normalize(),a.collapseToStart();return}const{startContainer:l,startOffset:u}=o,c=[],h=[];if(l.nodeType===Node.TEXT_NODE){const v=l.parentElement;if(h.push(l.nodeValue.slice(u).replaceAll(Lw,"")),v!==this.editorDiv){let w=c;for(const E of this.editorDiv.childNodes){if(E===v){w=h;continue}w.push(z(_=Pt,jo,k0).call(_,E))}}c.push(l.nodeValue.slice(0,u).replaceAll(Lw,""))}else if(l===this.editorDiv){let v=c,w=0;for(const E of this.editorDiv.childNodes)w++===u&&(v=h),v.push(z(x=Pt,jo,k0).call(x,E))}R(this,hr,`${c.join(`
`)}${s}${h.join(`
`)}`),z(this,vn,$0).call(this);const f=new Range;let m=c.reduce((v,w)=>v+w.length,0);for(const{firstChild:v}of this.editorDiv.childNodes)if(v.nodeType===Node.TEXT_NODE){const w=v.nodeValue.length;if(m<=w){f.setStart(v,m),f.setEnd(v,m);break}m-=w}a.removeAllRanges(),a.addRange(f)}get contentDiv(){return this.editorDiv}static async deserialize(t,i,r){var o;let s=null;if(t instanceof E6){const{data:{defaultAppearanceData:{fontSize:l,fontColor:u},rect:c,rotation:h,id:f,popupRef:m},textContent:y,textPosition:_,parent:{page:{pageNumber:x}}}=t;if(!y||y.length===0)return null;s=t={annotationType:Ye.FREETEXT,color:Array.from(u),fontSize:l,value:y.join(`
`),position:_,pageIndex:x-1,rect:c.slice(0),rotation:h,id:f,deleted:!1,popupRef:m}}const a=await super.deserialize(t,i,r);return R(a,fr,t.fontSize),R(a,As,Ne.makeHexColor(...t.color)),R(a,hr,z(o=Pt,jo,jS).call(o,t.value)),a.annotationElementId=t.id||null,a._initialData=s,a}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i=Pt._internalPadding*this.parentScale,r=this.getRect(i,i),s=Yt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:d(this,As)),a={annotationType:Ye.FREETEXT,color:s,fontSize:d(this,fr),value:z(this,vn,R6).call(this),pageIndex:this.pageIndex,rect:r,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?a:this.annotationElementId&&!z(this,vn,P6).call(this,a)?null:(a.id=this.annotationElementId,a)}renderAnnotationElement(t){const i=super.renderAnnotationElement(t);if(this.deleted)return i;const{style:r}=i;r.fontSize=`calc(${d(this,fr)}px * var(--scale-factor))`,r.color=d(this,As),i.replaceChildren();for(const a of d(this,hr).split(`
`)){const o=document.createElement("div");o.append(a?document.createTextNode(a):document.createElement("br")),i.append(o)}const s=Pt._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(s,s),popupContent:d(this,hr)}),i}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};As=new WeakMap,hr=new WeakMap,C_=new WeakMap,od=new WeakMap,fr=new WeakMap,vn=new WeakSet,C6=function(t){const i=s=>{this.editorDiv.style.fontSize=`calc(${s}px * var(--scale-factor))`,this.translate(0,-(s-d(this,fr))*this.parentScale),R(this,fr,s),z(this,vn,C0).call(this)},r=d(this,fr);this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:st.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},k6=function(t){const i=s=>{R(this,As,this.editorDiv.style.color=s)},r=d(this,As);this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:st.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},$6=function(){var r;const t=[];this.editorDiv.normalize();let i=null;for(const s of this.editorDiv.childNodes)(i==null?void 0:i.nodeType)===Node.TEXT_NODE&&s.nodeName==="BR"||(t.push(z(r=Pt,jo,k0).call(r,s)),i=s);return t.join(`
`)},C0=function(){const[t,i]=this.parentDimensions;let r;if(this.isAttachedToDOM)r=this.div.getBoundingClientRect();else{const{currentLayer:s,div:a}=this,o=a.style.display,l=a.classList.contains("hidden");a.classList.remove("hidden"),a.style.display="hidden",s.div.append(this.div),r=a.getBoundingClientRect(),a.remove(),a.style.display=o,a.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=r.width/t,this.height=r.height/i):(this.width=r.height/t,this.height=r.width/i),this.fixAndSetPosition()},jo=new WeakSet,k0=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Lw,"")},$0=function(){if(this.editorDiv.replaceChildren(),!!d(this,hr))for(const t of d(this,hr).split(`
`)){const i=document.createElement("div");i.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(i)}},R6=function(){return d(this,hr).replaceAll(""," ")},jS=function(t){return t.replaceAll(" ","")},P6=function(t){const{value:i,fontSize:r,color:s,pageIndex:a}=this._initialData;return this._hasBeenMoved||t.value!==i||t.fontSize!==r||t.color.some((o,l)=>o!==s[l])||t.pageIndex!==a},F(Pt,jo),Le(Pt,"_freeTextDefaultContent",""),Le(Pt,"_internalPadding",0),Le(Pt,"_defaultColor",null),Le(Pt,"_defaultFontSize",10),Le(Pt,"_type","freetext"),Le(Pt,"_editorType",Ye.FREETEXT);let VS=Pt;class Se{toSVGPath(){Rt("Abstract method `toSVGPath` must be implemented.")}get box(){Rt("Abstract getter `box` must be implemented.")}serialize(e,t){Rt("Abstract method `serialize` must be implemented.")}static _rescale(e,t,i,r,s,a){a||(a=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)a[o]=t+e[o]*r,a[o+1]=i+e[o+1]*s;return a}static _rescaleAndSwap(e,t,i,r,s,a){a||(a=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)a[o]=t+e[o+1]*r,a[o+1]=i+e[o]*s;return a}static _translate(e,t,i,r){r||(r=new Float32Array(e.length));for(let s=0,a=e.length;s<a;s+=2)r[s]=t+e[s],r[s+1]=i+e[s+1];return r}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,i,r,s){switch(s){case 90:return[1-t/i,e/r];case 180:return[1-e/i,1-t/r];case 270:return[t/i,1-e/r];default:return[e/i,t/r]}}static _normalizePagePoint(e,t,i){switch(i){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,i,r,s,a){return[(e+5*i)/6,(t+5*r)/6,(5*i+s)/6,(5*r+a)/6,(i+s)/2,(r+a)/2]}}Le(Se,"PRECISION",1e-4);var pr,Ts,Gf,Kf,ba,Je,ld,ud,k_,$_,Yf,Xf,Bl,R_,o1,l1,Cn,yg,N6,D6,M6,O6,L6,F6;const io=class io{constructor({x:e,y:t},i,r,s,a,o=0){F(this,Cn);F(this,pr);F(this,Ts,[]);F(this,Gf);F(this,Kf);F(this,ba,[]);F(this,Je,new Float32Array(18));F(this,ld);F(this,ud);F(this,k_);F(this,$_);F(this,Yf);F(this,Xf);F(this,Bl,[]);R(this,pr,i),R(this,Xf,s*r),R(this,Kf,a),d(this,Je).set([NaN,NaN,NaN,NaN,e,t],6),R(this,Gf,o),R(this,$_,d(io,R_)*r),R(this,k_,d(io,l1)*r),R(this,Yf,r),d(this,Bl).push(e,t)}isEmpty(){return isNaN(d(this,Je)[8])}add({x:e,y:t}){var N;R(this,ld,e),R(this,ud,t);const[i,r,s,a]=d(this,pr);let[o,l,u,c]=d(this,Je).subarray(8,12);const h=e-u,f=t-c,m=Math.hypot(h,f);if(m<d(this,k_))return!1;const y=m-d(this,$_),_=y/m,x=_*h,v=_*f;let w=o,E=l;o=u,l=c,u+=x,c+=v,(N=d(this,Bl))==null||N.push(e,t);const C=-v/y,D=x/y,V=C*d(this,Xf),I=D*d(this,Xf);return d(this,Je).set(d(this,Je).subarray(2,8),0),d(this,Je).set([u+V,c+I],4),d(this,Je).set(d(this,Je).subarray(14,18),12),d(this,Je).set([u-V,c-I],16),isNaN(d(this,Je)[6])?(d(this,ba).length===0&&(d(this,Je).set([o+V,l+I],2),d(this,ba).push(NaN,NaN,NaN,NaN,(o+V-i)/s,(l+I-r)/a),d(this,Je).set([o-V,l-I],14),d(this,Ts).push(NaN,NaN,NaN,NaN,(o-V-i)/s,(l-I-r)/a)),d(this,Je).set([w,E,o,l,u,c],6),!this.isEmpty()):(d(this,Je).set([w,E,o,l,u,c],6),Math.abs(Math.atan2(E-l,w-o)-Math.atan2(v,x))<Math.PI/2?([o,l,u,c]=d(this,Je).subarray(2,6),d(this,ba).push(NaN,NaN,NaN,NaN,((o+u)/2-i)/s,((l+c)/2-r)/a),[o,l,w,E]=d(this,Je).subarray(14,18),d(this,Ts).push(NaN,NaN,NaN,NaN,((w+o)/2-i)/s,((E+l)/2-r)/a),!0):([w,E,o,l,u,c]=d(this,Je).subarray(0,6),d(this,ba).push(((w+5*o)/6-i)/s,((E+5*l)/6-r)/a,((5*o+u)/6-i)/s,((5*l+c)/6-r)/a,((o+u)/2-i)/s,((l+c)/2-r)/a),[u,c,o,l,w,E]=d(this,Je).subarray(12,18),d(this,Ts).push(((w+5*o)/6-i)/s,((E+5*l)/6-r)/a,((5*o+u)/6-i)/s,((5*l+c)/6-r)/a,((o+u)/2-i)/s,((l+c)/2-r)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const e=d(this,ba),t=d(this,Ts);if(isNaN(d(this,Je)[6])&&!this.isEmpty())return z(this,Cn,N6).call(this);const i=[];i.push(`M${e[4]} ${e[5]}`);for(let r=6;r<e.length;r+=6)isNaN(e[r])?i.push(`L${e[r+4]} ${e[r+5]}`):i.push(`C${e[r]} ${e[r+1]} ${e[r+2]} ${e[r+3]} ${e[r+4]} ${e[r+5]}`);z(this,Cn,M6).call(this,i);for(let r=t.length-6;r>=6;r-=6)isNaN(t[r])?i.push(`L${t[r+4]} ${t[r+5]}`):i.push(`C${t[r]} ${t[r+1]} ${t[r+2]} ${t[r+3]} ${t[r+4]} ${t[r+5]}`);return z(this,Cn,D6).call(this,i),i.join(" ")}newFreeDrawOutline(e,t,i,r,s,a){return new z6(e,t,i,r,s,a)}getOutlines(){var h;const e=d(this,ba),t=d(this,Ts),i=d(this,Je),[r,s,a,o]=d(this,pr),l=new Float32Array((((h=d(this,Bl))==null?void 0:h.length)??0)+2);for(let f=0,m=l.length-2;f<m;f+=2)l[f]=(d(this,Bl)[f]-r)/a,l[f+1]=(d(this,Bl)[f+1]-s)/o;if(l[l.length-2]=(d(this,ld)-r)/a,l[l.length-1]=(d(this,ud)-s)/o,isNaN(i[6])&&!this.isEmpty())return z(this,Cn,O6).call(this,l);const u=new Float32Array(d(this,ba).length+24+d(this,Ts).length);let c=e.length;for(let f=0;f<c;f+=2){if(isNaN(e[f])){u[f]=u[f+1]=NaN;continue}u[f]=e[f],u[f+1]=e[f+1]}c=z(this,Cn,F6).call(this,u,c);for(let f=t.length-6;f>=6;f-=6)for(let m=0;m<6;m+=2){if(isNaN(t[f+m])){u[c]=u[c+1]=NaN,c+=2;continue}u[c]=t[f+m],u[c+1]=t[f+m+1],c+=2}return z(this,Cn,L6).call(this,u,c),this.newFreeDrawOutline(u,l,d(this,pr),d(this,Yf),d(this,Gf),d(this,Kf))}};pr=new WeakMap,Ts=new WeakMap,Gf=new WeakMap,Kf=new WeakMap,ba=new WeakMap,Je=new WeakMap,ld=new WeakMap,ud=new WeakMap,k_=new WeakMap,$_=new WeakMap,Yf=new WeakMap,Xf=new WeakMap,Bl=new WeakMap,R_=new WeakMap,o1=new WeakMap,l1=new WeakMap,Cn=new WeakSet,yg=function(){const e=d(this,Je).subarray(4,6),t=d(this,Je).subarray(16,18),[i,r,s,a]=d(this,pr);return[(d(this,ld)+(e[0]-t[0])/2-i)/s,(d(this,ud)+(e[1]-t[1])/2-r)/a,(d(this,ld)+(t[0]-e[0])/2-i)/s,(d(this,ud)+(t[1]-e[1])/2-r)/a]},N6=function(){const[e,t,i,r]=d(this,pr),[s,a,o,l]=z(this,Cn,yg).call(this);return`M${(d(this,Je)[2]-e)/i} ${(d(this,Je)[3]-t)/r} L${(d(this,Je)[4]-e)/i} ${(d(this,Je)[5]-t)/r} L${s} ${a} L${o} ${l} L${(d(this,Je)[16]-e)/i} ${(d(this,Je)[17]-t)/r} L${(d(this,Je)[14]-e)/i} ${(d(this,Je)[15]-t)/r} Z`},D6=function(e){const t=d(this,Ts);e.push(`L${t[4]} ${t[5]} Z`)},M6=function(e){const[t,i,r,s]=d(this,pr),a=d(this,Je).subarray(4,6),o=d(this,Je).subarray(16,18),[l,u,c,h]=z(this,Cn,yg).call(this);e.push(`L${(a[0]-t)/r} ${(a[1]-i)/s} L${l} ${u} L${c} ${h} L${(o[0]-t)/r} ${(o[1]-i)/s}`)},O6=function(e){const t=d(this,Je),[i,r,s,a]=d(this,pr),[o,l,u,c]=z(this,Cn,yg).call(this),h=new Float32Array(36);return h.set([NaN,NaN,NaN,NaN,(t[2]-i)/s,(t[3]-r)/a,NaN,NaN,NaN,NaN,(t[4]-i)/s,(t[5]-r)/a,NaN,NaN,NaN,NaN,o,l,NaN,NaN,NaN,NaN,u,c,NaN,NaN,NaN,NaN,(t[16]-i)/s,(t[17]-r)/a,NaN,NaN,NaN,NaN,(t[14]-i)/s,(t[15]-r)/a],0),this.newFreeDrawOutline(h,e,d(this,pr),d(this,Yf),d(this,Gf),d(this,Kf))},L6=function(e,t){const i=d(this,Ts);return e.set([NaN,NaN,NaN,NaN,i[4],i[5]],t),t+=6},F6=function(e,t){const i=d(this,Je).subarray(4,6),r=d(this,Je).subarray(16,18),[s,a,o,l]=d(this,pr),[u,c,h,f]=z(this,Cn,yg).call(this);return e.set([NaN,NaN,NaN,NaN,(i[0]-s)/o,(i[1]-a)/l,NaN,NaN,NaN,NaN,u,c,NaN,NaN,NaN,NaN,h,f,NaN,NaN,NaN,NaN,(r[0]-s)/o,(r[1]-a)/l],t),t+=24},F(io,R_,8),F(io,o1,2),F(io,l1,d(io,R_)+d(io,o1));let Bb=io;var Qf,cd,Ao,P_,mr,N_,an,u1,V6;class z6 extends Se{constructor(t,i,r,s,a,o){super();F(this,u1);F(this,Qf);F(this,cd,new Float32Array(4));F(this,Ao);F(this,P_);F(this,mr);F(this,N_);F(this,an);R(this,an,t),R(this,mr,i),R(this,Qf,r),R(this,N_,s),R(this,Ao,a),R(this,P_,o),this.lastPoint=[NaN,NaN],z(this,u1,V6).call(this,o);const[l,u,c,h]=d(this,cd);for(let f=0,m=t.length;f<m;f+=2)t[f]=(t[f]-l)/c,t[f+1]=(t[f+1]-u)/h;for(let f=0,m=i.length;f<m;f+=2)i[f]=(i[f]-l)/c,i[f+1]=(i[f+1]-u)/h}toSVGPath(){const t=[`M${d(this,an)[4]} ${d(this,an)[5]}`];for(let i=6,r=d(this,an).length;i<r;i+=6){if(isNaN(d(this,an)[i])){t.push(`L${d(this,an)[i+4]} ${d(this,an)[i+5]}`);continue}t.push(`C${d(this,an)[i]} ${d(this,an)[i+1]} ${d(this,an)[i+2]} ${d(this,an)[i+3]} ${d(this,an)[i+4]} ${d(this,an)[i+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,i,r,s],a){const o=r-t,l=s-i;let u,c;switch(a){case 0:u=Se._rescale(d(this,an),t,s,o,-l),c=Se._rescale(d(this,mr),t,s,o,-l);break;case 90:u=Se._rescaleAndSwap(d(this,an),t,i,o,l),c=Se._rescaleAndSwap(d(this,mr),t,i,o,l);break;case 180:u=Se._rescale(d(this,an),r,i,-o,l),c=Se._rescale(d(this,mr),r,i,-o,l);break;case 270:u=Se._rescaleAndSwap(d(this,an),r,s,-o,-l),c=Se._rescaleAndSwap(d(this,mr),r,s,-o,-l);break}return{outline:Array.from(u),points:[Array.from(c)]}}get box(){return d(this,cd)}newOutliner(t,i,r,s,a,o=0){return new Bb(t,i,r,s,a,o)}getNewOutline(t,i){const[r,s,a,o]=d(this,cd),[l,u,c,h]=d(this,Qf),f=a*c,m=o*h,y=r*c+l,_=s*h+u,x=this.newOutliner({x:d(this,mr)[0]*f+y,y:d(this,mr)[1]*m+_},d(this,Qf),d(this,N_),t,d(this,P_),i??d(this,Ao));for(let v=2;v<d(this,mr).length;v+=2)x.add({x:d(this,mr)[v]*f+y,y:d(this,mr)[v+1]*m+_});return x.getOutlines()}}Qf=new WeakMap,cd=new WeakMap,Ao=new WeakMap,P_=new WeakMap,mr=new WeakMap,N_=new WeakMap,an=new WeakMap,u1=new WeakSet,V6=function(t){const i=d(this,an);let r=i[4],s=i[5],a=r,o=s,l=r,u=s,c=r,h=s;const f=t?Math.max:Math.min;for(let y=6,_=i.length;y<_;y+=6){if(isNaN(i[y]))a=Math.min(a,i[y+4]),o=Math.min(o,i[y+5]),l=Math.max(l,i[y+4]),u=Math.max(u,i[y+5]),h<i[y+5]?(c=i[y+4],h=i[y+5]):h===i[y+5]&&(c=f(c,i[y+4]));else{const x=Ne.bezierBoundingBox(r,s,...i.slice(y,y+6));a=Math.min(a,x[0]),o=Math.min(o,x[1]),l=Math.max(l,x[2]),u=Math.max(u,x[3]),h<x[3]?(c=x[2],h=x[3]):h===x[3]&&(c=f(c,x[2]))}r=i[y+4],s=i[y+5]}const m=d(this,cd);m[0]=a-d(this,Ao),m[1]=o-d(this,Ao),m[2]=l-a+2*d(this,Ao),m[3]=u-o+2*d(this,Ao),this.lastPoint=[c,h]};var D_,M_,Ul,Ss,Oi,j6,R0,B6,U6,US;class BS{constructor(e,t=0,i=0,r=!0){F(this,Oi);F(this,D_);F(this,M_);F(this,Ul,[]);F(this,Ss,[]);let s=1/0,a=-1/0,o=1/0,l=-1/0;const u=10**-4;for(const{x,y:v,width:w,height:E}of e){const C=Math.floor((x-t)/u)*u,D=Math.ceil((x+w+t)/u)*u,V=Math.floor((v-t)/u)*u,I=Math.ceil((v+E+t)/u)*u,k=[C,V,I,!0],N=[D,V,I,!1];d(this,Ul).push(k,N),s=Math.min(s,C),a=Math.max(a,D),o=Math.min(o,V),l=Math.max(l,I)}const c=a-s+2*i,h=l-o+2*i,f=s-i,m=o-i,y=d(this,Ul).at(r?-1:-2),_=[y[0],y[2]];for(const x of d(this,Ul)){const[v,w,E]=x;x[0]=(v-f)/c,x[1]=(w-m)/h,x[2]=(E-m)/h}R(this,D_,new Float32Array([f,m,c,h])),R(this,M_,_)}getOutlines(){d(this,Ul).sort((t,i)=>t[0]-i[0]||t[1]-i[1]||t[2]-i[2]);const e=[];for(const t of d(this,Ul))t[3]?(e.push(...z(this,Oi,US).call(this,t)),z(this,Oi,B6).call(this,t)):(z(this,Oi,U6).call(this,t),e.push(...z(this,Oi,US).call(this,t)));return z(this,Oi,j6).call(this,e)}}D_=new WeakMap,M_=new WeakMap,Ul=new WeakMap,Ss=new WeakMap,Oi=new WeakSet,j6=function(e){const t=[],i=new Set;for(const a of e){const[o,l,u]=a;t.push([o,l,a],[o,u,a])}t.sort((a,o)=>a[1]-o[1]||a[0]-o[0]);for(let a=0,o=t.length;a<o;a+=2){const l=t[a][2],u=t[a+1][2];l.push(u),u.push(l),i.add(l),i.add(u)}const r=[];let s;for(;i.size>0;){const a=i.values().next().value;let[o,l,u,c,h]=a;i.delete(a);let f=o,m=l;for(s=[o,u],r.push(s);;){let y;if(i.has(c))y=c;else if(i.has(h))y=h;else break;i.delete(y),[o,l,u,c,h]=y,f!==o&&(s.push(f,m,o,m===l?l:u),f=o),m=m===l?u:l}s.push(f,m)}return new Lte(r,d(this,D_),d(this,M_))},R0=function(e){const t=d(this,Ss);let i=0,r=t.length-1;for(;i<=r;){const s=i+r>>1,a=t[s][0];if(a===e)return s;a<e?i=s+1:r=s-1}return r+1},B6=function([,e,t]){const i=z(this,Oi,R0).call(this,e);d(this,Ss).splice(i,0,[e,t])},U6=function([,e,t]){const i=z(this,Oi,R0).call(this,e);for(let r=i;r<d(this,Ss).length;r++){const[s,a]=d(this,Ss)[r];if(s!==e)break;if(s===e&&a===t){d(this,Ss).splice(r,1);return}}for(let r=i-1;r>=0;r--){const[s,a]=d(this,Ss)[r];if(s!==e)break;if(s===e&&a===t){d(this,Ss).splice(r,1);return}}},US=function(e){const[t,i,r]=e,s=[[t,i,r]],a=z(this,Oi,R0).call(this,r);for(let o=0;o<a;o++){const[l,u]=d(this,Ss)[o];for(let c=0,h=s.length;c<h;c++){const[,f,m]=s[c];if(!(u<=f||m<=l)){if(f>=l){if(m>u)s[c][1]=u;else{if(h===1)return[];s.splice(c,1),c--,h--}continue}s[c][2]=l,m>u&&s.push([t,u,m])}}}return s};var O_,Jf;class Lte extends Se{constructor(t,i,r){super();F(this,O_);F(this,Jf);R(this,Jf,t),R(this,O_,i),this.lastPoint=r}toSVGPath(){const t=[];for(const i of d(this,Jf)){let[r,s]=i;t.push(`M${r} ${s}`);for(let a=2;a<i.length;a+=2){const o=i[a],l=i[a+1];o===r?(t.push(`V${l}`),s=l):l===s&&(t.push(`H${o}`),r=o)}t.push("Z")}return t.join(" ")}serialize([t,i,r,s],a){const o=[],l=r-t,u=s-i;for(const c of d(this,Jf)){const h=new Array(c.length);for(let f=0;f<c.length;f+=2)h[f]=t+c[f]*l,h[f+1]=s-c[f+1]*u;o.push(h)}return o}get box(){return d(this,O_)}get classNamesForOutlining(){return["highlightOutline"]}}O_=new WeakMap,Jf=new WeakMap;class HS extends Bb{newFreeDrawOutline(e,t,i,r,s,a){return new Fte(e,t,i,r,s,a)}}class Fte extends z6{newOutliner(e,t,i,r,s,a=0){return new HS(e,t,i,r,s,a)}}var Is,dd,Zf,Tn,L_,ep,F_,z_,Hl,Cs,tp,V_,It,WS,qS,GS,cc,H6,fl;const qi=class qi{constructor({editor:e=null,uiManager:t=null}){F(this,It);F(this,Is,null);F(this,dd,null);F(this,Zf);F(this,Tn,null);F(this,L_,!1);F(this,ep,!1);F(this,F_,null);F(this,z_);F(this,Hl,null);F(this,Cs,null);F(this,tp);var i;e?(R(this,ep,!1),R(this,tp,st.HIGHLIGHT_COLOR),R(this,F_,e)):(R(this,ep,!0),R(this,tp,st.HIGHLIGHT_DEFAULT_COLOR)),R(this,Cs,(e==null?void 0:e._uiManager)||t),R(this,z_,d(this,Cs)._eventBus),R(this,Zf,(e==null?void 0:e.color)||((i=d(this,Cs))==null?void 0:i.highlightColors.values().next().value)||"#FFFF98"),d(qi,V_)||R(qi,V_,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return Ze(this,"_keyboardManager",new hv([[["Escape","mac+Escape"],qi.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],qi.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],qi.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],qi.prototype._moveToPrevious],[["Home","mac+Home"],qi.prototype._moveToBeginning],[["End","mac+End"],qi.prototype._moveToEnd]]))}renderButton(){const e=R(this,Is,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);const t=d(this,Cs)._signal;e.addEventListener("click",z(this,It,cc).bind(this),{signal:t}),e.addEventListener("keydown",z(this,It,GS).bind(this),{signal:t});const i=R(this,dd,document.createElement("span"));return i.className="swatch",i.setAttribute("aria-hidden",!0),i.style.backgroundColor=d(this,Zf),e.append(i),e}renderMainDropdown(){const e=R(this,Tn,z(this,It,WS).call(this));return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}_colorSelectFromKeyboard(e){if(e.target===d(this,Is)){z(this,It,cc).call(this,e);return}const t=e.target.getAttribute("data-color");t&&z(this,It,qS).call(this,t,e)}_moveToNext(e){var t,i;if(!d(this,It,fl)){z(this,It,cc).call(this,e);return}if(e.target===d(this,Is)){(t=d(this,Tn).firstChild)==null||t.focus();return}(i=e.target.nextSibling)==null||i.focus()}_moveToPrevious(e){var t,i;if(e.target===((t=d(this,Tn))==null?void 0:t.firstChild)||e.target===d(this,Is)){d(this,It,fl)&&this._hideDropdownFromKeyboard();return}d(this,It,fl)||z(this,It,cc).call(this,e),(i=e.target.previousSibling)==null||i.focus()}_moveToBeginning(e){var t;if(!d(this,It,fl)){z(this,It,cc).call(this,e);return}(t=d(this,Tn).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!d(this,It,fl)){z(this,It,cc).call(this,e);return}(t=d(this,Tn).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=d(this,Tn))==null||e.classList.add("hidden"),(t=d(this,Hl))==null||t.abort(),R(this,Hl,null)}_hideDropdownFromKeyboard(){var e;if(!d(this,ep)){if(!d(this,It,fl)){(e=d(this,F_))==null||e.unselect();return}this.hideDropdown(),d(this,Is).focus({preventScroll:!0,focusVisible:d(this,L_)})}}updateColor(e){if(d(this,dd)&&(d(this,dd).style.backgroundColor=e),!d(this,Tn))return;const t=d(this,Cs).highlightColors.values();for(const i of d(this,Tn).children)i.setAttribute("aria-selected",t.next().value===e)}destroy(){var e,t;(e=d(this,Is))==null||e.remove(),R(this,Is,null),R(this,dd,null),(t=d(this,Tn))==null||t.remove(),R(this,Tn,null)}};Is=new WeakMap,dd=new WeakMap,Zf=new WeakMap,Tn=new WeakMap,L_=new WeakMap,ep=new WeakMap,F_=new WeakMap,z_=new WeakMap,Hl=new WeakMap,Cs=new WeakMap,tp=new WeakMap,V_=new WeakMap,It=new WeakSet,WS=function(){const e=document.createElement("div"),t=d(this,Cs)._signal;e.addEventListener("contextmenu",qs,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[i,r]of d(this,Cs).highlightColors){const s=document.createElement("button");s.tabIndex="0",s.role="option",s.setAttribute("data-color",r),s.title=i,s.setAttribute("data-l10n-id",d(qi,V_)[i]);const a=document.createElement("span");s.append(a),a.className="swatch",a.style.backgroundColor=r,s.setAttribute("aria-selected",r===d(this,Zf)),s.addEventListener("click",z(this,It,qS).bind(this,r),{signal:t}),e.append(s)}return e.addEventListener("keydown",z(this,It,GS).bind(this),{signal:t}),e},qS=function(e,t){t.stopPropagation(),d(this,z_).dispatch("switchannotationeditorparams",{source:this,type:d(this,tp),value:e})},GS=function(e){qi._keyboardManager.exec(this,e)},cc=function(e){if(d(this,It,fl)){this.hideDropdown();return}if(R(this,L_,e.detail===0),d(this,Hl)||(R(this,Hl,new AbortController),window.addEventListener("pointerdown",z(this,It,H6).bind(this),{signal:d(this,Cs).combinedSignal(d(this,Hl))})),d(this,Tn)){d(this,Tn).classList.remove("hidden");return}const t=R(this,Tn,z(this,It,WS).call(this));d(this,Is).append(t)},H6=function(e){var t;(t=d(this,Tn))!=null&&t.contains(e.target)||this.hideDropdown()},fl=function(){return d(this,Tn)&&!d(this,Tn).classList.contains("hidden")},F(qi,V_,null);let Ub=qi;var np,j_,To,hd,ip,Yi,B_,U_,fd,jr,gr,Gn,rp,So,fi,sp,Br,H_,Ke,KS,P0,W6,q6,G6,YS,dc,Yr,Ph,K6,N0,_g,Y6,X6,Q6,J6,Z6;const yt=class yt extends Yt{constructor(t){super({...t,name:"highlightEditor"});F(this,Ke);F(this,np,null);F(this,j_,0);F(this,To);F(this,hd,null);F(this,ip,null);F(this,Yi,null);F(this,B_,null);F(this,U_,0);F(this,fd,null);F(this,jr,null);F(this,gr,null);F(this,Gn,!1);F(this,rp,null);F(this,So);F(this,fi,null);F(this,sp,"");F(this,Br);F(this,H_,"");this.color=t.color||yt._defaultColor,R(this,Br,t.thickness||yt._defaultThickness),R(this,So,t.opacity||yt._defaultOpacity),R(this,To,t.boxes||null),R(this,H_,t.methodOfCreation||""),R(this,sp,t.text||""),this._isDraggable=!1,t.highlightId>-1?(R(this,Gn,!0),z(this,Ke,P0).call(this,t),z(this,Ke,dc).call(this)):d(this,To)&&(R(this,np,t.anchorNode),R(this,j_,t.anchorOffset),R(this,B_,t.focusNode),R(this,U_,t.focusOffset),z(this,Ke,KS).call(this),z(this,Ke,dc).call(this),this.rotate(this.rotation))}static get _keyboardManager(){const t=yt.prototype;return Ze(this,"_keyboardManager",new hv([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:d(this,Gn)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:d(this,Br),methodOfCreation:d(this,H_)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,i){var r;Yt.initialize(t,i),yt._defaultColor||(yt._defaultColor=((r=i.highlightColors)==null?void 0:r.values().next().value)||"#fff066")}static updateDefaultParams(t,i){switch(t){case st.HIGHLIGHT_DEFAULT_COLOR:yt._defaultColor=i;break;case st.HIGHLIGHT_THICKNESS:yt._defaultThickness=i;break}}translateInPage(t,i){}get toolbarPosition(){return d(this,rp)}updateParams(t,i){switch(t){case st.HIGHLIGHT_COLOR:z(this,Ke,W6).call(this,i);break;case st.HIGHLIGHT_THICKNESS:z(this,Ke,q6).call(this,i);break}}static get defaultPropertiesToUpdate(){return[[st.HIGHLIGHT_DEFAULT_COLOR,yt._defaultColor],[st.HIGHLIGHT_THICKNESS,yt._defaultThickness]]}get propertiesToUpdate(){return[[st.HIGHLIGHT_COLOR,this.color||yt._defaultColor],[st.HIGHLIGHT_THICKNESS,d(this,Br)||yt._defaultThickness],[st.HIGHLIGHT_FREE,d(this,Gn)]]}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(R(this,ip,new Ub({editor:this})),t.addColorPicker(d(this,ip))),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(z(this,Ke,_g).call(this))}getBaseTranslation(){return[0,0]}getRect(t,i){return super.getRect(t,i,z(this,Ke,_g).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){z(this,Ke,YS).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(z(this,Ke,dc).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var r;let i=!1;this.parent&&!t?z(this,Ke,YS).call(this):t&&(z(this,Ke,dc).call(this,t),i=!this.parent&&((r=this.div)==null?void 0:r.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),i&&this.select()}rotate(t){var s,a,o;const{drawLayer:i}=this.parent;let r;d(this,Gn)?(t=(t-this.rotation+360)%360,r=z(s=yt,Yr,Ph).call(s,d(this,jr).box,t)):r=z(a=yt,Yr,Ph).call(a,[this.x,this.y,this.width,this.height],t),i.updateProperties(d(this,gr),{bbox:r,root:{"data-main-rotation":t}}),i.updateProperties(d(this,fi),{bbox:z(o=yt,Yr,Ph).call(o,d(this,Yi).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();d(this,sp)&&(t.setAttribute("aria-label",d(this,sp)),t.setAttribute("role","mark")),d(this,Gn)?t.classList.add("free"):this.div.addEventListener("keydown",z(this,Ke,K6).bind(this),{signal:this._uiManager._signal});const i=R(this,fd,document.createElement("div"));t.append(i),i.setAttribute("aria-hidden","true"),i.className="internal",i.style.clipPath=d(this,hd);const[r,s]=this.parentDimensions;return this.setDims(this.width*r,this.height*s),zb(this,d(this,fd),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(d(this,fi),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(d(this,fi),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:z(this,Ke,N0).call(this,!0);break;case 1:case 3:z(this,Ke,N0).call(this,!1);break}}select(){var t;super.select(),d(this,fi)&&((t=this.parent)==null||t.drawLayer.updateProperties(d(this,fi),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),d(this,fi)&&((t=this.parent)==null||t.drawLayer.updateProperties(d(this,fi),{rootClass:{selected:!1}}),d(this,Gn)||z(this,Ke,N0).call(this,!1))}get _mustFixPosition(){return!d(this,Gn)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(d(this,gr),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(d(this,fi),{rootClass:{hidden:!t}}))}static startHighlighting(t,i,{target:r,x:s,y:a}){const{x:o,y:l,width:u,height:c}=r.getBoundingClientRect(),h=new AbortController,f=t.combinedSignal(h),m=y=>{h.abort(),z(this,Yr,J6).call(this,t,y)};window.addEventListener("blur",m,{signal:f}),window.addEventListener("pointerup",m,{signal:f}),window.addEventListener("pointerdown",Tr,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",qs,{signal:f}),r.addEventListener("pointermove",z(this,Yr,Q6).bind(this,t),{signal:f}),this._freeHighlight=new HS({x:s,y:a},[o,l,u,c],t.scale,this._defaultThickness/2,i,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,i,r){var _,x,v,w;let s=null;if(t instanceof T6){const{data:{quadPoints:E,rect:C,rotation:D,id:V,color:I,opacity:k,popupRef:N},parent:{page:{pageNumber:L}}}=t;s=t={annotationType:Ye.HIGHLIGHT,color:Array.from(I),opacity:k,quadPoints:E,boxes:null,pageIndex:L-1,rect:C.slice(0),rotation:D,id:V,deleted:!1,popupRef:N}}else if(t instanceof jC){const{data:{inkLists:E,rect:C,rotation:D,id:V,color:I,borderStyle:{rawWidth:k},popupRef:N},parent:{page:{pageNumber:L}}}=t;s=t={annotationType:Ye.HIGHLIGHT,color:Array.from(I),thickness:k,inkLists:E,boxes:null,pageIndex:L-1,rect:C.slice(0),rotation:D,id:V,deleted:!1,popupRef:N}}const{color:a,quadPoints:o,inkLists:l,opacity:u}=t,c=await super.deserialize(t,i,r);c.color=Ne.makeHexColor(...a),R(c,So,u||1),l&&R(c,Br,t.thickness),c.annotationElementId=t.id||null,c._initialData=s;const[h,f]=c.pageDimensions,[m,y]=c.pageTranslation;if(o){const E=R(c,To,[]);for(let C=0;C<o.length;C+=8)E.push({x:(o[C]-m)/h,y:1-(o[C+1]-y)/f,width:(o[C+2]-o[C])/h,height:(o[C+1]-o[C+5])/f});z(_=c,Ke,KS).call(_),z(x=c,Ke,dc).call(x),c.rotate(c.rotation)}else if(l){R(c,Gn,!0);const E=l[0],C={x:E[0]-m,y:f-(E[1]-y)},D=new HS(C,[0,0,h,f],1,d(c,Br)/2,!0,.001);for(let k=0,N=E.length;k<N;k+=2)C.x=E[k]-m,C.y=f-(E[k+1]-y),D.add(C);const{id:V,clipPathId:I}=i.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:c.color,"fill-opacity":c._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:D.toSVGPath()}},!0,!0);z(v=c,Ke,P0).call(v,{highlightOutlines:D.getOutlines(),highlightId:V,clipPathId:I}),z(w=c,Ke,dc).call(w)}return c}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const i=this.getRect(0,0),r=Yt._colorManager.convert(this.color),s={annotationType:Ye.HIGHLIGHT,color:r,opacity:d(this,So),thickness:d(this,Br),quadPoints:z(this,Ke,Y6).call(this),outlines:z(this,Ke,X6).call(this,i),pageIndex:this.pageIndex,rect:i,rotation:z(this,Ke,_g).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!z(this,Ke,Z6).call(this,s)?null:(s.id=this.annotationElementId,s)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};np=new WeakMap,j_=new WeakMap,To=new WeakMap,hd=new WeakMap,ip=new WeakMap,Yi=new WeakMap,B_=new WeakMap,U_=new WeakMap,fd=new WeakMap,jr=new WeakMap,gr=new WeakMap,Gn=new WeakMap,rp=new WeakMap,So=new WeakMap,fi=new WeakMap,sp=new WeakMap,Br=new WeakMap,H_=new WeakMap,Ke=new WeakSet,KS=function(){const t=new BS(d(this,To),.001);R(this,jr,t.getOutlines()),[this.x,this.y,this.width,this.height]=d(this,jr).box;const i=new BS(d(this,To),.0025,.001,this._uiManager.direction==="ltr");R(this,Yi,i.getOutlines());const{lastPoint:r}=d(this,Yi);R(this,rp,[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height])},P0=function({highlightOutlines:t,highlightId:i,clipPathId:r}){var h,f;if(R(this,jr,t),R(this,Yi,t.getNewOutline(d(this,Br)/2+1.5,.0025)),i>=0)R(this,gr,i),R(this,hd,r),this.parent.drawLayer.finalizeDraw(i,{bbox:t.box,path:{d:t.toSVGPath()}}),R(this,fi,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:d(this,Yi).box,path:{d:d(this,Yi).toSVGPath()}},!0));else if(this.parent){const m=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(d(this,gr),{bbox:z(h=yt,Yr,Ph).call(h,d(this,jr).box,(m-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(d(this,fi),{bbox:z(f=yt,Yr,Ph).call(f,d(this,Yi).box,m),path:{d:d(this,Yi).toSVGPath()}})}const[a,o,l,u]=t.box;switch(this.rotation){case 0:this.x=a,this.y=o,this.width=l,this.height=u;break;case 90:{const[m,y]=this.parentDimensions;this.x=o,this.y=1-a,this.width=l*y/m,this.height=u*m/y;break}case 180:this.x=1-a,this.y=1-o,this.width=l,this.height=u;break;case 270:{const[m,y]=this.parentDimensions;this.x=1-o,this.y=a,this.width=l*y/m,this.height=u*m/y;break}}const{lastPoint:c}=d(this,Yi);R(this,rp,[(c[0]-a)/l,(c[1]-o)/u])},W6=function(t){const i=(a,o)=>{var l,u;this.color=a,R(this,So,o),(l=this.parent)==null||l.drawLayer.updateProperties(d(this,gr),{root:{fill:a,"fill-opacity":o}}),(u=d(this,ip))==null||u.updateColor(a)},r=this.color,s=d(this,So);this.addCommands({cmd:i.bind(this,t,yt._defaultOpacity),undo:i.bind(this,r,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:st.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},q6=function(t){const i=d(this,Br),r=s=>{R(this,Br,s),z(this,Ke,G6).call(this,s)};this.addCommands({cmd:r.bind(this,t),undo:r.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:st.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},G6=function(t){if(!d(this,Gn))return;z(this,Ke,P0).call(this,{highlightOutlines:d(this,jr).getNewOutline(t/2)}),this.fixAndSetPosition();const[i,r]=this.parentDimensions;this.setDims(this.width*i,this.height*r)},YS=function(){d(this,gr)===null||!this.parent||(this.parent.drawLayer.remove(d(this,gr)),R(this,gr,null),this.parent.drawLayer.remove(d(this,fi)),R(this,fi,null))},dc=function(t=this.parent){d(this,gr)===null&&({id:Ti(this,gr)._,clipPathId:Ti(this,hd)._}=t.drawLayer.draw({bbox:d(this,jr).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":d(this,So)},rootClass:{highlight:!0,free:d(this,Gn)},path:{d:d(this,jr).toSVGPath()}},!1,!0),R(this,fi,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:d(this,Gn)},bbox:d(this,Yi).box,path:{d:d(this,Yi).toSVGPath()}},d(this,Gn))),d(this,fd)&&(d(this,fd).style.clipPath=d(this,hd)))},Yr=new WeakSet,Ph=function([t,i,r,s],a){switch(a){case 90:return[1-i-s,t,s,r];case 180:return[1-t-r,1-i-s,r,s];case 270:return[i,1-t-r,s,r]}return[t,i,r,s]},K6=function(t){yt._keyboardManager.exec(this,t)},N0=function(t){if(!d(this,np))return;const i=window.getSelection();t?i.setPosition(d(this,np),d(this,j_)):i.setPosition(d(this,B_),d(this,U_))},_g=function(){return d(this,Gn)?this.rotation:0},Y6=function(){if(d(this,Gn))return null;const[t,i]=this.pageDimensions,[r,s]=this.pageTranslation,a=d(this,To),o=new Float32Array(a.length*8);let l=0;for(const{x:u,y:c,width:h,height:f}of a){const m=u*t+r,y=(1-c)*i+s;o[l]=o[l+4]=m,o[l+1]=o[l+3]=y,o[l+2]=o[l+6]=m+h*t,o[l+5]=o[l+7]=y-f*i,l+=8}return o},X6=function(t){return d(this,jr).serialize(t,z(this,Ke,_g).call(this))},Q6=function(t,i){this._freeHighlight.add(i)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},J6=function(t,i){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(i,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},Z6=function(t){const{color:i}=this._initialData;return t.color.some((r,s)=>r!==i[s])},F(yt,Yr),Le(yt,"_defaultColor",null),Le(yt,"_defaultOpacity",1),Le(yt,"_defaultThickness",12),Le(yt,"_type","highlight"),Le(yt,"_editorType",Ye.HIGHLIGHT),Le(yt,"_freeHighlightId",-1),Le(yt,"_freeHighlight",null),Le(yt,"_freeHighlightClipId","");let Hb=yt;var pd;class zte{constructor(){F(this,pd,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,i]of Object.entries(e))this.updateProperty(t,i)}updateSVGProperty(e,t){d(this,pd)[e]=t}toSVGProperties(){const e=d(this,pd);return R(this,pd,Object.create(null)),{root:e}}reset(){R(this,pd,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){Rt("Not implemented")}}pd=new WeakMap;var yr,ap,Fn,md,gd,Wl,ql,Gl,yd,dt,QS,JS,ZS,vg,e5,D0,wg,Nh;const ke=class ke extends Yt{constructor(t){super(t);F(this,dt);F(this,yr,null);F(this,ap);Le(this,"_drawId",null);R(this,ap,t.mustBeCommitted||!1),t.drawOutlines&&(z(this,dt,QS).call(this,t),z(this,dt,vg).call(this))}static _mergeSVGProperties(t,i){const r=new Set(Object.keys(t));for(const[s,a]of Object.entries(i))r.has(s)?Object.assign(t[s],a):t[s]=a;return t}static getDefaultDrawingOptions(t){Rt("Not implemented")}static get typesMap(){Rt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,i){const r=this.typesMap.get(t);r&&this._defaultDrawingOptions.updateProperty(r,i),this._currentParent&&(d(ke,Fn).updateProperty(r,i),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,i){const r=this.constructor.typesMap.get(t);r&&this._updateProperty(t,r,i)}static get defaultPropertiesToUpdate(){const t=[],i=this._defaultDrawingOptions;for(const[r,s]of this.typesMap)t.push([r,i[s]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:i}=this;for(const[r,s]of this.constructor.typesMap)t.push([r,i[s]]);return t}_updateProperty(t,i,r){const s=this._drawingOptions,a=s[i],o=l=>{var c;s.updateProperty(i,l);const u=d(this,yr).updateProperty(i,l);u&&z(this,dt,wg).call(this,u),(c=this.parent)==null||c.drawLayer.updateProperties(this._drawId,s.toSVGProperties())};this.addCommands({cmd:o.bind(this,r),undo:o.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,ke._mergeSVGProperties(d(this,yr).getPathResizingSVGProperties(z(this,dt,D0).call(this)),{bbox:z(this,dt,Nh).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,ke._mergeSVGProperties(d(this,yr).getPathResizedSVGProperties(z(this,dt,D0).call(this)),{bbox:z(this,dt,Nh).call(this)}))}_onTranslating(t,i){var r;(r=this.parent)==null||r.drawLayer.updateProperties(this._drawId,{bbox:z(this,dt,Nh).call(this,t,i)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,ke._mergeSVGProperties(d(this,yr).getPathTranslatedSVGProperties(z(this,dt,D0).call(this),this.parentDimensions),{bbox:z(this,dt,Nh).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,d(this,ap)&&(R(this,ap,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){z(this,dt,ZS).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(z(this,dt,vg).call(this),z(this,dt,wg).call(this,d(this,yr).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var r;let i=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),z(this,dt,ZS).call(this)):t&&(this._uiManager.addShouldRescale(this),z(this,dt,vg).call(this,t),i=!this.parent&&((r=this.div)==null?void 0:r.classList.contains("selectedEditor"))),super.setParent(t),i&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,ke._mergeSVGProperties({bbox:z(this,dt,Nh).call(this)},d(this,yr).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&z(this,dt,wg).call(this,d(this,yr).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;const t=super.render();t.classList.add("draw");const i=document.createElement("div");t.append(i),i.setAttribute("aria-hidden","true"),i.className="internal";const[r,s]=this.parentDimensions;return this.setDims(this.width*r,this.height*s),this._uiManager.addShouldRescale(this),this.disableEditing(),t}static createDrawerInstance(t,i,r,s,a){Rt("Not implemented")}static startDrawing(t,i,r,s){var x;const{target:a,offsetX:o,offsetY:l,pointerId:u,pointerType:c}=s;if(d(ke,ql)&&d(ke,ql)!==c)return;const{viewport:{rotation:h}}=t,{width:f,height:m}=a.getBoundingClientRect(),y=R(ke,md,new AbortController),_=t.combinedSignal(y);if(d(ke,Wl)||R(ke,Wl,u),d(ke,ql)??R(ke,ql,c),window.addEventListener("pointerup",v=>{var w;d(ke,Wl)===v.pointerId?this._endDraw(v):(w=d(ke,Gl))==null||w.delete(v.pointerId)},{signal:_}),window.addEventListener("pointercancel",v=>{var w;d(ke,Wl)===v.pointerId?this._currentParent.endDrawingSession():(w=d(ke,Gl))==null||w.delete(v.pointerId)},{signal:_}),window.addEventListener("pointerdown",v=>{d(ke,ql)===v.pointerType&&((d(ke,Gl)||R(ke,Gl,new Set)).add(v.pointerId),d(ke,Fn).isCancellable()&&(d(ke,Fn).removeLastElement(),d(ke,Fn).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:_}),window.addEventListener("contextmenu",qs,{signal:_}),a.addEventListener("pointermove",this._drawMove.bind(this),{signal:_}),a.addEventListener("touchmove",v=>{v.timeStamp===d(ke,yd)&&Tr(v)},{signal:_}),t.toggleDrawing(),(x=i._editorUndoBar)==null||x.hide(),d(ke,Fn)){t.drawLayer.updateProperties(this._currentDrawId,d(ke,Fn).startNew(o,l,f,m,h));return}i.updateUIForDefaultProperties(this),R(ke,Fn,this.createDrawerInstance(o,l,f,m,h)),R(ke,gd,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(d(ke,gd).toSVGProperties(),d(ke,Fn).defaultSVGProperties),!0,!1)}static _drawMove(t){var a;if(R(ke,yd,-1),!d(ke,Fn))return;const{offsetX:i,offsetY:r,pointerId:s}=t;if(d(ke,Wl)===s){if(((a=d(ke,Gl))==null?void 0:a.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,d(ke,Fn).add(i,r)),R(ke,yd,t.timeStamp),Tr(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,R(ke,Fn,null),R(ke,gd,null),R(ke,ql,null),R(ke,yd,NaN)),d(ke,md)&&(d(ke,md).abort(),R(ke,md,null),R(ke,Wl,NaN),R(ke,Gl,null))}static _endDraw(t){const i=this._currentParent;if(i){if(i.toggleDrawing(!0),this._cleanup(!1),t&&i.drawLayer.updateProperties(this._currentDrawId,d(ke,Fn).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const r=d(ke,Fn),s=this._currentDrawId,a=r.getLastElement();i.addCommands({cmd:()=>{i.drawLayer.updateProperties(s,r.setLastElement(a))},undo:()=>{i.drawLayer.updateProperties(s,r.removeLastElement())},mustExec:!1,type:st.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const i=this._currentParent;if(!i)return null;if(i.toggleDrawing(!0),i.cleanUndoStack(st.DRAW_STEP),!d(ke,Fn).isEmpty()){const{pageDimensions:[r,s],scale:a}=i,o=i.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:d(ke,Fn).getOutlines(r*a,s*a,a,this._INNER_MARGIN),drawingOptions:d(ke,gd),mustBeCommitted:!t});return this._cleanup(!0),o}return i.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,i,r,s,a,o){Rt("Not implemented")}static async deserialize(t,i,r){var h,f;const{rawDims:{pageWidth:s,pageHeight:a,pageX:o,pageY:l}}=i.viewport,u=this.deserializeDraw(o,l,s,a,this._INNER_MARGIN,t),c=await super.deserialize(t,i,r);return c.createDrawingOptions(t),z(h=c,dt,QS).call(h,{drawOutlines:u}),z(f=c,dt,vg).call(f),c.onScaleChanging(),c.rotate(),c}serializeDraw(t){const[i,r]=this.pageTranslation,[s,a]=this.pageDimensions;return d(this,yr).serialize([i,r,s,a],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};yr=new WeakMap,ap=new WeakMap,Fn=new WeakMap,md=new WeakMap,gd=new WeakMap,Wl=new WeakMap,ql=new WeakMap,Gl=new WeakMap,yd=new WeakMap,dt=new WeakSet,QS=function({drawOutlines:t,drawId:i,drawingOptions:r}){R(this,yr,t),this._drawingOptions||(this._drawingOptions=r),i>=0?(this._drawId=i,this.parent.drawLayer.finalizeDraw(i,t.defaultProperties)):this._drawId=z(this,dt,JS).call(this,t,this.parent),z(this,dt,wg).call(this,t.box)},JS=function(t,i){const{id:r}=i.drawLayer.draw(ke._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return r},ZS=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},vg=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=z(this,dt,JS).call(this,d(this,yr),t)}},e5=function([t,i,r,s]){const{parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[i,1-t,r*(o/a),s*(a/o)];case 180:return[1-t,1-i,r,s];case 270:return[1-i,t,r*(o/a),s*(a/o)];default:return[t,i,r,s]}},D0=function(){const{x:t,y:i,width:r,height:s,parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[1-i,t,r*(a/o),s*(o/a)];case 180:return[1-t,1-i,r,s];case 270:return[i,1-t,r*(a/o),s*(o/a)];default:return[t,i,r,s]}},wg=function(t){if([this.x,this.y,this.width,this.height]=z(this,dt,e5).call(this,t),this.div){this.fixAndSetPosition();const[i,r]=this.parentDimensions;this.setDims(this.width*i,this.height*r)}this._onResized()},Nh=function(){const{x:t,y:i,width:r,height:s,rotation:a,parentRotation:o,parentDimensions:[l,u]}=this;switch((a*4+o)/90){case 1:return[1-i-s,t,s,r];case 2:return[1-t-r,1-i-s,r,s];case 3:return[i,1-t-r,s,r];case 4:return[t,i-r*(l/u),s*(u/l),r*(l/u)];case 5:return[1-i,t,r*(l/u),s*(u/l)];case 6:return[1-t-s*(u/l),1-i,s*(u/l),r*(l/u)];case 7:return[i-r*(l/u),1-t-s*(u/l),r*(l/u),s*(u/l)];case 8:return[t-r,i-s,r,s];case 9:return[1-i,t-r,s,r];case 10:return[1-t,1-i,r,s];case 11:return[i-s,1-t,s,r];case 12:return[t-s*(u/l),i,s*(u/l),r*(l/u)];case 13:return[1-i-r*(l/u),t-s*(u/l),r*(l/u),s*(u/l)];case 14:return[1-t,1-i-r*(l/u),s*(u/l),r*(l/u)];case 15:return[i,1-t,r*(l/u),s*(u/l)];default:return[t,i,r,s]}},Le(ke,"_currentDrawId",-1),Le(ke,"_currentParent",null),F(ke,Fn,null),F(ke,md,null),F(ke,gd,null),F(ke,Wl,NaN),F(ke,ql,null),F(ke,Gl,null),F(ke,yd,NaN),Le(ke,"_INNER_MARGIN",3);let XS=ke;var xa,zn,Vn,_d,op,ki,Kn,Ur,vd,wd,bd,lp,M0;class Vte{constructor(e,t,i,r,s,a){F(this,lp);F(this,xa,new Float64Array(6));F(this,zn);F(this,Vn);F(this,_d);F(this,op);F(this,ki);F(this,Kn,"");F(this,Ur,0);F(this,vd,new Wb);F(this,wd);F(this,bd);R(this,wd,i),R(this,bd,r),R(this,_d,s),R(this,op,a),[e,t]=z(this,lp,M0).call(this,e,t);const o=R(this,zn,[NaN,NaN,NaN,NaN,e,t]);R(this,ki,[e,t]),R(this,Vn,[{line:o,points:d(this,ki)}]),d(this,xa).set(o,0)}updateProperty(e,t){e==="stroke-width"&&R(this,op,t)}isEmpty(){return!d(this,Vn)||d(this,Vn).length===0}isCancellable(){return d(this,ki).length<=10}add(e,t){[e,t]=z(this,lp,M0).call(this,e,t);const[i,r,s,a]=d(this,xa).subarray(2,6),o=e-s,l=t-a;return Math.hypot(d(this,wd)*o,d(this,bd)*l)<=2?null:(d(this,ki).push(e,t),isNaN(i)?(d(this,xa).set([s,a,e,t],2),d(this,zn).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(d(this,xa)[0])&&d(this,zn).splice(6,6),d(this,xa).set([i,r,s,a,e,t],0),d(this,zn).push(...Se.createBezierPoints(i,r,s,a,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const i=this.add(e,t);return i||(d(this,ki).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,i,r,s){R(this,wd,i),R(this,bd,r),R(this,_d,s),[e,t]=z(this,lp,M0).call(this,e,t);const a=R(this,zn,[NaN,NaN,NaN,NaN,e,t]);R(this,ki,[e,t]);const o=d(this,Vn).at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),d(this,Vn).push({line:a,points:d(this,ki)}),d(this,xa).set(a,0),R(this,Ur,0),this.toSVGPath(),null}getLastElement(){return d(this,Vn).at(-1)}setLastElement(e){return d(this,Vn)?(d(this,Vn).push(e),R(this,zn,e.line),R(this,ki,e.points),R(this,Ur,0),{path:{d:this.toSVGPath()}}):d(this,vd).setLastElement(e)}removeLastElement(){if(!d(this,Vn))return d(this,vd).removeLastElement();d(this,Vn).pop(),R(this,Kn,"");for(let e=0,t=d(this,Vn).length;e<t;e++){const{line:i,points:r}=d(this,Vn)[e];R(this,zn,i),R(this,ki,r),R(this,Ur,0),this.toSVGPath()}return{path:{d:d(this,Kn)}}}toSVGPath(){const e=Se.svgRound(d(this,zn)[4]),t=Se.svgRound(d(this,zn)[5]);if(d(this,ki).length===2)return R(this,Kn,`${d(this,Kn)} M ${e} ${t} Z`),d(this,Kn);if(d(this,ki).length<=6){const r=d(this,Kn).lastIndexOf("M");R(this,Kn,`${d(this,Kn).slice(0,r)} M ${e} ${t}`),R(this,Ur,6)}if(d(this,ki).length===4){const r=Se.svgRound(d(this,zn)[10]),s=Se.svgRound(d(this,zn)[11]);return R(this,Kn,`${d(this,Kn)} L ${r} ${s}`),R(this,Ur,12),d(this,Kn)}const i=[];d(this,Ur)===0&&(i.push(`M ${e} ${t}`),R(this,Ur,6));for(let r=d(this,Ur),s=d(this,zn).length;r<s;r+=6){const[a,o,l,u,c,h]=d(this,zn).slice(r,r+6).map(Se.svgRound);i.push(`C${a} ${o} ${l} ${u} ${c} ${h}`)}return R(this,Kn,d(this,Kn)+i.join(" ")),R(this,Ur,d(this,zn).length),d(this,Kn)}getOutlines(e,t,i,r){const s=d(this,Vn).at(-1);return s.line=new Float32Array(s.line),s.points=new Float32Array(s.points),d(this,vd).build(d(this,Vn),e,t,i,d(this,_d),d(this,op),r),R(this,xa,null),R(this,zn,null),R(this,Vn,null),R(this,Kn,null),d(this,vd)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}xa=new WeakMap,zn=new WeakMap,Vn=new WeakMap,_d=new WeakMap,op=new WeakMap,ki=new WeakMap,Kn=new WeakMap,Ur=new WeakMap,vd=new WeakMap,wd=new WeakMap,bd=new WeakMap,lp=new WeakSet,M0=function(e,t){return Se._normalizePoint(e,t,d(this,wd),d(this,bd),d(this,_d))};var $i,W_,q_,_r,Ea,Aa,up,cp,dp,Jn,eo,t5,n5,i5;const GC=class GC extends Se{constructor(){super(...arguments);F(this,Jn);F(this,$i);F(this,W_,0);F(this,q_);F(this,_r);F(this,Ea);F(this,Aa);F(this,up);F(this,cp);F(this,dp)}build(t,i,r,s,a,o,l){R(this,Ea,i),R(this,Aa,r),R(this,up,s),R(this,cp,a),R(this,dp,o),R(this,q_,l??0),R(this,_r,t),z(this,Jn,n5).call(this)}setLastElement(t){return d(this,_r).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return d(this,_r).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:i}of d(this,_r)){if(t.push(`M${Se.svgRound(i[4])} ${Se.svgRound(i[5])}`),i.length===6){t.push("Z");continue}if(i.length===12){t.push(`L${Se.svgRound(i[10])} ${Se.svgRound(i[11])}`);continue}for(let r=6,s=i.length;r<s;r+=6){const[a,o,l,u,c,h]=i.subarray(r,r+6).map(Se.svgRound);t.push(`C${a} ${o} ${l} ${u} ${c} ${h}`)}}return t.join("")}serialize([t,i,r,s],a){const o=[],l=[],[u,c,h,f]=z(this,Jn,t5).call(this);let m,y,_,x,v,w,E,C,D;switch(d(this,cp)){case 0:D=Se._rescale,m=t,y=i+s,_=r,x=-s,v=t+u*r,w=i+(1-c-f)*s,E=t+(u+h)*r,C=i+(1-c)*s;break;case 90:D=Se._rescaleAndSwap,m=t,y=i,_=r,x=s,v=t+c*r,w=i+u*s,E=t+(c+f)*r,C=i+(u+h)*s;break;case 180:D=Se._rescale,m=t+r,y=i,_=-r,x=s,v=t+(1-u-h)*r,w=i+c*s,E=t+(1-u)*r,C=i+(c+f)*s;break;case 270:D=Se._rescaleAndSwap,m=t+r,y=i+s,_=-r,x=-s,v=t+(1-c-f)*r,w=i+(1-u-h)*s,E=t+(1-c)*r,C=i+(1-u)*s;break}for(const{line:V,points:I}of d(this,_r))o.push(D(V,m,y,_,x,a?new Array(V.length):null)),l.push(D(I,m,y,_,x,a?new Array(I.length):null));return{lines:o,points:l,rect:[v,w,E,C]}}static deserialize(t,i,r,s,a,{paths:{lines:o,points:l},rotation:u,thickness:c}){const h=[];let f,m,y,_,x;switch(u){case 0:x=Se._rescale,f=-t/r,m=i/s+1,y=1/r,_=-1/s;break;case 90:x=Se._rescaleAndSwap,f=-i/s,m=-t/r,y=1/s,_=1/r;break;case 180:x=Se._rescale,f=t/r+1,m=-i/s,y=-1/r,_=1/s;break;case 270:x=Se._rescaleAndSwap,f=i/s+1,m=t/r+1,y=-1/s,_=-1/r;break}if(!o){o=[];for(const w of l){const E=w.length;if(E===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1]]));continue}if(E===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1],NaN,NaN,NaN,NaN,w[2],w[3]]));continue}const C=new Float32Array(3*(E-2));o.push(C);let[D,V,I,k]=w.subarray(0,4);C.set([NaN,NaN,NaN,NaN,D,V],0);for(let N=4;N<E;N+=2){const L=w[N],j=w[N+1];C.set(Se.createBezierPoints(D,V,I,k,L,j),(N-2)*3),[D,V,I,k]=[I,k,L,j]}}}for(let w=0,E=o.length;w<E;w++)h.push({line:x(o[w].map(C=>C??NaN),f,m,y,_),points:x(l[w].map(C=>C??NaN),f,m,y,_)});const v=new GC;return v.build(h,r,s,1,u,c,a),v}get box(){return d(this,$i)}updateProperty(t,i){return t==="stroke-width"?z(this,Jn,i5).call(this,i):null}updateParentDimensions([t,i],r){const[s,a]=z(this,Jn,eo).call(this);R(this,Ea,t),R(this,Aa,i),R(this,up,r);const[o,l]=z(this,Jn,eo).call(this),u=o-s,c=l-a,h=d(this,$i);return h[0]-=u,h[1]-=c,h[2]+=2*u,h[3]+=2*c,h}updateRotation(t){return R(this,W_,t),{path:{transform:this.rotationTransform}}}get viewBox(){return d(this,$i).map(Se.svgRound).join(" ")}get defaultProperties(){const[t,i]=d(this,$i);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Se.svgRound(t)} ${Se.svgRound(i)}`}}}get rotationTransform(){const[,,t,i]=d(this,$i);let r=0,s=0,a=0,o=0,l=0,u=0;switch(d(this,W_)){case 90:s=i/t,a=-t/i,l=t;break;case 180:r=-1,o=-1,l=t,u=i;break;case 270:s=-i/t,a=t/i,u=i;break;default:return""}return`matrix(${r} ${s} ${a} ${o} ${Se.svgRound(l)} ${Se.svgRound(u)})`}getPathResizingSVGProperties([t,i,r,s]){const[a,o]=z(this,Jn,eo).call(this),[l,u,c,h]=d(this,$i);if(Math.abs(c-a)<=Se.PRECISION||Math.abs(h-o)<=Se.PRECISION){const x=t+r/2-(l+c/2),v=i+s/2-(u+h/2);return{path:{"transform-origin":`${Se.svgRound(t)} ${Se.svgRound(i)}`,transform:`${this.rotationTransform} translate(${x} ${v})`}}}const f=(r-2*a)/(c-2*a),m=(s-2*o)/(h-2*o),y=c/r,_=h/s;return{path:{"transform-origin":`${Se.svgRound(l)} ${Se.svgRound(u)}`,transform:`${this.rotationTransform} scale(${y} ${_}) translate(${Se.svgRound(a)} ${Se.svgRound(o)}) scale(${f} ${m}) translate(${Se.svgRound(-a)} ${Se.svgRound(-o)})`}}}getPathResizedSVGProperties([t,i,r,s]){const[a,o]=z(this,Jn,eo).call(this),l=d(this,$i),[u,c,h,f]=l;if(l[0]=t,l[1]=i,l[2]=r,l[3]=s,Math.abs(h-a)<=Se.PRECISION||Math.abs(f-o)<=Se.PRECISION){const v=t+r/2-(u+h/2),w=i+s/2-(c+f/2);for(const{line:E,points:C}of d(this,_r))Se._translate(E,v,w,E),Se._translate(C,v,w,C);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Se.svgRound(t)} ${Se.svgRound(i)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const m=(r-2*a)/(h-2*a),y=(s-2*o)/(f-2*o),_=-m*(u+a)+t+a,x=-y*(c+o)+i+o;if(m!==1||y!==1||_!==0||x!==0)for(const{line:v,points:w}of d(this,_r))Se._rescale(v,_,x,m,y,v),Se._rescale(w,_,x,m,y,w);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Se.svgRound(t)} ${Se.svgRound(i)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,i],r){const[s,a]=r,o=d(this,$i),l=t-o[0],u=i-o[1];if(d(this,Ea)===s&&d(this,Aa)===a)for(const{line:c,points:h}of d(this,_r))Se._translate(c,l,u,c),Se._translate(h,l,u,h);else{const c=d(this,Ea)/s,h=d(this,Aa)/a;R(this,Ea,s),R(this,Aa,a);for(const{line:f,points:m}of d(this,_r))Se._rescale(f,l,u,c,h,f),Se._rescale(m,l,u,c,h,m);o[2]*=c,o[3]*=h}return o[0]=t,o[1]=i,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${Se.svgRound(t)} ${Se.svgRound(i)}`}}}get defaultSVGProperties(){const t=d(this,$i);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${Se.svgRound(t[0])} ${Se.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}};$i=new WeakMap,W_=new WeakMap,q_=new WeakMap,_r=new WeakMap,Ea=new WeakMap,Aa=new WeakMap,up=new WeakMap,cp=new WeakMap,dp=new WeakMap,Jn=new WeakSet,eo=function(t=d(this,dp)){const i=d(this,q_)+t/2*d(this,up);return d(this,cp)%180===0?[i/d(this,Ea),i/d(this,Aa)]:[i/d(this,Aa),i/d(this,Ea)]},t5=function(){const[t,i,r,s]=d(this,$i),[a,o]=z(this,Jn,eo).call(this,0);return[t+a,i+o,r-2*a,s-2*o]},n5=function(){const t=R(this,$i,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:s}of d(this,_r)){if(s.length<=12){for(let l=4,u=s.length;l<u;l+=6){const[c,h]=s.subarray(l,l+2);t[0]=Math.min(t[0],c),t[1]=Math.min(t[1],h),t[2]=Math.max(t[2],c),t[3]=Math.max(t[3],h)}continue}let a=s[4],o=s[5];for(let l=6,u=s.length;l<u;l+=6){const[c,h,f,m,y,_]=s.subarray(l,l+6);Ne.bezierBoundingBox(a,o,c,h,f,m,y,_,t),a=y,o=_}}const[i,r]=z(this,Jn,eo).call(this);t[0]=Math.min(1,Math.max(0,t[0]-i)),t[1]=Math.min(1,Math.max(0,t[1]-r)),t[2]=Math.min(1,Math.max(0,t[2]+i)),t[3]=Math.min(1,Math.max(0,t[3]+r)),t[2]-=t[0],t[3]-=t[1]},i5=function(t){const[i,r]=z(this,Jn,eo).call(this);R(this,dp,t);const[s,a]=z(this,Jn,eo).call(this),[o,l]=[s-i,a-r],u=d(this,$i);return u[0]-=o,u[1]-=l,u[2]+=2*o,u[3]+=2*l,u};let Wb=GC;var hp;const KC=class KC extends zte{constructor(t){super();F(this,hp);R(this,hp,t),super.updateProperties({fill:"none",stroke:Yt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,i){t==="stroke-width"&&(i??(i=this["stroke-width"]),i*=d(this,hp).realScale),super.updateSVGProperty(t,i)}clone(){const t=new KC(d(this,hp));return t.updateAll(this),t}};hp=new WeakMap;let e2=KC;var c1,r5;const Xh=class Xh extends XS{constructor(t){super({...t,name:"inkEditor"});F(this,c1);this._willKeepAspectRatio=!0}static initialize(t,i){Yt.initialize(t,i),this._defaultDrawingOptions=new e2(i.viewParameters)}static getDefaultDrawingOptions(t){const i=this._defaultDrawingOptions.clone();return i.updateProperties(t),i}static get supportMultipleDrawings(){return!0}static get typesMap(){return Ze(this,"typesMap",new Map([[st.INK_THICKNESS,"stroke-width"],[st.INK_COLOR,"stroke"],[st.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,i,r,s,a){return new Vte(t,i,r,s,a,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,i,r,s,a,o){return Wb.deserialize(t,i,r,s,a,o)}static async deserialize(t,i,r){let s=null;if(t instanceof jC){const{data:{inkLists:o,rect:l,rotation:u,id:c,color:h,opacity:f,borderStyle:{rawWidth:m},popupRef:y},parent:{page:{pageNumber:_}}}=t;s=t={annotationType:Ye.INK,color:Array.from(h),thickness:m,opacity:f,paths:{points:o},boxes:null,pageIndex:_-1,rect:l.slice(0),rotation:u,id:c,deleted:!1,popupRef:y}}const a=await super.deserialize(t,i,r);return a.annotationElementId=t.id||null,a._initialData=s,a}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:i,parent:r}=this;i.updateSVGProperty("stroke-width"),r.drawLayer.updateProperties(t,i.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:i,opacity:r}){this._drawingOptions=Xh.getDefaultDrawingOptions({stroke:Ne.makeHexColor(...t),"stroke-width":i,"stroke-opacity":r})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:i,points:r,rect:s}=this.serializeDraw(t),{_drawingOptions:{stroke:a,"stroke-opacity":o,"stroke-width":l}}=this,u={annotationType:Ye.INK,color:Yt._colorManager.convert(a),opacity:o,thickness:l,paths:{lines:i,points:r},pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?u:this.annotationElementId&&!z(this,c1,r5).call(this,u)?null:(u.id=this.annotationElementId,u)}renderAnnotationElement(t){const{points:i,rect:r}=this.serializeDraw(!1);return t.updateEdited({rect:r,thickness:this._drawingOptions["stroke-width"],points:i}),null}};c1=new WeakSet,r5=function(t){const{color:i,thickness:r,opacity:s,pageIndex:a}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((o,l)=>o!==i[l])||t.thickness!==r||t.opacity!==s||t.pageIndex!==a},Le(Xh,"_type","ink"),Le(Xh,"_editorType",Ye.INK),Le(Xh,"_defaultDrawingOptions",null);let t2=Xh;var Gt,Yn,Kl,Io,Yl,fp,Ta,Sa,vr,pp,pt,bg,xg,O0,i2,L0,r2,F0,s5;const Ug=class Ug extends Yt{constructor(t){super({...t,name:"stampEditor"});F(this,pt);F(this,Gt,null);F(this,Yn,null);F(this,Kl,null);F(this,Io,null);F(this,Yl,null);F(this,fp,"");F(this,Ta,null);F(this,Sa,null);F(this,vr,!1);F(this,pp,!1);R(this,Io,t.bitmapUrl),R(this,Yl,t.bitmapFile)}static initialize(t,i){Yt.initialize(t,i)}static get supportedTypes(){return Ze(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(i=>`image/${i}`))}static get supportedTypesStr(){return Ze(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,i){i.pasteEditor(Ye.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const i=t.get("hasAltText");return{hasAltText:i.get(!0)??0,hasNoAltText:i.get(!1)??0}}async mlGuessAltText(t=null,i=!0){if(this.hasAltTextData())return null;const{mlManager:r}=this._uiManager;if(!r)throw new Error("No ML.");if(!await r.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:s,width:a,height:o}=t||this.copyCanvas(null,null,!0).imageData,l=await r.guess({name:"altText",request:{data:s,width:a,height:o,channels:s.length/(a*o)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const u=l.output;return await this.setGuessedAltText(u),i&&!this.hasAltTextData()&&(this.altTextData={alt:u,decorative:!1}),u}remove(){var t;d(this,Yn)&&(R(this,Gt,null),this._uiManager.imageManager.deleteId(d(this,Yn)),(t=d(this,Ta))==null||t.remove(),R(this,Ta,null),d(this,Sa)&&(clearTimeout(d(this,Sa)),R(this,Sa,null))),super.remove()}rebuild(){if(!this.parent){d(this,Yn)&&z(this,pt,O0).call(this);return}super.rebuild(),this.div!==null&&(d(this,Yn)&&d(this,Ta)===null&&z(this,pt,O0).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(d(this,Kl)||d(this,Gt)||d(this,Io)||d(this,Yl)||d(this,Yn))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,i;if(this.width&&(t=this.x,i=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),d(this,Gt)?z(this,pt,i2).call(this):z(this,pt,O0).call(this),this.width&&!this.annotationElementId){const[r,s]=this.parentDimensions;this.setAt(t*r,i*s,this.width*r,this.height*s)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;d(this,Sa)!==null&&clearTimeout(d(this,Sa)),R(this,Sa,setTimeout(()=>{R(this,Sa,null),z(this,pt,r2).call(this)},200))}copyCanvas(t,i,r=!1){var m;t||(t=224);const{width:s,height:a}=d(this,Gt),o=new eS;let l=d(this,Gt),u=s,c=a,h=null;if(i){if(s>i||a>i){const k=Math.min(i/s,i/a);u=Math.floor(s*k),c=Math.floor(a*k)}h=document.createElement("canvas");const y=h.width=Math.ceil(u*o.sx),_=h.height=Math.ceil(c*o.sy);d(this,vr)||(l=z(this,pt,L0).call(this,y,_));const x=h.getContext("2d");x.filter=this._uiManager.hcmFilter;let v="white",w="#cfcfd8";this._uiManager.hcmFilter!=="none"?w="black":(m=window.matchMedia)!=null&&m.call(window,"(prefers-color-scheme: dark)").matches&&(v="#8f8f9d",w="#42414d");const E=15,C=E*o.sx,D=E*o.sy,V=new OffscreenCanvas(C*2,D*2),I=V.getContext("2d");I.fillStyle=v,I.fillRect(0,0,C*2,D*2),I.fillStyle=w,I.fillRect(0,0,C,D),I.fillRect(C,D,C,D),x.fillStyle=x.createPattern(V,"repeat"),x.fillRect(0,0,y,_),x.drawImage(l,0,0,l.width,l.height,0,0,y,_)}let f=null;if(r){let y,_;if(o.symmetric&&l.width<t&&l.height<t)y=l.width,_=l.height;else if(l=d(this,Gt),s>t||a>t){const w=Math.min(t/s,t/a);y=Math.floor(s*w),_=Math.floor(a*w),d(this,vr)||(l=z(this,pt,L0).call(this,y,_))}const v=new OffscreenCanvas(y,_).getContext("2d",{willReadFrequently:!0});v.drawImage(l,0,0,l.width,l.height,0,0,y,_),f={width:y,height:_,data:v.getImageData(0,0,y,_).data}}return{canvas:h,width:u,height:c,imageData:f}}getImageForAltText(){return d(this,Ta)}static async deserialize(t,i,r){var _;let s=null;if(t instanceof S6){const{data:{rect:x,rotation:v,id:w,structParent:E,popupRef:C},container:D,parent:{page:{pageNumber:V}}}=t,I=D.querySelector("canvas"),k=r.imageManager.getFromCanvas(D.id,I);I.remove();const N=((_=await i._structTree.getAriaAttributes(`${NC}${w}`))==null?void 0:_.get("aria-label"))||"";s=t={annotationType:Ye.STAMP,bitmapId:k.id,bitmap:k.bitmap,pageIndex:V-1,rect:x.slice(0),rotation:v,id:w,deleted:!1,accessibilityData:{decorative:!1,altText:N},isSvg:!1,structParent:E,popupRef:C}}const a=await super.deserialize(t,i,r),{rect:o,bitmap:l,bitmapUrl:u,bitmapId:c,isSvg:h,accessibilityData:f}=t;c&&r.imageManager.isValidId(c)?(R(a,Yn,c),l&&R(a,Gt,l)):R(a,Io,u),R(a,vr,h);const[m,y]=a.pageDimensions;return a.width=(o[2]-o[0])/m,a.height=(o[3]-o[1])/y,a.annotationElementId=t.id||null,f&&(a.altTextData=f),a._initialData=s,R(a,pp,!!s),a}serialize(t=!1,i=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const r={annotationType:Ye.STAMP,bitmapId:d(this,Yn),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:d(this,vr),structTreeParentId:this._structTreeParentId};if(t)return r.bitmapUrl=z(this,pt,F0).call(this,!0),r.accessibilityData=this.serializeAltText(!0),r;const{decorative:s,altText:a}=this.serializeAltText(!1);if(!s&&a&&(r.accessibilityData={type:"Figure",alt:a}),this.annotationElementId){const l=z(this,pt,s5).call(this,r);if(l.isSame)return null;l.isSameAltText?delete r.accessibilityData:r.accessibilityData.structParent=this._initialData.structParent??-1}if(r.id=this.annotationElementId,i===null)return r;i.stamps||(i.stamps=new Map);const o=d(this,vr)?(r.rect[2]-r.rect[0])*(r.rect[3]-r.rect[1]):null;if(!i.stamps.has(d(this,Yn)))i.stamps.set(d(this,Yn),{area:o,serialized:r}),r.bitmap=z(this,pt,F0).call(this,!1);else if(d(this,vr)){const l=i.stamps.get(d(this,Yn));o>l.area&&(l.area=o,l.serialized.bitmap.close(),l.serialized.bitmap=z(this,pt,F0).call(this,!1))}return r}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}};Gt=new WeakMap,Yn=new WeakMap,Kl=new WeakMap,Io=new WeakMap,Yl=new WeakMap,fp=new WeakMap,Ta=new WeakMap,Sa=new WeakMap,vr=new WeakMap,pp=new WeakMap,pt=new WeakSet,bg=function(t,i=!1){if(!t){this.remove();return}R(this,Gt,t.bitmap),i||(R(this,Yn,t.id),R(this,vr,t.isSvg)),t.file&&R(this,fp,t.file.name),z(this,pt,i2).call(this)},xg=function(){if(R(this,Kl,null),this._uiManager.enableWaiting(!1),!!d(this,Ta)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&d(this,Gt)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&d(this,Gt)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},O0=function(){if(d(this,Yn)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(d(this,Yn)).then(r=>z(this,pt,bg).call(this,r,!0)).finally(()=>z(this,pt,xg).call(this));return}if(d(this,Io)){const r=d(this,Io);R(this,Io,null),this._uiManager.enableWaiting(!0),R(this,Kl,this._uiManager.imageManager.getFromUrl(r).then(s=>z(this,pt,bg).call(this,s)).finally(()=>z(this,pt,xg).call(this)));return}if(d(this,Yl)){const r=d(this,Yl);R(this,Yl,null),this._uiManager.enableWaiting(!0),R(this,Kl,this._uiManager.imageManager.getFromFile(r).then(s=>z(this,pt,bg).call(this,s)).finally(()=>z(this,pt,xg).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=Ug.supportedTypesStr;const i=this._uiManager._signal;R(this,Kl,new Promise(r=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const s=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),z(this,pt,bg).call(this,s)}r()},{signal:i}),t.addEventListener("cancel",()=>{this.remove(),r()},{signal:i})}).finally(()=>z(this,pt,xg).call(this))),t.click()},i2=function(){var h;const{div:t}=this;let{width:i,height:r}=d(this,Gt);const[s,a]=this.pageDimensions,o=.75;if(this.width)i=this.width*s,r=this.height*a;else if(i>o*s||r>o*a){const f=Math.min(o*s/i,o*a/r);i*=f,r*=f}const[l,u]=this.parentDimensions;this.setDims(i*l/s,r*u/a),this._uiManager.enableWaiting(!1);const c=R(this,Ta,document.createElement("canvas"));c.setAttribute("role","img"),this.addContainer(c),this.width=i/s,this.height=r/a,(h=this._initialOptions)!=null&&h.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),z(this,pt,r2).call(this),d(this,pp)||(this.parent.addUndoableEditor(this),R(this,pp,!0)),this._reportTelemetry({action:"inserted_image"}),d(this,fp)&&c.setAttribute("aria-label",d(this,fp))},L0=function(t,i){const{width:r,height:s}=d(this,Gt);let a=r,o=s,l=d(this,Gt);for(;a>2*t||o>2*i;){const u=a,c=o;a>2*t&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2)),o>2*i&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const h=new OffscreenCanvas(a,o);h.getContext("2d").drawImage(l,0,0,u,c,0,0,a,o),l=h.transferToImageBitmap()}return l},r2=function(){const[t,i]=this.parentDimensions,{width:r,height:s}=this,a=new eS,o=Math.ceil(r*t*a.sx),l=Math.ceil(s*i*a.sy),u=d(this,Ta);if(!u||u.width===o&&u.height===l)return;u.width=o,u.height=l;const c=d(this,vr)?d(this,Gt):z(this,pt,L0).call(this,o,l),h=u.getContext("2d");h.filter=this._uiManager.hcmFilter,h.drawImage(c,0,0,c.width,c.height,0,0,o,l)},F0=function(t){if(t){if(d(this,vr)){const s=this._uiManager.imageManager.getSvgUrl(d(this,Yn));if(s)return s}const i=document.createElement("canvas");return{width:i.width,height:i.height}=d(this,Gt),i.getContext("2d").drawImage(d(this,Gt),0,0),i.toDataURL()}if(d(this,vr)){const[i,r]=this.pageDimensions,s=Math.round(this.width*i*Su.PDF_TO_CSS_UNITS),a=Math.round(this.height*r*Su.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(s,a);return o.getContext("2d").drawImage(d(this,Gt),0,0,d(this,Gt).width,d(this,Gt).height,0,0,s,a),o.transferToImageBitmap()}return structuredClone(d(this,Gt))},s5=function(t){var o;const{pageIndex:i,accessibilityData:{altText:r}}=this._initialData,s=t.pageIndex===i,a=(((o=t.accessibilityData)==null?void 0:o.alt)||"")===r;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&s&&a,isSameAltText:a}},Le(Ug,"_type","stamp"),Le(Ug,"_editorType",Ye.STAMP);let n2=Ug;var xd,mp,Ia,Xl,Co,Hr,Ql,gp,Ed,ks,ko,pi,$o,Pe,Jl,Ut,a5,la,a2,o2,z0;const gs=class gs{constructor({uiManager:e,pageIndex:t,div:i,structTreeLayer:r,accessibilityManager:s,annotationLayer:a,drawLayer:o,textLayer:l,viewport:u,l10n:c}){F(this,Ut);F(this,xd);F(this,mp,!1);F(this,Ia,null);F(this,Xl,null);F(this,Co,null);F(this,Hr,new Map);F(this,Ql,!1);F(this,gp,!1);F(this,Ed,!1);F(this,ks,null);F(this,ko,null);F(this,pi,null);F(this,$o,null);F(this,Pe);const h=[...d(gs,Jl).values()];if(!gs._initialized){gs._initialized=!0;for(const f of h)f.initialize(c,e)}e.registerEditorTypes(h),R(this,Pe,e),this.pageIndex=t,this.div=i,R(this,xd,s),R(this,Ia,a),this.viewport=u,R(this,pi,l),this.drawLayer=o,this._structTree=r,d(this,Pe).addLayer(this)}get isEmpty(){return d(this,Hr).size===0}get isInvisible(){return this.isEmpty&&d(this,Pe).getMode()===Ye.NONE}updateToolbar(e){d(this,Pe).updateToolbar(e)}updateMode(e=d(this,Pe).getMode()){switch(z(this,Ut,z0).call(this),e){case Ye.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Ye.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Ye.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const i of d(gs,Jl).values())t.toggle(`${i._type}Editing`,e===i._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=d(this,pi))==null?void 0:t.div)}setEditingState(e){d(this,Pe).setEditingState(e)}addCommands(e){d(this,Pe).addCommands(e)}cleanUndoStack(e){d(this,Pe).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=d(this,Ia))==null||t.div.classList.toggle("disabled",!e)}async enable(){R(this,Ed,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);const e=new Set;for(const i of d(this,Hr).values())i.enableEditing(),i.show(!0),i.annotationElementId&&(d(this,Pe).removeChangedExistingAnnotation(i),e.add(i.annotationElementId));if(!d(this,Ia)){R(this,Ed,!1);return}const t=d(this,Ia).getEditableAnnotations();for(const i of t){if(i.hide(),d(this,Pe).isDeletedAnnotationElement(i.data.id)||e.has(i.data.id))continue;const r=await this.deserialize(i);r&&(this.addOrRebuild(r),r.enableEditing())}R(this,Ed,!1)}disable(){var r;R(this,gp,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const e=new Map,t=new Map;for(const s of d(this,Hr).values())if(s.disableEditing(),!!s.annotationElementId){if(s.serialize()!==null){e.set(s.annotationElementId,s);continue}else t.set(s.annotationElementId,s);(r=this.getEditableAnnotation(s.annotationElementId))==null||r.show(),s.remove()}if(d(this,Ia)){const s=d(this,Ia).getEditableAnnotations();for(const a of s){const{id:o}=a.data;if(d(this,Pe).isDeletedAnnotationElement(o))continue;let l=t.get(o);if(l){l.resetAnnotationElement(a),l.show(!1),a.show();continue}l=e.get(o),l&&(d(this,Pe).addChangedExistingAnnotation(l),l.renderAnnotationElement(a)&&l.show(!1)),a.show()}}z(this,Ut,z0).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:i}=this.div;for(const s of d(gs,Jl).values())i.remove(`${s._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),R(this,gp,!1)}getEditableAnnotation(e){var t;return((t=d(this,Ia))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){d(this,Pe).getActive()!==e&&d(this,Pe).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=d(this,pi))!=null&&e.div&&!d(this,$o)){R(this,$o,new AbortController);const t=d(this,Pe).combinedSignal(d(this,$o));d(this,pi).div.addEventListener("pointerdown",z(this,Ut,a5).bind(this),{signal:t}),d(this,pi).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=d(this,pi))!=null&&e.div&&d(this,$o)&&(d(this,$o).abort(),R(this,$o,null),d(this,pi).div.classList.remove("highlighting"))}enableClick(){if(d(this,Xl))return;R(this,Xl,new AbortController);const e=d(this,Pe).combinedSignal(d(this,Xl));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=d(this,Xl))==null||e.abort(),R(this,Xl,null)}attach(e){d(this,Hr).set(e.id,e);const{annotationElementId:t}=e;t&&d(this,Pe).isDeletedAnnotationElement(t)&&d(this,Pe).removeDeletedAnnotationElement(e)}detach(e){var t;d(this,Hr).delete(e.id),(t=d(this,xd))==null||t.removePointerInTextLayer(e.contentDiv),!d(this,gp)&&e.annotationElementId&&d(this,Pe).addDeletedAnnotationElement(e)}remove(e){this.detach(e),d(this,Pe).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(d(this,Pe).addDeletedAnnotationElement(e.annotationElementId),Yt.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),d(this,Pe).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!d(this,Ed)),d(this,Pe).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var i;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!d(this,Co)&&(e._focusEventsAllowed=!1,R(this,Co,setTimeout(()=>{R(this,Co,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:d(this,Pe)._signal}),t.focus())},0))),e._structTreeParentId=(i=d(this,xd))==null?void 0:i.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),i=()=>{e.remove()};this.addCommands({cmd:t,undo:i,mustExec:!1})}getNextId(){return d(this,Pe).getId()}combinedSignal(e){return d(this,Pe).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=d(this,Ut,la))==null?void 0:e.canCreateNewEmptyEditor()}pasteEditor(e,t){d(this,Pe).updateToolbar(e),d(this,Pe).updateMode(e);const{offsetX:i,offsetY:r}=z(this,Ut,o2).call(this),s=this.getNextId(),a=z(this,Ut,a2).call(this,{parent:this,id:s,x:i,y:r,uiManager:d(this,Pe),isCentered:!0,...t});a&&this.add(a)}async deserialize(e){var t;return await((t=d(gs,Jl).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,d(this,Pe)))||null}createAndAddNewEditor(e,t,i={}){const r=this.getNextId(),s=z(this,Ut,a2).call(this,{parent:this,id:r,x:e.offsetX,y:e.offsetY,uiManager:d(this,Pe),isCentered:t,...i});return s&&this.add(s),s}addNewEditor(){this.createAndAddNewEditor(z(this,Ut,o2).call(this),!0)}setSelected(e){d(this,Pe).setSelected(e)}toggleSelected(e){d(this,Pe).toggleSelected(e)}unselect(e){d(this,Pe).unselect(e)}pointerup(e){var i;const{isMac:t}=Di.platform;if(!(e.button!==0||e.ctrlKey&&t)&&e.target===this.div&&d(this,Ql)&&(R(this,Ql,!1),!((i=d(this,Ut,la))!=null&&i.isDrawer&&d(this,Ut,la).supportMultipleDrawings))){if(!d(this,mp)){R(this,mp,!0);return}if(d(this,Pe).getMode()===Ye.STAMP){d(this,Pe).unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){var r;if(d(this,Pe).getMode()===Ye.HIGHLIGHT&&this.enableTextSelection(),d(this,Ql)){R(this,Ql,!1);return}const{isMac:t}=Di.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(R(this,Ql,!0),(r=d(this,Ut,la))!=null&&r.isDrawer){this.startDrawingSession(e);return}const i=d(this,Pe).getActive();R(this,mp,!i||i.isEmpty())}startDrawingSession(e){if(this.div.focus(),d(this,ks)){d(this,Ut,la).startDrawing(this,d(this,Pe),!1,e);return}d(this,Pe).setCurrentDrawingSession(this),R(this,ks,new AbortController);const t=d(this,Pe).combinedSignal(d(this,ks));this.div.addEventListener("blur",({relatedTarget:i})=>{i&&!this.div.contains(i)&&(R(this,ko,null),this.commitOrRemove())},{signal:t}),d(this,Ut,la).startDrawing(this,d(this,Pe),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&R(this,ko,t);return}d(this,ko)&&setTimeout(()=>{var t;(t=d(this,ko))==null||t.focus(),R(this,ko,null)},0)}endDrawingSession(e=!1){return d(this,ks)?(d(this,Pe).setCurrentDrawingSession(null),d(this,ks).abort(),R(this,ks,null),R(this,ko,null),d(this,Ut,la).endDrawing(e)):null}findNewParent(e,t,i){const r=d(this,Pe).findParent(t,i);return r===null||r===this?!1:(r.changeParent(e),!0)}commitOrRemove(){return d(this,ks)?(this.endDrawingSession(),!0):!1}onScaleChanging(){d(this,ks)&&d(this,Ut,la).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=d(this,Pe).getActive())==null?void 0:e.parent)===this&&(d(this,Pe).commitOrRemove(),d(this,Pe).setActiveEditor(null)),d(this,Co)&&(clearTimeout(d(this,Co)),R(this,Co,null));for(const i of d(this,Hr).values())(t=d(this,xd))==null||t.removePointerInTextLayer(i.contentDiv),i.setParent(null),i.isAttachedToDOM=!1,i.div.remove();this.div=null,d(this,Hr).clear(),d(this,Pe).removeLayer(this)}render({viewport:e}){this.viewport=e,Hd(this.div,e);for(const t of d(this,Pe).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){d(this,Pe).commitOrRemove(),z(this,Ut,z0).call(this);const t=this.viewport.rotation,i=e.rotation;if(this.viewport=e,Hd(this.div,{rotation:i}),t!==i)for(const r of d(this,Hr).values())r.rotate(i)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return d(this,Pe).viewParameters.realScale}};xd=new WeakMap,mp=new WeakMap,Ia=new WeakMap,Xl=new WeakMap,Co=new WeakMap,Hr=new WeakMap,Ql=new WeakMap,gp=new WeakMap,Ed=new WeakMap,ks=new WeakMap,ko=new WeakMap,pi=new WeakMap,$o=new WeakMap,Pe=new WeakMap,Jl=new WeakMap,Ut=new WeakSet,a5=function(e){d(this,Pe).unselectAll();const{target:t}=e;if(t===d(this,pi).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&d(this,pi).div.contains(t)){const{isMac:i}=Di.platform;if(e.button!==0||e.ctrlKey&&i)return;d(this,Pe).showAllEditors("highlight",!0,!0),d(this,pi).div.classList.add("free"),this.toggleDrawing(),Hb.startHighlighting(this,d(this,Pe).direction==="ltr",{target:d(this,pi).div,x:e.x,y:e.y}),d(this,pi).div.addEventListener("pointerup",()=>{d(this,pi).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:d(this,Pe)._signal}),e.preventDefault()}},la=function(){return d(gs,Jl).get(d(this,Pe).getMode())},a2=function(e){const t=d(this,Ut,la);return t?new t.prototype.constructor(e):null},o2=function(){const{x:e,y:t,width:i,height:r}=this.div.getBoundingClientRect(),s=Math.max(0,e),a=Math.max(0,t),o=Math.min(window.innerWidth,e+i),l=Math.min(window.innerHeight,t+r),u=(s+o)/2-e,c=(a+l)/2-t,[h,f]=this.viewport.rotation%180===0?[u,c]:[c,u];return{offsetX:h,offsetY:f}},z0=function(){for(const e of d(this,Hr).values())e.isEmpty()&&e.remove()},Le(gs,"_initialized",!1),F(gs,Jl,new Map([VS,t2,n2,Hb].map(e=>[e._editorType,e])));let s2=gs;var $s,G_,Ri,Ad,d1,o5,ja,u2,l5,c2;const ci=class ci{constructor({pageIndex:e}){F(this,ja);F(this,$s,null);F(this,G_,0);F(this,Ri,new Map);F(this,Ad,new Map);this.pageIndex=e}setParent(e){if(!d(this,$s)){R(this,$s,e);return}if(d(this,$s)!==e){if(d(this,Ri).size>0)for(const t of d(this,Ri).values())t.remove(),e.append(t);R(this,$s,e)}}static get _svgFactory(){return Ze(this,"_svgFactory",new VC)}draw(e,t=!1,i=!1){const r=Ti(this,G_)._++,s=z(this,ja,u2).call(this),a=ci._svgFactory.createElement("defs");s.append(a);const o=ci._svgFactory.createElement("path");a.append(o);const l=`path_p${this.pageIndex}_${r}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),t&&d(this,Ad).set(r,o);const u=i?z(this,ja,l5).call(this,a,l):null,c=ci._svgFactory.createElement("use");return s.append(c),c.setAttribute("href",`#${l}`),this.updateProperties(s,e),d(this,Ri).set(r,s),{id:r,clipPathId:`url(#${u})`}}drawOutline(e,t){const i=Ti(this,G_)._++,r=z(this,ja,u2).call(this),s=ci._svgFactory.createElement("defs");r.append(s);const a=ci._svgFactory.createElement("path");s.append(a);const o=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){const h=ci._svgFactory.createElement("mask");s.append(h),l=`mask_p${this.pageIndex}_${i}`,h.setAttribute("id",l),h.setAttribute("maskUnits","objectBoundingBox");const f=ci._svgFactory.createElement("rect");h.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const m=ci._svgFactory.createElement("use");h.append(m),m.setAttribute("href",`#${o}`),m.setAttribute("stroke","none"),m.setAttribute("fill","black"),m.setAttribute("fill-rule","nonzero"),m.classList.add("mask")}const u=ci._svgFactory.createElement("use");r.append(u),u.setAttribute("href",`#${o}`),l&&u.setAttribute("mask",`url(#${l})`);const c=u.cloneNode();return r.append(c),u.classList.add("mainOutline"),c.classList.add("secondaryOutline"),this.updateProperties(r,e),d(this,Ri).set(i,r),i}finalizeDraw(e,t){d(this,Ad).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var l;if(!t)return;const{root:i,bbox:r,rootClass:s,path:a}=t,o=typeof e=="number"?d(this,Ri).get(e):e;if(o){if(i&&z(this,ja,c2).call(this,o,i),r&&z(l=ci,d1,o5).call(l,o,r),s){const{classList:u}=o;for(const[c,h]of Object.entries(s))u.toggle(c,h)}if(a){const c=o.firstChild.firstChild;z(this,ja,c2).call(this,c,a)}}}updateParent(e,t){if(t===this)return;const i=d(this,Ri).get(e);i&&(d(t,$s).append(i),d(this,Ri).delete(e),d(t,Ri).set(e,i))}remove(e){d(this,Ad).delete(e),d(this,$s)!==null&&(d(this,Ri).get(e).remove(),d(this,Ri).delete(e))}destroy(){R(this,$s,null);for(const e of d(this,Ri).values())e.remove();d(this,Ri).clear(),d(this,Ad).clear()}};$s=new WeakMap,G_=new WeakMap,Ri=new WeakMap,Ad=new WeakMap,d1=new WeakSet,o5=function(e,[t,i,r,s]){const{style:a}=e;a.top=`${100*i}%`,a.left=`${100*t}%`,a.width=`${100*r}%`,a.height=`${100*s}%`},ja=new WeakSet,u2=function(){const e=ci._svgFactory.create(1,1,!0);return d(this,$s).append(e),e.setAttribute("aria-hidden",!0),e},l5=function(e,t){const i=ci._svgFactory.createElement("clipPath");e.append(i);const r=`clip_${t}`;i.setAttribute("id",r),i.setAttribute("clipPathUnits","objectBoundingBox");const s=ci._svgFactory.createElement("use");return i.append(s),s.setAttribute("href",`#${t}`),s.classList.add("clip"),r},c2=function(e,t){for(const[i,r]of Object.entries(t))r===null?e.removeAttribute(i):e.setAttribute(i,r)},F(ci,d1);let l2=ci;globalThis.pdfjsTestingUtils={HighlightOutliner:BS};Ue.AbortException;Ue.AnnotationEditorLayer;Ue.AnnotationEditorParamsType;Ue.AnnotationEditorType;Ue.AnnotationEditorUIManager;Ue.AnnotationLayer;Ue.AnnotationMode;Ue.ColorPicker;Ue.DOMSVGFactory;Ue.DrawLayer;Ue.FeatureTest;var jte=Ue.GlobalWorkerOptions;Ue.ImageKind;Ue.InvalidPDFException;Ue.MissingPDFException;Ue.OPS;Ue.OutputScale;Ue.PDFDataRangeTransport;Ue.PDFDateString;Ue.PDFWorker;Ue.PasswordResponses;Ue.PermissionFlag;Ue.PixelsPerInch;Ue.RenderingCancelledException;Ue.TextLayer;Ue.TouchManager;Ue.UnexpectedResponseException;Ue.Util;Ue.VerbosityLevel;Ue.XfaLayer;Ue.build;Ue.createValidAbsoluteUrl;Ue.fetchData;var Bte=Ue.getDocument;Ue.getFilenameFromUrl;Ue.getPdfFilenameFromUrl;Ue.getXfaPageViewport;Ue.isDataScheme;Ue.isPdfFile;Ue.noContextMenu;Ue.normalizeUnicode;Ue.setLayerDimensions;Ue.shadow;Ue.stopEvent;Ue.version;const Ute="/blood-report-fitness-evaluation-system/assets/pdf.worker-BgryrOlp.mjs";jte.workerSrc=Ute;const Hte=({onBack:n,user:e,initialViewReport:t})=>{const[i,r]=Ce.useState(null),[s,a]=Ce.useState(null),[o,l]=Ce.useState([]),[u,c]=Ce.useState(!1),[h,f]=Ce.useState(""),[m,y]=Ce.useState("hemoglobin"),[_,x]=Ce.useState(""),[v,w]=Ce.useState(null),[E,C]=Ce.useState(!1);Ce.useEffect(()=>{const M=e&&e.email?`reports_${e.email}`:`temp_reports_${Date.now()}`,se=localStorage.getItem(M);l(se?JSON.parse(se):[]),t&&a(t)},[e,t]);const D=M=>new Promise(se=>{const ue=new Image;ue.src=URL.createObjectURL(M),ue.onload=()=>{const ee=document.createElement("canvas"),ae=ee.getContext("2d");ee.width=ue.width,ee.height=ue.height,ae.drawImage(ue,0,0);const J=ae.getImageData(0,0,ee.width,ee.height),q=J.data,G=50,U=259*(G+255)/(255*(259-G));for(let Y=0;Y<q.length;Y+=4){const K=(q[Y]+q[Y+1]+q[Y+2])/3;let Z=U*(K-128)+128;Z<0&&(Z=0),Z>255&&(Z=255),q[Y]=Z,q[Y+1]=Z,q[Y+2]=Z}ae.putImageData(J,0,0),ee.toBlob(Y=>{se(Y)})}}),V=M=>{console.log("Processing Extracted Text (Gen-2 Engine)...");const se=M.split(`
`),ue={},ee=(J,q)=>{const G=[];for(let U=0;U<=q.length;U++)G[U]=[U];for(let U=0;U<=J.length;U++)G[0][U]=U;for(let U=1;U<=q.length;U++)for(let Y=1;Y<=J.length;Y++)q.charAt(U-1)===J.charAt(Y-1)?G[U][Y]=G[U-1][Y-1]:G[U][Y]=Math.min(G[U-1][Y-1]+1,Math.min(G[U][Y-1]+1,G[U-1][Y]+1));return G[q.length][J.length]},ae=(J,q)=>{const G=J.toLowerCase().replace(/[^a-z0-9]/g,""),U=q.toLowerCase().replace(/[^a-z0-9]/g,"");if(G.includes(U))return!0;const Y=U.length>5?2:1;return G.split(/(?:[a-z]+)/).filter(Z=>Z.length>=3).some(Z=>Math.abs(Z.length-U.length)<=Y&&ee(Z,U)<=Y)};se.forEach(J=>{const q=J.toLowerCase().trim();q&&Object.keys(wP).forEach(G=>{if(ue[G])return;if(wP[G].find(K=>{const Z=q.replace(/[^a-z0-9\s]/g,"");return Z.includes(K)?!0:K.split(" ").every(ge=>Z.includes(ge)||ae(Z,ge))})){const Z=q.replace(/[oO](?=\d)/g,"0").replace(new RegExp("(?<=\\d)[oO]","g"),"0").replace(/\.\./g,".").replace(/,/g,".").match(/(\d+\.?\d*)/g);if(Z){const ge=Z.find(ve=>{let Q=parseFloat(ve);if(isNaN(Q)||Q>1900&&Q<2100&&G!=="total_count"||Q===0&&G!=="basophil")return!1;const be=zg[G];if(be){Q>be.max*5&&(Q=Q/10),Q>be.max*5&&(Q=Q/10);const vt=be.min*.1,mt=be.max*10;return Q>=vt&&Q<=mt}return!0});ge&&(ue[G]=parseFloat(ge))}}})}),Object.keys(ue).length===0&&M.length>50&&console.warn("No values extracted despite text content."),I(ue)},I=async M=>{const se=Iz(M);let ue=[];try{ue=await VZ(M)}catch(ee){console.error("ML Error:",ee)}j({date:new Date().toLocaleDateString(),values:M,risks:se,mlPredictions:ue}),c(!1),f("")},k=async M=>{c(!0),f("Reading PDF...");try{const se=await M.arrayBuffer(),ue=await Bte(se).promise;let ee="";for(let ae=1;ae<=ue.numPages;ae++){f(`Scanning Page ${ae} of ${ue.numPages}...`);const J=await ue.getPage(ae),G=(await J.getTextContent()).items.map(U=>U.str).join(`
`);if(G.length>50)console.log(`Page ${ae}: Digital text found.`),ee+=G+`
`;else{console.log(`Page ${ae}: Scanned image detected. Using OCR.`);const U=J.getViewport({scale:2.5}),Y=document.createElement("canvas"),K=Y.getContext("2d");Y.height=U.height,Y.width=U.width,await J.render({canvasContext:K,viewport:U}).promise;const Z=await new Promise(ge=>Y.toBlob(ge,"image/png"));if(Z){const{data:{text:ge}}=await DT.recognize(Z,"eng",{logger:()=>{}});ee+=ge+`
`}}}ee.length>20?(f("Analyzing compiled report..."),V(ee)):(alert("Could not extract meaningful text from this PDF."),c(!1))}catch(se){console.error(se),alert("Error processing PDF: "+se.message),c(!1)}},N=async(M,se=!1)=>{c(!0),f(se?"Scanning PDF Image...":"Applying Digital Lens...");try{const ee=!se&&E?await D(M):M;f("Scanning Text (AI)...");const{data:{text:ae}}=await DT.recognize(ee,"eng",{logger:J=>f(`${J.status} (${Math.round(J.progress*100)}%)`)});V(ae)}catch(ue){console.error(ue),alert("Error scanning image."),c(!1)}},L=M=>{const se=M.target.files[0];se&&(se.type==="application/pdf"?k(se):se.type.startsWith("image/")?(r(se),N(se)):alert("Please upload an Image (JPG/PNG) or PDF report."))},j=M=>{const se=Cz(M.values,M.risks);M.mlPredictions&&(se.mlPredictions=M.mlPredictions),a(se);const ue=e&&e.email?`reports_${e.email}`:`temp_reports_${Date.now()}`,ee=JSON.parse(localStorage.getItem(ue)||"[]"),ae=[se,...ee];l(ae),localStorage.setItem(ue,JSON.stringify(ae))},H=M=>{var ae,J;if(M.preventDefault(),!_)return;const se=parseFloat(_),ue=zg[m];let ee="Normal";se<ue.min&&(ee="Low"),se>ue.max&&(ee="High"),w({parameter:m,value:se,unit:ue.unit,range:`${ue.min}-${ue.max}`,status:ee,foods:ue.foods,fitnessImpact:ee==="Low"?(ae=ue.impact)==null?void 0:ae.low:ee==="High"?(J=ue.impact)==null?void 0:J.high:null})};return S.jsxs("div",{className:"blood-container fade-in",children:[S.jsxs("div",{className:"header-row",children:[S.jsx("button",{onClick:n,className:"back-btn",children:S.jsx(Xo,{size:24})}),S.jsx("h2",{children:"Blood Evaluation"})]}),s?S.jsxs("div",{className:"results-section fade-in",children:[S.jsxs("div",{className:"results-header",children:[S.jsx("h3",{children:"Report Analysis"}),S.jsx("button",{className:"text-btn",onClick:()=>a(null),children:"Close"})]}),s.mlPredictions&&S.jsx(jZ,{predictions:s.mlPredictions}),s.risks&&s.risks.length>0&&S.jsxs("div",{className:"risk-container fade-up",children:[S.jsx("h4",{children:" AI Health Risk Detection"}),S.jsx("div",{className:"risk-grid",children:s.risks.map((M,se)=>S.jsxs("div",{className:"risk-card",style:{borderLeft:`4px solid ${M.color}`},children:[S.jsxs("div",{className:"risk-header",children:[S.jsx("span",{className:"condition-title",children:M.condition}),S.jsx("span",{className:"risk-badge",style:{background:M.color},children:M.risk})]}),S.jsx("p",{className:"risk-advice",children:M.advice}),S.jsx("button",{className:"view-details",onClick:()=>alert(`Detailed explanation for ${M.condition}: 

This condition was flagged based on your values. Please consult a doctor for verification.`),children:"View Details"})]},se))})]}),S.jsx("div",{className:"params-list",children:s.results.map((M,se)=>S.jsxs("div",{className:"param-card",children:[S.jsxs("div",{className:"param-header",children:[S.jsx("h4",{children:M.parameter.replace(/_/g," ").toUpperCase()}),S.jsxs("span",{className:`status-badge ${M.status.toLowerCase()}`,children:[M.status==="Normal"&&S.jsx(QX,{size:14}),M.status==="High"&&S.jsx(qX,{size:14}),M.status==="Low"&&S.jsx(vz,{size:14}),M.status]})]}),S.jsxs("div",{className:"param-value",children:[S.jsx("span",{className:"val",children:M.value}),S.jsx("span",{className:"unit",children:M.unit})]}),S.jsxs("p",{className:"range-info",children:["Ref Range: ",M.range]})]},se))}),s.suggestions.length>0&&S.jsxs("div",{className:"suggestions-box",children:[S.jsx("h3",{children:" Health & Fitness Recommendations"}),s.suggestions.map((M,se)=>S.jsxs("div",{className:"suggestion-item",children:[S.jsx("div",{className:"suggestion-header",children:S.jsxs("strong",{children:[M.status," ",M.parameter.replace(/_/g," ").toUpperCase()]})}),M.foods.length>0&&S.jsxs("p",{className:"food-list",children:[" ",S.jsx("b",{children:"Diety Tip:"})," Eat ",M.foods.join(", ")]}),M.fitnessImpact&&S.jsxs("p",{className:"fitness-list",children:[" ",S.jsx("b",{children:"Fitness Impact:"})," ",M.fitnessImpact]})]},se))]})]}):S.jsxs("div",{className:"main-content",children:[S.jsxs("div",{className:"card manual-card",children:[S.jsx("h3",{children:"Quick Check"}),S.jsx("p",{className:"sub-label",children:"Enter a single value to check results instantly."}),S.jsxs("form",{onSubmit:H,className:"manual-form",children:[S.jsxs("div",{className:"row",children:[S.jsx("select",{className:"input-field",value:m,onChange:M=>{y(M.target.value),w(null)},children:Object.keys(zg).map(M=>S.jsx("option",{value:M,children:M.replace(/_/g," ").toUpperCase()},M))}),S.jsx("input",{type:"number",step:"0.1",className:"input-field",placeholder:"Value",value:_,onChange:M=>x(M.target.value),required:!0})]}),S.jsxs("button",{type:"submit",className:"btn-primary small-btn",children:["Check ",S.jsx(sQ,{size:16})]})]}),v&&S.jsxs("div",{className:"manual-result fade-in",children:[S.jsx("div",{className:`result-badge ${v.status.toLowerCase()}`,children:v.status}),S.jsxs("p",{className:"result-text",children:[S.jsxs("strong",{children:[v.parameter.replace(/_/g," ").toUpperCase(),":"]})," ",v.value," ",v.unit,S.jsx("br",{}),S.jsxs("span",{className:"text-muted",children:["Normal: ",v.range]})]}),v.status!=="Normal"&&v.foods.length>0&&S.jsxs("div",{className:"diet-tip",children:[S.jsx("strong",{children:"Tip:"})," Eat ",v.foods.join(", ")]}),v.fitnessImpact&&S.jsxs("div",{className:"fitness-tip",children:[S.jsx("strong",{children:"Fitness Impact:"})," ",v.fitnessImpact]})]})]}),S.jsx("div",{className:"divider",children:"OR"}),S.jsxs("div",{className:"upload-card",children:[S.jsx("div",{className:"icon-circle",children:S.jsx(bz,{size:32,color:"var(--color-primary)"})}),S.jsx("h3",{children:"Upload Report Image"}),S.jsx("p",{children:"Take a clear photo of your report. AI will scan for values."}),S.jsx("div",{style:{marginBottom:"15px"},children:S.jsxs("label",{className:"checkbox-container",children:[S.jsx("input",{type:"checkbox",checked:E,onChange:M=>C(M.target.checked)}),S.jsx("span",{className:"checkmark"}),"Enable Digital Lens (Enhance Image)"]})}),S.jsxs("label",{className:"btn-secondary upload-btn",children:[u?h||"Scanning...":"Select Image (JPG/PNG)",S.jsx("input",{type:"file",accept:"image/*,application/pdf",hidden:!0,onChange:L,disabled:u})]})]}),o.length>0&&S.jsxs("div",{className:"history-section",children:[S.jsx("h3",{children:"Recent Reports"}),o.map((M,se)=>S.jsxs("div",{className:"history-item",onClick:()=>a(M),children:[S.jsx(eC,{size:18,className:"text-muted"}),S.jsx("span",{children:M.date}),S.jsx("span",{className:"arrow",children:""})]},se))]})]}),S.jsx("style",{children:`
        .blood-container {
           padding: var(--spacing-md);
        }
        /* ... Existing Styles ... */
        /* Risk Styles */
        .risk-container {
            background: #fffafa; border: 1px solid #fee2e2; padding: 15px; border-radius: 12px; margin-bottom: 20px;
        }
        .risk-container h4 { color: #b91c1c; margin-top: 0; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        .risk-grid { display: flex; flex-direction: column; gap: 10px; }
        .risk-card { background: white; padding: 12px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .risk-header { display: flex; justify-content: space-between; margin-bottom: 5px; align-items: center; }
        .condition-title { font-weight: 700; color: #1f2937; }
        .risk-badge { font-size: 10px; color: white; padding: 2px 8px; border-radius: 99px; font-weight: 700; text-transform: uppercase; }
        .risk-advice { font-size: 13px; color: #4b5563; margin: 0; line-height: 1.4; }
        .view-details { margin-top: 8px; font-size: 11px; background: white; border: 1px solid #e5e7eb; padding: 4px 10px; border-radius: 4px; cursor: pointer; }
        
        .header-row {
           display: flex;
           align-items: center;
           gap: var(--spacing-md);
           margin-bottom: var(--spacing-lg);
        }
        .back-btn, .text-btn {
           background: transparent;
           color: var(--color-text-main);
           padding: 0;
           font-weight: 600;
        }

        .card {
           background: white;
           padding: var(--spacing-md);
           border-radius: var(--radius-md);
           box-shadow: var(--shadow-sm);
           margin-bottom: var(--spacing-lg);
        }

        /* Manual Entry */
        .manual-card h3 { font-size: var(--font-size-base); margin-bottom: 5px; }
        .sub-label { font-size: 12px; color: var(--color-text-secondary); margin-bottom: 15px; }
        .manual-form {
           display: flex;
           flex-direction: column;
           gap: 10px;
        }
        .manual-form .row { display: flex; gap: 10px; }
        .manual-form .input-field { 
            padding: 10px; 
            border: 1px solid #e2e8f0; 
            border-radius: var(--radius-sm); 
            flex: 1;
            font-size: 14px;
        }
        .small-btn { padding: 10px; width: 100%; display: flex; justify-content: center; gap: 8px; }

        .manual-result {
            margin-top: 15px;
            padding: 10px;
            background: #f8fafc;
            border-radius: var(--radius-sm);
            border-left: 3px solid var(--color-text-muted);
        }
        .result-badge {
            display: inline-block;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 99px;
            margin-bottom: 5px;
            text-transform: uppercase;
        }
        .result-badge.normal { background: #dcfce7; color: #166534; border-color: #166534; }
        .result-badge.high { background: #fee2e2; color: #991b1b; }
        .result-badge.low { background: #fef9c3; color: #854d0e; }
        
        .diet-tip { margin-top: 8px; font-size: 12px; color: #155724; background: #d4edda; padding: 5px; border-radius: 4px; }

        .divider { text-align: center; color: var(--color-text-muted); font-size: 12px; margin: 20px 0; font-weight: bold; }

        .upload-card {
           text-align: center;
           padding: 20px;
           background: #F8F9FA;
           border: 1px dashed #cbd5e1;
           border-radius: var(--radius-lg);
        }
        .icon-circle {
           width: 60px; height: 60px;
           background: #eef2ff;
           border-radius: 50%;
           display: flex; align-items: center; justify-content: center;
           margin: 0 auto 15px;
        }
        .upload-btn {
           display: inline-block;
           margin-top: 15px;
           font-size: 14px;
           padding: 8px 16px;
           background: white; border: 1px solid #e2e8f0; border-radius: 99px;
        }

        .results-header {
           display: flex; justify-content: space-between; align-items: center;
           margin-bottom: 20px;
        }
        .params-list { display: grid; gap: 10px; }
        .param-card {
           background: white; padding: 15px; border-radius: var(--radius-md); box-shadow: var(--shadow-sm);
        }
        .param-header { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .status-badge { font-size: 10px; padding: 2px 8px; border-radius: 99px; font-weight: bold; float: right; }
        .status-badge.normal { background: #dcfce7; color: #166534; }
        .status-badge.high { background: #fee2e2; color: #991b1b; }
        .status-badge.low { background: #fef9c3; color: #854d0e; }

        .param-value .val { font-size: 18px; font-weight: bold; margin-right: 5px; }
        .param-value .unit { font-size: 12px; color: #64748b; }
        .range-info { font-size: 10px; color: #94a3b8; margin-top: 2px; }

        .suggestions-box { margin-top: 20px; background: #fffbeb; padding: 15px; border-radius: var(--radius-md); border-left: 4px solid #f59e0b; }
        .suggestions-box h3 { font-size: 14px; margin-bottom: 12px; color: #92400e; display: flex; align-items: center; gap: 8px; }
        .suggestion-item { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #fef3c7; }
        .suggestion-item:last-child { border-bottom: none; }
        .suggestion-header { margin-bottom: 6px; color: #92400e; }
        .food-list, .fitness-list { font-size: 11px; margin-top: 4px; line-height: 1.4; color: #78350f; }
        .fitness-list { font-style: italic; color: #b45309; }
        .fitness-tip { margin-top: 8px; font-size: 11px; color: #b45309; background: #fffbeb; padding: 8px; border-radius: 4px; border: 1px dashed #f59e0b; }

        .scan-mode-toggle {
            display: flex; justify-content: center; gap: 10px; margin: 15px 0;
        }
        .mode-btn {
            padding: 6px 12px;
            font-size: 12px;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 99px;
            cursor: pointer;
            position: relative;
        }
        .mode-btn.active {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }
        .dot {
            width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-left: 5px;
        }
        .dot.online { background: #22c55e; }
        .dot.offline { background: #ef4444; }
      `})]})},Fw={breakfast:[{name:"Puttu & Kadala Curry",cal:450},{name:"Appam & Egg Roast",cal:400},{name:"Idli & Sambar",cal:300},{name:"Dosa & Chutney",cal:350},{name:"Oats Upma",cal:250}],lunch:[{name:"Kerala Rice Meals with Fish Curry",cal:650},{name:"Red Rice, Thoran & Curd",cal:500},{name:"Biriyani (Chicken)",cal:800},{name:"Kanji & Payar",cal:400}],snack:[{name:"Banana Fry (Pazham Pori) - 2 pcs",cal:300},{name:"Tea & Vada",cal:250},{name:"Fruit Salad",cal:150},{name:"Nuts & Dates",cal:200}],dinner:[{name:"Chapati & Veg Curry",cal:400},{name:"Wheat Porotta & Chicken",cal:600},{name:"Kanji (Rice Gruel)",cal:300},{name:"Salad & Grilled Fish",cal:350}]},Wte=({userProfile:n,onBack:e})=>{const[t,i]=Ce.useState(null),[r,s]=Ce.useState(0),[a,o]=Ce.useState(null);Ce.useEffect(()=>{t&&n&&u()},[t]);const l=()=>{if(!n)return 2e3;const{weight:c,heightCm:h,age:f,gender:m}=n;let y=10*c+6.25*h-5*f;m==="male"?y+=5:y-=161;let _=Math.round(y*1.375);return t==="loss"?_-500:t==="gain"?_+500:_},u=()=>{const c=l();s(c);const h=f=>f[Math.floor(Math.random()*f.length)];o({breakfast:h(Fw.breakfast),lunch:h(Fw.lunch),snack:h(Fw.snack),dinner:h(Fw.dinner)})};return S.jsxs("div",{className:"fitness-container fade-in",children:[S.jsxs("div",{className:"header-row",children:[S.jsx("button",{onClick:e,className:"back-btn",children:S.jsx(Xo,{size:24})}),S.jsx("h2",{children:"Fitness Helper"})]}),t?S.jsxs("div",{className:"plan-view fade-in",children:[S.jsxs("div",{className:"summary-card",children:[S.jsxs("div",{className:"cal-target",children:[S.jsx("span",{className:"label",children:"Daily Target"}),S.jsx("h1",{children:r}),S.jsx("span",{className:"unit",children:"kcal"})]}),S.jsx("div",{className:"goal-badge",children:t==="loss"?"Weight Loss":t==="gain"?"Weight Gain":"Maintain"}),S.jsx("button",{className:"change-btn",onClick:()=>i(null),children:"Change Goal"})]}),S.jsxs("div",{className:"meals-list",children:[S.jsx("h3",{children:" Today's Kerala Diet Plan"}),a&&S.jsxs(S.Fragment,{children:[S.jsx(zw,{type:"Breakfast",icon:S.jsx(fP,{size:18}),data:a.breakfast}),S.jsx(zw,{type:"Lunch",icon:S.jsx(Fg,{size:18}),data:a.lunch}),S.jsx(zw,{type:"Snack",icon:S.jsx(fP,{size:18}),data:a.snack}),S.jsx(zw,{type:"Dinner",icon:S.jsx(Fg,{size:18}),data:a.dinner})]})]})]}):S.jsxs("div",{className:"goal-selection",children:[S.jsx("h3",{children:"What is your goal?"}),S.jsxs("button",{className:"goal-card",onClick:()=>i("loss"),children:[S.jsx("div",{className:"icon-box loss",children:S.jsx(oQ,{size:24})}),S.jsxs("div",{className:"text",children:[S.jsx("h4",{children:"Weight Loss"}),S.jsx("p",{children:"Reduce body fat locally."})]})]}),S.jsxs("button",{className:"goal-card",onClick:()=>i("maintain"),children:[S.jsx("div",{className:"icon-box maintain",children:S.jsx(fQ,{size:24})}),S.jsxs("div",{className:"text",children:[S.jsx("h4",{children:"Maintain Weight"}),S.jsx("p",{children:"Stay healthy and fit."})]})]}),S.jsxs("button",{className:"goal-card",onClick:()=>i("gain"),children:[S.jsx("div",{className:"icon-box gain",children:S.jsx(Fg,{size:24})}),S.jsxs("div",{className:"text",children:[S.jsx("h4",{children:"Weight Gain"}),S.jsx("p",{children:"Build muscle mass."})]})]})]}),S.jsx("style",{children:`
        .fitness-container {
           padding: var(--spacing-md);
        }
        .header-row {
           display: flex;
           align-items: center;
           gap: var(--spacing-md);
           margin-bottom: var(--spacing-xl);
        }
        .back-btn {
           background: transparent;
           color: var(--color-text-main);
           padding: 0;
        }
        .goal-selection {
           display: flex;
           flex-direction: column;
           gap: var(--spacing-md);
        }
        .goal-selection h3 {
           text-align: center;
           margin-bottom: var(--spacing-md);
        }
        .goal-card {
           display: flex;
           align-items: center;
           gap: var(--spacing-md);
           background: white;
           padding: var(--spacing-md);
           border-radius: var(--radius-lg);
           box-shadow: var(--shadow-sm);
           text-align: left;
           width: 100%;
           transition: transform 0.2s;
        }
        .goal-card:active { transform: scale(0.98); }
        .icon-box {
           width: 50px;
           height: 50px;
           border-radius: var(--radius-md);
           display: flex;
           align-items: center;
           justify-content: center;
           color: white;
        }
        .icon-box.loss { background: #FF6B6B; }
        .icon-box.maintain { background: #4CC9F0; }
        .icon-box.gain { background: #4ECDC4; }
        
        .summary-card {
           background: linear-gradient(135deg, #1D3557 0%, #457B9D 100%);
           color: white;
           padding: var(--spacing-lg);
           border-radius: var(--radius-lg);
           text-align: center;
           margin-bottom: var(--spacing-xl);
           box-shadow: var(--shadow-md);
           position: relative;
        }
        .cal-target h1 {
           font-size: 3rem;
           line-height: 1;
           margin: 10px 0;
        }
        .change-btn {
           position: absolute;
           top: 10px;
           right: 10px;
           background: rgba(255,255,255,0.2);
           color: white;
           font-size: 10px;
           padding: 4px 8px;
           border-radius: var(--radius-full);
        }

        .meals-list h3 {
           margin-bottom: var(--spacing-md);
        }
        .meal-card {
           background: white;
           padding: var(--spacing-md);
           border-radius: var(--radius-md);
           margin-bottom: var(--spacing-sm);
           box-shadow: var(--shadow-sm);
           display: flex;
           justify-content: space-between;
           align-items: center;
        }
        .meal-info h4 {
           font-size: var(--font-size-sm);
           color: var(--color-text-secondary);
           margin-bottom: 2px;
           display: flex;
           align-items: center;
           gap: 6px;
        }
        .meal-info p {
           font-weight: 600;
           color: var(--color-text-main);
        }
        .meal-cal {
           font-size: var(--font-size-sm);
           color: var(--color-primary);
           font-weight: bold;
        }
      `})]})},zw=({type:n,icon:e,data:t})=>S.jsxs("div",{className:"meal-card",children:[S.jsxs("div",{className:"meal-info",children:[S.jsxs("h4",{children:[e," ",n]}),S.jsx("p",{children:t.name})]}),S.jsxs("div",{className:"meal-cal",children:[t.cal," kcal"]})]}),qte=[{id:1,name:"Jumping Jacks",calories:"10-15 cal/min",duration:"1 min",desc:"Full body cardio warm-up.",steps:["Stand with feet together, hands at sides.","Jump legs apart and raise arms overhead.","Jump back to starting position.","Repeat quickly."]},{id:2,name:"Push-ups",calories:"0.3-0.6 cal/rep",duration:"15-20 reps",desc:"Strengthens chest, shoulders, and triceps.",steps:["Start in plank position.","Lower chest to floor.","Push back up strongly.","Keep core tight."]},{id:3,name:"Plank",calories:"3-4 cal/min",duration:"30-45 sec",desc:"Core stability and abdominal strength.",steps:["Rest on forearms and toes.","Keep body in straight line.","Hold selection tight.","Breathe normally."]},{id:4,name:"Squats",calories:"0.3-0.5 cal/rep",duration:"20 reps",desc:"Legs and glutes builder.",steps:["Stand feet shoulder-width apart.","Lower hips like sitting in a chair.","Keep chest up.","Return to standing."]},{id:5,name:"Lunges",calories:"0.5 cal/rep",duration:"15 reps/leg",desc:"Balance and leg strength.",steps:["Step forward with one leg.","Lower hips until both knees are 90.","Push back to start.","Switch legs."]},{id:6,name:"Burpees",calories:"10-15 cal/min",duration:"10-15 reps",desc:"High intensity full body calorie burner.",steps:["Squat down.","Kick feet back to plank.","Do a push-up.","Jump feet forward and jump up."]},{id:7,name:"High Knees",calories:"7-9 cal/min",duration:"1 min",desc:"Cardio and core engagement.",steps:["Run in place.","Lift knees as high as possible.","Pump arms.","Keep a fast pace."]},{id:8,name:"Mountain Climbers",calories:"8-10 cal/min",duration:"45 sec",desc:"Cardio, core, and arm endurance.",steps:["Start in plank.","Drive one knee to chest.","Switch legs quickly.","Keep hips down."]}],Gte=({onBack:n})=>{const[e,t]=Ce.useState(null);return S.jsxs("div",{className:"workout-container fade-in",children:[S.jsxs("div",{className:"header-row",children:[S.jsx("button",{onClick:n,className:"back-btn",children:S.jsx(Xo,{size:24})}),S.jsx("h2",{children:"Home Workouts"})]}),S.jsxs("div",{className:"info-card",children:[S.jsx("div",{className:"intro-icon",children:S.jsx(pP,{size:28,color:"#FF6B6B"})}),S.jsx("p",{children:"Burn calories with these 8 basic home exercises. No equipment needed!"})]}),S.jsx("div",{className:"workout-list",children:qte.map(i=>S.jsxs("div",{className:"workout-card",children:[S.jsxs("div",{className:"w-header",children:[S.jsx("h3",{children:i.name}),S.jsxs("span",{className:"cal-badge",children:[S.jsx(pP,{size:12,fill:"currentColor"})," ",i.calories]})]}),S.jsx("p",{className:"w-desc",children:i.desc}),S.jsxs("div",{className:"w-footer",children:[S.jsxs("span",{className:"duration",children:[S.jsx(lQ,{size:14})," ",i.duration]}),S.jsx("button",{className:"start-btn",onClick:()=>t(i),children:"Steps"})]})]},i.id))}),e&&S.jsx("div",{className:"modal-overlay fade-in",onClick:()=>t(null),children:S.jsxs("div",{className:"modal-content",onClick:i=>i.stopPropagation(),children:[S.jsx("button",{className:"close-btn",onClick:()=>t(null),children:S.jsx(hQ,{size:24})}),S.jsxs("div",{className:"modal-header",children:[S.jsx("h3",{children:e.name}),S.jsx("span",{className:"cal-pill",children:e.calories})]}),(()=>{const r={"Jumping Jacks":"iSSAk4XCsRA",Squats:"YaXPRqUwItQ","Push-ups":"IODxDxX7oi4",Burpees:"dZgVxmf6jkA","High Knees":"oDdkytliOqE",Lunges:"QOVaHwm-Q6U",Plank:"pSHjTRCQxIw","Mountain Climbers":"zT-9L3CEcmk"}[e.name]||"UpH7rm0cYbM";return S.jsx("div",{style:{width:"100%",height:"220px",marginBottom:"20px",borderRadius:"12px",overflow:"hidden",background:"#000"},children:S.jsx("iframe",{width:"100%",height:"100%",src:`https://www.youtube.com/embed/${r}?autoplay=1&mute=1&loop=1&playlist=${r}&controls=0&showinfo=0&modestbranding=1`,title:"Workout Demonstration",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,style:{display:"block"}})})})(),S.jsxs("div",{className:"modal-body",children:[S.jsxs("h4",{children:[S.jsx(wz,{size:16})," How to do it:"]}),S.jsx("ul",{className:"steps-list",children:e.steps.map((i,r)=>S.jsxs("li",{children:[S.jsx("span",{className:"step-num",children:r+1}),i]},r))})]})]})}),S.jsx("style",{children:`
                .workout-container {
                    padding: var(--spacing-md);
                    padding-bottom: 40px;
                }
                .header-row {
                   display: flex;
                   align-items: center;
                   gap: var(--spacing-md);
                   margin-bottom: var(--spacing-lg);
                }
                .back-btn {
                   background: transparent;
                   color: var(--color-text-main);
                   padding: 0;
                }
                
                .info-card {
                    background: #FFF0F1;
                    padding: 15px;
                    border-radius: var(--radius-md);
                    margin-bottom: 20px;
                    display: flex;
                    align-items: center;
                    gap: 15px;
                    color: var(--color-text-main);
                    border: 1px solid #FFD1D1;
                }
                .intro-icon {
                    background: white;
                    padding: 10px;
                    border-radius: 50%;
                    box-shadow: var(--shadow-sm);
                }

                .workout-list {
                    display: flex;
                    flex-direction: column;
                    gap: 15px;
                }

                .workout-card {
                    background: white;
                    padding: 15px;
                    border-radius: var(--radius-md);
                    box-shadow: var(--shadow-sm);
                    transition: transform 0.2s;
                    border: 1px solid #f1f5f9;
                }
                .workout-card:hover {
                    transform: translateY(-2px);
                    box-shadow: var(--shadow-md);
                }

                .w-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 8px;
                }
                .w-header h3 {
                    font-size: 16px;
                    color: var(--color-text-main);
                }
                .cal-badge {
                    font-size: 11px;
                    background: #ffe4e6;
                    color: #be123c;
                    padding: 4px 8px;
                    border-radius: 99px;
                    display: flex;
                    align-items: center;
                    gap: 4px;
                    font-weight: 600;
                }

                .w-desc {
                    font-size: 12px;
                    color: var(--color-text-secondary);
                    margin-bottom: 15px;
                }

                .w-footer {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding-top: 10px;
                    border-top: 1px solid #f1f5f9;
                }
                .start-now-btn {
                    background: var(--color-primary);
                    color: white;
                    padding: 10px 20px;
                    border-radius: 99px;
                    font-weight: 600;
                    box-shadow: var(--shadow-md);
                }

                .modal-body h4 { display: flex; align-items: center; gap: 8px; font-size: 14px; margin-bottom: 10px; margin-top: 15px; color: var(--color-text-main); }
                .steps-list { list-style: none; padding: 0; }
                .steps-list li {
                    display: flex; gap: 10px;
                    font-size: 14px; color: var(--color-text-secondary);
                    margin-bottom: 12px;
                    line-height: 1.4;
                }
                .step-num {
                    background: #eef2ff; color: var(--color-primary);
                    font-weight: bold; font-size: 12px;
                    width: 20px; height: 20px;
                    border-radius: 50%;
                    display: flex; align-items: center; justify-content: center;
                    flex-shrink: 0;
                }
            `})]})},Kte=({onBack:n,userProfile:e})=>{const[t,i]=Ce.useState(()=>{if(!(e!=null&&e.email))return[];const h=localStorage.getItem(`weight_log_${e.email}`);return h?JSON.parse(h):[]}),[r,s]=Ce.useState(""),a=()=>{if(!r||isNaN(r))return;const h={weight:parseFloat(r),date:new Date().toISOString(),displayDate:new Date().toLocaleDateString()},f=[...t,h];i(f),e!=null&&e.email&&localStorage.setItem(`weight_log_${e.email}`,JSON.stringify(f)),s("")},l=(()=>{if(t.length<2)return{change:0,type:"neutral"};const h=t[t.length-1].weight,f=t[t.length-2].weight,m=h-f;return{change:Math.abs(m).toFixed(1),type:m>0?"gain":m<0?"loss":"neutral"}})(),u=(e==null?void 0:e.weight)||(t.length>0?t[0].weight:0),c=t.length>0?t[t.length-1].weight:u;return S.jsxs("div",{className:"weight-container fade-in",children:[S.jsxs("div",{className:"header-row",children:[S.jsx("button",{onClick:n,className:"back-btn",children:S.jsx(Xo,{size:24})}),S.jsx("h2",{children:"Weight Progress"})]}),S.jsxs("div",{className:"stats-card",children:[S.jsxs("div",{className:"stat-item",children:[S.jsx("span",{className:"label",children:"Starting Weight"}),S.jsxs("span",{className:"value",children:[u," kg"]})]}),S.jsx("div",{className:"divider"}),S.jsxs("div",{className:"stat-item",children:[S.jsx("span",{className:"label",children:"Current Weight"}),S.jsxs("span",{className:"value primary",children:[c," kg"]})]}),S.jsx("div",{className:"divider"}),S.jsxs("div",{className:"stat-item",children:[S.jsx("span",{className:"label",children:"Change"}),S.jsxs("span",{className:`value ${l.type}`,children:[l.type==="gain"&&S.jsx(dQ,{size:16}),l.type==="loss"&&S.jsx(cQ,{size:16}),l.type==="neutral"&&S.jsx(nQ,{size:16}),l.change," kg"]})]})]}),S.jsxs("div",{className:"input-section",children:[S.jsx("h3",{children:"Log Current Weight"}),S.jsxs("div",{className:"input-group",children:[S.jsx("input",{type:"number",placeholder:"Enter weight in kg",value:r,onChange:h=>s(h.target.value),step:"0.1"}),S.jsx("button",{className:"add-btn",onClick:a,children:"Add"})]})]}),S.jsxs("div",{className:"history-section",children:[S.jsx("h3",{children:"Weight History"}),t.length===0?S.jsxs("div",{className:"empty-state",children:[S.jsx(_z,{size:40,color:"#cbd5e1"}),S.jsx("p",{children:"No entries yet. Start logging your weight!"})]}):S.jsx("div",{className:"history-list",children:[...t].reverse().map((h,f)=>S.jsxs("div",{className:"history-item",children:[S.jsxs("div",{className:"date-badge",children:[S.jsx(XX,{size:14}),h.displayDate]}),S.jsxs("div",{className:"weight-display",children:[h.weight," kg"]})]},f))})]}),S.jsx("style",{children:`
                .weight-container {
                    padding: var(--spacing-md);
                    padding-bottom: 40px;
                }
                .header-row {
                   display: flex;
                   align-items: center;
                   gap: var(--spacing-md);
                   margin-bottom: 20px;
                }
                .back-btn { background: transparent; color: var(--color-text-main); padding: 0; }
                
                .stats-card {
                    background: white;
                    padding: 20px;
                    border-radius: var(--radius-lg);
                    box-shadow: var(--shadow-md);
                    display: flex;
                    justify-content: space-around;
                    margin-bottom: 25px;
                }
                .stat-item {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 5px;
                }
                .label {
                    font-size: 11px;
                    color: var(--color-text-muted);
                    text-transform: uppercase;
                }
                .value {
                    font-size: 18px;
                    font-weight: bold;
                    color: var(--color-text-main);
                    display: flex;
                    align-items: center;
                    gap: 4px;
                }
                .value.primary { color: var(--color-primary); }
                .value.gain { color: #f59e0b; }
                .value.loss { color: #10b981; }
                .value.neutral { color: #64748b; }
                .divider {
                    width: 1px;
                    background: #e2e8f0;
                    align-self: stretch;
                }

                .input-section {
                    background: white;
                    padding: 20px;
                    border-radius: var(--radius-lg);
                    box-shadow: var(--shadow-sm);
                    margin-bottom: 25px;
                }
                .input-section h3 {
                    font-size: 14px;
                    margin-bottom: 15px;
                    color: var(--color-text-main);
                }
                .input-group {
                    display: flex;
                    gap: 10px;
                }
                .input-group input {
                    flex: 1;
                    padding: 12px;
                    border: 1px solid #e2e8f0;
                    border-radius: var(--radius-md);
                    font-size: 14px;
                }
                .add-btn {
                    background: var(--color-primary);
                    color: white;
                    padding: 12px 24px;
                    border-radius: var(--radius-md);
                    font-weight: 600;
                    box-shadow: var(--shadow-sm);
                }

                .history-section h3 {
                    font-size: 14px;
                    margin-bottom: 15px;
                    color: var(--color-text-main);
                }
                .empty-state {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 10px;
                    padding: 40px 20px;
                    color: var(--color-text-muted);
                    font-size: 13px;
                }
                .history-list {
                    display: flex;
                    flex-direction: column;
                    gap: 10px;
                }
                .history-item {
                    background: white;
                    padding: 15px;
                    border-radius: var(--radius-md);
                    box-shadow: var(--shadow-sm);
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                .date-badge {
                    display: flex;
                    align-items: center;
                    gap: 5px;
                    font-size: 12px;
                    color: var(--color-text-secondary);
                }
                .weight-display {
                    font-size: 16px;
                    font-weight: bold;
                    color: var(--color-primary);
                }
            `})]})},Yte=[{q:"Best protein sources?",a:"Top protein sources: Eggs, Chicken Breast, Fish, Paneer, Lentils (Dal), Soy chunks, and Greek Yogurt."},{q:"Pre-workout snacks?",a:"Eat 30-60 mins before: Banana, Oats, Peanut butter toast, or a handful of Almonds."},{q:"How to build muscle?",a:"Focus on: 1. Resistance training (lifting weights), 2. High protein intake (1.6g per kg weight), 3. Progressive overload, 4. 7-8 hours sleep."},{q:"Weight loss tips?",a:"To lose weight: Maintain a calorie deficit, increase fiber intake, stay hydrated, and include consistent Zone 2 cardio."}],_O=["blood","report","diet","food","fitness","exercise","weight","bmi","sugar","cholesterol","protein","health","heart","hemoglobin","fat","muscle","gym","workout","yoga","sleep","water","cardio","calories","supplement","recovery","strength"],Xte=({onBack:n,userProfile:e})=>{const[t,i]=Ce.useState([{id:1,text:`Hello ${e!=null&&e.name?e.name.split(" ")[0]:""}! I'm your Health Assistant. Ask me about your blood report, diet, or workout.`,sender:"bot"}]),[r,s]=Ce.useState(""),[a,o]=Ce.useState(!1),l=Ce.useRef(null),u=()=>{var _;(_=l.current)==null||_.scrollIntoView({behavior:"smooth"})},[c,h]=Ce.useState([]);Ce.useEffect(()=>{if(e!=null&&e.email){const _=JSON.parse(localStorage.getItem(`reports_${e.email}`)||"[]");h(_)}u()},[t,e==null?void 0:e.email]);const f=_=>{const x=_.toLowerCase();if(x.includes("analyze")||x.includes("summary")||x.includes("my report")){if(c.length===0)return"I don't see any blood reports uploaded yet. specific values. You can upload one in the Blood Evaluation section!";const N=c[0],L=N.results.filter(H=>H.status!=="Normal");if(L.length===0)return"Your latest report looks perfect! All values are within the normal range. Keep it up! ";const j=L.map(H=>`${H.parameter} is ${H.status} (${H.value} ${H.unit})`).join(", ");return`Based on your latest report (${N.date}), here are some things to watch: ${j}. Would you like diet tips for any of these?`}const v=_O.find(N=>x.includes(N));if(v&&c.length>0){const L=c[0].results.find(j=>j.parameter.toLowerCase().includes(v));if(L)return`Your latest ${L.parameter} is ${L.value} ${L.unit}, which is ${L.status}. ${L.fitnessImpact||""}`}const w=e!=null&&e.diseases?e.diseases.toLowerCase():"",E=e!=null&&e.allergies?e.allergies.toLowerCase():"",C=(e==null?void 0:e.age)||"",D=(e==null?void 0:e.weight)||"",V=(e==null?void 0:e.bloodGroup)||"",I=(e==null?void 0:e.gender)||"";return!_O.some(N=>x.includes(N))&&!x.includes("hello")&&!x.includes("hi")?`I'm analyzing your health data... I can help with Blood Reports, Diet, and Fitness. Try asking "Analyze my report" or "How is my hemoglobin?".`:x.includes("my profile")||x.includes("my health")||x.includes("about me")?`You are a ${C}-year-old ${I} with Blood Group ${V}. Current weight: ${D}kg. Known conditions: ${w||"None"}. Allergies: ${E||"None"}.`:w.includes("diabetes")&&(x.includes("sugar")||x.includes("sweet")||x.includes("fruit"))?"Since you mentioned Diabetes, be very careful with high GI fruits like mangoes and chikoo. Opt for apples, berries, and papaya. Monitor your blood sugar regularly and avoid refined sugars completely.":(w.includes("hypertension")||w.includes("bp"))&&(x.includes("salt")||x.includes("diet"))?"For hypertension management, the DASH diet is recommended. Reduce sodium intake (salt), avoid pickles and papad, and increase potassium-rich foods like bananas and leafy greens.":x.includes("protein")?"Protein is the building block. vegetarians: Paneer, Dal, Soy. Non-veg: Chicken, Fish. "+(w.includes("kidney")?"However, since you have kidney concerns, please consult your doctor for the exact protein limit.":"Aim for 1.2g/kg body weight."):x.includes("pre-workout")||x.includes("before gym")?"A banana or oatmeal 45 mins before workout is great energy.":x.includes("post-workout")||x.includes("after gym")?"Post-workout, have a protein source (shake/chicken/eggs) within 45 mins to maximize recovery.":x.includes("muscle")?"Building muscle requires specific resistance training, protein surplus, and sleep. Consistency is key!":x.includes("cardio")?"Cardio improves heart health and burns calories. 150 mins/week is a good target.":x.includes("bmi")?"BMI is a rough indicator. "+(e!=null&&e.weight?`At ${e.weight}kg, your focus should be on body composition (muscle vs fat) rather than just the scale.`:"Check your weight-to-height ratio."):x.includes("diet")||x.includes("food")?E?`Given your allergies to ${E}, ensure you check food labels. Focus on whole, unprocessed foods.`:"A balanced diet with protein, good fats, and fiber is essential. Avoid processed foods.":x.includes("hemoglobin")?"Iron-rich foods (spinach, dates, red meat) help boost hemoglobin. Vitamin C helps absorption.":x.includes("sugar")?"Minimize added sugars. Natural sugars in whole fruits are generally okay in moderation.":x.includes("weight")?"Weight management is about Calorie In vs Calorie Out, quality of food, and hormonal balance.":x.includes("sleep")?"7-9 hours of sleep is non-negotiable for recovery and mental health.":"That's a good question. Based on general fitness guidelines, consistency in diet and exercise is 90% of the game. How is your sleep lately?"},m=_=>{if(_.preventDefault(),!r.trim())return;const x={id:Date.now(),text:r,sender:"user"};i(v=>[...v,x]),s(""),o(!0),setTimeout(()=>{const v={id:Date.now()+1,text:f(x.text),sender:"bot"};i(w=>[...w,v]),o(!1)},1200)},y=_=>{const x={id:Date.now(),text:_.q,sender:"user"};i(v=>[...v,x]),o(!0),setTimeout(()=>{const v={id:Date.now()+1,text:_.a,sender:"bot"};i(w=>[...w,v]),o(!1)},1200)};return S.jsxs("div",{className:"chat-container fade-in",children:[S.jsxs("div",{className:"header-row",children:[S.jsx("button",{onClick:n,className:"back-btn",children:S.jsx(Xo,{size:24})}),S.jsx("h2",{children:"Health Assistant"})]}),S.jsxs("div",{className:"chat-window",children:[t.map(_=>S.jsxs("div",{className:`message-row ${_.sender}`,children:[_.sender==="bot"&&S.jsx("div",{className:"avatar bot",children:S.jsx(hP,{size:16})}),S.jsx("div",{className:"message-bubble",children:_.text}),_.sender==="user"&&S.jsx("div",{className:"avatar user",children:S.jsx(xz,{size:16})})]},_.id)),a&&S.jsxs("div",{className:"message-row bot",children:[S.jsx("div",{className:"avatar bot",children:S.jsx(hP,{size:16})}),S.jsxs("div",{className:"message-bubble typing",children:[S.jsx("span",{children:"."}),S.jsx("span",{children:"."}),S.jsx("span",{children:"."})]})]}),S.jsx("div",{ref:l})]}),S.jsxs("div",{className:"input-section",children:[S.jsx("div",{className:"chips-row",children:Yte.map((_,x)=>S.jsx("button",{className:"chip",onClick:()=>y(_),disabled:a,children:_.q},x))}),S.jsxs("form",{onSubmit:m,className:"input-form",children:[S.jsx("input",{type:"text",value:r,onChange:_=>s(_.target.value),placeholder:"Ask about health...",className:"chat-input"}),S.jsx("button",{type:"submit",className:"send-btn",children:S.jsx(aQ,{size:20})})]})]}),S.jsx("style",{children:`
        .chat-container {
           padding: var(--spacing-md);
           display: flex;
           flex-direction: column;
           height: 100vh;
           max-height: 100vh;
        }
        .header-row {
           display: flex;
           align-items: center;
           gap: var(--spacing-md);
           margin-bottom: var(--spacing-md);
           flex-shrink: 0;
        }
        .back-btn {
           background: transparent;
           color: var(--color-text-main);
           padding: 0;
        }
        .chat-window {
           flex: 1;
           background: #f8fafc;
           border-radius: var(--radius-lg);
           padding: var(--spacing-md);
           overflow-y: auto;
           display: flex;
           flex-direction: column;
           gap: var(--spacing-md);
           margin-bottom: var(--spacing-md);
           border: 1px solid #e2e8f0;
        }
        .message-row {
           display: flex;
           align-items: flex-end;
           gap: 8px;
        }
        .message-row.user {
           justify-content: flex-end;
        }
        .avatar {
           width: 28px;
           height: 28px;
           border-radius: 50%;
           display: flex;
           align-items: center;
           justify-content: center;
           flex-shrink: 0;
        }
        .avatar.bot { background: #7209B7; color: white; }
        .avatar.user { background: var(--color-primary); color: white; }

        .message-bubble {
           max-width: 75%;
           padding: 10px 14px;
           border-radius: 12px;
           font-size: var(--font-size-sm);
           line-height: 1.4;
           box-shadow: var(--shadow-sm);
        }
        .bot .message-bubble {
           background: white;
           color: var(--color-text-main);
           border-bottom-left-radius: 4px;
        }
        .user .message-bubble {
           background: var(--color-primary);
           color: white;
           border-bottom-right-radius: 4px;
        }

        .input-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex-shrink: 0;
        }

        .chips-row {
           display: flex;
           overflow-x: auto;
           gap: 8px;
           padding-bottom: 5px;
           scrollbar-width: none;
        }
        .chip {
           white-space: nowrap;
           background: white;
           border: 1px solid var(--color-primary);
           color: var(--color-primary);
           padding: 6px 12px;
           border-radius: var(--radius-full);
           font-size: 11px;
           transition: all 0.2s;
        }
        .chip:hover {
           background: var(--color-primary);
           color: white;
        }

        .input-form {
            display: flex;
            gap: 10px;
            padding-bottom: 5px; /* for safe area */
        }
        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border-radius: 99px;
            border: 1px solid #cbd5e1;
            font-size: 14px;
            background: white;
        }
        .chat-input:focus { border-color: var(--color-primary); outline: none; }
        .send-btn {
            width: 46px; 
            height: 46px;
            background: var(--color-primary);
            color: white;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: var(--shadow-md);
        }

        .typing span {
           animation: blink 1.4s infinite both;
           margin: 0 1px;
        }
        .typing span:nth-child(2) { animation-delay: 0.2s; }
        .typing span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes blink {
           0% { opacity: 0.2; }
           20% { opacity: 1; }
           100% { opacity: 0.2; }
        }
      `})]})},Qte=({message:n,onClose:e})=>(Ce.useEffect(()=>{const t=setTimeout(()=>{e()},5e3);return()=>clearTimeout(t)},[e]),S.jsxs("div",{className:"toast-notification",children:[S.jsx("div",{className:"icon-bg",children:S.jsx(KX,{size:20})}),S.jsxs("div",{className:"content",children:[S.jsx("h4",{children:"Reminder"}),S.jsx("p",{children:n})]}),S.jsx("button",{onClick:e,className:"close-btn",children:""}),S.jsx("style",{children:`
         .toast-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            color: var(--color-text-main);
            padding: 12px 16px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            animation: slideIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            border-left: 4px solid var(--color-primary);
            max-width: 90vw;
         }
         
         .icon-bg {
            background: #FFF0F1;
            color: var(--color-primary);
            padding: 8px;
            border-radius: 50%;
            display: flex;
         }

         .content h4 {
            font-size: var(--font-size-sm);
            margin-bottom: 2px;
         }

         .content p {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
         }

         .close-btn {
            background: transparent;
            font-size: 20px;
            color: #999;
            margin-left: 8px;
         }

         @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
         }
       `})]})),vO=n=>{let e={breakfast:[{name:"Oatmeal with Walnuts & Apple",calories:350,carbs:"60g",protein:"12g",fat:"8g",benefits:["Heart Healthy","High Fiber"]},{name:"Egg Whites & Whole Wheat Toast",calories:300,carbs:"30g",protein:"20g",fat:"5g",benefits:["Muscle Repair"]}],lunch:[{name:"Grilled Chicken Salad with Quinoa",calories:500,carbs:"40g",protein:"40g",fat:"15g",benefits:["Lean Protein","Complete Meal"]},{name:"Lentil Soup (Dal) & Brown Rice",calories:450,carbs:"60g",protein:"18g",fat:"8g",benefits:["Plant Protein","Easy Digestion"]}],snacks:[{name:"Greek Yogurt with Berries",calories:150,carbs:"15g",protein:"12g",fat:"0g",benefits:["Probiotics","Antioxidants"]},{name:"Handful of Almonds",calories:160,carbs:"6g",protein:"6g",fat:"14g",benefits:["Healthy Fats"]}],dinner:[{name:"Baked Salmon with Steamed Broccoli",calories:550,carbs:"10g",protein:"45g",fat:"30g",benefits:["Omega-3","Light Dinner"]},{name:"Stir-Fried Tofu with Mixed Veggies",calories:400,carbs:"15g",protein:"25g",fat:"20g",benefits:["Vegan Option","Light"]}],recommendations:["Drink 3-4 liters of water daily.","Eat dinner at least 2 hours before sleep.","Include a serving of raw salad with lunch.","Limit processed sugar intake."],restrictions:[]};if(!n||!n.results)return e;const{results:t}=n,i=f=>t.find(m=>m.parameter===f),r=i("glucose_fasting"),s=i("glucose_pp");(r&&r.status==="High"||s&&s.status==="High")&&(e.recommendations.unshift(" STRICT LOW GLYCEMIC INDEX DIET RECOMMENDED"),e.restrictions.push("White bread, white rice, pasta","Sugary drinks & desserts","High-sugar fruits (mango, grapes)"),e.breakfast=[{name:"Steel-Cut Oats with Cinnamon (No Sugar)",calories:300,carbs:"50g",protein:"10g",fat:"6g",benefits:["Low GI","Cinnamon Helps Insulin"]},{name:"Vegetable Omelette (Double Spinach)",calories:320,carbs:"5g",protein:"22g",fat:"20g",benefits:["Keto-Friendly","Iron Boost"]}],e.snacks=[{name:"Roasted Chana (Chickpeas)",calories:180,carbs:"20g",protein:"10g",fat:"4g",benefits:["Complex Carbs","Satiety"]},{name:"Cucumber & Hummus Sticks",calories:150,carbs:"15g",protein:"6g",fat:"8g",benefits:["Hydrating","Low Carb"]}]);const a=i("cholesterol"),o=i("triglycerides"),l=i("ldl_cholesterol");(a&&a.status==="High"||o&&o.status==="High"||l&&l.status==="High")&&(e.recommendations.unshift(" HEART HEALTHY FATS ONLY (Avoid Saturated Fats)"),e.restrictions.push("Red meat","Butter/Ghee","Fried foods","Full-fat dairy"),e.dinner=[{name:"Grilled Mackerel/Salmon (No Butter)",calories:500,carbs:"0g",protein:"40g",fat:"25g",benefits:["High Omega-3","Lowers inflammation"]},{name:"Quinoa Bowl with Beans",calories:450,carbs:"60g",protein:"18g",fat:"8g",benefits:["Fiber lowers cholesterol"]}],e.breakfast.some(f=>f.name.includes("Oat"))||e.breakfast.unshift({name:"Bowl of Oatmeal with Flaxseeds",calories:350,carbs:"55g",protein:"12g",fat:"10g",benefits:["Soluble Fiber","Cholesterol Lowering"]}));const u=i("hemoglobin");u&&u.status==="Low"&&(e.recommendations.unshift(" IRON-RICH DIET (Consume Vitamin C for absorption)"),e.lunch.forEach(f=>{f.name.includes("Spinach")||(f.name+=" + Side Spinach Salad"),f.benefits.push("Iron Booster")}),e.snacks.push({name:"Dates & Walnuts",calories:200,carbs:"40g",protein:"4g",fat:"8g",benefits:["High Iron","Energy"]}),e.restrictions.push("Tea/Coffee within 1 hour of meals (Inhibits Iron absorption)"));const c=i("uric_acid");c&&c.status==="High"&&(e.recommendations.unshift(" LOW PURINE DIET (Manage Uric Acid)"),e.restrictions.push("Red meat","Shellfish","Spinach","Cauliflower","Alcohol"),["breakfast","lunch","dinner","snacks"].forEach(f=>{e[f]=e[f].map(m=>m.name.includes("Spinach")?{...m,name:m.name.replace("Spinach","Cucumber"),benefits:m.benefits.filter(y=>y!=="Iron Booster")}:m)}),e.snacks.push({name:"Bowl of Cherries / Berries",calories:100,carbs:"25g",protein:"1g",fat:"0g",benefits:["Lowers Uric Acid"]}));const h=i("tsh");return h&&h.status==="High"&&(e.recommendations.unshift(" THYROID SUPPORT (Limit Goitrogens raw)"),e.restrictions.push("Raw Cruciferous Veggies (Cabbage, Broccoli, Cauliflower) - Cook them well"),e.recommendations.push("Ensure iodized salt usage or eat seaweed."),e.breakfast.push({name:"Brazil Nuts (2-3) & Smoothie",calories:300,carbs:"40g",protein:"10g",fat:"15g",benefits:["Selenium for Thyroid"]})),e},Jte=({onBack:n,user:e})=>{const[t,i]=Ce.useState(null),[r,s]=Ce.useState(null),[a,o]=Ce.useState(!0),[l,u]=Ce.useState(!1),[c,h]=Ce.useState("breakfast");Ce.useEffect(()=>{f()},[e]);const f=()=>{e&&e.email?`${e.email}`:`${Date.now()}`;let y=null;if(e&&e.email){const _=localStorage.getItem(`reports_${e.email}`);if(_){const x=JSON.parse(_);x.length>0&&(y=x[0])}}else{const _=Object.keys(localStorage).filter(x=>x.startsWith("temp_reports_"));if(_.length>0){const x=localStorage.getItem(_[_.length-1]);if(x){const v=JSON.parse(x);v.length>0&&(y=v[0])}}}if(y){i(y);const _=vO(y);s(_)}o(!1)},m=async y=>{const _=y.target.files[0];if(_){u(!0);try{const{data:{text:x}}=await DT.recognize(_,"eng"),v=x.split(`
`),w={},E={hemoglobin:["hemoglobin","hb"],glucose_fasting:["glucose fasting","fbs"],cholesterol:["cholesterol"],uric_acid:["uric acid"],tsh:["tsh"]};if(v.forEach(k=>{const N=k.toLowerCase();Object.keys(E).forEach(L=>{if(E[L].some(j=>N.includes(j))){const j=k.match(/(\d+(\.\d+)?)/g);j&&(w[L]=parseFloat(j[0]))}})}),Object.keys(w).length===0){alert("Could not detect clear values. Please try a clearer image."),u(!1);return}const C=Cz(w);s(vO(C)),i(C);const D=e&&e.email?`reports_${e.email}`:`temp_reports_${Date.now()}`,V=JSON.parse(localStorage.getItem(D)||"[]"),I=[C,...V];localStorage.setItem(D,JSON.stringify(I))}catch(x){console.error(x),alert("Error scanning file.")}finally{u(!1)}}};return a?S.jsx("div",{className:"p-4",children:"Loading Diet Plan..."}):t?S.jsxs("div",{className:"diet-container fade-in",children:[S.jsxs("div",{className:"header-row",children:[S.jsx("button",{onClick:n,className:"back-btn",children:S.jsx(Xo,{size:24})}),S.jsx("h2",{children:"Your Personalized Diet"})]}),S.jsx("div",{className:"health-summary",children:r.recommendations.some(y=>y.includes(""))?S.jsxs("div",{className:"alert-badge warning",children:[S.jsx(vz,{size:16}),S.jsx("span",{children:"Based on your report: Modifications applied for specific conditions."})]}):S.jsxs("div",{className:"alert-badge success",children:[S.jsx(JX,{size:16}),S.jsx("span",{children:"Report looks balanced. Showing base healthy plan."})]})}),S.jsxs("div",{className:"recommendations-box",children:[S.jsx("h4",{children:"Key Guidelines"}),S.jsx("ul",{children:r.recommendations.slice(0,3).map((y,_)=>S.jsx("li",{className:y.includes("")?"high-priority":"",children:y},_))})]}),S.jsx("div",{className:"meal-tabs",children:["breakfast","lunch","snacks","dinner"].map(y=>S.jsx("button",{className:`tab-btn ${c===y?"active":""}`,onClick:()=>h(y),children:y.charAt(0).toUpperCase()+y.slice(1)},y))}),S.jsx("div",{className:"meal-content",children:r[c].map((y,_)=>S.jsxs("div",{className:"food-card slide-in",children:[S.jsxs("div",{className:"food-header",children:[S.jsx("h3",{children:y.name}),S.jsxs("span",{className:"cal-badge",children:[y.calories," kcal"]})]}),S.jsxs("div",{className:"macros-row",children:[S.jsxs("span",{className:"macro",children:["C: ",y.carbs]}),S.jsxs("span",{className:"macro",children:["P: ",y.protein]}),S.jsxs("span",{className:"macro",children:["F: ",y.fat]})]}),S.jsx("div",{className:"benefits-tags",children:y.benefits.map((x,v)=>S.jsx("span",{className:"tag",children:x},v))})]},_))}),r.restrictions.length>0&&S.jsxs("div",{className:"restrictions-box",children:[S.jsx("h4",{children:" Avoid / Limit"}),S.jsx("p",{children:r.restrictions.join(", ")})]}),S.jsx("style",{children:`
                .diet-container { padding: 20px; padding-bottom: 80px; }
                .header-row { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
                .back-btn { background: none; border: none; padding: 0; cursor: pointer; color: #333; }
                
                .health-summary { margin-bottom: 20px; }
                .alert-badge { 
                    padding: 10px 15px; border-radius: 8px; font-size: 13px; 
                    display: flex; align-items: center; gap: 8px; font-weight: 500;
                }
                .alert-badge.warning { background: #fff7ed; color: #c2410c; border: 1px solid #ffedd5; }
                .alert-badge.success { background: #f0fdf4; color: #15803d; border: 1px solid #dcfce7; }

                .recommendations-box { 
                    background: #f8fafc; padding: 15px; border-radius: 12px; margin-bottom: 20px;
                }
                .recommendations-box h4 { margin: 0 0 10px 0; font-size: 14px; color: #475569; }
                .recommendations-box ul { padding-left: 20px; margin: 0; font-size: 13px; color: #334155; }
                .recommendations-box li { margin-bottom: 5px; }
                .recommendations-box li.high-priority { color: #dc2626; font-weight: 600; }

                .meal-tabs { 
                    display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 10px; 
                    scrollbar-width: none;
                }
                .tab-btn {
                    padding: 8px 16px; border-radius: 20px; background: white; border: 1px solid #e2e8f0;
                    font-size: 13px; white-space: nowrap; cursor: pointer; transition: all 0.2s;
                }
                .tab-btn.active {
                    background: var(--color-primary); color: white; border-color: var(--color-primary);
                    box-shadow: 0 4px 6px -1px rgba(var(--color-primary-rgb), 0.4);
                }

                .food-card {
                    background: white; padding: 16px; border-radius: 12px; margin-bottom: 15px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.06); border-left: 4px solid var(--color-primary);
                }
                .food-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
                .food-header h3 { margin: 0; font-size: 15px; font-weight: 600; color: #1e293b; max-width: 70%; }
                .cal-badge { font-size: 11px; font-weight: bold; background: #f1f5f9; padding: 4px 8px; border-radius: 6px; color: #64748b; }
                
                .macros-row { display: flex; gap: 15px; margin-bottom: 10px; font-size: 12px; color: #64748b; }
                .macro { font-weight: 500; }
                
                .benefits-tags { display: flex; flex-wrap: wrap; gap: 6px; }
                .tag { font-size: 10px; background: #ecfdf5; color: #047857; padding: 3px 8px; border-radius: 4px; }

                .restrictions-box {
                    margin-top: 25px; padding: 15px; background: #fef2f2; border-radius: 12px;
                    border: 1px dashed #fecaca;
                }
                .restrictions-box h4 { color: #b91c1c; margin: 0 0 5px 0; font-size: 13px; }
                .restrictions-box p { color: #7f1d1d; font-size: 12px; margin: 0; line-height: 1.4; }

                .slide-in { animation: slideIn 0.3s ease-out forwards; }
                @keyframes slideIn {
                    from { opacity: 0; transform: translateY(10px); }
                    to { opacity: 1; transform: translateY(0); }
                }
            `})]}):S.jsxs("div",{className:"diet-container fade-in",children:[S.jsxs("div",{className:"header-row",children:[S.jsx("button",{onClick:n,className:"back-btn",children:S.jsx(Xo,{size:24})}),S.jsx("h2",{children:"Specialized Diet"})]}),S.jsxs("div",{className:"no-report-state",children:[S.jsx("div",{className:"icon-box",children:S.jsx(Fg,{size:40,color:"var(--color-primary)"})}),S.jsx("h3",{children:"No Report Uploaded"}),S.jsx("p",{children:"Please upload your blood test report to get a personalized diet plan tailored to your body's needs."}),S.jsxs("label",{className:"btn-primary upload-btn-large",children:[l?"Scanning...":"Upload Report Now",S.jsx(bz,{size:18,style:{marginLeft:8}}),S.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:m,disabled:l})]})]}),S.jsx("style",{children:`
                    .diet-container { padding: 20px; }
                    .header-row { display: flex; align-items: center; gap: 15px; margin-bottom: 30px; }
                    .back-btn { background: none; border: none; padding: 0; cursor: pointer; color: #333; }
                    .no-report-state { 
                        text-align: center; padding: 40px 20px; background: white; 
                        border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);
                        display: flex; flex-direction: column; align-items: center;
                    }
                    .icon-box { 
                        width: 80px; height: 80px; background: #e0f2fe; border-radius: 50%; 
                        display: flex; align-items: center; justify-content: center; margin-bottom: 20px;
                    }
                    .no-report-state h3 { margin-bottom: 10px; color: #0c4a6e; }
                    .no-report-state p { color: #64748b; margin-bottom: 30px; max-width: 300px; line-height: 1.5; }
                    .upload-btn-large { 
                        padding: 12px 24px; background: var(--color-primary); color: white; 
                        border-radius: 99px; display: inline-flex; align-items: center; cursor: pointer;
                        font-weight: 500;
                    }
                `})]})};/*! Capacitor: https://capacitorjs.com/ - MIT License */const Zte=n=>{const e=new Map;e.set("web",{name:"web"});const t=n.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:e},i=(s,a)=>{t.platforms.set(s,a)},r=s=>{t.platforms.has(s)&&(t.currentPlatform=t.platforms.get(s))};return t.addPlatform=i,t.setPlatform=r,t},ene=n=>n.CapacitorPlatforms=Zte(n),u5=ene(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});u5.addPlatform;u5.setPlatform;var Np;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(Np||(Np={}));class fA extends Error{constructor(e,t,i){super(e),this.message=e,this.code=t,this.data=i}}const tne=n=>{var e,t;return n!=null&&n.androidBridge?"android":!((t=(e=n==null?void 0:n.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},nne=n=>{var e,t,i,r,s;const a=n.CapacitorCustomPlatform||null,o=n.Capacitor||{},l=o.Plugins=o.Plugins||{},u=n.CapacitorPlatforms,c=()=>a!==null?a.name:tne(n),h=((e=u==null?void 0:u.currentPlatform)===null||e===void 0?void 0:e.getPlatform)||c,f=()=>h()!=="web",m=((t=u==null?void 0:u.currentPlatform)===null||t===void 0?void 0:t.isNativePlatform)||f,y=I=>{const k=C.get(I);return!!(k!=null&&k.platforms.has(h())||v(I))},_=((i=u==null?void 0:u.currentPlatform)===null||i===void 0?void 0:i.isPluginAvailable)||y,x=I=>{var k;return(k=o.PluginHeaders)===null||k===void 0?void 0:k.find(N=>N.name===I)},v=((r=u==null?void 0:u.currentPlatform)===null||r===void 0?void 0:r.getPluginHeader)||x,w=I=>n.console.error(I),E=(I,k,N)=>Promise.reject(`${N} does not have an implementation of "${k}".`),C=new Map,D=(I,k={})=>{const N=C.get(I);if(N)return console.warn(`Capacitor plugin "${I}" already registered. Cannot register plugins twice.`),N.proxy;const L=h(),j=v(I);let H;const M=async()=>(!H&&L in k?H=typeof k[L]=="function"?H=await k[L]():H=k[L]:a!==null&&!H&&"web"in k&&(H=typeof k.web=="function"?H=await k.web():H=k.web),H),se=(G,U)=>{var Y,K;if(j){const Z=j==null?void 0:j.methods.find(ge=>U===ge.name);if(Z)return Z.rtype==="promise"?ge=>o.nativePromise(I,U.toString(),ge):(ge,ve)=>o.nativeCallback(I,U.toString(),ge,ve);if(G)return(Y=G[U])===null||Y===void 0?void 0:Y.bind(G)}else{if(G)return(K=G[U])===null||K===void 0?void 0:K.bind(G);throw new fA(`"${I}" plugin is not implemented on ${L}`,Np.Unimplemented)}},ue=G=>{let U;const Y=(...K)=>{const Z=M().then(ge=>{const ve=se(ge,G);if(ve){const Q=ve(...K);return U=Q==null?void 0:Q.remove,Q}else throw new fA(`"${I}.${G}()" is not implemented on ${L}`,Np.Unimplemented)});return G==="addListener"&&(Z.remove=async()=>U()),Z};return Y.toString=()=>`${G.toString()}() { [capacitor code] }`,Object.defineProperty(Y,"name",{value:G,writable:!1,configurable:!1}),Y},ee=ue("addListener"),ae=ue("removeListener"),J=(G,U)=>{const Y=ee({eventName:G},U),K=async()=>{const ge=await Y;ae({eventName:G,callbackId:ge},U)},Z=new Promise(ge=>Y.then(()=>ge({remove:K})));return Z.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await K()},Z},q=new Proxy({},{get(G,U){switch(U){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return j?J:ee;case"removeListener":return ae;default:return ue(U)}}});return l[I]=q,C.set(I,{name:I,proxy:q,platforms:new Set([...Object.keys(k),...j?[L]:[]])}),q},V=((s=u==null?void 0:u.currentPlatform)===null||s===void 0?void 0:s.registerPlugin)||D;return o.convertFileSrc||(o.convertFileSrc=I=>I),o.getPlatform=h,o.handleError=w,o.isNativePlatform=m,o.isPluginAvailable=_,o.pluginMethodNoop=E,o.registerPlugin=V,o.Exception=fA,o.DEBUG=!!o.DEBUG,o.isLoggingEnabled=!!o.isLoggingEnabled,o.platform=o.getPlatform(),o.isNative=o.isNativePlatform(),o},ine=n=>n.Capacitor=nne(n),Gd=ine(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),BC=Gd.registerPlugin;Gd.Plugins;class c5{constructor(e){this.listeners={},this.retainedEventArguments={},this.windowListeners={},e&&(console.warn(`Capacitor WebPlugin "${e.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=e)}addListener(e,t){let i=!1;this.listeners[e]||(this.listeners[e]=[],i=!0),this.listeners[e].push(t);const s=this.windowListeners[e];s&&!s.registered&&this.addWindowListener(s),i&&this.sendRetainedArgumentsForEvent(e);const a=async()=>this.removeListener(e,t);return Promise.resolve({remove:a})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,i){const r=this.listeners[e];if(!r){if(i){let s=this.retainedEventArguments[e];s||(s=[]),s.push(t),this.retainedEventArguments[e]=s}return}r.forEach(s=>s(t))}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:i=>{this.notifyListeners(t,i)}}}unimplemented(e="not implemented"){return new Gd.Exception(e,Np.Unimplemented)}unavailable(e="not available"){return new Gd.Exception(e,Np.Unavailable)}async removeListener(e,t){const i=this.listeners[e];if(!i)return;const r=i.indexOf(t);this.listeners[e].splice(r,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(i=>{this.notifyListeners(e,i)}))}}const wO=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),bO=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class rne extends c5{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(i=>{if(i.length<=0)return;let[r,s]=i.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");r=bO(r).trim(),s=bO(s).trim(),t[r]=s}),t}async setCookie(e){try{const t=wO(e.key),i=wO(e.value),r=`; expires=${(e.expires||"").replace("expires=","")}`,s=(e.path||"/").replace("path=",""),a=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${i||""}${r}; path=${s}; ${a};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}BC("CapacitorCookies",{web:()=>new rne});const sne=async n=>new Promise((e,t)=>{const i=new FileReader;i.onload=()=>{const r=i.result;e(r.indexOf(",")>=0?r.split(",")[1]:r)},i.onerror=r=>t(r),i.readAsDataURL(n)}),ane=(n={})=>{const e=Object.keys(n);return Object.keys(n).map(r=>r.toLocaleLowerCase()).reduce((r,s,a)=>(r[s]=n[e[a]],r),{})},one=(n,e=!0)=>n?Object.entries(n).reduce((i,r)=>{const[s,a]=r;let o,l;return Array.isArray(a)?(l="",a.forEach(u=>{o=e?encodeURIComponent(u):u,l+=`${s}=${o}&`}),l.slice(0,-1)):(o=e?encodeURIComponent(a):a,l=`${s}=${o}`),`${i}&${l}`},"").substr(1):null,lne=(n,e={})=>{const t=Object.assign({method:n.method||"GET",headers:n.headers},e),r=ane(n.headers)["content-type"]||"";if(typeof n.data=="string")t.body=n.data;else if(r.includes("application/x-www-form-urlencoded")){const s=new URLSearchParams;for(const[a,o]of Object.entries(n.data||{}))s.set(a,o);t.body=s.toString()}else if(r.includes("multipart/form-data")||n.data instanceof FormData){const s=new FormData;if(n.data instanceof FormData)n.data.forEach((o,l)=>{s.append(l,o)});else for(const o of Object.keys(n.data))s.append(o,n.data[o]);t.body=s;const a=new Headers(t.headers);a.delete("content-type"),t.headers=a}else(r.includes("application/json")||typeof n.data=="object")&&(t.body=JSON.stringify(n.data));return t};class une extends c5{async request(e){const t=lne(e,e.webFetchExtra),i=one(e.params,e.shouldEncodeUrlParams),r=i?`${e.url}?${i}`:e.url,s=await fetch(r,t),a=s.headers.get("content-type")||"";let{responseType:o="text"}=s.ok?e:{};a.includes("application/json")&&(o="json");let l,u;switch(o){case"arraybuffer":case"blob":u=await s.blob(),l=await sne(u);break;case"json":l=await s.json();break;case"document":case"text":default:l=await s.text()}const c={};return s.headers.forEach((h,f)=>{c[f]=h}),{data:l,headers:c,status:s.status,url:s.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}BC("CapacitorHttp",{web:()=>new une});var xO;(function(n){n[n.Sunday=1]="Sunday",n[n.Monday=2]="Monday",n[n.Tuesday=3]="Tuesday",n[n.Wednesday=4]="Wednesday",n[n.Thursday=5]="Thursday",n[n.Friday=6]="Friday",n[n.Saturday=7]="Saturday"})(xO||(xO={}));const qb=BC("LocalNotifications",{web:()=>FL(()=>import("./web-BtZ5uClY.js"),[]).then(n=>new n.LocalNotificationsWeb)}),cne=async()=>{if(!Gd.isNativePlatform())return console.log("Notifications only work on native platforms"),!1;try{return(await qb.requestPermissions()).display==="granted"}catch(n){return console.error("Error requesting notification permissions:",n),!1}},dne=async()=>{if(Gd.isNativePlatform())try{await qb.cancel({notifications:[{id:1}]});const n=new Date;return n.setMonth(n.getMonth()+3),await qb.schedule({notifications:[{title:" Blood Checkup Reminder",body:"It's been 3 months since your last blood test. Time for a health checkup!",id:1,schedule:{at:n},sound:"default",actionTypeId:"",extra:{type:"blood_checkup_reminder"}}]}),console.log("3-month reminder scheduled for:",n),n}catch(n){return console.error("Error scheduling 3-month reminder:",n),null}},hne=()=>{Gd.isNativePlatform()&&qb.addListener("localNotificationActionPerformed",n=>{console.log("Notification clicked:",n)})};function fne(){const n=localStorage.getItem("user_profile"),[e,t]=Ce.useState(n?"dashboard":"login"),[i,r]=Ce.useState(null),[s,a]=Ce.useState(null),[o,l]=Ce.useState(n?JSON.parse(n):null),[u,c]=Ce.useState(null);MO.useEffect(()=>{(async()=>{if(await cne()){console.log("Notifications enabled"),hne();const C=await dne();C&&console.log("Next blood checkup reminder:",C.toLocaleDateString())}})();const x=ng.onAuthStateChange(async E=>{if(E){console.log("User logged in:",E.email),a({email:E.email,id:E.uid});try{const C=await ng.getProfile();C.success&&C.profile?(l(C.profile),t("dashboard")):t("profile_setup")}catch(C){console.error("Error loading profile:",C),t("profile_setup")}}else console.log("User logged out"),a(null),l(null),t("login")}),v=["Drink a glass of water now! ","Time to stretch your legs! ","Don't forget to eat a fruit today! ","Stay motivated! You're doing great. ","Check your blood report regularly. ","Avoid sugary drinks for better health. "],w=setInterval(()=>{const E=v[Math.floor(Math.random()*v.length)];c(E)},12e4);return()=>{clearInterval(w),x()}},[]);const h=async(_,x=!1)=>{if(a(_),x){t("profile_setup");return}try{const v=await ng.getProfile();v.success&&v.profile?(console.log("Profile found:",v.profile),l(v.profile),localStorage.setItem("user_profile",JSON.stringify(v.profile)),t("dashboard")):(console.log("No profile found, redirecting to setup"),t("profile_setup"))}catch(v){console.error("Error fetching profile:",v);const w=localStorage.getItem("user_profile");if(w){const E=JSON.parse(w);E.email===_.email?(l(E),t("dashboard")):(console.log("Cached profile does not match current user. Redirecting to setup."),t("profile_setup"))}else t("profile_setup")}},f=_=>{const x={..._,email:s==null?void 0:s.email};l(x),localStorage.setItem("user_profile",JSON.stringify(x)),t("dashboard")},m=(_,x=null)=>{r(x),t(_)},y=async()=>{await ng.logout()};return S.jsxs("div",{className:"app-container",children:[u&&S.jsx(Qte,{message:u,onClose:()=>c(null)}),e==="login"&&S.jsx(qH,{onLogin:h}),e==="profile_setup"&&S.jsx(UX,{onComplete:f}),e==="dashboard"&&S.jsx(mQ,{userName:o==null?void 0:o.name,userProfile:o,onNavigate:m,onLogout:y}),e==="bmi"&&S.jsx(gQ,{userProfile:o,onBack:()=>t("dashboard")}),e==="blood"&&S.jsx(Hte,{user:o,onBack:()=>t("dashboard"),initialViewReport:i}),e==="fitness"&&S.jsx(Wte,{userProfile:o,onBack:()=>t("dashboard")}),e==="homeworkout"&&S.jsx(Gte,{onBack:()=>t("dashboard")}),e==="weightprogress"&&S.jsx(Kte,{userProfile:o,onBack:()=>t("dashboard")}),e==="chat"&&S.jsx(Xte,{userProfile:o,onBack:()=>t("dashboard")}),e==="diet"&&S.jsx(Jte,{user:o,onBack:()=>t("dashboard")})]})}pA.createRoot(document.getElementById("root")).render(S.jsx(MO.StrictMode,{children:S.jsx(fne,{})}));export{c5 as W};
