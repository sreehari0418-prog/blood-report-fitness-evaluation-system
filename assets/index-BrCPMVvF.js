var x6=Object.defineProperty;var Ek=n=>{throw TypeError(n)};var E6=(n,e,t)=>e in n?x6(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ze=(n,e,t)=>E6(n,typeof e!="symbol"?e+"":e,t),Cx=(n,e,t)=>e.has(n)||Ek("Cannot "+t);var d=(n,e,t)=>(Cx(n,e,"read from private field"),t?t.call(n):e.get(n)),F=(n,e,t)=>e.has(n)?Ek("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),P=(n,e,t,i)=>(Cx(n,e,"write to private field"),i?i.call(n,t):e.set(n,t),t),z=(n,e,t)=>(Cx(n,e,"access private method"),t);var Ii=(n,e,t,i)=>({set _(r){P(n,e,r,t)},get _(){return d(n,e,i)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function A3(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var T3={exports:{}},f1={},S3={exports:{}},ot={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y_=Symbol.for("react.element"),A6=Symbol.for("react.portal"),T6=Symbol.for("react.fragment"),S6=Symbol.for("react.strict_mode"),I6=Symbol.for("react.profiler"),C6=Symbol.for("react.provider"),k6=Symbol.for("react.context"),$6=Symbol.for("react.forward_ref"),R6=Symbol.for("react.suspense"),P6=Symbol.for("react.memo"),N6=Symbol.for("react.lazy"),Ak=Symbol.iterator;function D6(n){return n===null||typeof n!="object"?null:(n=Ak&&n[Ak]||n["@@iterator"],typeof n=="function"?n:null)}var I3={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C3=Object.assign,k3={};function Up(n,e,t){this.props=n,this.context=e,this.refs=k3,this.updater=t||I3}Up.prototype.isReactComponent={};Up.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Up.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function $3(){}$3.prototype=Up.prototype;function A2(n,e,t){this.props=n,this.context=e,this.refs=k3,this.updater=t||I3}var T2=A2.prototype=new $3;T2.constructor=A2;C3(T2,Up.prototype);T2.isPureReactComponent=!0;var Tk=Array.isArray,R3=Object.prototype.hasOwnProperty,S2={current:null},P3={key:!0,ref:!0,__self:!0,__source:!0};function N3(n,e,t){var i,r={},s=null,a=null;if(e!=null)for(i in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(s=""+e.key),e)R3.call(e,i)&&!P3.hasOwnProperty(i)&&(r[i]=e[i]);var o=arguments.length-2;if(o===1)r.children=t;else if(1<o){for(var l=Array(o),u=0;u<o;u++)l[u]=arguments[u+2];r.children=l}if(n&&n.defaultProps)for(i in o=n.defaultProps,o)r[i]===void 0&&(r[i]=o[i]);return{$$typeof:Y_,type:n,key:s,ref:a,props:r,_owner:S2.current}}function M6(n,e){return{$$typeof:Y_,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function I2(n){return typeof n=="object"&&n!==null&&n.$$typeof===Y_}function O6(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var Sk=/\/+/g;function kx(n,e){return typeof n=="object"&&n!==null&&n.key!=null?O6(""+n.key):e.toString(36)}function j0(n,e,t,i,r){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case Y_:case A6:a=!0}}if(a)return a=n,r=r(a),n=i===""?"."+kx(a,0):i,Tk(r)?(t="",n!=null&&(t=n.replace(Sk,"$&/")+"/"),j0(r,e,t,"",function(u){return u})):r!=null&&(I2(r)&&(r=M6(r,t+(!r.key||a&&a.key===r.key?"":(""+r.key).replace(Sk,"$&/")+"/")+n)),e.push(r)),1;if(a=0,i=i===""?".":i+":",Tk(n))for(var o=0;o<n.length;o++){s=n[o];var l=i+kx(s,o);a+=j0(s,e,t,l,r)}else if(l=D6(n),typeof l=="function")for(n=l.call(n),o=0;!(s=n.next()).done;)s=s.value,l=i+kx(s,o++),a+=j0(s,e,t,l,r);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function Qv(n,e,t){if(n==null)return n;var i=[],r=0;return j0(n,i,"","",function(s){return e.call(t,s,r++)}),i}function L6(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var zi={current:null},B0={transition:null},F6={ReactCurrentDispatcher:zi,ReactCurrentBatchConfig:B0,ReactCurrentOwner:S2};function D3(){throw Error("act(...) is not supported in production builds of React.")}ot.Children={map:Qv,forEach:function(n,e,t){Qv(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Qv(n,function(){e++}),e},toArray:function(n){return Qv(n,function(e){return e})||[]},only:function(n){if(!I2(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};ot.Component=Up;ot.Fragment=T6;ot.Profiler=I6;ot.PureComponent=A2;ot.StrictMode=S6;ot.Suspense=R6;ot.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=F6;ot.act=D3;ot.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var i=C3({},n.props),r=n.key,s=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,a=S2.current),e.key!==void 0&&(r=""+e.key),n.type&&n.type.defaultProps)var o=n.type.defaultProps;for(l in e)R3.call(e,l)&&!P3.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=t;else if(1<l){o=Array(l);for(var u=0;u<l;u++)o[u]=arguments[u+2];i.children=o}return{$$typeof:Y_,type:n.type,key:r,ref:s,props:i,_owner:a}};ot.createContext=function(n){return n={$$typeof:k6,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:C6,_context:n},n.Consumer=n};ot.createElement=N3;ot.createFactory=function(n){var e=N3.bind(null,n);return e.type=n,e};ot.createRef=function(){return{current:null}};ot.forwardRef=function(n){return{$$typeof:$6,render:n}};ot.isValidElement=I2;ot.lazy=function(n){return{$$typeof:N6,_payload:{_status:-1,_result:n},_init:L6}};ot.memo=function(n,e){return{$$typeof:P6,type:n,compare:e===void 0?null:e}};ot.startTransition=function(n){var e=B0.transition;B0.transition={};try{n()}finally{B0.transition=e}};ot.unstable_act=D3;ot.useCallback=function(n,e){return zi.current.useCallback(n,e)};ot.useContext=function(n){return zi.current.useContext(n)};ot.useDebugValue=function(){};ot.useDeferredValue=function(n){return zi.current.useDeferredValue(n)};ot.useEffect=function(n,e){return zi.current.useEffect(n,e)};ot.useId=function(){return zi.current.useId()};ot.useImperativeHandle=function(n,e,t){return zi.current.useImperativeHandle(n,e,t)};ot.useInsertionEffect=function(n,e){return zi.current.useInsertionEffect(n,e)};ot.useLayoutEffect=function(n,e){return zi.current.useLayoutEffect(n,e)};ot.useMemo=function(n,e){return zi.current.useMemo(n,e)};ot.useReducer=function(n,e,t){return zi.current.useReducer(n,e,t)};ot.useRef=function(n){return zi.current.useRef(n)};ot.useState=function(n){return zi.current.useState(n)};ot.useSyncExternalStore=function(n,e,t){return zi.current.useSyncExternalStore(n,e,t)};ot.useTransition=function(){return zi.current.useTransition()};ot.version="18.3.1";S3.exports=ot;var xe=S3.exports;const M3=A3(xe);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z6=xe,V6=Symbol.for("react.element"),j6=Symbol.for("react.fragment"),B6=Object.prototype.hasOwnProperty,U6=z6.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,H6={key:!0,ref:!0,__self:!0,__source:!0};function O3(n,e,t){var i,r={},s=null,a=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(a=e.ref);for(i in e)B6.call(e,i)&&!H6.hasOwnProperty(i)&&(r[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:V6,type:n,key:s,ref:a,props:r,_owner:U6.current}}f1.Fragment=j6;f1.jsx=O3;f1.jsxs=O3;T3.exports=f1;var T=T3.exports,EA={},L3={exports:{}},Fr={},F3={exports:{}},z3={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(G,W){var K=G.length;G.push(W);e:for(;0<K;){var H=K-1>>>1,Q=G[H];if(0<r(Q,W))G[H]=W,G[K]=Q,K=H;else break e}}function t(G){return G.length===0?null:G[0]}function i(G){if(G.length===0)return null;var W=G[0],K=G.pop();if(K!==W){G[0]=K;e:for(var H=0,Q=G.length,Y=Q>>>1;H<Y;){var Z=2*(H+1)-1,fe=G[Z],_e=Z+1,X=G[_e];if(0>r(fe,K))_e<Q&&0>r(X,fe)?(G[H]=X,G[_e]=K,H=_e):(G[H]=fe,G[Z]=K,H=Z);else if(_e<Q&&0>r(X,K))G[H]=X,G[_e]=K,H=_e;else break e}}return W}function r(G,W){var K=G.sortIndex-W.sortIndex;return K!==0?K:G.id-W.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var l=[],u=[],c=1,h=null,f=3,m=!1,y=!1,_=!1,x=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(G){for(var W=t(u);W!==null;){if(W.callback===null)i(u);else if(W.startTime<=G)i(u),W.sortIndex=W.expirationTime,e(l,W);else break;W=t(u)}}function k(G){if(_=!1,E(G),!y)if(t(l)!==null)y=!0,te($);else{var W=t(u);W!==null&&oe(k,W.startTime-G)}}function $(G,W){y=!1,_&&(_=!1,v(C),C=-1),m=!0;var K=f;try{for(E(W),h=t(l);h!==null&&(!(h.expirationTime>W)||G&&!V());){var H=h.callback;if(typeof H=="function"){h.callback=null,f=h.priorityLevel;var Q=H(h.expirationTime<=W);W=n.unstable_now(),typeof Q=="function"?h.callback=Q:h===t(l)&&i(l),E(W)}else i(l);h=t(l)}if(h!==null)var Y=!0;else{var Z=t(u);Z!==null&&oe(k,Z.startTime-W),Y=!1}return Y}finally{h=null,f=K,m=!1}}var L=!1,I=null,C=-1,N=5,O=-1;function V(){return!(n.unstable_now()-O<N)}function U(){if(I!==null){var G=n.unstable_now();O=G;var W=!0;try{W=I(!0,G)}finally{W?j():(L=!1,I=null)}}else L=!1}var j;if(typeof w=="function")j=function(){w(U)};else if(typeof MessageChannel<"u"){var he=new MessageChannel,me=he.port2;he.port1.onmessage=U,j=function(){me.postMessage(null)}}else j=function(){x(U,0)};function te(G){I=G,L||(L=!0,j())}function oe(G,W){C=x(function(){G(n.unstable_now())},W)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(G){G.callback=null},n.unstable_continueExecution=function(){y||m||(y=!0,te($))},n.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<G?Math.floor(1e3/G):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(G){switch(f){case 1:case 2:case 3:var W=3;break;default:W=f}var K=f;f=W;try{return G()}finally{f=K}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(G,W){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var K=f;f=G;try{return W()}finally{f=K}},n.unstable_scheduleCallback=function(G,W,K){var H=n.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?H+K:H):K=H,G){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=K+Q,G={id:c++,callback:W,priorityLevel:G,startTime:K,expirationTime:Q,sortIndex:-1},K>H?(G.sortIndex=K,e(u,G),t(l)===null&&G===t(u)&&(_?(v(C),C=-1):_=!0,oe(k,K-H))):(G.sortIndex=Q,e(l,G),y||m||(y=!0,te($))),G},n.unstable_shouldYield=V,n.unstable_wrapCallback=function(G){var W=f;return function(){var K=f;f=W;try{return G.apply(this,arguments)}finally{f=K}}}})(z3);F3.exports=z3;var W6=F3.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var q6=xe,Lr=W6;function ye(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var V3=new Set,qg={};function rh(n,e){Sp(n,e),Sp(n+"Capture",e)}function Sp(n,e){for(qg[n]=e,n=0;n<e.length;n++)V3.add(e[n])}var Go=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),AA=Object.prototype.hasOwnProperty,G6=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Ik={},Ck={};function K6(n){return AA.call(Ck,n)?!0:AA.call(Ik,n)?!1:G6.test(n)?Ck[n]=!0:(Ik[n]=!0,!1)}function Y6(n,e,t,i){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function X6(n,e,t,i){if(e===null||typeof e>"u"||Y6(n,e,t,i))return!0;if(i)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Vi(n,e,t,i,r,s,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=a}var si={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){si[n]=new Vi(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];si[e]=new Vi(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){si[n]=new Vi(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){si[n]=new Vi(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){si[n]=new Vi(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){si[n]=new Vi(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){si[n]=new Vi(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){si[n]=new Vi(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){si[n]=new Vi(n,5,!1,n.toLowerCase(),null,!1,!1)});var C2=/[\-:]([a-z])/g;function k2(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(C2,k2);si[e]=new Vi(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(C2,k2);si[e]=new Vi(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(C2,k2);si[e]=new Vi(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){si[n]=new Vi(n,1,!1,n.toLowerCase(),null,!1,!1)});si.xlinkHref=new Vi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){si[n]=new Vi(n,1,!1,n.toLowerCase(),null,!0,!0)});function $2(n,e,t,i){var r=si.hasOwnProperty(e)?si[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(X6(e,t,r,i)&&(t=null),i||r===null?K6(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):r.mustUseProperty?n[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,i=r.attributeNamespace,t===null?n.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,i?n.setAttributeNS(i,e,t):n.setAttribute(e,t))))}var rl=q6.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Jv=Symbol.for("react.element"),jh=Symbol.for("react.portal"),Bh=Symbol.for("react.fragment"),R2=Symbol.for("react.strict_mode"),TA=Symbol.for("react.profiler"),j3=Symbol.for("react.provider"),B3=Symbol.for("react.context"),P2=Symbol.for("react.forward_ref"),SA=Symbol.for("react.suspense"),IA=Symbol.for("react.suspense_list"),N2=Symbol.for("react.memo"),xl=Symbol.for("react.lazy"),U3=Symbol.for("react.offscreen"),kk=Symbol.iterator;function Tm(n){return n===null||typeof n!="object"?null:(n=kk&&n[kk]||n["@@iterator"],typeof n=="function"?n:null)}var nn=Object.assign,$x;function Ym(n){if($x===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);$x=e&&e[1]||""}return`
`+$x+n}var Rx=!1;function Px(n,e){if(!n||Rx)return"";Rx=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var i=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){i=u}n.call(e.prototype)}else{try{throw Error()}catch(u){i=u}n()}}catch(u){if(u&&i&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),s=i.stack.split(`
`),a=r.length-1,o=s.length-1;1<=a&&0<=o&&r[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==s[o]){if(a!==1||o!==1)do if(a--,o--,0>o||r[a]!==s[o]){var l=`
`+r[a].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=a&&0<=o);break}}}finally{Rx=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Ym(n):""}function Q6(n){switch(n.tag){case 5:return Ym(n.type);case 16:return Ym("Lazy");case 13:return Ym("Suspense");case 19:return Ym("SuspenseList");case 0:case 2:case 15:return n=Px(n.type,!1),n;case 11:return n=Px(n.type.render,!1),n;case 1:return n=Px(n.type,!0),n;default:return""}}function CA(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Bh:return"Fragment";case jh:return"Portal";case TA:return"Profiler";case R2:return"StrictMode";case SA:return"Suspense";case IA:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case B3:return(n.displayName||"Context")+".Consumer";case j3:return(n._context.displayName||"Context")+".Provider";case P2:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case N2:return e=n.displayName||null,e!==null?e:CA(n.type)||"Memo";case xl:e=n._payload,n=n._init;try{return CA(n(e))}catch{}}return null}function J6(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return CA(e);case 8:return e===R2?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Eu(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function H3(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Z6(n){var e=H3(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),i=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return r.call(this)},set:function(a){i=""+a,s.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(a){i=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Zv(n){n._valueTracker||(n._valueTracker=Z6(n))}function W3(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return n&&(i=H3(n)?n.checked?"true":"false":n.value),n=i,n!==t?(e.setValue(n),!0):!1}function Vw(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function kA(n,e){var t=e.checked;return nn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function $k(n,e){var t=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;t=Eu(e.value!=null?e.value:t),n._wrapperState={initialChecked:i,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function q3(n,e){e=e.checked,e!=null&&$2(n,"checked",e,!1)}function $A(n,e){q3(n,e);var t=Eu(e.value),i=e.type;if(t!=null)i==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(i==="submit"||i==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?RA(n,e.type,t):e.hasOwnProperty("defaultValue")&&RA(n,e.type,Eu(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Rk(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function RA(n,e,t){(e!=="number"||Vw(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Xm=Array.isArray;function lf(n,e,t,i){if(n=n.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<n.length;t++)r=e.hasOwnProperty("$"+n[t].value),n[t].selected!==r&&(n[t].selected=r),r&&i&&(n[t].defaultSelected=!0)}else{for(t=""+Eu(t),e=null,r=0;r<n.length;r++){if(n[r].value===t){n[r].selected=!0,i&&(n[r].defaultSelected=!0);return}e!==null||n[r].disabled||(e=n[r])}e!==null&&(e.selected=!0)}}function PA(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ye(91));return nn({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Pk(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(ye(92));if(Xm(t)){if(1<t.length)throw Error(ye(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Eu(t)}}function G3(n,e){var t=Eu(e.value),i=Eu(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),i!=null&&(n.defaultValue=""+i)}function Nk(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function K3(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function NA(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?K3(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var e0,Y3=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,i,r){MSApp.execUnsafeLocalFunction(function(){return n(e,t,i,r)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(e0=e0||document.createElement("div"),e0.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=e0.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Gg(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Sg={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},e8=["Webkit","ms","Moz","O"];Object.keys(Sg).forEach(function(n){e8.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Sg[e]=Sg[n]})});function X3(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Sg.hasOwnProperty(n)&&Sg[n]?(""+e).trim():e+"px"}function Q3(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var i=t.indexOf("--")===0,r=X3(t,e[t],i);t==="float"&&(t="cssFloat"),i?n.setProperty(t,r):n[t]=r}}var t8=nn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function DA(n,e){if(e){if(t8[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ye(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ye(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ye(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ye(62))}}function MA(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var OA=null;function D2(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var LA=null,uf=null,cf=null;function Dk(n){if(n=J_(n)){if(typeof LA!="function")throw Error(ye(280));var e=n.stateNode;e&&(e=_1(e),LA(n.stateNode,n.type,e))}}function J3(n){uf?cf?cf.push(n):cf=[n]:uf=n}function Z3(){if(uf){var n=uf,e=cf;if(cf=uf=null,Dk(n),e)for(n=0;n<e.length;n++)Dk(e[n])}}function eO(n,e){return n(e)}function tO(){}var Nx=!1;function nO(n,e,t){if(Nx)return n(e,t);Nx=!0;try{return eO(n,e,t)}finally{Nx=!1,(uf!==null||cf!==null)&&(tO(),Z3())}}function Kg(n,e){var t=n.stateNode;if(t===null)return null;var i=_1(t);if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(n=n.type,i=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!i;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(ye(231,e,typeof t));return t}var FA=!1;if(Go)try{var Sm={};Object.defineProperty(Sm,"passive",{get:function(){FA=!0}}),window.addEventListener("test",Sm,Sm),window.removeEventListener("test",Sm,Sm)}catch{FA=!1}function n8(n,e,t,i,r,s,a,o,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(c){this.onError(c)}}var Ig=!1,jw=null,Bw=!1,zA=null,i8={onError:function(n){Ig=!0,jw=n}};function r8(n,e,t,i,r,s,a,o,l){Ig=!1,jw=null,n8.apply(i8,arguments)}function s8(n,e,t,i,r,s,a,o,l){if(r8.apply(this,arguments),Ig){if(Ig){var u=jw;Ig=!1,jw=null}else throw Error(ye(198));Bw||(Bw=!0,zA=u)}}function sh(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function iO(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function Mk(n){if(sh(n)!==n)throw Error(ye(188))}function a8(n){var e=n.alternate;if(!e){if(e=sh(n),e===null)throw Error(ye(188));return e!==n?null:n}for(var t=n,i=e;;){var r=t.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){t=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===t)return Mk(r),n;if(s===i)return Mk(r),e;s=s.sibling}throw Error(ye(188))}if(t.return!==i.return)t=r,i=s;else{for(var a=!1,o=r.child;o;){if(o===t){a=!0,t=r,i=s;break}if(o===i){a=!0,i=r,t=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===t){a=!0,t=s,i=r;break}if(o===i){a=!0,i=s,t=r;break}o=o.sibling}if(!a)throw Error(ye(189))}}if(t.alternate!==i)throw Error(ye(190))}if(t.tag!==3)throw Error(ye(188));return t.stateNode.current===t?n:e}function rO(n){return n=a8(n),n!==null?sO(n):null}function sO(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=sO(n);if(e!==null)return e;n=n.sibling}return null}var aO=Lr.unstable_scheduleCallback,Ok=Lr.unstable_cancelCallback,o8=Lr.unstable_shouldYield,l8=Lr.unstable_requestPaint,fn=Lr.unstable_now,u8=Lr.unstable_getCurrentPriorityLevel,M2=Lr.unstable_ImmediatePriority,oO=Lr.unstable_UserBlockingPriority,Uw=Lr.unstable_NormalPriority,c8=Lr.unstable_LowPriority,lO=Lr.unstable_IdlePriority,p1=null,Da=null;function d8(n){if(Da&&typeof Da.onCommitFiberRoot=="function")try{Da.onCommitFiberRoot(p1,n,void 0,(n.current.flags&128)===128)}catch{}}var Us=Math.clz32?Math.clz32:p8,h8=Math.log,f8=Math.LN2;function p8(n){return n>>>=0,n===0?32:31-(h8(n)/f8|0)|0}var t0=64,n0=4194304;function Qm(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Hw(n,e){var t=n.pendingLanes;if(t===0)return 0;var i=0,r=n.suspendedLanes,s=n.pingedLanes,a=t&268435455;if(a!==0){var o=a&~r;o!==0?i=Qm(o):(s&=a,s!==0&&(i=Qm(s)))}else a=t&~r,a!==0?i=Qm(a):s!==0&&(i=Qm(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=i;0<e;)t=31-Us(e),r=1<<t,i|=n[t],e&=~r;return i}function m8(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function g8(n,e){for(var t=n.suspendedLanes,i=n.pingedLanes,r=n.expirationTimes,s=n.pendingLanes;0<s;){var a=31-Us(s),o=1<<a,l=r[a];l===-1?(!(o&t)||o&i)&&(r[a]=m8(o,e)):l<=e&&(n.expiredLanes|=o),s&=~o}}function VA(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function uO(){var n=t0;return t0<<=1,!(t0&4194240)&&(t0=64),n}function Dx(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function X_(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Us(e),n[e]=t}function y8(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var i=n.eventTimes;for(n=n.expirationTimes;0<t;){var r=31-Us(t),s=1<<r;e[r]=0,i[r]=-1,n[r]=-1,t&=~s}}function O2(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var i=31-Us(t),r=1<<i;r&e|n[i]&e&&(n[i]|=e),t&=~r}}var It=0;function cO(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var dO,L2,hO,fO,pO,jA=!1,i0=[],cu=null,du=null,hu=null,Yg=new Map,Xg=new Map,Al=[],_8="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lk(n,e){switch(n){case"focusin":case"focusout":cu=null;break;case"dragenter":case"dragleave":du=null;break;case"mouseover":case"mouseout":hu=null;break;case"pointerover":case"pointerout":Yg.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Xg.delete(e.pointerId)}}function Im(n,e,t,i,r,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=J_(e),e!==null&&L2(e)),n):(n.eventSystemFlags|=i,e=n.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),n)}function v8(n,e,t,i,r){switch(e){case"focusin":return cu=Im(cu,n,e,t,i,r),!0;case"dragenter":return du=Im(du,n,e,t,i,r),!0;case"mouseover":return hu=Im(hu,n,e,t,i,r),!0;case"pointerover":var s=r.pointerId;return Yg.set(s,Im(Yg.get(s)||null,n,e,t,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Xg.set(s,Im(Xg.get(s)||null,n,e,t,i,r)),!0}return!1}function mO(n){var e=Tc(n.target);if(e!==null){var t=sh(e);if(t!==null){if(e=t.tag,e===13){if(e=iO(t),e!==null){n.blockedOn=e,pO(n.priority,function(){hO(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function U0(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=BA(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var i=new t.constructor(t.type,t);OA=i,t.target.dispatchEvent(i),OA=null}else return e=J_(t),e!==null&&L2(e),n.blockedOn=t,!1;e.shift()}return!0}function Fk(n,e,t){U0(n)&&t.delete(e)}function w8(){jA=!1,cu!==null&&U0(cu)&&(cu=null),du!==null&&U0(du)&&(du=null),hu!==null&&U0(hu)&&(hu=null),Yg.forEach(Fk),Xg.forEach(Fk)}function Cm(n,e){n.blockedOn===e&&(n.blockedOn=null,jA||(jA=!0,Lr.unstable_scheduleCallback(Lr.unstable_NormalPriority,w8)))}function Qg(n){function e(r){return Cm(r,n)}if(0<i0.length){Cm(i0[0],n);for(var t=1;t<i0.length;t++){var i=i0[t];i.blockedOn===n&&(i.blockedOn=null)}}for(cu!==null&&Cm(cu,n),du!==null&&Cm(du,n),hu!==null&&Cm(hu,n),Yg.forEach(e),Xg.forEach(e),t=0;t<Al.length;t++)i=Al[t],i.blockedOn===n&&(i.blockedOn=null);for(;0<Al.length&&(t=Al[0],t.blockedOn===null);)mO(t),t.blockedOn===null&&Al.shift()}var df=rl.ReactCurrentBatchConfig,Ww=!0;function b8(n,e,t,i){var r=It,s=df.transition;df.transition=null;try{It=1,F2(n,e,t,i)}finally{It=r,df.transition=s}}function x8(n,e,t,i){var r=It,s=df.transition;df.transition=null;try{It=4,F2(n,e,t,i)}finally{It=r,df.transition=s}}function F2(n,e,t,i){if(Ww){var r=BA(n,e,t,i);if(r===null)Hx(n,e,i,qw,t),Lk(n,i);else if(v8(r,n,e,t,i))i.stopPropagation();else if(Lk(n,i),e&4&&-1<_8.indexOf(n)){for(;r!==null;){var s=J_(r);if(s!==null&&dO(s),s=BA(n,e,t,i),s===null&&Hx(n,e,i,qw,t),s===r)break;r=s}r!==null&&i.stopPropagation()}else Hx(n,e,i,null,t)}}var qw=null;function BA(n,e,t,i){if(qw=null,n=D2(i),n=Tc(n),n!==null)if(e=sh(n),e===null)n=null;else if(t=e.tag,t===13){if(n=iO(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return qw=n,null}function gO(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(u8()){case M2:return 1;case oO:return 4;case Uw:case c8:return 16;case lO:return 536870912;default:return 16}default:return 16}}var ou=null,z2=null,H0=null;function yO(){if(H0)return H0;var n,e=z2,t=e.length,i,r="value"in ou?ou.value:ou.textContent,s=r.length;for(n=0;n<t&&e[n]===r[n];n++);var a=t-n;for(i=1;i<=a&&e[t-i]===r[s-i];i++);return H0=r.slice(n,1<i?1-i:void 0)}function W0(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function r0(){return!0}function zk(){return!1}function zr(n){function e(t,i,r,s,a){this._reactName=t,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],this[o]=t?t(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?r0:zk,this.isPropagationStopped=zk,this}return nn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=r0)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=r0)},persist:function(){},isPersistent:r0}),e}var Hp={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},V2=zr(Hp),Q_=nn({},Hp,{view:0,detail:0}),E8=zr(Q_),Mx,Ox,km,m1=nn({},Q_,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:j2,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==km&&(km&&n.type==="mousemove"?(Mx=n.screenX-km.screenX,Ox=n.screenY-km.screenY):Ox=Mx=0,km=n),Mx)},movementY:function(n){return"movementY"in n?n.movementY:Ox}}),Vk=zr(m1),A8=nn({},m1,{dataTransfer:0}),T8=zr(A8),S8=nn({},Q_,{relatedTarget:0}),Lx=zr(S8),I8=nn({},Hp,{animationName:0,elapsedTime:0,pseudoElement:0}),C8=zr(I8),k8=nn({},Hp,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),$8=zr(k8),R8=nn({},Hp,{data:0}),jk=zr(R8),P8={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},N8={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},D8={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function M8(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=D8[n])?!!e[n]:!1}function j2(){return M8}var O8=nn({},Q_,{key:function(n){if(n.key){var e=P8[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=W0(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?N8[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:j2,charCode:function(n){return n.type==="keypress"?W0(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?W0(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),L8=zr(O8),F8=nn({},m1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Bk=zr(F8),z8=nn({},Q_,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:j2}),V8=zr(z8),j8=nn({},Hp,{propertyName:0,elapsedTime:0,pseudoElement:0}),B8=zr(j8),U8=nn({},m1,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),H8=zr(U8),W8=[9,13,27,32],B2=Go&&"CompositionEvent"in window,Cg=null;Go&&"documentMode"in document&&(Cg=document.documentMode);var q8=Go&&"TextEvent"in window&&!Cg,_O=Go&&(!B2||Cg&&8<Cg&&11>=Cg),Uk=" ",Hk=!1;function vO(n,e){switch(n){case"keyup":return W8.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wO(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Uh=!1;function G8(n,e){switch(n){case"compositionend":return wO(e);case"keypress":return e.which!==32?null:(Hk=!0,Uk);case"textInput":return n=e.data,n===Uk&&Hk?null:n;default:return null}}function K8(n,e){if(Uh)return n==="compositionend"||!B2&&vO(n,e)?(n=yO(),H0=z2=ou=null,Uh=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return _O&&e.locale!=="ko"?null:e.data;default:return null}}var Y8={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wk(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!Y8[n.type]:e==="textarea"}function bO(n,e,t,i){J3(i),e=Gw(e,"onChange"),0<e.length&&(t=new V2("onChange","change",null,t,i),n.push({event:t,listeners:e}))}var kg=null,Jg=null;function X8(n){PO(n,0)}function g1(n){var e=qh(n);if(W3(e))return n}function Q8(n,e){if(n==="change")return e}var xO=!1;if(Go){var Fx;if(Go){var zx="oninput"in document;if(!zx){var qk=document.createElement("div");qk.setAttribute("oninput","return;"),zx=typeof qk.oninput=="function"}Fx=zx}else Fx=!1;xO=Fx&&(!document.documentMode||9<document.documentMode)}function Gk(){kg&&(kg.detachEvent("onpropertychange",EO),Jg=kg=null)}function EO(n){if(n.propertyName==="value"&&g1(Jg)){var e=[];bO(e,Jg,n,D2(n)),nO(X8,e)}}function J8(n,e,t){n==="focusin"?(Gk(),kg=e,Jg=t,kg.attachEvent("onpropertychange",EO)):n==="focusout"&&Gk()}function Z8(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return g1(Jg)}function eH(n,e){if(n==="click")return g1(e)}function tH(n,e){if(n==="input"||n==="change")return g1(e)}function nH(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Ks=typeof Object.is=="function"?Object.is:nH;function Zg(n,e){if(Ks(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var r=t[i];if(!AA.call(e,r)||!Ks(n[r],e[r]))return!1}return!0}function Kk(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Yk(n,e){var t=Kk(n);n=0;for(var i;t;){if(t.nodeType===3){if(i=n+t.textContent.length,n<=e&&i>=e)return{node:t,offset:e-n};n=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Kk(t)}}function AO(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?AO(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function TO(){for(var n=window,e=Vw();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=Vw(n.document)}return e}function U2(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function iH(n){var e=TO(),t=n.focusedElem,i=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&AO(t.ownerDocument.documentElement,t)){if(i!==null&&U2(t)){if(e=i.start,n=i.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var r=t.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!n.extend&&s>i&&(r=i,i=s,s=r),r=Yk(t,s);var a=Yk(t,i);r&&a&&(n.rangeCount!==1||n.anchorNode!==r.node||n.anchorOffset!==r.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),n.removeAllRanges(),s>i?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var rH=Go&&"documentMode"in document&&11>=document.documentMode,Hh=null,UA=null,$g=null,HA=!1;function Xk(n,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;HA||Hh==null||Hh!==Vw(i)||(i=Hh,"selectionStart"in i&&U2(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),$g&&Zg($g,i)||($g=i,i=Gw(UA,"onSelect"),0<i.length&&(e=new V2("onSelect","select",null,e,t),n.push({event:e,listeners:i}),e.target=Hh)))}function s0(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Wh={animationend:s0("Animation","AnimationEnd"),animationiteration:s0("Animation","AnimationIteration"),animationstart:s0("Animation","AnimationStart"),transitionend:s0("Transition","TransitionEnd")},Vx={},SO={};Go&&(SO=document.createElement("div").style,"AnimationEvent"in window||(delete Wh.animationend.animation,delete Wh.animationiteration.animation,delete Wh.animationstart.animation),"TransitionEvent"in window||delete Wh.transitionend.transition);function y1(n){if(Vx[n])return Vx[n];if(!Wh[n])return n;var e=Wh[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in SO)return Vx[n]=e[t];return n}var IO=y1("animationend"),CO=y1("animationiteration"),kO=y1("animationstart"),$O=y1("transitionend"),RO=new Map,Qk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ou(n,e){RO.set(n,e),rh(e,[n])}for(var jx=0;jx<Qk.length;jx++){var Bx=Qk[jx],sH=Bx.toLowerCase(),aH=Bx[0].toUpperCase()+Bx.slice(1);Ou(sH,"on"+aH)}Ou(IO,"onAnimationEnd");Ou(CO,"onAnimationIteration");Ou(kO,"onAnimationStart");Ou("dblclick","onDoubleClick");Ou("focusin","onFocus");Ou("focusout","onBlur");Ou($O,"onTransitionEnd");Sp("onMouseEnter",["mouseout","mouseover"]);Sp("onMouseLeave",["mouseout","mouseover"]);Sp("onPointerEnter",["pointerout","pointerover"]);Sp("onPointerLeave",["pointerout","pointerover"]);rh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));rh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));rh("onBeforeInput",["compositionend","keypress","textInput","paste"]);rh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));rh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));rh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Jm="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),oH=new Set("cancel close invalid load scroll toggle".split(" ").concat(Jm));function Jk(n,e,t){var i=n.type||"unknown-event";n.currentTarget=t,s8(i,e,void 0,n),n.currentTarget=null}function PO(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var i=n[t],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var a=i.length-1;0<=a;a--){var o=i[a],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==s&&r.isPropagationStopped())break e;Jk(r,o,u),s=l}else for(a=0;a<i.length;a++){if(o=i[a],l=o.instance,u=o.currentTarget,o=o.listener,l!==s&&r.isPropagationStopped())break e;Jk(r,o,u),s=l}}}if(Bw)throw n=zA,Bw=!1,zA=null,n}function jt(n,e){var t=e[YA];t===void 0&&(t=e[YA]=new Set);var i=n+"__bubble";t.has(i)||(NO(e,n,2,!1),t.add(i))}function Ux(n,e,t){var i=0;e&&(i|=4),NO(t,n,i,e)}var a0="_reactListening"+Math.random().toString(36).slice(2);function ey(n){if(!n[a0]){n[a0]=!0,V3.forEach(function(t){t!=="selectionchange"&&(oH.has(t)||Ux(t,!1,n),Ux(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[a0]||(e[a0]=!0,Ux("selectionchange",!1,e))}}function NO(n,e,t,i){switch(gO(e)){case 1:var r=b8;break;case 4:r=x8;break;default:r=F2}t=r.bind(null,e,t,n),r=void 0,!FA||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?n.addEventListener(e,t,{capture:!0,passive:r}):n.addEventListener(e,t,!0):r!==void 0?n.addEventListener(e,t,{passive:r}):n.addEventListener(e,t,!1)}function Hx(n,e,t,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var a=i.tag;if(a===3||a===4){var o=i.stateNode.containerInfo;if(o===r||o.nodeType===8&&o.parentNode===r)break;if(a===4)for(a=i.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;a=a.return}for(;o!==null;){if(a=Tc(o),a===null)return;if(l=a.tag,l===5||l===6){i=s=a;continue e}o=o.parentNode}}i=i.return}nO(function(){var u=s,c=D2(t),h=[];e:{var f=RO.get(n);if(f!==void 0){var m=V2,y=n;switch(n){case"keypress":if(W0(t)===0)break e;case"keydown":case"keyup":m=L8;break;case"focusin":y="focus",m=Lx;break;case"focusout":y="blur",m=Lx;break;case"beforeblur":case"afterblur":m=Lx;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=Vk;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=T8;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=V8;break;case IO:case CO:case kO:m=C8;break;case $O:m=B8;break;case"scroll":m=E8;break;case"wheel":m=H8;break;case"copy":case"cut":case"paste":m=$8;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=Bk}var _=(e&4)!==0,x=!_&&n==="scroll",v=_?f!==null?f+"Capture":null:f;_=[];for(var w=u,E;w!==null;){E=w;var k=E.stateNode;if(E.tag===5&&k!==null&&(E=k,v!==null&&(k=Kg(w,v),k!=null&&_.push(ty(w,k,E)))),x)break;w=w.return}0<_.length&&(f=new m(f,y,null,t,c),h.push({event:f,listeners:_}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",m=n==="mouseout"||n==="pointerout",f&&t!==OA&&(y=t.relatedTarget||t.fromElement)&&(Tc(y)||y[Ko]))break e;if((m||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,m?(y=t.relatedTarget||t.toElement,m=u,y=y?Tc(y):null,y!==null&&(x=sh(y),y!==x||y.tag!==5&&y.tag!==6)&&(y=null)):(m=null,y=u),m!==y)){if(_=Vk,k="onMouseLeave",v="onMouseEnter",w="mouse",(n==="pointerout"||n==="pointerover")&&(_=Bk,k="onPointerLeave",v="onPointerEnter",w="pointer"),x=m==null?f:qh(m),E=y==null?f:qh(y),f=new _(k,w+"leave",m,t,c),f.target=x,f.relatedTarget=E,k=null,Tc(c)===u&&(_=new _(v,w+"enter",y,t,c),_.target=E,_.relatedTarget=x,k=_),x=k,m&&y)t:{for(_=m,v=y,w=0,E=_;E;E=Ih(E))w++;for(E=0,k=v;k;k=Ih(k))E++;for(;0<w-E;)_=Ih(_),w--;for(;0<E-w;)v=Ih(v),E--;for(;w--;){if(_===v||v!==null&&_===v.alternate)break t;_=Ih(_),v=Ih(v)}_=null}else _=null;m!==null&&Zk(h,f,m,_,!1),y!==null&&x!==null&&Zk(h,x,y,_,!0)}}e:{if(f=u?qh(u):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var $=Q8;else if(Wk(f))if(xO)$=tH;else{$=Z8;var L=J8}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&($=eH);if($&&($=$(n,u))){bO(h,$,t,c);break e}L&&L(n,f,u),n==="focusout"&&(L=f._wrapperState)&&L.controlled&&f.type==="number"&&RA(f,"number",f.value)}switch(L=u?qh(u):window,n){case"focusin":(Wk(L)||L.contentEditable==="true")&&(Hh=L,UA=u,$g=null);break;case"focusout":$g=UA=Hh=null;break;case"mousedown":HA=!0;break;case"contextmenu":case"mouseup":case"dragend":HA=!1,Xk(h,t,c);break;case"selectionchange":if(rH)break;case"keydown":case"keyup":Xk(h,t,c)}var I;if(B2)e:{switch(n){case"compositionstart":var C="onCompositionStart";break e;case"compositionend":C="onCompositionEnd";break e;case"compositionupdate":C="onCompositionUpdate";break e}C=void 0}else Uh?vO(n,t)&&(C="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(C="onCompositionStart");C&&(_O&&t.locale!=="ko"&&(Uh||C!=="onCompositionStart"?C==="onCompositionEnd"&&Uh&&(I=yO()):(ou=c,z2="value"in ou?ou.value:ou.textContent,Uh=!0)),L=Gw(u,C),0<L.length&&(C=new jk(C,n,null,t,c),h.push({event:C,listeners:L}),I?C.data=I:(I=wO(t),I!==null&&(C.data=I)))),(I=q8?G8(n,t):K8(n,t))&&(u=Gw(u,"onBeforeInput"),0<u.length&&(c=new jk("onBeforeInput","beforeinput",null,t,c),h.push({event:c,listeners:u}),c.data=I))}PO(h,e)})}function ty(n,e,t){return{instance:n,listener:e,currentTarget:t}}function Gw(n,e){for(var t=e+"Capture",i=[];n!==null;){var r=n,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=Kg(n,t),s!=null&&i.unshift(ty(n,s,r)),s=Kg(n,e),s!=null&&i.push(ty(n,s,r))),n=n.return}return i}function Ih(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Zk(n,e,t,i,r){for(var s=e._reactName,a=[];t!==null&&t!==i;){var o=t,l=o.alternate,u=o.stateNode;if(l!==null&&l===i)break;o.tag===5&&u!==null&&(o=u,r?(l=Kg(t,s),l!=null&&a.unshift(ty(t,l,o))):r||(l=Kg(t,s),l!=null&&a.push(ty(t,l,o)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var lH=/\r\n?/g,uH=/\u0000|\uFFFD/g;function e$(n){return(typeof n=="string"?n:""+n).replace(lH,`
`).replace(uH,"")}function o0(n,e,t){if(e=e$(e),e$(n)!==e&&t)throw Error(ye(425))}function Kw(){}var WA=null,qA=null;function GA(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var KA=typeof setTimeout=="function"?setTimeout:void 0,cH=typeof clearTimeout=="function"?clearTimeout:void 0,t$=typeof Promise=="function"?Promise:void 0,dH=typeof queueMicrotask=="function"?queueMicrotask:typeof t$<"u"?function(n){return t$.resolve(null).then(n).catch(hH)}:KA;function hH(n){setTimeout(function(){throw n})}function Wx(n,e){var t=e,i=0;do{var r=t.nextSibling;if(n.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(i===0){n.removeChild(r),Qg(e);return}i--}else t!=="$"&&t!=="$?"&&t!=="$!"||i++;t=r}while(t);Qg(e)}function fu(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function n$(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Wp=Math.random().toString(36).slice(2),Pa="__reactFiber$"+Wp,ny="__reactProps$"+Wp,Ko="__reactContainer$"+Wp,YA="__reactEvents$"+Wp,fH="__reactListeners$"+Wp,pH="__reactHandles$"+Wp;function Tc(n){var e=n[Pa];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Ko]||t[Pa]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=n$(n);n!==null;){if(t=n[Pa])return t;n=n$(n)}return e}n=t,t=n.parentNode}return null}function J_(n){return n=n[Pa]||n[Ko],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function qh(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(ye(33))}function _1(n){return n[ny]||null}var XA=[],Gh=-1;function Lu(n){return{current:n}}function Ut(n){0>Gh||(n.current=XA[Gh],XA[Gh]=null,Gh--)}function Vt(n,e){Gh++,XA[Gh]=n.current,n.current=e}var Au={},Ei=Lu(Au),rr=Lu(!1),Fd=Au;function Ip(n,e){var t=n.type.contextTypes;if(!t)return Au;var i=n.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in t)r[s]=e[s];return i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=r),r}function sr(n){return n=n.childContextTypes,n!=null}function Yw(){Ut(rr),Ut(Ei)}function i$(n,e,t){if(Ei.current!==Au)throw Error(ye(168));Vt(Ei,e),Vt(rr,t)}function DO(n,e,t){var i=n.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return t;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(ye(108,J6(n)||"Unknown",r));return nn({},t,i)}function Xw(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Au,Fd=Ei.current,Vt(Ei,n),Vt(rr,rr.current),!0}function r$(n,e,t){var i=n.stateNode;if(!i)throw Error(ye(169));t?(n=DO(n,e,Fd),i.__reactInternalMemoizedMergedChildContext=n,Ut(rr),Ut(Ei),Vt(Ei,n)):Ut(rr),Vt(rr,t)}var lo=null,v1=!1,qx=!1;function MO(n){lo===null?lo=[n]:lo.push(n)}function mH(n){v1=!0,MO(n)}function Fu(){if(!qx&&lo!==null){qx=!0;var n=0,e=It;try{var t=lo;for(It=1;n<t.length;n++){var i=t[n];do i=i(!0);while(i!==null)}lo=null,v1=!1}catch(r){throw lo!==null&&(lo=lo.slice(n+1)),aO(M2,Fu),r}finally{It=e,qx=!1}}return null}var Kh=[],Yh=0,Qw=null,Jw=0,Qr=[],Jr=0,zd=null,Lo=1,Fo="";function fc(n,e){Kh[Yh++]=Jw,Kh[Yh++]=Qw,Qw=n,Jw=e}function OO(n,e,t){Qr[Jr++]=Lo,Qr[Jr++]=Fo,Qr[Jr++]=zd,zd=n;var i=Lo;n=Fo;var r=32-Us(i)-1;i&=~(1<<r),t+=1;var s=32-Us(e)+r;if(30<s){var a=r-r%5;s=(i&(1<<a)-1).toString(32),i>>=a,r-=a,Lo=1<<32-Us(e)+r|t<<r|i,Fo=s+n}else Lo=1<<s|t<<r|i,Fo=n}function H2(n){n.return!==null&&(fc(n,1),OO(n,1,0))}function W2(n){for(;n===Qw;)Qw=Kh[--Yh],Kh[Yh]=null,Jw=Kh[--Yh],Kh[Yh]=null;for(;n===zd;)zd=Qr[--Jr],Qr[Jr]=null,Fo=Qr[--Jr],Qr[Jr]=null,Lo=Qr[--Jr],Qr[Jr]=null}var Dr=null,Pr=null,Kt=!1,Fs=null;function LO(n,e){var t=ts(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function s$(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Dr=n,Pr=fu(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Dr=n,Pr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=zd!==null?{id:Lo,overflow:Fo}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=ts(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Dr=n,Pr=null,!0):!1;default:return!1}}function QA(n){return(n.mode&1)!==0&&(n.flags&128)===0}function JA(n){if(Kt){var e=Pr;if(e){var t=e;if(!s$(n,e)){if(QA(n))throw Error(ye(418));e=fu(t.nextSibling);var i=Dr;e&&s$(n,e)?LO(i,t):(n.flags=n.flags&-4097|2,Kt=!1,Dr=n)}}else{if(QA(n))throw Error(ye(418));n.flags=n.flags&-4097|2,Kt=!1,Dr=n}}}function a$(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Dr=n}function l0(n){if(n!==Dr)return!1;if(!Kt)return a$(n),Kt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!GA(n.type,n.memoizedProps)),e&&(e=Pr)){if(QA(n))throw FO(),Error(ye(418));for(;e;)LO(n,e),e=fu(e.nextSibling)}if(a$(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(ye(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Pr=fu(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Pr=null}}else Pr=Dr?fu(n.stateNode.nextSibling):null;return!0}function FO(){for(var n=Pr;n;)n=fu(n.nextSibling)}function Cp(){Pr=Dr=null,Kt=!1}function q2(n){Fs===null?Fs=[n]:Fs.push(n)}var gH=rl.ReactCurrentBatchConfig;function $m(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(ye(309));var i=t.stateNode}if(!i)throw Error(ye(147,n));var r=i,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(a){var o=r.refs;a===null?delete o[s]:o[s]=a},e._stringRef=s,e)}if(typeof n!="string")throw Error(ye(284));if(!t._owner)throw Error(ye(290,n))}return n}function u0(n,e){throw n=Object.prototype.toString.call(e),Error(ye(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function o$(n){var e=n._init;return e(n._payload)}function zO(n){function e(v,w){if(n){var E=v.deletions;E===null?(v.deletions=[w],v.flags|=16):E.push(w)}}function t(v,w){if(!n)return null;for(;w!==null;)e(v,w),w=w.sibling;return null}function i(v,w){for(v=new Map;w!==null;)w.key!==null?v.set(w.key,w):v.set(w.index,w),w=w.sibling;return v}function r(v,w){return v=yu(v,w),v.index=0,v.sibling=null,v}function s(v,w,E){return v.index=E,n?(E=v.alternate,E!==null?(E=E.index,E<w?(v.flags|=2,w):E):(v.flags|=2,w)):(v.flags|=1048576,w)}function a(v){return n&&v.alternate===null&&(v.flags|=2),v}function o(v,w,E,k){return w===null||w.tag!==6?(w=Zx(E,v.mode,k),w.return=v,w):(w=r(w,E),w.return=v,w)}function l(v,w,E,k){var $=E.type;return $===Bh?c(v,w,E.props.children,k,E.key):w!==null&&(w.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===xl&&o$($)===w.type)?(k=r(w,E.props),k.ref=$m(v,w,E),k.return=v,k):(k=J0(E.type,E.key,E.props,null,v.mode,k),k.ref=$m(v,w,E),k.return=v,k)}function u(v,w,E,k){return w===null||w.tag!==4||w.stateNode.containerInfo!==E.containerInfo||w.stateNode.implementation!==E.implementation?(w=eE(E,v.mode,k),w.return=v,w):(w=r(w,E.children||[]),w.return=v,w)}function c(v,w,E,k,$){return w===null||w.tag!==7?(w=Dd(E,v.mode,k,$),w.return=v,w):(w=r(w,E),w.return=v,w)}function h(v,w,E){if(typeof w=="string"&&w!==""||typeof w=="number")return w=Zx(""+w,v.mode,E),w.return=v,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Jv:return E=J0(w.type,w.key,w.props,null,v.mode,E),E.ref=$m(v,null,w),E.return=v,E;case jh:return w=eE(w,v.mode,E),w.return=v,w;case xl:var k=w._init;return h(v,k(w._payload),E)}if(Xm(w)||Tm(w))return w=Dd(w,v.mode,E,null),w.return=v,w;u0(v,w)}return null}function f(v,w,E,k){var $=w!==null?w.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return $!==null?null:o(v,w,""+E,k);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case Jv:return E.key===$?l(v,w,E,k):null;case jh:return E.key===$?u(v,w,E,k):null;case xl:return $=E._init,f(v,w,$(E._payload),k)}if(Xm(E)||Tm(E))return $!==null?null:c(v,w,E,k,null);u0(v,E)}return null}function m(v,w,E,k,$){if(typeof k=="string"&&k!==""||typeof k=="number")return v=v.get(E)||null,o(w,v,""+k,$);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case Jv:return v=v.get(k.key===null?E:k.key)||null,l(w,v,k,$);case jh:return v=v.get(k.key===null?E:k.key)||null,u(w,v,k,$);case xl:var L=k._init;return m(v,w,E,L(k._payload),$)}if(Xm(k)||Tm(k))return v=v.get(E)||null,c(w,v,k,$,null);u0(w,k)}return null}function y(v,w,E,k){for(var $=null,L=null,I=w,C=w=0,N=null;I!==null&&C<E.length;C++){I.index>C?(N=I,I=null):N=I.sibling;var O=f(v,I,E[C],k);if(O===null){I===null&&(I=N);break}n&&I&&O.alternate===null&&e(v,I),w=s(O,w,C),L===null?$=O:L.sibling=O,L=O,I=N}if(C===E.length)return t(v,I),Kt&&fc(v,C),$;if(I===null){for(;C<E.length;C++)I=h(v,E[C],k),I!==null&&(w=s(I,w,C),L===null?$=I:L.sibling=I,L=I);return Kt&&fc(v,C),$}for(I=i(v,I);C<E.length;C++)N=m(I,v,C,E[C],k),N!==null&&(n&&N.alternate!==null&&I.delete(N.key===null?C:N.key),w=s(N,w,C),L===null?$=N:L.sibling=N,L=N);return n&&I.forEach(function(V){return e(v,V)}),Kt&&fc(v,C),$}function _(v,w,E,k){var $=Tm(E);if(typeof $!="function")throw Error(ye(150));if(E=$.call(E),E==null)throw Error(ye(151));for(var L=$=null,I=w,C=w=0,N=null,O=E.next();I!==null&&!O.done;C++,O=E.next()){I.index>C?(N=I,I=null):N=I.sibling;var V=f(v,I,O.value,k);if(V===null){I===null&&(I=N);break}n&&I&&V.alternate===null&&e(v,I),w=s(V,w,C),L===null?$=V:L.sibling=V,L=V,I=N}if(O.done)return t(v,I),Kt&&fc(v,C),$;if(I===null){for(;!O.done;C++,O=E.next())O=h(v,O.value,k),O!==null&&(w=s(O,w,C),L===null?$=O:L.sibling=O,L=O);return Kt&&fc(v,C),$}for(I=i(v,I);!O.done;C++,O=E.next())O=m(I,v,C,O.value,k),O!==null&&(n&&O.alternate!==null&&I.delete(O.key===null?C:O.key),w=s(O,w,C),L===null?$=O:L.sibling=O,L=O);return n&&I.forEach(function(U){return e(v,U)}),Kt&&fc(v,C),$}function x(v,w,E,k){if(typeof E=="object"&&E!==null&&E.type===Bh&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case Jv:e:{for(var $=E.key,L=w;L!==null;){if(L.key===$){if($=E.type,$===Bh){if(L.tag===7){t(v,L.sibling),w=r(L,E.props.children),w.return=v,v=w;break e}}else if(L.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===xl&&o$($)===L.type){t(v,L.sibling),w=r(L,E.props),w.ref=$m(v,L,E),w.return=v,v=w;break e}t(v,L);break}else e(v,L);L=L.sibling}E.type===Bh?(w=Dd(E.props.children,v.mode,k,E.key),w.return=v,v=w):(k=J0(E.type,E.key,E.props,null,v.mode,k),k.ref=$m(v,w,E),k.return=v,v=k)}return a(v);case jh:e:{for(L=E.key;w!==null;){if(w.key===L)if(w.tag===4&&w.stateNode.containerInfo===E.containerInfo&&w.stateNode.implementation===E.implementation){t(v,w.sibling),w=r(w,E.children||[]),w.return=v,v=w;break e}else{t(v,w);break}else e(v,w);w=w.sibling}w=eE(E,v.mode,k),w.return=v,v=w}return a(v);case xl:return L=E._init,x(v,w,L(E._payload),k)}if(Xm(E))return y(v,w,E,k);if(Tm(E))return _(v,w,E,k);u0(v,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,w!==null&&w.tag===6?(t(v,w.sibling),w=r(w,E),w.return=v,v=w):(t(v,w),w=Zx(E,v.mode,k),w.return=v,v=w),a(v)):t(v,w)}return x}var kp=zO(!0),VO=zO(!1),Zw=Lu(null),eb=null,Xh=null,G2=null;function K2(){G2=Xh=eb=null}function Y2(n){var e=Zw.current;Ut(Zw),n._currentValue=e}function ZA(n,e,t){for(;n!==null;){var i=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),n===t)break;n=n.return}}function hf(n,e){eb=n,G2=Xh=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(ir=!0),n.firstContext=null)}function ss(n){var e=n._currentValue;if(G2!==n)if(n={context:n,memoizedValue:e,next:null},Xh===null){if(eb===null)throw Error(ye(308));Xh=n,eb.dependencies={lanes:0,firstContext:n}}else Xh=Xh.next=n;return e}var Sc=null;function X2(n){Sc===null?Sc=[n]:Sc.push(n)}function jO(n,e,t,i){var r=e.interleaved;return r===null?(t.next=t,X2(e)):(t.next=r.next,r.next=t),e.interleaved=t,Yo(n,i)}function Yo(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var El=!1;function Q2(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function BO(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function jo(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function pu(n,e,t){var i=n.updateQueue;if(i===null)return null;if(i=i.shared,gt&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Yo(n,t)}return r=i.interleaved,r===null?(e.next=e,X2(i)):(e.next=r.next,r.next=e),i.interleaved=e,Yo(n,t)}function q0(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,O2(n,t)}}function l$(n,e){var t=n.updateQueue,i=n.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var r=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?r=s=a:s=s.next=a,t=t.next}while(t!==null);s===null?r=s=e:s=s.next=e}else r=s=e;t={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function tb(n,e,t,i){var r=n.updateQueue;El=!1;var s=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(o!==null){r.shared.pending=null;var l=o,u=l.next;l.next=null,a===null?s=u:a.next=u,a=l;var c=n.alternate;c!==null&&(c=c.updateQueue,o=c.lastBaseUpdate,o!==a&&(o===null?c.firstBaseUpdate=u:o.next=u,c.lastBaseUpdate=l))}if(s!==null){var h=r.baseState;a=0,c=u=l=null,o=s;do{var f=o.lane,m=o.eventTime;if((i&f)===f){c!==null&&(c=c.next={eventTime:m,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var y=n,_=o;switch(f=e,m=t,_.tag){case 1:if(y=_.payload,typeof y=="function"){h=y.call(m,h,f);break e}h=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=_.payload,f=typeof y=="function"?y.call(m,h,f):y,f==null)break e;h=nn({},h,f);break e;case 2:El=!0}}o.callback!==null&&o.lane!==0&&(n.flags|=64,f=r.effects,f===null?r.effects=[o]:f.push(o))}else m={eventTime:m,lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},c===null?(u=c=m,l=h):c=c.next=m,a|=f;if(o=o.next,o===null){if(o=r.shared.pending,o===null)break;f=o,o=f.next,f.next=null,r.lastBaseUpdate=f,r.shared.pending=null}}while(!0);if(c===null&&(l=h),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=c,e=r.shared.interleaved,e!==null){r=e;do a|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);jd|=a,n.lanes=a,n.memoizedState=h}}function u$(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var i=n[e],r=i.callback;if(r!==null){if(i.callback=null,i=t,typeof r!="function")throw Error(ye(191,r));r.call(i)}}}var Z_={},Ma=Lu(Z_),iy=Lu(Z_),ry=Lu(Z_);function Ic(n){if(n===Z_)throw Error(ye(174));return n}function J2(n,e){switch(Vt(ry,e),Vt(iy,n),Vt(Ma,Z_),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:NA(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=NA(e,n)}Ut(Ma),Vt(Ma,e)}function $p(){Ut(Ma),Ut(iy),Ut(ry)}function UO(n){Ic(ry.current);var e=Ic(Ma.current),t=NA(e,n.type);e!==t&&(Vt(iy,n),Vt(Ma,t))}function Z2(n){iy.current===n&&(Ut(Ma),Ut(iy))}var Zt=Lu(0);function nb(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Gx=[];function eI(){for(var n=0;n<Gx.length;n++)Gx[n]._workInProgressVersionPrimary=null;Gx.length=0}var G0=rl.ReactCurrentDispatcher,Kx=rl.ReactCurrentBatchConfig,Vd=0,tn=null,Cn=null,Wn=null,ib=!1,Rg=!1,sy=0,yH=0;function oi(){throw Error(ye(321))}function tI(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Ks(n[t],e[t]))return!1;return!0}function nI(n,e,t,i,r,s){if(Vd=s,tn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,G0.current=n===null||n.memoizedState===null?bH:xH,n=t(i,r),Rg){s=0;do{if(Rg=!1,sy=0,25<=s)throw Error(ye(301));s+=1,Wn=Cn=null,e.updateQueue=null,G0.current=EH,n=t(i,r)}while(Rg)}if(G0.current=rb,e=Cn!==null&&Cn.next!==null,Vd=0,Wn=Cn=tn=null,ib=!1,e)throw Error(ye(300));return n}function iI(){var n=sy!==0;return sy=0,n}function fa(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Wn===null?tn.memoizedState=Wn=n:Wn=Wn.next=n,Wn}function as(){if(Cn===null){var n=tn.alternate;n=n!==null?n.memoizedState:null}else n=Cn.next;var e=Wn===null?tn.memoizedState:Wn.next;if(e!==null)Wn=e,Cn=n;else{if(n===null)throw Error(ye(310));Cn=n,n={memoizedState:Cn.memoizedState,baseState:Cn.baseState,baseQueue:Cn.baseQueue,queue:Cn.queue,next:null},Wn===null?tn.memoizedState=Wn=n:Wn=Wn.next=n}return Wn}function ay(n,e){return typeof e=="function"?e(n):e}function Yx(n){var e=as(),t=e.queue;if(t===null)throw Error(ye(311));t.lastRenderedReducer=n;var i=Cn,r=i.baseQueue,s=t.pending;if(s!==null){if(r!==null){var a=r.next;r.next=s.next,s.next=a}i.baseQueue=r=s,t.pending=null}if(r!==null){s=r.next,i=i.baseState;var o=a=null,l=null,u=s;do{var c=u.lane;if((Vd&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:n(i,u.action);else{var h={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(o=l=h,a=i):l=l.next=h,tn.lanes|=c,jd|=c}u=u.next}while(u!==null&&u!==s);l===null?a=i:l.next=o,Ks(i,e.memoizedState)||(ir=!0),e.memoizedState=i,e.baseState=a,e.baseQueue=l,t.lastRenderedState=i}if(n=t.interleaved,n!==null){r=n;do s=r.lane,tn.lanes|=s,jd|=s,r=r.next;while(r!==n)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Xx(n){var e=as(),t=e.queue;if(t===null)throw Error(ye(311));t.lastRenderedReducer=n;var i=t.dispatch,r=t.pending,s=e.memoizedState;if(r!==null){t.pending=null;var a=r=r.next;do s=n(s,a.action),a=a.next;while(a!==r);Ks(s,e.memoizedState)||(ir=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,i]}function HO(){}function WO(n,e){var t=tn,i=as(),r=e(),s=!Ks(i.memoizedState,r);if(s&&(i.memoizedState=r,ir=!0),i=i.queue,rI(KO.bind(null,t,i,n),[n]),i.getSnapshot!==e||s||Wn!==null&&Wn.memoizedState.tag&1){if(t.flags|=2048,oy(9,GO.bind(null,t,i,r,e),void 0,null),Gn===null)throw Error(ye(349));Vd&30||qO(t,e,r)}return r}function qO(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=tn.updateQueue,e===null?(e={lastEffect:null,stores:null},tn.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function GO(n,e,t,i){e.value=t,e.getSnapshot=i,YO(e)&&XO(n)}function KO(n,e,t){return t(function(){YO(e)&&XO(n)})}function YO(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Ks(n,t)}catch{return!0}}function XO(n){var e=Yo(n,1);e!==null&&Hs(e,n,1,-1)}function c$(n){var e=fa();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ay,lastRenderedState:n},e.queue=n,n=n.dispatch=wH.bind(null,tn,n),[e.memoizedState,n]}function oy(n,e,t,i){return n={tag:n,create:e,destroy:t,deps:i,next:null},e=tn.updateQueue,e===null?(e={lastEffect:null,stores:null},tn.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(i=t.next,t.next=n,n.next=i,e.lastEffect=n)),n}function QO(){return as().memoizedState}function K0(n,e,t,i){var r=fa();tn.flags|=n,r.memoizedState=oy(1|e,t,void 0,i===void 0?null:i)}function w1(n,e,t,i){var r=as();i=i===void 0?null:i;var s=void 0;if(Cn!==null){var a=Cn.memoizedState;if(s=a.destroy,i!==null&&tI(i,a.deps)){r.memoizedState=oy(e,t,s,i);return}}tn.flags|=n,r.memoizedState=oy(1|e,t,s,i)}function d$(n,e){return K0(8390656,8,n,e)}function rI(n,e){return w1(2048,8,n,e)}function JO(n,e){return w1(4,2,n,e)}function ZO(n,e){return w1(4,4,n,e)}function eL(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function tL(n,e,t){return t=t!=null?t.concat([n]):null,w1(4,4,eL.bind(null,e,n),t)}function sI(){}function nL(n,e){var t=as();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&tI(e,i[1])?i[0]:(t.memoizedState=[n,e],n)}function iL(n,e){var t=as();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&tI(e,i[1])?i[0]:(n=n(),t.memoizedState=[n,e],n)}function rL(n,e,t){return Vd&21?(Ks(t,e)||(t=uO(),tn.lanes|=t,jd|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,ir=!0),n.memoizedState=t)}function _H(n,e){var t=It;It=t!==0&&4>t?t:4,n(!0);var i=Kx.transition;Kx.transition={};try{n(!1),e()}finally{It=t,Kx.transition=i}}function sL(){return as().memoizedState}function vH(n,e,t){var i=gu(n);if(t={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null},aL(n))oL(e,t);else if(t=jO(n,e,t,i),t!==null){var r=Mi();Hs(t,n,i,r),lL(t,e,i)}}function wH(n,e,t){var i=gu(n),r={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null};if(aL(n))oL(e,r);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var a=e.lastRenderedState,o=s(a,t);if(r.hasEagerState=!0,r.eagerState=o,Ks(o,a)){var l=e.interleaved;l===null?(r.next=r,X2(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}t=jO(n,e,r,i),t!==null&&(r=Mi(),Hs(t,n,i,r),lL(t,e,i))}}function aL(n){var e=n.alternate;return n===tn||e!==null&&e===tn}function oL(n,e){Rg=ib=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function lL(n,e,t){if(t&4194240){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,O2(n,t)}}var rb={readContext:ss,useCallback:oi,useContext:oi,useEffect:oi,useImperativeHandle:oi,useInsertionEffect:oi,useLayoutEffect:oi,useMemo:oi,useReducer:oi,useRef:oi,useState:oi,useDebugValue:oi,useDeferredValue:oi,useTransition:oi,useMutableSource:oi,useSyncExternalStore:oi,useId:oi,unstable_isNewReconciler:!1},bH={readContext:ss,useCallback:function(n,e){return fa().memoizedState=[n,e===void 0?null:e],n},useContext:ss,useEffect:d$,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,K0(4194308,4,eL.bind(null,e,n),t)},useLayoutEffect:function(n,e){return K0(4194308,4,n,e)},useInsertionEffect:function(n,e){return K0(4,2,n,e)},useMemo:function(n,e){var t=fa();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var i=fa();return e=t!==void 0?t(e):e,i.memoizedState=i.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},i.queue=n,n=n.dispatch=vH.bind(null,tn,n),[i.memoizedState,n]},useRef:function(n){var e=fa();return n={current:n},e.memoizedState=n},useState:c$,useDebugValue:sI,useDeferredValue:function(n){return fa().memoizedState=n},useTransition:function(){var n=c$(!1),e=n[0];return n=_H.bind(null,n[1]),fa().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var i=tn,r=fa();if(Kt){if(t===void 0)throw Error(ye(407));t=t()}else{if(t=e(),Gn===null)throw Error(ye(349));Vd&30||qO(i,e,t)}r.memoizedState=t;var s={value:t,getSnapshot:e};return r.queue=s,d$(KO.bind(null,i,s,n),[n]),i.flags|=2048,oy(9,GO.bind(null,i,s,t,e),void 0,null),t},useId:function(){var n=fa(),e=Gn.identifierPrefix;if(Kt){var t=Fo,i=Lo;t=(i&~(1<<32-Us(i)-1)).toString(32)+t,e=":"+e+"R"+t,t=sy++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=yH++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},xH={readContext:ss,useCallback:nL,useContext:ss,useEffect:rI,useImperativeHandle:tL,useInsertionEffect:JO,useLayoutEffect:ZO,useMemo:iL,useReducer:Yx,useRef:QO,useState:function(){return Yx(ay)},useDebugValue:sI,useDeferredValue:function(n){var e=as();return rL(e,Cn.memoizedState,n)},useTransition:function(){var n=Yx(ay)[0],e=as().memoizedState;return[n,e]},useMutableSource:HO,useSyncExternalStore:WO,useId:sL,unstable_isNewReconciler:!1},EH={readContext:ss,useCallback:nL,useContext:ss,useEffect:rI,useImperativeHandle:tL,useInsertionEffect:JO,useLayoutEffect:ZO,useMemo:iL,useReducer:Xx,useRef:QO,useState:function(){return Xx(ay)},useDebugValue:sI,useDeferredValue:function(n){var e=as();return Cn===null?e.memoizedState=n:rL(e,Cn.memoizedState,n)},useTransition:function(){var n=Xx(ay)[0],e=as().memoizedState;return[n,e]},useMutableSource:HO,useSyncExternalStore:WO,useId:sL,unstable_isNewReconciler:!1};function Es(n,e){if(n&&n.defaultProps){e=nn({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function eT(n,e,t,i){e=n.memoizedState,t=t(i,e),t=t==null?e:nn({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var b1={isMounted:function(n){return(n=n._reactInternals)?sh(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var i=Mi(),r=gu(n),s=jo(i,r);s.payload=e,t!=null&&(s.callback=t),e=pu(n,s,r),e!==null&&(Hs(e,n,r,i),q0(e,n,r))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var i=Mi(),r=gu(n),s=jo(i,r);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=pu(n,s,r),e!==null&&(Hs(e,n,r,i),q0(e,n,r))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Mi(),i=gu(n),r=jo(t,i);r.tag=2,e!=null&&(r.callback=e),e=pu(n,r,i),e!==null&&(Hs(e,n,i,t),q0(e,n,i))}};function h$(n,e,t,i,r,s,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(i,s,a):e.prototype&&e.prototype.isPureReactComponent?!Zg(t,i)||!Zg(r,s):!0}function uL(n,e,t){var i=!1,r=Au,s=e.contextType;return typeof s=="object"&&s!==null?s=ss(s):(r=sr(e)?Fd:Ei.current,i=e.contextTypes,s=(i=i!=null)?Ip(n,r):Au),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=b1,n.stateNode=e,e._reactInternals=n,i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=s),e}function f$(n,e,t,i){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==n&&b1.enqueueReplaceState(e,e.state,null)}function tT(n,e,t,i){var r=n.stateNode;r.props=t,r.state=n.memoizedState,r.refs={},Q2(n);var s=e.contextType;typeof s=="object"&&s!==null?r.context=ss(s):(s=sr(e)?Fd:Ei.current,r.context=Ip(n,s)),r.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(eT(n,e,s,t),r.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&b1.enqueueReplaceState(r,r.state,null),tb(n,t,r,i),r.state=n.memoizedState),typeof r.componentDidMount=="function"&&(n.flags|=4194308)}function Rp(n,e){try{var t="",i=e;do t+=Q6(i),i=i.return;while(i);var r=t}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:r,digest:null}}function Qx(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function nT(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var AH=typeof WeakMap=="function"?WeakMap:Map;function cL(n,e,t){t=jo(-1,t),t.tag=3,t.payload={element:null};var i=e.value;return t.callback=function(){ab||(ab=!0,hT=i),nT(n,e)},t}function dL(n,e,t){t=jo(-1,t),t.tag=3;var i=n.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;t.payload=function(){return i(r)},t.callback=function(){nT(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){nT(n,e),typeof i!="function"&&(mu===null?mu=new Set([this]):mu.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function p$(n,e,t){var i=n.pingCache;if(i===null){i=n.pingCache=new AH;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(t)||(r.add(t),n=FH.bind(null,n,e,t),e.then(n,n))}function m$(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function g$(n,e,t,i,r){return n.mode&1?(n.flags|=65536,n.lanes=r,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=jo(-1,1),e.tag=2,pu(t,e,1))),t.lanes|=1),n)}var TH=rl.ReactCurrentOwner,ir=!1;function Di(n,e,t,i){e.child=n===null?VO(e,null,t,i):kp(e,n.child,t,i)}function y$(n,e,t,i,r){t=t.render;var s=e.ref;return hf(e,r),i=nI(n,e,t,i,s,r),t=iI(),n!==null&&!ir?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,Xo(n,e,r)):(Kt&&t&&H2(e),e.flags|=1,Di(n,e,i,r),e.child)}function _$(n,e,t,i,r){if(n===null){var s=t.type;return typeof s=="function"&&!fI(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,hL(n,e,s,i,r)):(n=J0(t.type,null,i,e,e.mode,r),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&r)){var a=s.memoizedProps;if(t=t.compare,t=t!==null?t:Zg,t(a,i)&&n.ref===e.ref)return Xo(n,e,r)}return e.flags|=1,n=yu(s,i),n.ref=e.ref,n.return=e,e.child=n}function hL(n,e,t,i,r){if(n!==null){var s=n.memoizedProps;if(Zg(s,i)&&n.ref===e.ref)if(ir=!1,e.pendingProps=i=s,(n.lanes&r)!==0)n.flags&131072&&(ir=!0);else return e.lanes=n.lanes,Xo(n,e,r)}return iT(n,e,t,i,r)}function fL(n,e,t){var i=e.pendingProps,r=i.children,s=n!==null?n.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Vt(Jh,Sr),Sr|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Vt(Jh,Sr),Sr|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:t,Vt(Jh,Sr),Sr|=i}else s!==null?(i=s.baseLanes|t,e.memoizedState=null):i=t,Vt(Jh,Sr),Sr|=i;return Di(n,e,r,t),e.child}function pL(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function iT(n,e,t,i,r){var s=sr(t)?Fd:Ei.current;return s=Ip(e,s),hf(e,r),t=nI(n,e,t,i,s,r),i=iI(),n!==null&&!ir?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,Xo(n,e,r)):(Kt&&i&&H2(e),e.flags|=1,Di(n,e,t,r),e.child)}function v$(n,e,t,i,r){if(sr(t)){var s=!0;Xw(e)}else s=!1;if(hf(e,r),e.stateNode===null)Y0(n,e),uL(e,t,i),tT(e,t,i,r),i=!0;else if(n===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,u=t.contextType;typeof u=="object"&&u!==null?u=ss(u):(u=sr(t)?Fd:Ei.current,u=Ip(e,u));var c=t.getDerivedStateFromProps,h=typeof c=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==i||l!==u)&&f$(e,a,i,u),El=!1;var f=e.memoizedState;a.state=f,tb(e,i,a,r),l=e.memoizedState,o!==i||f!==l||rr.current||El?(typeof c=="function"&&(eT(e,t,c,i),l=e.memoizedState),(o=El||h$(e,t,o,i,f,l,u))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),a.props=i,a.state=l,a.context=u,i=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{a=e.stateNode,BO(n,e),o=e.memoizedProps,u=e.type===e.elementType?o:Es(e.type,o),a.props=u,h=e.pendingProps,f=a.context,l=t.contextType,typeof l=="object"&&l!==null?l=ss(l):(l=sr(t)?Fd:Ei.current,l=Ip(e,l));var m=t.getDerivedStateFromProps;(c=typeof m=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==h||f!==l)&&f$(e,a,i,l),El=!1,f=e.memoizedState,a.state=f,tb(e,i,a,r);var y=e.memoizedState;o!==h||f!==y||rr.current||El?(typeof m=="function"&&(eT(e,t,m,i),y=e.memoizedState),(u=El||h$(e,t,u,i,f,y,l)||!1)?(c||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(i,y,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(i,y,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=y),a.props=i,a.state=y,a.context=l,i=u):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),i=!1)}return rT(n,e,t,i,s,r)}function rT(n,e,t,i,r,s){pL(n,e);var a=(e.flags&128)!==0;if(!i&&!a)return r&&r$(e,t,!1),Xo(n,e,s);i=e.stateNode,TH.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,n!==null&&a?(e.child=kp(e,n.child,null,s),e.child=kp(e,null,o,s)):Di(n,e,o,s),e.memoizedState=i.state,r&&r$(e,t,!0),e.child}function mL(n){var e=n.stateNode;e.pendingContext?i$(n,e.pendingContext,e.pendingContext!==e.context):e.context&&i$(n,e.context,!1),J2(n,e.containerInfo)}function w$(n,e,t,i,r){return Cp(),q2(r),e.flags|=256,Di(n,e,t,i),e.child}var sT={dehydrated:null,treeContext:null,retryLane:0};function aT(n){return{baseLanes:n,cachePool:null,transitions:null}}function gL(n,e,t){var i=e.pendingProps,r=Zt.current,s=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=n!==null&&n.memoizedState===null?!1:(r&2)!==0),o?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(r|=1),Vt(Zt,r&1),n===null)return JA(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=i.children,n=i.fallback,s?(i=e.mode,s=e.child,a={mode:"hidden",children:a},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=A1(a,i,0,null),n=Dd(n,i,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=aT(t),e.memoizedState=sT,n):aI(e,a));if(r=n.memoizedState,r!==null&&(o=r.dehydrated,o!==null))return SH(n,e,a,i,o,r,t);if(s){s=i.fallback,a=e.mode,r=n.child,o=r.sibling;var l={mode:"hidden",children:i.children};return!(a&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=yu(r,l),i.subtreeFlags=r.subtreeFlags&14680064),o!==null?s=yu(o,s):(s=Dd(s,a,t,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,a=n.child.memoizedState,a=a===null?aT(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=n.childLanes&~t,e.memoizedState=sT,i}return s=n.child,n=s.sibling,i=yu(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=t),i.return=e,i.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=i,e.memoizedState=null,i}function aI(n,e){return e=A1({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function c0(n,e,t,i){return i!==null&&q2(i),kp(e,n.child,null,t),n=aI(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function SH(n,e,t,i,r,s,a){if(t)return e.flags&256?(e.flags&=-257,i=Qx(Error(ye(422))),c0(n,e,a,i)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=A1({mode:"visible",children:i.children},r,0,null),s=Dd(s,r,a,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&kp(e,n.child,null,a),e.child.memoizedState=aT(a),e.memoizedState=sT,s);if(!(e.mode&1))return c0(n,e,a,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var o=i.dgst;return i=o,s=Error(ye(419)),i=Qx(s,i,void 0),c0(n,e,a,i)}if(o=(a&n.childLanes)!==0,ir||o){if(i=Gn,i!==null){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|a)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,Yo(n,r),Hs(i,n,r,-1))}return hI(),i=Qx(Error(ye(421))),c0(n,e,a,i)}return r.data==="$?"?(e.flags|=128,e.child=n.child,e=zH.bind(null,n),r._reactRetry=e,null):(n=s.treeContext,Pr=fu(r.nextSibling),Dr=e,Kt=!0,Fs=null,n!==null&&(Qr[Jr++]=Lo,Qr[Jr++]=Fo,Qr[Jr++]=zd,Lo=n.id,Fo=n.overflow,zd=e),e=aI(e,i.children),e.flags|=4096,e)}function b$(n,e,t){n.lanes|=e;var i=n.alternate;i!==null&&(i.lanes|=e),ZA(n.return,e,t)}function Jx(n,e,t,i,r){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=t,s.tailMode=r)}function yL(n,e,t){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Di(n,e,i.children,t),i=Zt.current,i&2)i=i&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&b$(n,t,e);else if(n.tag===19)b$(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}i&=1}if(Vt(Zt,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)n=t.alternate,n!==null&&nb(n)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),Jx(e,!1,r,t,s);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(n=r.alternate,n!==null&&nb(n)===null){e.child=r;break}n=r.sibling,r.sibling=t,t=r,r=n}Jx(e,!0,t,null,s);break;case"together":Jx(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Y0(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Xo(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),jd|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(ye(153));if(e.child!==null){for(n=e.child,t=yu(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=yu(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function IH(n,e,t){switch(e.tag){case 3:mL(e),Cp();break;case 5:UO(e);break;case 1:sr(e.type)&&Xw(e);break;case 4:J2(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;Vt(Zw,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(Vt(Zt,Zt.current&1),e.flags|=128,null):t&e.child.childLanes?gL(n,e,t):(Vt(Zt,Zt.current&1),n=Xo(n,e,t),n!==null?n.sibling:null);Vt(Zt,Zt.current&1);break;case 19:if(i=(t&e.childLanes)!==0,n.flags&128){if(i)return yL(n,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Vt(Zt,Zt.current),i)break;return null;case 22:case 23:return e.lanes=0,fL(n,e,t)}return Xo(n,e,t)}var _L,oT,vL,wL;_L=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};oT=function(){};vL=function(n,e,t,i){var r=n.memoizedProps;if(r!==i){n=e.stateNode,Ic(Ma.current);var s=null;switch(t){case"input":r=kA(n,r),i=kA(n,i),s=[];break;case"select":r=nn({},r,{value:void 0}),i=nn({},i,{value:void 0}),s=[];break;case"textarea":r=PA(n,r),i=PA(n,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(n.onclick=Kw)}DA(t,i);var a;t=null;for(u in r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var o=r[u];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(qg.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in i){var l=i[u];if(o=r!=null?r[u]:void 0,i.hasOwnProperty(u)&&l!==o&&(l!=null||o!=null))if(u==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(t||(t={}),t[a]=l[a])}else t||(s||(s=[]),s.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(s=s||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(qg.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&jt("scroll",n),s||o===l||(s=[])):(s=s||[]).push(u,l))}t&&(s=s||[]).push("style",t);var u=s;(e.updateQueue=u)&&(e.flags|=4)}};wL=function(n,e,t,i){t!==i&&(e.flags|=4)};function Rm(n,e){if(!Kt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:i.sibling=null}}function li(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,i=0;if(e)for(var r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=n,r=r.sibling;else for(r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=n,r=r.sibling;return n.subtreeFlags|=i,n.childLanes=t,e}function CH(n,e,t){var i=e.pendingProps;switch(W2(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return li(e),null;case 1:return sr(e.type)&&Yw(),li(e),null;case 3:return i=e.stateNode,$p(),Ut(rr),Ut(Ei),eI(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(n===null||n.child===null)&&(l0(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Fs!==null&&(mT(Fs),Fs=null))),oT(n,e),li(e),null;case 5:Z2(e);var r=Ic(ry.current);if(t=e.type,n!==null&&e.stateNode!=null)vL(n,e,t,i,r),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(ye(166));return li(e),null}if(n=Ic(Ma.current),l0(e)){i=e.stateNode,t=e.type;var s=e.memoizedProps;switch(i[Pa]=e,i[ny]=s,n=(e.mode&1)!==0,t){case"dialog":jt("cancel",i),jt("close",i);break;case"iframe":case"object":case"embed":jt("load",i);break;case"video":case"audio":for(r=0;r<Jm.length;r++)jt(Jm[r],i);break;case"source":jt("error",i);break;case"img":case"image":case"link":jt("error",i),jt("load",i);break;case"details":jt("toggle",i);break;case"input":$k(i,s),jt("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},jt("invalid",i);break;case"textarea":Pk(i,s),jt("invalid",i)}DA(t,s),r=null;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];a==="children"?typeof o=="string"?i.textContent!==o&&(s.suppressHydrationWarning!==!0&&o0(i.textContent,o,n),r=["children",o]):typeof o=="number"&&i.textContent!==""+o&&(s.suppressHydrationWarning!==!0&&o0(i.textContent,o,n),r=["children",""+o]):qg.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&jt("scroll",i)}switch(t){case"input":Zv(i),Rk(i,s,!0);break;case"textarea":Zv(i),Nk(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=Kw)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{a=r.nodeType===9?r:r.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=K3(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof i.is=="string"?n=a.createElement(t,{is:i.is}):(n=a.createElement(t),t==="select"&&(a=n,i.multiple?a.multiple=!0:i.size&&(a.size=i.size))):n=a.createElementNS(n,t),n[Pa]=e,n[ny]=i,_L(n,e,!1,!1),e.stateNode=n;e:{switch(a=MA(t,i),t){case"dialog":jt("cancel",n),jt("close",n),r=i;break;case"iframe":case"object":case"embed":jt("load",n),r=i;break;case"video":case"audio":for(r=0;r<Jm.length;r++)jt(Jm[r],n);r=i;break;case"source":jt("error",n),r=i;break;case"img":case"image":case"link":jt("error",n),jt("load",n),r=i;break;case"details":jt("toggle",n),r=i;break;case"input":$k(n,i),r=kA(n,i),jt("invalid",n);break;case"option":r=i;break;case"select":n._wrapperState={wasMultiple:!!i.multiple},r=nn({},i,{value:void 0}),jt("invalid",n);break;case"textarea":Pk(n,i),r=PA(n,i),jt("invalid",n);break;default:r=i}DA(t,r),o=r;for(s in o)if(o.hasOwnProperty(s)){var l=o[s];s==="style"?Q3(n,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Y3(n,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Gg(n,l):typeof l=="number"&&Gg(n,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(qg.hasOwnProperty(s)?l!=null&&s==="onScroll"&&jt("scroll",n):l!=null&&$2(n,s,l,a))}switch(t){case"input":Zv(n),Rk(n,i,!1);break;case"textarea":Zv(n),Nk(n);break;case"option":i.value!=null&&n.setAttribute("value",""+Eu(i.value));break;case"select":n.multiple=!!i.multiple,s=i.value,s!=null?lf(n,!!i.multiple,s,!1):i.defaultValue!=null&&lf(n,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(n.onclick=Kw)}switch(t){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return li(e),null;case 6:if(n&&e.stateNode!=null)wL(n,e,n.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(ye(166));if(t=Ic(ry.current),Ic(Ma.current),l0(e)){if(i=e.stateNode,t=e.memoizedProps,i[Pa]=e,(s=i.nodeValue!==t)&&(n=Dr,n!==null))switch(n.tag){case 3:o0(i.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&o0(i.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else i=(t.nodeType===9?t:t.ownerDocument).createTextNode(i),i[Pa]=e,e.stateNode=i}return li(e),null;case 13:if(Ut(Zt),i=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Kt&&Pr!==null&&e.mode&1&&!(e.flags&128))FO(),Cp(),e.flags|=98560,s=!1;else if(s=l0(e),i!==null&&i.dehydrated!==null){if(n===null){if(!s)throw Error(ye(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ye(317));s[Pa]=e}else Cp(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;li(e),s=!1}else Fs!==null&&(mT(Fs),Fs=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(i=i!==null,i!==(n!==null&&n.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(n===null||Zt.current&1?kn===0&&(kn=3):hI())),e.updateQueue!==null&&(e.flags|=4),li(e),null);case 4:return $p(),oT(n,e),n===null&&ey(e.stateNode.containerInfo),li(e),null;case 10:return Y2(e.type._context),li(e),null;case 17:return sr(e.type)&&Yw(),li(e),null;case 19:if(Ut(Zt),s=e.memoizedState,s===null)return li(e),null;if(i=(e.flags&128)!==0,a=s.rendering,a===null)if(i)Rm(s,!1);else{if(kn!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=nb(n),a!==null){for(e.flags|=128,Rm(s,!1),i=a.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=t,t=e.child;t!==null;)s=t,n=i,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,n=a.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Vt(Zt,Zt.current&1|2),e.child}n=n.sibling}s.tail!==null&&fn()>Pp&&(e.flags|=128,i=!0,Rm(s,!1),e.lanes=4194304)}else{if(!i)if(n=nb(a),n!==null){if(e.flags|=128,i=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Rm(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!Kt)return li(e),null}else 2*fn()-s.renderingStartTime>Pp&&t!==1073741824&&(e.flags|=128,i=!0,Rm(s,!1),e.lanes=4194304);s.isBackwards?(a.sibling=e.child,e.child=a):(t=s.last,t!==null?t.sibling=a:e.child=a,s.last=a)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=fn(),e.sibling=null,t=Zt.current,Vt(Zt,i?t&1|2:t&1),e):(li(e),null);case 22:case 23:return dI(),i=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Sr&1073741824&&(li(e),e.subtreeFlags&6&&(e.flags|=8192)):li(e),null;case 24:return null;case 25:return null}throw Error(ye(156,e.tag))}function kH(n,e){switch(W2(e),e.tag){case 1:return sr(e.type)&&Yw(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return $p(),Ut(rr),Ut(Ei),eI(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Z2(e),null;case 13:if(Ut(Zt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(ye(340));Cp()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Ut(Zt),null;case 4:return $p(),null;case 10:return Y2(e.type._context),null;case 22:case 23:return dI(),null;case 24:return null;default:return null}}var d0=!1,wi=!1,$H=typeof WeakSet=="function"?WeakSet:Set,ke=null;function Qh(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(i){on(n,e,i)}else t.current=null}function lT(n,e,t){try{t()}catch(i){on(n,e,i)}}var x$=!1;function RH(n,e){if(WA=Ww,n=TO(),U2(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var i=t.getSelection&&t.getSelection();if(i&&i.rangeCount!==0){t=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,u=0,c=0,h=n,f=null;t:for(;;){for(var m;h!==t||r!==0&&h.nodeType!==3||(o=a+r),h!==s||i!==0&&h.nodeType!==3||(l=a+i),h.nodeType===3&&(a+=h.nodeValue.length),(m=h.firstChild)!==null;)f=h,h=m;for(;;){if(h===n)break t;if(f===t&&++u===r&&(o=a),f===s&&++c===i&&(l=a),(m=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=m}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(qA={focusedElem:n,selectionRange:t},Ww=!1,ke=e;ke!==null;)if(e=ke,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,ke=n;else for(;ke!==null;){e=ke;try{var y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var _=y.memoizedProps,x=y.memoizedState,v=e.stateNode,w=v.getSnapshotBeforeUpdate(e.elementType===e.type?_:Es(e.type,_),x);v.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var E=e.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ye(163))}}catch(k){on(e,e.return,k)}if(n=e.sibling,n!==null){n.return=e.return,ke=n;break}ke=e.return}return y=x$,x$=!1,y}function Pg(n,e,t){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&n)===n){var s=r.destroy;r.destroy=void 0,s!==void 0&&lT(e,t,s)}r=r.next}while(r!==i)}}function x1(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}}function uT(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function bL(n){var e=n.alternate;e!==null&&(n.alternate=null,bL(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Pa],delete e[ny],delete e[YA],delete e[fH],delete e[pH])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function xL(n){return n.tag===5||n.tag===3||n.tag===4}function E$(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||xL(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function cT(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Kw));else if(i!==4&&(n=n.child,n!==null))for(cT(n,e,t),n=n.sibling;n!==null;)cT(n,e,t),n=n.sibling}function dT(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(i!==4&&(n=n.child,n!==null))for(dT(n,e,t),n=n.sibling;n!==null;)dT(n,e,t),n=n.sibling}var ti=null,Ls=!1;function ml(n,e,t){for(t=t.child;t!==null;)EL(n,e,t),t=t.sibling}function EL(n,e,t){if(Da&&typeof Da.onCommitFiberUnmount=="function")try{Da.onCommitFiberUnmount(p1,t)}catch{}switch(t.tag){case 5:wi||Qh(t,e);case 6:var i=ti,r=Ls;ti=null,ml(n,e,t),ti=i,Ls=r,ti!==null&&(Ls?(n=ti,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):ti.removeChild(t.stateNode));break;case 18:ti!==null&&(Ls?(n=ti,t=t.stateNode,n.nodeType===8?Wx(n.parentNode,t):n.nodeType===1&&Wx(n,t),Qg(n)):Wx(ti,t.stateNode));break;case 4:i=ti,r=Ls,ti=t.stateNode.containerInfo,Ls=!0,ml(n,e,t),ti=i,Ls=r;break;case 0:case 11:case 14:case 15:if(!wi&&(i=t.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&lT(t,e,a),r=r.next}while(r!==i)}ml(n,e,t);break;case 1:if(!wi&&(Qh(t,e),i=t.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=t.memoizedProps,i.state=t.memoizedState,i.componentWillUnmount()}catch(o){on(t,e,o)}ml(n,e,t);break;case 21:ml(n,e,t);break;case 22:t.mode&1?(wi=(i=wi)||t.memoizedState!==null,ml(n,e,t),wi=i):ml(n,e,t);break;default:ml(n,e,t)}}function A$(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new $H),e.forEach(function(i){var r=VH.bind(null,n,i);t.has(i)||(t.add(i),i.then(r,r))})}}function ps(n,e){var t=e.deletions;if(t!==null)for(var i=0;i<t.length;i++){var r=t[i];try{var s=n,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:ti=o.stateNode,Ls=!1;break e;case 3:ti=o.stateNode.containerInfo,Ls=!0;break e;case 4:ti=o.stateNode.containerInfo,Ls=!0;break e}o=o.return}if(ti===null)throw Error(ye(160));EL(s,a,r),ti=null,Ls=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(u){on(r,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)AL(e,n),e=e.sibling}function AL(n,e){var t=n.alternate,i=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(ps(e,n),la(n),i&4){try{Pg(3,n,n.return),x1(3,n)}catch(_){on(n,n.return,_)}try{Pg(5,n,n.return)}catch(_){on(n,n.return,_)}}break;case 1:ps(e,n),la(n),i&512&&t!==null&&Qh(t,t.return);break;case 5:if(ps(e,n),la(n),i&512&&t!==null&&Qh(t,t.return),n.flags&32){var r=n.stateNode;try{Gg(r,"")}catch(_){on(n,n.return,_)}}if(i&4&&(r=n.stateNode,r!=null)){var s=n.memoizedProps,a=t!==null?t.memoizedProps:s,o=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{o==="input"&&s.type==="radio"&&s.name!=null&&q3(r,s),MA(o,a);var u=MA(o,s);for(a=0;a<l.length;a+=2){var c=l[a],h=l[a+1];c==="style"?Q3(r,h):c==="dangerouslySetInnerHTML"?Y3(r,h):c==="children"?Gg(r,h):$2(r,c,h,u)}switch(o){case"input":$A(r,s);break;case"textarea":G3(r,s);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var m=s.value;m!=null?lf(r,!!s.multiple,m,!1):f!==!!s.multiple&&(s.defaultValue!=null?lf(r,!!s.multiple,s.defaultValue,!0):lf(r,!!s.multiple,s.multiple?[]:"",!1))}r[ny]=s}catch(_){on(n,n.return,_)}}break;case 6:if(ps(e,n),la(n),i&4){if(n.stateNode===null)throw Error(ye(162));r=n.stateNode,s=n.memoizedProps;try{r.nodeValue=s}catch(_){on(n,n.return,_)}}break;case 3:if(ps(e,n),la(n),i&4&&t!==null&&t.memoizedState.isDehydrated)try{Qg(e.containerInfo)}catch(_){on(n,n.return,_)}break;case 4:ps(e,n),la(n);break;case 13:ps(e,n),la(n),r=n.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(uI=fn())),i&4&&A$(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?(wi=(u=wi)||c,ps(e,n),wi=u):ps(e,n),la(n),i&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!c&&n.mode&1)for(ke=n,c=n.child;c!==null;){for(h=ke=c;ke!==null;){switch(f=ke,m=f.child,f.tag){case 0:case 11:case 14:case 15:Pg(4,f,f.return);break;case 1:Qh(f,f.return);var y=f.stateNode;if(typeof y.componentWillUnmount=="function"){i=f,t=f.return;try{e=i,y.props=e.memoizedProps,y.state=e.memoizedState,y.componentWillUnmount()}catch(_){on(i,t,_)}}break;case 5:Qh(f,f.return);break;case 22:if(f.memoizedState!==null){S$(h);continue}}m!==null?(m.return=f,ke=m):S$(h)}c=c.sibling}e:for(c=null,h=n;;){if(h.tag===5){if(c===null){c=h;try{r=h.stateNode,u?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(o=h.stateNode,l=h.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=X3("display",a))}catch(_){on(n,n.return,_)}}}else if(h.tag===6){if(c===null)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(_){on(n,n.return,_)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===n)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===n)break e;for(;h.sibling===null;){if(h.return===null||h.return===n)break e;c===h&&(c=null),h=h.return}c===h&&(c=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:ps(e,n),la(n),i&4&&A$(n);break;case 21:break;default:ps(e,n),la(n)}}function la(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(xL(t)){var i=t;break e}t=t.return}throw Error(ye(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Gg(r,""),i.flags&=-33);var s=E$(n);dT(n,s,r);break;case 3:case 4:var a=i.stateNode.containerInfo,o=E$(n);cT(n,o,a);break;default:throw Error(ye(161))}}catch(l){on(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function PH(n,e,t){ke=n,TL(n)}function TL(n,e,t){for(var i=(n.mode&1)!==0;ke!==null;){var r=ke,s=r.child;if(r.tag===22&&i){var a=r.memoizedState!==null||d0;if(!a){var o=r.alternate,l=o!==null&&o.memoizedState!==null||wi;o=d0;var u=wi;if(d0=a,(wi=l)&&!u)for(ke=r;ke!==null;)a=ke,l=a.child,a.tag===22&&a.memoizedState!==null?I$(r):l!==null?(l.return=a,ke=l):I$(r);for(;s!==null;)ke=s,TL(s),s=s.sibling;ke=r,d0=o,wi=u}T$(n)}else r.subtreeFlags&8772&&s!==null?(s.return=r,ke=s):T$(n)}}function T$(n){for(;ke!==null;){var e=ke;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:wi||x1(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!wi)if(t===null)i.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:Es(e.type,t.memoizedProps);i.componentDidUpdate(r,t.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&u$(e,s,i);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}u$(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var h=c.dehydrated;h!==null&&Qg(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ye(163))}wi||e.flags&512&&uT(e)}catch(f){on(e,e.return,f)}}if(e===n){ke=null;break}if(t=e.sibling,t!==null){t.return=e.return,ke=t;break}ke=e.return}}function S$(n){for(;ke!==null;){var e=ke;if(e===n){ke=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ke=t;break}ke=e.return}}function I$(n){for(;ke!==null;){var e=ke;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{x1(4,e)}catch(l){on(e,t,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){on(e,r,l)}}var s=e.return;try{uT(e)}catch(l){on(e,s,l)}break;case 5:var a=e.return;try{uT(e)}catch(l){on(e,a,l)}}}catch(l){on(e,e.return,l)}if(e===n){ke=null;break}var o=e.sibling;if(o!==null){o.return=e.return,ke=o;break}ke=e.return}}var NH=Math.ceil,sb=rl.ReactCurrentDispatcher,oI=rl.ReactCurrentOwner,ns=rl.ReactCurrentBatchConfig,gt=0,Gn=null,vn=null,ri=0,Sr=0,Jh=Lu(0),kn=0,ly=null,jd=0,E1=0,lI=0,Ng=null,tr=null,uI=0,Pp=1/0,so=null,ab=!1,hT=null,mu=null,h0=!1,lu=null,ob=0,Dg=0,fT=null,X0=-1,Q0=0;function Mi(){return gt&6?fn():X0!==-1?X0:X0=fn()}function gu(n){return n.mode&1?gt&2&&ri!==0?ri&-ri:gH.transition!==null?(Q0===0&&(Q0=uO()),Q0):(n=It,n!==0||(n=window.event,n=n===void 0?16:gO(n.type)),n):1}function Hs(n,e,t,i){if(50<Dg)throw Dg=0,fT=null,Error(ye(185));X_(n,t,i),(!(gt&2)||n!==Gn)&&(n===Gn&&(!(gt&2)&&(E1|=t),kn===4&&Tl(n,ri)),ar(n,i),t===1&&gt===0&&!(e.mode&1)&&(Pp=fn()+500,v1&&Fu()))}function ar(n,e){var t=n.callbackNode;g8(n,e);var i=Hw(n,n===Gn?ri:0);if(i===0)t!==null&&Ok(t),n.callbackNode=null,n.callbackPriority=0;else if(e=i&-i,n.callbackPriority!==e){if(t!=null&&Ok(t),e===1)n.tag===0?mH(C$.bind(null,n)):MO(C$.bind(null,n)),dH(function(){!(gt&6)&&Fu()}),t=null;else{switch(cO(i)){case 1:t=M2;break;case 4:t=oO;break;case 16:t=Uw;break;case 536870912:t=lO;break;default:t=Uw}t=NL(t,SL.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function SL(n,e){if(X0=-1,Q0=0,gt&6)throw Error(ye(327));var t=n.callbackNode;if(ff()&&n.callbackNode!==t)return null;var i=Hw(n,n===Gn?ri:0);if(i===0)return null;if(i&30||i&n.expiredLanes||e)e=lb(n,i);else{e=i;var r=gt;gt|=2;var s=CL();(Gn!==n||ri!==e)&&(so=null,Pp=fn()+500,Nd(n,e));do try{OH();break}catch(o){IL(n,o)}while(!0);K2(),sb.current=s,gt=r,vn!==null?e=0:(Gn=null,ri=0,e=kn)}if(e!==0){if(e===2&&(r=VA(n),r!==0&&(i=r,e=pT(n,r))),e===1)throw t=ly,Nd(n,0),Tl(n,i),ar(n,fn()),t;if(e===6)Tl(n,i);else{if(r=n.current.alternate,!(i&30)&&!DH(r)&&(e=lb(n,i),e===2&&(s=VA(n),s!==0&&(i=s,e=pT(n,s))),e===1))throw t=ly,Nd(n,0),Tl(n,i),ar(n,fn()),t;switch(n.finishedWork=r,n.finishedLanes=i,e){case 0:case 1:throw Error(ye(345));case 2:pc(n,tr,so);break;case 3:if(Tl(n,i),(i&130023424)===i&&(e=uI+500-fn(),10<e)){if(Hw(n,0)!==0)break;if(r=n.suspendedLanes,(r&i)!==i){Mi(),n.pingedLanes|=n.suspendedLanes&r;break}n.timeoutHandle=KA(pc.bind(null,n,tr,so),e);break}pc(n,tr,so);break;case 4:if(Tl(n,i),(i&4194240)===i)break;for(e=n.eventTimes,r=-1;0<i;){var a=31-Us(i);s=1<<a,a=e[a],a>r&&(r=a),i&=~s}if(i=r,i=fn()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*NH(i/1960))-i,10<i){n.timeoutHandle=KA(pc.bind(null,n,tr,so),i);break}pc(n,tr,so);break;case 5:pc(n,tr,so);break;default:throw Error(ye(329))}}}return ar(n,fn()),n.callbackNode===t?SL.bind(null,n):null}function pT(n,e){var t=Ng;return n.current.memoizedState.isDehydrated&&(Nd(n,e).flags|=256),n=lb(n,e),n!==2&&(e=tr,tr=t,e!==null&&mT(e)),n}function mT(n){tr===null?tr=n:tr.push.apply(tr,n)}function DH(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var i=0;i<t.length;i++){var r=t[i],s=r.getSnapshot;r=r.value;try{if(!Ks(s(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Tl(n,e){for(e&=~lI,e&=~E1,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Us(e),i=1<<t;n[t]=-1,e&=~i}}function C$(n){if(gt&6)throw Error(ye(327));ff();var e=Hw(n,0);if(!(e&1))return ar(n,fn()),null;var t=lb(n,e);if(n.tag!==0&&t===2){var i=VA(n);i!==0&&(e=i,t=pT(n,i))}if(t===1)throw t=ly,Nd(n,0),Tl(n,e),ar(n,fn()),t;if(t===6)throw Error(ye(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,pc(n,tr,so),ar(n,fn()),null}function cI(n,e){var t=gt;gt|=1;try{return n(e)}finally{gt=t,gt===0&&(Pp=fn()+500,v1&&Fu())}}function Bd(n){lu!==null&&lu.tag===0&&!(gt&6)&&ff();var e=gt;gt|=1;var t=ns.transition,i=It;try{if(ns.transition=null,It=1,n)return n()}finally{It=i,ns.transition=t,gt=e,!(gt&6)&&Fu()}}function dI(){Sr=Jh.current,Ut(Jh)}function Nd(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,cH(t)),vn!==null)for(t=vn.return;t!==null;){var i=t;switch(W2(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Yw();break;case 3:$p(),Ut(rr),Ut(Ei),eI();break;case 5:Z2(i);break;case 4:$p();break;case 13:Ut(Zt);break;case 19:Ut(Zt);break;case 10:Y2(i.type._context);break;case 22:case 23:dI()}t=t.return}if(Gn=n,vn=n=yu(n.current,null),ri=Sr=e,kn=0,ly=null,lI=E1=jd=0,tr=Ng=null,Sc!==null){for(e=0;e<Sc.length;e++)if(t=Sc[e],i=t.interleaved,i!==null){t.interleaved=null;var r=i.next,s=t.pending;if(s!==null){var a=s.next;s.next=r,i.next=a}t.pending=i}Sc=null}return n}function IL(n,e){do{var t=vn;try{if(K2(),G0.current=rb,ib){for(var i=tn.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}ib=!1}if(Vd=0,Wn=Cn=tn=null,Rg=!1,sy=0,oI.current=null,t===null||t.return===null){kn=1,ly=e,vn=null;break}e:{var s=n,a=t.return,o=t,l=e;if(e=ri,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=o,h=c.tag;if(!(c.mode&1)&&(h===0||h===11||h===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var m=m$(a);if(m!==null){m.flags&=-257,g$(m,a,o,s,e),m.mode&1&&p$(s,u,e),e=m,l=u;var y=e.updateQueue;if(y===null){var _=new Set;_.add(l),e.updateQueue=_}else y.add(l);break e}else{if(!(e&1)){p$(s,u,e),hI();break e}l=Error(ye(426))}}else if(Kt&&o.mode&1){var x=m$(a);if(x!==null){!(x.flags&65536)&&(x.flags|=256),g$(x,a,o,s,e),q2(Rp(l,o));break e}}s=l=Rp(l,o),kn!==4&&(kn=2),Ng===null?Ng=[s]:Ng.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var v=cL(s,l,e);l$(s,v);break e;case 1:o=l;var w=s.type,E=s.stateNode;if(!(s.flags&128)&&(typeof w.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(mu===null||!mu.has(E)))){s.flags|=65536,e&=-e,s.lanes|=e;var k=dL(s,o,e);l$(s,k);break e}}s=s.return}while(s!==null)}$L(t)}catch($){e=$,vn===t&&t!==null&&(vn=t=t.return);continue}break}while(!0)}function CL(){var n=sb.current;return sb.current=rb,n===null?rb:n}function hI(){(kn===0||kn===3||kn===2)&&(kn=4),Gn===null||!(jd&268435455)&&!(E1&268435455)||Tl(Gn,ri)}function lb(n,e){var t=gt;gt|=2;var i=CL();(Gn!==n||ri!==e)&&(so=null,Nd(n,e));do try{MH();break}catch(r){IL(n,r)}while(!0);if(K2(),gt=t,sb.current=i,vn!==null)throw Error(ye(261));return Gn=null,ri=0,kn}function MH(){for(;vn!==null;)kL(vn)}function OH(){for(;vn!==null&&!o8();)kL(vn)}function kL(n){var e=PL(n.alternate,n,Sr);n.memoizedProps=n.pendingProps,e===null?$L(n):vn=e,oI.current=null}function $L(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=kH(t,e),t!==null){t.flags&=32767,vn=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{kn=6,vn=null;return}}else if(t=CH(t,e,Sr),t!==null){vn=t;return}if(e=e.sibling,e!==null){vn=e;return}vn=e=n}while(e!==null);kn===0&&(kn=5)}function pc(n,e,t){var i=It,r=ns.transition;try{ns.transition=null,It=1,LH(n,e,t,i)}finally{ns.transition=r,It=i}return null}function LH(n,e,t,i){do ff();while(lu!==null);if(gt&6)throw Error(ye(327));t=n.finishedWork;var r=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(ye(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(y8(n,s),n===Gn&&(vn=Gn=null,ri=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||h0||(h0=!0,NL(Uw,function(){return ff(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=ns.transition,ns.transition=null;var a=It;It=1;var o=gt;gt|=4,oI.current=null,RH(n,t),AL(t,n),iH(qA),Ww=!!WA,qA=WA=null,n.current=t,PH(t),l8(),gt=o,It=a,ns.transition=s}else n.current=t;if(h0&&(h0=!1,lu=n,ob=r),s=n.pendingLanes,s===0&&(mu=null),d8(t.stateNode),ar(n,fn()),e!==null)for(i=n.onRecoverableError,t=0;t<e.length;t++)r=e[t],i(r.value,{componentStack:r.stack,digest:r.digest});if(ab)throw ab=!1,n=hT,hT=null,n;return ob&1&&n.tag!==0&&ff(),s=n.pendingLanes,s&1?n===fT?Dg++:(Dg=0,fT=n):Dg=0,Fu(),null}function ff(){if(lu!==null){var n=cO(ob),e=ns.transition,t=It;try{if(ns.transition=null,It=16>n?16:n,lu===null)var i=!1;else{if(n=lu,lu=null,ob=0,gt&6)throw Error(ye(331));var r=gt;for(gt|=4,ke=n.current;ke!==null;){var s=ke,a=s.child;if(ke.flags&16){var o=s.deletions;if(o!==null){for(var l=0;l<o.length;l++){var u=o[l];for(ke=u;ke!==null;){var c=ke;switch(c.tag){case 0:case 11:case 15:Pg(8,c,s)}var h=c.child;if(h!==null)h.return=c,ke=h;else for(;ke!==null;){c=ke;var f=c.sibling,m=c.return;if(bL(c),c===u){ke=null;break}if(f!==null){f.return=m,ke=f;break}ke=m}}}var y=s.alternate;if(y!==null){var _=y.child;if(_!==null){y.child=null;do{var x=_.sibling;_.sibling=null,_=x}while(_!==null)}}ke=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,ke=a;else e:for(;ke!==null;){if(s=ke,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Pg(9,s,s.return)}var v=s.sibling;if(v!==null){v.return=s.return,ke=v;break e}ke=s.return}}var w=n.current;for(ke=w;ke!==null;){a=ke;var E=a.child;if(a.subtreeFlags&2064&&E!==null)E.return=a,ke=E;else e:for(a=w;ke!==null;){if(o=ke,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:x1(9,o)}}catch($){on(o,o.return,$)}if(o===a){ke=null;break e}var k=o.sibling;if(k!==null){k.return=o.return,ke=k;break e}ke=o.return}}if(gt=r,Fu(),Da&&typeof Da.onPostCommitFiberRoot=="function")try{Da.onPostCommitFiberRoot(p1,n)}catch{}i=!0}return i}finally{It=t,ns.transition=e}}return!1}function k$(n,e,t){e=Rp(t,e),e=cL(n,e,1),n=pu(n,e,1),e=Mi(),n!==null&&(X_(n,1,e),ar(n,e))}function on(n,e,t){if(n.tag===3)k$(n,n,t);else for(;e!==null;){if(e.tag===3){k$(e,n,t);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(mu===null||!mu.has(i))){n=Rp(t,n),n=dL(e,n,1),e=pu(e,n,1),n=Mi(),e!==null&&(X_(e,1,n),ar(e,n));break}}e=e.return}}function FH(n,e,t){var i=n.pingCache;i!==null&&i.delete(e),e=Mi(),n.pingedLanes|=n.suspendedLanes&t,Gn===n&&(ri&t)===t&&(kn===4||kn===3&&(ri&130023424)===ri&&500>fn()-uI?Nd(n,0):lI|=t),ar(n,e)}function RL(n,e){e===0&&(n.mode&1?(e=n0,n0<<=1,!(n0&130023424)&&(n0=4194304)):e=1);var t=Mi();n=Yo(n,e),n!==null&&(X_(n,e,t),ar(n,t))}function zH(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),RL(n,t)}function VH(n,e){var t=0;switch(n.tag){case 13:var i=n.stateNode,r=n.memoizedState;r!==null&&(t=r.retryLane);break;case 19:i=n.stateNode;break;default:throw Error(ye(314))}i!==null&&i.delete(e),RL(n,t)}var PL;PL=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||rr.current)ir=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return ir=!1,IH(n,e,t);ir=!!(n.flags&131072)}else ir=!1,Kt&&e.flags&1048576&&OO(e,Jw,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Y0(n,e),n=e.pendingProps;var r=Ip(e,Ei.current);hf(e,t),r=nI(null,e,i,n,r,t);var s=iI();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,sr(i)?(s=!0,Xw(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Q2(e),r.updater=b1,e.stateNode=r,r._reactInternals=e,tT(e,i,n,t),e=rT(null,e,i,!0,s,t)):(e.tag=0,Kt&&s&&H2(e),Di(null,e,r,t),e=e.child),e;case 16:i=e.elementType;e:{switch(Y0(n,e),n=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=BH(i),n=Es(i,n),r){case 0:e=iT(null,e,i,n,t);break e;case 1:e=v$(null,e,i,n,t);break e;case 11:e=y$(null,e,i,n,t);break e;case 14:e=_$(null,e,i,Es(i.type,n),t);break e}throw Error(ye(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Es(i,r),iT(n,e,i,r,t);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Es(i,r),v$(n,e,i,r,t);case 3:e:{if(mL(e),n===null)throw Error(ye(387));i=e.pendingProps,s=e.memoizedState,r=s.element,BO(n,e),tb(e,i,null,t);var a=e.memoizedState;if(i=a.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Rp(Error(ye(423)),e),e=w$(n,e,i,t,r);break e}else if(i!==r){r=Rp(Error(ye(424)),e),e=w$(n,e,i,t,r);break e}else for(Pr=fu(e.stateNode.containerInfo.firstChild),Dr=e,Kt=!0,Fs=null,t=VO(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Cp(),i===r){e=Xo(n,e,t);break e}Di(n,e,i,t)}e=e.child}return e;case 5:return UO(e),n===null&&JA(e),i=e.type,r=e.pendingProps,s=n!==null?n.memoizedProps:null,a=r.children,GA(i,r)?a=null:s!==null&&GA(i,s)&&(e.flags|=32),pL(n,e),Di(n,e,a,t),e.child;case 6:return n===null&&JA(e),null;case 13:return gL(n,e,t);case 4:return J2(e,e.stateNode.containerInfo),i=e.pendingProps,n===null?e.child=kp(e,null,i,t):Di(n,e,i,t),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Es(i,r),y$(n,e,i,r,t);case 7:return Di(n,e,e.pendingProps,t),e.child;case 8:return Di(n,e,e.pendingProps.children,t),e.child;case 12:return Di(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,a=r.value,Vt(Zw,i._currentValue),i._currentValue=a,s!==null)if(Ks(s.value,a)){if(s.children===r.children&&!rr.current){e=Xo(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var o=s.dependencies;if(o!==null){a=s.child;for(var l=o.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=jo(-1,t&-t),l.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}s.lanes|=t,l=s.alternate,l!==null&&(l.lanes|=t),ZA(s.return,t,e),o.lanes|=t;break}l=l.next}}else if(s.tag===10)a=s.type===e.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(ye(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),ZA(a,t,e),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===e){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}Di(n,e,r.children,t),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,hf(e,t),r=ss(r),i=i(r),e.flags|=1,Di(n,e,i,t),e.child;case 14:return i=e.type,r=Es(i,e.pendingProps),r=Es(i.type,r),_$(n,e,i,r,t);case 15:return hL(n,e,e.type,e.pendingProps,t);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Es(i,r),Y0(n,e),e.tag=1,sr(i)?(n=!0,Xw(e)):n=!1,hf(e,t),uL(e,i,r),tT(e,i,r,t),rT(null,e,i,!0,n,t);case 19:return yL(n,e,t);case 22:return fL(n,e,t)}throw Error(ye(156,e.tag))};function NL(n,e){return aO(n,e)}function jH(n,e,t,i){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ts(n,e,t,i){return new jH(n,e,t,i)}function fI(n){return n=n.prototype,!(!n||!n.isReactComponent)}function BH(n){if(typeof n=="function")return fI(n)?1:0;if(n!=null){if(n=n.$$typeof,n===P2)return 11;if(n===N2)return 14}return 2}function yu(n,e){var t=n.alternate;return t===null?(t=ts(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function J0(n,e,t,i,r,s){var a=2;if(i=n,typeof n=="function")fI(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case Bh:return Dd(t.children,r,s,e);case R2:a=8,r|=8;break;case TA:return n=ts(12,t,e,r|2),n.elementType=TA,n.lanes=s,n;case SA:return n=ts(13,t,e,r),n.elementType=SA,n.lanes=s,n;case IA:return n=ts(19,t,e,r),n.elementType=IA,n.lanes=s,n;case U3:return A1(t,r,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case j3:a=10;break e;case B3:a=9;break e;case P2:a=11;break e;case N2:a=14;break e;case xl:a=16,i=null;break e}throw Error(ye(130,n==null?n:typeof n,""))}return e=ts(a,t,e,r),e.elementType=n,e.type=i,e.lanes=s,e}function Dd(n,e,t,i){return n=ts(7,n,i,e),n.lanes=t,n}function A1(n,e,t,i){return n=ts(22,n,i,e),n.elementType=U3,n.lanes=t,n.stateNode={isHidden:!1},n}function Zx(n,e,t){return n=ts(6,n,null,e),n.lanes=t,n}function eE(n,e,t){return e=ts(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function UH(n,e,t,i,r){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Dx(0),this.expirationTimes=Dx(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Dx(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function pI(n,e,t,i,r,s,a,o,l){return n=new UH(n,e,t,o,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=ts(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:i,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Q2(s),n}function HH(n,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:jh,key:i==null?null:""+i,children:n,containerInfo:e,implementation:t}}function DL(n){if(!n)return Au;n=n._reactInternals;e:{if(sh(n)!==n||n.tag!==1)throw Error(ye(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(sr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ye(171))}if(n.tag===1){var t=n.type;if(sr(t))return DO(n,t,e)}return e}function ML(n,e,t,i,r,s,a,o,l){return n=pI(t,i,!0,n,r,s,a,o,l),n.context=DL(null),t=n.current,i=Mi(),r=gu(t),s=jo(i,r),s.callback=e??null,pu(t,s,r),n.current.lanes=r,X_(n,r,i),ar(n,i),n}function T1(n,e,t,i){var r=e.current,s=Mi(),a=gu(r);return t=DL(t),e.context===null?e.context=t:e.pendingContext=t,e=jo(s,a),e.payload={element:n},i=i===void 0?null:i,i!==null&&(e.callback=i),n=pu(r,e,a),n!==null&&(Hs(n,r,a,s),q0(n,r,a)),a}function ub(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function $$(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function mI(n,e){$$(n,e),(n=n.alternate)&&$$(n,e)}function WH(){return null}var OL=typeof reportError=="function"?reportError:function(n){console.error(n)};function gI(n){this._internalRoot=n}S1.prototype.render=gI.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(ye(409));T1(n,e,null,null)};S1.prototype.unmount=gI.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Bd(function(){T1(null,n,null,null)}),e[Ko]=null}};function S1(n){this._internalRoot=n}S1.prototype.unstable_scheduleHydration=function(n){if(n){var e=fO();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Al.length&&e!==0&&e<Al[t].priority;t++);Al.splice(t,0,n),t===0&&mO(n)}};function yI(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function I1(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function R$(){}function qH(n,e,t,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var u=ub(a);s.call(u)}}var a=ML(e,i,n,0,null,!1,!1,"",R$);return n._reactRootContainer=a,n[Ko]=a.current,ey(n.nodeType===8?n.parentNode:n),Bd(),a}for(;r=n.lastChild;)n.removeChild(r);if(typeof i=="function"){var o=i;i=function(){var u=ub(l);o.call(u)}}var l=pI(n,0,!1,null,null,!1,!1,"",R$);return n._reactRootContainer=l,n[Ko]=l.current,ey(n.nodeType===8?n.parentNode:n),Bd(function(){T1(e,l,t,i)}),l}function C1(n,e,t,i,r){var s=t._reactRootContainer;if(s){var a=s;if(typeof r=="function"){var o=r;r=function(){var l=ub(a);o.call(l)}}T1(e,a,n,r)}else a=qH(t,e,n,r,i);return ub(a)}dO=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Qm(e.pendingLanes);t!==0&&(O2(e,t|1),ar(e,fn()),!(gt&6)&&(Pp=fn()+500,Fu()))}break;case 13:Bd(function(){var i=Yo(n,1);if(i!==null){var r=Mi();Hs(i,n,1,r)}}),mI(n,1)}};L2=function(n){if(n.tag===13){var e=Yo(n,134217728);if(e!==null){var t=Mi();Hs(e,n,134217728,t)}mI(n,134217728)}};hO=function(n){if(n.tag===13){var e=gu(n),t=Yo(n,e);if(t!==null){var i=Mi();Hs(t,n,e,i)}mI(n,e)}};fO=function(){return It};pO=function(n,e){var t=It;try{return It=n,e()}finally{It=t}};LA=function(n,e,t){switch(e){case"input":if($A(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==n&&i.form===n.form){var r=_1(i);if(!r)throw Error(ye(90));W3(i),$A(i,r)}}}break;case"textarea":G3(n,t);break;case"select":e=t.value,e!=null&&lf(n,!!t.multiple,e,!1)}};eO=cI;tO=Bd;var GH={usingClientEntryPoint:!1,Events:[J_,qh,_1,J3,Z3,cI]},Pm={findFiberByHostInstance:Tc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},KH={bundleType:Pm.bundleType,version:Pm.version,rendererPackageName:Pm.rendererPackageName,rendererConfig:Pm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:rl.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=rO(n),n===null?null:n.stateNode},findFiberByHostInstance:Pm.findFiberByHostInstance||WH,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var f0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!f0.isDisabled&&f0.supportsFiber)try{p1=f0.inject(KH),Da=f0}catch{}}Fr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=GH;Fr.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!yI(e))throw Error(ye(200));return HH(n,e,null,t)};Fr.createRoot=function(n,e){if(!yI(n))throw Error(ye(299));var t=!1,i="",r=OL;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=pI(n,1,!1,null,null,t,!1,i,r),n[Ko]=e.current,ey(n.nodeType===8?n.parentNode:n),new gI(e)};Fr.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(ye(188)):(n=Object.keys(n).join(","),Error(ye(268,n)));return n=rO(e),n=n===null?null:n.stateNode,n};Fr.flushSync=function(n){return Bd(n)};Fr.hydrate=function(n,e,t){if(!I1(e))throw Error(ye(200));return C1(null,n,e,!0,t)};Fr.hydrateRoot=function(n,e,t){if(!yI(n))throw Error(ye(405));var i=t!=null&&t.hydratedSources||null,r=!1,s="",a=OL;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=ML(e,null,n,1,t??null,r,!1,s,a),n[Ko]=e.current,ey(n),i)for(n=0;n<i.length;n++)t=i[n],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new S1(e)};Fr.render=function(n,e,t){if(!I1(e))throw Error(ye(200));return C1(null,n,e,!1,t)};Fr.unmountComponentAtNode=function(n){if(!I1(n))throw Error(ye(40));return n._reactRootContainer?(Bd(function(){C1(null,null,n,!1,function(){n._reactRootContainer=null,n[Ko]=null})}),!0):!1};Fr.unstable_batchedUpdates=cI;Fr.unstable_renderSubtreeIntoContainer=function(n,e,t,i){if(!I1(t))throw Error(ye(200));if(n==null||n._reactInternals===void 0)throw Error(ye(38));return C1(n,e,t,!1,i)};Fr.version="18.3.1-next-f1338f8080-20240426";function LL(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(LL)}catch(n){console.error(n)}}LL(),L3.exports=Fr;var YH=L3.exports,P$=YH;EA.createRoot=P$.createRoot,EA.hydrateRoot=P$.hydrateRoot;const XH="modulepreload",QH=function(n){return"/blood-report-fitness-evaluation-system/"+n},N$={},cb=function(e,t,i){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));r=Promise.allSettled(t.map(l=>{if(l=QH(l),l in N$)return;N$[l]=!0;const u=l.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${c}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":XH,u||(h.as="script"),h.crossOrigin="",h.href=l,o&&h.setAttribute("nonce",o),document.head.appendChild(h),u)return new Promise((f,m)=>{h.addEventListener("load",f),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return r.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return e().catch(s)})},JH=({onLogin:n})=>{const[e,t]=xe.useState(!0),[i,r]=xe.useState(""),[s,a]=xe.useState(""),[o,l]=xe.useState(""),[u,c]=xe.useState(!1),[h,f]=xe.useState(!1),m=async y=>{if(y.preventDefault(),l(""),!i.includes("@")){l("Please enter a valid email address.");return}if(s.length<6){l("Password must be at least 6 characters long.");return}c(!0);try{const{api:_}=await cb(async()=>{const{api:v}=await Promise.resolve().then(()=>UX);return{api:v}},void 0);let x;e?x=await _.login(i,s):x=await _.register(i,s),x.success?n(x.user,!e):l(x.error||"Authentication failed")}catch(_){console.error("Authentication error:",_),l("Network error. Please try again.")}finally{c(!1)}};return T.jsxs("div",{className:"login-container",children:[T.jsxs("div",{className:"login-card fade-in",children:[T.jsxs("div",{className:"logo-section",children:[T.jsx("img",{src:"app_logo.jpg",alt:"BloodFit Logo",className:"app-logo"}),T.jsx("h1",{children:"Blood & Fit"}),T.jsx("p",{children:"Your personal health companion"})]}),T.jsxs("form",{onSubmit:m,className:"login-form",children:[T.jsxs("div",{className:"form-group",children:[T.jsx("label",{htmlFor:"email",children:"Email Address"}),T.jsx("input",{type:"email",id:"email",className:"input-field",placeholder:"hello@example.com",value:i,onChange:y=>r(y.target.value),required:!0})]}),T.jsxs("div",{className:"form-group",children:[T.jsx("label",{htmlFor:"password",children:"Password"}),T.jsxs("div",{className:"password-wrapper",children:[T.jsx("input",{type:h?"text":"password",id:"password",className:"input-field",placeholder:"",value:s,onChange:y=>a(y.target.value),required:!0}),T.jsx("button",{type:"button",className:"toggle-password",onClick:()=>f(!h),children:h?"Hide":"Show"})]}),e&&T.jsx("div",{className:"forgot-password",children:T.jsx("span",{onClick:()=>alert("Reset link sent to email!"),children:"Forgot Password?"})})]}),o&&T.jsx("div",{className:"error-box fade-in",children:T.jsxs("span",{children:[" ",o]})}),T.jsx("button",{type:"submit",className:"btn-primary",disabled:u,children:u?T.jsx("span",{className:"spinner"}):e?"Login":"Sign Up"})]}),T.jsxs("p",{className:"footer-text",children:[e?"Don't have an account? ":"Already have an account? ",T.jsx("span",{className:"link",onClick:()=>{t(!e),l("")},children:e?"Sign up":"Login"})]})]}),T.jsx("style",{children:`
        .login-container {
          min-height: 100vh;
          display: flex;
          align-items: center;
          justify-content: center;
          padding: var(--spacing-md);
          background: linear-gradient(135deg, #fff1f2 0%, #fff 100%);
        }
        
        .login-card {
           width: 100%;
           max-width: 400px;
           background: rgba(255, 255, 255, 0.9);
           backdrop-filter: blur(10px);
           padding: var(--spacing-xl);
           border-radius: 24px;
           box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
           text-align: center;
           border: 1px solid rgba(255,255,255,0.5);
        }

        .logo-section {
          margin-bottom: var(--spacing-xl);
        }

        .app-logo {
          width: 80px;
          height: 80px;
          object-fit: contain;
          margin-bottom: var(--spacing-md);
          border-radius: 20px; /* Softer edges */
          box-shadow: var(--shadow-md);
        }

        .logo-section h1 {
          font-size: 24px;
          color: var(--color-text-main);
          margin-bottom: 5px;
          font-weight: 800;
        }

        .logo-section p {
          color: var(--color-text-secondary);
          font-size: 14px;
        }

        .login-form {
          display: flex;
          flex-direction: column;
          gap: 20px;
        }

        .form-group {
          text-align: left;
        }

        .form-group label {
          display: block;
          margin-bottom: 8px;
          font-weight: 600;
          color: var(--color-text-main);
          font-size: 13px;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-md);
            font-size: 14px;
            transition: all 0.2s;
        }
        .input-field:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);
        }

        .password-wrapper {
            position: relative;
        }
        .toggle-password {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            font-size: 12px;
            color: var(--color-primary);
            font-weight: 600;
            cursor: pointer;
        }

        .btn-primary {
          width: 100%;
          padding: 12px;
          background: var(--color-primary);
          color: white;
          border: none;
          border-radius: var(--radius-md);
          font-weight: 600;
          font-size: 14px;
          cursor: pointer;
          transition: background 0.2s;
        }
        .btn-primary:active { transform: scale(0.98); }

        .error-box {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #ef4444;
            padding: 10px;
            border-radius: var(--radius-md);
            font-size: 12px;
            text-align: left;
            display: flex; gap: 8px;
        }

        .footer-text {
          margin-top: 25px;
          font-size: 13px;
          color: var(--color-text-secondary);
        }

        .link {
          color: var(--color-primary);
          font-weight: 600;
          cursor: pointer;
        }
        .link:hover { text-decoration: underline; }

        .spinner {
          width: 20px;
          height: 20px;
          border: 2px solid rgba(255,255,255,0.3);
          border-radius: 50%;
          border-top-color: white;
          animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        .fade-in {
          animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
          to { opacity: 1; transform: translateY(0); }
        }
        
        .forgot-password {
            text-align: right;
            margin-top: 8px;
            font-size: 12px;
        }
        .forgot-password span {
            color: var(--color-primary);
            cursor: pointer;
            font-weight: 500;
        }
      `})]})},ZH=()=>{};var D$={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FL=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},e9=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const r=n[t++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=n[t++];e[i++]=String.fromCharCode((r&31)<<6|s&63)}else if(r>239&&r<365){const s=n[t++],a=n[t++],o=n[t++],l=((r&7)<<18|(s&63)<<12|(a&63)<<6|o&63)-65536;e[i++]=String.fromCharCode(55296+(l>>10)),e[i++]=String.fromCharCode(56320+(l&1023))}else{const s=n[t++],a=n[t++];e[i++]=String.fromCharCode((r&15)<<12|(s&63)<<6|a&63)}}return e.join("")},zL={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<n.length;r+=3){const s=n[r],a=r+1<n.length,o=a?n[r+1]:0,l=r+2<n.length,u=l?n[r+2]:0,c=s>>2,h=(s&3)<<4|o>>4;let f=(o&15)<<2|u>>6,m=u&63;l||(m=64,a||(f=64)),i.push(t[c],t[h],t[f],t[m])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(FL(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):e9(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<n.length;){const s=t[n.charAt(r++)],o=r<n.length?t[n.charAt(r)]:0;++r;const u=r<n.length?t[n.charAt(r)]:64;++r;const h=r<n.length?t[n.charAt(r)]:64;if(++r,s==null||o==null||u==null||h==null)throw new t9;const f=s<<2|o>>4;if(i.push(f),u!==64){const m=o<<4&240|u>>2;if(i.push(m),h!==64){const y=u<<6&192|h;i.push(y)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class t9 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const n9=function(n){const e=FL(n);return zL.encodeByteArray(e,!0)},db=function(n){return n9(n).replace(/\./g,"")},VL=function(n){try{return zL.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i9(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r9=()=>i9().__FIREBASE_DEFAULTS__,s9=()=>{if(typeof process>"u"||typeof D$>"u")return;const n=D$.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},a9=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&VL(n[1]);return e&&JSON.parse(e)},k1=()=>{try{return ZH()||r9()||s9()||a9()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},jL=n=>{var e,t;return(t=(e=k1())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},BL=n=>{const e=jL(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},UL=()=>{var n;return(n=k1())==null?void 0:n.config},HL=n=>{var e;return(e=k1())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o9{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ah(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function _I(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WL(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",r=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${i}`,aud:i,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...n};return[db(JSON.stringify(t)),db(JSON.stringify(a)),""].join(".")}const Mg={};function l9(){const n={prod:[],emulator:[]};for(const e of Object.keys(Mg))Mg[e]?n.emulator.push(e):n.prod.push(e);return n}function u9(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let M$=!1;function vI(n,e){if(typeof window>"u"||typeof document>"u"||!ah(window.location.host)||Mg[n]===e||Mg[n]||M$)return;Mg[n]=e;function t(f){return`__firebase__banner__${f}`}const i="__firebase__banner",s=l9().prod.length>0;function a(){const f=document.getElementById(i);f&&f.remove()}function o(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function l(f,m){f.setAttribute("width","24"),f.setAttribute("id",m),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function u(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{M$=!0,a()},f}function c(f,m){f.setAttribute("id",m),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function h(){const f=u9(i),m=t("text"),y=document.getElementById(m)||document.createElement("span"),_=t("learnmore"),x=document.getElementById(_)||document.createElement("a"),v=t("preprendIcon"),w=document.getElementById(v)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const E=f.element;o(E),c(x,_);const k=u();l(w,v),E.append(w,y,x,k),document.body.appendChild(E)}s?(y.innerText="Preview backend disconnected.",w.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(w.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,y.innerText="Preview backend running in this workspace."),y.setAttribute("id",m)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ai(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function c9(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ai())}function d9(){var e;const n=(e=k1())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function h9(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function f9(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function p9(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function m9(){const n=Ai();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function g9(){return!d9()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function y9(){try{return typeof indexedDB=="object"}catch{return!1}}function _9(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var s;e(((s=r.error)==null?void 0:s.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v9="FirebaseError";class Wa extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=v9,Object.setPrototypeOf(this,Wa.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ev.prototype.create)}}class ev{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],a=s?w9(s,i):"Error",o=`${this.serviceName}: ${a} (${r}).`;return new Wa(r,o,i)}}function w9(n,e){return n.replace(b9,(t,i)=>{const r=e[i];return r!=null?String(r):`<${i}?>`})}const b9=/\{\$([^}]+)}/g;function x9(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ud(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const r of t){if(!i.includes(r))return!1;const s=n[r],a=e[r];if(O$(s)&&O$(a)){if(!Ud(s,a))return!1}else if(s!==a)return!1}for(const r of i)if(!t.includes(r))return!1;return!0}function O$(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tv(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function Zm(n){const e={};return n.replace(/^\?/,"").split("&").forEach(i=>{if(i){const[r,s]=i.split("=");e[decodeURIComponent(r)]=decodeURIComponent(s)}}),e}function eg(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function E9(n,e){const t=new A9(n,e);return t.subscribe.bind(t)}class A9{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let r;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");T9(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:i},r.next===void 0&&(r.next=tE),r.error===void 0&&(r.error=tE),r.complete===void 0&&(r.complete=tE);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function T9(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function tE(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nn(n){return n&&n._delegate?n._delegate:n}class Tu{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mc="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S9{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new o9;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&i.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(i)return null;throw r}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(C9(e))try{this.getOrInitializeService({instanceIdentifier:mc})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:r});i.resolve(s)}catch{}}}}clearInstance(e=mc){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=mc){return this.instances.has(e)}getOptions(e=mc){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[s,a]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(s);i===o&&a.resolve(r)}return r}onInit(e,t){const i=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(i)??new Set;r.add(e),this.onInitCallbacks.set(i,r);const s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const r of i)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:I9(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=mc){return this.component?this.component.multipleInstances?e:mc:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function I9(n){return n===mc?void 0:n}function C9(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k9{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new S9(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var lt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(lt||(lt={}));const $9={debug:lt.DEBUG,verbose:lt.VERBOSE,info:lt.INFO,warn:lt.WARN,error:lt.ERROR,silent:lt.SILENT},R9=lt.INFO,P9={[lt.DEBUG]:"log",[lt.VERBOSE]:"log",[lt.INFO]:"info",[lt.WARN]:"warn",[lt.ERROR]:"error"},N9=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),r=P9[e];if(r)console[r](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class wI{constructor(e){this.name=e,this._logLevel=R9,this._logHandler=N9,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in lt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?$9[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,lt.DEBUG,...e),this._logHandler(this,lt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,lt.VERBOSE,...e),this._logHandler(this,lt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,lt.INFO,...e),this._logHandler(this,lt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,lt.WARN,...e),this._logHandler(this,lt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,lt.ERROR,...e),this._logHandler(this,lt.ERROR,...e)}}const D9=(n,e)=>e.some(t=>n instanceof t);let L$,F$;function M9(){return L$||(L$=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function O9(){return F$||(F$=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const qL=new WeakMap,gT=new WeakMap,GL=new WeakMap,nE=new WeakMap,bI=new WeakMap;function L9(n){const e=new Promise((t,i)=>{const r=()=>{n.removeEventListener("success",s),n.removeEventListener("error",a)},s=()=>{t(_u(n.result)),r()},a=()=>{i(n.error),r()};n.addEventListener("success",s),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&qL.set(t,n)}).catch(()=>{}),bI.set(e,n),e}function F9(n){if(gT.has(n))return;const e=new Promise((t,i)=>{const r=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",a),n.removeEventListener("abort",a)},s=()=>{t(),r()},a=()=>{i(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",s),n.addEventListener("error",a),n.addEventListener("abort",a)});gT.set(n,e)}let yT={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return gT.get(n);if(e==="objectStoreNames")return n.objectStoreNames||GL.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return _u(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function z9(n){yT=n(yT)}function V9(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(iE(this),e,...t);return GL.set(i,e.sort?e.sort():[e]),_u(i)}:O9().includes(n)?function(...e){return n.apply(iE(this),e),_u(qL.get(this))}:function(...e){return _u(n.apply(iE(this),e))}}function j9(n){return typeof n=="function"?V9(n):(n instanceof IDBTransaction&&F9(n),D9(n,M9())?new Proxy(n,yT):n)}function _u(n){if(n instanceof IDBRequest)return L9(n);if(nE.has(n))return nE.get(n);const e=j9(n);return e!==n&&(nE.set(n,e),bI.set(e,n)),e}const iE=n=>bI.get(n);function B9(n,e,{blocked:t,upgrade:i,blocking:r,terminated:s}={}){const a=indexedDB.open(n,e),o=_u(a);return i&&a.addEventListener("upgradeneeded",l=>{i(_u(a.result),l.oldVersion,l.newVersion,_u(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),o.then(l=>{s&&l.addEventListener("close",()=>s()),r&&l.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),o}const U9=["get","getKey","getAll","getAllKeys","count"],H9=["put","add","delete","clear"],rE=new Map;function z$(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(rE.get(e))return rE.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,r=H9.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(r||U9.includes(t)))return;const s=async function(a,...o){const l=this.transaction(a,r?"readwrite":"readonly");let u=l.store;return i&&(u=u.index(o.shift())),(await Promise.all([u[t](...o),r&&l.done]))[0]};return rE.set(e,s),s}z9(n=>({...n,get:(e,t,i)=>z$(e,t)||n.get(e,t,i),has:(e,t)=>!!z$(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W9{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(q9(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function q9(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const _T="@firebase/app",V$="0.14.7";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qo=new wI("@firebase/app"),G9="@firebase/app-compat",K9="@firebase/analytics-compat",Y9="@firebase/analytics",X9="@firebase/app-check-compat",Q9="@firebase/app-check",J9="@firebase/auth",Z9="@firebase/auth-compat",eW="@firebase/database",tW="@firebase/data-connect",nW="@firebase/database-compat",iW="@firebase/functions",rW="@firebase/functions-compat",sW="@firebase/installations",aW="@firebase/installations-compat",oW="@firebase/messaging",lW="@firebase/messaging-compat",uW="@firebase/performance",cW="@firebase/performance-compat",dW="@firebase/remote-config",hW="@firebase/remote-config-compat",fW="@firebase/storage",pW="@firebase/storage-compat",mW="@firebase/firestore",gW="@firebase/ai",yW="@firebase/firestore-compat",_W="firebase",vW="12.8.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vT="[DEFAULT]",wW={[_T]:"fire-core",[G9]:"fire-core-compat",[Y9]:"fire-analytics",[K9]:"fire-analytics-compat",[Q9]:"fire-app-check",[X9]:"fire-app-check-compat",[J9]:"fire-auth",[Z9]:"fire-auth-compat",[eW]:"fire-rtdb",[tW]:"fire-data-connect",[nW]:"fire-rtdb-compat",[iW]:"fire-fn",[rW]:"fire-fn-compat",[sW]:"fire-iid",[aW]:"fire-iid-compat",[oW]:"fire-fcm",[lW]:"fire-fcm-compat",[uW]:"fire-perf",[cW]:"fire-perf-compat",[dW]:"fire-rc",[hW]:"fire-rc-compat",[fW]:"fire-gcs",[pW]:"fire-gcs-compat",[mW]:"fire-fst",[yW]:"fire-fst-compat",[gW]:"fire-vertex","fire-js":"fire-js",[_W]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hb=new Map,bW=new Map,wT=new Map;function j$(n,e){try{n.container.addComponent(e)}catch(t){Qo.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Hd(n){const e=n.name;if(wT.has(e))return Qo.debug(`There were multiple attempts to register component ${e}.`),!1;wT.set(e,n);for(const t of hb.values())j$(t,n);for(const t of bW.values())j$(t,n);return!0}function $1(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function kr(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xW={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},vu=new ev("app","Firebase",xW);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EW{constructor(e,t,i){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Tu("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw vu.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oh=vW;function KL(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i={name:vT,automaticDataCollectionEnabled:!0,...e},r=i.name;if(typeof r!="string"||!r)throw vu.create("bad-app-name",{appName:String(r)});if(t||(t=UL()),!t)throw vu.create("no-options");const s=hb.get(r);if(s){if(Ud(t,s.options)&&Ud(i,s.config))return s;throw vu.create("duplicate-app",{appName:r})}const a=new k9(r);for(const l of wT.values())a.addComponent(l);const o=new EW(t,i,a);return hb.set(r,o),o}function xI(n=vT){const e=hb.get(n);if(!e&&n===vT&&UL())return KL();if(!e)throw vu.create("no-app",{appName:n});return e}function Oa(n,e,t){let i=wW[n]??n;t&&(i+=`-${t}`);const r=i.match(/\s|\//),s=e.match(/\s|\//);if(r||s){const a=[`Unable to register library "${i}" with version "${e}":`];r&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&s&&a.push("and"),s&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Qo.warn(a.join(" "));return}Hd(new Tu(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AW="firebase-heartbeat-database",TW=1,uy="firebase-heartbeat-store";let sE=null;function YL(){return sE||(sE=B9(AW,TW,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(uy)}catch(t){console.warn(t)}}}}).catch(n=>{throw vu.create("idb-open",{originalErrorMessage:n.message})})),sE}async function SW(n){try{const t=(await YL()).transaction(uy),i=await t.objectStore(uy).get(XL(n));return await t.done,i}catch(e){if(e instanceof Wa)Qo.warn(e.message);else{const t=vu.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Qo.warn(t.message)}}}async function B$(n,e){try{const i=(await YL()).transaction(uy,"readwrite");await i.objectStore(uy).put(e,XL(n)),await i.done}catch(t){if(t instanceof Wa)Qo.warn(t.message);else{const i=vu.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Qo.warn(i.message)}}}function XL(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IW=1024,CW=30;class kW{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new RW(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,t;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=U$();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:r}),this._heartbeatsCache.heartbeats.length>CW){const a=PW(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){Qo.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=U$(),{heartbeatsToSend:i,unsentEntries:r}=$W(this._heartbeatsCache.heartbeats),s=db(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Qo.warn(t),""}}}function U$(){return new Date().toISOString().substring(0,10)}function $W(n,e=IW){const t=[];let i=n.slice();for(const r of n){const s=t.find(a=>a.agent===r.agent);if(s){if(s.dates.push(r.date),H$(t)>e){s.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),H$(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class RW{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return y9()?_9().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await SW(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return B$(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return B$(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function H$(n){return db(JSON.stringify({version:2,heartbeats:n})).length}function PW(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let i=1;i<n.length;i++)n[i].date<t&&(t=n[i].date,e=i);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NW(n){Hd(new Tu("platform-logger",e=>new W9(e),"PRIVATE")),Hd(new Tu("heartbeat",e=>new kW(e),"PRIVATE")),Oa(_T,V$,n),Oa(_T,V$,"esm2020"),Oa("fire-js","")}NW("");function QL(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const DW=QL,JL=new ev("auth","Firebase",QL());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fb=new wI("@firebase/auth");function MW(n,...e){fb.logLevel<=lt.WARN&&fb.warn(`Auth (${oh}): ${n}`,...e)}function Z0(n,...e){fb.logLevel<=lt.ERROR&&fb.error(`Auth (${oh}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ys(n,...e){throw EI(n,...e)}function La(n,...e){return EI(n,...e)}function ZL(n,e,t){const i={...DW(),[e]:t};return new ev("auth","Firebase",i).create(e,{appName:n.name})}function Bo(n){return ZL(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function EI(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return JL.create(n,...e)}function Be(n,e,...t){if(!n)throw EI(e,...t)}function zo(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Z0(e),new Error(e)}function Jo(n,e){n||zo(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bT(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function OW(){return W$()==="http:"||W$()==="https:"}function W$(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LW(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(OW()||f9()||"connection"in navigator)?navigator.onLine:!0}function FW(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nv{constructor(e,t){this.shortDelay=e,this.longDelay=t,Jo(t>e,"Short delay should be less than long delay!"),this.isMobile=c9()||p9()}get(){return LW()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AI(n,e){Jo(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e4{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;zo("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;zo("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;zo("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zW={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VW=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],jW=new nv(3e4,6e4);function zu(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Vu(n,e,t,i,r={}){return t4(n,r,async()=>{let s={},a={};i&&(e==="GET"?a=i:s={body:JSON.stringify(i)});const o=tv({key:n.config.apiKey,...a}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:l,...s};return h9()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&ah(n.emulatorConfig.host)&&(u.credentials="include"),e4.fetch()(await n4(n,n.config.apiHost,t,o),u)})}async function t4(n,e,t){n._canInitEmulator=!1;const i={...zW,...e};try{const r=new UW(n),s=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const a=await s.json();if("needConfirmation"in a)throw p0(n,"account-exists-with-different-credential",a);if(s.ok&&!("errorMessage"in a))return a;{const o=s.ok?a.errorMessage:a.error.message,[l,u]=o.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw p0(n,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw p0(n,"email-already-in-use",a);if(l==="USER_DISABLED")throw p0(n,"user-disabled",a);const c=i[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw ZL(n,c,u);Ys(n,c)}}catch(r){if(r instanceof Wa)throw r;Ys(n,"network-request-failed",{message:String(r)})}}async function iv(n,e,t,i,r={}){const s=await Vu(n,e,t,i,r);return"mfaPendingCredential"in s&&Ys(n,"multi-factor-auth-required",{_serverResponse:s}),s}async function n4(n,e,t,i){const r=`${e}${t}?${i}`,s=n,a=s.config.emulator?AI(n.config,r):`${n.config.apiScheme}://${r}`;return VW.includes(t)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(a).toString():a}function BW(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class UW{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(La(this.auth,"network-request-failed")),jW.get())})}}function p0(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const r=La(n,e,i);return r.customData._tokenResponse=t,r}function q$(n){return n!==void 0&&n.enterprise!==void 0}class HW{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return BW(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function WW(n,e){return Vu(n,"GET","/v2/recaptchaConfig",zu(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qW(n,e){return Vu(n,"POST","/v1/accounts:delete",e)}async function pb(n,e){return Vu(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Og(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function GW(n,e=!1){const t=Nn(n),i=await t.getIdToken(e),r=TI(i);Be(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const s=typeof r.firebase=="object"?r.firebase:void 0,a=s==null?void 0:s.sign_in_provider;return{claims:r,token:i,authTime:Og(aE(r.auth_time)),issuedAtTime:Og(aE(r.iat)),expirationTime:Og(aE(r.exp)),signInProvider:a||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function aE(n){return Number(n)*1e3}function TI(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return Z0("JWT malformed, contained fewer than 3 sections"),null;try{const r=VL(t);return r?JSON.parse(r):(Z0("Failed to decode base64 JWT payload"),null)}catch(r){return Z0("Caught error parsing JWT payload as JSON",r==null?void 0:r.toString()),null}}function G$(n){const e=TI(n);return Be(e,"internal-error"),Be(typeof e.exp<"u","internal-error"),Be(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cy(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof Wa&&KW(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function KW({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YW{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const i=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xT{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Og(this.lastLoginAt),this.creationTime=Og(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mb(n){var h;const e=n.auth,t=await n.getIdToken(),i=await cy(n,pb(e,{idToken:t}));Be(i==null?void 0:i.users.length,e,"internal-error");const r=i.users[0];n._notifyReloadListener(r);const s=(h=r.providerUserInfo)!=null&&h.length?i4(r.providerUserInfo):[],a=QW(n.providerData,s),o=n.isAnonymous,l=!(n.email&&r.passwordHash)&&!(a!=null&&a.length),u=o?l:!1,c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new xT(r.createdAt,r.lastLoginAt),isAnonymous:u};Object.assign(n,c)}async function XW(n){const e=Nn(n);await mb(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function QW(n,e){return[...n.filter(i=>!e.some(r=>r.providerId===i.providerId)),...e]}function i4(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JW(n,e){const t=await t4(n,{},async()=>{const i=tv({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:s}=n.config,a=await n4(n,r,"/v1/token",`key=${s}`),o=await n._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:o,body:i};return n.emulatorConfig&&ah(n.emulatorConfig.host)&&(l.credentials="include"),e4.fetch()(a,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function ZW(n,e){return Vu(n,"POST","/v2/accounts:revokeToken",zu(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Be(e.idToken,"internal-error"),Be(typeof e.idToken<"u","internal-error"),Be(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):G$(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Be(e.length!==0,"internal-error");const t=G$(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Be(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:r,expiresIn:s}=await JW(e,t);this.updateTokensAndExpiration(i,r,Number(s))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:r,expirationTime:s}=t,a=new pf;return i&&(Be(typeof i=="string","internal-error",{appName:e}),a.refreshToken=i),r&&(Be(typeof r=="string","internal-error",{appName:e}),a.accessToken=r),s&&(Be(typeof s=="number","internal-error",{appName:e}),a.expirationTime=s),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new pf,this.toJSON())}_performRefresh(){return zo("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gl(n,e){Be(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Vs{constructor({uid:e,auth:t,stsTokenManager:i,...r}){this.providerId="firebase",this.proactiveRefresh=new YW(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new xT(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await cy(this,this.stsTokenManager.getToken(this.auth,e));return Be(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return GW(this,e)}reload(){return XW(this)}_assign(e){this!==e&&(Be(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Vs({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){Be(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await mb(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(kr(this.auth.app))return Promise.reject(Bo(this.auth));const e=await this.getIdToken();return await cy(this,qW(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const i=t.displayName??void 0,r=t.email??void 0,s=t.phoneNumber??void 0,a=t.photoURL??void 0,o=t.tenantId??void 0,l=t._redirectEventId??void 0,u=t.createdAt??void 0,c=t.lastLoginAt??void 0,{uid:h,emailVerified:f,isAnonymous:m,providerData:y,stsTokenManager:_}=t;Be(h&&_,e,"internal-error");const x=pf.fromJSON(this.name,_);Be(typeof h=="string",e,"internal-error"),gl(i,e.name),gl(r,e.name),Be(typeof f=="boolean",e,"internal-error"),Be(typeof m=="boolean",e,"internal-error"),gl(s,e.name),gl(a,e.name),gl(o,e.name),gl(l,e.name),gl(u,e.name),gl(c,e.name);const v=new Vs({uid:h,auth:e,email:r,emailVerified:f,displayName:i,isAnonymous:m,photoURL:a,phoneNumber:s,tenantId:o,stsTokenManager:x,createdAt:u,lastLoginAt:c});return y&&Array.isArray(y)&&(v.providerData=y.map(w=>({...w}))),l&&(v._redirectEventId=l),v}static async _fromIdTokenResponse(e,t,i=!1){const r=new pf;r.updateFromServerResponse(t);const s=new Vs({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:i});return await mb(s),s}static async _fromGetAccountInfoResponse(e,t,i){const r=t.users[0];Be(r.localId!==void 0,"internal-error");const s=r.providerUserInfo!==void 0?i4(r.providerUserInfo):[],a=!(r.email&&r.passwordHash)&&!(s!=null&&s.length),o=new pf;o.updateFromIdToken(i);const l=new Vs({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:a}),u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new xT(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(s!=null&&s.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K$=new Map;function Vo(n){Jo(n instanceof Function,"Expected a class definition");let e=K$.get(n);return e?(Jo(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,K$.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r4{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}r4.type="NONE";const Y$=r4;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ew(n,e,t){return`firebase:${n}:${e}:${t}`}class mf{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:r,name:s}=this.auth;this.fullUserKey=ew(this.userKey,r.apiKey,s),this.fullPersistenceKey=ew("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await pb(this.auth,{idToken:e}).catch(()=>{});return t?Vs._fromGetAccountInfoResponse(this.auth,t,e):null}return Vs._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new mf(Vo(Y$),e,i);const r=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let s=r[0]||Vo(Y$);const a=ew(i,e.config.apiKey,e.name);let o=null;for(const u of t)try{const c=await u._get(a);if(c){let h;if(typeof c=="string"){const f=await pb(e,{idToken:c}).catch(()=>{});if(!f)break;h=await Vs._fromGetAccountInfoResponse(e,f,c)}else h=Vs._fromJSON(e,c);u!==s&&(o=h),s=u;break}}catch{}const l=r.filter(u=>u._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new mf(s,e,i):(s=l[0],o&&await s._set(a,o.toJSON()),await Promise.all(t.map(async u=>{if(u!==s)try{await u._remove(a)}catch{}})),new mf(s,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X$(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(l4(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(s4(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(c4(e))return"Blackberry";if(d4(e))return"Webos";if(a4(e))return"Safari";if((e.includes("chrome/")||o4(e))&&!e.includes("edge/"))return"Chrome";if(u4(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if((i==null?void 0:i.length)===2)return i[1]}return"Other"}function s4(n=Ai()){return/firefox\//i.test(n)}function a4(n=Ai()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function o4(n=Ai()){return/crios\//i.test(n)}function l4(n=Ai()){return/iemobile/i.test(n)}function u4(n=Ai()){return/android/i.test(n)}function c4(n=Ai()){return/blackberry/i.test(n)}function d4(n=Ai()){return/webos/i.test(n)}function SI(n=Ai()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function eq(n=Ai()){var e;return SI(n)&&!!((e=window.navigator)!=null&&e.standalone)}function tq(){return m9()&&document.documentMode===10}function h4(n=Ai()){return SI(n)||u4(n)||d4(n)||c4(n)||/windows phone/i.test(n)||l4(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f4(n,e=[]){let t;switch(n){case"Browser":t=X$(Ai());break;case"Worker":t=`${X$(Ai())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${oh}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nq{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=s=>new Promise((a,o)=>{try{const l=e(s);a(l)}catch(l){o(l)}});i.onAbort=t,this.queue.push(i);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i==null?void 0:i.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iq(n,e={}){return Vu(n,"GET","/v2/passwordPolicy",zu(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rq=6;class sq{constructor(e){var i;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??rq,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((i=e.allowedNonAlphanumericCharacters)==null?void 0:i.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const i=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let r=0;r<e.length;r++)i=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,r,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aq{constructor(e,t,i,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Q$(this),this.idTokenSubscription=new Q$(this),this.beforeStateQueue=new nq(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=JL,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Vo(t)),this._initializationPromise=this.queue(async()=>{var i,r,s;if(!this._deleted&&(this.persistenceManager=await mf.create(this,e),(i=this._resolvePersistenceManagerAvailable)==null||i.call(this),!this._deleted)){if((r=this._popupRedirectResolver)!=null&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)==null?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await pb(this,{idToken:e}),i=await Vs._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var s;if(kr(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(o,o))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let i=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(s=this.redirectUser)==null?void 0:s._redirectEventId,o=i==null?void 0:i._redirectEventId,l=await this.tryRedirectSignIn(e);(!a||a===o)&&(l!=null&&l.user)&&(i=l.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(a){i=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Be(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await mb(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=FW()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(kr(this.app))return Promise.reject(Bo(this));const t=e?Nn(e):null;return t&&Be(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Be(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return kr(this.app)?Promise.reject(Bo(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return kr(this.app)?Promise.reject(Bo(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Vo(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await iq(this),t=new sq(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ev("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),await ZW(this,i)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Vo(e)||this._popupRedirectResolver;Be(t,this,"argument-error"),this.redirectPersistenceManager=await mf.create(this,[Vo(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)==null?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,r){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t);let a=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Be(o,this,"internal-error"),o.then(()=>{a||s(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,i,r);return()=>{a=!0,l()}}else{const l=e.addObserver(t);return()=>{a=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Be(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=f4(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var r;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((r=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:r.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const i=await this._getAppCheckToken();return i&&(e["X-Firebase-AppCheck"]=i),e}async _getAppCheckToken(){var t;if(kr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&MW(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function lh(n){return Nn(n)}class Q${constructor(e){this.auth=e,this.observer=null,this.addObserver=E9(t=>this.observer=t)}get next(){return Be(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let R1={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function oq(n){R1=n}function p4(n){return R1.loadJS(n)}function lq(){return R1.recaptchaEnterpriseScript}function uq(){return R1.gapiScript}function cq(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class dq{constructor(){this.enterprise=new hq}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class hq{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const fq="recaptcha-enterprise",m4="NO_RECAPTCHA";class pq{constructor(e){this.type=fq,this.auth=lh(e)}async verify(e="verify",t=!1){async function i(s){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise(async(a,o)=>{WW(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)o(new Error("recaptcha Enterprise site key undefined"));else{const u=new HW(l);return s.tenantId==null?s._agentRecaptchaConfig=u:s._tenantRecaptchaConfigs[s.tenantId]=u,a(u.siteKey)}}).catch(l=>{o(l)})})}function r(s,a,o){const l=window.grecaptcha;q$(l)?l.enterprise.ready(()=>{l.enterprise.execute(s,{action:e}).then(u=>{a(u)}).catch(()=>{a(m4)})}):o(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new dq().execute("siteKey",{action:"verify"}):new Promise((s,a)=>{i(this.auth).then(o=>{if(!t&&q$(window.grecaptcha))r(o,s,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let l=lq();l.length!==0&&(l+=o),p4(l).then(()=>{r(o,s,a)}).catch(u=>{a(u)})}}).catch(o=>{a(o)})})}}async function J$(n,e,t,i=!1,r=!1){const s=new pq(n);let a;if(r)a=m4;else try{a=await s.verify(t)}catch{a=await s.verify(t,!0)}const o={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in o){const l=o.phoneEnrollmentInfo.phoneNumber,u=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const l=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return i?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function ET(n,e,t,i,r){var s;if((s=n._getRecaptchaConfig())!=null&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await J$(n,e,t,t==="getOobCode");return i(n,a)}else return i(n,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await J$(n,e,t,t==="getOobCode");return i(n,o)}else return Promise.reject(a)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mq(n,e){const t=$1(n,"auth");if(t.isInitialized()){const r=t.getImmediate(),s=t.getOptions();if(Ud(s,e??{}))return r;Ys(r,"already-initialized")}return t.initialize({options:e})}function gq(n,e){const t=(e==null?void 0:e.persistence)||[],i=(Array.isArray(t)?t:[t]).map(Vo);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e==null?void 0:e.popupRedirectResolver)}function yq(n,e,t){const i=lh(n);Be(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const r=!1,s=g4(e),{host:a,port:o}=_q(e),l=o===null?"":`:${o}`,u={url:`${s}//${a}${l}/`},c=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!i._canInitEmulator){Be(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),Be(Ud(u,i.config.emulator)&&Ud(c,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=u,i.emulatorConfig=c,i.settings.appVerificationDisabledForTesting=!0,ah(a)?(_I(`${s}//${a}${l}`),vI("Auth",!0)):vq()}function g4(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function _q(n){const e=g4(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const s=r[1];return{host:s,port:Z$(i.substr(s.length+1))}}else{const[s,a]=i.split(":");return{host:s,port:Z$(a)}}}function Z$(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function vq(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class II{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return zo("not implemented")}_getIdTokenResponse(e){return zo("not implemented")}_linkToIdToken(e,t){return zo("not implemented")}_getReauthenticationResolver(e){return zo("not implemented")}}async function wq(n,e){return Vu(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bq(n,e){return iv(n,"POST","/v1/accounts:signInWithPassword",zu(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xq(n,e){return iv(n,"POST","/v1/accounts:signInWithEmailLink",zu(n,e))}async function Eq(n,e){return iv(n,"POST","/v1/accounts:signInWithEmailLink",zu(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dy extends II{constructor(e,t,i,r=null){super("password",i),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new dy(e,t,"password")}static _fromEmailAndCode(e,t,i=null){return new dy(e,t,"emailLink",i)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ET(e,t,"signInWithPassword",bq);case"emailLink":return xq(e,{email:this._email,oobCode:this._password});default:Ys(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const i={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ET(e,i,"signUpPassword",wq);case"emailLink":return Eq(e,{idToken:t,email:this._email,oobCode:this._password});default:Ys(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gf(n,e){return iv(n,"POST","/v1/accounts:signInWithIdp",zu(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Aq="http://localhost";class Wd extends II{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Wd(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ys("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:r,...s}=t;if(!i||!r)return null;const a=new Wd(i,r);return a.idToken=s.idToken||void 0,a.accessToken=s.accessToken||void 0,a.secret=s.secret,a.nonce=s.nonce,a.pendingToken=s.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return gf(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,gf(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,gf(e,t)}buildRequest(){const e={requestUri:Aq,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=tv(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tq(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Sq(n){const e=Zm(eg(n)).link,t=e?Zm(eg(e)).deep_link_id:null,i=Zm(eg(n)).deep_link_id;return(i?Zm(eg(i)).link:null)||i||t||e||n}class CI{constructor(e){const t=Zm(eg(e)),i=t.apiKey??null,r=t.oobCode??null,s=Tq(t.mode??null);Be(i&&r&&s,"argument-error"),this.apiKey=i,this.operation=s,this.code=r,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=Sq(e);try{return new CI(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qp{constructor(){this.providerId=qp.PROVIDER_ID}static credential(e,t){return dy._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const i=CI.parseLink(t);return Be(i,"argument-error"),dy._fromEmailAndCode(e,i.code,i.tenantId)}}qp.PROVIDER_ID="password";qp.EMAIL_PASSWORD_SIGN_IN_METHOD="password";qp.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y4{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rv extends y4{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sl extends rv{constructor(){super("facebook.com")}static credential(e){return Wd._fromParams({providerId:Sl.PROVIDER_ID,signInMethod:Sl.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Sl.credentialFromTaggedObject(e)}static credentialFromError(e){return Sl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Sl.credential(e.oauthAccessToken)}catch{return null}}}Sl.FACEBOOK_SIGN_IN_METHOD="facebook.com";Sl.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Il extends rv{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Wd._fromParams({providerId:Il.PROVIDER_ID,signInMethod:Il.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Il.credentialFromTaggedObject(e)}static credentialFromError(e){return Il.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return Il.credential(t,i)}catch{return null}}}Il.GOOGLE_SIGN_IN_METHOD="google.com";Il.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cl extends rv{constructor(){super("github.com")}static credential(e){return Wd._fromParams({providerId:Cl.PROVIDER_ID,signInMethod:Cl.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Cl.credentialFromTaggedObject(e)}static credentialFromError(e){return Cl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Cl.credential(e.oauthAccessToken)}catch{return null}}}Cl.GITHUB_SIGN_IN_METHOD="github.com";Cl.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kl extends rv{constructor(){super("twitter.com")}static credential(e,t){return Wd._fromParams({providerId:kl.PROVIDER_ID,signInMethod:kl.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return kl.credentialFromTaggedObject(e)}static credentialFromError(e){return kl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return kl.credential(t,i)}catch{return null}}}kl.TWITTER_SIGN_IN_METHOD="twitter.com";kl.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Iq(n,e){return iv(n,"POST","/v1/accounts:signUp",zu(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qd{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,r=!1){const s=await Vs._fromIdTokenResponse(e,i,r),a=eR(i);return new qd({user:s,providerId:a,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const r=eR(i);return new qd({user:e,providerId:r,_tokenResponse:i,operationType:t})}}function eR(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gb extends Wa{constructor(e,t,i,r){super(t.code,t.message),this.operationType=i,this.user=r,Object.setPrototypeOf(this,gb.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,r){return new gb(e,t,i,r)}}function _4(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?gb._fromErrorAndOperation(n,s,e,i):s})}async function Cq(n,e,t=!1){const i=await cy(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return qd._forOperation(n,"link",i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kq(n,e,t=!1){const{auth:i}=n;if(kr(i.app))return Promise.reject(Bo(i));const r="reauthenticate";try{const s=await cy(n,_4(i,r,e,n),t);Be(s.idToken,i,"internal-error");const a=TI(s.idToken);Be(a,i,"internal-error");const{sub:o}=a;return Be(n.uid===o,i,"user-mismatch"),qd._forOperation(n,r,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&Ys(i,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function v4(n,e,t=!1){if(kr(n.app))return Promise.reject(Bo(n));const i="signIn",r=await _4(n,i,e),s=await qd._fromIdTokenResponse(n,i,r);return t||await n._updateCurrentUser(s.user),s}async function $q(n,e){return v4(lh(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function w4(n){const e=lh(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Rq(n,e,t){if(kr(n.app))return Promise.reject(Bo(n));const i=lh(n),a=await ET(i,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Iq).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&w4(n),l}),o=await qd._fromIdTokenResponse(i,"signIn",a);return await i._updateCurrentUser(o.user),o}function Pq(n,e,t){return kr(n.app)?Promise.reject(Bo(n)):$q(Nn(n),qp.credential(e,t)).catch(async i=>{throw i.code==="auth/password-does-not-meet-requirements"&&w4(n),i})}function Nq(n,e,t,i){return Nn(n).onIdTokenChanged(e,t,i)}function Dq(n,e,t){return Nn(n).beforeAuthStateChanged(e,t)}function Mq(n,e,t,i){return Nn(n).onAuthStateChanged(e,t,i)}function Oq(n){return Nn(n).signOut()}const yb="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b4{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(yb,"1"),this.storage.removeItem(yb),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lq=1e3,Fq=10;class x4 extends b4{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=h4(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),r=this.localCache[t];i!==r&&e(t,r,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,o,l)=>{this.notifyListeners(a,l)});return}const i=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const a=this.storage.getItem(i);!t&&this.localCache[i]===a||this.notifyListeners(i,a)},s=this.storage.getItem(i);tq()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,Fq):r()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const r of Array.from(i))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},Lq)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}x4.type="LOCAL";const zq=x4;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E4 extends b4{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}E4.type="SESSION";const A4=E4;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vq(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P1{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const i=new P1(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:r,data:s}=t.data,a=this.handlersMap[r];if(!(a!=null&&a.size))return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:r});const o=Array.from(a).map(async u=>u(t.origin,s)),l=await Vq(o);t.ports[0].postMessage({status:"done",eventId:i,eventType:r,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}P1.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kI(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jq{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,a;return new Promise((o,l)=>{const u=kI("",20);r.port1.start();const c=setTimeout(()=>{l(new Error("unsupported_event"))},i);a={messageChannel:r,onMessage(h){const f=h;if(f.data.eventId===u)switch(f.data.status){case"ack":clearTimeout(c),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),o(f.data.response);break;default:clearTimeout(c),clearTimeout(s),l(new Error("invalid_response"));break}}},this.handlers.add(a),r.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[r.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fa(){return window}function Bq(n){Fa().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T4(){return typeof Fa().WorkerGlobalScope<"u"&&typeof Fa().importScripts=="function"}async function Uq(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Hq(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function Wq(){return T4()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S4="firebaseLocalStorageDb",qq=1,_b="firebaseLocalStorage",I4="fbase_key";class sv{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function N1(n,e){return n.transaction([_b],e?"readwrite":"readonly").objectStore(_b)}function Gq(){const n=indexedDB.deleteDatabase(S4);return new sv(n).toPromise()}function AT(){const n=indexedDB.open(S4,qq);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(_b,{keyPath:I4})}catch(r){t(r)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(_b)?e(i):(i.close(),await Gq(),e(await AT()))})})}async function tR(n,e,t){const i=N1(n,!0).put({[I4]:e,value:t});return new sv(i).toPromise()}async function Kq(n,e){const t=N1(n,!1).get(e),i=await new sv(t).toPromise();return i===void 0?null:i.value}function nR(n,e){const t=N1(n,!0).delete(e);return new sv(t).toPromise()}const Yq=800,Xq=3;class C4{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await AT(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>Xq)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return T4()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=P1._getInstance(Wq()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,i;if(this.activeServiceWorker=await Uq(),!this.activeServiceWorker)return;this.sender=new jq(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(i=e[0])!=null&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Hq()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await AT();return await tR(e,yb,"1"),await nR(e,yb),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>tR(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>Kq(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>nR(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const s=N1(r,!1).getAll();return new sv(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;if(e.length!==0)for(const{fbase_key:r,value:s}of e)i.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(s)&&(this.notifyListeners(r,s),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!i.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const r of Array.from(i))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Yq)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}C4.type="LOCAL";const Qq=C4;new nv(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jq(n,e){return e?Vo(e):(Be(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $I extends II{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return gf(e,this._buildIdpRequest())}_linkToIdToken(e,t){return gf(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return gf(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Zq(n){return v4(n.auth,new $I(n),n.bypassAuthState)}function eG(n){const{auth:e,user:t}=n;return Be(t,e,"internal-error"),kq(t,new $I(n),n.bypassAuthState)}async function tG(n){const{auth:e,user:t}=n;return Be(t,e,"internal-error"),Cq(t,new $I(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k4{constructor(e,t,i,r,s=!1){this.auth=e,this.resolver=i,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:r,tenantId:s,error:a,type:o}=e;if(a){this.reject(a);return}const l={auth:this.auth,requestUri:t,sessionId:i,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Zq;case"linkViaPopup":case"linkViaRedirect":return tG;case"reauthViaPopup":case"reauthViaRedirect":return eG;default:Ys(this.auth,"internal-error")}}resolve(e){Jo(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Jo(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nG=new nv(2e3,1e4);class Zh extends k4{constructor(e,t,i,r,s){super(e,t,r,s),this.provider=i,this.authWindow=null,this.pollId=null,Zh.currentPopupAction&&Zh.currentPopupAction.cancel(),Zh.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Be(e,this.auth,"internal-error"),e}async onExecution(){Jo(this.filter.length===1,"Popup operations only handle one event");const e=kI();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(La(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(La(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Zh.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if((i=(t=this.authWindow)==null?void 0:t.window)!=null&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(La(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,nG.get())};e()}}Zh.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iG="pendingRedirect",tw=new Map;class rG extends k4{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=tw.get(this.auth._key());if(!e){try{const i=await sG(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}tw.set(this.auth._key(),e)}return this.bypassAuthState||tw.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function sG(n,e){const t=lG(e),i=oG(n);if(!await i._isAvailable())return!1;const r=await i._get(t)==="true";return await i._remove(t),r}function aG(n,e){tw.set(n._key(),e)}function oG(n){return Vo(n._redirectPersistence)}function lG(n){return ew(iG,n.config.apiKey,n.name)}async function uG(n,e,t=!1){if(kr(n.app))return Promise.reject(Bo(n));const i=lh(n),r=Jq(i,e),a=await new rG(i,r,t).execute();return a&&!t&&(delete a.user._redirectEventId,await i._persistUserIfCurrent(a.user),await i._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cG=10*60*1e3;class dG{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!hG(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!$4(e)){const r=((i=e.error.code)==null?void 0:i.split("auth/")[1])||"internal-error";t.onError(La(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=cG&&this.cachedEventUids.clear(),this.cachedEventUids.has(iR(e))}saveEventToCache(e){this.cachedEventUids.add(iR(e)),this.lastProcessedEventTime=Date.now()}}function iR(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function $4({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function hG(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return $4(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fG(n,e={}){return Vu(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pG=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,mG=/^https?/;async function gG(n){if(n.config.emulator)return;const{authorizedDomains:e}=await fG(n);for(const t of e)try{if(yG(t))return}catch{}Ys(n,"unauthorized-domain")}function yG(n){const e=bT(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===i}if(!mG.test(t))return!1;if(pG.test(n))return i===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _G=new nv(3e4,6e4);function rR(){const n=Fa().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function vG(n){return new Promise((e,t)=>{var r,s,a;function i(){rR(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{rR(),t(La(n,"network-request-failed"))},timeout:_G.get()})}if((s=(r=Fa().gapi)==null?void 0:r.iframes)!=null&&s.Iframe)e(gapi.iframes.getContext());else if((a=Fa().gapi)!=null&&a.load)i();else{const o=cq("iframefcb");return Fa()[o]=()=>{gapi.load?i():t(La(n,"network-request-failed"))},p4(`${uq()}?onload=${o}`).catch(l=>t(l))}}).catch(e=>{throw nw=null,e})}let nw=null;function wG(n){return nw=nw||vG(n),nw}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bG=new nv(5e3,15e3),xG="__/auth/iframe",EG="emulator/auth/iframe",AG={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},TG=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function SG(n){const e=n.config;Be(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?AI(e,EG):`https://${n.config.authDomain}/${xG}`,i={apiKey:e.apiKey,appName:n.name,v:oh},r=TG.get(n.config.apiHost);r&&(i.eid=r);const s=n._getFrameworks();return s.length&&(i.fw=s.join(",")),`${t}?${tv(i).slice(1)}`}async function IG(n){const e=await wG(n),t=Fa().gapi;return Be(t,n,"internal-error"),e.open({where:document.body,url:SG(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:AG,dontclear:!0},i=>new Promise(async(r,s)=>{await i.restyle({setHideOnLeave:!1});const a=La(n,"network-request-failed"),o=Fa().setTimeout(()=>{s(a)},bG.get());function l(){Fa().clearTimeout(o),r(i)}i.ping(l).then(l,()=>{s(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CG={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},kG=500,$G=600,RG="_blank",PG="http://localhost";class sR{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function NG(n,e,t,i=kG,r=$G){const s=Math.max((window.screen.availHeight-r)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString();let o="";const l={...CG,width:i.toString(),height:r.toString(),top:s,left:a},u=Ai().toLowerCase();t&&(o=o4(u)?RG:t),s4(u)&&(e=e||PG,l.scrollbars="yes");const c=Object.entries(l).reduce((f,[m,y])=>`${f}${m}=${y},`,"");if(eq(u)&&o!=="_self")return DG(e||"",o),new sR(null);const h=window.open(e||"",o,c);Be(h,n,"popup-blocked");try{h.focus()}catch{}return new sR(h)}function DG(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MG="__/auth/handler",OG="emulator/auth/handler",LG=encodeURIComponent("fac");async function aR(n,e,t,i,r,s){Be(n.config.authDomain,n,"auth-domain-config-required"),Be(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:oh,eventId:r};if(e instanceof y4){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",x9(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[c,h]of Object.entries({}))a[c]=h}if(e instanceof rv){const c=e.getScopes().filter(h=>h!=="");c.length>0&&(a.scopes=c.join(","))}n.tenantId&&(a.tid=n.tenantId);const o=a;for(const c of Object.keys(o))o[c]===void 0&&delete o[c];const l=await n._getAppCheckToken(),u=l?`#${LG}=${encodeURIComponent(l)}`:"";return`${FG(n)}?${tv(o).slice(1)}${u}`}function FG({config:n}){return n.emulator?AI(n,OG):`https://${n.authDomain}/${MG}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oE="webStorageSupport";class zG{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=A4,this._completeRedirectFn=uG,this._overrideRedirectResult=aG}async _openPopup(e,t,i,r){var a;Jo((a=this.eventManagers[e._key()])==null?void 0:a.manager,"_initialize() not called before _openPopup()");const s=await aR(e,t,i,bT(),r);return NG(e,s,kI())}async _openRedirect(e,t,i,r){await this._originValidation(e);const s=await aR(e,t,i,bT(),r);return Bq(s),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:s}=this.eventManagers[t];return r?Promise.resolve(r):(Jo(s,"If manager is not set, promise should be"),s)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await IG(e),i=new dG(e);return t.register("authEvent",r=>(Be(r==null?void 0:r.authEvent,e,"invalid-auth-event"),{status:i.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(oE,{type:oE},r=>{var a;const s=(a=r==null?void 0:r[0])==null?void 0:a[oE];s!==void 0&&t(!!s),Ys(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=gG(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return h4()||a4()||SI()}}const VG=zG;var oR="@firebase/auth",lR="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jG{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e((i==null?void 0:i.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Be(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BG(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function UG(n){Hd(new Tu("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=i.options;Be(a&&!a.includes(":"),"invalid-api-key",{appName:i.name});const l={apiKey:a,authDomain:o,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:f4(n)},u=new aq(i,r,s,l);return gq(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),Hd(new Tu("auth-internal",e=>{const t=lh(e.getProvider("auth").getImmediate());return(i=>new jG(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Oa(oR,lR,BG(n)),Oa(oR,lR,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HG=5*60,WG=HL("authIdTokenMaxAge")||HG;let uR=null;const qG=n=>async e=>{const t=e&&await e.getIdTokenResult(),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>WG)return;const r=t==null?void 0:t.token;uR!==r&&(uR=r,await fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function GG(n=xI()){const e=$1(n,"auth");if(e.isInitialized())return e.getImmediate();const t=mq(n,{popupRedirectResolver:VG,persistence:[Qq,zq,A4]}),i=HL("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(i,location.origin);if(location.origin===s.origin){const a=qG(s.toString());Dq(t,a,()=>a(t.currentUser)),Nq(t,o=>a(o))}}const r=jL("auth");return r&&yq(t,`http://${r}`),t}function KG(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}oq({loadJS(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=r=>{const s=La("internal-error");s.customData=r,t(s)},i.type="text/javascript",i.charset="UTF-8",KG().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});UG("Browser");var YG="firebase",XG="12.8.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Oa(YG,XG,"app");var cR=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var wu,R4;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(I,C){function N(){}N.prototype=C.prototype,I.F=C.prototype,I.prototype=new N,I.prototype.constructor=I,I.D=function(O,V,U){for(var j=Array(arguments.length-2),he=2;he<arguments.length;he++)j[he-2]=arguments[he];return C.prototype[V].apply(O,j)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(i,t),i.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(I,C,N){N||(N=0);const O=Array(16);if(typeof C=="string")for(var V=0;V<16;++V)O[V]=C.charCodeAt(N++)|C.charCodeAt(N++)<<8|C.charCodeAt(N++)<<16|C.charCodeAt(N++)<<24;else for(V=0;V<16;++V)O[V]=C[N++]|C[N++]<<8|C[N++]<<16|C[N++]<<24;C=I.g[0],N=I.g[1],V=I.g[2];let U=I.g[3],j;j=C+(U^N&(V^U))+O[0]+3614090360&4294967295,C=N+(j<<7&4294967295|j>>>25),j=U+(V^C&(N^V))+O[1]+3905402710&4294967295,U=C+(j<<12&4294967295|j>>>20),j=V+(N^U&(C^N))+O[2]+606105819&4294967295,V=U+(j<<17&4294967295|j>>>15),j=N+(C^V&(U^C))+O[3]+3250441966&4294967295,N=V+(j<<22&4294967295|j>>>10),j=C+(U^N&(V^U))+O[4]+4118548399&4294967295,C=N+(j<<7&4294967295|j>>>25),j=U+(V^C&(N^V))+O[5]+1200080426&4294967295,U=C+(j<<12&4294967295|j>>>20),j=V+(N^U&(C^N))+O[6]+2821735955&4294967295,V=U+(j<<17&4294967295|j>>>15),j=N+(C^V&(U^C))+O[7]+4249261313&4294967295,N=V+(j<<22&4294967295|j>>>10),j=C+(U^N&(V^U))+O[8]+1770035416&4294967295,C=N+(j<<7&4294967295|j>>>25),j=U+(V^C&(N^V))+O[9]+2336552879&4294967295,U=C+(j<<12&4294967295|j>>>20),j=V+(N^U&(C^N))+O[10]+4294925233&4294967295,V=U+(j<<17&4294967295|j>>>15),j=N+(C^V&(U^C))+O[11]+2304563134&4294967295,N=V+(j<<22&4294967295|j>>>10),j=C+(U^N&(V^U))+O[12]+1804603682&4294967295,C=N+(j<<7&4294967295|j>>>25),j=U+(V^C&(N^V))+O[13]+4254626195&4294967295,U=C+(j<<12&4294967295|j>>>20),j=V+(N^U&(C^N))+O[14]+2792965006&4294967295,V=U+(j<<17&4294967295|j>>>15),j=N+(C^V&(U^C))+O[15]+1236535329&4294967295,N=V+(j<<22&4294967295|j>>>10),j=C+(V^U&(N^V))+O[1]+4129170786&4294967295,C=N+(j<<5&4294967295|j>>>27),j=U+(N^V&(C^N))+O[6]+3225465664&4294967295,U=C+(j<<9&4294967295|j>>>23),j=V+(C^N&(U^C))+O[11]+643717713&4294967295,V=U+(j<<14&4294967295|j>>>18),j=N+(U^C&(V^U))+O[0]+3921069994&4294967295,N=V+(j<<20&4294967295|j>>>12),j=C+(V^U&(N^V))+O[5]+3593408605&4294967295,C=N+(j<<5&4294967295|j>>>27),j=U+(N^V&(C^N))+O[10]+38016083&4294967295,U=C+(j<<9&4294967295|j>>>23),j=V+(C^N&(U^C))+O[15]+3634488961&4294967295,V=U+(j<<14&4294967295|j>>>18),j=N+(U^C&(V^U))+O[4]+3889429448&4294967295,N=V+(j<<20&4294967295|j>>>12),j=C+(V^U&(N^V))+O[9]+568446438&4294967295,C=N+(j<<5&4294967295|j>>>27),j=U+(N^V&(C^N))+O[14]+3275163606&4294967295,U=C+(j<<9&4294967295|j>>>23),j=V+(C^N&(U^C))+O[3]+4107603335&4294967295,V=U+(j<<14&4294967295|j>>>18),j=N+(U^C&(V^U))+O[8]+1163531501&4294967295,N=V+(j<<20&4294967295|j>>>12),j=C+(V^U&(N^V))+O[13]+2850285829&4294967295,C=N+(j<<5&4294967295|j>>>27),j=U+(N^V&(C^N))+O[2]+4243563512&4294967295,U=C+(j<<9&4294967295|j>>>23),j=V+(C^N&(U^C))+O[7]+1735328473&4294967295,V=U+(j<<14&4294967295|j>>>18),j=N+(U^C&(V^U))+O[12]+2368359562&4294967295,N=V+(j<<20&4294967295|j>>>12),j=C+(N^V^U)+O[5]+4294588738&4294967295,C=N+(j<<4&4294967295|j>>>28),j=U+(C^N^V)+O[8]+2272392833&4294967295,U=C+(j<<11&4294967295|j>>>21),j=V+(U^C^N)+O[11]+1839030562&4294967295,V=U+(j<<16&4294967295|j>>>16),j=N+(V^U^C)+O[14]+4259657740&4294967295,N=V+(j<<23&4294967295|j>>>9),j=C+(N^V^U)+O[1]+2763975236&4294967295,C=N+(j<<4&4294967295|j>>>28),j=U+(C^N^V)+O[4]+1272893353&4294967295,U=C+(j<<11&4294967295|j>>>21),j=V+(U^C^N)+O[7]+4139469664&4294967295,V=U+(j<<16&4294967295|j>>>16),j=N+(V^U^C)+O[10]+3200236656&4294967295,N=V+(j<<23&4294967295|j>>>9),j=C+(N^V^U)+O[13]+681279174&4294967295,C=N+(j<<4&4294967295|j>>>28),j=U+(C^N^V)+O[0]+3936430074&4294967295,U=C+(j<<11&4294967295|j>>>21),j=V+(U^C^N)+O[3]+3572445317&4294967295,V=U+(j<<16&4294967295|j>>>16),j=N+(V^U^C)+O[6]+76029189&4294967295,N=V+(j<<23&4294967295|j>>>9),j=C+(N^V^U)+O[9]+3654602809&4294967295,C=N+(j<<4&4294967295|j>>>28),j=U+(C^N^V)+O[12]+3873151461&4294967295,U=C+(j<<11&4294967295|j>>>21),j=V+(U^C^N)+O[15]+530742520&4294967295,V=U+(j<<16&4294967295|j>>>16),j=N+(V^U^C)+O[2]+3299628645&4294967295,N=V+(j<<23&4294967295|j>>>9),j=C+(V^(N|~U))+O[0]+4096336452&4294967295,C=N+(j<<6&4294967295|j>>>26),j=U+(N^(C|~V))+O[7]+1126891415&4294967295,U=C+(j<<10&4294967295|j>>>22),j=V+(C^(U|~N))+O[14]+2878612391&4294967295,V=U+(j<<15&4294967295|j>>>17),j=N+(U^(V|~C))+O[5]+4237533241&4294967295,N=V+(j<<21&4294967295|j>>>11),j=C+(V^(N|~U))+O[12]+1700485571&4294967295,C=N+(j<<6&4294967295|j>>>26),j=U+(N^(C|~V))+O[3]+2399980690&4294967295,U=C+(j<<10&4294967295|j>>>22),j=V+(C^(U|~N))+O[10]+4293915773&4294967295,V=U+(j<<15&4294967295|j>>>17),j=N+(U^(V|~C))+O[1]+2240044497&4294967295,N=V+(j<<21&4294967295|j>>>11),j=C+(V^(N|~U))+O[8]+1873313359&4294967295,C=N+(j<<6&4294967295|j>>>26),j=U+(N^(C|~V))+O[15]+4264355552&4294967295,U=C+(j<<10&4294967295|j>>>22),j=V+(C^(U|~N))+O[6]+2734768916&4294967295,V=U+(j<<15&4294967295|j>>>17),j=N+(U^(V|~C))+O[13]+1309151649&4294967295,N=V+(j<<21&4294967295|j>>>11),j=C+(V^(N|~U))+O[4]+4149444226&4294967295,C=N+(j<<6&4294967295|j>>>26),j=U+(N^(C|~V))+O[11]+3174756917&4294967295,U=C+(j<<10&4294967295|j>>>22),j=V+(C^(U|~N))+O[2]+718787259&4294967295,V=U+(j<<15&4294967295|j>>>17),j=N+(U^(V|~C))+O[9]+3951481745&4294967295,I.g[0]=I.g[0]+C&4294967295,I.g[1]=I.g[1]+(V+(j<<21&4294967295|j>>>11))&4294967295,I.g[2]=I.g[2]+V&4294967295,I.g[3]=I.g[3]+U&4294967295}i.prototype.v=function(I,C){C===void 0&&(C=I.length);const N=C-this.blockSize,O=this.C;let V=this.h,U=0;for(;U<C;){if(V==0)for(;U<=N;)r(this,I,U),U+=this.blockSize;if(typeof I=="string"){for(;U<C;)if(O[V++]=I.charCodeAt(U++),V==this.blockSize){r(this,O),V=0;break}}else for(;U<C;)if(O[V++]=I[U++],V==this.blockSize){r(this,O),V=0;break}}this.h=V,this.o+=C},i.prototype.A=function(){var I=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);I[0]=128;for(var C=1;C<I.length-8;++C)I[C]=0;C=this.o*8;for(var N=I.length-8;N<I.length;++N)I[N]=C&255,C/=256;for(this.v(I),I=Array(16),C=0,N=0;N<4;++N)for(let O=0;O<32;O+=8)I[C++]=this.g[N]>>>O&255;return I};function s(I,C){var N=o;return Object.prototype.hasOwnProperty.call(N,I)?N[I]:N[I]=C(I)}function a(I,C){this.h=C;const N=[];let O=!0;for(let V=I.length-1;V>=0;V--){const U=I[V]|0;O&&U==C||(N[V]=U,O=!1)}this.g=N}var o={};function l(I){return-128<=I&&I<128?s(I,function(C){return new a([C|0],C<0?-1:0)}):new a([I|0],I<0?-1:0)}function u(I){if(isNaN(I)||!isFinite(I))return h;if(I<0)return x(u(-I));const C=[];let N=1;for(let O=0;I>=N;O++)C[O]=I/N|0,N*=4294967296;return new a(C,0)}function c(I,C){if(I.length==0)throw Error("number format error: empty string");if(C=C||10,C<2||36<C)throw Error("radix out of range: "+C);if(I.charAt(0)=="-")return x(c(I.substring(1),C));if(I.indexOf("-")>=0)throw Error('number format error: interior "-" character');const N=u(Math.pow(C,8));let O=h;for(let U=0;U<I.length;U+=8){var V=Math.min(8,I.length-U);const j=parseInt(I.substring(U,U+V),C);V<8?(V=u(Math.pow(C,V)),O=O.j(V).add(u(j))):(O=O.j(N),O=O.add(u(j)))}return O}var h=l(0),f=l(1),m=l(16777216);n=a.prototype,n.m=function(){if(_(this))return-x(this).m();let I=0,C=1;for(let N=0;N<this.g.length;N++){const O=this.i(N);I+=(O>=0?O:4294967296+O)*C,C*=4294967296}return I},n.toString=function(I){if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(y(this))return"0";if(_(this))return"-"+x(this).toString(I);const C=u(Math.pow(I,6));var N=this;let O="";for(;;){const V=k(N,C).g;N=v(N,V.j(C));let U=((N.g.length>0?N.g[0]:N.h)>>>0).toString(I);if(N=V,y(N))return U+O;for(;U.length<6;)U="0"+U;O=U+O}},n.i=function(I){return I<0?0:I<this.g.length?this.g[I]:this.h};function y(I){if(I.h!=0)return!1;for(let C=0;C<I.g.length;C++)if(I.g[C]!=0)return!1;return!0}function _(I){return I.h==-1}n.l=function(I){return I=v(this,I),_(I)?-1:y(I)?0:1};function x(I){const C=I.g.length,N=[];for(let O=0;O<C;O++)N[O]=~I.g[O];return new a(N,~I.h).add(f)}n.abs=function(){return _(this)?x(this):this},n.add=function(I){const C=Math.max(this.g.length,I.g.length),N=[];let O=0;for(let V=0;V<=C;V++){let U=O+(this.i(V)&65535)+(I.i(V)&65535),j=(U>>>16)+(this.i(V)>>>16)+(I.i(V)>>>16);O=j>>>16,U&=65535,j&=65535,N[V]=j<<16|U}return new a(N,N[N.length-1]&-2147483648?-1:0)};function v(I,C){return I.add(x(C))}n.j=function(I){if(y(this)||y(I))return h;if(_(this))return _(I)?x(this).j(x(I)):x(x(this).j(I));if(_(I))return x(this.j(x(I)));if(this.l(m)<0&&I.l(m)<0)return u(this.m()*I.m());const C=this.g.length+I.g.length,N=[];for(var O=0;O<2*C;O++)N[O]=0;for(O=0;O<this.g.length;O++)for(let V=0;V<I.g.length;V++){const U=this.i(O)>>>16,j=this.i(O)&65535,he=I.i(V)>>>16,me=I.i(V)&65535;N[2*O+2*V]+=j*me,w(N,2*O+2*V),N[2*O+2*V+1]+=U*me,w(N,2*O+2*V+1),N[2*O+2*V+1]+=j*he,w(N,2*O+2*V+1),N[2*O+2*V+2]+=U*he,w(N,2*O+2*V+2)}for(I=0;I<C;I++)N[I]=N[2*I+1]<<16|N[2*I];for(I=C;I<2*C;I++)N[I]=0;return new a(N,0)};function w(I,C){for(;(I[C]&65535)!=I[C];)I[C+1]+=I[C]>>>16,I[C]&=65535,C++}function E(I,C){this.g=I,this.h=C}function k(I,C){if(y(C))throw Error("division by zero");if(y(I))return new E(h,h);if(_(I))return C=k(x(I),C),new E(x(C.g),x(C.h));if(_(C))return C=k(I,x(C)),new E(x(C.g),C.h);if(I.g.length>30){if(_(I)||_(C))throw Error("slowDivide_ only works with positive integers.");for(var N=f,O=C;O.l(I)<=0;)N=$(N),O=$(O);var V=L(N,1),U=L(O,1);for(O=L(O,2),N=L(N,2);!y(O);){var j=U.add(O);j.l(I)<=0&&(V=V.add(N),U=j),O=L(O,1),N=L(N,1)}return C=v(I,V.j(C)),new E(V,C)}for(V=h;I.l(C)>=0;){for(N=Math.max(1,Math.floor(I.m()/C.m())),O=Math.ceil(Math.log(N)/Math.LN2),O=O<=48?1:Math.pow(2,O-48),U=u(N),j=U.j(C);_(j)||j.l(I)>0;)N-=O,U=u(N),j=U.j(C);y(U)&&(U=f),V=V.add(U),I=v(I,j)}return new E(V,I)}n.B=function(I){return k(this,I).h},n.and=function(I){const C=Math.max(this.g.length,I.g.length),N=[];for(let O=0;O<C;O++)N[O]=this.i(O)&I.i(O);return new a(N,this.h&I.h)},n.or=function(I){const C=Math.max(this.g.length,I.g.length),N=[];for(let O=0;O<C;O++)N[O]=this.i(O)|I.i(O);return new a(N,this.h|I.h)},n.xor=function(I){const C=Math.max(this.g.length,I.g.length),N=[];for(let O=0;O<C;O++)N[O]=this.i(O)^I.i(O);return new a(N,this.h^I.h)};function $(I){const C=I.g.length+1,N=[];for(let O=0;O<C;O++)N[O]=I.i(O)<<1|I.i(O-1)>>>31;return new a(N,I.h)}function L(I,C){const N=C>>5;C%=32;const O=I.g.length-N,V=[];for(let U=0;U<O;U++)V[U]=C>0?I.i(U+N)>>>C|I.i(U+N+1)<<32-C:I.i(U+N);return new a(V,I.h)}i.prototype.digest=i.prototype.A,i.prototype.reset=i.prototype.u,i.prototype.update=i.prototype.v,R4=i,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=u,a.fromString=c,wu=a}).apply(typeof cR<"u"?cR:typeof self<"u"?self:typeof window<"u"?window:{});var m0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var P4,tg,N4,iw,TT,D4,M4,O4;(function(){var n,e=Object.defineProperty;function t(p){p=[typeof globalThis=="object"&&globalThis,p,typeof window=="object"&&window,typeof self=="object"&&self,typeof m0=="object"&&m0];for(var A=0;A<p.length;++A){var D=p[A];if(D&&D.Math==Math)return D}throw Error("Cannot find global object")}var i=t(this);function r(p,A){if(A)e:{var D=i;p=p.split(".");for(var B=0;B<p.length-1;B++){var ee=p[B];if(!(ee in D))break e;D=D[ee]}p=p[p.length-1],B=D[p],A=A(B),A!=B&&A!=null&&e(D,p,{configurable:!0,writable:!0,value:A})}}r("Symbol.dispose",function(p){return p||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(p){return p||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(p){return p||function(A){var D=[],B;for(B in A)Object.prototype.hasOwnProperty.call(A,B)&&D.push([B,A[B]]);return D}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var s=s||{},a=this||self;function o(p){var A=typeof p;return A=="object"&&p!=null||A=="function"}function l(p,A,D){return p.call.apply(p.bind,arguments)}function u(p,A,D){return u=l,u.apply(null,arguments)}function c(p,A){var D=Array.prototype.slice.call(arguments,1);return function(){var B=D.slice();return B.push.apply(B,arguments),p.apply(this,B)}}function h(p,A){function D(){}D.prototype=A.prototype,p.Z=A.prototype,p.prototype=new D,p.prototype.constructor=p,p.Ob=function(B,ee,re){for(var ve=Array(arguments.length-2),Qe=2;Qe<arguments.length;Qe++)ve[Qe-2]=arguments[Qe];return A.prototype[ee].apply(B,ve)}}var f=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?p=>p&&AsyncContext.Snapshot.wrap(p):p=>p;function m(p){const A=p.length;if(A>0){const D=Array(A);for(let B=0;B<A;B++)D[B]=p[B];return D}return[]}function y(p,A){for(let B=1;B<arguments.length;B++){const ee=arguments[B];var D=typeof ee;if(D=D!="object"?D:ee?Array.isArray(ee)?"array":D:"null",D=="array"||D=="object"&&typeof ee.length=="number"){D=p.length||0;const re=ee.length||0;p.length=D+re;for(let ve=0;ve<re;ve++)p[D+ve]=ee[ve]}else p.push(ee)}}class _{constructor(A,D){this.i=A,this.j=D,this.h=0,this.g=null}get(){let A;return this.h>0?(this.h--,A=this.g,this.g=A.next,A.next=null):A=this.i(),A}}function x(p){a.setTimeout(()=>{throw p},0)}function v(){var p=I;let A=null;return p.g&&(A=p.g,p.g=p.g.next,p.g||(p.h=null),A.next=null),A}class w{constructor(){this.h=this.g=null}add(A,D){const B=E.get();B.set(A,D),this.h?this.h.next=B:this.g=B,this.h=B}}var E=new _(()=>new k,p=>p.reset());class k{constructor(){this.next=this.g=this.h=null}set(A,D){this.h=A,this.g=D,this.next=null}reset(){this.next=this.g=this.h=null}}let $,L=!1,I=new w,C=()=>{const p=Promise.resolve(void 0);$=()=>{p.then(N)}};function N(){for(var p;p=v();){try{p.h.call(p.g)}catch(D){x(D)}var A=E;A.j(p),A.h<100&&(A.h++,p.next=A.g,A.g=p)}L=!1}function O(){this.u=this.u,this.C=this.C}O.prototype.u=!1,O.prototype.dispose=function(){this.u||(this.u=!0,this.N())},O.prototype[Symbol.dispose]=function(){this.dispose()},O.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function V(p,A){this.type=p,this.g=this.target=A,this.defaultPrevented=!1}V.prototype.h=function(){this.defaultPrevented=!0};var U=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var p=!1,A=Object.defineProperty({},"passive",{get:function(){p=!0}});try{const D=()=>{};a.addEventListener("test",D,A),a.removeEventListener("test",D,A)}catch{}return p}();function j(p){return/^[\s\xa0]*$/.test(p)}function he(p,A){V.call(this,p?p.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,p&&this.init(p,A)}h(he,V),he.prototype.init=function(p,A){const D=this.type=p.type,B=p.changedTouches&&p.changedTouches.length?p.changedTouches[0]:null;this.target=p.target||p.srcElement,this.g=A,A=p.relatedTarget,A||(D=="mouseover"?A=p.fromElement:D=="mouseout"&&(A=p.toElement)),this.relatedTarget=A,B?(this.clientX=B.clientX!==void 0?B.clientX:B.pageX,this.clientY=B.clientY!==void 0?B.clientY:B.pageY,this.screenX=B.screenX||0,this.screenY=B.screenY||0):(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0),this.button=p.button,this.key=p.key||"",this.ctrlKey=p.ctrlKey,this.altKey=p.altKey,this.shiftKey=p.shiftKey,this.metaKey=p.metaKey,this.pointerId=p.pointerId||0,this.pointerType=p.pointerType,this.state=p.state,this.i=p,p.defaultPrevented&&he.Z.h.call(this)},he.prototype.h=function(){he.Z.h.call(this);const p=this.i;p.preventDefault?p.preventDefault():p.returnValue=!1};var me="closure_listenable_"+(Math.random()*1e6|0),te=0;function oe(p,A,D,B,ee){this.listener=p,this.proxy=null,this.src=A,this.type=D,this.capture=!!B,this.ha=ee,this.key=++te,this.da=this.fa=!1}function G(p){p.da=!0,p.listener=null,p.proxy=null,p.src=null,p.ha=null}function W(p,A,D){for(const B in p)A.call(D,p[B],B,p)}function K(p,A){for(const D in p)A.call(void 0,p[D],D,p)}function H(p){const A={};for(const D in p)A[D]=p[D];return A}const Q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Y(p,A){let D,B;for(let ee=1;ee<arguments.length;ee++){B=arguments[ee];for(D in B)p[D]=B[D];for(let re=0;re<Q.length;re++)D=Q[re],Object.prototype.hasOwnProperty.call(B,D)&&(p[D]=B[D])}}function Z(p){this.src=p,this.g={},this.h=0}Z.prototype.add=function(p,A,D,B,ee){const re=p.toString();p=this.g[re],p||(p=this.g[re]=[],this.h++);const ve=_e(p,A,B,ee);return ve>-1?(A=p[ve],D||(A.fa=!1)):(A=new oe(A,this.src,re,!!B,ee),A.fa=D,p.push(A)),A};function fe(p,A){const D=A.type;if(D in p.g){var B=p.g[D],ee=Array.prototype.indexOf.call(B,A,void 0),re;(re=ee>=0)&&Array.prototype.splice.call(B,ee,1),re&&(G(A),p.g[D].length==0&&(delete p.g[D],p.h--))}}function _e(p,A,D,B){for(let ee=0;ee<p.length;++ee){const re=p[ee];if(!re.da&&re.listener==A&&re.capture==!!D&&re.ha==B)return ee}return-1}var X="closure_lm_"+(Math.random()*1e6|0),de={};function Ee(p,A,D,B,ee){if(Array.isArray(A)){for(let re=0;re<A.length;re++)Ee(p,A[re],D,B,ee);return null}return D=or(D),p&&p[me]?p.J(A,D,o(B)?!!B.capture:!1,ee):$e(p,A,D,!1,B,ee)}function $e(p,A,D,B,ee,re){if(!A)throw Error("Invalid event type");const ve=o(ee)?!!ee.capture:!!ee;let Qe=Yn(p);if(Qe||(p[X]=Qe=new Z(p)),D=Qe.add(A,D,B,ve,re),D.proxy)return D;if(B=je(),D.proxy=B,B.src=p,B.listener=D,p.addEventListener)U||(ee=ve),ee===void 0&&(ee=!1),p.addEventListener(A.toString(),B,ee);else if(p.attachEvent)p.attachEvent(Et(A.toString()),B);else if(p.addListener&&p.removeListener)p.addListener(B);else throw Error("addEventListener and attachEvent are unavailable.");return D}function je(){function p(D){return A.call(p.src,p.listener,D)}const A=Xt;return p}function He(p,A,D,B,ee){if(Array.isArray(A))for(var re=0;re<A.length;re++)He(p,A[re],D,B,ee);else B=o(B)?!!B.capture:!!B,D=or(D),p&&p[me]?(p=p.i,re=String(A).toString(),re in p.g&&(A=p.g[re],D=_e(A,D,B,ee),D>-1&&(G(A[D]),Array.prototype.splice.call(A,D,1),A.length==0&&(delete p.g[re],p.h--)))):p&&(p=Yn(p))&&(A=p.g[A.toString()],p=-1,A&&(p=_e(A,D,B,ee)),(D=p>-1?A[p]:null)&&nt(D))}function nt(p){if(typeof p!="number"&&p&&!p.da){var A=p.src;if(A&&A[me])fe(A.i,p);else{var D=p.type,B=p.proxy;A.removeEventListener?A.removeEventListener(D,B,p.capture):A.detachEvent?A.detachEvent(Et(D),B):A.addListener&&A.removeListener&&A.removeListener(B),(D=Yn(A))?(fe(D,p),D.h==0&&(D.src=null,A[X]=null)):G(p)}}}function Et(p){return p in de?de[p]:de[p]="on"+p}function Xt(p,A){if(p.da)p=!0;else{A=new he(A,this);const D=p.listener,B=p.ha||p.src;p.fa&&nt(p),p=D.call(B,A)}return p}function Yn(p){return p=p[X],p instanceof Z?p:null}var ls="__closure_events_fn_"+(Math.random()*1e9>>>0);function or(p){return typeof p=="function"?p:(p[ls]||(p[ls]=function(A){return p.handleEvent(A)}),p[ls])}function Mt(){O.call(this),this.i=new Z(this),this.M=this,this.G=null}h(Mt,O),Mt.prototype[me]=!0,Mt.prototype.removeEventListener=function(p,A,D,B){He(this,p,A,D,B)};function Rt(p,A){var D,B=p.G;if(B)for(D=[];B;B=B.G)D.push(B);if(p=p.M,B=A.type||A,typeof A=="string")A=new V(A,p);else if(A instanceof V)A.target=A.target||p;else{var ee=A;A=new V(B,p),Y(A,ee)}ee=!0;let re,ve;if(D)for(ve=D.length-1;ve>=0;ve--)re=A.g=D[ve],ee=Ga(re,B,!0,A)&&ee;if(re=A.g=p,ee=Ga(re,B,!0,A)&&ee,ee=Ga(re,B,!1,A)&&ee,D)for(ve=0;ve<D.length;ve++)re=A.g=D[ve],ee=Ga(re,B,!1,A)&&ee}Mt.prototype.N=function(){if(Mt.Z.N.call(this),this.i){var p=this.i;for(const A in p.g){const D=p.g[A];for(let B=0;B<D.length;B++)G(D[B]);delete p.g[A],p.h--}}this.G=null},Mt.prototype.J=function(p,A,D,B){return this.i.add(String(p),A,!1,D,B)},Mt.prototype.K=function(p,A,D,B){return this.i.add(String(p),A,!0,D,B)};function Ga(p,A,D,B){if(A=p.i.g[String(A)],!A)return!0;A=A.concat();let ee=!0;for(let re=0;re<A.length;++re){const ve=A[re];if(ve&&!ve.da&&ve.capture==D){const Qe=ve.listener,un=ve.ha||ve.src;ve.fa&&fe(p.i,ve),ee=Qe.call(un,B)!==!1&&ee}}return ee&&!B.defaultPrevented}function Ka(p,A){if(typeof p!="function")if(p&&typeof p.handleEvent=="function")p=u(p.handleEvent,p);else throw Error("Invalid listener argument");return Number(A)>2147483647?-1:a.setTimeout(p,A||0)}function al(p){p.g=Ka(()=>{p.g=null,p.i&&(p.i=!1,al(p))},p.l);const A=p.h;p.h=null,p.m.apply(null,A)}class lr extends O{constructor(A,D){super(),this.m=A,this.l=D,this.h=null,this.i=!1,this.g=null}j(A){this.h=arguments,this.g?this.i=!0:al(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function it(p){O.call(this),this.h=p,this.g={}}h(it,O);var ol=[];function qu(p){W(p.g,function(A,D){this.g.hasOwnProperty(D)&&nt(A)},p),p.g={}}it.prototype.N=function(){it.Z.N.call(this),qu(this)},it.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ji=a.JSON.stringify,ea=a.JSON.parse,Gu=class{stringify(p){return a.JSON.stringify(p,void 0)}parse(p){return a.JSON.parse(p,void 0)}};function em(){}function ta(){}var ll={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function mh(){V.call(this,"d")}h(mh,V);function gh(){V.call(this,"c")}h(gh,V);var na={},gv=null;function yh(){return gv=gv||new Mt}na.Ia="serverreachability";function yv(p){V.call(this,na.Ia,p)}h(yv,V);function Ku(p){const A=yh();Rt(A,new yv(A))}na.STAT_EVENT="statevent";function tm(p,A){V.call(this,na.STAT_EVENT,p),this.stat=A}h(tm,V);function Dn(p){const A=yh();Rt(A,new tm(A,p))}na.Ja="timingevent";function nm(p,A){V.call(this,na.Ja,p),this.size=A}h(nm,V);function ul(p,A){if(typeof p!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){p()},A)}function Pt(){this.g=!0}Pt.prototype.ua=function(){this.g=!1};function _v(p,A,D,B,ee,re){p.info(function(){if(p.g)if(re){var ve="",Qe=re.split("&");for(let At=0;At<Qe.length;At++){var un=Qe[At].split("=");if(un.length>1){const mn=un[0];un=un[1];const jr=mn.split("_");ve=jr.length>=2&&jr[1]=="type"?ve+(mn+"="+un+"&"):ve+(mn+"=redacted&")}}}else ve=null;else ve=re;return"XMLHTTP REQ ("+B+") [attempt "+ee+"]: "+A+`
`+D+`
`+ve})}function vv(p,A,D,B,ee,re,ve){p.info(function(){return"XMLHTTP RESP ("+B+") [ attempt "+ee+"]: "+A+`
`+D+`
`+re+" "+ve})}function Ya(p,A,D,B){p.info(function(){return"XMLHTTP TEXT ("+A+"): "+bv(p,D)+(B?" "+B:"")})}function wv(p,A){p.info(function(){return"TIMEOUT: "+A})}Pt.prototype.info=function(){};function bv(p,A){if(!p.g)return A;if(!A)return null;try{const re=JSON.parse(A);if(re){for(p=0;p<re.length;p++)if(Array.isArray(re[p])){var D=re[p];if(!(D.length<2)){var B=D[1];if(Array.isArray(B)&&!(B.length<1)){var ee=B[0];if(ee!="noop"&&ee!="stop"&&ee!="close")for(let ve=1;ve<B.length;ve++)B[ve]=""}}}}return ji(re)}catch{return A}}var Yu={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},im={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},rm;function _h(){}h(_h,em),_h.prototype.g=function(){return new XMLHttpRequest},rm=new _h;function cl(p){return encodeURIComponent(String(p))}function xv(p){var A=1;p=p.split(":");const D=[];for(;A>0&&p.length;)D.push(p.shift()),A--;return p.length&&D.push(p.join(":")),D}function us(p,A,D,B){this.j=p,this.i=A,this.l=D,this.S=B||1,this.V=new it(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new sm}function sm(){this.i=null,this.g="",this.h=!1}var am={},om={};function Bi(p,A,D){p.M=1,p.A=bh(Ui(A)),p.u=D,p.R=!0,vh(p,null)}function vh(p,A){p.F=Date.now(),Xu(p),p.B=Ui(p.A);var D=p.B,B=p.S;Array.isArray(B)||(B=[String(B)]),$v(D.i,"t",B),p.C=0,D=p.j.L,p.h=new sm,p.g=wm(p.j,D?A:null,!p.u),p.P>0&&(p.O=new lr(u(p.Y,p,p.g),p.P)),A=p.V,D=p.g,B=p.ba;var ee="readystatechange";Array.isArray(ee)||(ee&&(ol[0]=ee.toString()),ee=ol);for(let re=0;re<ee.length;re++){const ve=Ee(D,ee[re],B||A.handleEvent,!1,A.h||A);if(!ve)break;A.g[ve.key]=ve}A=p.J?H(p.J):{},p.u?(p.v||(p.v="POST"),A["Content-Type"]="application/x-www-form-urlencoded",p.g.ea(p.B,p.v,p.u,A)):(p.v="GET",p.g.ea(p.B,p.v,null,A)),Ku(),_v(p.i,p.v,p.B,p.l,p.S,p.u)}us.prototype.ba=function(p){p=p.target;const A=this.O;A&&sa(p)==3?A.j():this.Y(p)},us.prototype.Y=function(p){try{if(p==this.g)e:{const Qe=sa(this.g),un=this.g.ya(),At=this.g.ca();if(!(Qe<3)&&(Qe!=3||this.g&&(this.h.h||this.g.la()||Lv(this.g)))){this.K||Qe!=4||un==7||(un==8||At<=0?Ku(3):Ku(2)),Vr(this);var A=this.g.ca();this.X=A;var D=lm(this);if(this.o=A==200,vv(this.i,this.v,this.B,this.l,this.S,Qe,A),this.o){if(this.U&&!this.L){t:{if(this.g){var B,ee=this.g;if((B=ee.g?ee.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(B)){var re=B;break t}}re=null}if(p=re)Ya(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ur(this,p);else{this.o=!1,this.m=3,Dn(12),ds(this),Qu(this);break e}}if(this.R){p=!0;let mn;for(;!this.K&&this.C<D.length;)if(mn=cs(this,D),mn==om){Qe==4&&(this.m=4,Dn(14),p=!1),Ya(this.i,this.l,null,"[Incomplete Response]");break}else if(mn==am){this.m=4,Dn(15),Ya(this.i,this.l,D,"[Invalid Chunk]"),p=!1;break}else Ya(this.i,this.l,mn,null),ur(this,mn);if(Xa(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Qe!=4||D.length!=0||this.h.h||(this.m=1,Dn(16),p=!1),this.o=this.o&&p,!p)Ya(this.i,this.l,D,"[Invalid Chunked Response]"),ds(this),Qu(this);else if(D.length>0&&!this.W){this.W=!0;var ve=this.j;ve.g==this&&ve.aa&&!ve.P&&(ve.j.info("Great, no buffering proxy detected. Bytes received: "+D.length),ym(ve),ve.P=!0,Dn(11))}}else Ya(this.i,this.l,D,null),ur(this,D);Qe==4&&ds(this),this.o&&!this.K&&(Qe==4?_m(this.j,this):(this.o=!1,Xu(this)))}else Fv(this.g),A==400&&D.indexOf("Unknown SID")>0?(this.m=3,Dn(12)):(this.m=0,Dn(13)),ds(this),Qu(this)}}}catch{}finally{}};function lm(p){if(!Xa(p))return p.g.la();const A=Lv(p.g);if(A==="")return"";let D="";const B=A.length,ee=sa(p.g)==4;if(!p.h.i){if(typeof TextDecoder>"u")return ds(p),Qu(p),"";p.h.i=new a.TextDecoder}for(let re=0;re<B;re++)p.h.h=!0,D+=p.h.i.decode(A[re],{stream:!(ee&&re==B-1)});return A.length=0,p.h.g+=D,p.C=0,p.h.g}function Xa(p){return p.g?p.v=="GET"&&p.M!=2&&p.j.Aa:!1}function cs(p,A){var D=p.C,B=A.indexOf(`
`,D);return B==-1?om:(D=Number(A.substring(D,B)),isNaN(D)?am:(B+=1,B+D>A.length?om:(A=A.slice(B,B+D),p.C=B+D,A)))}us.prototype.cancel=function(){this.K=!0,ds(this)};function Xu(p){p.T=Date.now()+p.H,Ev(p,p.H)}function Ev(p,A){if(p.D!=null)throw Error("WatchDog timer not null");p.D=ul(u(p.aa,p),A)}function Vr(p){p.D&&(a.clearTimeout(p.D),p.D=null)}us.prototype.aa=function(){this.D=null;const p=Date.now();p-this.T>=0?(wv(this.i,this.B),this.M!=2&&(Ku(),Dn(17)),ds(this),this.m=2,Qu(this)):Ev(this,this.T-p)};function Qu(p){p.j.I==0||p.K||_m(p.j,p)}function ds(p){Vr(p);var A=p.O;A&&typeof A.dispose=="function"&&A.dispose(),p.O=null,qu(p.V),p.g&&(A=p.g,p.g=null,A.abort(),A.dispose())}function ur(p,A){try{var D=p.j;if(D.I!=0&&(D.g==p||cm(D.h,p))){if(!p.L&&cm(D.h,p)&&D.I==3){try{var B=D.Ba.g.parse(A)}catch{B=null}if(Array.isArray(B)&&B.length==3){var ee=B;if(ee[0]==0){e:if(!D.v){if(D.g)if(D.g.F+3e3<p.F)Th(D),Eh(D);else break e;gm(D),Dn(18)}}else D.xa=ee[1],0<D.xa-D.K&&ee[2]<37500&&D.F&&D.A==0&&!D.C&&(D.C=ul(u(D.Va,D),6e3));wh(D.h)<=1&&D.ta&&(D.ta=void 0)}else aa(D,11)}else if((p.L||D.g==p)&&Th(D),!j(A))for(ee=D.Ba.g.parse(A),A=0;A<ee.length;A++){let At=ee[A];const mn=At[0];if(!(mn<=D.K))if(D.K=mn,At=At[1],D.I==2)if(At[0]=="c"){D.M=At[1],D.ba=At[2];const jr=At[3];jr!=null&&(D.ka=jr,D.j.info("VER="+D.ka));const Br=At[4];Br!=null&&(D.za=Br,D.j.info("SVER="+D.za));const Wi=At[5];Wi!=null&&typeof Wi=="number"&&Wi>0&&(B=1.5*Wi,D.O=B,D.j.info("backChannelRequestTimeoutMs_="+B)),B=D;const fs=p.g;if(fs){const Sh=fs.g?fs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Sh){var re=B.h;re.g||Sh.indexOf("spdy")==-1&&Sh.indexOf("quic")==-1&&Sh.indexOf("h2")==-1||(re.j=re.l,re.g=new Set,re.h&&(dm(re,re.h),re.h=null))}if(B.G){const Em=fs.g?fs.g.getResponseHeader("X-HTTP-Session-Id"):null;Em&&(B.wa=Em,Nt(B.J,B.G,Em))}}D.I=3,D.l&&D.l.ra(),D.aa&&(D.T=Date.now()-p.F,D.j.info("Handshake RTT: "+D.T+"ms")),B=D;var ve=p;if(B.na=qv(B,B.L?B.ba:null,B.W),ve.L){Av(B.h,ve);var Qe=ve,un=B.O;un&&(Qe.H=un),Qe.D&&(Vr(Qe),Xu(Qe)),B.g=ve}else Uv(B);D.i.length>0&&Ah(D)}else At[0]!="stop"&&At[0]!="close"||aa(D,7);else D.I==3&&(At[0]=="stop"||At[0]=="close"?At[0]=="stop"?aa(D,7):mm(D):At[0]!="noop"&&D.l&&D.l.qa(At),D.A=0)}}Ku(4)}catch{}}var um=class{constructor(p,A){this.g=p,this.map=A}};function Mn(p){this.l=p||10,a.PerformanceNavigationTiming?(p=a.performance.getEntriesByType("navigation"),p=p.length>0&&(p[0].nextHopProtocol=="hq"||p[0].nextHopProtocol=="h2")):p=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=p?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ti(p){return p.h?!0:p.g?p.g.size>=p.j:!1}function wh(p){return p.h?1:p.g?p.g.size:0}function cm(p,A){return p.h?p.h==A:p.g?p.g.has(A):!1}function dm(p,A){p.g?p.g.add(A):p.h=A}function Av(p,A){p.h&&p.h==A?p.h=null:p.g&&p.g.has(A)&&p.g.delete(A)}Mn.prototype.cancel=function(){if(this.i=Tv(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const p of this.g.values())p.cancel();this.g.clear()}};function Tv(p){if(p.h!=null)return p.i.concat(p.h.G);if(p.g!=null&&p.g.size!==0){let A=p.i;for(const D of p.g.values())A=A.concat(D.G);return A}return m(p.i)}var Sv=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function dx(p,A){if(p){p=p.split("&");for(let D=0;D<p.length;D++){const B=p[D].indexOf("=");let ee,re=null;B>=0?(ee=p[D].substring(0,B),re=p[D].substring(B+1)):ee=p[D],A(ee,re?decodeURIComponent(re.replace(/\+/g," ")):"")}}}function ai(p){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let A;p instanceof ai?(this.l=p.l,Ju(this,p.j),this.o=p.o,this.g=p.g,dl(this,p.u),this.h=p.h,hm(this,Rv(p.i)),this.m=p.m):p&&(A=String(p).match(Sv))?(this.l=!1,Ju(this,A[1]||"",!0),this.o=Zu(A[2]||""),this.g=Zu(A[3]||"",!0),dl(this,A[4]),this.h=Zu(A[5]||"",!0),hm(this,A[6]||"",!0),this.m=Zu(A[7]||"")):(this.l=!1,this.i=new ia(null,this.l))}ai.prototype.toString=function(){const p=[];var A=this.j;A&&p.push(ec(A,Iv,!0),":");var D=this.g;return(D||A=="file")&&(p.push("//"),(A=this.o)&&p.push(ec(A,Iv,!0),"@"),p.push(cl(D).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),D=this.u,D!=null&&p.push(":",String(D))),(D=this.h)&&(this.g&&D.charAt(0)!="/"&&p.push("/"),p.push(ec(D,D.charAt(0)=="/"?px:fx,!0))),(D=this.i.toString())&&p.push("?",D),(D=this.m)&&p.push("#",ec(D,pm)),p.join("")},ai.prototype.resolve=function(p){const A=Ui(this);let D=!!p.j;D?Ju(A,p.j):D=!!p.o,D?A.o=p.o:D=!!p.g,D?A.g=p.g:D=p.u!=null;var B=p.h;if(D)dl(A,p.u);else if(D=!!p.h){if(B.charAt(0)!="/")if(this.g&&!this.h)B="/"+B;else{var ee=A.h.lastIndexOf("/");ee!=-1&&(B=A.h.slice(0,ee+1)+B)}if(ee=B,ee==".."||ee==".")B="";else if(ee.indexOf("./")!=-1||ee.indexOf("/.")!=-1){B=ee.lastIndexOf("/",0)==0,ee=ee.split("/");const re=[];for(let ve=0;ve<ee.length;){const Qe=ee[ve++];Qe=="."?B&&ve==ee.length&&re.push(""):Qe==".."?((re.length>1||re.length==1&&re[0]!="")&&re.pop(),B&&ve==ee.length&&re.push("")):(re.push(Qe),B=!0)}B=re.join("/")}else B=ee}return D?A.h=B:D=p.i.toString()!=="",D?hm(A,Rv(p.i)):D=!!p.m,D&&(A.m=p.m),A};function Ui(p){return new ai(p)}function Ju(p,A,D){p.j=D?Zu(A,!0):A,p.j&&(p.j=p.j.replace(/:$/,""))}function dl(p,A){if(A){if(A=Number(A),isNaN(A)||A<0)throw Error("Bad port number "+A);p.u=A}else p.u=null}function hm(p,A,D){A instanceof ia?(p.i=A,Pv(p.i,p.l)):(D||(A=ec(A,fm)),p.i=new ia(A,p.l))}function Nt(p,A,D){p.i.set(A,D)}function bh(p){return Nt(p,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),p}function Zu(p,A){return p?A?decodeURI(p.replace(/%25/g,"%2525")):decodeURIComponent(p):""}function ec(p,A,D){return typeof p=="string"?(p=encodeURI(p).replace(A,hx),D&&(p=p.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p):null}function hx(p){return p=p.charCodeAt(0),"%"+(p>>4&15).toString(16)+(p&15).toString(16)}var Iv=/[#\/\?@]/g,fx=/[#\?:]/g,px=/[#\?]/g,fm=/[#\?@]/g,pm=/#/g;function ia(p,A){this.h=this.g=null,this.i=p||null,this.j=!!A}function Qa(p){p.g||(p.g=new Map,p.h=0,p.i&&dx(p.i,function(A,D){p.add(decodeURIComponent(A.replace(/\+/g," ")),D)}))}n=ia.prototype,n.add=function(p,A){Qa(this),this.i=null,p=hs(this,p);let D=this.g.get(p);return D||this.g.set(p,D=[]),D.push(A),this.h+=1,this};function xh(p,A){Qa(p),A=hs(p,A),p.g.has(A)&&(p.i=null,p.h-=p.g.get(A).length,p.g.delete(A))}function Cv(p,A){return Qa(p),A=hs(p,A),p.g.has(A)}n.forEach=function(p,A){Qa(this),this.g.forEach(function(D,B){D.forEach(function(ee){p.call(A,ee,B,this)},this)},this)};function kv(p,A){Qa(p);let D=[];if(typeof A=="string")Cv(p,A)&&(D=D.concat(p.g.get(hs(p,A))));else for(p=Array.from(p.g.values()),A=0;A<p.length;A++)D=D.concat(p[A]);return D}n.set=function(p,A){return Qa(this),this.i=null,p=hs(this,p),Cv(this,p)&&(this.h-=this.g.get(p).length),this.g.set(p,[A]),this.h+=1,this},n.get=function(p,A){return p?(p=kv(this,p),p.length>0?String(p[0]):A):A};function $v(p,A,D){xh(p,A),D.length>0&&(p.i=null,p.g.set(hs(p,A),m(D)),p.h+=D.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const p=[],A=Array.from(this.g.keys());for(let B=0;B<A.length;B++){var D=A[B];const ee=cl(D);D=kv(this,D);for(let re=0;re<D.length;re++){let ve=ee;D[re]!==""&&(ve+="="+cl(D[re])),p.push(ve)}}return this.i=p.join("&")};function Rv(p){const A=new ia;return A.i=p.i,p.g&&(A.g=new Map(p.g),A.h=p.h),A}function hs(p,A){return A=String(A),p.j&&(A=A.toLowerCase()),A}function Pv(p,A){A&&!p.j&&(Qa(p),p.i=null,p.g.forEach(function(D,B){const ee=B.toLowerCase();B!=ee&&(xh(this,B),$v(this,ee,D))},p)),p.j=A}function mx(p,A){const D=new Pt;if(a.Image){const B=new Image;B.onload=c(cr,D,"TestLoadImage: loaded",!0,A,B),B.onerror=c(cr,D,"TestLoadImage: error",!1,A,B),B.onabort=c(cr,D,"TestLoadImage: abort",!1,A,B),B.ontimeout=c(cr,D,"TestLoadImage: timeout",!1,A,B),a.setTimeout(function(){B.ontimeout&&B.ontimeout()},1e4),B.src=p}else A(!1)}function gx(p,A){const D=new Pt,B=new AbortController,ee=setTimeout(()=>{B.abort(),cr(D,"TestPingServer: timeout",!1,A)},1e4);fetch(p,{signal:B.signal}).then(re=>{clearTimeout(ee),re.ok?cr(D,"TestPingServer: ok",!0,A):cr(D,"TestPingServer: server error",!1,A)}).catch(()=>{clearTimeout(ee),cr(D,"TestPingServer: error",!1,A)})}function cr(p,A,D,B,ee){try{ee&&(ee.onload=null,ee.onerror=null,ee.onabort=null,ee.ontimeout=null),B(D)}catch{}}function ra(){this.g=new Gu}function Hi(p){this.i=p.Sb||null,this.h=p.ab||!1}h(Hi,em),Hi.prototype.g=function(){return new tc(this.i,this.h)};function tc(p,A){Mt.call(this),this.H=p,this.o=A,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}h(tc,Mt),n=tc.prototype,n.open=function(p,A){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=p,this.D=A,this.readyState=1,fl(this)},n.send=function(p){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const A={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};p&&(A.body=p),(this.H||a).fetch(new Request(this.D,A)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,hl(this)),this.readyState=0},n.Pa=function(p){if(this.g&&(this.l=p,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=p.headers,this.readyState=2,fl(this)),this.g&&(this.readyState=3,fl(this),this.g)))if(this.responseType==="arraybuffer")p.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in p){if(this.j=p.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;nc(this)}else p.text().then(this.Oa.bind(this),this.ga.bind(this))};function nc(p){p.j.read().then(p.Ma.bind(p)).catch(p.ga.bind(p))}n.Ma=function(p){if(this.g){if(this.o&&p.value)this.response.push(p.value);else if(!this.o){var A=p.value?p.value:new Uint8Array(0);(A=this.B.decode(A,{stream:!p.done}))&&(this.response=this.responseText+=A)}p.done?hl(this):fl(this),this.readyState==3&&nc(this)}},n.Oa=function(p){this.g&&(this.response=this.responseText=p,hl(this))},n.Na=function(p){this.g&&(this.response=p,hl(this))},n.ga=function(){this.g&&hl(this)};function hl(p){p.readyState=4,p.l=null,p.j=null,p.B=null,fl(p)}n.setRequestHeader=function(p,A){this.A.append(p,A)},n.getResponseHeader=function(p){return this.h&&this.h.get(p.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const p=[],A=this.h.entries();for(var D=A.next();!D.done;)D=D.value,p.push(D[0]+": "+D[1]),D=A.next();return p.join(`\r
`)};function fl(p){p.onreadystatechange&&p.onreadystatechange.call(p)}Object.defineProperty(tc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(p){this.m=p?"include":"same-origin"}});function Nv(p){let A="";return W(p,function(D,B){A+=B,A+=":",A+=D,A+=`\r
`}),A}function ic(p,A,D){e:{for(B in D){var B=!1;break e}B=!0}B||(D=Nv(D),typeof p=="string"?D!=null&&cl(D):Nt(p,A,D))}function Ht(p){Mt.call(this),this.headers=new Map,this.L=p||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}h(Ht,Mt);var Dv=/^https?$/i,yx=["POST","PUT"];n=Ht.prototype,n.Fa=function(p){this.H=p},n.ea=function(p,A,D,B){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+p);A=A?A.toUpperCase():"GET",this.D=p,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():rm.g(),this.g.onreadystatechange=f(u(this.Ca,this));try{this.B=!0,this.g.open(A,String(p),!0),this.B=!1}catch(re){rc(this,re);return}if(p=D||"",D=new Map(this.headers),B)if(Object.getPrototypeOf(B)===Object.prototype)for(var ee in B)D.set(ee,B[ee]);else if(typeof B.keys=="function"&&typeof B.get=="function")for(const re of B.keys())D.set(re,B.get(re));else throw Error("Unknown input type for opt_headers: "+String(B));B=Array.from(D.keys()).find(re=>re.toLowerCase()=="content-type"),ee=a.FormData&&p instanceof a.FormData,!(Array.prototype.indexOf.call(yx,A,void 0)>=0)||B||ee||D.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[re,ve]of D)this.g.setRequestHeader(re,ve);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(p),this.v=!1}catch(re){rc(this,re)}};function rc(p,A){p.h=!1,p.g&&(p.j=!0,p.g.abort(),p.j=!1),p.l=A,p.o=5,Mv(p),Ja(p)}function Mv(p){p.A||(p.A=!0,Rt(p,"complete"),Rt(p,"error"))}n.abort=function(p){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=p||7,Rt(this,"complete"),Rt(this,"abort"),Ja(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ja(this,!0)),Ht.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Ov(this):this.Xa())},n.Xa=function(){Ov(this)};function Ov(p){if(p.h&&typeof s<"u"){if(p.v&&sa(p)==4)setTimeout(p.Ca.bind(p),0);else if(Rt(p,"readystatechange"),sa(p)==4){p.h=!1;try{const re=p.ca();e:switch(re){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var A=!0;break e;default:A=!1}var D;if(!(D=A)){var B;if(B=re===0){let ve=String(p.D).match(Sv)[1]||null;!ve&&a.self&&a.self.location&&(ve=a.self.location.protocol.slice(0,-1)),B=!Dv.test(ve?ve.toLowerCase():"")}D=B}if(D)Rt(p,"complete"),Rt(p,"success");else{p.o=6;try{var ee=sa(p)>2?p.g.statusText:""}catch{ee=""}p.l=ee+" ["+p.ca()+"]",Mv(p)}}finally{Ja(p)}}}}function Ja(p,A){if(p.g){p.m&&(clearTimeout(p.m),p.m=null);const D=p.g;p.g=null,A||Rt(p,"ready");try{D.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function sa(p){return p.g?p.g.readyState:0}n.ca=function(){try{return sa(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(p){if(this.g){var A=this.g.responseText;return p&&A.indexOf(p)==0&&(A=A.substring(p.length)),ea(A)}};function Lv(p){try{if(!p.g)return null;if("response"in p.g)return p.g.response;switch(p.F){case"":case"text":return p.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in p.g)return p.g.mozResponseArrayBuffer}return null}catch{return null}}function Fv(p){const A={};p=(p.g&&sa(p)>=2&&p.g.getAllResponseHeaders()||"").split(`\r
`);for(let B=0;B<p.length;B++){if(j(p[B]))continue;var D=xv(p[B]);const ee=D[0];if(D=D[1],typeof D!="string")continue;D=D.trim();const re=A[ee]||[];A[ee]=re,re.push(D)}K(A,function(B){return B.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function sc(p,A,D){return D&&D.internalChannelParams&&D.internalChannelParams[p]||A}function zv(p){this.za=0,this.i=[],this.j=new Pt,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=sc("failFast",!1,p),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=sc("baseRetryDelayMs",5e3,p),this.Za=sc("retryDelaySeedMs",1e4,p),this.Ta=sc("forwardChannelMaxRetries",2,p),this.va=sc("forwardChannelRequestTimeoutMs",2e4,p),this.ma=p&&p.xmlHttpFactory||void 0,this.Ua=p&&p.Rb||void 0,this.Aa=p&&p.useFetchStreams||!1,this.O=void 0,this.L=p&&p.supportsCrossDomainXhr||!1,this.M="",this.h=new Mn(p&&p.concurrentRequestLimit),this.Ba=new ra,this.S=p&&p.fastHandshake||!1,this.R=p&&p.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=p&&p.Pb||!1,p&&p.ua&&this.j.ua(),p&&p.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&p&&p.detectBufferingProxy||!1,this.ia=void 0,p&&p.longPollingTimeout&&p.longPollingTimeout>0&&(this.ia=p.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=zv.prototype,n.ka=8,n.I=1,n.connect=function(p,A,D,B){Dn(0),this.W=p,this.H=A||{},D&&B!==void 0&&(this.H.OSID=D,this.H.OAID=B),this.F=this.X,this.J=qv(this,null,this.W),Ah(this)};function mm(p){if(Vv(p),p.I==3){var A=p.V++,D=Ui(p.J);if(Nt(D,"SID",p.M),Nt(D,"RID",A),Nt(D,"TYPE","terminate"),ac(p,D),A=new us(p,p.j,A),A.M=2,A.A=bh(Ui(D)),D=!1,a.navigator&&a.navigator.sendBeacon)try{D=a.navigator.sendBeacon(A.A.toString(),"")}catch{}!D&&a.Image&&(new Image().src=A.A,D=!0),D||(A.g=wm(A.j,null),A.g.ea(A.A)),A.F=Date.now(),Xu(A)}Wv(p)}function Eh(p){p.g&&(ym(p),p.g.cancel(),p.g=null)}function Vv(p){Eh(p),p.v&&(a.clearTimeout(p.v),p.v=null),Th(p),p.h.cancel(),p.m&&(typeof p.m=="number"&&a.clearTimeout(p.m),p.m=null)}function Ah(p){if(!Ti(p.h)&&!p.m){p.m=!0;var A=p.Ea;$||C(),L||($(),L=!0),I.add(A,p),p.D=0}}function _x(p,A){return wh(p.h)>=p.h.j-(p.m?1:0)?!1:p.m?(p.i=A.G.concat(p.i),!0):p.I==1||p.I==2||p.D>=(p.Sa?0:p.Ta)?!1:(p.m=ul(u(p.Ea,p,A),vm(p,p.D)),p.D++,!0)}n.Ea=function(p){if(this.m)if(this.m=null,this.I==1){if(!p){this.V=Math.floor(Math.random()*1e5),p=this.V++;const ee=new us(this,this.j,p);let re=this.o;if(this.U&&(re?(re=H(re),Y(re,this.U)):re=this.U),this.u!==null||this.R||(ee.J=re,re=null),this.S)e:{for(var A=0,D=0;D<this.i.length;D++){t:{var B=this.i[D];if("__data__"in B.map&&(B=B.map.__data__,typeof B=="string")){B=B.length;break t}B=void 0}if(B===void 0)break;if(A+=B,A>4096){A=D;break e}if(A===4096||D===this.i.length-1){A=D+1;break e}}A=1e3}else A=1e3;A=Bv(this,ee,A),D=Ui(this.J),Nt(D,"RID",p),Nt(D,"CVER",22),this.G&&Nt(D,"X-HTTP-Session-Id",this.G),ac(this,D),re&&(this.R?A="headers="+cl(Nv(re))+"&"+A:this.u&&ic(D,this.u,re)),dm(this.h,ee),this.Ra&&Nt(D,"TYPE","init"),this.S?(Nt(D,"$req",A),Nt(D,"SID","null"),ee.U=!0,Bi(ee,D,null)):Bi(ee,D,A),this.I=2}}else this.I==3&&(p?jv(this,p):this.i.length==0||Ti(this.h)||jv(this))};function jv(p,A){var D;A?D=A.l:D=p.V++;const B=Ui(p.J);Nt(B,"SID",p.M),Nt(B,"RID",D),Nt(B,"AID",p.K),ac(p,B),p.u&&p.o&&ic(B,p.u,p.o),D=new us(p,p.j,D,p.D+1),p.u===null&&(D.J=p.o),A&&(p.i=A.G.concat(p.i)),A=Bv(p,D,1e3),D.H=Math.round(p.va*.5)+Math.round(p.va*.5*Math.random()),dm(p.h,D),Bi(D,B,A)}function ac(p,A){p.H&&W(p.H,function(D,B){Nt(A,B,D)}),p.l&&W({},function(D,B){Nt(A,B,D)})}function Bv(p,A,D){D=Math.min(p.i.length,D);const B=p.l?u(p.l.Ka,p.l,p):null;e:{var ee=p.i;let Qe=-1;for(;;){const un=["count="+D];Qe==-1?D>0?(Qe=ee[0].g,un.push("ofs="+Qe)):Qe=0:un.push("ofs="+Qe);let At=!0;for(let mn=0;mn<D;mn++){var re=ee[mn].g;const jr=ee[mn].map;if(re-=Qe,re<0)Qe=Math.max(0,ee[mn].g-100),At=!1;else try{re="req"+re+"_"||"";try{var ve=jr instanceof Map?jr:Object.entries(jr);for(const[Br,Wi]of ve){let fs=Wi;o(Wi)&&(fs=ji(Wi)),un.push(re+Br+"="+encodeURIComponent(fs))}}catch(Br){throw un.push(re+"type="+encodeURIComponent("_badmap")),Br}}catch{B&&B(jr)}}if(At){ve=un.join("&");break e}}ve=void 0}return p=p.i.splice(0,D),A.G=p,ve}function Uv(p){if(!p.g&&!p.v){p.Y=1;var A=p.Da;$||C(),L||($(),L=!0),I.add(A,p),p.A=0}}function gm(p){return p.g||p.v||p.A>=3?!1:(p.Y++,p.v=ul(u(p.Da,p),vm(p,p.A)),p.A++,!0)}n.Da=function(){if(this.v=null,Hv(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var p=4*this.T;this.j.info("BP detection timer enabled: "+p),this.B=ul(u(this.Wa,this),p)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Dn(10),Eh(this),Hv(this))};function ym(p){p.B!=null&&(a.clearTimeout(p.B),p.B=null)}function Hv(p){p.g=new us(p,p.j,"rpc",p.Y),p.u===null&&(p.g.J=p.o),p.g.P=0;var A=Ui(p.na);Nt(A,"RID","rpc"),Nt(A,"SID",p.M),Nt(A,"AID",p.K),Nt(A,"CI",p.F?"0":"1"),!p.F&&p.ia&&Nt(A,"TO",p.ia),Nt(A,"TYPE","xmlhttp"),ac(p,A),p.u&&p.o&&ic(A,p.u,p.o),p.O&&(p.g.H=p.O);var D=p.g;p=p.ba,D.M=1,D.A=bh(Ui(A)),D.u=null,D.R=!0,vh(D,p)}n.Va=function(){this.C!=null&&(this.C=null,Eh(this),gm(this),Dn(19))};function Th(p){p.C!=null&&(a.clearTimeout(p.C),p.C=null)}function _m(p,A){var D=null;if(p.g==A){Th(p),ym(p),p.g=null;var B=2}else if(cm(p.h,A))D=A.G,Av(p.h,A),B=1;else return;if(p.I!=0){if(A.o)if(B==1){D=A.u?A.u.length:0,A=Date.now()-A.F;var ee=p.D;B=yh(),Rt(B,new nm(B,D)),Ah(p)}else Uv(p);else if(ee=A.m,ee==3||ee==0&&A.X>0||!(B==1&&_x(p,A)||B==2&&gm(p)))switch(D&&D.length>0&&(A=p.h,A.i=A.i.concat(D)),ee){case 1:aa(p,5);break;case 4:aa(p,10);break;case 3:aa(p,6);break;default:aa(p,2)}}}function vm(p,A){let D=p.Qa+Math.floor(Math.random()*p.Za);return p.isActive()||(D*=2),D*A}function aa(p,A){if(p.j.info("Error code "+A),A==2){var D=u(p.bb,p),B=p.Ua;const ee=!B;B=new ai(B||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Ju(B,"https"),bh(B),ee?mx(B.toString(),D):gx(B.toString(),D)}else Dn(2);p.I=0,p.l&&p.l.pa(A),Wv(p),Vv(p)}n.bb=function(p){p?(this.j.info("Successfully pinged google.com"),Dn(2)):(this.j.info("Failed to ping google.com"),Dn(1))};function Wv(p){if(p.I=0,p.ja=[],p.l){const A=Tv(p.h);(A.length!=0||p.i.length!=0)&&(y(p.ja,A),y(p.ja,p.i),p.h.i.length=0,m(p.i),p.i.length=0),p.l.oa()}}function qv(p,A,D){var B=D instanceof ai?Ui(D):new ai(D);if(B.g!="")A&&(B.g=A+"."+B.g),dl(B,B.u);else{var ee=a.location;B=ee.protocol,A=A?A+"."+ee.hostname:ee.hostname,ee=+ee.port;const re=new ai(null);B&&Ju(re,B),A&&(re.g=A),ee&&dl(re,ee),D&&(re.h=D),B=re}return D=p.G,A=p.wa,D&&A&&Nt(B,D,A),Nt(B,"VER",p.ka),ac(p,B),B}function wm(p,A,D){if(A&&!p.L)throw Error("Can't create secondary domain capable XhrIo object.");return A=p.Aa&&!p.ma?new Ht(new Hi({ab:D})):new Ht(p.ma),A.Fa(p.L),A}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function bm(){}n=bm.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function oa(){}oa.prototype.g=function(p,A){return new Si(p,A)};function Si(p,A){Mt.call(this),this.g=new zv(A),this.l=p,this.h=A&&A.messageUrlParams||null,p=A&&A.messageHeaders||null,A&&A.clientProtocolHeaderRequired&&(p?p["X-Client-Protocol"]="webchannel":p={"X-Client-Protocol":"webchannel"}),this.g.o=p,p=A&&A.initMessageHeaders||null,A&&A.messageContentType&&(p?p["X-WebChannel-Content-Type"]=A.messageContentType:p={"X-WebChannel-Content-Type":A.messageContentType}),A&&A.sa&&(p?p["X-WebChannel-Client-Profile"]=A.sa:p={"X-WebChannel-Client-Profile":A.sa}),this.g.U=p,(p=A&&A.Qb)&&!j(p)&&(this.g.u=p),this.A=A&&A.supportsCrossDomainXhr||!1,this.v=A&&A.sendRawJson||!1,(A=A&&A.httpSessionIdParam)&&!j(A)&&(this.g.G=A,p=this.h,p!==null&&A in p&&(p=this.h,A in p&&delete p[A])),this.j=new pl(this)}h(Si,Mt),Si.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Si.prototype.close=function(){mm(this.g)},Si.prototype.o=function(p){var A=this.g;if(typeof p=="string"){var D={};D.__data__=p,p=D}else this.v&&(D={},D.__data__=ji(p),p=D);A.i.push(new um(A.Ya++,p)),A.I==3&&Ah(A)},Si.prototype.N=function(){this.g.l=null,delete this.j,mm(this.g),delete this.g,Si.Z.N.call(this)};function xm(p){mh.call(this),p.__headers__&&(this.headers=p.__headers__,this.statusCode=p.__status__,delete p.__headers__,delete p.__status__);var A=p.__sm__;if(A){e:{for(const D in A){p=D;break e}p=void 0}(this.i=p)&&(p=this.i,A=A!==null&&p in A?A[p]:void 0),this.data=A}else this.data=p}h(xm,mh);function Gv(){gh.call(this),this.status=1}h(Gv,gh);function pl(p){this.g=p}h(pl,bm),pl.prototype.ra=function(){Rt(this.g,"a")},pl.prototype.qa=function(p){Rt(this.g,new xm(p))},pl.prototype.pa=function(p){Rt(this.g,new Gv)},pl.prototype.oa=function(){Rt(this.g,"b")},oa.prototype.createWebChannel=oa.prototype.g,Si.prototype.send=Si.prototype.o,Si.prototype.open=Si.prototype.m,Si.prototype.close=Si.prototype.close,O4=function(){return new oa},M4=function(){return yh()},D4=na,TT={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Yu.NO_ERROR=0,Yu.TIMEOUT=8,Yu.HTTP_ERROR=6,iw=Yu,im.COMPLETE="complete",N4=im,ta.EventType=ll,ll.OPEN="a",ll.CLOSE="b",ll.ERROR="c",ll.MESSAGE="d",Mt.prototype.listen=Mt.prototype.J,tg=ta,Ht.prototype.listenOnce=Ht.prototype.K,Ht.prototype.getLastError=Ht.prototype.Ha,Ht.prototype.getLastErrorCode=Ht.prototype.ya,Ht.prototype.getStatus=Ht.prototype.ca,Ht.prototype.getResponseJson=Ht.prototype.La,Ht.prototype.getResponseText=Ht.prototype.la,Ht.prototype.send=Ht.prototype.ea,Ht.prototype.setWithCredentials=Ht.prototype.Fa,P4=Ht}).apply(typeof m0<"u"?m0:typeof self<"u"?self:typeof window<"u"?window:{});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _i=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};_i.UNAUTHENTICATED=new _i(null),_i.GOOGLE_CREDENTIALS=new _i("google-credentials-uid"),_i.FIRST_PARTY=new _i("first-party-uid"),_i.MOCK_USER=new _i("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gp="12.8.0";function QG(n){Gp=n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gd=new wI("@firebase/firestore");function kh(){return Gd.logLevel}function Ae(n,...e){if(Gd.logLevel<=lt.DEBUG){const t=e.map(RI);Gd.debug(`Firestore (${Gp}): ${n}`,...t)}}function Zo(n,...e){if(Gd.logLevel<=lt.ERROR){const t=e.map(RI);Gd.error(`Firestore (${Gp}): ${n}`,...t)}}function Kd(n,...e){if(Gd.logLevel<=lt.WARN){const t=e.map(RI);Gd.warn(`Firestore (${Gp}): ${n}`,...t)}}function RI(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ue(n,e,t){let i="Unexpected state";typeof e=="string"?i=e:t=e,L4(n,i,t)}function L4(n,e,t){let i=`FIRESTORE (${Gp}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{i+=" CONTEXT: "+JSON.stringify(t)}catch{i+=" CONTEXT: "+t}throw Zo(i),new Error(i)}function xt(n,e,t,i){let r="Unexpected state";typeof t=="string"?r=t:i=t,n||L4(e,r,i)}function Ye(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const le={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class be extends Wa{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uo{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F4{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class z4{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(_i.UNAUTHENTICATED))}shutdown(){}}class JG{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class ZG{constructor(e){this.t=e,this.currentUser=_i.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){xt(this.o===void 0,42304);let i=this.i;const r=l=>this.i!==i?(i=this.i,t(l)):Promise.resolve();let s=new Uo;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Uo,e.enqueueRetryable(()=>r(this.currentUser))};const a=()=>{const l=s;e.enqueueRetryable(async()=>{await l.promise,await r(this.currentUser)})},o=l=>{Ae("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>o(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?o(l):(Ae("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Uo)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(Ae("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(xt(typeof i.accessToken=="string",31837,{l:i}),new F4(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return xt(e===null||typeof e=="string",2055,{h:e}),new _i(e)}}class e7{constructor(e,t,i){this.P=e,this.T=t,this.I=i,this.type="FirstParty",this.user=_i.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class t7{constructor(e,t,i){this.P=e,this.T=t,this.I=i}getToken(){return Promise.resolve(new e7(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(_i.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class dR{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class n7{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,kr(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){xt(this.o===void 0,3512);const i=s=>{s.error!=null&&Ae("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.m;return this.m=s.token,Ae("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>i(s))};const r=s=>{Ae("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?r(s):Ae("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new dR(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(xt(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new dR(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i7(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D1{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let i="";for(;i.length<20;){const r=i7(40);for(let s=0;s<r.length;++s)i.length<20&&r[s]<t&&(i+=e.charAt(r[s]%62))}return i}}function ut(n,e){return n<e?-1:n>e?1:0}function ST(n,e){const t=Math.min(n.length,e.length);for(let i=0;i<t;i++){const r=n.charAt(i),s=e.charAt(i);if(r!==s)return lE(r)===lE(s)?ut(r,s):lE(r)?1:-1}return ut(n.length,e.length)}const r7=55296,s7=57343;function lE(n){const e=n.charCodeAt(0);return e>=r7&&e<=s7}function Np(n,e,t){return n.length===e.length&&n.every((i,r)=>t(i,e[r]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hR="__name__";class pa{constructor(e,t,i){t===void 0?t=0:t>e.length&&Ue(637,{offset:t,range:e.length}),i===void 0?i=e.length-t:i>e.length-t&&Ue(1746,{length:i,range:e.length-t}),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return pa.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof pa?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let r=0;r<i;r++){const s=pa.compareSegments(e.get(r),t.get(r));if(s!==0)return s}return ut(e.length,t.length)}static compareSegments(e,t){const i=pa.isNumericId(e),r=pa.isNumericId(t);return i&&!r?-1:!i&&r?1:i&&r?pa.extractNumericId(e).compare(pa.extractNumericId(t)):ST(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return wu.fromString(e.substring(4,e.length-2))}}class Ft extends pa{construct(e,t,i){return new Ft(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new be(le.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new Ft(t)}static emptyPath(){return new Ft([])}}const a7=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class qn extends pa{construct(e,t,i){return new qn(e,t,i)}static isValidIdentifier(e){return a7.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),qn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===hR}static keyField(){return new qn([hR])}static fromServerFormat(e){const t=[];let i="",r=0;const s=()=>{if(i.length===0)throw new be(le.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let a=!1;for(;r<e.length;){const o=e[r];if(o==="\\"){if(r+1===e.length)throw new be(le.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[r+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new be(le.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=l,r+=2}else o==="`"?(a=!a,r++):o!=="."||a?(i+=o,r++):(s(),r++)}if(s(),a)throw new be(le.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new qn(t)}static emptyPath(){return new qn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oe{constructor(e){this.path=e}static fromPath(e){return new Oe(Ft.fromString(e))}static fromName(e){return new Oe(Ft.fromString(e).popFirst(5))}static empty(){return new Oe(Ft.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ft.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ft.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Oe(new Ft(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V4(n,e,t){if(!t)throw new be(le.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function j4(n,e,t,i){if(e===!0&&i===!0)throw new be(le.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function fR(n){if(!Oe.isDocumentKey(n))throw new be(le.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function pR(n){if(Oe.isDocumentKey(n))throw new be(le.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function B4(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function M1(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(i){return i.constructor?i.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Ue(12329,{type:typeof n})}function Xs(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new be(le.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=M1(n);throw new be(le.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xn(n,e){const t={typeString:n};return e&&(t.value=e),t}function av(n,e){if(!B4(n))throw new be(le.INVALID_ARGUMENT,"JSON must be an object");let t;for(const i in e)if(e[i]){const r=e[i].typeString,s="value"in e[i]?{value:e[i].value}:void 0;if(!(i in n)){t=`JSON missing required field: '${i}'`;break}const a=n[i];if(r&&typeof a!==r){t=`JSON field '${i}' must be a ${r}.`;break}if(s!==void 0&&a!==s.value){t=`Expected '${i}' field to equal '${s.value}'`;break}}if(t)throw new be(le.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mR=-62135596800,gR=1e6;class zt{static now(){return zt.fromMillis(Date.now())}static fromDate(e){return zt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor((e-1e3*t)*gR);return new zt(t,i)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new be(le.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new be(le.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<mR)throw new be(le.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new be(le.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/gR}_compareTo(e){return this.seconds===e.seconds?ut(this.nanoseconds,e.nanoseconds):ut(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:zt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(av(e,zt._jsonSchema))return new zt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-mR;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}zt._jsonSchemaVersion="firestore/timestamp/1.0",zt._jsonSchema={type:xn("string",zt._jsonSchemaVersion),seconds:xn("number"),nanoseconds:xn("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ke{static fromTimestamp(e){return new Ke(e)}static min(){return new Ke(new zt(0,0))}static max(){return new Ke(new zt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hy=-1;function o7(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=Ke.fromTimestamp(i===1e9?new zt(t+1,0):new zt(t,i));return new Su(r,Oe.empty(),e)}function l7(n){return new Su(n.readTime,n.key,hy)}class Su{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new Su(Ke.min(),Oe.empty(),hy)}static max(){return new Su(Ke.max(),Oe.empty(),hy)}}function u7(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Oe.comparator(n.documentKey,e.documentKey),t!==0?t:ut(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c7="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class d7{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kp(n){if(n.code!==le.FAILED_PRECONDITION||n.message!==c7)throw n;Ae("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ce{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ue(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ce((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof ce?t:ce.resolve(t)}catch(t){return ce.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):ce.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):ce.reject(t)}static resolve(e){return new ce((t,i)=>{t(e)})}static reject(e){return new ce((t,i)=>{i(e)})}static waitFor(e){return new ce((t,i)=>{let r=0,s=0,a=!1;e.forEach(o=>{++r,o.next(()=>{++s,a&&s===r&&t()},l=>i(l))}),a=!0,s===r&&t()})}static or(e){let t=ce.resolve(!1);for(const i of e)t=t.next(r=>r?ce.resolve(r):i());return t}static forEach(e,t){const i=[];return e.forEach((r,s)=>{i.push(t.call(this,r,s))}),this.waitFor(i)}static mapArray(e,t){return new ce((i,r)=>{const s=e.length,a=new Array(s);let o=0;for(let l=0;l<s;l++){const u=l;t(e[u]).next(c=>{a[u]=c,++o,o===s&&i(a)},c=>r(c))}})}static doWhile(e,t){return new ce((i,r)=>{const s=()=>{e()===!0?t().next(()=>{s()},r):i()};s()})}}function h7(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Yp(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O1{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this.ae(i),this.ue=i=>t.writeSequenceNumber(i))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}O1.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PI=-1;function L1(n){return n==null}function vb(n){return n===0&&1/n==-1/0}function f7(n){return typeof n=="number"&&Number.isInteger(n)&&!vb(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U4="";function p7(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=yR(e)),e=m7(n.get(t),e);return yR(e)}function m7(n,e){let t=e;const i=n.length;for(let r=0;r<i;r++){const s=n.charAt(r);switch(s){case"\0":t+="";break;case U4:t+="";break;default:t+=s}}return t}function yR(n){return n+U4+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _R(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function ju(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function H4(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rn{constructor(e,t){this.comparator=e,this.root=t||ni.EMPTY}insert(e,t){return new rn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ni.BLACK,null,null))}remove(e){return new rn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ni.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const r=this.comparator(e,i.key);if(r===0)return t+i.left.size;r<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){const e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new g0(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new g0(this.root,e,this.comparator,!1)}getReverseIterator(){return new g0(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new g0(this.root,e,this.comparator,!0)}}class g0{constructor(e,t,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ni{constructor(e,t,i,r,s){this.key=e,this.value=t,this.color=i??ni.RED,this.left=r??ni.EMPTY,this.right=s??ni.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,r,s){return new ni(e??this.key,t??this.value,i??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let r=this;const s=i(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,i),null):s===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return ni.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return ni.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ni.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ni.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ue(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ue(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ue(27949);return e+(this.isRed()?0:1)}}ni.EMPTY=null,ni.RED=!0,ni.BLACK=!1;ni.EMPTY=new class{constructor(){this.size=0}get key(){throw Ue(57766)}get value(){throw Ue(16141)}get color(){throw Ue(16727)}get left(){throw Ue(29726)}get right(){throw Ue(36894)}copy(e,t,i,r,s){return this}insert(e,t,i){return new ni(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rn{constructor(e){this.comparator=e,this.data=new rn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new vR(this.data.getIterator())}getIteratorFrom(e){return new vR(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof Rn)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=i.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Rn(this.comparator);return t.data=e,t}}class vR{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nr{constructor(e){this.fields=e,e.sort(qn.comparator)}static empty(){return new Nr([])}unionWith(e){let t=new Rn(qn.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new Nr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Np(this.fields,e.fields,(t,i)=>t.isEqual(i))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W4 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new W4("Invalid base64 string: "+s):s}}(e);return new Kn(t)}static fromUint8Array(e){const t=function(r){let s="";for(let a=0;a<r.length;++a)s+=String.fromCharCode(r[a]);return s}(e);return new Kn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ut(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Kn.EMPTY_BYTE_STRING=new Kn("");const g7=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Iu(n){if(xt(!!n,39018),typeof n=="string"){let e=0;const t=g7.exec(n);if(xt(!!t,46558,{timestamp:n}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:hn(n.seconds),nanos:hn(n.nanos)}}function hn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Cu(n){return typeof n=="string"?Kn.fromBase64String(n):Kn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q4="server_timestamp",G4="__type__",K4="__previous_value__",Y4="__local_write_time__";function NI(n){var t,i;return((i=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[G4])==null?void 0:i.stringValue)===q4}function F1(n){const e=n.mapValue.fields[K4];return NI(e)?F1(e):e}function fy(n){const e=Iu(n.mapValue.fields[Y4].timestampValue);return new zt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y7{constructor(e,t,i,r,s,a,o,l,u,c,h){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=o,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=c,this.apiKey=h}}const wb="(default)";class Dp{constructor(e,t){this.projectId=e,this.database=t||wb}static empty(){return new Dp("","")}get isDefaultDatabase(){return this.database===wb}isEqual(e){return e instanceof Dp&&e.projectId===this.projectId&&e.database===this.database}}function _7(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new be(le.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Dp(n.options.projectId,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X4="__type__",v7="__max__",y0={mapValue:{}},Q4="__vector__",bb="value";function ku(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?NI(n)?4:b7(n)?9007199254740991:w7(n)?10:11:Ue(28295,{value:n})}function ja(n,e){if(n===e)return!0;const t=ku(n);if(t!==ku(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return fy(n).isEqual(fy(e));case 3:return function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;const a=Iu(r.timestampValue),o=Iu(s.timestampValue);return a.seconds===o.seconds&&a.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(r,s){return Cu(r.bytesValue).isEqual(Cu(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,s){return hn(r.geoPointValue.latitude)===hn(s.geoPointValue.latitude)&&hn(r.geoPointValue.longitude)===hn(s.geoPointValue.longitude)}(n,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return hn(r.integerValue)===hn(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){const a=hn(r.doubleValue),o=hn(s.doubleValue);return a===o?vb(a)===vb(o):isNaN(a)&&isNaN(o)}return!1}(n,e);case 9:return Np(n.arrayValue.values||[],e.arrayValue.values||[],ja);case 10:case 11:return function(r,s){const a=r.mapValue.fields||{},o=s.mapValue.fields||{};if(_R(a)!==_R(o))return!1;for(const l in a)if(a.hasOwnProperty(l)&&(o[l]===void 0||!ja(a[l],o[l])))return!1;return!0}(n,e);default:return Ue(52216,{left:n})}}function py(n,e){return(n.values||[]).find(t=>ja(t,e))!==void 0}function Mp(n,e){if(n===e)return 0;const t=ku(n),i=ku(e);if(t!==i)return ut(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return ut(n.booleanValue,e.booleanValue);case 2:return function(s,a){const o=hn(s.integerValue||s.doubleValue),l=hn(a.integerValue||a.doubleValue);return o<l?-1:o>l?1:o===l?0:isNaN(o)?isNaN(l)?0:-1:1}(n,e);case 3:return wR(n.timestampValue,e.timestampValue);case 4:return wR(fy(n),fy(e));case 5:return ST(n.stringValue,e.stringValue);case 6:return function(s,a){const o=Cu(s),l=Cu(a);return o.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(s,a){const o=s.split("/"),l=a.split("/");for(let u=0;u<o.length&&u<l.length;u++){const c=ut(o[u],l[u]);if(c!==0)return c}return ut(o.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,a){const o=ut(hn(s.latitude),hn(a.latitude));return o!==0?o:ut(hn(s.longitude),hn(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return bR(n.arrayValue,e.arrayValue);case 10:return function(s,a){var f,m,y,_;const o=s.fields||{},l=a.fields||{},u=(f=o[bb])==null?void 0:f.arrayValue,c=(m=l[bb])==null?void 0:m.arrayValue,h=ut(((y=u==null?void 0:u.values)==null?void 0:y.length)||0,((_=c==null?void 0:c.values)==null?void 0:_.length)||0);return h!==0?h:bR(u,c)}(n.mapValue,e.mapValue);case 11:return function(s,a){if(s===y0.mapValue&&a===y0.mapValue)return 0;if(s===y0.mapValue)return 1;if(a===y0.mapValue)return-1;const o=s.fields||{},l=Object.keys(o),u=a.fields||{},c=Object.keys(u);l.sort(),c.sort();for(let h=0;h<l.length&&h<c.length;++h){const f=ST(l[h],c[h]);if(f!==0)return f;const m=Mp(o[l[h]],u[c[h]]);if(m!==0)return m}return ut(l.length,c.length)}(n.mapValue,e.mapValue);default:throw Ue(23264,{he:t})}}function wR(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ut(n,e);const t=Iu(n),i=Iu(e),r=ut(t.seconds,i.seconds);return r!==0?r:ut(t.nanos,i.nanos)}function bR(n,e){const t=n.values||[],i=e.values||[];for(let r=0;r<t.length&&r<i.length;++r){const s=Mp(t[r],i[r]);if(s)return s}return ut(t.length,i.length)}function Op(n){return IT(n)}function IT(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const i=Iu(t);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Cu(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Oe.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let i="[",r=!0;for(const s of t.values||[])r?r=!1:i+=",",i+=IT(s);return i+"]"}(n.arrayValue):"mapValue"in n?function(t){const i=Object.keys(t.fields||{}).sort();let r="{",s=!0;for(const a of i)s?s=!1:r+=",",r+=`${a}:${IT(t.fields[a])}`;return r+"}"}(n.mapValue):Ue(61005,{value:n})}function rw(n){switch(ku(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=F1(n);return e?16+rw(e):16;case 5:return 2*n.stringValue.length;case 6:return Cu(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(i){return(i.values||[]).reduce((r,s)=>r+rw(s),0)}(n.arrayValue);case 10:case 11:return function(i){let r=0;return ju(i.fields,(s,a)=>{r+=s.length+rw(a)}),r}(n.mapValue);default:throw Ue(13486,{value:n})}}function xR(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function CT(n){return!!n&&"integerValue"in n}function DI(n){return!!n&&"arrayValue"in n}function ER(n){return!!n&&"nullValue"in n}function AR(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function sw(n){return!!n&&"mapValue"in n}function w7(n){var t,i;return((i=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[X4])==null?void 0:i.stringValue)===Q4}function Lg(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return ju(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=Lg(i)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Lg(n.arrayValue.values[t]);return e}return{...n}}function b7(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===v7}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr{constructor(e){this.value=e}static empty(){return new nr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!sw(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Lg(t)}setAll(e){let t=qn.emptyPath(),i={},r=[];e.forEach((a,o)=>{if(!t.isImmediateParentOf(o)){const l=this.getFieldsMap(t);this.applyChanges(l,i,r),i={},r=[],t=o.popLast()}a?i[o.lastSegment()]=Lg(a):r.push(o.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,i,r)}delete(e){const t=this.field(e.popLast());sw(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ja(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=t.mapValue.fields[e.get(i)];sw(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,i){ju(t,(r,s)=>e[r]=s);for(const r of i)delete e[r]}clone(){return new nr(Lg(this.value))}}function J4(n){const e=[];return ju(n.fields,(t,i)=>{const r=new qn([t]);if(sw(i)){const s=J4(i.mapValue).fields;if(s.length===0)e.push(r);else for(const a of s)e.push(r.child(a))}else e.push(r)}),new Nr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bi{constructor(e,t,i,r,s,a,o){this.key=e,this.documentType=t,this.version=i,this.readTime=r,this.createTime=s,this.data=a,this.documentState=o}static newInvalidDocument(e){return new bi(e,0,Ke.min(),Ke.min(),Ke.min(),nr.empty(),0)}static newFoundDocument(e,t,i,r){return new bi(e,1,t,Ke.min(),i,r,0)}static newNoDocument(e,t){return new bi(e,2,t,Ke.min(),Ke.min(),nr.empty(),0)}static newUnknownDocument(e,t){return new bi(e,3,t,Ke.min(),Ke.min(),nr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ke.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=nr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=nr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ke.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof bi&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new bi(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xb{constructor(e,t){this.position=e,this.inclusive=t}}function TR(n,e,t){let i=0;for(let r=0;r<n.position.length;r++){const s=e[r],a=n.position[r];if(s.field.isKeyField()?i=Oe.comparator(Oe.fromName(a.referenceValue),t.key):i=Mp(a,t.data.field(s.field)),s.dir==="desc"&&(i*=-1),i!==0)break}return i}function SR(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!ja(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class my{constructor(e,t="asc"){this.field=e,this.dir=t}}function x7(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z4{}class wn extends Z4{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new A7(e,t,i):t==="array-contains"?new I7(e,i):t==="in"?new C7(e,i):t==="not-in"?new k7(e,i):t==="array-contains-any"?new $7(e,i):new wn(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new T7(e,i):new S7(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Mp(t,this.value)):t!==null&&ku(this.value)===ku(t)&&this.matchesComparison(Mp(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ue(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Qs extends Z4{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Qs(e,t)}matches(e){return eF(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function eF(n){return n.op==="and"}function tF(n){return E7(n)&&eF(n)}function E7(n){for(const e of n.filters)if(e instanceof Qs)return!1;return!0}function kT(n){if(n instanceof wn)return n.field.canonicalString()+n.op.toString()+Op(n.value);if(tF(n))return n.filters.map(e=>kT(e)).join(",");{const e=n.filters.map(t=>kT(t)).join(",");return`${n.op}(${e})`}}function nF(n,e){return n instanceof wn?function(i,r){return r instanceof wn&&i.op===r.op&&i.field.isEqual(r.field)&&ja(i.value,r.value)}(n,e):n instanceof Qs?function(i,r){return r instanceof Qs&&i.op===r.op&&i.filters.length===r.filters.length?i.filters.reduce((s,a,o)=>s&&nF(a,r.filters[o]),!0):!1}(n,e):void Ue(19439)}function iF(n){return n instanceof wn?function(t){return`${t.field.canonicalString()} ${t.op} ${Op(t.value)}`}(n):n instanceof Qs?function(t){return t.op.toString()+" {"+t.getFilters().map(iF).join(" ,")+"}"}(n):"Filter"}class A7 extends wn{constructor(e,t,i){super(e,t,i),this.key=Oe.fromName(i.referenceValue)}matches(e){const t=Oe.comparator(e.key,this.key);return this.matchesComparison(t)}}class T7 extends wn{constructor(e,t){super(e,"in",t),this.keys=rF("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class S7 extends wn{constructor(e,t){super(e,"not-in",t),this.keys=rF("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function rF(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(i=>Oe.fromName(i.referenceValue))}class I7 extends wn{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return DI(t)&&py(t.arrayValue,this.value)}}class C7 extends wn{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&py(this.value.arrayValue,t)}}class k7 extends wn{constructor(e,t){super(e,"not-in",t)}matches(e){if(py(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!py(this.value.arrayValue,t)}}class $7 extends wn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!DI(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>py(this.value.arrayValue,i))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R7{constructor(e,t=null,i=[],r=[],s=null,a=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=a,this.endAt=o,this.Te=null}}function IR(n,e=null,t=[],i=[],r=null,s=null,a=null){return new R7(n,e,t,i,r,s,a)}function MI(n){const e=Ye(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>kT(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>function(s){return s.field.canonicalString()+s.dir}(i)).join(","),L1(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>Op(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>Op(i)).join(",")),e.Te=t}return e.Te}function OI(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!x7(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!nF(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!SR(n.startAt,e.startAt)&&SR(n.endAt,e.endAt)}function $T(n){return Oe.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xp{constructor(e,t=null,i=[],r=[],s=null,a="F",o=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=a,this.startAt=o,this.endAt=l,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function P7(n,e,t,i,r,s,a,o){return new Xp(n,e,t,i,r,s,a,o)}function LI(n){return new Xp(n)}function CR(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function N7(n){return Oe.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function sF(n){return n.collectionGroup!==null}function Fg(n){const e=Ye(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const s of e.explicitOrderBy)e.Ie.push(s),t.add(s.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let o=new Rn(qn.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(o=o.add(u.field))})}),o})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new my(s,i))}),t.has(qn.keyField().canonicalString())||e.Ie.push(new my(qn.keyField(),i))}return e.Ie}function za(n){const e=Ye(n);return e.Ee||(e.Ee=D7(e,Fg(n))),e.Ee}function D7(n,e){if(n.limitType==="F")return IR(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{const s=r.dir==="desc"?"asc":"desc";return new my(r.field,s)});const t=n.endAt?new xb(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new xb(n.startAt.position,n.startAt.inclusive):null;return IR(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function RT(n,e){const t=n.filters.concat([e]);return new Xp(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function M7(n,e){const t=n.explicitOrderBy.concat([e]);return new Xp(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function PT(n,e,t){return new Xp(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function z1(n,e){return OI(za(n),za(e))&&n.limitType===e.limitType}function aF(n){return`${MI(za(n))}|lt:${n.limitType}`}function $h(n){return`Query(target=${function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map(r=>iF(r)).join(", ")}]`),L1(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map(r=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(r)).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map(r=>Op(r)).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map(r=>Op(r)).join(",")),`Target(${i})`}(za(n))}; limitType=${n.limitType})`}function V1(n,e){return e.isFoundDocument()&&function(i,r){const s=r.key.path;return i.collectionGroup!==null?r.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(s):Oe.isDocumentKey(i.path)?i.path.isEqual(s):i.path.isImmediateParentOf(s)}(n,e)&&function(i,r){for(const s of Fg(i))if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0}(n,e)&&function(i,r){for(const s of i.filters)if(!s.matches(r))return!1;return!0}(n,e)&&function(i,r){return!(i.startAt&&!function(a,o,l){const u=TR(a,o,l);return a.inclusive?u<=0:u<0}(i.startAt,Fg(i),r)||i.endAt&&!function(a,o,l){const u=TR(a,o,l);return a.inclusive?u>=0:u>0}(i.endAt,Fg(i),r))}(n,e)}function O7(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function oF(n){return(e,t)=>{let i=!1;for(const r of Fg(n)){const s=L7(r,e,t);if(s!==0)return s;i=i||r.field.isKeyField()}return 0}}function L7(n,e,t){const i=n.field.isKeyField()?Oe.comparator(e.key,t.key):function(s,a,o){const l=a.data.field(s),u=o.data.field(s);return l!==null&&u!==null?Mp(l,u):Ue(42886)}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return Ue(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uh{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[r,s]of i)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),r=this.inner[i];if(r===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return i.length===1?delete this.inner[t]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(e){ju(this.inner,(t,i)=>{for(const[r,s]of i)e(r,s)})}isEmpty(){return H4(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F7=new rn(Oe.comparator);function el(){return F7}const lF=new rn(Oe.comparator);function ng(...n){let e=lF;for(const t of n)e=e.insert(t.key,t);return e}function uF(n){let e=lF;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function Cc(){return zg()}function cF(){return zg()}function zg(){return new uh(n=>n.toString(),(n,e)=>n.isEqual(e))}const z7=new rn(Oe.comparator),V7=new Rn(Oe.comparator);function ct(...n){let e=V7;for(const t of n)e=e.add(t);return e}const j7=new Rn(ut);function B7(){return j7}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FI(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:vb(e)?"-0":e}}function dF(n){return{integerValue:""+n}}function U7(n,e){return f7(e)?dF(e):FI(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j1{constructor(){this._=void 0}}function H7(n,e,t){return n instanceof gy?function(r,s){const a={fields:{[G4]:{stringValue:q4},[Y4]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&NI(s)&&(s=F1(s)),s&&(a.fields[K4]=s),{mapValue:a}}(t,e):n instanceof yy?fF(n,e):n instanceof _y?pF(n,e):function(r,s){const a=hF(r,s),o=kR(a)+kR(r.Ae);return CT(a)&&CT(r.Ae)?dF(o):FI(r.serializer,o)}(n,e)}function W7(n,e,t){return n instanceof yy?fF(n,e):n instanceof _y?pF(n,e):t}function hF(n,e){return n instanceof Eb?function(i){return CT(i)||function(s){return!!s&&"doubleValue"in s}(i)}(e)?e:{integerValue:0}:null}class gy extends j1{}class yy extends j1{constructor(e){super(),this.elements=e}}function fF(n,e){const t=mF(e);for(const i of n.elements)t.some(r=>ja(r,i))||t.push(i);return{arrayValue:{values:t}}}class _y extends j1{constructor(e){super(),this.elements=e}}function pF(n,e){let t=mF(e);for(const i of n.elements)t=t.filter(r=>!ja(r,i));return{arrayValue:{values:t}}}class Eb extends j1{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function kR(n){return hn(n.integerValue||n.doubleValue)}function mF(n){return DI(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q7{constructor(e,t){this.field=e,this.transform=t}}function G7(n,e){return n.field.isEqual(e.field)&&function(i,r){return i instanceof yy&&r instanceof yy||i instanceof _y&&r instanceof _y?Np(i.elements,r.elements,ja):i instanceof Eb&&r instanceof Eb?ja(i.Ae,r.Ae):i instanceof gy&&r instanceof gy}(n.transform,e.transform)}class K7{constructor(e,t){this.version=e,this.transformResults=t}}class Ws{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ws}static exists(e){return new Ws(void 0,e)}static updateTime(e){return new Ws(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function aw(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class B1{}function gF(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new _F(n.key,Ws.none()):new ov(n.key,n.data,Ws.none());{const t=n.data,i=nr.empty();let r=new Rn(qn.comparator);for(let s of e.fields)if(!r.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?i.delete(s):i.set(s,a),r=r.add(s)}return new Bu(n.key,i,new Nr(r.toArray()),Ws.none())}}function Y7(n,e,t){n instanceof ov?function(r,s,a){const o=r.value.clone(),l=RR(r.fieldTransforms,s,a.transformResults);o.setAll(l),s.convertToFoundDocument(a.version,o).setHasCommittedMutations()}(n,e,t):n instanceof Bu?function(r,s,a){if(!aw(r.precondition,s))return void s.convertToUnknownDocument(a.version);const o=RR(r.fieldTransforms,s,a.transformResults),l=s.data;l.setAll(yF(r)),l.setAll(o),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(n,e,t):function(r,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function Vg(n,e,t,i){return n instanceof ov?function(s,a,o,l){if(!aw(s.precondition,a))return o;const u=s.value.clone(),c=PR(s.fieldTransforms,l,a);return u.setAll(c),a.convertToFoundDocument(a.version,u).setHasLocalMutations(),null}(n,e,t,i):n instanceof Bu?function(s,a,o,l){if(!aw(s.precondition,a))return o;const u=PR(s.fieldTransforms,l,a),c=a.data;return c.setAll(yF(s)),c.setAll(u),a.convertToFoundDocument(a.version,c).setHasLocalMutations(),o===null?null:o.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,e,t,i):function(s,a,o){return aw(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):o}(n,e,t)}function X7(n,e){let t=null;for(const i of n.fieldTransforms){const r=e.data.field(i.field),s=hF(i.transform,r||null);s!=null&&(t===null&&(t=nr.empty()),t.set(i.field,s))}return t||null}function $R(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(i,r){return i===void 0&&r===void 0||!(!i||!r)&&Np(i,r,(s,a)=>G7(s,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class ov extends B1{constructor(e,t,i,r=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Bu extends B1{constructor(e,t,i,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function yF(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}}),e}function RR(n,e,t){const i=new Map;xt(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let r=0;r<t.length;r++){const s=n[r],a=s.transform,o=e.data.field(s.field);i.set(s.field,W7(a,o,t[r]))}return i}function PR(n,e,t){const i=new Map;for(const r of n){const s=r.transform,a=t.data.field(r.field);i.set(r.field,H7(s,a,e))}return i}class _F extends B1{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Q7 extends B1{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J7{constructor(e,t,i,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const s=this.mutations[r];s.key.isEqual(e.key)&&Y7(s,e,i[r])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=Vg(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=Vg(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=cF();return this.mutations.forEach(r=>{const s=e.get(r.key),a=s.overlayedDocument;let o=this.applyToLocalView(a,s.mutatedFields);o=t.has(r.key)?null:o;const l=gF(a,o);l!==null&&i.set(r.key,l),a.isValidDocument()||a.convertToNoDocument(Ke.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ct())}isEqual(e){return this.batchId===e.batchId&&Np(this.mutations,e.mutations,(t,i)=>$R(t,i))&&Np(this.baseMutations,e.baseMutations,(t,i)=>$R(t,i))}}class zI{constructor(e,t,i,r){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=r}static from(e,t,i){xt(e.mutations.length===i.length,58842,{me:e.mutations.length,fe:i.length});let r=function(){return z7}();const s=e.mutations;for(let a=0;a<s.length;a++)r=r.insert(s[a].key,i[a].version);return new zI(e,t,i,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z7{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eK{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _n,ft;function tK(n){switch(n){case le.OK:return Ue(64938);case le.CANCELLED:case le.UNKNOWN:case le.DEADLINE_EXCEEDED:case le.RESOURCE_EXHAUSTED:case le.INTERNAL:case le.UNAVAILABLE:case le.UNAUTHENTICATED:return!1;case le.INVALID_ARGUMENT:case le.NOT_FOUND:case le.ALREADY_EXISTS:case le.PERMISSION_DENIED:case le.FAILED_PRECONDITION:case le.ABORTED:case le.OUT_OF_RANGE:case le.UNIMPLEMENTED:case le.DATA_LOSS:return!0;default:return Ue(15467,{code:n})}}function vF(n){if(n===void 0)return Zo("GRPC error has no .code"),le.UNKNOWN;switch(n){case _n.OK:return le.OK;case _n.CANCELLED:return le.CANCELLED;case _n.UNKNOWN:return le.UNKNOWN;case _n.DEADLINE_EXCEEDED:return le.DEADLINE_EXCEEDED;case _n.RESOURCE_EXHAUSTED:return le.RESOURCE_EXHAUSTED;case _n.INTERNAL:return le.INTERNAL;case _n.UNAVAILABLE:return le.UNAVAILABLE;case _n.UNAUTHENTICATED:return le.UNAUTHENTICATED;case _n.INVALID_ARGUMENT:return le.INVALID_ARGUMENT;case _n.NOT_FOUND:return le.NOT_FOUND;case _n.ALREADY_EXISTS:return le.ALREADY_EXISTS;case _n.PERMISSION_DENIED:return le.PERMISSION_DENIED;case _n.FAILED_PRECONDITION:return le.FAILED_PRECONDITION;case _n.ABORTED:return le.ABORTED;case _n.OUT_OF_RANGE:return le.OUT_OF_RANGE;case _n.UNIMPLEMENTED:return le.UNIMPLEMENTED;case _n.DATA_LOSS:return le.DATA_LOSS;default:return Ue(39323,{code:n})}}(ft=_n||(_n={}))[ft.OK=0]="OK",ft[ft.CANCELLED=1]="CANCELLED",ft[ft.UNKNOWN=2]="UNKNOWN",ft[ft.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ft[ft.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ft[ft.NOT_FOUND=5]="NOT_FOUND",ft[ft.ALREADY_EXISTS=6]="ALREADY_EXISTS",ft[ft.PERMISSION_DENIED=7]="PERMISSION_DENIED",ft[ft.UNAUTHENTICATED=16]="UNAUTHENTICATED",ft[ft.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ft[ft.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ft[ft.ABORTED=10]="ABORTED",ft[ft.OUT_OF_RANGE=11]="OUT_OF_RANGE",ft[ft.UNIMPLEMENTED=12]="UNIMPLEMENTED",ft[ft.INTERNAL=13]="INTERNAL",ft[ft.UNAVAILABLE=14]="UNAVAILABLE",ft[ft.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nK(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iK=new wu([4294967295,4294967295],0);function NR(n){const e=nK().encode(n),t=new R4;return t.update(e),new Uint8Array(t.digest())}function DR(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new wu([t,i],0),new wu([r,s],0)]}class VI{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new ig(`Invalid padding: ${t}`);if(i<0)throw new ig(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new ig(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new ig(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=wu.fromNumber(this.ge)}ye(e,t,i){let r=e.add(t.multiply(wu.fromNumber(i)));return r.compare(iK)===1&&(r=new wu([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=NR(e),[i,r]=DR(t);for(let s=0;s<this.hashCount;s++){const a=this.ye(i,r,s);if(!this.we(a))return!1}return!0}static create(e,t,i){const r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new VI(s,r,t);return i.forEach(o=>a.insert(o)),a}insert(e){if(this.ge===0)return;const t=NR(e),[i,r]=DR(t);for(let s=0;s<this.hashCount;s++){const a=this.ye(i,r,s);this.be(a)}}be(e){const t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}}class ig extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U1{constructor(e,t,i,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const r=new Map;return r.set(e,lv.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new U1(Ke.min(),r,new rn(ut),el(),ct())}}class lv{constructor(e,t,i,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new lv(i,t,ct(),ct(),ct())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ow{constructor(e,t,i,r){this.Se=e,this.removedTargetIds=t,this.key=i,this.De=r}}class wF{constructor(e,t){this.targetId=e,this.Ce=t}}class bF{constructor(e,t,i=Kn.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=r}}class MR{constructor(){this.ve=0,this.Fe=OR(),this.Me=Kn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=ct(),t=ct(),i=ct();return this.Fe.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:i=i.add(r);break;default:Ue(38017,{changeType:s})}}),new lv(this.Me,this.xe,e,t,i)}Ke(){this.Oe=!1,this.Fe=OR()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,xt(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class rK{constructor(e){this.Ge=e,this.ze=new Map,this.je=el(),this.He=_0(),this.Je=_0(),this.Ze=new rn(ut)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const i=this.nt(t);switch(e.state){case 0:this.rt(t)&&i.Le(e.resumeToken);break;case 1:i.We(),i.Ne||i.Ke(),i.Le(e.resumeToken);break;case 2:i.We(),i.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(i.Qe(),i.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),i.Le(e.resumeToken));break;default:Ue(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((i,r)=>{this.rt(r)&&t(r)})}st(e){const t=e.targetId,i=e.Ce.count,r=this.ot(t);if(r){const s=r.target;if($T(s))if(i===0){const a=new Oe(s.path);this.et(t,a,bi.newNoDocument(a,Ke.min()))}else xt(i===1,20013,{expectedCount:i});else{const a=this._t(t);if(a!==i){const o=this.ut(e),l=o?this.ct(o,e,a):1;if(l!==0){this.it(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,u)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:i="",padding:r=0},hashCount:s=0}=t;let a,o;try{a=Cu(i).toUint8Array()}catch(l){if(l instanceof W4)return Kd("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{o=new VI(a,r,s)}catch(l){return Kd(l instanceof ig?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return o.ge===0?null:o}ct(e,t,i){return t.Ce.count===i-this.Pt(e,t.targetId)?0:2}Pt(e,t){const i=this.Ge.getRemoteKeysForTarget(t);let r=0;return i.forEach(s=>{const a=this.Ge.ht(),o=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(o)||(this.et(t,s,null),r++)}),r}Tt(e){const t=new Map;this.ze.forEach((s,a)=>{const o=this.ot(a);if(o){if(s.current&&$T(o.target)){const l=new Oe(o.target.path);this.It(l).has(a)||this.Et(a,l)||this.et(a,l,bi.newNoDocument(l,e))}s.Be&&(t.set(a,s.ke()),s.Ke())}});let i=ct();this.Je.forEach((s,a)=>{let o=!0;a.forEachWhile(l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(o=!1,!1)}),o&&(i=i.add(s))}),this.je.forEach((s,a)=>a.setReadTime(e));const r=new U1(e,t,this.Ze,this.je,i);return this.je=el(),this.He=_0(),this.Je=_0(),this.Ze=new rn(ut),r}Ye(e,t){if(!this.rt(e))return;const i=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,i),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,i){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.qe(t,1):r.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),i&&(this.je=this.je.insert(t,i))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new MR,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new Rn(ut),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new Rn(ut),this.He=this.He.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||Ae("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new MR),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function _0(){return new rn(Oe.comparator)}function OR(){return new rn(Oe.comparator)}const sK={asc:"ASCENDING",desc:"DESCENDING"},aK={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},oK={and:"AND",or:"OR"};class lK{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function NT(n,e){return n.useProto3Json||L1(e)?e:{value:e}}function Ab(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function xF(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function uK(n,e){return Ab(n,e.toTimestamp())}function Va(n){return xt(!!n,49232),Ke.fromTimestamp(function(t){const i=Iu(t);return new zt(i.seconds,i.nanos)}(n))}function jI(n,e){return DT(n,e).canonicalString()}function DT(n,e){const t=function(r){return new Ft(["projects",r.projectId,"databases",r.database])}(n).child("documents");return e===void 0?t:t.child(e)}function EF(n){const e=Ft.fromString(n);return xt(CF(e),10190,{key:e.toString()}),e}function MT(n,e){return jI(n.databaseId,e.path)}function uE(n,e){const t=EF(e);if(t.get(1)!==n.databaseId.projectId)throw new be(le.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new be(le.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Oe(TF(t))}function AF(n,e){return jI(n.databaseId,e)}function cK(n){const e=EF(n);return e.length===4?Ft.emptyPath():TF(e)}function OT(n){return new Ft(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function TF(n){return xt(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function LR(n,e,t){return{name:MT(n,e),fields:t.value.mapValue.fields}}function dK(n,e){let t;if("targetChange"in e){e.targetChange;const i=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:Ue(39313,{state:u})}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=function(u,c){return u.useProto3Json?(xt(c===void 0||typeof c=="string",58123),Kn.fromBase64String(c||"")):(xt(c===void 0||c instanceof Buffer||c instanceof Uint8Array,16193),Kn.fromUint8Array(c||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,o=a&&function(u){const c=u.code===void 0?le.UNKNOWN:vF(u.code);return new be(c,u.message||"")}(a);t=new bF(i,r,s,o||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const r=uE(n,i.document.name),s=Va(i.document.updateTime),a=i.document.createTime?Va(i.document.createTime):Ke.min(),o=new nr({mapValue:{fields:i.document.fields}}),l=bi.newFoundDocument(r,s,a,o),u=i.targetIds||[],c=i.removedTargetIds||[];t=new ow(u,c,l.key,l)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const r=uE(n,i.document),s=i.readTime?Va(i.readTime):Ke.min(),a=bi.newNoDocument(r,s),o=i.removedTargetIds||[];t=new ow([],o,a.key,a)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const r=uE(n,i.document),s=i.removedTargetIds||[];t=new ow([],s,r,null)}else{if(!("filter"in e))return Ue(11601,{Vt:e});{e.filter;const i=e.filter;i.targetId;const{count:r=0,unchangedNames:s}=i,a=new eK(r,s),o=i.targetId;t=new wF(o,a)}}return t}function hK(n,e){let t;if(e instanceof ov)t={update:LR(n,e.key,e.value)};else if(e instanceof _F)t={delete:MT(n,e.key)};else if(e instanceof Bu)t={update:LR(n,e.key,e.data),updateMask:bK(e.fieldMask)};else{if(!(e instanceof Q7))return Ue(16599,{dt:e.type});t={verify:MT(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(s,a){const o=a.transform;if(o instanceof gy)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof yy)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof _y)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof Eb)return{fieldPath:a.field.canonicalString(),increment:o.Ae};throw Ue(20930,{transform:a.transform})}(0,i))),e.precondition.isNone||(t.currentDocument=function(r,s){return s.updateTime!==void 0?{updateTime:uK(r,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:Ue(27497)}(n,e.precondition)),t}function fK(n,e){return n&&n.length>0?(xt(e!==void 0,14353),n.map(t=>function(r,s){let a=r.updateTime?Va(r.updateTime):Va(s);return a.isEqual(Ke.min())&&(a=Va(s)),new K7(a,r.transformResults||[])}(t,e))):[]}function pK(n,e){return{documents:[AF(n,e.path)]}}function mK(n,e){const t={structuredQuery:{}},i=e.path;let r;e.collectionGroup!==null?(r=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=AF(n,r);const s=function(u){if(u.length!==0)return IF(Qs.create(u,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const a=function(u){if(u.length!==0)return u.map(c=>function(f){return{field:Rh(f.field),direction:_K(f.dir)}}(c))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const o=NT(n,e.limit);return o!==null&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ft:t,parent:r}}function gK(n){let e=cK(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let r=null;if(i>0){xt(i===1,65062);const c=t.from[0];c.allDescendants?r=c.collectionId:e=e.child(c.collectionId)}let s=[];t.where&&(s=function(h){const f=SF(h);return f instanceof Qs&&tF(f)?f.getFilters():[f]}(t.where));let a=[];t.orderBy&&(a=function(h){return h.map(f=>function(y){return new my(Ph(y.field),function(x){switch(x){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(y.direction))}(f))}(t.orderBy));let o=null;t.limit&&(o=function(h){let f;return f=typeof h=="object"?h.value:h,L1(f)?null:f}(t.limit));let l=null;t.startAt&&(l=function(h){const f=!!h.before,m=h.values||[];return new xb(m,f)}(t.startAt));let u=null;return t.endAt&&(u=function(h){const f=!h.before,m=h.values||[];return new xb(m,f)}(t.endAt)),P7(e,r,a,s,o,"F",l,u)}function yK(n,e){const t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ue(28987,{purpose:r})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function SF(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const i=Ph(t.unaryFilter.field);return wn.create(i,"==",{doubleValue:NaN});case"IS_NULL":const r=Ph(t.unaryFilter.field);return wn.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Ph(t.unaryFilter.field);return wn.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Ph(t.unaryFilter.field);return wn.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ue(61313);default:return Ue(60726)}}(n):n.fieldFilter!==void 0?function(t){return wn.create(Ph(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ue(58110);default:return Ue(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Qs.create(t.compositeFilter.filters.map(i=>SF(i)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return Ue(1026)}}(t.compositeFilter.op))}(n):Ue(30097,{filter:n})}function _K(n){return sK[n]}function vK(n){return aK[n]}function wK(n){return oK[n]}function Rh(n){return{fieldPath:n.canonicalString()}}function Ph(n){return qn.fromServerFormat(n.fieldPath)}function IF(n){return n instanceof wn?function(t){if(t.op==="=="){if(AR(t.value))return{unaryFilter:{field:Rh(t.field),op:"IS_NAN"}};if(ER(t.value))return{unaryFilter:{field:Rh(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(AR(t.value))return{unaryFilter:{field:Rh(t.field),op:"IS_NOT_NAN"}};if(ER(t.value))return{unaryFilter:{field:Rh(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Rh(t.field),op:vK(t.op),value:t.value}}}(n):n instanceof Qs?function(t){const i=t.getFilters().map(r=>IF(r));return i.length===1?i[0]:{compositeFilter:{op:wK(t.op),filters:i}}}(n):Ue(54877,{filter:n})}function bK(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function CF(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function kF(n){return!!n&&typeof n._toProto=="function"&&n._protoValueType==="ProtoValue"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uu{constructor(e,t,i,r,s=Ke.min(),a=Ke.min(),o=Kn.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=o,this.expectedCount=l}withSequenceNumber(e){return new uu(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new uu(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new uu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new uu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xK{constructor(e){this.yt=e}}function EK(n){const e=gK({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?PT(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AK{constructor(){this.Sn=new TK}addToCollectionParentIndex(e,t){return this.Sn.add(t),ce.resolve()}getCollectionParents(e,t){return ce.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return ce.resolve()}deleteFieldIndex(e,t){return ce.resolve()}deleteAllFieldIndexes(e){return ce.resolve()}createTargetIndexes(e,t){return ce.resolve()}getDocumentsMatchingTarget(e,t){return ce.resolve(null)}getIndexType(e,t){return ce.resolve(0)}getFieldIndexes(e,t){return ce.resolve([])}getNextCollectionGroupToUpdate(e){return ce.resolve(null)}getMinOffset(e,t){return ce.resolve(Su.min())}getMinOffsetFromCollectionGroup(e,t){return ce.resolve(Su.min())}updateCollectionGroup(e,t,i){return ce.resolve()}updateIndexEntries(e,t){return ce.resolve()}}class TK{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t]||new Rn(Ft.comparator),s=!r.has(i);return this.index[t]=r.add(i),s}has(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t];return r&&r.has(i)}getEntries(e){return(this.index[e]||new Rn(Ft.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FR={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},$F=41943040;class er{static withCacheSize(e){return new er(e,er.DEFAULT_COLLECTION_PERCENTILE,er.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */er.DEFAULT_COLLECTION_PERCENTILE=10,er.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,er.DEFAULT=new er($F,er.DEFAULT_COLLECTION_PERCENTILE,er.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),er.DISABLED=new er(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lp{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new Lp(0)}static ar(){return new Lp(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zR="LruGarbageCollector",SK=1048576;function VR([n,e],[t,i]){const r=ut(n,t);return r===0?ut(e,i):r}class IK{constructor(e){this.Pr=e,this.buffer=new Rn(VR),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const i=this.buffer.last();VR(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}}class CK{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){Ae(zR,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Yp(t)?Ae(zR,"Ignoring IndexedDB error during garbage collection: ",t):await Kp(t)}await this.Ar(3e5)})}}class kK{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(t===0)return ce.resolve(O1.ce);const i=new IK(t);return this.Vr.forEachTarget(e,r=>i.Er(r.sequenceNumber)).next(()=>this.Vr.mr(e,r=>i.Er(r))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.Vr.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Ae("LruGarbageCollector","Garbage collection skipped; disabled"),ce.resolve(FR)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(Ae("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),FR):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let i,r,s,a,o,l,u;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(Ae("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),r=this.params.maximumSequenceNumbersToCollect):r=h,a=Date.now(),this.nthSequenceNumber(e,r))).next(h=>(i=h,o=Date.now(),this.removeTargets(e,i,t))).next(h=>(s=h,l=Date.now(),this.removeOrphanedDocuments(e,i))).next(h=>(u=Date.now(),kh()<=lt.DEBUG&&Ae("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-c}ms
	Determined least recently used ${r} in `+(o-a)+`ms
	Removed ${s} targets in `+(l-o)+`ms
	Removed ${h} documents in `+(u-l)+`ms
Total Duration: ${u-c}ms`),ce.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:h})))}}function $K(n,e){return new kK(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RK{constructor(){this.changes=new uh(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,bi.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?ce.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PK{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NK{constructor(e,t,i,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=r}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(i=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(i!==null&&Vg(i.mutation,r,Nr.empty(),zt.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,ct()).next(()=>i))}getLocalViewOfDocuments(e,t,i=ct()){const r=Cc();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i).next(s=>{let a=ng();return s.forEach((o,l)=>{a=a.insert(o,l.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const i=Cc();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,ct()))}populateOverlays(e,t,i){const r=[];return i.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((a,o)=>{t.set(a,o)})})}computeViews(e,t,i,r){let s=el();const a=zg(),o=function(){return zg()}();return t.forEach((l,u)=>{const c=i.get(u.key);r.has(u.key)&&(c===void 0||c.mutation instanceof Bu)?s=s.insert(u.key,u):c!==void 0?(a.set(u.key,c.mutation.getFieldMask()),Vg(c.mutation,u,c.mutation.getFieldMask(),zt.now())):a.set(u.key,Nr.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((u,c)=>a.set(u,c)),t.forEach((u,c)=>o.set(u,new PK(c,a.get(u)??null))),o))}recalculateAndSaveOverlays(e,t){const i=zg();let r=new rn((a,o)=>a-o),s=ct();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const o of a)o.keys().forEach(l=>{const u=t.get(l);if(u===null)return;let c=i.get(l)||Nr.empty();c=o.applyToLocalView(u,c),i.set(l,c);const h=(r.get(o.batchId)||ct()).add(l);r=r.insert(o.batchId,h)})}).next(()=>{const a=[],o=r.getReverseIterator();for(;o.hasNext();){const l=o.getNext(),u=l.key,c=l.value,h=cF();c.forEach(f=>{if(!s.has(f)){const m=gF(t.get(f),i.get(f));m!==null&&h.set(f,m),s=s.add(f)}}),a.push(this.documentOverlayCache.saveOverlays(e,u,h))}return ce.waitFor(a)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i,r){return N7(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):sF(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,r):this.getDocumentsMatchingCollectionQuery(e,t,i,r)}getNextDocuments(e,t,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,r).next(s=>{const a=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,r-s.size):ce.resolve(Cc());let o=hy,l=s;return a.next(u=>ce.forEach(u,(c,h)=>(o<h.largestBatchId&&(o=h.largestBatchId),s.get(c)?ce.resolve():this.remoteDocumentCache.getEntry(e,c).next(f=>{l=l.insert(c,f)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,l,u,ct())).next(c=>({batchId:o,changes:uF(c)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Oe(t)).next(i=>{let r=ng();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,i,r){const s=t.collectionGroup;let a=ng();return this.indexManager.getCollectionParents(e,s).next(o=>ce.forEach(o,l=>{const u=function(h,f){return new Xp(f,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,i,r).next(c=>{c.forEach((h,f)=>{a=a.insert(h,f)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,i,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,s,r))).next(a=>{s.forEach((l,u)=>{const c=u.getKey();a.get(c)===null&&(a=a.insert(c,bi.newInvalidDocument(c)))});let o=ng();return a.forEach((l,u)=>{const c=s.get(l);c!==void 0&&Vg(c.mutation,u,Nr.empty(),zt.now()),V1(t,u)&&(o=o.insert(l,u))}),o})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DK{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return ce.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,function(r){return{id:r.id,version:r.version,createTime:Va(r.createTime)}}(t)),ce.resolve()}getNamedQuery(e,t){return ce.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,function(r){return{name:r.name,query:EK(r.bundledQuery),readTime:Va(r.readTime)}}(t)),ce.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MK{constructor(){this.overlays=new rn(Oe.comparator),this.Lr=new Map}getOverlay(e,t){return ce.resolve(this.overlays.get(t))}getOverlays(e,t){const i=Cc();return ce.forEach(t,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((r,s)=>{this.bt(e,t,s)}),ce.resolve()}removeOverlaysForBatchId(e,t,i){const r=this.Lr.get(i);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.Lr.delete(i)),ce.resolve()}getOverlaysForCollection(e,t,i){const r=Cc(),s=t.length+1,a=new Oe(t.child("")),o=this.overlays.getIteratorFrom(a);for(;o.hasNext();){const l=o.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&l.largestBatchId>i&&r.set(l.getKey(),l)}return ce.resolve(r)}getOverlaysForCollectionGroup(e,t,i,r){let s=new rn((u,c)=>u-c);const a=this.overlays.getIterator();for(;a.hasNext();){const u=a.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>i){let c=s.get(u.largestBatchId);c===null&&(c=Cc(),s=s.insert(u.largestBatchId,c)),c.set(u.getKey(),u)}}const o=Cc(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,c)=>o.set(u,c)),!(o.size()>=r)););return ce.resolve(o)}bt(e,t,i){const r=this.overlays.get(i.key);if(r!==null){const a=this.Lr.get(r.largestBatchId).delete(i.key);this.Lr.set(r.largestBatchId,a)}this.overlays=this.overlays.insert(i.key,new Z7(t,i));let s=this.Lr.get(t);s===void 0&&(s=ct(),this.Lr.set(t,s)),this.Lr.set(t,s.add(i.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OK{constructor(){this.sessionToken=Kn.EMPTY_BYTE_STRING}getSessionToken(e){return ce.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ce.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BI{constructor(){this.kr=new Rn(Hn.Kr),this.qr=new Rn(Hn.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const i=new Hn(e,t);this.kr=this.kr.add(i),this.qr=this.qr.add(i)}$r(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.Wr(new Hn(e,t))}Qr(e,t){e.forEach(i=>this.removeReference(i,t))}Gr(e){const t=new Oe(new Ft([])),i=new Hn(t,e),r=new Hn(t,e+1),s=[];return this.qr.forEachInRange([i,r],a=>{this.Wr(a),s.push(a.key)}),s}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new Oe(new Ft([])),i=new Hn(t,e),r=new Hn(t,e+1);let s=ct();return this.qr.forEachInRange([i,r],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new Hn(e,0),i=this.kr.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class Hn{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return Oe.comparator(e.key,t.key)||ut(e.Hr,t.Hr)}static Ur(e,t){return ut(e.Hr,t.Hr)||Oe.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LK{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new Rn(Hn.Kr)}checkEmpty(e){return ce.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,r){const s=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new J7(s,t,i,r);this.mutationQueue.push(a);for(const o of r)this.Jr=this.Jr.add(new Hn(o.key,s)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return ce.resolve(a)}lookupMutationBatch(e,t){return ce.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,r=this.Xr(i),s=r<0?0:r;return ce.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return ce.resolve(this.mutationQueue.length===0?PI:this.Yn-1)}getAllMutationBatches(e){return ce.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new Hn(t,0),r=new Hn(t,Number.POSITIVE_INFINITY),s=[];return this.Jr.forEachInRange([i,r],a=>{const o=this.Zr(a.Hr);s.push(o)}),ce.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new Rn(ut);return t.forEach(r=>{const s=new Hn(r,0),a=new Hn(r,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([s,a],o=>{i=i.add(o.Hr)})}),ce.resolve(this.Yr(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,r=i.length+1;let s=i;Oe.isDocumentKey(s)||(s=s.child(""));const a=new Hn(new Oe(s),0);let o=new Rn(ut);return this.Jr.forEachWhile(l=>{const u=l.key.path;return!!i.isPrefixOf(u)&&(u.length===r&&(o=o.add(l.Hr)),!0)},a),ce.resolve(this.Yr(o))}Yr(e){const t=[];return e.forEach(i=>{const r=this.Zr(i);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){xt(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let i=this.Jr;return ce.forEach(t.mutations,r=>{const s=new Hn(r.key,t.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Jr=i})}nr(e){}containsKey(e,t){const i=new Hn(t,0),r=this.Jr.firstAfterOrEqual(i);return ce.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,ce.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FK{constructor(e){this.ti=e,this.docs=function(){return new rn(Oe.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,r=this.docs.get(i),s=r?r.size:0,a=this.ti(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return ce.resolve(i?i.document.mutableCopy():bi.newInvalidDocument(t))}getEntries(e,t){let i=el();return t.forEach(r=>{const s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():bi.newInvalidDocument(r))}),ce.resolve(i)}getDocumentsMatchingQuery(e,t,i,r){let s=el();const a=t.path,o=new Oe(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(o);for(;l.hasNext();){const{key:u,value:{document:c}}=l.getNext();if(!a.isPrefixOf(u.path))break;u.path.length>a.length+1||u7(l7(c),i)<=0||(r.has(c.key)||V1(t,c))&&(s=s.insert(c.key,c.mutableCopy()))}return ce.resolve(s)}getAllFromCollectionGroup(e,t,i,r){Ue(9500)}ni(e,t){return ce.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new zK(this)}getSize(e){return ce.resolve(this.size)}}class zK extends RK{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?t.push(this.Mr.addEntry(e,r)):this.Mr.removeEntry(i)}),ce.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VK{constructor(e){this.persistence=e,this.ri=new uh(t=>MI(t),OI),this.lastRemoteSnapshotVersion=Ke.min(),this.highestTargetId=0,this.ii=0,this.si=new BI,this.targetCount=0,this.oi=Lp._r()}forEachTarget(e,t){return this.ri.forEach((i,r)=>t(r)),ce.resolve()}getLastRemoteSnapshotVersion(e){return ce.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ce.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),ce.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.ii&&(this.ii=t),ce.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new Lp(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,ce.resolve()}updateTargetData(e,t){return this.lr(t),ce.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,ce.resolve()}removeTargets(e,t,i){let r=0;const s=[];return this.ri.forEach((a,o)=>{o.sequenceNumber<=t&&i.get(o.targetId)===null&&(this.ri.delete(a),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),ce.waitFor(s).next(()=>r)}getTargetCount(e){return ce.resolve(this.targetCount)}getTargetData(e,t){const i=this.ri.get(t)||null;return ce.resolve(i)}addMatchingKeys(e,t,i){return this.si.$r(t,i),ce.resolve()}removeMatchingKeys(e,t,i){this.si.Qr(t,i);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(a=>{s.push(r.markPotentiallyOrphaned(e,a))}),ce.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),ce.resolve()}getMatchingKeysForTargetId(e,t){const i=this.si.jr(t);return ce.resolve(i)}containsKey(e,t){return ce.resolve(this.si.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RF{constructor(e,t){this._i={},this.overlays={},this.ai=new O1(0),this.ui=!1,this.ui=!0,this.ci=new OK,this.referenceDelegate=e(this),this.li=new VK(this),this.indexManager=new AK,this.remoteDocumentCache=function(r){return new FK(r)}(i=>this.referenceDelegate.hi(i)),this.serializer=new xK(t),this.Pi=new DK(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new MK,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this._i[e.toKey()];return i||(i=new LK(t,this.referenceDelegate),this._i[e.toKey()]=i),i}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,i){Ae("MemoryPersistence","Starting transaction:",e);const r=new jK(this.ai.next());return this.referenceDelegate.Ti(),i(r).next(s=>this.referenceDelegate.Ii(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Ei(e,t){return ce.or(Object.values(this._i).map(i=>()=>i.containsKey(e,t)))}}class jK extends d7{constructor(e){super(),this.currentSequenceNumber=e}}class UI{constructor(e){this.persistence=e,this.Ri=new BI,this.Ai=null}static Vi(e){return new UI(e)}get di(){if(this.Ai)return this.Ai;throw Ue(60996)}addReference(e,t,i){return this.Ri.addReference(i,t),this.di.delete(i.toString()),ce.resolve()}removeReference(e,t,i){return this.Ri.removeReference(i,t),this.di.add(i.toString()),ce.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),ce.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(r=>this.di.add(r.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(s=>this.di.add(s.toString()))}).next(()=>i.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ce.forEach(this.di,i=>{const r=Oe.fromPath(i);return this.mi(e,r).next(s=>{s||t.removeEntry(r,Ke.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(i=>{i?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return ce.or([()=>ce.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class Tb{constructor(e,t){this.persistence=e,this.fi=new uh(i=>p7(i.path),(i,r)=>i.isEqual(r)),this.garbageCollector=$K(this,t)}static Vi(e,t){return new Tb(e,t)}Ti(){}Ii(e){return ce.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(i=>t.next(r=>i+r))}pr(e){let t=0;return this.mr(e,i=>{t++}).next(()=>t)}mr(e,t){return ce.forEach(this.fi,(i,r)=>this.wr(e,i,r).next(s=>s?ce.resolve():t(r)))}removeTargets(e,t,i){return this.persistence.getTargetCache().removeTargets(e,t,i)}removeOrphanedDocuments(e,t){let i=0;const r=this.persistence.getRemoteDocumentCache(),s=r.newChangeBuffer();return r.ni(e,a=>this.wr(e,a,t).next(o=>{o||(i++,s.removeEntry(a,Ke.min()))})).next(()=>s.apply(e)).next(()=>i)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),ce.resolve()}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,i)}addReference(e,t,i){return this.fi.set(i,e.currentSequenceNumber),ce.resolve()}removeReference(e,t,i){return this.fi.set(i,e.currentSequenceNumber),ce.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),ce.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=rw(e.data.value)),t}wr(e,t,i){return ce.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.fi.get(t);return ce.resolve(r!==void 0&&r>i)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HI{constructor(e,t,i,r){this.targetId=e,this.fromCache=t,this.Ts=i,this.Is=r}static Es(e,t){let i=ct(),r=ct();for(const s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new HI(e,t.fromCache,i,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BK{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UK{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=function(){return g9()?8:h7(Ai())>0?6:4}()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,i,r){const s={result:null};return this.gs(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ps(e,t,r,i).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new BK;return this.ys(e,t,a).next(o=>{if(s.result=o,this.As)return this.ws(e,t,a,o.size)})}).next(()=>s.result)}ws(e,t,i,r){return i.documentReadCount<this.Vs?(kh()<=lt.DEBUG&&Ae("QueryEngine","SDK will not create cache indexes for query:",$h(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),ce.resolve()):(kh()<=lt.DEBUG&&Ae("QueryEngine","Query:",$h(t),"scans",i.documentReadCount,"local documents and returns",r,"documents as results."),i.documentReadCount>this.ds*r?(kh()<=lt.DEBUG&&Ae("QueryEngine","The SDK decides to create cache indexes for query:",$h(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,za(t))):ce.resolve())}gs(e,t){if(CR(t))return ce.resolve(null);let i=za(t);return this.indexManager.getIndexType(e,i).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=PT(t,null,"F"),i=za(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(s=>{const a=ct(...s);return this.fs.getDocuments(e,a).next(o=>this.indexManager.getMinOffset(e,i).next(l=>{const u=this.bs(t,o);return this.Ss(t,u,a,l.readTime)?this.gs(e,PT(t,null,"F")):this.Ds(e,u,t,l)}))})))}ps(e,t,i,r){return CR(t)||r.isEqual(Ke.min())?ce.resolve(null):this.fs.getDocuments(e,i).next(s=>{const a=this.bs(t,s);return this.Ss(t,a,i,r)?ce.resolve(null):(kh()<=lt.DEBUG&&Ae("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),$h(t)),this.Ds(e,a,t,o7(r,hy)).next(o=>o))})}bs(e,t){let i=new Rn(oF(e));return t.forEach((r,s)=>{V1(e,s)&&(i=i.add(s))}),i}Ss(e,t,i,r){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}ys(e,t,i){return kh()<=lt.DEBUG&&Ae("QueryEngine","Using full collection scan to execute query:",$h(t)),this.fs.getDocumentsMatchingQuery(e,t,Su.min(),i)}Ds(e,t,i,r){return this.fs.getDocumentsMatchingQuery(e,i,r).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WI="LocalStore",HK=3e8;class WK{constructor(e,t,i,r){this.persistence=e,this.Cs=t,this.serializer=r,this.vs=new rn(ut),this.Fs=new uh(s=>MI(s),OI),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(i)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new NK(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}function qK(n,e,t,i){return new WK(n,e,t,i)}async function PF(n,e){const t=Ye(n);return await t.persistence.runTransaction("Handle user change","readonly",i=>{let r;return t.mutationQueue.getAllMutationBatches(i).next(s=>(r=s,t.Os(e),t.mutationQueue.getAllMutationBatches(i))).next(s=>{const a=[],o=[];let l=ct();for(const u of r){a.push(u.batchId);for(const c of u.mutations)l=l.add(c.key)}for(const u of s){o.push(u.batchId);for(const c of u.mutations)l=l.add(c.key)}return t.localDocuments.getDocuments(i,l).next(u=>({Ns:u,removedBatchIds:a,addedBatchIds:o}))})})}function GK(n,e){const t=Ye(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const r=e.batch.keys(),s=t.xs.newChangeBuffer({trackRemovals:!0});return function(o,l,u,c){const h=u.batch,f=h.keys();let m=ce.resolve();return f.forEach(y=>{m=m.next(()=>c.getEntry(l,y)).next(_=>{const x=u.docVersions.get(y);xt(x!==null,48541),_.version.compareTo(x)<0&&(h.applyToRemoteDocument(_,u),_.isValidDocument()&&(_.setReadTime(u.commitVersion),c.addEntry(_)))})}),m.next(()=>o.mutationQueue.removeMutationBatch(l,h))}(t,i,e,s).next(()=>s.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(o){let l=ct();for(let u=0;u<o.mutationResults.length;++u)o.mutationResults[u].transformResults.length>0&&(l=l.add(o.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(i,r))})}function NF(n){const e=Ye(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function KK(n,e){const t=Ye(n),i=e.snapshotVersion;let r=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.xs.newChangeBuffer({trackRemovals:!0});r=t.vs;const o=[];e.targetChanges.forEach((c,h)=>{const f=r.get(h);if(!f)return;o.push(t.li.removeMatchingKeys(s,c.removedDocuments,h).next(()=>t.li.addMatchingKeys(s,c.addedDocuments,h)));let m=f.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(h)!==null?m=m.withResumeToken(Kn.EMPTY_BYTE_STRING,Ke.min()).withLastLimboFreeSnapshotVersion(Ke.min()):c.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(c.resumeToken,i)),r=r.insert(h,m),function(_,x,v){return _.resumeToken.approximateByteSize()===0||x.snapshotVersion.toMicroseconds()-_.snapshotVersion.toMicroseconds()>=HK?!0:v.addedDocuments.size+v.modifiedDocuments.size+v.removedDocuments.size>0}(f,m,c)&&o.push(t.li.updateTargetData(s,m))});let l=el(),u=ct();if(e.documentUpdates.forEach(c=>{e.resolvedLimboDocuments.has(c)&&o.push(t.persistence.referenceDelegate.updateLimboDocument(s,c))}),o.push(YK(s,a,e.documentUpdates).next(c=>{l=c.Bs,u=c.Ls})),!i.isEqual(Ke.min())){const c=t.li.getLastRemoteSnapshotVersion(s).next(h=>t.li.setTargetsMetadata(s,s.currentSequenceNumber,i));o.push(c)}return ce.waitFor(o).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,u)).next(()=>l)}).then(s=>(t.vs=r,s))}function YK(n,e,t){let i=ct(),r=ct();return t.forEach(s=>i=i.add(s)),e.getEntries(n,i).next(s=>{let a=el();return t.forEach((o,l)=>{const u=s.get(o);l.isFoundDocument()!==u.isFoundDocument()&&(r=r.add(o)),l.isNoDocument()&&l.version.isEqual(Ke.min())?(e.removeEntry(o,l.readTime),a=a.insert(o,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),a=a.insert(o,l)):Ae(WI,"Ignoring outdated watch update for ",o,". Current version:",u.version," Watch version:",l.version)}),{Bs:a,Ls:r}})}function XK(n,e){const t=Ye(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=PI),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function QK(n,e){const t=Ye(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return t.li.getTargetData(i,e).next(s=>s?(r=s,ce.resolve(r)):t.li.allocateTargetId(i).next(a=>(r=new uu(e,a,"TargetPurposeListen",i.currentSequenceNumber),t.li.addTargetData(i,r).next(()=>r))))}).then(i=>{const r=t.vs.get(i.targetId);return(r===null||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.vs=t.vs.insert(i.targetId,i),t.Fs.set(e,i.targetId)),i})}async function LT(n,e,t){const i=Ye(n),r=i.vs.get(e),s=t?"readwrite":"readwrite-primary";try{t||await i.persistence.runTransaction("Release target",s,a=>i.persistence.referenceDelegate.removeTarget(a,r))}catch(a){if(!Yp(a))throw a;Ae(WI,`Failed to update sequence numbers for target ${e}: ${a}`)}i.vs=i.vs.remove(e),i.Fs.delete(r.target)}function jR(n,e,t){const i=Ye(n);let r=Ke.min(),s=ct();return i.persistence.runTransaction("Execute query","readwrite",a=>function(l,u,c){const h=Ye(l),f=h.Fs.get(c);return f!==void 0?ce.resolve(h.vs.get(f)):h.li.getTargetData(u,c)}(i,a,za(e)).next(o=>{if(o)return r=o.lastLimboFreeSnapshotVersion,i.li.getMatchingKeysForTargetId(a,o.targetId).next(l=>{s=l})}).next(()=>i.Cs.getDocumentsMatchingQuery(a,e,t?r:Ke.min(),t?s:ct())).next(o=>(JK(i,O7(e),o),{documents:o,ks:s})))}function JK(n,e,t){let i=n.Ms.get(e)||Ke.min();t.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.Ms.set(e,i)}class BR{constructor(){this.activeTargetIds=B7()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ZK{constructor(){this.vo=new BR,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,i){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new BR,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eY{Mo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UR="ConnectivityMonitor";class HR{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){Ae(UR,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){Ae(UR,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let v0=null;function FT(){return v0===null?v0=function(){return 268435456+Math.round(2147483648*Math.random())}():v0++,"0x"+v0.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cE="RestConnection",tY={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class nY{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${i}/databases/${r}`,this.$o=this.databaseId.database===wb?`project_id=${i}`:`project_id=${i}&database_id=${r}`}Wo(e,t,i,r,s){const a=FT(),o=this.Qo(e,t.toUriEncodedString());Ae(cE,`Sending RPC '${e}' ${a}:`,o,i);const l={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(l,r,s);const{host:u}=new URL(o),c=ah(u);return this.zo(e,o,l,i,c).then(h=>(Ae(cE,`Received RPC '${e}' ${a}: `,h),h),h=>{throw Kd(cE,`RPC '${e}' ${a} failed with error: `,h,"url: ",o,"request:",i),h})}jo(e,t,i,r,s,a){return this.Wo(e,t,i,r,s)}Go(e,t,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Gp}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((r,s)=>e[s]=r),i&&i.headers.forEach((r,s)=>e[s]=r)}Qo(e,t){const i=tY[e];let r=`${this.qo}/v1/${t}:${i}`;return this.databaseInfo.apiKey&&(r=`${r}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),r}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iY{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ui="WebChannelConnection",Nm=(n,e,t)=>{n.listen(e,i=>{try{t(i)}catch(r){setTimeout(()=>{throw r},0)}})};class yf extends nY{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!yf.c_){const e=M4();Nm(e,D4.STAT_EVENT,t=>{t.stat===TT.PROXY?Ae(ui,"STAT_EVENT: detected buffering proxy"):t.stat===TT.NOPROXY&&Ae(ui,"STAT_EVENT: detected no buffering proxy")}),yf.c_=!0}}zo(e,t,i,r,s){const a=FT();return new Promise((o,l)=>{const u=new P4;u.setWithCredentials(!0),u.listenOnce(N4.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case iw.NO_ERROR:const h=u.getResponseJson();Ae(ui,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(h)),o(h);break;case iw.TIMEOUT:Ae(ui,`RPC '${e}' ${a} timed out`),l(new be(le.DEADLINE_EXCEEDED,"Request time out"));break;case iw.HTTP_ERROR:const f=u.getStatus();if(Ae(ui,`RPC '${e}' ${a} failed with status:`,f,"response text:",u.getResponseText()),f>0){let m=u.getResponseJson();Array.isArray(m)&&(m=m[0]);const y=m==null?void 0:m.error;if(y&&y.status&&y.message){const _=function(v){const w=v.toLowerCase().replace(/_/g,"-");return Object.values(le).indexOf(w)>=0?w:le.UNKNOWN}(y.status);l(new be(_,y.message))}else l(new be(le.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new be(le.UNAVAILABLE,"Connection failed."));break;default:Ue(9055,{l_:e,streamId:a,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{Ae(ui,`RPC '${e}' ${a} completed.`)}});const c=JSON.stringify(r);Ae(ui,`RPC '${e}' ${a} sending request:`,r),u.send(t,"POST",c,i,15)})}T_(e,t,i){const r=FT(),s=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Go(o.initMessageHeaders,t,i),o.encodeInitMessageHeaders=!0;const u=s.join("");Ae(ui,`Creating RPC '${e}' stream ${r}: ${u}`,o);const c=a.createWebChannel(u,o);this.I_(c);let h=!1,f=!1;const m=new iY({Ho:y=>{f?Ae(ui,`Not sending because RPC '${e}' stream ${r} is closed:`,y):(h||(Ae(ui,`Opening RPC '${e}' stream ${r} transport.`),c.open(),h=!0),Ae(ui,`RPC '${e}' stream ${r} sending:`,y),c.send(y))},Jo:()=>c.close()});return Nm(c,tg.EventType.OPEN,()=>{f||(Ae(ui,`RPC '${e}' stream ${r} transport opened.`),m.i_())}),Nm(c,tg.EventType.CLOSE,()=>{f||(f=!0,Ae(ui,`RPC '${e}' stream ${r} transport closed`),m.o_(),this.E_(c))}),Nm(c,tg.EventType.ERROR,y=>{f||(f=!0,Kd(ui,`RPC '${e}' stream ${r} transport errored. Name:`,y.name,"Message:",y.message),m.o_(new be(le.UNAVAILABLE,"The operation could not be completed")))}),Nm(c,tg.EventType.MESSAGE,y=>{var _;if(!f){const x=y.data[0];xt(!!x,16349);const v=x,w=(v==null?void 0:v.error)||((_=v[0])==null?void 0:_.error);if(w){Ae(ui,`RPC '${e}' stream ${r} received error:`,w);const E=w.status;let k=function(I){const C=_n[I];if(C!==void 0)return vF(C)}(E),$=w.message;k===void 0&&(k=le.INTERNAL,$="Unknown error status: "+E+" with message "+w.message),f=!0,m.o_(new be(k,$)),c.close()}else Ae(ui,`RPC '${e}' stream ${r} received:`,x),m.__(x)}}),yf.u_(),setTimeout(()=>{m.s_()},0),m}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,i){super.Go(e,t,i),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return O4()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rY(n){return new yf(n)}function dE(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H1(n){return new lK(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */yf.c_=!1;class DF{constructor(e,t,i=1e3,r=1.5,s=6e4){this.Ci=e,this.timerId=t,this.R_=i,this.A_=r,this.V_=s,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),i=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-i);r>0&&Ae("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WR="PersistentStream";class MF{constructor(e,t,i,r,s,a,o,l){this.Ci=e,this.b_=i,this.S_=r,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=o,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new DF(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===le.RESOURCE_EXHAUSTED?(Zo(t.toString()),Zo("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===le.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.D_===t&&this.G_(i,r)},i=>{e(()=>{const r=new be(le.UNKNOWN,"Fetching auth token failed: "+i.message);return this.z_(r)})})}G_(e,t){const i=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{i(()=>this.listener.Zo())}),this.stream.Yo(()=>{i(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(r=>{i(()=>this.z_(r))}),this.stream.onMessage(r=>{i(()=>++this.F_==1?this.H_(r):this.onNext(r))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return Ae(WR,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(Ae(WR,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class sY extends MF{constructor(e,t,i,r,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,r,a),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=dK(this.serializer,e),i=function(s){if(!("targetChange"in s))return Ke.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?Ke.min():a.readTime?Va(a.readTime):Ke.min()}(e);return this.listener.J_(t,i)}Z_(e){const t={};t.database=OT(this.serializer),t.addTarget=function(s,a){let o;const l=a.target;if(o=$T(l)?{documents:pK(s,l)}:{query:mK(s,l).ft},o.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){o.resumeToken=xF(s,a.resumeToken);const u=NT(s,a.expectedCount);u!==null&&(o.expectedCount=u)}else if(a.snapshotVersion.compareTo(Ke.min())>0){o.readTime=Ab(s,a.snapshotVersion.toTimestamp());const u=NT(s,a.expectedCount);u!==null&&(o.expectedCount=u)}return o}(this.serializer,e);const i=yK(this.serializer,e);i&&(t.labels=i),this.K_(t)}X_(e){const t={};t.database=OT(this.serializer),t.removeTarget=e,this.K_(t)}}class aY extends MF{constructor(e,t,i,r,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,r,a),this.serializer=s}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return xt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,xt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){xt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=fK(e.writeResults,e.commitTime),i=Va(e.commitTime);return this.listener.na(i,t)}ra(){const e={};e.database=OT(this.serializer),this.K_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(i=>hK(this.serializer,i))};this.K_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oY{}class lY extends oY{constructor(e,t,i,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new be(le.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,i,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Wo(e,DT(t,i),r,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===le.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new be(le.UNKNOWN,s.toString())})}jo(e,t,i,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.jo(e,DT(t,i),r,a,o,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===le.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new be(le.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}function uY(n,e,t,i){return new lY(n,e,t,i)}class cY{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Zo(t),this.aa=!1):Ae("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yd="RemoteStore";class dY{constructor(e,t,i,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=s,this.Aa.Mo(a=>{i.enqueueAndForget(async()=>{ch(this)&&(Ae(Yd,"Restarting streams for network reachability change."),await async function(l){const u=Ye(l);u.Ea.add(4),await uv(u),u.Va.set("Unknown"),u.Ea.delete(4),await W1(u)}(this))})}),this.Va=new cY(i,r)}}async function W1(n){if(ch(n))for(const e of n.Ra)await e(!0)}async function uv(n){for(const e of n.Ra)await e(!1)}function OF(n,e){const t=Ye(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),YI(t)?KI(t):Qp(t).O_()&&GI(t,e))}function qI(n,e){const t=Ye(n),i=Qp(t);t.Ia.delete(e),i.O_()&&LF(t,e),t.Ia.size===0&&(i.O_()?i.L_():ch(t)&&t.Va.set("Unknown"))}function GI(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ke.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Qp(n).Z_(e)}function LF(n,e){n.da.$e(e),Qp(n).X_(e)}function KI(n){n.da=new rK({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Qp(n).start(),n.Va.ua()}function YI(n){return ch(n)&&!Qp(n).x_()&&n.Ia.size>0}function ch(n){return Ye(n).Ea.size===0}function FF(n){n.da=void 0}async function hY(n){n.Va.set("Online")}async function fY(n){n.Ia.forEach((e,t)=>{GI(n,e)})}async function pY(n,e){FF(n),YI(n)?(n.Va.ha(e),KI(n)):n.Va.set("Unknown")}async function mY(n,e,t){if(n.Va.set("Online"),e instanceof bF&&e.state===2&&e.cause)try{await async function(r,s){const a=s.cause;for(const o of s.targetIds)r.Ia.has(o)&&(await r.remoteSyncer.rejectListen(o,a),r.Ia.delete(o),r.da.removeTarget(o))}(n,e)}catch(i){Ae(Yd,"Failed to remove targets %s: %s ",e.targetIds.join(","),i),await Sb(n,i)}else if(e instanceof ow?n.da.Xe(e):e instanceof wF?n.da.st(e):n.da.tt(e),!t.isEqual(Ke.min()))try{const i=await NF(n.localStore);t.compareTo(i)>=0&&await function(s,a){const o=s.da.Tt(a);return o.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const c=s.Ia.get(u);c&&s.Ia.set(u,c.withResumeToken(l.resumeToken,a))}}),o.targetMismatches.forEach((l,u)=>{const c=s.Ia.get(l);if(!c)return;s.Ia.set(l,c.withResumeToken(Kn.EMPTY_BYTE_STRING,c.snapshotVersion)),LF(s,l);const h=new uu(c.target,l,u,c.sequenceNumber);GI(s,h)}),s.remoteSyncer.applyRemoteEvent(o)}(n,t)}catch(i){Ae(Yd,"Failed to raise snapshot:",i),await Sb(n,i)}}async function Sb(n,e,t){if(!Yp(e))throw e;n.Ea.add(1),await uv(n),n.Va.set("Offline"),t||(t=()=>NF(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Ae(Yd,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await W1(n)})}function zF(n,e){return e().catch(t=>Sb(n,t,e))}async function q1(n){const e=Ye(n),t=$u(e);let i=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:PI;for(;gY(e);)try{const r=await XK(e.localStore,i);if(r===null){e.Ta.length===0&&t.L_();break}i=r.batchId,yY(e,r)}catch(r){await Sb(e,r)}VF(e)&&jF(e)}function gY(n){return ch(n)&&n.Ta.length<10}function yY(n,e){n.Ta.push(e);const t=$u(n);t.O_()&&t.Y_&&t.ea(e.mutations)}function VF(n){return ch(n)&&!$u(n).x_()&&n.Ta.length>0}function jF(n){$u(n).start()}async function _Y(n){$u(n).ra()}async function vY(n){const e=$u(n);for(const t of n.Ta)e.ea(t.mutations)}async function wY(n,e,t){const i=n.Ta.shift(),r=zI.from(i,e,t);await zF(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),await q1(n)}async function bY(n,e){e&&$u(n).Y_&&await async function(i,r){if(function(a){return tK(a)&&a!==le.ABORTED}(r.code)){const s=i.Ta.shift();$u(i).B_(),await zF(i,()=>i.remoteSyncer.rejectFailedWrite(s.batchId,r)),await q1(i)}}(n,e),VF(n)&&jF(n)}async function qR(n,e){const t=Ye(n);t.asyncQueue.verifyOperationInProgress(),Ae(Yd,"RemoteStore received new credentials");const i=ch(t);t.Ea.add(3),await uv(t),i&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await W1(t)}async function xY(n,e){const t=Ye(n);e?(t.Ea.delete(2),await W1(t)):e||(t.Ea.add(2),await uv(t),t.Va.set("Unknown"))}function Qp(n){return n.ma||(n.ma=function(t,i,r){const s=Ye(t);return s.sa(),new sY(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Zo:hY.bind(null,n),Yo:fY.bind(null,n),t_:pY.bind(null,n),J_:mY.bind(null,n)}),n.Ra.push(async e=>{e?(n.ma.B_(),YI(n)?KI(n):n.Va.set("Unknown")):(await n.ma.stop(),FF(n))})),n.ma}function $u(n){return n.fa||(n.fa=function(t,i,r){const s=Ye(t);return s.sa(),new aY(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),Yo:_Y.bind(null,n),t_:bY.bind(null,n),ta:vY.bind(null,n),na:wY.bind(null,n)}),n.Ra.push(async e=>{e?(n.fa.B_(),await q1(n)):(await n.fa.stop(),n.Ta.length>0&&(Ae(Yd,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XI{constructor(e,t,i,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new Uo,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,r,s){const a=Date.now()+i,o=new XI(e,t,a,r,s);return o.start(i),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new be(le.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function QI(n,e){if(Zo("AsyncQueue",`${e}: ${n}`),Yp(n))return new be(le.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _f{static emptySet(e){return new _f(e.comparator)}constructor(e){this.comparator=e?(t,i)=>e(t,i)||Oe.comparator(t.key,i.key):(t,i)=>Oe.comparator(t.key,i.key),this.keyedMap=ng(),this.sortedSet=new rn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof _f)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const i=new _f;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GR{constructor(){this.ga=new rn(Oe.comparator)}track(e){const t=e.doc.key,i=this.ga.get(t);i?e.type!==0&&i.type===3?this.ga=this.ga.insert(t,e):e.type===3&&i.type!==1?this.ga=this.ga.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.ga=this.ga.remove(t):e.type===1&&i.type===2?this.ga=this.ga.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Ue(63341,{Vt:e,pa:i}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,i)=>{e.push(i)}),e}}class Fp{constructor(e,t,i,r,s,a,o,l,u){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=o,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,i,r,s){const a=[];return t.forEach(o=>{a.push({type:0,doc:o})}),new Fp(e,t,_f.emptySet(t),a,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&z1(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==i[r].type||!t[r].doc.isEqual(i[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EY{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class AY{constructor(){this.queries=KR(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,i){const r=Ye(t),s=r.queries;r.queries=KR(),s.forEach((a,o)=>{for(const l of o.ba)l.onError(i)})})(this,new be(le.ABORTED,"Firestore shutting down"))}}function KR(){return new uh(n=>aF(n),z1)}async function BF(n,e){const t=Ye(n);let i=3;const r=e.query;let s=t.queries.get(r);s?!s.Sa()&&e.Da()&&(i=2):(s=new EY,i=e.Da()?0:1);try{switch(i){case 0:s.wa=await t.onListen(r,!0);break;case 1:s.wa=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(a){const o=QI(a,`Initialization of query '${$h(e.query)}' failed`);return void e.onError(o)}t.queries.set(r,s),s.ba.push(e),e.va(t.onlineState),s.wa&&e.Fa(s.wa)&&JI(t)}async function UF(n,e){const t=Ye(n),i=e.query;let r=3;const s=t.queries.get(i);if(s){const a=s.ba.indexOf(e);a>=0&&(s.ba.splice(a,1),s.ba.length===0?r=e.Da()?0:1:!s.Sa()&&e.Da()&&(r=2))}switch(r){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}}function TY(n,e){const t=Ye(n);let i=!1;for(const r of e){const s=r.query,a=t.queries.get(s);if(a){for(const o of a.ba)o.Fa(r)&&(i=!0);a.wa=r}}i&&JI(t)}function SY(n,e,t){const i=Ye(n),r=i.queries.get(e);if(r)for(const s of r.ba)s.onError(t);i.queries.delete(e)}function JI(n){n.Ca.forEach(e=>{e.next()})}var zT,YR;(YR=zT||(zT={})).Ma="default",YR.Cache="cache";class HF{constructor(e,t,i){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=i||{}}Fa(e){if(!this.options.includeMetadataChanges){const i=[];for(const r of e.docChanges)r.type!==3&&i.push(r);e=new Fp(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const i=t!=="Offline";return(!this.options.Ka||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Fp.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==zT.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WF{constructor(e){this.key=e}}class qF{constructor(e){this.key=e}}class IY{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=ct(),this.mutatedKeys=ct(),this.eu=oF(e),this.tu=new _f(this.eu)}get nu(){return this.Za}ru(e,t){const i=t?t.iu:new GR,r=t?t.tu:this.tu;let s=t?t.mutatedKeys:this.mutatedKeys,a=r,o=!1;const l=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,u=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((c,h)=>{const f=r.get(c),m=V1(this.query,h)?h:null,y=!!f&&this.mutatedKeys.has(f.key),_=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations);let x=!1;f&&m?f.data.isEqual(m.data)?y!==_&&(i.track({type:3,doc:m}),x=!0):this.su(f,m)||(i.track({type:2,doc:m}),x=!0,(l&&this.eu(m,l)>0||u&&this.eu(m,u)<0)&&(o=!0)):!f&&m?(i.track({type:0,doc:m}),x=!0):f&&!m&&(i.track({type:1,doc:f}),x=!0,(l||u)&&(o=!0)),x&&(m?(a=a.add(m),s=_?s.add(c):s.delete(c)):(a=a.delete(c),s=s.delete(c)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const c=this.query.limitType==="F"?a.last():a.first();a=a.delete(c.key),s=s.delete(c.key),i.track({type:1,doc:c})}return{tu:a,iu:i,Ss:o,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,r){const s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort((c,h)=>function(m,y){const _=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ue(20277,{Vt:x})}};return _(m)-_(y)}(c.type,h.type)||this.eu(c.doc,h.doc)),this.ou(i),r=r??!1;const o=t&&!r?this._u():[],l=this.Ya.size===0&&this.current&&!r?1:0,u=l!==this.Xa;return this.Xa=l,a.length!==0||u?{snapshot:new Fp(this.query,e.tu,s,a,e.mutatedKeys,l===0,u,!1,!!i&&i.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new GR,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Za=this.Za.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Za=this.Za.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=ct(),this.tu.forEach(i=>{this.uu(i.key)&&(this.Ya=this.Ya.add(i.key))});const t=[];return e.forEach(i=>{this.Ya.has(i)||t.push(new qF(i))}),this.Ya.forEach(i=>{e.has(i)||t.push(new WF(i))}),t}cu(e){this.Za=e.ks,this.Ya=ct();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Fp.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const ZI="SyncEngine";class CY{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class kY{constructor(e){this.key=e,this.hu=!1}}class $Y{constructor(e,t,i,r,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new uh(o=>aF(o),z1),this.Iu=new Map,this.Eu=new Set,this.Ru=new rn(Oe.comparator),this.Au=new Map,this.Vu=new BI,this.du={},this.mu=new Map,this.fu=Lp.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function RY(n,e,t=!0){const i=JF(n);let r;const s=i.Tu.get(e);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.lu()):r=await GF(i,e,t,!0),r}async function PY(n,e){const t=JF(n);await GF(t,e,!0,!1)}async function GF(n,e,t,i){const r=await QK(n.localStore,za(e)),s=r.targetId,a=n.sharedClientState.addLocalQueryTarget(s,t);let o;return i&&(o=await NY(n,e,s,a==="current",r.resumeToken)),n.isPrimaryClient&&t&&OF(n.remoteStore,r),o}async function NY(n,e,t,i,r){n.pu=(h,f,m)=>async function(_,x,v,w){let E=x.view.ru(v);E.Ss&&(E=await jR(_.localStore,x.query,!1).then(({documents:I})=>x.view.ru(I,E)));const k=w&&w.targetChanges.get(x.targetId),$=w&&w.targetMismatches.get(x.targetId)!=null,L=x.view.applyChanges(E,_.isPrimaryClient,k,$);return QR(_,x.targetId,L.au),L.snapshot}(n,h,f,m);const s=await jR(n.localStore,e,!0),a=new IY(e,s.ks),o=a.ru(s.documents),l=lv.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",r),u=a.applyChanges(o,n.isPrimaryClient,l);QR(n,t,u.au);const c=new CY(e,t,a);return n.Tu.set(e,c),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),u.snapshot}async function DY(n,e,t){const i=Ye(n),r=i.Tu.get(e),s=i.Iu.get(r.targetId);if(s.length>1)return i.Iu.set(r.targetId,s.filter(a=>!z1(a,e))),void i.Tu.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(r.targetId),i.sharedClientState.isActiveQueryTarget(r.targetId)||await LT(i.localStore,r.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(r.targetId),t&&qI(i.remoteStore,r.targetId),VT(i,r.targetId)}).catch(Kp)):(VT(i,r.targetId),await LT(i.localStore,r.targetId,!0))}async function MY(n,e){const t=Ye(n),i=t.Tu.get(e),r=t.Iu.get(i.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),qI(t.remoteStore,i.targetId))}async function OY(n,e,t){const i=UY(n);try{const r=await function(a,o){const l=Ye(a),u=zt.now(),c=o.reduce((m,y)=>m.add(y.key),ct());let h,f;return l.persistence.runTransaction("Locally write mutations","readwrite",m=>{let y=el(),_=ct();return l.xs.getEntries(m,c).next(x=>{y=x,y.forEach((v,w)=>{w.isValidDocument()||(_=_.add(v))})}).next(()=>l.localDocuments.getOverlayedDocuments(m,y)).next(x=>{h=x;const v=[];for(const w of o){const E=X7(w,h.get(w.key).overlayedDocument);E!=null&&v.push(new Bu(w.key,E,J4(E.value.mapValue),Ws.exists(!0)))}return l.mutationQueue.addMutationBatch(m,u,v,o)}).next(x=>{f=x;const v=x.applyToLocalDocumentSet(h,_);return l.documentOverlayCache.saveOverlays(m,x.batchId,v)})}).then(()=>({batchId:f.batchId,changes:uF(h)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(r.batchId),function(a,o,l){let u=a.du[a.currentUser.toKey()];u||(u=new rn(ut)),u=u.insert(o,l),a.du[a.currentUser.toKey()]=u}(i,r.batchId,t),await cv(i,r.changes),await q1(i.remoteStore)}catch(r){const s=QI(r,"Failed to persist write");t.reject(s)}}async function KF(n,e){const t=Ye(n);try{const i=await KK(t.localStore,e);e.targetChanges.forEach((r,s)=>{const a=t.Au.get(s);a&&(xt(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?a.hu=!0:r.modifiedDocuments.size>0?xt(a.hu,14607):r.removedDocuments.size>0&&(xt(a.hu,42227),a.hu=!1))}),await cv(t,i,e)}catch(i){await Kp(i)}}function XR(n,e,t){const i=Ye(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const r=[];i.Tu.forEach((s,a)=>{const o=a.view.va(e);o.snapshot&&r.push(o.snapshot)}),function(a,o){const l=Ye(a);l.onlineState=o;let u=!1;l.queries.forEach((c,h)=>{for(const f of h.ba)f.va(o)&&(u=!0)}),u&&JI(l)}(i.eventManager,e),r.length&&i.Pu.J_(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function LY(n,e,t){const i=Ye(n);i.sharedClientState.updateQueryState(e,"rejected",t);const r=i.Au.get(e),s=r&&r.key;if(s){let a=new rn(Oe.comparator);a=a.insert(s,bi.newNoDocument(s,Ke.min()));const o=ct().add(s),l=new U1(Ke.min(),new Map,new rn(ut),a,o);await KF(i,l),i.Ru=i.Ru.remove(s),i.Au.delete(e),eC(i)}else await LT(i.localStore,e,!1).then(()=>VT(i,e,t)).catch(Kp)}async function FY(n,e){const t=Ye(n),i=e.batch.batchId;try{const r=await GK(t.localStore,e);XF(t,i,null),YF(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await cv(t,r)}catch(r){await Kp(r)}}async function zY(n,e,t){const i=Ye(n);try{const r=await function(a,o){const l=Ye(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let c;return l.mutationQueue.lookupMutationBatch(u,o).next(h=>(xt(h!==null,37113),c=h.keys(),l.mutationQueue.removeMutationBatch(u,h))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,c,o)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,c)).next(()=>l.localDocuments.getDocuments(u,c))})}(i.localStore,e);XF(i,e,t),YF(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await cv(i,r)}catch(r){await Kp(r)}}function YF(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function XF(n,e,t){const i=Ye(n);let r=i.du[i.currentUser.toKey()];if(r){const s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),i.du[i.currentUser.toKey()]=r}}function VT(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.Iu.get(e))n.Tu.delete(i),t&&n.Pu.yu(i,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach(i=>{n.Vu.containsKey(i)||QF(n,i)})}function QF(n,e){n.Eu.delete(e.path.canonicalString());const t=n.Ru.get(e);t!==null&&(qI(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),eC(n))}function QR(n,e,t){for(const i of t)i instanceof WF?(n.Vu.addReference(i.key,e),VY(n,i)):i instanceof qF?(Ae(ZI,"Document no longer in limbo: "+i.key),n.Vu.removeReference(i.key,e),n.Vu.containsKey(i.key)||QF(n,i.key)):Ue(19791,{wu:i})}function VY(n,e){const t=e.key,i=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(i)||(Ae(ZI,"New document in limbo: "+t),n.Eu.add(i),eC(n))}function eC(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new Oe(Ft.fromString(e)),i=n.fu.next();n.Au.set(i,new kY(t)),n.Ru=n.Ru.insert(t,i),OF(n.remoteStore,new uu(za(LI(t.path)),i,"TargetPurposeLimboResolution",O1.ce))}}async function cv(n,e,t){const i=Ye(n),r=[],s=[],a=[];i.Tu.isEmpty()||(i.Tu.forEach((o,l)=>{a.push(i.pu(l,e,t).then(u=>{var c;if((u||t)&&i.isPrimaryClient){const h=u?!u.fromCache:(c=t==null?void 0:t.targetChanges.get(l.targetId))==null?void 0:c.current;i.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(u){r.push(u);const h=HI.Es(l.targetId,u);s.push(h)}}))}),await Promise.all(a),i.Pu.J_(r),await async function(l,u){const c=Ye(l);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>ce.forEach(u,f=>ce.forEach(f.Ts,m=>c.persistence.referenceDelegate.addReference(h,f.targetId,m)).next(()=>ce.forEach(f.Is,m=>c.persistence.referenceDelegate.removeReference(h,f.targetId,m)))))}catch(h){if(!Yp(h))throw h;Ae(WI,"Failed to update sequence numbers: "+h)}for(const h of u){const f=h.targetId;if(!h.fromCache){const m=c.vs.get(f),y=m.snapshotVersion,_=m.withLastLimboFreeSnapshotVersion(y);c.vs=c.vs.insert(f,_)}}}(i.localStore,s))}async function jY(n,e){const t=Ye(n);if(!t.currentUser.isEqual(e)){Ae(ZI,"User change. New user:",e.toKey());const i=await PF(t.localStore,e);t.currentUser=e,function(s,a){s.mu.forEach(o=>{o.forEach(l=>{l.reject(new be(le.CANCELLED,a))})}),s.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await cv(t,i.Ns)}}function BY(n,e){const t=Ye(n),i=t.Au.get(e);if(i&&i.hu)return ct().add(i.key);{let r=ct();const s=t.Iu.get(e);if(!s)return r;for(const a of s){const o=t.Tu.get(a);r=r.unionWith(o.view.nu)}return r}}function JF(n){const e=Ye(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=KF.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=BY.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=LY.bind(null,e),e.Pu.J_=TY.bind(null,e.eventManager),e.Pu.yu=SY.bind(null,e.eventManager),e}function UY(n){const e=Ye(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=FY.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=zY.bind(null,e),e}class Ib{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=H1(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return qK(this.persistence,new UK,e.initialUser,this.serializer)}Cu(e){return new RF(UI.Vi,this.serializer)}Du(e){return new ZK}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ib.provider={build:()=>new Ib};class HY extends Ib{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){xt(this.persistence.referenceDelegate instanceof Tb,46915);const i=this.persistence.referenceDelegate.garbageCollector;return new CK(i,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?er.withCacheSize(this.cacheSizeBytes):er.DEFAULT;return new RF(i=>Tb.Vi(i,t),this.serializer)}}class jT{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>XR(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=jY.bind(null,this.syncEngine),await xY(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new AY}()}createDatastore(e){const t=H1(e.databaseInfo.databaseId),i=rY(e.databaseInfo);return uY(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return function(i,r,s,a,o){return new dY(i,r,s,a,o)}(this.localStore,this.datastore,e.asyncQueue,t=>XR(this.syncEngine,t,0),function(){return HR.v()?new HR:new eY}())}createSyncEngine(e,t){return function(r,s,a,o,l,u,c){const h=new $Y(r,s,a,o,l,u);return c&&(h.gu=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(r){const s=Ye(r);Ae(Yd,"RemoteStore shutting down."),s.Ea.add(5),await uv(s),s.Aa.shutdown(),s.Va.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}jT.provider={build:()=>new jT};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZF{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Zo("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ru="FirestoreClient";class WY{constructor(e,t,i,r,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this._databaseInfo=r,this.user=_i.UNAUTHENTICATED,this.clientId=D1.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(i,async a=>{Ae(Ru,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(i,a=>(Ae(Ru,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Uo;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=QI(t,"Failed to shutdown persistence");e.reject(i)}}),e.promise}}async function hE(n,e){n.asyncQueue.verifyOperationInProgress(),Ae(Ru,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(async r=>{i.isEqual(r)||(await PF(e.localStore,r),i=r)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function JR(n,e){n.asyncQueue.verifyOperationInProgress();const t=await qY(n);Ae(Ru,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(i=>qR(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,r)=>qR(e.remoteStore,r)),n._onlineComponents=e}async function qY(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Ae(Ru,"Using user provided OfflineComponentProvider");try{await hE(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(r){return r.name==="FirebaseError"?r.code===le.FAILED_PRECONDITION||r.code===le.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(t))throw t;Kd("Error using user provided cache. Falling back to memory cache: "+t),await hE(n,new Ib)}}else Ae(Ru,"Using default OfflineComponentProvider"),await hE(n,new HY(void 0));return n._offlineComponents}async function ez(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Ae(Ru,"Using user provided OnlineComponentProvider"),await JR(n,n._uninitializedComponentsProvider._online)):(Ae(Ru,"Using default OnlineComponentProvider"),await JR(n,new jT))),n._onlineComponents}function GY(n){return ez(n).then(e=>e.syncEngine)}async function tz(n){const e=await ez(n),t=e.eventManager;return t.onListen=RY.bind(null,e.syncEngine),t.onUnlisten=DY.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=PY.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=MY.bind(null,e.syncEngine),t}function KY(n,e,t={}){const i=new Uo;return n.asyncQueue.enqueueAndForget(async()=>function(s,a,o,l,u){const c=new ZF({next:f=>{c.Nu(),a.enqueueAndForget(()=>UF(s,h));const m=f.docs.has(o);!m&&f.fromCache?u.reject(new be(le.UNAVAILABLE,"Failed to get document because the client is offline.")):m&&f.fromCache&&l&&l.source==="server"?u.reject(new be(le.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(f)},error:f=>u.reject(f)}),h=new HF(LI(o.path),c,{includeMetadataChanges:!0,Ka:!0});return BF(s,h)}(await tz(n),n.asyncQueue,e,t,i)),i.promise}function YY(n,e,t={}){const i=new Uo;return n.asyncQueue.enqueueAndForget(async()=>function(s,a,o,l,u){const c=new ZF({next:f=>{c.Nu(),a.enqueueAndForget(()=>UF(s,h)),f.fromCache&&l.source==="server"?u.reject(new be(le.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(f)},error:f=>u.reject(f)}),h=new HF(o,c,{includeMetadataChanges:!0,Ka:!0});return BF(s,h)}(await tz(n),n.asyncQueue,e,t,i)),i.promise}function XY(n,e){const t=new Uo;return n.asyncQueue.enqueueAndForget(async()=>OY(await GY(n),e,t)),t.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nz(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QY="ComponentProvider",ZR=new Map;function JY(n,e,t,i,r){return new y7(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,nz(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator,i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iz="firestore.googleapis.com",eP=!0;class tP{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new be(le.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=iz,this.ssl=eP}else this.host=e.host,this.ssl=e.ssl??eP;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=$F;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<SK)throw new be(le.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}j4("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=nz(e.experimentalLongPollingOptions??{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new be(le.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new be(le.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new be(le.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(i,r){return i.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class G1{constructor(e,t,i,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new tP({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new be(le.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new be(le.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new tP(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new z4;switch(i.type){case"firstParty":return new t7(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new be(le.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const i=ZR.get(t);i&&(Ae(QY,"Removing Datastore"),ZR.delete(t),i.terminate())}(this),Promise.resolve()}}function rz(n,e,t,i={}){var u;n=Xs(n,G1);const r=ah(e),s=n._getSettings(),a={...s,emulatorOptions:n._getEmulatorOptions()},o=`${e}:${t}`;r&&(_I(`https://${o}`),vI("Firestore",!0)),s.host!==iz&&s.host!==o&&Kd("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...s,host:o,ssl:r,emulatorOptions:i};if(!Ud(l,a)&&(n._setSettings(l),i.mockUserToken)){let c,h;if(typeof i.mockUserToken=="string")c=i.mockUserToken,h=_i.MOCK_USER;else{c=WL(i.mockUserToken,(u=n._app)==null?void 0:u.options.projectId);const f=i.mockUserToken.sub||i.mockUserToken.user_id;if(!f)throw new be(le.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new _i(f)}n._authCredentials=new JG(new F4(c,h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uu{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new Uu(this.firestore,e,this._query)}}class ln{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ho(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ln(this.firestore,e,this._key)}toJSON(){return{type:ln._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,i){if(av(t,ln._jsonSchema))return new ln(e,i||null,new Oe(Ft.fromString(t.referencePath)))}}ln._jsonSchemaVersion="firestore/documentReference/1.0",ln._jsonSchema={type:xn("string",ln._jsonSchemaVersion),referencePath:xn("string")};class Ho extends Uu{constructor(e,t,i){super(e,t,LI(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ln(this.firestore,null,new Oe(e))}withConverter(e){return new Ho(this.firestore,e,this._path)}}function gc(n,e,...t){if(n=Nn(n),V4("collection","path",e),n instanceof G1){const i=Ft.fromString(e,...t);return pR(i),new Ho(n,null,i)}{if(!(n instanceof ln||n instanceof Ho))throw new be(le.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(Ft.fromString(e,...t));return pR(i),new Ho(n.firestore,null,i)}}function ef(n,e,...t){if(n=Nn(n),arguments.length===1&&(e=D1.newId()),V4("doc","path",e),n instanceof G1){const i=Ft.fromString(e,...t);return fR(i),new ln(n,null,new Oe(i))}{if(!(n instanceof ln||n instanceof Ho))throw new be(le.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(Ft.fromString(e,...t));return fR(i),new ln(n.firestore,n instanceof Ho?n.converter:null,new Oe(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nP="AsyncQueue";class iP{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new DF(this,"async_queue_retry"),this._c=()=>{const i=dE();i&&Ae(nP,"Visibility state changed to "+i.visibilityState),this.M_.w_()},this.ac=e;const t=dE();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=dE();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new Uo;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!Yp(e))throw e;Ae(nP,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(i=>{throw this.nc=i,this.rc=!1,Zo("INTERNAL UNHANDLED ERROR: ",rP(i)),i}).then(i=>(this.rc=!1,i))));return this.ac=t,t}enqueueAfterDelay(e,t,i){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=XI.createAndSchedule(this,e,t,i,s=>this.hc(s));return this.tc.push(r),r}uc(){this.nc&&Ue(47125,{Pc:rP(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function rP(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class dh extends G1{constructor(e,t,i,r){super(e,t,i,r),this.type="firestore",this._queue=new iP,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new iP(e),this._firestoreClient=void 0,await e}}}function sz(n,e){const t=typeof n=="object"?n:xI(),i=typeof n=="string"?n:wb,r=$1(t,"firestore").getImmediate({identifier:i});if(!r._initialized){const s=BL("firestore");s&&rz(r,...s)}return r}function K1(n){if(n._terminated)throw new be(le.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||ZY(n),n._firestoreClient}function ZY(n){var i,r,s,a;const e=n._freezeSettings(),t=JY(n._databaseId,((i=n._app)==null?void 0:i.options.appId)||"",n._persistenceKey,(r=n._app)==null?void 0:r.options.apiKey,e);n._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((a=e.localCache)!=null&&a._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new WY(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(l){const u=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(u),_online:u}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $r{constructor(e){this._byteString=e}static fromBase64String(e){try{return new $r(Kn.fromBase64String(e))}catch(t){throw new be(le.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new $r(Kn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:$r._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(av(e,$r._jsonSchema))return $r.fromBase64String(e.bytes)}}$r._jsonSchemaVersion="firestore/bytes/1.0",$r._jsonSchema={type:xn("string",$r._jsonSchemaVersion),bytes:xn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y1{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new be(le.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new qn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dv{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new be(le.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new be(le.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ut(this._lat,e._lat)||ut(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:qs._jsonSchemaVersion}}static fromJSON(e){if(av(e,qs._jsonSchema))return new qs(e.latitude,e.longitude)}}qs._jsonSchemaVersion="firestore/geoPoint/1.0",qs._jsonSchema={type:xn("string",qs._jsonSchemaVersion),latitude:xn("number"),longitude:xn("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class is{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(i,r){if(i.length!==r.length)return!1;for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:is._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(av(e,is._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new is(e.vectorValues);throw new be(le.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}is._jsonSchemaVersion="firestore/vectorValue/1.0",is._jsonSchema={type:xn("string",is._jsonSchemaVersion),vectorValues:xn("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eX=/^__.*__$/;class tX{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new Bu(e,this.data,this.fieldMask,t,this.fieldTransforms):new ov(e,this.data,t,this.fieldTransforms)}}class az{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new Bu(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function oz(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ue(40011,{dataSource:n})}}class tC{constructor(e,t,i,r,s,a){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=r,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new tC({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var r;const t=(r=this.path)==null?void 0:r.child(e),i=this.contextWith({path:t,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var r;const t=(r=this.path)==null?void 0:r.child(e),i=this.contextWith({path:t,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return Cb(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(oz(this.dataSource)&&eX.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class nX{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||H1(e)}createContext(e,t,i,r=!1){return new tC({dataSource:e,methodName:t,targetDoc:i,path:qn.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function X1(n){const e=n._freezeSettings(),t=H1(n._databaseId);return new nX(n._databaseId,!!e.ignoreUndefinedProperties,t)}function lz(n,e,t,i,r,s={}){const a=n.createContext(s.merge||s.mergeFields?2:0,e,t,r);iC("Data must be an object, but it was:",a,i);const o=uz(i,a);let l,u;if(s.merge)l=new Nr(a.fieldMask),u=a.fieldTransforms;else if(s.mergeFields){const c=[];for(const h of s.mergeFields){const f=zp(e,h,t);if(!a.contains(f))throw new be(le.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);hz(c,f)||c.push(f)}l=new Nr(c),u=a.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,u=a.fieldTransforms;return new tX(new nr(o),l,u)}class Q1 extends dv{_toFieldTransform(e){if(e.dataSource!==2)throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Q1}}class nC extends dv{_toFieldTransform(e){return new q7(e.path,new gy)}isEqual(e){return e instanceof nC}}function iX(n,e,t,i){const r=n.createContext(1,e,t);iC("Data must be an object, but it was:",r,i);const s=[],a=nr.empty();ju(i,(l,u)=>{const c=dz(e,l,t);u=Nn(u);const h=r.childContextForFieldPath(c);if(u instanceof Q1)s.push(c);else{const f=hv(u,h);f!=null&&(s.push(c),a.set(c,f))}});const o=new Nr(s);return new az(a,o,r.fieldTransforms)}function rX(n,e,t,i,r,s){const a=n.createContext(1,e,t),o=[zp(e,i,t)],l=[r];if(s.length%2!=0)throw new be(le.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<s.length;f+=2)o.push(zp(e,s[f])),l.push(s[f+1]);const u=[],c=nr.empty();for(let f=o.length-1;f>=0;--f)if(!hz(u,o[f])){const m=o[f];let y=l[f];y=Nn(y);const _=a.childContextForFieldPath(m);if(y instanceof Q1)u.push(m);else{const x=hv(y,_);x!=null&&(u.push(m),c.set(m,x))}}const h=new Nr(u);return new az(c,h,a.fieldTransforms)}function sX(n,e,t,i=!1){return hv(t,n.createContext(i?4:3,e))}function hv(n,e){if(cz(n=Nn(n)))return iC("Unsupported field value:",e,n),uz(n,e);if(n instanceof dv)return function(i,r){if(!oz(r.dataSource))throw r.createError(`${i._methodName}() can only be used with update() and set()`);if(!r.path)throw r.createError(`${i._methodName}() is not currently supported inside arrays`);const s=i._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return function(i,r){const s=[];let a=0;for(const o of i){let l=hv(o,r.childContextForArray(a));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}}(n,e)}return function(i,r){if((i=Nn(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return U7(r.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const s=zt.fromDate(i);return{timestampValue:Ab(r.serializer,s)}}if(i instanceof zt){const s=new zt(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:Ab(r.serializer,s)}}if(i instanceof qs)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof $r)return{bytesValue:xF(r.serializer,i._byteString)};if(i instanceof ln){const s=r.databaseId,a=i.firestore._databaseId;if(!a.isEqual(s))throw r.createError(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:jI(i.firestore._databaseId||r.databaseId,i._key.path)}}if(i instanceof is)return function(a,o){const l=a instanceof is?a.toArray():a;return{mapValue:{fields:{[X4]:{stringValue:Q4},[bb]:{arrayValue:{values:l.map(c=>{if(typeof c!="number")throw o.createError("VectorValues must only contain numeric values.");return FI(o.serializer,c)})}}}}}}(i,r);if(kF(i))return i._toProto(r.serializer);throw r.createError(`Unsupported field value: ${M1(i)}`)}(n,e)}function uz(n,e){const t={};return H4(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ju(n,(i,r)=>{const s=hv(r,e.childContextForField(i));s!=null&&(t[i]=s)}),{mapValue:{fields:t}}}function cz(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof zt||n instanceof qs||n instanceof $r||n instanceof ln||n instanceof dv||n instanceof is||kF(n))}function iC(n,e,t){if(!cz(t)||!B4(t)){const i=M1(t);throw i==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+i)}}function zp(n,e,t){if((e=Nn(e))instanceof Y1)return e._internalPath;if(typeof e=="string")return dz(n,e);throw Cb("Field path arguments must be of type string or ",n,!1,void 0,t)}const aX=new RegExp("[~\\*/\\[\\]]");function dz(n,e,t){if(e.search(aX)>=0)throw Cb(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Y1(...e.split("."))._internalPath}catch{throw Cb(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Cb(n,e,t,i,r){const s=i&&!i.isEmpty(),a=r!==void 0;let o=`Function ${e}() called with invalid data`;t&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${i}`),a&&(l+=` in document ${r}`),l+=")"),new be(le.INVALID_ARGUMENT,o+n+l)}function hz(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fz{convertValue(e,t="none"){switch(ku(e)){case 0:return null;case 1:return e.booleanValue;case 2:return hn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Cu(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ue(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const i={};return ju(e,(r,s)=>{i[r]=this.convertValue(s,t)}),i}convertVectorValue(e){var i,r,s;const t=(s=(r=(i=e.fields)==null?void 0:i[bb].arrayValue)==null?void 0:r.values)==null?void 0:s.map(a=>hn(a.doubleValue));return new is(t)}convertGeoPoint(e){return new qs(hn(e.latitude),hn(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":const i=F1(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(fy(e));default:return null}}convertTimestamp(e){const t=Iu(e);return new zt(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=Ft.fromString(e);xt(CF(i),9688,{name:e});const r=new Dp(i.get(1),i.get(3)),s=new Oe(i.popFirst(5));return r.isEqual(t)||Zo(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pz extends fz{constructor(e){super(),this.firestore=e}convertBytes(e){return new $r(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ln(this.firestore,null,t)}}function Nh(){return new nC("serverTimestamp")}const sP="@firebase/firestore",aP="4.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mz{constructor(e,t,i,r,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ln(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new oX(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){var e;return((e=this._document)==null?void 0:e.data.clone().value.mapValue.fields)??void 0}get(e){if(this._document){const t=this._document.data.field(zp("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class oX extends mz{data(){return super.data()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lX(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new be(le.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class rC{}class sC extends rC{}function BT(n,e,...t){let i=[];e instanceof rC&&i.push(e),i=i.concat(t),function(s){const a=s.filter(l=>l instanceof Z1).length,o=s.filter(l=>l instanceof J1).length;if(a>1||a>0&&o>0)throw new be(le.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(const r of i)n=r._apply(n);return n}class J1 extends sC{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new J1(e,t,i)}_apply(e){const t=this._parse(e);return gz(e._query,t),new Uu(e.firestore,e.converter,RT(e._query,t))}_parse(e){const t=X1(e.firestore);return function(s,a,o,l,u,c,h){let f;if(u.isKeyField()){if(c==="array-contains"||c==="array-contains-any")throw new be(le.INVALID_ARGUMENT,`Invalid Query. You can't perform '${c}' queries on documentId().`);if(c==="in"||c==="not-in"){lP(h,c);const y=[];for(const _ of h)y.push(oP(l,s,_));f={arrayValue:{values:y}}}else f=oP(l,s,h)}else c!=="in"&&c!=="not-in"&&c!=="array-contains-any"||lP(h,c),f=sX(o,a,h,c==="in"||c==="not-in");return wn.create(u,c,f)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class Z1 extends rC{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Z1(e,t)}_parse(e){const t=this._queryConstraints.map(i=>i._parse(e)).filter(i=>i.getFilters().length>0);return t.length===1?t[0]:Qs.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(r,s){let a=r;const o=s.getFlattenedFilters();for(const l of o)gz(a,l),a=RT(a,l)}(e._query,t),new Uu(e.firestore,e.converter,RT(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class ex extends sC{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ex(e,t)}_apply(e){const t=function(r,s,a){if(r.startAt!==null)throw new be(le.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new be(le.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new my(s,a)}(e._query,this._field,this._direction);return new Uu(e.firestore,e.converter,M7(e._query,t))}}function UT(n,e="asc"){const t=e,i=zp("orderBy",n);return ex._create(i,t)}function oP(n,e,t){if(typeof(t=Nn(t))=="string"){if(t==="")throw new be(le.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!sF(e)&&t.indexOf("/")!==-1)throw new be(le.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const i=e.path.child(Ft.fromString(t));if(!Oe.isDocumentKey(i))throw new be(le.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return xR(n,new Oe(i))}if(t instanceof ln)return xR(n,t._key);throw new be(le.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${M1(t)}.`)}function lP(n,e){if(!Array.isArray(n)||n.length===0)throw new be(le.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function gz(n,e){const t=function(r,s){for(const a of r)for(const o of a.getFlattenedFilters())if(s.indexOf(o.op)>=0)return o.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new be(le.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new be(le.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function yz(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}class tf{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class bu extends mz{constructor(e,t,i,r,s,a){super(e,t,i,r,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new jg(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(zp("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new be(le.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=bu._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}bu._jsonSchemaVersion="firestore/documentSnapshot/1.0",bu._jsonSchema={type:xn("string",bu._jsonSchemaVersion),bundleSource:xn("string","DocumentSnapshot"),bundleName:xn("string"),bundle:xn("string")};class jg extends bu{data(e={}){return super.data(e)}}class Md{constructor(e,t,i,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new tf(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new jg(this._firestore,this._userDataWriter,i.key,i,new tf(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new be(le.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let a=0;return r._snapshot.docChanges.map(o=>{const l=new jg(r._firestore,r._userDataWriter,o.doc.key,o.doc,new tf(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);return o.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(o=>s||o.type!==3).map(o=>{const l=new jg(r._firestore,r._userDataWriter,o.doc.key,o.doc,new tf(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);let u=-1,c=-1;return o.type!==0&&(u=a.indexOf(o.doc.key),a=a.delete(o.doc.key)),o.type!==1&&(a=a.add(o.doc),c=a.indexOf(o.doc.key)),{type:uX(o.type),doc:l,oldIndex:u,newIndex:c}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new be(le.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Md._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=D1.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],i=[],r=[];return this.docs.forEach(s=>{s._document!==null&&(t.push(s._document),i.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),r.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function uX(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ue(61501,{type:n})}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Md._jsonSchemaVersion="firestore/querySnapshot/1.0",Md._jsonSchema={type:xn("string",Md._jsonSchemaVersion),bundleSource:xn("string","QuerySnapshot"),bundleName:xn("string"),bundle:xn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _z(n){n=Xs(n,ln);const e=Xs(n.firestore,dh),t=K1(e);return KY(t,n._key).then(i=>cX(e,n,i))}function rg(n){n=Xs(n,Uu);const e=Xs(n.firestore,dh),t=K1(e),i=new pz(e);return lX(n._query),YY(t,n._query).then(r=>new Md(e,i,n,r))}function HT(n,e,t){n=Xs(n,ln);const i=Xs(n.firestore,dh),r=yz(n.converter,e,t),s=X1(i);return tx(i,[lz(s,"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,Ws.none())])}function vz(n,e,t,...i){n=Xs(n,ln);const r=Xs(n.firestore,dh),s=X1(r);let a;return a=typeof(e=Nn(e))=="string"||e instanceof Y1?rX(s,"updateDoc",n._key,e,t,i):iX(s,"updateDoc",n._key,e),tx(r,[a.toMutation(n._key,Ws.exists(!0))])}function WT(n,e){const t=Xs(n.firestore,dh),i=ef(n),r=yz(n.converter,e),s=X1(n.firestore);return tx(t,[lz(s,"addDoc",i._key,r,n.converter!==null,{}).toMutation(i._key,Ws.exists(!1))]).then(()=>i)}function tx(n,e){const t=K1(n);return XY(t,e)}function cX(n,e,t){const i=t.docs.get(e._key),r=new pz(n);return new bu(n,r,e._key,i,new tf(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){QG(oh),Hd(new Tu("firestore",(i,{instanceIdentifier:r,options:s})=>{const a=i.getProvider("app").getImmediate(),o=new dh(new ZG(i.getProvider("auth-internal")),new n7(a,i.getProvider("app-check-internal")),_7(a,r),a);return s={useFetchStreams:t,...s},o._setSettings(s),o},"PUBLIC").setMultipleInstances(!0)),Oa(sP,aP,e),Oa(sP,aP,"esm2020")})();const dX=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:fz,Bytes:$r,CollectionReference:Ho,DocumentReference:ln,DocumentSnapshot:bu,FieldPath:Y1,FieldValue:dv,Firestore:dh,FirestoreError:be,GeoPoint:qs,Query:Uu,QueryCompositeFilterConstraint:Z1,QueryConstraint:sC,QueryDocumentSnapshot:jg,QueryFieldFilterConstraint:J1,QueryOrderByConstraint:ex,QuerySnapshot:Md,SnapshotMetadata:tf,Timestamp:zt,VectorValue:is,_AutoId:D1,_ByteString:Kn,_DatabaseId:Dp,_DocumentKey:Oe,_EmptyAuthCredentialsProvider:z4,_FieldPath:qn,_cast:Xs,_logWarn:Kd,_validateIsNotUsedTogether:j4,addDoc:WT,collection:gc,connectFirestoreEmulator:rz,doc:ef,ensureFirestoreConfigured:K1,executeWrite:tx,getDoc:_z,getDocs:rg,getFirestore:sz,orderBy:UT,query:BT,serverTimestamp:Nh,setDoc:HT,updateDoc:vz},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wz="firebasestorage.googleapis.com",hX="storageBucket",fX=2*60*1e3,pX=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qa extends Wa{constructor(e,t,i=0){super(fE(e),`Firebase Storage: ${t} (${fE(e)})`),this.status_=i,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,qa.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return fE(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Ba;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Ba||(Ba={}));function fE(n){return"storage/"+n}function mX(){const n="An unknown error occurred, please check the error payload for server response.";return new qa(Ba.UNKNOWN,n)}function gX(){return new qa(Ba.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function yX(){return new qa(Ba.CANCELED,"User canceled the upload/download.")}function _X(n){return new qa(Ba.INVALID_URL,"Invalid URL '"+n+"'.")}function vX(n){return new qa(Ba.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function uP(n){return new qa(Ba.INVALID_ARGUMENT,n)}function bz(){return new qa(Ba.APP_DELETED,"The Firebase app was deleted.")}function wX(n){return new qa(Ba.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class js{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let i;try{i=js.makeFromUrl(e,t)}catch{return new js(e,"")}if(i.path==="")return i;throw vX(e)}static makeFromUrl(e,t){let i=null;const r="([A-Za-z0-9.\\-_]+)";function s(k){k.path.charAt(k.path.length-1)==="/"&&(k.path_=k.path_.slice(0,-1))}const a="(/(.*))?$",o=new RegExp("^gs://"+r+a,"i"),l={bucket:1,path:3};function u(k){k.path_=decodeURIComponent(k.path)}const c="v[A-Za-z0-9_]+",h=t.replace(/[.]/g,"\\."),f="(/([^?#]*).*)?$",m=new RegExp(`^https?://${h}/${c}/b/${r}/o${f}`,"i"),y={bucket:1,path:3},_=t===wz?"(?:storage.googleapis.com|storage.cloud.google.com)":t,x="([^?#]*)",v=new RegExp(`^https?://${_}/${r}/${x}`,"i"),E=[{regex:o,indices:l,postModify:s},{regex:m,indices:y,postModify:u},{regex:v,indices:{bucket:1,path:2},postModify:u}];for(let k=0;k<E.length;k++){const $=E[k],L=$.regex.exec(e);if(L){const I=L[$.indices.bucket];let C=L[$.indices.path];C||(C=""),i=new js(I,C),$.postModify(i);break}}if(i==null)throw _X(e);return i}}class bX{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xX(n,e,t){let i=1,r=null,s=null,a=!1,o=0;function l(){return o===2}let u=!1;function c(...x){u||(u=!0,e.apply(null,x))}function h(x){r=setTimeout(()=>{r=null,n(m,l())},x)}function f(){s&&clearTimeout(s)}function m(x,...v){if(u){f();return}if(x){f(),c.call(null,x,...v);return}if(l()||a){f(),c.call(null,x,...v);return}i<64&&(i*=2);let E;o===1?(o=2,E=0):E=(i+Math.random())*1e3,h(E)}let y=!1;function _(x){y||(y=!0,f(),!u&&(r!==null?(x||(o=2),clearTimeout(r),h(0)):x||(o=1)))}return h(0),s=setTimeout(()=>{a=!0,_(!0)},t),_}function EX(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AX(n){return n!==void 0}function cP(n,e,t,i){if(i<e)throw uP(`Invalid value for '${n}'. Expected ${e} or greater.`);if(i>t)throw uP(`Invalid value for '${n}'. Expected ${t} or less.`)}function TX(n){const e=encodeURIComponent;let t="?";for(const i in n)if(n.hasOwnProperty(i)){const r=e(i)+"="+e(n[i]);t=t+r+"&"}return t=t.slice(0,-1),t}var kb;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(kb||(kb={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SX(n,e){const t=n>=500&&n<600,r=[408,429].indexOf(n)!==-1,s=e.indexOf(n)!==-1;return t||r||s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IX{constructor(e,t,i,r,s,a,o,l,u,c,h,f=!0,m=!1){this.url_=e,this.method_=t,this.headers_=i,this.body_=r,this.successCodes_=s,this.additionalRetryCodes_=a,this.callback_=o,this.errorCallback_=l,this.timeout_=u,this.progressCallback_=c,this.connectionFactory_=h,this.retry=f,this.isUsingEmulator=m,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((y,_)=>{this.resolve_=y,this.reject_=_,this.start_()})}start_(){const e=(i,r)=>{if(r){i(!1,new w0(!1,null,!0));return}const s=this.connectionFactory_();this.pendingConnection_=s;const a=o=>{const l=o.loaded,u=o.lengthComputable?o.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,u)};this.progressCallback_!==null&&s.addUploadProgressListener(a),s.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(a),this.pendingConnection_=null;const o=s.getErrorCode()===kb.NO_ERROR,l=s.getStatus();if(!o||SX(l,this.additionalRetryCodes_)&&this.retry){const c=s.getErrorCode()===kb.ABORT;i(!1,new w0(!1,null,c));return}const u=this.successCodes_.indexOf(l)!==-1;i(!0,new w0(u,s))})},t=(i,r)=>{const s=this.resolve_,a=this.reject_,o=r.connection;if(r.wasSuccessCode)try{const l=this.callback_(o,o.getResponse());AX(l)?s(l):s()}catch(l){a(l)}else if(o!==null){const l=mX();l.serverResponse=o.getErrorText(),this.errorCallback_?a(this.errorCallback_(o,l)):a(l)}else if(r.canceled){const l=this.appDelete_?bz():yX();a(l)}else{const l=gX();a(l)}};this.canceled_?t(!1,new w0(!1,null,!0)):this.backoffId_=xX(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&EX(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class w0{constructor(e,t,i){this.wasSuccessCode=e,this.connection=t,this.canceled=!!i}}function CX(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function kX(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function $X(n,e){e&&(n["X-Firebase-GMPID"]=e)}function RX(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function PX(n,e,t,i,r,s,a=!0,o=!1){const l=TX(n.urlParams),u=n.url+l,c=Object.assign({},n.headers);return $X(c,e),CX(c,t),kX(c,s),RX(c,i),new IX(u,n.method,c,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,r,a,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NX(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function DX(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $b{constructor(e,t){this._service=e,t instanceof js?this._location=t:this._location=js.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new $b(e,t)}get root(){const e=new js(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return DX(this._location.path)}get storage(){return this._service}get parent(){const e=NX(this._location.path);if(e===null)return null;const t=new js(this._location.bucket,e);return new $b(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw wX(e)}}function dP(n,e){const t=e==null?void 0:e[hX];return t==null?null:js.makeFromBucketSpec(t,n)}function MX(n,e,t,i={}){n.host=`${e}:${t}`;const r=ah(e);r&&(_I(`https://${n.host}/b`),vI("Storage",!0)),n._isUsingEmulator=!0,n._protocol=r?"https":"http";const{mockUserToken:s}=i;s&&(n._overrideAuthToken=typeof s=="string"?s:WL(s,n.app.options.projectId))}class OX{constructor(e,t,i,r,s,a=!1){this.app=e,this._authProvider=t,this._appCheckProvider=i,this._url=r,this._firebaseVersion=s,this._isUsingEmulator=a,this._bucket=null,this._host=wz,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=fX,this._maxUploadRetryTime=pX,this._requests=new Set,r!=null?this._bucket=js.makeFromBucketSpec(r,this._host):this._bucket=dP(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=js.makeFromBucketSpec(this._url,e):this._bucket=dP(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){cP("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){cP("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(kr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new $b(this,e)}_makeRequest(e,t,i,r,s=!0){if(this._deleted)return new bX(bz());{const a=PX(e,this._appId,i,r,t,this._firebaseVersion,s,this._isUsingEmulator);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}async makeRequestWithTokens(e,t){const[i,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,i,r).getPromise()}}const hP="@firebase/storage",fP="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xz="storage";function LX(n=xI(),e){n=Nn(n);const i=$1(n,xz).getImmediate({identifier:e}),r=BL("storage");return r&&FX(i,...r),i}function FX(n,e,t,i={}){MX(n,e,t,i)}function zX(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),i=n.getProvider("auth-internal"),r=n.getProvider("app-check-internal");return new OX(t,i,r,e,oh)}function VX(){Hd(new Tu(xz,zX,"PUBLIC").setMultipleInstances(!0)),Oa(hP,fP,""),Oa(hP,fP,"esm2020")}VX();const jX={apiKey:"AIzaSyCRNLyBkav2ZbMNj9MakHKDdSzeabgFSTI",authDomain:"blood-fitness-app.firebaseapp.com",projectId:"blood-fitness-app",storageBucket:"blood-fitness-app.firebasestorage.app",messagingSenderId:"142443201042",appId:"1:142443201042:web:a962a38c46816d632b8ecb",measurementId:"G-QW6N5M6DKL"},aC=KL(jX),wl=GG(aC),bs=sz(aC);LX(aC);const BX=Object.freeze(Object.defineProperty({__proto__:null,auth:wl,db:bs},Symbol.toStringTag,{value:"Module"})),pE={async saveProfile(n,e){try{const t=ef(bs,"users",n);return await HT(t,{...e,updatedAt:Nh()},{merge:!0}),{success:!0}}catch(t){throw console.error("Error saving profile:",t),t}},async getProfile(n){try{const e=ef(bs,"users",n),t=await _z(e);return t.exists()?{success:!0,profile:{id:t.id,...t.data()}}:{success:!1,error:"Profile not found"}}catch(e){throw console.error("Error getting profile:",e),e}},async updateProfile(n,e){try{const t=ef(bs,"users",n);return await vz(t,{...e,updatedAt:Nh()}),{success:!0}}catch(t){throw console.error("Error updating profile:",t),t}},async saveBloodReport(n,e){try{const t=gc(bs,`users/${n}/bloodReports`);return{success:!0,reportId:(await WT(t,{...e,uploadDate:Nh()})).id}}catch(t){throw console.error("Error saving blood report:",t),t}},async getBloodReports(n){try{const e=gc(bs,`users/${n}/bloodReports`),t=BT(e,UT("uploadDate","desc")),i=await rg(t),r=[];return i.forEach(s=>{r.push({id:s.id,...s.data()})}),{success:!0,reports:r}}catch(e){throw console.error("Error getting blood reports:",e),e}},async savePrediction(n,e,t){try{const i=ef(bs,`users/${n}/bloodReports/${e}/predictions`,"latest");return await HT(i,{...t,predictionDate:Nh()}),{success:!0}}catch(i){throw console.error("Error saving prediction:",i),i}},async getPredictionHistory(n){try{const e=gc(bs,`users/${n}/bloodReports`),t=await rg(e),i=[];for(const r of t.docs){const s=gc(bs,`users/${n}/bloodReports/${r.id}/predictions`);(await rg(s)).forEach(o=>{i.push({reportId:r.id,...o.data()})})}return{success:!0,predictions:i}}catch(e){throw console.error("Error getting predictions:",e),e}},async saveWeightLog(n,e){try{const t=gc(bs,`users/${n}/weightLogs`);return await WT(t,{...e,timestamp:Nh()}),{success:!0}}catch(t){throw console.error("Error saving weight log:",t),t}},async getWeightLogs(n){try{const e=gc(bs,`users/${n}/weightLogs`),t=BT(e,UT("timestamp","asc")),i=await rg(t),r=[];return i.forEach(s=>{r.push({id:s.id,...s.data()})}),{success:!0,logs:r}}catch(e){throw console.error("Error getting weight logs:",e),e}}},sg={async register(n,e){try{const i=(await Rq(wl,n,e)).user;return await pE.saveProfile(i.uid,{email:i.email,name:n.split("@")[0],createdAt:new Date}),{success:!0,user:{email:i.email,id:i.uid}}}catch(t){return console.error("Registration error:",t),{success:!1,error:t.message||"Registration failed"}}},async login(n,e){try{const i=(await Pq(wl,n,e)).user;return{success:!0,user:{email:i.email,id:i.uid}}}catch(t){return console.error("Login error:",t),{success:!1,error:t.code==="auth/invalid-credential"?"Invalid email or password":t.message}}},async logout(){try{return await Oq(wl),{success:!0}}catch(n){return console.error("Logout error:",n),{success:!1,error:n.message}}},async getProfile(){try{const n=wl.currentUser;return n?await pE.getProfile(n.uid):{success:!1,error:"No user logged in"}}catch(n){return console.error("Error getting profile:",n),{success:!1,error:n.message}}},async updateProfile(n){try{const e=wl.currentUser;return e?(await pE.saveProfile(e.uid,n),{success:!0,message:"Profile updated"}):{success:!1,error:"No user logged in"}}catch(e){return console.error("Error updating profile:",e),{success:!1,error:e.message}}},getCurrentUser(){return wl.currentUser},onAuthStateChange(n){return Mq(wl,n)}},UX=Object.freeze(Object.defineProperty({__proto__:null,api:sg},Symbol.toStringTag,{value:"Module"})),HX=({onComplete:n})=>{const[e,t]=xe.useState({name:"",age:"",gender:"male",weight:"",heightCm:"",heightFt:"",heightIn:""}),i=a=>{const{name:o,value:l}=a.target;t(u=>({...u,[o]:l}))},r=(a,o)=>Math.round(parseInt(a||0)*30.48+parseInt(o||0)*2.54),s=a=>{if(a.preventDefault(),!e.name||!e.age||!e.weight)return;const o={...e,heightCm:e.heightCm||r(e.heightFt,e.heightIn)};n(o)};return T.jsxs("div",{className:"profile-container fade-in",children:[T.jsxs("div",{className:"card profile-card",children:[T.jsxs("div",{className:"header",children:[T.jsx("h2",{children:"Let's know you better"}),T.jsx("p",{children:"Enter your details for personalized health insights."})]}),T.jsxs("form",{onSubmit:s,children:[T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:"Full Name"}),T.jsx("input",{type:"text",name:"name",className:"input-field",placeholder:"Your Name",value:e.name,onChange:i,required:!0})]}),T.jsxs("div",{className:"row",children:[T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:"Age"}),T.jsx("input",{type:"number",name:"age",className:"input-field",placeholder:"25",value:e.age,onChange:i,required:!0})]}),T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:"Gender"}),T.jsxs("select",{name:"gender",className:"input-field",value:e.gender,onChange:i,children:[T.jsx("option",{value:"male",children:"Male"}),T.jsx("option",{value:"female",children:"Female"}),T.jsx("option",{value:"other",children:"Other"})]})]})]}),T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:"Weight (kg)"}),T.jsx("input",{type:"number",name:"weight",className:"input-field",placeholder:"70.5",value:e.weight,onChange:i,step:"0.1",required:!0})]}),T.jsxs("div",{className:"height-section",children:[T.jsx("label",{children:"Height"}),T.jsx("div",{className:"tabs"}),T.jsxs("div",{className:"row",children:[T.jsxs("div",{className:"form-group",children:[T.jsx("label",{className:"sub-label",children:"CM"}),T.jsx("input",{type:"number",name:"heightCm",className:"input-field",placeholder:"175",value:e.heightCm,onChange:i})]}),T.jsx("div",{className:"or-divider",children:"OR"}),T.jsxs("div",{className:"form-group",children:[T.jsx("label",{className:"sub-label",children:"Feet"}),T.jsx("input",{type:"number",name:"heightFt",className:"input-field",placeholder:"5",value:e.heightFt,onChange:i})]}),T.jsxs("div",{className:"form-group",children:[T.jsx("label",{className:"sub-label",children:"Inches"}),T.jsx("input",{type:"number",name:"heightIn",className:"input-field",placeholder:"9",value:e.heightIn,onChange:i})]})]})]}),T.jsx("button",{type:"submit",className:"btn-primary",style:{marginTop:"2rem"},children:"Continue"})]})]}),T.jsx("style",{children:`
        .profile-container {
          padding: var(--spacing-md);
          min-height: 100vh;
          background-color: var(--color-background);
          display: flex;
          align-items: center;
          justify-content: center;
        }
        .profile-card {
           width: 100%;
           max-width: 450px;
        }
        .header {
          margin-bottom: var(--spacing-xl);
          text-align: center;
        }
        .header h2 {
          color: var(--color-text-main);
          margin-bottom: var(--spacing-xs);
        }
        .header p {
          color: var(--color-text-secondary);
          font-size: var(--font-size-sm);
        }
        .row {
          display: flex;
          gap: var(--spacing-md);
        }
        .row .form-group {
          flex: 1;
        }
        .form-group {
          margin-bottom: var(--spacing-md);
        }
        .form-group label {
          display: block;
          margin-bottom: var(--spacing-xs);
          font-size: var(--font-size-sm);
          font-weight: 500;
          color: var(--color-text-secondary);
        }
        .sub-label {
          font-size: var(--font-size-xs) !important;
          color: var(--color-text-muted) !important;
        }
        .or-divider {
          display: flex;
          align-items: center;
          font-size: var(--font-size-xs);
          color: var(--color-text-muted);
          font-weight: bold;
        }
        .height-section {
           background: #f1f5f9;
           padding: var(--spacing-md);
           border-radius: var(--radius-md);
        }
        .fade-in {
          animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
      `})]})};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var WX={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qX=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),dt=(n,e)=>{const t=xe.forwardRef(({color:i="currentColor",size:r=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:o="",children:l,...u},c)=>xe.createElement("svg",{ref:c,...WX,width:r,height:r,stroke:i,strokeWidth:a?Number(s)*24/Number(r):s,className:["lucide",`lucide-${qX(n)}`,o].join(" "),...u},[...e.map(([h,f])=>xe.createElement(h,f)),...Array.isArray(l)?l:[l]]));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ez=dt("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Az=dt("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GX=dt("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KX=dt("Apple",[["path",{d:"M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z",key:"3s7exb"}],["path",{d:"M10 2c1 .5 2 2 2 5",key:"fcco2y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YX=dt("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XX=dt("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QX=dt("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JX=dt("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZX=dt("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eQ=dt("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tl=dt("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pP=dt("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tQ=dt("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nQ=dt("Dumbbell",[["path",{d:"m6.5 6.5 11 11",key:"f7oqzb"}],["path",{d:"m21 21-1-1",key:"cpc6if"}],["path",{d:"m3 3 1 1",key:"d3rpuf"}],["path",{d:"m18 22 4-4",key:"1e32o6"}],["path",{d:"m2 6 4-4",key:"189tqz"}],["path",{d:"m3 10 7-7",key:"1bxui2"}],["path",{d:"m14 21 7-7",key:"16x78n"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iQ=dt("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oC=dt("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mP=dt("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tz=dt("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rQ=dt("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sQ=dt("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aQ=dt("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oQ=dt("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lQ=dt("ScanLine",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uQ=dt("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cQ=dt("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mE=dt("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dQ=dt("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hQ=dt("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fQ=dt("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pQ=dt("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mQ=dt("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sz=dt("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Iz=dt("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bg=dt("Utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"1ogz0v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gQ=dt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yQ=dt("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),_Q=({user:n,onClose:e,onLogout:t,onNavigate:i})=>{const[r,s]=xe.useState("health"),[a,o]=xe.useState(!1),[l,u]=xe.useState({name:n.name||"",age:n.age||"",gender:n.gender||"Male",height:n.height||"",weight:n.weight||"",bloodGroup:n.bloodGroup||"",diseases:n.diseases||"",allergies:n.allergies||"",notes:n.notes||""}),[c,h]=xe.useState([]);xe.useEffect(()=>{const x=localStorage.getItem(`profile_${n.email}`);x&&u({...l,...JSON.parse(x)});const v=n.email?`reports_${n.email}`:"blood_reports",w=JSON.parse(localStorage.getItem(v)||"[]");h(w)},[n.email]);const f=()=>{localStorage.setItem(`profile_${n.email}`,JSON.stringify(l)),o(!1),alert("Profile saved successfully!")},m=x=>{if(!window.confirm("Are you sure you want to delete this report?"))return;const v=[...c];v.splice(x,1),h(v);const w=n.email?`reports_${n.email}`:"blood_reports";localStorage.setItem(w,JSON.stringify(v))},_=(()=>{if(!l.height||!l.weight)return null;const x=l.height/100;return(l.weight/(x*x)).toFixed(1)})();return T.jsxs("div",{className:"profile-dashboard fixed-fullscreen",children:[T.jsxs("div",{className:"profile-header",children:[T.jsx("button",{onClick:e,className:"p-back-btn",children:T.jsx(tl,{size:24})}),T.jsx("h3",{children:"My Profile"}),T.jsx("button",{onClick:t,className:"p-logout",children:"Logout"})]}),T.jsxs("div",{className:"p-hero",children:[T.jsx("div",{className:"p-avatar",children:T.jsx(Iz,{size:40,color:"white"})}),T.jsx("h2",{children:l.name||"User"}),T.jsxs("div",{className:"p-badges",children:[_&&T.jsxs("span",{className:"p-badge",children:["BMI: ",_]}),l.bloodGroup&&T.jsx("span",{className:"p-badge red",children:l.bloodGroup})]})]}),T.jsxs("div",{className:"p-tabs",children:[T.jsx("button",{className:`p-tab ${r==="health"?"active":""}`,onClick:()=>s("health"),children:"Health Profile"}),T.jsx("button",{className:`p-tab ${r==="reports"?"active":""}`,onClick:()=>s("reports"),children:"Reports"})]}),T.jsxs("div",{className:"p-content",children:[r==="health"&&T.jsxs("div",{className:"tab-pane fade-in",children:[T.jsxs("div",{className:"pane-header",children:[T.jsx("h4",{children:"Personal & Medical Data"}),!a&&T.jsx("button",{className:"edit-toggle",onClick:()=>o(!0),children:"Edit"})]}),T.jsxs("div",{className:"form-grid",style:{marginBottom:"20px"},children:[T.jsxs("div",{className:"field",children:[T.jsx("label",{children:"Age"}),T.jsx("input",{type:"number",disabled:!a,value:l.age,onChange:x=>u({...l,age:x.target.value})})]}),T.jsxs("div",{className:"field",children:[T.jsx("label",{children:"Blood Group"}),T.jsxs("select",{disabled:!a,value:l.bloodGroup,onChange:x=>u({...l,bloodGroup:x.target.value}),children:[T.jsx("option",{value:"",children:"Select"}),T.jsx("option",{children:"A+"}),T.jsx("option",{children:"A-"}),T.jsx("option",{children:"B+"}),T.jsx("option",{children:"B-"}),T.jsx("option",{children:"O+"}),T.jsx("option",{children:"O-"}),T.jsx("option",{children:"AB+"}),T.jsx("option",{children:"AB-"})]})]}),T.jsxs("div",{className:"field",children:[T.jsx("label",{children:"Weight (kg)"}),T.jsx("input",{type:"number",disabled:!a,value:l.weight,onChange:x=>u({...l,weight:x.target.value})})]}),T.jsxs("div",{className:"field",children:[T.jsx("label",{children:"Height (cm)"}),T.jsx("input",{type:"number",disabled:!a,value:l.height,onChange:x=>u({...l,height:x.target.value})})]})]}),T.jsxs("div",{className:"health-form",children:[T.jsx("label",{children:"Existing Conditions (Diseases)"}),T.jsx("textarea",{disabled:!a,placeholder:"e.g. Diabetes, Hypertension...",value:l.diseases,onChange:x=>u({...l,diseases:x.target.value})}),T.jsx("label",{children:"Allergies"}),T.jsx("textarea",{disabled:!a,placeholder:"e.g. Peanuts, Penicillin...",value:l.allergies,onChange:x=>u({...l,allergies:x.target.value})}),T.jsx("label",{children:"Health Notes"}),T.jsx("textarea",{className:"large-text",disabled:!a,placeholder:"Write your fitness goals here...",value:l.notes,onChange:x=>u({...l,notes:x.target.value})})]}),a&&T.jsxs("button",{className:"save-btn",onClick:f,children:[T.jsx(oQ,{size:18})," Save Health Data"]}),T.jsxs("div",{className:"milestones-preview",style:{marginTop:"20px",cursor:"pointer"},onClick:()=>i("weightprogress"),children:[T.jsxs("div",{className:"pane-header",style:{marginBottom:"10px"},children:[T.jsx("h5",{children:"Weight Tracker"}),T.jsx("span",{style:{fontSize:"12px",color:"var(--color-primary)"},children:"View Graph "})]}),T.jsx("p",{style:{fontSize:"12px",color:"#64748b"},children:"Track your weight journey over time."})]})]}),r==="reports"&&T.jsxs("div",{className:"tab-pane fade-in",children:[T.jsx("h4",{children:"Recent Blood Reports"}),c.length===0?T.jsx("p",{className:"empty-state",children:"No reports uploaded yet."}):T.jsx("div",{className:"reports-list",children:c.map((x,v)=>T.jsxs("div",{className:"report-item",children:[T.jsx("div",{className:"r-icon",children:T.jsx(oC,{size:20})}),T.jsxs("div",{className:"r-info",children:[T.jsx("span",{className:"r-date",children:x.date}),T.jsxs("span",{className:"r-summary",children:[x.results.length," Parameters Analyzed"]})]}),T.jsxs("div",{className:"r-actions-row",children:[T.jsx("button",{className:"icon-btn-small",onClick:()=>i("blood",x),title:"View Detail",children:T.jsx(iQ,{size:16,color:"var(--color-primary)"})}),T.jsx("button",{className:"icon-btn-small delete",onClick:()=>m(v),title:"Delete",children:T.jsx(fQ,{size:16,color:"#ef4444"})})]})]},v))})]})]}),T.jsx("style",{children:`
                .fixed-fullscreen {
                    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                    background: #f8fafc; z-index: 2000;
                    overflow-y: auto;
                    font-family: var(--font-family-body);
                }
                .profile-header {
                    display: flex; justify-content: space-between; align-items: center;
                    padding: 20px; background: white;
                }
                .profile-header h3 { margin: 0; font-size: 18px; }
                .p-back-btn { background: none; font-size: 24px; padding: 0; }
                .p-logout { color: #ef4444; background: none; font-weight: 600; font-size: 14px; }

                .p-hero {
                    background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
                    color: white; padding: 30px; text-align: center;
                    border-radius: 0 0 30px 30px; margin-bottom: 20px;
                    box-shadow: 0 10px 30px rgba(230, 57, 70, 0.2);
                }
                .p-avatar {
                    width: 80px; height: 80px; background: rgba(255,255,255,0.2);
                    border-radius: 50%; margin: 0 auto 15px;
                    display: flex; align-items: center; justify-content: center;
                    backdrop-filter: blur(5px); border: 2px solid rgba(255,255,255,0.4);
                }
                .p-badges { display: flex; justify-content: center; gap: 10px; margin-top: 10px; }
                .p-badge { background: rgba(0,0,0,0.2); padding: 4px 12px; border-radius: 99px; font-size: 12px; font-weight: 600; }
                .p-badge.red { background: #fee2e2; color: #991b1b; }

                .p-tabs {
                    display: flex; padding: 0 20px; gap: 10px; border-bottom: 1px solid #e2e8f0;
                }
                .p-tab {
                    flex: 1; padding: 12px; background: none; border-bottom: 3px solid transparent;
                    color: #64748b; font-weight: 600; font-size: 14px;
                }
                .p-tab.active { border-color: var(--color-primary); color: var(--color-primary); }

                .p-content { padding: 20px; }
                .tab-pane { animation: fadeIn 0.3s ease; }
                .pane-header { display: flex; justify-content: space-between; margin-bottom: 20px; align-items: center; }
                .edit-toggle { color: var(--color-primary); font-size: 14px; font-weight: 600; background: none; }

                .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
                .field label { display: block; font-size: 12px; color: #64748b; margin-bottom: 5px; }
                .field input, .field select {
                    width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px;
                    background: white; font-weight: 500;
                }
                .field input:disabled { background: #f1f5f9; color: #94a3b8; }

                .health-form label { display: block; font-size: 13px; font-weight: 600; margin-top: 15px; margin-bottom: 5px; }
                .health-form textarea {
                    width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 12px;
                    font-family: inherit; resize: none; height: 60px;
                }
                .health-form textarea.large-text { height: 100px; }

                .save-btn {
                    width: 100%; background: var(--color-primary); color: white;
                    padding: 14px; border-radius: 12px; margin-top: 25px;
                    font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px;
                    box-shadow: 0 4px 12px rgba(230, 57, 70, 0.2);
                }

                .reports-list { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
                .report-item {
                    background: white; padding: 15px; border-radius: 12px;
                    display: flex; align-items: center; gap: 15px;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
                }
                .r-icon {
                    width: 40px; height: 40px; background: #eff6ff; color: #3b82f6;
                    border-radius: 50%; display: flex; align-items: center; justify-content: center;
                }
                .r-info { flex: 1; display: flex; flex-direction: column; }
                .r-date { font-weight: 600; font-size: 14px; }
                .r-summary { font-size: 12px; color: #64748b; }
                .r-actions-row { display: flex; gap: 8px; }
                .icon-btn-small { 
                    background: #f1f5f9; border: none; padding: 6px; border-radius: 6px; 
                    cursor: pointer; display: flex; align-items: center; justify-content: center;
                }
                .icon-btn-small:hover { background: #e2e8f0; }
                .icon-btn-small.delete:hover { background: #fee2e2; }

                .export-btn {
                     width: 100%; margin-top: 20px; padding: 12px;
                     border: 1px dashed #cbd5e1; background: white; color: #475569;
                     border-radius: 12px; display: flex; justify-content: center; gap: 8px;
                     align-items: center;
                }

                .milestones-preview { margin-top: 30px; padding: 15px; background: #fff7ed; border-radius: 12px; }
                .milestone-badges { display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; }
                .m-badge { background: white; padding: 5px 10px; border-radius: 8px; font-size: 12px; font-weight: 600; color: #c2410c; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

                .fade-in { animation: fadeIn 0.4s ease; }
                @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
            `})]})},vQ=({userName:n,userProfile:e,onNavigate:t,onLogout:i})=>{const[r,s]=xe.useState(!1);if(r)return T.jsx(_Q,{user:e||{name:n,email:"user@example.com"},onClose:()=>s(!1),onLogout:i,onNavigate:t});const a=[{id:"blood",title:"Blood Evaluation",desc:"Analyze reports & get insights",icon:T.jsx(oC,{size:24}),color:"#4361EE",bg:"#F0F4FF"},{id:"diet",title:"Specialized Diet",desc:"Meals based on Blood Report",icon:T.jsx(KX,{size:24}),color:"#10B981",bg:"#ECFDF5"},{id:"bmi",title:"BMI Calculator",desc:"Check your health risk & vitals",icon:T.jsx(XX,{size:24}),color:"var(--color-primary)",bg:"#FFF0F1"},{id:"fitness",title:"Fitness Helper",desc:"Diet plans & weight goals",icon:T.jsx(Bg,{size:24}),color:"#2A9D8F",bg:"#EDF7F6"},{id:"homeworkout",title:"Home Workout",desc:"8 Basic exercises & calories",icon:T.jsx(nQ,{size:24}),color:"#FF6B6B",bg:"#FFF0F1"},{id:"chat",title:"AI Health Bot",desc:"Ask questions & get advice",icon:T.jsx(rQ,{size:24}),color:"#7209B7",bg:"#F3E8FF"}];return T.jsxs("div",{className:"dashboard-container fade-in",children:[T.jsxs("header",{className:"dash-header",children:[T.jsx("div",{className:"avatar",onClick:()=>s(!0),style:{cursor:"pointer"},children:n?n.charAt(0).toUpperCase():"U"}),T.jsxs("div",{className:"welcome-text",children:[T.jsx("p",{children:"Welcome back,"}),T.jsx("h3",{children:n||"User"})]})]}),T.jsx("div",{className:"stats-preview",children:T.jsxs("div",{className:"stat-card",children:[T.jsx("h4",{children:"Stay Hydrated! "}),T.jsx("p",{children:"Drink 8 glasses of water today."})]})}),T.jsx("div",{className:"options-grid",children:a.map(o=>T.jsxs("button",{className:"option-card",onClick:()=>t(o.id),style:{"--hover-color":o.color},children:[T.jsx("div",{className:"icon-box",style:{color:o.color,backgroundColor:o.bg},children:o.icon}),T.jsxs("div",{className:"text-box",children:[T.jsx("h4",{children:o.title}),T.jsx("p",{children:o.desc})]}),T.jsx("div",{className:"arrow",children:""})]},o.id))}),T.jsx("style",{children:`
        .dashboard-container {
          padding: var(--spacing-md);
          padding-bottom: 80px; /* Space for bottom nav if added */
        }
        
        .dash-header {
          display: flex;
          align-items: center;
          gap: var(--spacing-md);
          margin-bottom: var(--spacing-xl);
        }

        .avatar {
          width: 50px;
          height: 50px;
          background: var(--color-primary);
          color: white;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
          font-size: var(--font-size-lg);
          box-shadow: var(--shadow-md);
        }

        .welcome-text {
          flex: 1;
        }

        .welcome-text p {
          color: var(--color-text-secondary);
          font-size: var(--font-size-xs);
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }

        .welcome-text h3 {
          color: var(--color-text-main);
        }

        .notif-btn {
          background: white;
          padding: 10px;
          border-radius: 50%;
          box-shadow: var(--shadow-sm);
          position: relative;
        }

        .badge {
          position: absolute;
          top: 8px;
          right: 8px;
          width: 8px;
          height: 8px;
          background: var(--color-danger);
          border-radius: 50%;
          border: 1px solid white;
        }

        .stats-preview {
          margin-bottom: var(--spacing-xl);
        }

        .stat-card {
           background: linear-gradient(135deg, #4CC9F0 0%, #4361EE 100%);
           color: white;
           padding: var(--spacing-lg);
           border-radius: var(--radius-lg);
           box-shadow: var(--shadow-md);
        }

        .options-grid {
          display: flex;
          flex-direction: column;
          gap: var(--spacing-md);
        }

        .option-card {
          display: flex;
          align-items: center;
          gap: var(--spacing-md);
          background: white;
          padding: var(--spacing-md);
          border-radius: var(--radius-lg);
          border: 1px solid rgba(0,0,0,0.04);
          box-shadow: var(--shadow-sm);
          text-align: left;
          width: 100%;
          transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .option-card:hover { /* Desktop hover */
           transform: translateY(-2px);
           box-shadow: var(--shadow-md);
           border-color: var(--hover-color);
        }

        .option-card:active {
           transform: scale(0.98);
        }

        .icon-box {
          width: 50px;
          height: 50px;
          border-radius: var(--radius-md);
          display: flex;
          align-items: center;
          justify-content: center;
          flex-shrink: 0;
        }

        .text-box {
          flex: 1;
        }

        .text-box h4 {
           margin-bottom: 2px;
           color: var(--color-text-main);
        }

        .text-box p {
           font-size: var(--font-size-xs);
           color: var(--color-text-secondary);
        }

        .arrow {
          color: var(--color-text-muted);
          font-weight: bold;
        }
      `})]})},wQ=({userProfile:n,onBack:e})=>{const[t,i]=xe.useState("metric"),[r,s]=xe.useState(""),[a,o]=xe.useState(""),[l,u]=xe.useState(""),[c,h]=xe.useState(""),[f,m]=xe.useState("male"),[y,_]=xe.useState("sedentary"),[x,v]=xe.useState(null),[w,E]=xe.useState(""),[k,$]=xe.useState(""),[L,I]=xe.useState("");xe.useEffect(()=>{n&&(n.height&&s(n.height),n.weight&&u(n.weight),n.age&&h(n.age),n.gender&&m(n.gender.toLowerCase()))},[n]);const C=()=>{let O=0,V=0;if(t==="metric"){if(!r||!l)return;O=parseFloat(r)/100,V=parseFloat(l)}else{if(!r||!l)return;O=(parseFloat(r)*12+(parseFloat(a)||0))*.0254,V=parseFloat(l)*.453592}if(O<=0||V<=0)return;const U=parseFloat((V/(O*O)).toFixed(1));v(U);let j="",he="",me="";U<18.5?(j="Underweight",he="var(--color-accent)",me="You may need to increase your calorie intake. Focus on nutrient-dense foods."):U<24.9?(j="Normal Weight",he="var(--color-success)",me="Great job! You have a healthy body weight. Maintain it with balanced diet and exercise."):U<29.9?(j="Overweight",he="var(--color-warning)",me="Try to incorporate more cardio and monitor portion sizes to reach a healthier range."):(j="Obese",he="var(--color-danger)",me="It is recommended to consult a healthcare provider for a personalized weight management plan."),E({label:j,color:he}),I(me);const oe=O/.0254-60;let G=0;f==="male"?G=52+1.9*Math.max(0,oe):G=49+1.7*Math.max(0,oe),$(`${G.toFixed(1)} - ${(G*1.1).toFixed(1)} kg`)},N=()=>{v(null),s(""),u(""),h("")};return T.jsxs("div",{className:"advanced-bmi-container fade-in",children:[T.jsxs("div",{className:"bmi-header",children:[T.jsx("button",{onClick:e,className:"btn-icon",children:T.jsx(tl,{size:24})}),T.jsx("h2",{children:"Advanced BMI Calculator"}),T.jsx("div",{style:{width:24}})," "]}),T.jsxs("div",{className:"calculator-grid",children:[T.jsxs("div",{className:"card input-card",children:[T.jsxs("div",{className:"toggle-row",children:[T.jsx("button",{className:`toggle-btn ${t==="metric"?"active":""}`,onClick:()=>i("metric"),children:"Metric (cm/kg)"}),T.jsx("button",{className:`toggle-btn ${t==="imperial"?"active":""}`,onClick:()=>i("imperial"),children:"Imperial (ft/lbs)"})]}),T.jsxs("div",{className:"form-row",children:[T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:"Gender"}),T.jsxs("select",{value:f,onChange:O=>m(O.target.value),children:[T.jsx("option",{value:"male",children:"Male"}),T.jsx("option",{value:"female",children:"Female"})]})]}),T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:"Age (years)"}),T.jsx("input",{type:"number",value:c,onChange:O=>h(O.target.value),placeholder:"25"})]})]}),T.jsxs("div",{className:"form-row",children:[T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:t==="metric"?"Height (cm)":"Height (ft)"}),T.jsx("input",{type:"number",value:r,onChange:O=>s(O.target.value),placeholder:t==="metric"?"175":"5"})]}),t==="imperial"&&T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:"Inches"}),T.jsx("input",{type:"number",value:a,onChange:O=>o(O.target.value),placeholder:"10"})]}),T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:t==="metric"?"Weight (kg)":"Weight (lbs)"}),T.jsx("input",{type:"number",value:l,onChange:O=>u(O.target.value),placeholder:t==="metric"?"70":"150"})]})]}),T.jsxs("div",{className:"form-group",children:[T.jsx("label",{children:"Activity Level"}),T.jsxs("select",{value:y,onChange:O=>_(O.target.value),children:[T.jsx("option",{value:"sedentary",children:"Sedentary (Little or no exercise)"}),T.jsx("option",{value:"light",children:"Lightly active (1-3 days/week)"}),T.jsx("option",{value:"moderate",children:"Moderately active (3-5 days/week)"}),T.jsx("option",{value:"active",children:"Very active (6-7 days/week)"})]})]}),T.jsxs("div",{className:"action-row",children:[T.jsx("button",{className:"reset-btn",onClick:N,children:T.jsx(aQ,{size:18})}),T.jsx("button",{className:"calculate-btn",onClick:C,children:"Calculate BMI"})]})]}),x&&T.jsxs("div",{className:"card result-card fade-in",children:[T.jsxs("div",{className:"result-header",children:[T.jsx("h3",{children:"Your Result"}),T.jsx("div",{className:"bmi-badge",style:{backgroundColor:w.color},children:w.label})]}),T.jsxs("div",{className:"bmi-display",children:[T.jsx("span",{className:"bmi-number",style:{color:w.color},children:x}),T.jsx("span",{className:"bmi-label",children:"BMI Score"})]}),T.jsxs("div",{className:"progress-bar-container",children:[T.jsx("div",{className:"progress-track"}),T.jsx("div",{className:"progress-fill",style:{width:`${Math.min(Math.max(x/40*100,0),100)}%`,backgroundColor:w.color}}),T.jsxs("div",{className:"markers",children:[T.jsx("span",{style:{left:"46%"},children:"18.5"}),T.jsx("span",{style:{left:"62.5%"},children:"25"}),T.jsx("span",{style:{left:"75%"},children:"30"})]})]}),T.jsxs("div",{className:"health-insight",children:[T.jsxs("div",{className:"insight-item",children:[T.jsx(Ez,{size:20,className:"icon"}),T.jsxs("div",{children:[T.jsx("h4",{children:"Ideal Weight"}),T.jsx("p",{children:k})]})]}),T.jsxs("div",{className:"insight-item",children:[T.jsx(Tz,{size:20,className:"icon"}),T.jsxs("div",{children:[T.jsx("h4",{children:"Health Tip"}),T.jsx("p",{children:L})]})]})]})]})]}),T.jsx("style",{children:`
                .advanced-bmi-container {
                    padding: 20px;
                    max-width: 600px;
                    margin: 0 auto;
                }
                .bmi-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 25px;
                }
                .btn-icon { background: none; color: var(--color-text-main); padding: 0; }
                
                .toggle-row {
                    display: flex;
                    background: #f1f5f9;
                    border-radius: 12px;
                    padding: 4px;
                    margin-bottom: 20px;
                }
                .toggle-btn {
                    flex: 1;
                    padding: 10px;
                    border-radius: 8px;
                    background: transparent;
                    color: #64748b;
                    font-weight: 600;
                    font-size: 14px;
                    transition: all 0.2s;
                }
                .toggle-btn.active {
                    background: white;
                    color: var(--color-primary);
                    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                }

                .form-row {
                    display: flex;
                    gap: 15px;
                    margin-bottom: 15px;
                }
                .form-group { flex: 1; }
                .form-group label {
                    display: block;
                    font-size: 13px;
                    font-weight: 600;
                    color: #475569;
                    margin-bottom: 6px;
                }
                .form-group input, .form-group select {
                    width: 100%;
                    padding: 12px;
                    border: 1px solid #e2e8f0;
                    border-radius: 10px;
                    font-size: 16px;
                    background: #fff;
                    transition: border-color 0.2s;
                }
                .form-group input:focus, .form-group select:focus {
                    outline: none;
                    border-color: var(--color-primary);
                }

                .action-row {
                    display: flex;
                    gap: 10px;
                    margin-top: 25px;
                }
                .reset-btn {
                    width: 48px;
                    background: #f1f5f9;
                    color: #64748b;
                    border-radius: 12px;
                    display: flex; align-items: center; justify-content: center;
                }
                .calculate-btn {
                    flex: 1;
                    background: var(--color-primary);
                    color: white;
                    padding: 14px;
                    border-radius: 12px;
                    font-weight: 600;
                    font-size: 16px;
                    box-shadow: 0 4px 12px rgba(230, 57, 70, 0.25);
                }
                .calculate-btn:active { transform: scale(0.98); }

                /* Result Card Styles */
                .result-card {
                    margin-top: 25px;
                    border: 1px solid #e2e8f0;
                }
                .result-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    border-bottom: 1px solid #f1f5f9;
                    padding-bottom: 15px;
                    margin-bottom: 20px;
                }
                .bmi-badge {
                    padding: 6px 12px;
                    border-radius: 99px;
                    color: white;
                    font-size: 12px;
                    font-weight: 700;
                    text-transform: uppercase;
                }
                
                .bmi-display {
                    text-align: center;
                    margin-bottom: 25px;
                }
                .bmi-number {
                    display: block;
                    font-size: 4rem;
                    font-weight: 800;
                    line-height: 1;
                }
                .bmi-label {
                    color: #94a3b8;
                    font-size: 14px;
                    font-weight: 500;
                }

                .progress-bar-container {
                    position: relative;
                    height: 12px;
                    background: #f1f5f9;
                    border-radius: 99px;
                    margin-bottom: 30px;
                }
                .progress-fill {
                    height: 100%;
                    border-radius: 99px;
                    transition: width 1s ease-out;
                }
                .markers {
                    position: absolute;
                    top: 15px;
                    left: 0;
                    width: 100%;
                    height: 20px;
                }
                .markers span {
                    position: absolute;
                    transform: translateX(-50%);
                    font-size: 10px;
                    color: #94a3b8;
                    font-weight: 600;
                }
                .markers span::before {
                    content: '';
                    position: absolute;
                    top: -15px;
                    left: 50%;
                    width: 2px;
                    height: 12px;
                    background: white;
                    transform: translateX(-50%);
                }

                .health-insight {
                    background: #f8fafc;
                    border-radius: 12px;
                    padding: 15px;
                    display: flex;
                    flex-direction: column;
                    gap: 15px;
                }
                .insight-item {
                    display: flex;
                    gap: 15px;
                    align-items: flex-start;
                }
                .insight-item .icon {
                    color: var(--color-primary);
                    margin-top: 2px;
                }
                .insight-item h4 {
                    font-size: 14px;
                    margin-bottom: 4px;
                    color: var(--color-text-main);
                }
                .insight-item p {
                    font-size: 13px;
                    color: #64748b;
                    line-height: 1.4;
                }

                .fade-in { animation: fadeIn 0.4s ease-out; }
                @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
            `})]})};var bQ={exports:{}};(function(n){var e=function(t){var i=Object.prototype,r=i.hasOwnProperty,s=Object.defineProperty||function(W,K,H){W[K]=H.value},a,o=typeof Symbol=="function"?Symbol:{},l=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function h(W,K,H){return Object.defineProperty(W,K,{value:H,enumerable:!0,configurable:!0,writable:!0}),W[K]}try{h({},"")}catch{h=function(K,H,Q){return K[H]=Q}}function f(W,K,H,Q){var Y=K&&K.prototype instanceof E?K:E,Z=Object.create(Y.prototype),fe=new te(Q||[]);return s(Z,"_invoke",{value:U(W,H,fe)}),Z}t.wrap=f;function m(W,K,H){try{return{type:"normal",arg:W.call(K,H)}}catch(Q){return{type:"throw",arg:Q}}}var y="suspendedStart",_="suspendedYield",x="executing",v="completed",w={};function E(){}function k(){}function $(){}var L={};h(L,l,function(){return this});var I=Object.getPrototypeOf,C=I&&I(I(oe([])));C&&C!==i&&r.call(C,l)&&(L=C);var N=$.prototype=E.prototype=Object.create(L);k.prototype=$,s(N,"constructor",{value:$,configurable:!0}),s($,"constructor",{value:k,configurable:!0}),k.displayName=h($,c,"GeneratorFunction");function O(W){["next","throw","return"].forEach(function(K){h(W,K,function(H){return this._invoke(K,H)})})}t.isGeneratorFunction=function(W){var K=typeof W=="function"&&W.constructor;return K?K===k||(K.displayName||K.name)==="GeneratorFunction":!1},t.mark=function(W){return Object.setPrototypeOf?Object.setPrototypeOf(W,$):(W.__proto__=$,h(W,c,"GeneratorFunction")),W.prototype=Object.create(N),W},t.awrap=function(W){return{__await:W}};function V(W,K){function H(Z,fe,_e,X){var de=m(W[Z],W,fe);if(de.type==="throw")X(de.arg);else{var Ee=de.arg,$e=Ee.value;return $e&&typeof $e=="object"&&r.call($e,"__await")?K.resolve($e.__await).then(function(je){H("next",je,_e,X)},function(je){H("throw",je,_e,X)}):K.resolve($e).then(function(je){Ee.value=je,_e(Ee)},function(je){return H("throw",je,_e,X)})}}var Q;function Y(Z,fe){function _e(){return new K(function(X,de){H(Z,fe,X,de)})}return Q=Q?Q.then(_e,_e):_e()}s(this,"_invoke",{value:Y})}O(V.prototype),h(V.prototype,u,function(){return this}),t.AsyncIterator=V,t.async=function(W,K,H,Q,Y){Y===void 0&&(Y=Promise);var Z=new V(f(W,K,H,Q),Y);return t.isGeneratorFunction(K)?Z:Z.next().then(function(fe){return fe.done?fe.value:Z.next()})};function U(W,K,H){var Q=y;return function(Z,fe){if(Q===x)throw new Error("Generator is already running");if(Q===v){if(Z==="throw")throw fe;return G()}for(H.method=Z,H.arg=fe;;){var _e=H.delegate;if(_e){var X=j(_e,H);if(X){if(X===w)continue;return X}}if(H.method==="next")H.sent=H._sent=H.arg;else if(H.method==="throw"){if(Q===y)throw Q=v,H.arg;H.dispatchException(H.arg)}else H.method==="return"&&H.abrupt("return",H.arg);Q=x;var de=m(W,K,H);if(de.type==="normal"){if(Q=H.done?v:_,de.arg===w)continue;return{value:de.arg,done:H.done}}else de.type==="throw"&&(Q=v,H.method="throw",H.arg=de.arg)}}}function j(W,K){var H=K.method,Q=W.iterator[H];if(Q===a)return K.delegate=null,H==="throw"&&W.iterator.return&&(K.method="return",K.arg=a,j(W,K),K.method==="throw")||H!=="return"&&(K.method="throw",K.arg=new TypeError("The iterator does not provide a '"+H+"' method")),w;var Y=m(Q,W.iterator,K.arg);if(Y.type==="throw")return K.method="throw",K.arg=Y.arg,K.delegate=null,w;var Z=Y.arg;if(!Z)return K.method="throw",K.arg=new TypeError("iterator result is not an object"),K.delegate=null,w;if(Z.done)K[W.resultName]=Z.value,K.next=W.nextLoc,K.method!=="return"&&(K.method="next",K.arg=a);else return Z;return K.delegate=null,w}O(N),h(N,c,"Generator"),h(N,l,function(){return this}),h(N,"toString",function(){return"[object Generator]"});function he(W){var K={tryLoc:W[0]};1 in W&&(K.catchLoc=W[1]),2 in W&&(K.finallyLoc=W[2],K.afterLoc=W[3]),this.tryEntries.push(K)}function me(W){var K=W.completion||{};K.type="normal",delete K.arg,W.completion=K}function te(W){this.tryEntries=[{tryLoc:"root"}],W.forEach(he,this),this.reset(!0)}t.keys=function(W){var K=Object(W),H=[];for(var Q in K)H.push(Q);return H.reverse(),function Y(){for(;H.length;){var Z=H.pop();if(Z in K)return Y.value=Z,Y.done=!1,Y}return Y.done=!0,Y}};function oe(W){if(W){var K=W[l];if(K)return K.call(W);if(typeof W.next=="function")return W;if(!isNaN(W.length)){var H=-1,Q=function Y(){for(;++H<W.length;)if(r.call(W,H))return Y.value=W[H],Y.done=!1,Y;return Y.value=a,Y.done=!0,Y};return Q.next=Q}}return{next:G}}t.values=oe;function G(){return{value:a,done:!0}}return te.prototype={constructor:te,reset:function(W){if(this.prev=0,this.next=0,this.sent=this._sent=a,this.done=!1,this.delegate=null,this.method="next",this.arg=a,this.tryEntries.forEach(me),!W)for(var K in this)K.charAt(0)==="t"&&r.call(this,K)&&!isNaN(+K.slice(1))&&(this[K]=a)},stop:function(){this.done=!0;var W=this.tryEntries[0],K=W.completion;if(K.type==="throw")throw K.arg;return this.rval},dispatchException:function(W){if(this.done)throw W;var K=this;function H(X,de){return Z.type="throw",Z.arg=W,K.next=X,de&&(K.method="next",K.arg=a),!!de}for(var Q=this.tryEntries.length-1;Q>=0;--Q){var Y=this.tryEntries[Q],Z=Y.completion;if(Y.tryLoc==="root")return H("end");if(Y.tryLoc<=this.prev){var fe=r.call(Y,"catchLoc"),_e=r.call(Y,"finallyLoc");if(fe&&_e){if(this.prev<Y.catchLoc)return H(Y.catchLoc,!0);if(this.prev<Y.finallyLoc)return H(Y.finallyLoc)}else if(fe){if(this.prev<Y.catchLoc)return H(Y.catchLoc,!0)}else if(_e){if(this.prev<Y.finallyLoc)return H(Y.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(W,K){for(var H=this.tryEntries.length-1;H>=0;--H){var Q=this.tryEntries[H];if(Q.tryLoc<=this.prev&&r.call(Q,"finallyLoc")&&this.prev<Q.finallyLoc){var Y=Q;break}}Y&&(W==="break"||W==="continue")&&Y.tryLoc<=K&&K<=Y.finallyLoc&&(Y=null);var Z=Y?Y.completion:{};return Z.type=W,Z.arg=K,Y?(this.method="next",this.next=Y.finallyLoc,w):this.complete(Z)},complete:function(W,K){if(W.type==="throw")throw W.arg;return W.type==="break"||W.type==="continue"?this.next=W.arg:W.type==="return"?(this.rval=this.arg=W.arg,this.method="return",this.next="end"):W.type==="normal"&&K&&(this.next=K),w},finish:function(W){for(var K=this.tryEntries.length-1;K>=0;--K){var H=this.tryEntries[K];if(H.finallyLoc===W)return this.complete(H.completion,H.afterLoc),me(H),w}},catch:function(W){for(var K=this.tryEntries.length-1;K>=0;--K){var H=this.tryEntries[K];if(H.tryLoc===W){var Q=H.completion;if(Q.type==="throw"){var Y=Q.arg;me(H)}return Y}}throw new Error("illegal catch attempt")},delegateYield:function(W,K,H){return this.delegate={iterator:oe(W),resultName:K,nextLoc:H},this.method==="next"&&(this.arg=a),w}},t}(n.exports);try{regeneratorRuntime=e}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})(bQ);var lC=(n,e)=>`${n}-${e}-${Math.random().toString(16).slice(3,8)}`;const xQ=lC;let gP=0;var Cz=({id:n,action:e,payload:t={}})=>{let i=n;return typeof i>"u"&&(i=xQ("Job",gP),gP+=1),{id:i,action:e,payload:t}},Jp={};let uC=!1;Jp.logging=uC;Jp.setLogging=n=>{uC=n};Jp.log=(...n)=>uC?console.log.apply(void 0,n):null;const EQ=Cz,{log:b0}=Jp,AQ=lC;let yP=0;var TQ=()=>{const n=AQ("Scheduler",yP),e={},t={};let i=[];yP+=1;const r=()=>i.length,s=()=>Object.keys(e).length,a=()=>{if(i.length!==0){const h=Object.keys(e);for(let f=0;f<h.length;f+=1)if(typeof t[h[f]]>"u"){i[0](e[h[f]]);break}}},o=(h,f)=>new Promise((m,y)=>{const _=EQ({action:h,payload:f});i.push(async x=>{i.shift(),t[x.id]=_;try{m(await x[h].apply(void 0,[...f,_.id]))}catch(v){y(v)}finally{delete t[x.id],a()}}),b0(`[${n}]: Add ${_.id} to JobQueue`),b0(`[${n}]: JobQueue length=${i.length}`),a()});return{addWorker:h=>(e[h.id]=h,b0(`[${n}]: Add ${h.id}`),b0(`[${n}]: Number of workers=${s()}`),a(),h.id),addJob:async(h,...f)=>{if(s()===0)throw Error(`[${n}]: You need to have at least one worker before adding jobs`);return o(h,f)},terminate:async()=>{Object.keys(e).forEach(async h=>{await e[h].terminate()}),i=[]},getQueueLen:r,getNumWorkers:s}};function SQ(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}function IQ(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}var CQ=IQ;const kQ=CQ;var $Q=n=>{const e={};return typeof WorkerGlobalScope<"u"?e.type="webworker":kQ()?e.type="electron":typeof document=="object"?e.type="browser":typeof process=="object"&&typeof SQ=="function"&&(e.type="node"),typeof n>"u"?e:e[n]};const RQ=$Q("type")==="browser",PQ=RQ?n=>new URL(n,window.location.href).href:n=>n;var NQ=n=>{const e={...n};return["corePath","workerPath","langPath"].forEach(t=>{n[t]&&(e[t]=PQ(e[t]))}),e},DQ=n=>{const e=[],t=[],i=[],r=[],s=[];return n.blocks&&n.blocks.forEach(a=>{a.paragraphs.forEach(o=>{o.lines.forEach(l=>{l.words.forEach(u=>{u.symbols.forEach(c=>{s.push({...c,page:n,block:a,paragraph:o,line:l,word:u})}),r.push({...u,page:n,block:a,paragraph:o,line:l})}),i.push({...l,page:n,block:a,paragraph:o})}),t.push({...o,page:n,block:a})}),e.push({...a,page:n})}),{...n,blocks:e,paragraphs:t,lines:i,words:r,symbols:s}},kz={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const MQ="5.1.1",OQ={version:MQ};var LQ={workerBlobURL:!0,logger:()=>{}};const FQ=OQ.version,zQ=LQ;var VQ={...zQ,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${FQ}/dist/worker.min.js`},jQ=({workerPath:n,workerBlobURL:e})=>{let t;if(Blob&&URL&&e){const i=new Blob([`importScripts("${n}");`],{type:"application/javascript"});t=new Worker(URL.createObjectURL(i))}else t=new Worker(n);return t},BQ=n=>{n.terminate()},UQ=(n,e)=>{n.onmessage=({data:t})=>{e(t)}},HQ=async(n,e)=>{n.postMessage(e)};const gE=n=>new Promise((e,t)=>{const i=new FileReader;i.onload=()=>{e(i.result)},i.onerror=({target:{error:{code:r}}})=>{t(Error(`File could not be read! Code=${r}`))},i.readAsArrayBuffer(n)}),qT=async n=>{let e=n;if(typeof n>"u")return"undefined";if(typeof n=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(n)?e=atob(n.split(",")[1]).split("").map(t=>t.charCodeAt(0)):e=await(await fetch(n)).arrayBuffer();else if(typeof HTMLElement<"u"&&n instanceof HTMLElement)n.tagName==="IMG"&&(e=await qT(n.src)),n.tagName==="VIDEO"&&(e=await qT(n.poster)),n.tagName==="CANVAS"&&await new Promise(t=>{n.toBlob(async i=>{e=await gE(i),t()})});else if(typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas){const t=await n.convertToBlob();e=await gE(t)}else(n instanceof File||n instanceof Blob)&&(e=await gE(n));return new Uint8Array(e)};var WQ=qT;const qQ=VQ,GQ=jQ,KQ=BQ,YQ=UQ,XQ=HQ,QQ=WQ;var JQ={defaultOptions:qQ,spawnWorker:GQ,terminateWorker:KQ,onMessage:YQ,send:XQ,loadImage:QQ};const ZQ=NQ,eJ=DQ,ms=Cz,{log:_P}=Jp,tJ=lC,lc=kz,{defaultOptions:nJ,spawnWorker:iJ,terminateWorker:rJ,onMessage:sJ,loadImage:vP,send:aJ}=JQ;let wP=0;var $z=async(n="eng",e=lc.LSTM_ONLY,t={},i={})=>{const r=tJ("Worker",wP),{logger:s,errorHandler:a,...o}=ZQ({...nJ,...t}),l={},u={},c=typeof n=="string"?n.split("+"):n;let h=e,f=i;const m=[lc.DEFAULT,lc.LSTM_ONLY].includes(e)&&!o.legacyCore;let y,_;const x=new Promise((Y,Z)=>{_=Y,y=Z}),v=Y=>{y(Y.message)};let w=iJ(o);w.onerror=v,wP+=1;const E=(Y,Z)=>{l[Y]=Z},k=(Y,Z)=>{u[Y]=Z},$=({id:Y,action:Z,payload:fe})=>new Promise((_e,X)=>{_P(`[${r}]: Start ${Y}, action=${Z}`);const de=`${Z}-${Y}`;E(de,_e),k(de,X),aJ(w,{workerId:r,jobId:Y,action:Z,payload:fe})}),L=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),I=Y=>$(ms({id:Y,action:"load",payload:{options:{lstmOnly:m,corePath:o.corePath,logging:o.logging}}})),C=(Y,Z,fe)=>$(ms({id:fe,action:"FS",payload:{method:"writeFile",args:[Y,Z]}})),N=(Y,Z)=>$(ms({id:Z,action:"FS",payload:{method:"readFile",args:[Y,{encoding:"utf8"}]}})),O=(Y,Z)=>$(ms({id:Z,action:"FS",payload:{method:"unlink",args:[Y]}})),V=(Y,Z,fe)=>$(ms({id:fe,action:"FS",payload:{method:Y,args:Z}})),U=()=>console.warn("`loadLanguage` is depreciated and should be removed from code (workers now come with language pre-loaded)"),j=(Y,Z)=>$(ms({id:Z,action:"loadLanguage",payload:{langs:Y,options:{langPath:o.langPath,dataPath:o.dataPath,cachePath:o.cachePath,cacheMethod:o.cacheMethod,gzip:o.gzip,lstmOnly:[lc.DEFAULT,lc.LSTM_ONLY].includes(h)&&!o.legacyLang}}})),he=()=>console.warn("`initialize` is depreciated and should be removed from code (workers now come pre-initialized)"),me=(Y,Z,fe,_e)=>$(ms({id:_e,action:"initialize",payload:{langs:Y,oem:Z,config:fe}})),te=(Y="eng",Z,fe,_e)=>{if(m&&[lc.TESSERACT_ONLY,lc.TESSERACT_LSTM_COMBINED].includes(Z))throw Error("Legacy model requested but code missing.");const X=Z||h;h=X;const de=fe||f;f=de;const $e=(typeof Y=="string"?Y.split("+"):Y).filter(je=>!c.includes(je));return c.push(...$e),$e.length>0?j($e,_e).then(()=>me(Y,X,de,_e)):me(Y,X,de,_e)},oe=(Y={},Z)=>$(ms({id:Z,action:"setParameters",payload:{params:Y}})),G=async(Y,Z={},fe={blocks:!0,text:!0,hocr:!0,tsv:!0},_e)=>$(ms({id:_e,action:"recognize",payload:{image:await vP(Y),options:Z,output:fe}})),W=(Y="Tesseract OCR Result",Z=!1,fe)=>(console.log("`getPDF` function is depreciated. `recognize` option `savePDF` should be used instead."),$(ms({id:fe,action:"getPDF",payload:{title:Y,textonly:Z}}))),K=async(Y,Z)=>{if(m)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return $(ms({id:Z,action:"detect",payload:{image:await vP(Y)}}))},H=async()=>(w!==null&&(rJ(w),w=null),Promise.resolve());sJ(w,({workerId:Y,jobId:Z,status:fe,action:_e,data:X})=>{const de=`${_e}-${Z}`;if(fe==="resolve"){_P(`[${Y}]: Complete ${Z}`);let Ee=X;_e==="recognize"?Ee=eJ(X):_e==="getPDF"&&(Ee=Array.from({...X,length:Object.keys(X).length})),l[de]({jobId:Z,data:Ee})}else if(fe==="reject")if(u[de](X),_e==="load"&&y(X),a)a(X);else throw Error(X);else fe==="progress"&&s({...X,userJobId:Z})});const Q={id:r,worker:w,setResolve:E,setReject:k,load:L,writeText:C,readText:N,removeFile:O,FS:V,loadLanguage:U,initialize:he,reinitialize:te,setParameters:oe,recognize:G,getPDF:W,detect:K,terminate:H};return I().then(()=>j(n)).then(()=>me(n,e,i)).then(()=>_(Q)).catch(()=>{}),x};const Rz=$z,oJ=async(n,e,t)=>{const i=await Rz(e,1,t);return i.recognize(n).finally(async()=>{await i.terminate()})},lJ=async(n,e)=>{const t=await Rz("osd",0,e);return t.detect(n).finally(async()=>{await t.terminate()})};var uJ={recognize:oJ,detect:lJ},cJ={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},dJ={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"};const hJ=TQ,fJ=$z,pJ=uJ,mJ=cJ,gJ=kz,yJ=dJ,{setLogging:_J}=Jp;var vJ={languages:mJ,OEM:gJ,PSM:yJ,createScheduler:hJ,createWorker:fJ,setLogging:_J,...pJ};const GT=A3(vJ),bP={hemoglobin:["hemoglobin","haemoglobin","hb","hgb"],rbc_count:["rbc count","total rbc","red blood cells","erythrocyte count"],total_count:["total leucocyte count","tlc","wbc count","white blood cells","total count","leukocyte count","white cells","total wbc","t.l.c"],platelet_count:["platelet count","platelet","plt","thrombocyte count","platelets"],hematocrit:["hematocrit","hct","pcv","packed cell volume"],mcv:["mcv","mean corpuscular volume"],mch:["mch","mean corpuscular hemoglobin"],mchc:["mchc","mean corpuscular hemoglobin concentration"],rdw:["rdw","red cell distribution width","rdw-cv","rdw-sd"],neutrophil:["neutrophils","polymorphs","neutrophil","neutrophil %"],lymphocyte:["lymphocytes","lymphocyte","lymphocyte %"],monocyte:["monocytes","monocyte","monocyte %"],eosinophil:["eosinophils","eosinophil","eosinophil %"],basophil:["basophils","basophil","basophil %"],reticulocyte_count:["reticulocyte count","retic count"],esr:["esr","erythrocyte sedimentation rate"],absolute_neutrophil_count:["absolute neutrophil count","anc"],absolute_lymphocyte_count:["absolute lymphocyte count","alc"],absolute_monocyte_count:["absolute monocyte count"],absolute_eosinophil_count:["absolute eosinophil count","aec"],mpv:["mpv","mean platelet volume"],pdw:["pdw","platelet distribution width"],pct:["pct","plateletcrit"],bun:["blood urea nitrogen","bun"],creatinine:["serum creatinine","creatinine"],urea:["blood urea","urea","serum urea"],uric_acid:["serum uric acid","uric acid"],bun_creatinine_ratio:["bun/creatinine ratio","bun/creat ratio"],egfr:["egfr","estimated glomerular filtration rate"],urine_ph:["urine ph","reaction (ph)"],urine_specific_gravity:["urine specific gravity","sp. gravity"],urine_pus_cells:["pus cells","leukocytes (urine)"],urine_rbc:["rbc (urine)","red blood cells (urine)"],urine_protein:["albumin (urine)","protein (urine)"],urine_sugar:["sugar (urine)","glucose (urine)"],bilirubin_total:["total bilirubin","bilirubin total"],bilirubin_direct:["direct bilirubin","conjugated bilirubin"],bilirubin_indirect:["indirect bilirubin","unconjugated bilirubin"],sgot:["sgot","ast","aspartate aminotransferase"],sgpt:["sgpt","alt","alanine aminotransferase"],alkaline_phosphatase:["alkaline phosphatase","alp"],total_protein:["total protein","serum protein"],albumin:["albumin"],globulin:["globulin"],ag_ratio:["a/g ratio","albumin/globulin ratio"],ggt:["gamma gt","ggt","gamma-glutamyl transferase"],ldh:["ldh","lactate dehydrogenase"],ammonia:["ammonia"],sodium:["sodium","na+","serum sodium"],potassium:["potassium","k+","serum potassium"],chloride:["chloride","cl-","serum chloride"],bicarbonate:["bicarbonate","hco3","co2 content","carbon dioxide"],calcium:["calcium","total calcium"],ionized_calcium:["ionized calcium"],phosphorus:["phosphorus","phosphate","po4"],magnesium:["magnesium"],anion_gap:["anion gap"],glucose_fasting:["glucose fasting","fasting glucose","fbs","fasting blood sugar","glucose"],glucose_pp:["glucose pp","ppbs","post prandial"],glucose_random:["random glucose","rbs"],hba1c:["hba1c","glycated hemoglobin","glycosylated hemoglobin"],insulin:["insulin fasting","fasting insulin"],c_peptide:["c-peptide"],cholesterol:["total cholesterol","serum cholesterol","cholesterol"],hdl_cholesterol:["hdl cholesterol","hdl"],ldl_cholesterol:["ldl cholesterol","ldl","ldl chol., calculated"],triglycerides:["triglycerides"],vldl:["vldl"],ldl_hdl_ratio:["ldl/hdl ratio"],chol_hdl_ratio:["total cholesterol/hdl ratio","chol/hdl","chol/hdl ratio"],non_hdl_cholesterol:["non-hdl cholesterol"],tsh:["thyroid stimulating hormone","tsh","thyrotropin"],t3:["triiodothyronine","total t3","t3"],t4:["thyroxine","total t4","t4"],free_t3:["free t3","ft3"],free_t4:["free t4","ft4","free thyroxine"],anti_tpo:["anti-tpo","thyroid peroxidase antibody"],vitamin_b12:["vitamin b12","cobalamin"],vitamin_d:["vitamin d","25-oh vitamin d","total vitamin d"],folate:["folate","folic acid"],testosterone:["testosterone","total testosterone"],estradiol:["estradiol","e2"],progesterone:["progesterone"],cortisol:["cortisol"],prolactin:["prolactin"],ferritin:["ferritin"],iron:["serum iron","iron"],tibc:["tibc","total iron binding capacity"],transferrin_saturation:["transferrin saturation","% saturation","transferrin sat"],crp:["crp","c-reactive protein"],hs_crp:["hs-crp","high sensitivity crp"],troponin_i:["troponin i"],troponin_t:["troponin t"],ck_total:["ck","cpk","creatine kinase"],ck_mb:["ck-mb"],amylase:["amylase","serum amylase","amylase, serum"],lipase:["lipase","serum lipase"],granulocyte:["granulocyte","gra#","gra%","granulocytes"],ldh:["ldh","lactate dehydrogenase","ld"],globulin:["globulin","globulin, calculated"]},nf={hemoglobin:{min:13,max:17,unit:"g/dL",foods:["Spinach","Red Meat","Beetroot"],impact:{low:"Fatigue, low stamina. Focus on endurance cautiously.",high:"Dehydration risk. Hydrate well."}},rbc_count:{min:4.5,max:5.9,unit:"mil/L",foods:["Iron-rich foods","B12"],impact:{}},total_count:{min:4e3,max:11e3,unit:"/L",foods:["Vitamin C","Garlic"],impact:{low:"Low immunity. Avoid growing crowds/gyms.",high:"Body fighting infection. Rest."}},platelet_count:{min:1.5,max:4.5,unit:"Lakh/L",foods:["Papaya Leaf"],impact:{low:"Bleeding risk. Avoid contact sports."}},hematocrit:{min:38,max:50,unit:"%",foods:["Iron","Water"],impact:{}},mcv:{min:80,max:100,unit:"fL",foods:["B12","Folate"],impact:{low:"Microcytic anemia risk.",high:"Macrocytic (B12 deficiency) risk."}},mch:{min:27,max:33,unit:"pg",foods:[],impact:{}},mchc:{min:32,max:36,unit:"g/dL",foods:[],impact:{}},rdw:{min:11.5,max:14.5,unit:"%",foods:[],impact:{}},neutrophil:{min:40,max:75,unit:"%",foods:[],impact:{high:"Bacterial infection likely. Rest."}},lymphocyte:{min:20,max:45,unit:"%",foods:[],impact:{high:"Viral infection likely. Rest."}},monocyte:{min:2,max:10,unit:"%",foods:[],impact:{}},eosinophil:{min:1,max:6,unit:"%",foods:[],impact:{high:"Allergy or parasite. Monitor breathing."}},basophil:{min:0,max:1,unit:"%",foods:[],impact:{}},esr:{min:0,max:20,unit:"mm/hr",foods:["Anti-inflammatory","Turmeric"],impact:{high:"High Inflammation. Focus on recovery, light stretching."}},bun:{min:7,max:20,unit:"mg/dL",foods:["Low Protein","Water"],impact:{high:"Kidney load high. Hydrate."}},creatinine:{min:.6,max:1.3,unit:"mg/dL",foods:["Less Red Meat","Cucumber"],impact:{high:"Kidney stress. Avoid creatine supplements."}},urea:{min:15,max:50,unit:"mg/dL",foods:["Low Protein","Water"],impact:{high:"High protein breakdown or kidney issue."}},uric_acid:{min:3.5,max:7.2,unit:"mg/dL",foods:["Cherries","No Alcohol"],impact:{high:"Gout risk. Avoid high-impact jumping."}},egfr:{min:90,max:150,unit:"mL/min",foods:[],impact:{low:"Kidney functionality concern. Consult doctor."}},sodium:{min:135,max:145,unit:"mmol/L",foods:["Balanced Salt"],impact:{low:"Hyponatremia risk. Salt intake needed.",high:"Dehydration."}},potassium:{min:3.5,max:5.1,unit:"mmol/L",foods:["Banana","Coconut Water"],impact:{low:"Cramp risk. Electrolytes needed.",high:"Heart rhythm risk. Medical attention."}},chloride:{min:96,max:106,unit:"mmol/L",foods:[],impact:{high:"Dehydration/Kidney issue."}},bicarbonate:{min:22,max:29,unit:"mmol/L",foods:[],impact:{high:"Metabolic Alkalosis.",low:"Metabolic Acidosis."}},calcium:{min:8.5,max:10.5,unit:"mg/dL",foods:["Milk","Yogurt"],impact:{low:"Bone weakness. Resistance train carefully."}},magnesium:{min:1.7,max:2.4,unit:"mg/dL",foods:["Nuts","Seeds"],impact:{low:"Muscle twitching/cramps."}},phosphorus:{min:2.5,max:4.5,unit:"mg/dL",foods:["Dairy","Meat"],impact:{low:"Weak bones/muscles."}},bilirubin_total:{min:.3,max:1.2,unit:"mg/dL",foods:["Radish","Lemon"],impact:{high:"Jaundice risk. No heavy lifting."}},bilirubin_direct:{min:0,max:.3,unit:"mg/dL",foods:[],impact:{}},sgot:{min:10,max:40,unit:"U/L",foods:["Liver Detox"],impact:{high:"Liver/Muscle stress. Take rest days."}},sgpt:{min:7,max:56,unit:"U/L",foods:["Whole grains"],impact:{high:"Liver enzyme elevation. Avoid alcohol/painkillers."}},alkaline_phosphatase:{min:44,max:147,unit:"U/L",foods:[],impact:{}},ggt:{min:9,max:48,unit:"U/L",foods:[],impact:{high:"Liver stress/Alcohol use."}},total_protein:{min:6.3,max:8.2,unit:"g/dL",foods:["Lean Protein"],impact:{}},albumin:{min:3.5,max:5,unit:"g/dL",foods:[],impact:{}},globulin:{min:2,max:3.5,unit:"g/dL",foods:[],impact:{high:"Infection/Inflammation."}},ag_ratio:{min:1,max:2.2,unit:"",foods:[],impact:{}},iron:{min:60,max:170,unit:"g/dL",foods:["Spinach"],impact:{low:"Anemia."}},tibc:{min:240,max:450,unit:"g/dL",foods:[],impact:{}},transferrin_saturation:{min:20,max:50,unit:"%",foods:[],impact:{low:"Iron deficiency."}},glucose_fasting:{min:70,max:100,unit:"mg/dL",foods:["Fiber","Low GI"],impact:{high:"Diabetes risk. Cardio recommended."}},glucose_pp:{min:70,max:140,unit:"mg/dL",foods:["Vegetables"],impact:{high:"Insulin resistance."}},hba1c:{min:4,max:5.6,unit:"%",foods:["Low Carb"],impact:{high:"Long term sugar control poor."}},insulin:{min:2,max:25,unit:"IU/mL",foods:[],impact:{}},cholesterol:{min:0,max:200,unit:"mg/dL",foods:["Oats","Garlic"],impact:{high:"Cardiac risk. Steady state cardio."}},hdl_cholesterol:{min:40,max:100,unit:"mg/dL",foods:["Nuts","Fish"],impact:{low:"Good cholesterol low. Needs exercise."}},ldl_cholesterol:{min:0,max:100,unit:"mg/dL",foods:["Fiber"],impact:{high:"Bad cholesterol. Diet control needed."}},triglycerides:{min:0,max:150,unit:"mg/dL",foods:["No Sugar","Fish Oil"],impact:{high:"Metabolic syndrome risk."}},tsh:{min:.4,max:4,unit:"IU/mL",foods:[],impact:{high:"Hypothyroid (Slow metabolism).",low:"Hyperthyroid (Fast HR)."}},t3:{min:80,max:200,unit:"ng/dL",foods:[],impact:{}},t4:{min:5,max:12,unit:"g/dL",foods:[],impact:{}},vitamin_b12:{min:200,max:900,unit:"pg/mL",foods:["Meat","Eggs","Supplements"],impact:{low:"Nerve health/Energy low."}},vitamin_d:{min:30,max:100,unit:"ng/mL",foods:["Sunlight","Mushrooms","Supplements"],impact:{low:"Bone density/Immunity risk."}},testosterone:{min:300,max:1e3,unit:"ng/dL",foods:["Zinc","Strength Training"],impact:{low:"Muscle loss, fatigue."}},cortisol:{min:5,max:25,unit:"g/dL",foods:["Ashwagandha","Sleep"],impact:{high:"High stress. Reduce intensity."}},ferritin:{min:20,max:300,unit:"ng/mL",foods:[],impact:{low:"Iron stores low."}},iron:{min:60,max:170,unit:"g/dL",foods:["Spinach"],impact:{low:"Anemia."}},crp:{min:0,max:10,unit:"mg/L",foods:["Anti-inflammatory"],impact:{high:"Systemic inflammation."}},hs_crp:{min:0,max:1,unit:"mg/L",foods:[],impact:{high:"Cardiac risk marker."}},troponin_i:{min:0,max:.04,unit:"ng/mL",foods:[],impact:{high:"CRITICAL: Heart muscle damage. ER immediately."}},ck_total:{min:20,max:200,unit:"U/L",foods:[],impact:{high:"Muscle breakdown (could be hard training or rhabdo)."}},mpv:{min:7,max:11,unit:"fL",foods:[],impact:{}},pdw:{min:9,max:17,unit:"fL",foods:[],impact:{}},pct:{min:.1,max:.4,unit:"%",foods:[],impact:{}},absolute_neutrophil_count:{min:1500,max:8e3,unit:"/L",foods:[],impact:{low:"Neutropenia. Low immunity."}},absolute_lymphocyte_count:{min:1e3,max:4800,unit:"/L",foods:[],impact:{}},absolute_monocyte_count:{min:200,max:950,unit:"/L",foods:[],impact:{}},absolute_eosinophil_count:{min:0,max:500,unit:"/L",foods:[],impact:{high:"Allergy/Parasite."}},transferrin_saturation:{min:20,max:50,unit:"%",foods:[],impact:{low:"Iron deficiency."}},amylase:{min:30,max:110,unit:"U/L",foods:[],impact:{high:"Pancreas inflammation (Pancreatitis)."}},lipase:{min:0,max:160,unit:"U/L",foods:[],impact:{high:"Pancreas damage."}},urine_pus_cells:{min:0,max:5,unit:"/hpf",foods:["Cranberry"],impact:{high:"Urinary Tract Infection (UTI)."}},urine_rbc:{min:0,max:3,unit:"/hpf",foods:[],impact:{high:"Blood in urine. Consult urologist."}},granulocyte:{min:2,max:8,unit:"10^3/L",foods:[],impact:{high:"Infection/Inflammation."}},ldh:{min:140,max:280,unit:"U/L",foods:[],impact:{high:"Tissue damage/Cell turnover."}}},Pz=n=>{const e=[];return Object.keys(n).forEach(t=>{const i=parseFloat(n[t]);!nf[t]||isNaN(i)||(t==="hemoglobin"&&i<11&&e.push({condition:"Anemia",risk:"High",color:"#ef4444",advice:"Consult doctor for iron supplements."}),t==="glucose_fasting"&&i>126||t==="hba1c"&&i>6.5?e.push({condition:"Diabetes",risk:"High",color:"#ef4444",advice:"Manage sugar intake strictly."}):(t==="glucose_fasting"&&i>100||t==="hba1c">5.7)&&e.push({condition:"Pre-Diabetes",risk:"Medium",color:"#f59e0b",advice:"Lifestyle changes needed."}),t==="creatinine"&&i>1.4&&e.push({condition:"Renal Insufficiency Risk",risk:"High",color:"#ef4444",advice:"Kidney function concern."}),t==="troponin_i"&&i>.04&&e.push({condition:"Myocardial Injury Risk",risk:"CRITICAL",color:"#b91c1c",advice:"Seek immediate medical attention."}),t==="hs_crp"&&i>3&&e.push({condition:"High Cardiovascular Risk",risk:"High",color:"#ef4444",advice:"Inflammation marker high."}),t==="vitamin_d"&&i<20&&e.push({condition:"Vitamin D Deficiency",risk:"Medium",color:"#f59e0b",advice:"Supplementation recommended."}),t==="tsh"&&i>5&&e.push({condition:"Hypothyroidism Risk",risk:"Medium",color:"#f59e0b",advice:"Metabolism might be slow."}))}),e},Nz=(n,e=[])=>{const t=[],i=[];Object.keys(n).forEach(s=>{var c,h;const a=parseFloat(n[s]),o=nf[s];if(!o)return;let l="Normal";a<o.min&&(l="Low"),a>o.max&&(l="High");const u=l==="Low"?(c=o.impact)==null?void 0:c.low:l==="High"?(h=o.impact)==null?void 0:h.high:null;l!=="Normal"&&i.push({parameter:s,status:l,foods:o.foods,fitnessImpact:u}),t.push({parameter:s,value:a,unit:o.unit,range:`${o.min}-${o.max}`,status:l,fitnessImpact:u})});const r=e.length>0?e:Pz(n);return{date:new Date().toLocaleDateString(),values:n,results:t,suggestions:i,risks:r}};/*!
 * ONNX Runtime Web v1.23.2
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */var cC=Object.defineProperty,wJ=Object.getOwnPropertyDescriptor,bJ=Object.getOwnPropertyNames,xJ=Object.prototype.hasOwnProperty,EJ=(n=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):n)(function(n){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+n+'" is not supported')}),pe=(n,e)=>()=>(n&&(e=n(n=0)),e),Zp=(n,e)=>{for(var t in e)cC(n,t,{get:e[t],enumerable:!0})},AJ=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of bJ(e))!xJ.call(n,r)&&r!==t&&cC(n,r,{get:()=>e[r],enumerable:!(i=wJ(e,r))||i.enumerable});return n},vy=n=>AJ(cC({},"__esModule",{value:!0}),n),Dm,yl,rf,xP,Dz,Mz=pe(()=>{Dm=new Map,yl=[],rf=(n,e,t)=>{if(e&&typeof e.init=="function"&&typeof e.createInferenceSessionHandler=="function"){let i=Dm.get(n);if(i===void 0)Dm.set(n,{backend:e,priority:t});else{if(i.priority>t)return;if(i.priority===t&&i.backend!==e)throw new Error(`cannot register backend "${n}" using priority ${t}`)}if(t>=0){let r=yl.indexOf(n);r!==-1&&yl.splice(r,1);for(let s=0;s<yl.length;s++)if(Dm.get(yl[s]).priority<=t){yl.splice(s,0,n);return}yl.push(n)}return}throw new TypeError("not a valid backend")},xP=async n=>{let e=Dm.get(n);if(!e)return"backend not found.";if(e.initialized)return e.backend;if(e.aborted)return e.error;{let t=!!e.initPromise;try{return t||(e.initPromise=e.backend.init(n)),await e.initPromise,e.initialized=!0,e.backend}catch(i){return t||(e.error=`${i}`,e.aborted=!0),e.error}finally{delete e.initPromise}}},Dz=async n=>{let e=n.executionProviders||[],t=e.map(l=>typeof l=="string"?l:l.name),i=t.length===0?yl:t,r,s=[],a=new Set;for(let l of i){let u=await xP(l);typeof u=="string"?s.push({name:l,err:u}):(r||(r=u),r===u&&a.add(l))}if(!r)throw new Error(`no available backend found. ERR: ${s.map(l=>`[${l.name}] ${l.err}`).join(", ")}`);for(let{name:l,err:u}of s)t.includes(l)&&console.warn(`removing requested execution provider "${l}" from session options because it is not available: ${u}`);let o=e.filter(l=>a.has(typeof l=="string"?l:l.name));return[r,new Proxy(n,{get:(l,u)=>u==="executionProviders"?o:Reflect.get(l,u)})]}}),TJ=pe(()=>{Mz()}),Oz,SJ=pe(()=>{Oz="1.23.2"}),yE,On,Lz=pe(()=>{SJ(),yE="warning",On={wasm:{},webgl:{},webgpu:{},versions:{common:Oz},set logLevel(n){if(n!==void 0){if(typeof n!="string"||["verbose","info","warning","error","fatal"].indexOf(n)===-1)throw new Error(`Unsupported logging level: ${n}`);yE=n}},get logLevel(){return yE}},Object.defineProperty(On,"logLevel",{enumerable:!0})}),Lt,IJ=pe(()=>{Lz(),Lt=On}),Fz,zz,CJ=pe(()=>{Fz=(n,e)=>{let t=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);t.width=n.dims[3],t.height=n.dims[2];let i=t.getContext("2d");if(i!=null){let r,s;(e==null?void 0:e.tensorLayout)!==void 0&&e.tensorLayout==="NHWC"?(r=n.dims[2],s=n.dims[3]):(r=n.dims[3],s=n.dims[2]);let a=(e==null?void 0:e.format)!==void 0?e.format:"RGB",o=e==null?void 0:e.norm,l,u;o===void 0||o.mean===void 0?l=[255,255,255,255]:typeof o.mean=="number"?l=[o.mean,o.mean,o.mean,o.mean]:(l=[o.mean[0],o.mean[1],o.mean[2],0],o.mean[3]!==void 0&&(l[3]=o.mean[3])),o===void 0||o.bias===void 0?u=[0,0,0,0]:typeof o.bias=="number"?u=[o.bias,o.bias,o.bias,o.bias]:(u=[o.bias[0],o.bias[1],o.bias[2],0],o.bias[3]!==void 0&&(u[3]=o.bias[3]));let c=s*r,h=0,f=c,m=c*2,y=-1;a==="RGBA"?(h=0,f=c,m=c*2,y=c*3):a==="RGB"?(h=0,f=c,m=c*2):a==="RBG"&&(h=0,m=c,f=c*2);for(let _=0;_<s;_++)for(let x=0;x<r;x++){let v=(n.data[h++]-u[0])*l[0],w=(n.data[f++]-u[1])*l[1],E=(n.data[m++]-u[2])*l[2],k=y===-1?255:(n.data[y++]-u[3])*l[3];i.fillStyle="rgba("+v+","+w+","+E+","+k+")",i.fillRect(x,_,1,1)}if("toDataURL"in t)return t.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},zz=(n,e)=>{let t=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),i;if(t!=null){let r,s,a;(e==null?void 0:e.tensorLayout)!==void 0&&e.tensorLayout==="NHWC"?(r=n.dims[2],s=n.dims[1],a=n.dims[3]):(r=n.dims[3],s=n.dims[2],a=n.dims[1]);let o=e!==void 0&&e.format!==void 0?e.format:"RGB",l=e==null?void 0:e.norm,u,c;l===void 0||l.mean===void 0?u=[255,255,255,255]:typeof l.mean=="number"?u=[l.mean,l.mean,l.mean,l.mean]:(u=[l.mean[0],l.mean[1],l.mean[2],255],l.mean[3]!==void 0&&(u[3]=l.mean[3])),l===void 0||l.bias===void 0?c=[0,0,0,0]:typeof l.bias=="number"?c=[l.bias,l.bias,l.bias,l.bias]:(c=[l.bias[0],l.bias[1],l.bias[2],0],l.bias[3]!==void 0&&(c[3]=l.bias[3]));let h=s*r;if(e!==void 0&&(e.format!==void 0&&a===4&&e.format!=="RGBA"||a===3&&e.format!=="RGB"&&e.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let f=4,m=0,y=1,_=2,x=3,v=0,w=h,E=h*2,k=-1;o==="RGBA"?(v=0,w=h,E=h*2,k=h*3):o==="RGB"?(v=0,w=h,E=h*2):o==="RBG"&&(v=0,E=h,w=h*2),i=t.createImageData(r,s);for(let $=0;$<s*r;m+=f,y+=f,_+=f,x+=f,$++)i.data[m]=(n.data[v++]-c[0])*u[0],i.data[y]=(n.data[w++]-c[1])*u[1],i.data[_]=(n.data[E++]-c[2])*u[2],i.data[x]=k===-1?255:(n.data[k++]-c[3])*u[3]}else throw new Error("Can not access image data");return i}}),x0,Vz,jz,Bz,Uz,Hz,kJ=pe(()=>{dC(),x0=(n,e)=>{if(n===void 0)throw new Error("Image buffer must be defined");if(e.height===void 0||e.width===void 0)throw new Error("Image height and width must be defined");if(e.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:t,width:i}=e,r=e.norm??{mean:255,bias:0},s,a;typeof r.mean=="number"?s=[r.mean,r.mean,r.mean,r.mean]:s=[r.mean[0],r.mean[1],r.mean[2],r.mean[3]??255],typeof r.bias=="number"?a=[r.bias,r.bias,r.bias,r.bias]:a=[r.bias[0],r.bias[1],r.bias[2],r.bias[3]??0];let o=e.format!==void 0?e.format:"RGBA",l=e.tensorFormat!==void 0&&e.tensorFormat!==void 0?e.tensorFormat:"RGB",u=t*i,c=l==="RGBA"?new Float32Array(u*4):new Float32Array(u*3),h=4,f=0,m=1,y=2,_=3,x=0,v=u,w=u*2,E=-1;o==="RGB"&&(h=3,f=0,m=1,y=2,_=-1),l==="RGBA"?E=u*3:l==="RBG"?(x=0,w=u,v=u*2):l==="BGR"&&(w=0,v=u,x=u*2);for(let k=0;k<u;k++,f+=h,y+=h,m+=h,_+=h)c[x++]=(n[f]+a[0])/s[0],c[v++]=(n[m]+a[1])/s[1],c[w++]=(n[y]+a[2])/s[2],E!==-1&&_!==-1&&(c[E++]=(n[_]+a[3])/s[3]);return l==="RGBA"?new Ir("float32",c,[1,4,t,i]):new Ir("float32",c,[1,3,t,i])},Vz=async(n,e)=>{let t=typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement,i=typeof ImageData<"u"&&n instanceof ImageData,r=typeof ImageBitmap<"u"&&n instanceof ImageBitmap,s=typeof n=="string",a,o=e??{},l=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},u=c=>typeof HTMLCanvasElement<"u"&&c instanceof HTMLCanvasElement||c instanceof OffscreenCanvas?c.getContext("2d"):null;if(t){let c=l();c.width=n.width,c.height=n.height;let h=u(c);if(h!=null){let f=n.height,m=n.width;if(e!==void 0&&e.resizedHeight!==void 0&&e.resizedWidth!==void 0&&(f=e.resizedHeight,m=e.resizedWidth),e!==void 0){if(o=e,e.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");o.tensorFormat="RGBA",o.height=f,o.width=m}else o.tensorFormat="RGBA",o.height=f,o.width=m;h.drawImage(n,0,0),a=h.getImageData(0,0,m,f).data}else throw new Error("Can not access image data")}else if(i){let c,h;if(e!==void 0&&e.resizedWidth!==void 0&&e.resizedHeight!==void 0?(c=e.resizedHeight,h=e.resizedWidth):(c=n.height,h=n.width),e!==void 0&&(o=e),o.format="RGBA",o.height=c,o.width=h,e!==void 0){let f=l();f.width=h,f.height=c;let m=u(f);if(m!=null)m.putImageData(n,0,0),a=m.getImageData(0,0,h,c).data;else throw new Error("Can not access image data")}else a=n.data}else if(r){if(e===void 0)throw new Error("Please provide image config with format for Imagebitmap");let c=l();c.width=n.width,c.height=n.height;let h=u(c);if(h!=null){let f=n.height,m=n.width;return h.drawImage(n,0,0,m,f),a=h.getImageData(0,0,m,f).data,o.height=f,o.width=m,x0(a,o)}else throw new Error("Can not access image data")}else{if(s)return new Promise((c,h)=>{let f=l(),m=u(f);if(!n||!m)return h();let y=new Image;y.crossOrigin="Anonymous",y.src=n,y.onload=()=>{f.width=y.width,f.height=y.height,m.drawImage(y,0,0,f.width,f.height);let _=m.getImageData(0,0,f.width,f.height);o.height=f.height,o.width=f.width,c(x0(_.data,o))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(a!==void 0)return x0(a,o);throw new Error("Input data provided is not supported - aborted tensor creation")},jz=(n,e)=>{let{width:t,height:i,download:r,dispose:s}=e,a=[1,i,t,4];return new Ir({location:"texture",type:"float32",texture:n,dims:a,download:r,dispose:s})},Bz=(n,e)=>{let{dataType:t,dims:i,download:r,dispose:s}=e;return new Ir({location:"gpu-buffer",type:t??"float32",gpuBuffer:n,dims:i,download:r,dispose:s})},Uz=(n,e)=>{let{dataType:t,dims:i,download:r,dispose:s}=e;return new Ir({location:"ml-tensor",type:t??"float32",mlTensor:n,dims:i,download:r,dispose:s})},Hz=(n,e,t)=>new Ir({location:"cpu-pinned",type:n,data:e,dims:t??[e.length]})}),wc,ag,_E,Wz,$J=pe(()=>{wc=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),ag=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),_E=!1,Wz=()=>{if(!_E){_E=!0;let n=typeof BigInt64Array<"u"&&BigInt64Array.from,e=typeof BigUint64Array<"u"&&BigUint64Array.from,t=globalThis.Float16Array,i=typeof t<"u"&&t.from;n&&(wc.set("int64",BigInt64Array),ag.set(BigInt64Array,"int64")),e&&(wc.set("uint64",BigUint64Array),ag.set(BigUint64Array,"uint64")),i?(wc.set("float16",t),ag.set(t,"float16")):wc.set("float16",Uint16Array)}}}),qz,Gz,RJ=pe(()=>{dC(),qz=n=>{let e=1;for(let t=0;t<n.length;t++){let i=n[t];if(typeof i!="number"||!Number.isSafeInteger(i))throw new TypeError(`dims[${t}] must be an integer, got: ${i}`);if(i<0)throw new RangeError(`dims[${t}] must be a non-negative integer, got: ${i}`);e*=i}return e},Gz=(n,e)=>{switch(n.location){case"cpu":return new Ir(n.type,n.data,e);case"cpu-pinned":return new Ir({location:"cpu-pinned",data:n.data,type:n.type,dims:e});case"texture":return new Ir({location:"texture",texture:n.texture,type:n.type,dims:e});case"gpu-buffer":return new Ir({location:"gpu-buffer",gpuBuffer:n.gpuBuffer,type:n.type,dims:e});case"ml-tensor":return new Ir({location:"ml-tensor",mlTensor:n.mlTensor,type:n.type,dims:e});default:throw new Error(`tensorReshape: tensor location ${n.location} is not supported`)}}}),Ir,dC=pe(()=>{CJ(),kJ(),$J(),RJ(),Ir=class{constructor(n,e,t){Wz();let i,r;if(typeof n=="object"&&"location"in n)switch(this.dataLocation=n.location,i=n.type,r=n.dims,n.location){case"cpu-pinned":{let a=wc.get(i);if(!a)throw new TypeError(`unsupported type "${i}" to create tensor from pinned buffer`);if(!(n.data instanceof a))throw new TypeError(`buffer should be of type ${a.name}`);this.cpuData=n.data;break}case"texture":{if(i!=="float32")throw new TypeError(`unsupported type "${i}" to create tensor from texture`);this.gpuTextureData=n.texture,this.downloader=n.download,this.disposer=n.dispose;break}case"gpu-buffer":{if(i!=="float32"&&i!=="float16"&&i!=="int32"&&i!=="int64"&&i!=="uint32"&&i!=="uint8"&&i!=="bool"&&i!=="uint4"&&i!=="int4")throw new TypeError(`unsupported type "${i}" to create tensor from gpu buffer`);this.gpuBufferData=n.gpuBuffer,this.downloader=n.download,this.disposer=n.dispose;break}case"ml-tensor":{if(i!=="float32"&&i!=="float16"&&i!=="int32"&&i!=="int64"&&i!=="uint32"&&i!=="uint64"&&i!=="int8"&&i!=="uint8"&&i!=="bool"&&i!=="uint4"&&i!=="int4")throw new TypeError(`unsupported type "${i}" to create tensor from MLTensor`);this.mlTensorData=n.mlTensor,this.downloader=n.download,this.disposer=n.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let a,o;if(typeof n=="string")if(i=n,o=t,n==="string"){if(!Array.isArray(e))throw new TypeError("A string tensor's data must be a string array.");a=e}else{let l=wc.get(n);if(l===void 0)throw new TypeError(`Unsupported tensor type: ${n}.`);if(Array.isArray(e)){if(n==="float16"&&l===Uint16Array||n==="uint4"||n==="int4")throw new TypeError(`Creating a ${n} tensor from number array is not supported. Please use ${l.name} as data.`);n==="uint64"||n==="int64"?a=l.from(e,BigInt):a=l.from(e)}else if(e instanceof l)a=e;else if(e instanceof Uint8ClampedArray)if(n==="uint8")a=Uint8Array.from(e);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(n==="float16"&&e instanceof Uint16Array&&l!==Uint16Array)a=new globalThis.Float16Array(e.buffer,e.byteOffset,e.length);else throw new TypeError(`A ${i} tensor's data must be type of ${l}`)}else if(o=e,Array.isArray(n)){if(n.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let l=typeof n[0];if(l==="string")i="string",a=n;else if(l==="boolean")i="bool",a=Uint8Array.from(n);else throw new TypeError(`Invalid element type of data array: ${l}.`)}else if(n instanceof Uint8ClampedArray)i="uint8",a=Uint8Array.from(n);else{let l=ag.get(n.constructor);if(l===void 0)throw new TypeError(`Unsupported type for tensor data: ${n.constructor}.`);i=l,a=n}if(o===void 0)o=[a.length];else if(!Array.isArray(o))throw new TypeError("A tensor's dims must be a number array");r=o,this.cpuData=a,this.dataLocation="cpu"}let s=qz(r);if(this.cpuData&&s!==this.cpuData.length&&!((i==="uint4"||i==="int4")&&Math.ceil(s/2)===this.cpuData.length))throw new Error(`Tensor's size(${s}) does not match data length(${this.cpuData.length}).`);this.type=i,this.dims=r,this.size=s}static async fromImage(n,e){return Vz(n,e)}static fromTexture(n,e){return jz(n,e)}static fromGpuBuffer(n,e){return Bz(n,e)}static fromMLTensor(n,e){return Uz(n,e)}static fromPinnedBuffer(n,e,t){return Hz(n,e,t)}toDataURL(n){return Fz(this,n)}toImageData(n){return zz(this,n)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(n){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let e=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=e,n&&this.disposer&&(this.disposer(),this.disposer=void 0),e}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(n){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return Gz(this,n)}}}),Na,Kz=pe(()=>{dC(),Na=Ir}),Rb,vE,Ua,Gs,Od,Ld,Yz=pe(()=>{Lz(),Rb=(n,e)=>{(typeof On.trace>"u"?!On.wasm.trace:!On.trace)||console.timeStamp(`${n}::ORT::${e}`)},vE=(n,e)=>{var r;let t=((r=new Error().stack)==null?void 0:r.split(/\r\n|\r|\n/g))||[],i=!1;for(let s=0;s<t.length;s++){if(i&&!t[s].includes("TRACE_FUNC")){let a=`FUNC_${n}::${t[s].trim().split(" ")[1]}`;e&&(a+=`::${e}`),Rb("CPU",a);return}t[s].includes("TRACE_FUNC")&&(i=!0)}},Ua=n=>{(typeof On.trace>"u"?!On.wasm.trace:!On.trace)||vE("BEGIN",n)},Gs=n=>{(typeof On.trace>"u"?!On.wasm.trace:!On.trace)||vE("END",n)},Od=n=>{(typeof On.trace>"u"?!On.wasm.trace:!On.trace)||console.time(`ORT::${n}`)},Ld=n=>{(typeof On.trace>"u"?!On.wasm.trace:!On.trace)||console.timeEnd(`ORT::${n}`)}}),Xz,PJ=pe(()=>{Mz(),Kz(),Yz(),Xz=class Qz{constructor(e){this.handler=e}async run(e,t,i){Ua(),Od("InferenceSession.run");let r={},s={};if(typeof e!="object"||e===null||e instanceof Na||Array.isArray(e))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let a=!0;if(typeof t=="object"){if(t===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(t instanceof Na)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(t)){if(t.length===0)throw new TypeError("'fetches' cannot be an empty array.");a=!1;for(let u of t){if(typeof u!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(u)===-1)throw new RangeError(`'fetches' contains invalid output name: ${u}.`);r[u]=null}if(typeof i=="object"&&i!==null)s=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else{let u=!1,c=Object.getOwnPropertyNames(t);for(let h of this.outputNames)if(c.indexOf(h)!==-1){let f=t[h];(f===null||f instanceof Na)&&(u=!0,a=!1,r[h]=f)}if(u){if(typeof i=="object"&&i!==null)s=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else s=t}}else if(typeof t<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let u of this.inputNames)if(typeof e[u]>"u")throw new Error(`input '${u}' is missing in 'feeds'.`);if(a)for(let u of this.outputNames)r[u]=null;let o=await this.handler.run(e,r,s),l={};for(let u in o)if(Object.hasOwnProperty.call(o,u)){let c=o[u];c instanceof Na?l[u]=c:l[u]=new Na(c.type,c.data,c.dims)}return Ld("InferenceSession.run"),Gs(),l}async release(){return this.handler.dispose()}static async create(e,t,i,r){Ua(),Od("InferenceSession.create");let s,a={};if(typeof e=="string"){if(s=e,typeof t=="object"&&t!==null)a=t;else if(typeof t<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof Uint8Array){if(s=e,typeof t=="object"&&t!==null)a=t;else if(typeof t<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer){let c=e,h=0,f=e.byteLength;if(typeof t=="object"&&t!==null)a=t;else if(typeof t=="number"){if(h=t,!Number.isSafeInteger(h))throw new RangeError("'byteOffset' must be an integer.");if(h<0||h>=c.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${c.byteLength}).`);if(f=e.byteLength-h,typeof i=="number"){if(f=i,!Number.isSafeInteger(f))throw new RangeError("'byteLength' must be an integer.");if(f<=0||h+f>c.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${c.byteLength-h}].`);if(typeof r=="object"&&r!==null)a=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else if(typeof i<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof t<"u")throw new TypeError("'options' must be an object.");s=new Uint8Array(c,h,f)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[o,l]=await Dz(a),u=await o.createInferenceSessionHandler(s,l);return Ld("InferenceSession.create"),Gs(),new Qz(u)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),Jz,NJ=pe(()=>{PJ(),Jz=Xz}),DJ=pe(()=>{}),MJ=pe(()=>{}),OJ=pe(()=>{}),LJ=pe(()=>{}),FJ={};Zp(FJ,{InferenceSession:()=>Jz,TRACE:()=>Rb,TRACE_EVENT_BEGIN:()=>Od,TRACE_EVENT_END:()=>Ld,TRACE_FUNC_BEGIN:()=>Ua,TRACE_FUNC_END:()=>Gs,Tensor:()=>Na,env:()=>Lt,registerBackend:()=>rf});var os=pe(()=>{TJ(),IJ(),NJ(),Kz(),DJ(),MJ(),Yz(),OJ(),LJ()}),hC=pe(()=>{}),Zz={};Zp(Zz,{default:()=>eV});var wE,bE,eV,zJ=pe(()=>{var n;sU(),hh(),fC(),wE="ort-wasm-proxy-worker",bE=((n=globalThis.self)==null?void 0:n.name)===wE,bE&&(self.onmessage=e=>{let{type:t,in:i}=e.data;try{switch(t){case"init-wasm":pC(i.wasm).then(()=>{RC(i).then(()=>{postMessage({type:t})},r=>{postMessage({type:t,err:r})})},r=>{postMessage({type:t,err:r})});break;case"init-ep":{let{epName:r,env:s}=i;PC(s,r).then(()=>{postMessage({type:t})},a=>{postMessage({type:t,err:a})});break}case"copy-from":{let{buffer:r}=i,s=Fb(r);postMessage({type:t,out:s});break}case"create":{let{model:r,options:s}=i;NC(r,s).then(a=>{postMessage({type:t,out:a})},a=>{postMessage({type:t,err:a})});break}case"release":DC(i),postMessage({type:t});break;case"run":{let{sessionId:r,inputIndices:s,inputs:a,outputIndices:o,options:l}=i;MC(r,s,a,o,new Array(o.length).fill(null),l).then(u=>{u.some(c=>c[3]!=="cpu")?postMessage({type:t,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:t,out:u},LC([...a,...u]))},u=>{postMessage({type:t,err:u})});break}case"end-profiling":OC(i),postMessage({type:t});break;default:}}catch(r){postMessage({type:t,err:r})}}),eV=bE?null:e=>new Worker(e??hr,{type:"module",name:wE})}),tV={};Zp(tV,{default:()=>nV});var xE,nV,EP,VJ=pe(()=>{var n,e;xE=async function(t={}){var xk;var i,r,s=t,a=new Promise((g,b)=>{i=g,r=b}),o=typeof window=="object",l=typeof WorkerGlobalScope<"u",u=l&&((xk=self.name)==null?void 0:xk.startsWith("em-pthread"));s.mountExternalData=(g,b)=>{g.startsWith("./")&&(g=g.substring(2)),(s.Fb||(s.Fb=new Map)).set(g,b)},s.unmountExternalData=()=>{delete s.Fb};var c=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,qc:!0}).buffer.constructor;let h=g=>async(...b)=>{var S;try{if(s.Gb)throw Error("Session already started");let R=s.Gb={ec:b[0],errors:[]},M=await g(...b);if(s.Gb!==R)throw Error("Session mismatch");(S=s.Kb)==null||S.flush();let q=R.errors;if(0<q.length){let J=await Promise.all(q);if(J=J.filter(ne=>ne),0<J.length)throw Error(J.join(`
`))}return M}finally{s.Gb=null}};s.jsepInit=(g,b)=>{if(g==="webgpu"){[s.Kb,s.Vb,s.Zb,s.Lb,s.Yb,s.Ab,s.$b,s.bc,s.Wb,s.Xb,s.ac]=b;let S=s.Kb;s.jsepRegisterBuffer=(R,M,q,J)=>S.registerBuffer(R,M,q,J),s.jsepGetBuffer=R=>S.getBuffer(R),s.jsepCreateDownloader=(R,M,q)=>S.createDownloader(R,M,q),s.jsepOnCreateSession=R=>{S.onCreateSession(R)},s.jsepOnReleaseSession=R=>{S.onReleaseSession(R)},s.jsepOnRunStart=R=>S.onRunStart(R),s.cc=(R,M)=>{S.upload(R,M)}}else if(g==="webnn"){let S=b[0];[s.oc,s.Ob,s.webnnEnsureTensor,s.Pb,s.webnnDownloadTensor,s.nc,s.webnnEnableTraceEvent]=b.slice(1),s.webnnReleaseTensorId=s.Ob,s.webnnUploadTensor=s.Pb,s.webnnRegisterMLContext=s.nc,s.webnnOnRunStart=R=>S.onRunStart(R),s.webnnOnRunEnd=S.onRunEnd.bind(S),s.webnnOnReleaseSession=R=>{S.onReleaseSession(R)},s.webnnCreateMLTensorDownloader=(R,M)=>S.createMLTensorDownloader(R,M),s.webnnRegisterMLTensor=(R,M,q,J)=>S.registerMLTensor(R,M,q,J),s.webnnCreateMLContext=R=>S.createMLContext(R),s.webnnRegisterMLConstant=(R,M,q,J,ne,ue)=>S.registerMLConstant(R,M,q,J,ne,s.Fb,ue),s.webnnRegisterGraphInput=S.registerGraphInput.bind(S),s.webnnIsGraphInput=S.isGraphInput.bind(S),s.webnnRegisterGraphOutput=S.registerGraphOutput.bind(S),s.webnnIsGraphOutput=S.isGraphOutput.bind(S),s.webnnCreateTemporaryTensor=S.createTemporaryTensor.bind(S),s.webnnIsGraphInputOutputTypeSupported=S.isGraphInputOutputTypeSupported.bind(S)}};let f=()=>{let g=(b,S,R)=>(...M)=>{let q=Hi,J=S==null?void 0:S();M=b(...M);let ne=S==null?void 0:S();return J!==ne&&(b=ne,R(J),S=R=null),Hi!=q?new Promise((ue,ge)=>{ic={resolve:ue,reject:ge}}):M};(()=>{for(let b of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])s[b]=g(s[b],()=>s[b],S=>s[b]=S)})(),h!==void 0&&(s._OrtRun=h(s._OrtRun),s._OrtRunWithBinding=h(s._OrtRunWithBinding)),f=void 0};s.asyncInit=()=>{f==null||f()};var m,y,_=(g,b)=>{throw b},x=import.meta.url,v="";if(o||l){try{v=new URL(".",x).href}catch{}l&&(y=g=>{var b=new XMLHttpRequest;return b.open("GET",g,!1),b.responseType="arraybuffer",b.send(null),new Uint8Array(b.response)}),m=async g=>{if(Q(g))return new Promise((S,R)=>{var M=new XMLHttpRequest;M.open("GET",g,!0),M.responseType="arraybuffer",M.onload=()=>{M.status==200||M.status==0&&M.response?S(M.response):R(M.status)},M.onerror=R,M.send(null)});var b=await fetch(g,{credentials:"same-origin"});if(b.ok)return b.arrayBuffer();throw Error(b.status+" : "+b.url)}}var w,E,k,$,L,I,C,N,O,V,U,j,he,me,te,oe=console.log.bind(console),G=console.error.bind(console),W=oe,K=G,H=!1,Q=g=>g.startsWith("file://");function Y(){return E.buffer!=L.buffer&&He(),L}function Z(){return E.buffer!=L.buffer&&He(),I}function fe(){return E.buffer!=L.buffer&&He(),C}function _e(){return E.buffer!=L.buffer&&He(),N}function X(){return E.buffer!=L.buffer&&He(),O}function de(){return E.buffer!=L.buffer&&He(),V}function Ee(){return E.buffer!=L.buffer&&He(),U}function $e(){return E.buffer!=L.buffer&&He(),me}if(u){let g=function(b){try{var S=b.data,R=S.Db;if(R==="load"){let M=[];self.onmessage=q=>M.push(q),self.startWorker=()=>{postMessage({Db:"loaded"});for(let q of M)g(q);self.onmessage=g};for(let q of S.Sb)s[q]&&!s[q].proxy||(s[q]=(...J)=>{postMessage({Db:"callHandler",Rb:q,args:J})},q=="print"&&(W=s[q]),q=="printErr"&&(K=s[q]));E=S.kc,He(),te(S.lc)}else if(R==="run"){gv(S.Bb),Ex(S.Bb,0,0,1,0,0),mh(),pm(S.Bb),je||(ck(),je=!0);try{yh(S.hc,S.Jb)}catch(M){if(M!="unwind")throw M}}else S.target!=="setimmediate"&&(R==="checkMailbox"?je&&ia():R&&(K(`worker: received unknown command ${R}`),K(S)))}catch(M){throw dk(),M}};var je=!1;self.onunhandledrejection=b=>{throw b.reason||b},self.onmessage=g}function He(){var g=E.buffer;s.HEAP8=L=new Int8Array(g),C=new Int16Array(g),s.HEAPU8=I=new Uint8Array(g),N=new Uint16Array(g),s.HEAP32=O=new Int32Array(g),s.HEAPU32=V=new Uint32Array(g),U=new Float32Array(g),me=new Float64Array(g),j=new BigInt64Array(g),he=new BigUint64Array(g)}function nt(){u?startWorker(s):se.Da()}var Et,Xt=0,Yn=null;function ls(){if(--Xt==0&&Yn){var g=Yn;Yn=null,g()}}function or(g){throw K(g="Aborted("+g+")"),H=!0,g=new WebAssembly.RuntimeError(g+". Build with -sASSERTIONS for more info."),r(g),g}function Mt(){return{a:{L:w6,Aa:v6,b:Ku,$:Dn,A:_v,pa:vv,X:Ya,Z:wv,qa:bv,na:Yu,ga:im,ma:rm,J:_h,Y:cl,V:xv,oa:us,W:sm,va:om,E:Ev,Q:Qu,O:dm,D:Tv,v:Sv,s:dx,P:Ju,z:Iv,R:fx,ja:px,T:Qa,aa:Cv,M:kv,F:$v,ia:pm,sa:Rv,r:mx,Ca:gx,w:yx,o:Mv,m:sa,c:um,Ba:Lv,n:sc,j:Eh,u:Vv,p:Ah,f:_x,t:jv,l:ac,e:Bv,k:Uv,h:gm,g:ym,d:Hv,da:Th,ea:Wv,fa:qv,ba:wm,ca:bm,N:xm,xa:Gv,ua:p,i:B,C:ee,G:re,ta:pl,x:ve,ra:Qe,U:un,q:Si,y:At,K:mn,S:jr,za:Sh,ya:Em,ka:nk,la:ik,_:ji,B:rk,I:sk,ha:ak,H:ok,a:E,wa:ol}}}class Rt{constructor(b){ze(this,"name","ExitStatus");this.message=`Program terminated with exit(${b})`,this.status=b}}var Ga=g=>{g.terminate(),g.onmessage=()=>{}},Ka=[],al=g=>{ea.length==0&&(na(),gh(ea[0]));var b=ea.pop();if(!b)return 6;Gu.push(b),ta[g.Bb]=b,b.Bb=g.Bb;var S={Db:"run",hc:g.fc,Jb:g.Jb,Bb:g.Bb};return b.postMessage(S,g.Nb),0},lr=0,it=(g,b,...S)=>{for(var R=2*S.length,M=Sx(),q=Tx(8*R),J=q>>>3,ne=0;ne<S.length;ne++){var ue=S[ne];typeof ue=="bigint"?(j[J+2*ne]=1n,j[J+2*ne+1]=ue):(j[J+2*ne]=0n,$e()[J+2*ne+1>>>0]=ue)}return g=hk(g,0,R,q,b),Xv(M),g};function ol(g){if(u)return it(0,1,g);if($=g,!(0<lr)){for(var b of Gu)Ga(b);for(b of ea)Ga(b);ea=[],Gu=[],ta={},H=!0}_(0,new Rt(g))}function qu(g){if(u)return it(1,0,g);ji(g)}var ji=g=>{if($=g,u)throw qu(g),"unwind";ol(g)},ea=[],Gu=[],em=[],ta={},ll=g=>{var b=g.Bb;delete ta[b],ea.push(g),Gu.splice(Gu.indexOf(g),1),g.Bb=0,fk(b)};function mh(){em.forEach(g=>g())}var gh=g=>new Promise(b=>{g.onmessage=M=>{var q=(M=M.data).Db;if(M.Hb&&M.Hb!=xx()){var J=ta[M.Hb];J?J.postMessage(M,M.Nb):K(`Internal error! Worker sent a message "${q}" to target pthread ${M.Hb}, but that thread no longer exists!`)}else q==="checkMailbox"?ia():q==="spawnThread"?al(M):q==="cleanupThread"?ll(ta[M.ic]):q==="loaded"?(g.loaded=!0,b(g)):M.target==="setimmediate"?g.postMessage(M):q==="callHandler"?s[M.Rb](...M.args):q&&K(`worker sent an unknown command ${q}`)},g.onerror=M=>{throw K(`worker sent an error! ${M.filename}:${M.lineno}: ${M.message}`),M};var S,R=[];for(S of[])s.propertyIsEnumerable(S)&&R.push(S);g.postMessage({Db:"load",Sb:R,kc:E,lc:k})});function na(){var g=new Worker((()=>{let b=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new b("ort.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});ea.push(g)}var gv=g=>{He();var b=de()[g+52>>>2>>>0];g=de()[g+56>>>2>>>0],gk(b,b-g),Xv(b)},yh=(g,b)=>{lr=0,g=yk(g,b),0<lr?$=g:Ax(g)};class yv{constructor(b){this.Ib=b-24}}function Ku(g,b,S){var R=new yv(g>>>=0);throw b>>>=0,S>>>=0,de()[R.Ib+16>>>2>>>0]=0,de()[R.Ib+4>>>2>>>0]=b,de()[R.Ib+8>>>2>>>0]=S,g}function tm(g,b,S,R){return u?it(2,1,g,b,S,R):Dn(g,b,S,R)}function Dn(g,b,S,R){if(g>>>=0,S>>>=0,R>>>=0,c===void 0)return 6;var M=[];return u&&M.length===0?tm(g,b>>>=0,S,R):(g={fc:S,Bb:g,Jb:R,Nb:M},u?(g.Db="spawnThread",postMessage(g,M),0):al(g))}var nm=typeof TextDecoder<"u"?new TextDecoder:void 0,ul=(g,b=0,S=NaN)=>{var R=(b>>>=0)+S;for(S=b;g[S]&&!(S>=R);)++S;if(16<S-b&&g.buffer&&nm)return nm.decode(g.buffer instanceof ArrayBuffer?g.subarray(b,S):g.slice(b,S));for(R="";b<S;){var M=g[b++];if(128&M){var q=63&g[b++];if((224&M)==192)R+=String.fromCharCode((31&M)<<6|q);else{var J=63&g[b++];65536>(M=(240&M)==224?(15&M)<<12|q<<6|J:(7&M)<<18|q<<12|J<<6|63&g[b++])?R+=String.fromCharCode(M):(M-=65536,R+=String.fromCharCode(55296|M>>10,56320|1023&M))}}else R+=String.fromCharCode(M)}return R},Pt=(g,b)=>(g>>>=0)?ul(Z(),g,b):"";function _v(g,b,S){return u?it(3,1,g,b,S):0}function vv(g,b){if(u)return it(4,1,g,b)}function Ya(g,b){if(u)return it(5,1,g,b)}function wv(g,b,S){if(u)return it(6,1,g,b,S)}function bv(g,b,S){return u?it(7,1,g,b,S):0}function Yu(g,b){if(u)return it(8,1,g,b)}function im(g,b,S){if(u)return it(9,1,g,b,S)}function rm(g,b,S,R){if(u)return it(10,1,g,b,S,R)}function _h(g,b,S,R){if(u)return it(11,1,g,b,S,R)}function cl(g,b,S,R){if(u)return it(12,1,g,b,S,R)}function xv(g){if(u)return it(13,1,g)}function us(g,b){if(u)return it(14,1,g,b)}function sm(g,b,S){if(u)return it(15,1,g,b,S)}var am,om=()=>or(""),Bi=g=>{for(var b="";Z()[g>>>0];)b+=am[Z()[g++>>>0]];return b},vh={},lm={},Xa=s.BindingError=class extends Error{constructor(g){super(g),this.name="BindingError"}};function cs(g,b,S={}){return function(R,M,q={}){var J=M.name;if(!R)throw new Xa(`type "${J}" must have a positive integer typeid pointer`);if(lm.hasOwnProperty(R)){if(q.Tb)return;throw new Xa(`Cannot register type '${J}' twice`)}lm[R]=M,vh.hasOwnProperty(R)&&(M=vh[R],delete vh[R],M.forEach(ne=>ne()))}(g,b,S)}var Xu=(g,b,S)=>{switch(b){case 1:return S?R=>Y()[R>>>0]:R=>Z()[R>>>0];case 2:return S?R=>fe()[R>>>1>>>0]:R=>_e()[R>>>1>>>0];case 4:return S?R=>X()[R>>>2>>>0]:R=>de()[R>>>2>>>0];case 8:return S?R=>j[R>>>3]:R=>he[R>>>3];default:throw new TypeError(`invalid integer width (${b}): ${g}`)}};function Ev(g,b,S){S>>>=0,cs(g>>>=0,{name:b=Bi(b>>>0),fromWireType:R=>R,toWireType:function(R,M){if(typeof M!="bigint"&&typeof M!="number")throw M=M===null?"null":(R=typeof M)=="object"||R==="array"||R==="function"?M.toString():""+M,new TypeError(`Cannot convert "${M}" to ${this.name}`);return typeof M=="number"&&(M=BigInt(M)),M},Cb:Vr,readValueFromPointer:Xu(b,S,b.indexOf("u")==-1),Eb:null})}var Vr=8;function Qu(g,b,S,R){cs(g>>>=0,{name:b=Bi(b>>>0),fromWireType:function(M){return!!M},toWireType:function(M,q){return q?S:R},Cb:Vr,readValueFromPointer:function(M){return this.fromWireType(Z()[M>>>0])},Eb:null})}var ds=[],ur=[];function um(g){9<(g>>>=0)&&--ur[g+1]==0&&(ur[g]=void 0,ds.push(g))}var Mn=g=>{if(!g)throw new Xa(`Cannot use deleted val. handle = ${g}`);return ur[g]},Ti=g=>{switch(g){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let b=ds.pop()||ur.length;return ur[b]=g,ur[b+1]=1,b}};function wh(g){return this.fromWireType(de()[g>>>2>>>0])}var cm={name:"emscripten::val",fromWireType:g=>{var b=Mn(g);return um(g),b},toWireType:(g,b)=>Ti(b),Cb:Vr,readValueFromPointer:wh,Eb:null};function dm(g){return cs(g>>>0,cm)}var Av=(g,b)=>{switch(b){case 4:return function(S){return this.fromWireType(Ee()[S>>>2>>>0])};case 8:return function(S){return this.fromWireType($e()[S>>>3>>>0])};default:throw new TypeError(`invalid float width (${b}): ${g}`)}};function Tv(g,b,S){S>>>=0,cs(g>>>=0,{name:b=Bi(b>>>0),fromWireType:R=>R,toWireType:(R,M)=>M,Cb:Vr,readValueFromPointer:Av(b,S),Eb:null})}function Sv(g,b,S,R,M){if(g>>>=0,S>>>=0,b=Bi(b>>>0),M===-1&&(M=4294967295),M=ne=>ne,R===0){var q=32-8*S;M=ne=>ne<<q>>>q}var J=b.includes("unsigned")?function(ne,ue){return ue>>>0}:function(ne,ue){return ue};cs(g,{name:b,fromWireType:M,toWireType:J,Cb:Vr,readValueFromPointer:Xu(b,S,R!==0),Eb:null})}function dx(g,b,S){function R(q){var J=de()[q>>>2>>>0];return q=de()[q+4>>>2>>>0],new M(Y().buffer,q,J)}var M=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][b];cs(g>>>=0,{name:S=Bi(S>>>0),fromWireType:R,Cb:Vr,readValueFromPointer:R},{Tb:!0})}var ai=(g,b,S)=>{var R=Z();if(b>>>=0,0<S){var M=b;S=b+S-1;for(var q=0;q<g.length;++q){var J=g.charCodeAt(q);if(55296<=J&&57343>=J&&(J=65536+((1023&J)<<10)|1023&g.charCodeAt(++q)),127>=J){if(b>=S)break;R[b++>>>0]=J}else{if(2047>=J){if(b+1>=S)break;R[b++>>>0]=192|J>>6}else{if(65535>=J){if(b+2>=S)break;R[b++>>>0]=224|J>>12}else{if(b+3>=S)break;R[b++>>>0]=240|J>>18,R[b++>>>0]=128|J>>12&63}R[b++>>>0]=128|J>>6&63}R[b++>>>0]=128|63&J}}R[b>>>0]=0,g=b-M}else g=0;return g},Ui=g=>{for(var b=0,S=0;S<g.length;++S){var R=g.charCodeAt(S);127>=R?b++:2047>=R?b+=2:55296<=R&&57343>=R?(b+=4,++S):b+=3}return b};function Ju(g,b){cs(g>>>=0,{name:b=Bi(b>>>0),fromWireType:function(S){for(var R,M=de()[S>>>2>>>0],q=S+4,J=q,ne=0;ne<=M;++ne){var ue=q+ne;ne!=M&&Z()[ue>>>0]!=0||(J=Pt(J,ue-J),R===void 0?R=J:(R+="\0",R+=J),J=ue+1)}return Za(S),R},toWireType:function(S,R){R instanceof ArrayBuffer&&(R=new Uint8Array(R));var M=typeof R=="string";if(!(M||ArrayBuffer.isView(R)&&R.BYTES_PER_ELEMENT==1))throw new Xa("Cannot pass non-string to std::string");var q=M?Ui(R):R.length,J=Yv(4+q+1),ne=J+4;return de()[J>>>2>>>0]=q,M?ai(R,ne,q+1):Z().set(R,ne>>>0),S!==null&&S.push(Za,J),J},Cb:Vr,readValueFromPointer:wh,Eb(S){Za(S)}})}var dl=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,hm=(g,b)=>{for(var S=g>>1,R=S+b/2;!(S>=R)&&_e()[S>>>0];)++S;if(32<(S<<=1)-g&&dl)return dl.decode(Z().slice(g,S));for(S="",R=0;!(R>=b/2);++R){var M=fe()[g+2*R>>>1>>>0];if(M==0)break;S+=String.fromCharCode(M)}return S},Nt=(g,b,S)=>{if(S??(S=2147483647),2>S)return 0;var R=b;S=(S-=2)<2*g.length?S/2:g.length;for(var M=0;M<S;++M){var q=g.charCodeAt(M);fe()[b>>>1>>>0]=q,b+=2}return fe()[b>>>1>>>0]=0,b-R},bh=g=>2*g.length,Zu=(g,b)=>{for(var S=0,R="";!(S>=b/4);){var M=X()[g+4*S>>>2>>>0];if(M==0)break;++S,65536<=M?(M-=65536,R+=String.fromCharCode(55296|M>>10,56320|1023&M)):R+=String.fromCharCode(M)}return R},ec=(g,b,S)=>{if(b>>>=0,S??(S=2147483647),4>S)return 0;var R=b;S=R+S-4;for(var M=0;M<g.length;++M){var q=g.charCodeAt(M);if(55296<=q&&57343>=q&&(q=65536+((1023&q)<<10)|1023&g.charCodeAt(++M)),X()[b>>>2>>>0]=q,(b+=4)+4>S)break}return X()[b>>>2>>>0]=0,b-R},hx=g=>{for(var b=0,S=0;S<g.length;++S){var R=g.charCodeAt(S);55296<=R&&57343>=R&&++S,b+=4}return b};function Iv(g,b,S){if(g>>>=0,b>>>=0,S=Bi(S>>>=0),b===2)var R=hm,M=Nt,q=bh,J=ne=>_e()[ne>>>1>>>0];else b===4&&(R=Zu,M=ec,q=hx,J=ne=>de()[ne>>>2>>>0]);cs(g,{name:S,fromWireType:ne=>{for(var ue,ge=de()[ne>>>2>>>0],Se=ne+4,Le=0;Le<=ge;++Le){var Xe=ne+4+Le*b;Le!=ge&&J(Xe)!=0||(Se=R(Se,Xe-Se),ue===void 0?ue=Se:(ue+="\0",ue+=Se),Se=Xe+b)}return Za(ne),ue},toWireType:(ne,ue)=>{if(typeof ue!="string")throw new Xa(`Cannot pass non-string to C++ string type ${S}`);var ge=q(ue),Se=Yv(4+ge+b);return de()[Se>>>2>>>0]=ge/b,M(ue,Se+4,ge+b),ne!==null&&ne.push(Za,Se),Se},Cb:Vr,readValueFromPointer:wh,Eb(ne){Za(ne)}})}function fx(g,b){cs(g>>>=0,{Ub:!0,name:b=Bi(b>>>0),Cb:0,fromWireType:()=>{},toWireType:()=>{}})}function px(g){Ex(g>>>0,!l,1,!o,131072,!1),mh()}var fm=g=>{if(!H)try{if(g(),!(0<lr))try{u?Ax($):ji($)}catch(b){b instanceof Rt||b=="unwind"||_(0,b)}}catch(b){b instanceof Rt||b=="unwind"||_(0,b)}};function pm(g){g>>>=0,typeof Atomics.jc=="function"&&(Atomics.jc(X(),g>>>2,g).value.then(ia),g+=128,Atomics.store(X(),g>>>2,1))}var ia=()=>{var g=xx();g&&(pm(g),fm(mk))};function Qa(g,b){(g>>>=0)==b>>>0?setTimeout(ia):u?postMessage({Hb:g,Db:"checkMailbox"}):(g=ta[g])&&g.postMessage({Db:"checkMailbox"})}var xh=[];function Cv(g,b,S,R,M){for(b>>>=0,R/=2,xh.length=R,S=M>>>0>>>3,M=0;M<R;M++)xh[M]=j[S+2*M]?j[S+2*M+1]:$e()[S+2*M+1>>>0];return(b?bx[b]:_6[g])(...xh)}var kv=()=>{lr=0};function $v(g){g>>>=0,u?postMessage({Db:"cleanupThread",ic:g}):ll(ta[g])}function Rv(g){}var hs=(g,b)=>{var S=lm[g];if(S===void 0)throw g=uk(g),S=Bi(g),Za(g),new Xa(`${b} has unknown type ${S}`);return S},Pv=(g,b,S)=>{var R=[];return g=g.toWireType(R,S),R.length&&(de()[b>>>2>>>0]=Ti(R)),g};function mx(g,b,S){return b>>>=0,S>>>=0,g=Mn(g>>>0),b=hs(b,"emval::as"),Pv(b,S,g)}function gx(g,b){return b>>>=0,g=Mn(g>>>0),(b=hs(b,"emval::as")).toWireType(null,g)}var cr=g=>{try{g()}catch(b){or(b)}},ra=0,Hi=null,tc=0,nc=[],hl={},fl={},Nv=0,ic=null,Ht=[];function Dv(g){return function(b){if(!H){if(ra===0){var S=!1,R=!1;b((M=0)=>{if(!H&&(tc=M,S=!0,R)){ra=2,cr(()=>wk(Hi)),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.resume(),M=!1;try{var q=function(){var ue=X()[Hi+8>>>2>>>0];return ue=se[fl[ue]],--lr,ue()}()}catch(ue){q=ue,M=!0}var J=!1;if(!Hi){var ne=ic;ne&&(ic=null,(M?ne.reject:ne.resolve)(q),J=!0)}if(M&&!J)throw q}}),R=!0,S||(ra=1,Hi=function(){var M=Yv(65548),q=M+12;de()[M>>>2>>>0]=q,de()[M+4>>>2>>>0]=q+65536,q=nc[0];var J=hl[q];return J===void 0&&(J=Nv++,hl[q]=J,fl[J]=q),q=J,X()[M+8>>>2>>>0]=q,M}(),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.pause(),cr(()=>_k(Hi)))}else ra===2?(ra=0,cr(bk),Za(Hi),Hi=null,Ht.forEach(fm)):or(`invalid state: ${ra}`);return tc}}(b=>{g().then(b)})}function yx(g){return g>>>=0,Dv(async()=>{var b=await Mn(g);return Ti(b)})}var rc=[];function Mv(g,b,S,R){return S>>>=0,R>>>=0,(g=rc[g>>>0])(null,b=Mn(b>>>0),S,R)}var Ov={},Ja=g=>{var b=Ov[g];return b===void 0?Bi(g):b};function sa(g,b,S,R,M){return S>>>=0,R>>>=0,M>>>=0,(g=rc[g>>>0])(b=Mn(b>>>0),b[S=Ja(S)],R,M)}function Lv(g,b){return b>>>=0,(g=Mn(g>>>0))==Mn(b)}var Fv=()=>typeof globalThis=="object"?globalThis:Function("return this")();function sc(g){return(g>>>=0)==0?Ti(Fv()):(g=Ja(g),Ti(Fv()[g]))}var zv=g=>{var b=rc.length;return rc.push(g),b},mm=(g,b)=>{for(var S=Array(g),R=0;R<g;++R)S[R]=hs(de()[b+4*R>>>2>>>0],`parameter ${R}`);return S};function Eh(g,b,S){var R=(b=mm(g,b>>>0)).shift();g--;var M=`return function (obj, func, destructorsRef, args) {
`,q=0,J=[];S===0&&J.push("obj");for(var ne=["retType"],ue=[R],ge=0;ge<g;++ge)J.push(`arg${ge}`),ne.push(`argType${ge}`),ue.push(b[ge]),M+=`  var arg${ge} = argType${ge}.readValueFromPointer(args${q?"+"+q:""});
`,q+=b[ge].Cb;return M+=`  var rv = ${S===1?"new func":"func.call"}(${J.join(", ")});
`,R.Ub||(ne.push("emval_returnValue"),ue.push(Pv),M+=`  return emval_returnValue(retType, destructorsRef, rv);
`),g=new Function(...ne,M+`};
`)(...ue),S=`methodCaller<(${b.map(Se=>Se.name).join(", ")}) => ${R.name}>`,zv(Object.defineProperty(g,"name",{value:S}))}function Vv(g){return g=Ja(g>>>0),Ti(s[g])}function Ah(g,b){return b>>>=0,g=Mn(g>>>0),b=Mn(b),Ti(g[b])}function _x(g){9<(g>>>=0)&&(ur[g+1]+=1)}function jv(){return Ti([])}function ac(g){g=Mn(g>>>0);for(var b=Array(g.length),S=0;S<g.length;S++)b[S]=g[S];return Ti(b)}function Bv(g){return Ti(Ja(g>>>0))}function Uv(){return Ti({})}function gm(g){for(var b=Mn(g>>>=0);b.length;){var S=b.pop();b.pop()(S)}um(g)}function ym(g,b,S){b>>>=0,S>>>=0,g=Mn(g>>>0),b=Mn(b),S=Mn(S),g[b]=S}function Hv(g,b){return b>>>=0,g=(g=hs(g>>>0,"_emval_take_value")).readValueFromPointer(b),Ti(g)}function Th(g,b){g=-9007199254740992>g||9007199254740992<g?NaN:Number(g),b>>>=0,g=new Date(1e3*g),X()[b>>>2>>>0]=g.getUTCSeconds(),X()[b+4>>>2>>>0]=g.getUTCMinutes(),X()[b+8>>>2>>>0]=g.getUTCHours(),X()[b+12>>>2>>>0]=g.getUTCDate(),X()[b+16>>>2>>>0]=g.getUTCMonth(),X()[b+20>>>2>>>0]=g.getUTCFullYear()-1900,X()[b+24>>>2>>>0]=g.getUTCDay(),g=(g.getTime()-Date.UTC(g.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,X()[b+28>>>2>>>0]=g}var _m=g=>g%4==0&&(g%100!=0||g%400==0),vm=[0,31,60,91,121,152,182,213,244,274,305,335],aa=[0,31,59,90,120,151,181,212,243,273,304,334];function Wv(g,b){g=-9007199254740992>g||9007199254740992<g?NaN:Number(g),b>>>=0,g=new Date(1e3*g),X()[b>>>2>>>0]=g.getSeconds(),X()[b+4>>>2>>>0]=g.getMinutes(),X()[b+8>>>2>>>0]=g.getHours(),X()[b+12>>>2>>>0]=g.getDate(),X()[b+16>>>2>>>0]=g.getMonth(),X()[b+20>>>2>>>0]=g.getFullYear()-1900,X()[b+24>>>2>>>0]=g.getDay();var S=(_m(g.getFullYear())?vm:aa)[g.getMonth()]+g.getDate()-1|0;X()[b+28>>>2>>>0]=S,X()[b+36>>>2>>>0]=-60*g.getTimezoneOffset(),S=new Date(g.getFullYear(),6,1).getTimezoneOffset();var R=new Date(g.getFullYear(),0,1).getTimezoneOffset();g=0|(S!=R&&g.getTimezoneOffset()==Math.min(R,S)),X()[b+32>>>2>>>0]=g}function qv(g){g>>>=0;var b=new Date(X()[g+20>>>2>>>0]+1900,X()[g+16>>>2>>>0],X()[g+12>>>2>>>0],X()[g+8>>>2>>>0],X()[g+4>>>2>>>0],X()[g>>>2>>>0],0),S=X()[g+32>>>2>>>0],R=b.getTimezoneOffset(),M=new Date(b.getFullYear(),6,1).getTimezoneOffset(),q=new Date(b.getFullYear(),0,1).getTimezoneOffset(),J=Math.min(q,M);return 0>S?X()[g+32>>>2>>>0]=+(M!=q&&J==R):0<S!=(J==R)&&(M=Math.max(q,M),b.setTime(b.getTime()+6e4*((0<S?J:M)-R))),X()[g+24>>>2>>>0]=b.getDay(),S=(_m(b.getFullYear())?vm:aa)[b.getMonth()]+b.getDate()-1|0,X()[g+28>>>2>>>0]=S,X()[g>>>2>>>0]=b.getSeconds(),X()[g+4>>>2>>>0]=b.getMinutes(),X()[g+8>>>2>>>0]=b.getHours(),X()[g+12>>>2>>>0]=b.getDate(),X()[g+16>>>2>>>0]=b.getMonth(),X()[g+20>>>2>>>0]=b.getYear(),g=b.getTime(),BigInt(isNaN(g)?-1:g/1e3)}function wm(g,b,S,R,M,q,J){return u?it(16,1,g,b,S,R,M,q,J):-52}function bm(g,b,S,R,M,q){if(u)return it(17,1,g,b,S,R,M,q)}var oa={},Si=()=>performance.timeOrigin+performance.now();function xm(g,b){if(u)return it(18,1,g,b);if(oa[g]&&(clearTimeout(oa[g].id),delete oa[g]),!b)return 0;var S=setTimeout(()=>{delete oa[g],fm(()=>pk(g,performance.timeOrigin+performance.now()))},b);return oa[g]={id:S,rc:b},0}function Gv(g,b,S,R){g>>>=0,b>>>=0,S>>>=0,R>>>=0;var M=new Date().getFullYear(),q=new Date(M,0,1).getTimezoneOffset();M=new Date(M,6,1).getTimezoneOffset();var J=Math.max(q,M);de()[g>>>2>>>0]=60*J,X()[b>>>2>>>0]=+(q!=M),g=(b=ne=>{var ue=Math.abs(ne);return`UTC${0<=ne?"-":"+"}${String(Math.floor(ue/60)).padStart(2,"0")}${String(ue%60).padStart(2,"0")}`})(q),b=b(M),M<q?(ai(g,S,17),ai(b,R,17)):(ai(g,R,17),ai(b,S,17))}var pl=()=>Date.now();function p(g,b,S){return 0<=g&&3>=g?(g===0?g=Date.now():g=performance.timeOrigin+performance.now(),j[S>>>0>>>3]=BigInt(Math.round(1e6*g)),0):28}var A=[],D=(g,b)=>{A.length=0;for(var S;S=Z()[g++>>>0];){var R=S!=105;b+=(R&=S!=112)&&b%8?4:0,A.push(S==112?de()[b>>>2>>>0]:S==106?j[b>>>3]:S==105?X()[b>>>2>>>0]:$e()[b>>>3>>>0]),b+=R?8:4}return A};function B(g,b,S){return g>>>=0,b=D(b>>>0,S>>>0),bx[g](...b)}function ee(g,b,S){return g>>>=0,b=D(b>>>0,S>>>0),bx[g](...b)}var re=()=>{};function ve(g,b){return K(Pt(g>>>0,b>>>0))}var Qe=()=>{throw lr+=1,"unwind"};function un(){return 4294901760}var At=()=>navigator.hardwareConcurrency;function mn(){return or("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function jr(g){g>>>=0;var b=Z().length;if(g<=b||4294901760<g)return!1;for(var S=1;4>=S;S*=2){var R=b*(1+.2/S);R=Math.min(R,g+100663296);e:{R=(Math.min(4294901760,65536*Math.ceil(Math.max(g,R)/65536))-E.buffer.byteLength+65535)/65536|0;try{E.grow(R),He();var M=1;break e}catch{}M=void 0}if(M)return!0}return!1}var Br=()=>(or("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),Wi={},fs=g=>{g.forEach(b=>{Br()})};function Sh(){var g=Error().stack.toString().split(`
`);return g[0]=="Error"&&g.shift(),fs(g),Wi.Mb=Br(),Wi.dc=g,Wi.Mb}function Em(g,b,S){if(g>>>=0,b>>>=0,Wi.Mb==g)var R=Wi.dc;else(R=Error().stack.toString().split(`
`))[0]=="Error"&&R.shift(),fs(R);for(var M=3;R[M]&&Br()!=g;)++M;for(g=0;g<S&&R[g+M];++g)X()[b+4*g>>>2>>>0]=Br();return g}var vx,wx={},tk=()=>{if(!vx){var g,b={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(g in wx)wx[g]===void 0?delete b[g]:b[g]=wx[g];var S=[];for(g in b)S.push(`${g}=${b[g]}`);vx=S}return vx};function nk(g,b){if(u)return it(19,1,g,b);g>>>=0,b>>>=0;var S,R=0,M=0;for(S of tk()){var q=b+R;de()[g+M>>>2>>>0]=q,R+=ai(S,q,1/0)+1,M+=4}return 0}function ik(g,b){if(u)return it(20,1,g,b);g>>>=0,b>>>=0;var S=tk();for(var R of(de()[g>>>2>>>0]=S.length,g=0,S))g+=Ui(R)+1;return de()[b>>>2>>>0]=g,0}function rk(g){return u?it(21,1,g):52}function sk(g,b,S,R){return u?it(22,1,g,b,S,R):52}function ak(g,b,S,R){return u?it(23,1,g,b,S,R):70}var y6=[null,[],[]];function ok(g,b,S,R){if(u)return it(24,1,g,b,S,R);b>>>=0,S>>>=0,R>>>=0;for(var M=0,q=0;q<S;q++){var J=de()[b>>>2>>>0],ne=de()[b+4>>>2>>>0];b+=8;for(var ue=0;ue<ne;ue++){var ge=g,Se=Z()[J+ue>>>0],Le=y6[ge];Se===0||Se===10?((ge===1?W:K)(ul(Le)),Le.length=0):Le.push(Se)}M+=ne}return de()[R>>>2>>>0]=M,0}u||function(){for(var g=s.numThreads-1;g--;)na();Ka.push(()=>{Xt++,function(b){u?b():Promise.all(ea.map(gh)).then(b)}(()=>ls())})}();for(var lk=Array(256),Kv=0;256>Kv;++Kv)lk[Kv]=String.fromCharCode(Kv);am=lk,ur.push(0,1,void 0,1,null,1,!0,1,!1,1),s.count_emval_handles=()=>ur.length/2-5-ds.length,u||(E=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),He()),s.wasmBinary&&(w=s.wasmBinary),s.stackSave=()=>Sx(),s.stackRestore=g=>Xv(g),s.stackAlloc=g=>Tx(g),s.setValue=function(g,b,S="i8"){switch(S.endsWith("*")&&(S="*"),S){case"i1":case"i8":Y()[g>>>0]=b;break;case"i16":fe()[g>>>1>>>0]=b;break;case"i32":X()[g>>>2>>>0]=b;break;case"i64":j[g>>>3]=BigInt(b);break;case"float":Ee()[g>>>2>>>0]=b;break;case"double":$e()[g>>>3>>>0]=b;break;case"*":de()[g>>>2>>>0]=b;break;default:or(`invalid type for setValue: ${S}`)}},s.getValue=function(g,b="i8"){switch(b.endsWith("*")&&(b="*"),b){case"i1":case"i8":return Y()[g>>>0];case"i16":return fe()[g>>>1>>>0];case"i32":return X()[g>>>2>>>0];case"i64":return j[g>>>3];case"float":return Ee()[g>>>2>>>0];case"double":return $e()[g>>>3>>>0];case"*":return de()[g>>>2>>>0];default:or(`invalid type for getValue: ${b}`)}},s.UTF8ToString=Pt,s.stringToUTF8=ai,s.lengthBytesUTF8=Ui;var _6=[ol,qu,tm,_v,vv,Ya,wv,bv,Yu,im,rm,_h,cl,xv,us,sm,wm,bm,xm,nk,ik,rk,sk,ak,ok],bx={893836:(g,b,S,R,M)=>{if(s===void 0||!s.Fb)return 1;if((g=Pt(Number(g>>>0))).startsWith("./")&&(g=g.substring(2)),!(g=s.Fb.get(g)))return 2;if(b=Number(b>>>0),S=Number(S>>>0),R=Number(R>>>0),b+S>g.byteLength)return 3;try{let q=g.subarray(b,b+S);switch(M){case 0:Z().set(q,R>>>0);break;case 1:s.mc?s.mc(R,q):s.cc(R,q);break;default:return 4}return 0}catch{return 4}},894660:(g,b,S)=>{s.Pb(g,Z().subarray(b>>>0,b+S>>>0))},894724:()=>s.oc(),894766:g=>{s.Ob(g)},894803:()=>{s.Wb()},894834:()=>{s.Xb()},894863:()=>{s.ac()},894888:g=>s.Vb(g),894921:g=>s.Zb(g),894953:(g,b,S)=>{s.Lb(Number(g),Number(b),Number(S),!0)},895016:(g,b,S)=>{s.Lb(Number(g),Number(b),Number(S))},895073:()=>typeof wasmOffsetConverter<"u",895130:g=>{s.Ab("Abs",g,void 0)},895181:g=>{s.Ab("Neg",g,void 0)},895232:g=>{s.Ab("Floor",g,void 0)},895285:g=>{s.Ab("Ceil",g,void 0)},895337:g=>{s.Ab("Reciprocal",g,void 0)},895395:g=>{s.Ab("Sqrt",g,void 0)},895447:g=>{s.Ab("Exp",g,void 0)},895498:g=>{s.Ab("Erf",g,void 0)},895549:g=>{s.Ab("Sigmoid",g,void 0)},895604:(g,b,S)=>{s.Ab("HardSigmoid",g,{alpha:b,beta:S})},895683:g=>{s.Ab("Log",g,void 0)},895734:g=>{s.Ab("Sin",g,void 0)},895785:g=>{s.Ab("Cos",g,void 0)},895836:g=>{s.Ab("Tan",g,void 0)},895887:g=>{s.Ab("Asin",g,void 0)},895939:g=>{s.Ab("Acos",g,void 0)},895991:g=>{s.Ab("Atan",g,void 0)},896043:g=>{s.Ab("Sinh",g,void 0)},896095:g=>{s.Ab("Cosh",g,void 0)},896147:g=>{s.Ab("Asinh",g,void 0)},896200:g=>{s.Ab("Acosh",g,void 0)},896253:g=>{s.Ab("Atanh",g,void 0)},896306:g=>{s.Ab("Tanh",g,void 0)},896358:g=>{s.Ab("Not",g,void 0)},896409:(g,b,S)=>{s.Ab("Clip",g,{min:b,max:S})},896478:g=>{s.Ab("Clip",g,void 0)},896530:(g,b)=>{s.Ab("Elu",g,{alpha:b})},896588:g=>{s.Ab("Gelu",g,void 0)},896640:g=>{s.Ab("Relu",g,void 0)},896692:(g,b)=>{s.Ab("LeakyRelu",g,{alpha:b})},896756:(g,b)=>{s.Ab("ThresholdedRelu",g,{alpha:b})},896826:(g,b)=>{s.Ab("Cast",g,{to:b})},896884:g=>{s.Ab("Add",g,void 0)},896935:g=>{s.Ab("Sub",g,void 0)},896986:g=>{s.Ab("Mul",g,void 0)},897037:g=>{s.Ab("Div",g,void 0)},897088:g=>{s.Ab("Pow",g,void 0)},897139:g=>{s.Ab("Equal",g,void 0)},897192:g=>{s.Ab("Greater",g,void 0)},897247:g=>{s.Ab("GreaterOrEqual",g,void 0)},897309:g=>{s.Ab("Less",g,void 0)},897361:g=>{s.Ab("LessOrEqual",g,void 0)},897420:(g,b,S,R,M)=>{s.Ab("ReduceMean",g,{keepDims:!!b,noopWithEmptyAxes:!!S,axes:R?Array.from(X().subarray(Number(R)>>>0,Number(M)>>>0)):[]})},897595:(g,b,S,R,M)=>{s.Ab("ReduceMax",g,{keepDims:!!b,noopWithEmptyAxes:!!S,axes:R?Array.from(X().subarray(Number(R)>>>0,Number(M)>>>0)):[]})},897769:(g,b,S,R,M)=>{s.Ab("ReduceMin",g,{keepDims:!!b,noopWithEmptyAxes:!!S,axes:R?Array.from(X().subarray(Number(R)>>>0,Number(M)>>>0)):[]})},897943:(g,b,S,R,M)=>{s.Ab("ReduceProd",g,{keepDims:!!b,noopWithEmptyAxes:!!S,axes:R?Array.from(X().subarray(Number(R)>>>0,Number(M)>>>0)):[]})},898118:(g,b,S,R,M)=>{s.Ab("ReduceSum",g,{keepDims:!!b,noopWithEmptyAxes:!!S,axes:R?Array.from(X().subarray(Number(R)>>>0,Number(M)>>>0)):[]})},898292:(g,b,S,R,M)=>{s.Ab("ReduceL1",g,{keepDims:!!b,noopWithEmptyAxes:!!S,axes:R?Array.from(X().subarray(Number(R)>>>0,Number(M)>>>0)):[]})},898465:(g,b,S,R,M)=>{s.Ab("ReduceL2",g,{keepDims:!!b,noopWithEmptyAxes:!!S,axes:R?Array.from(X().subarray(Number(R)>>>0,Number(M)>>>0)):[]})},898638:(g,b,S,R,M)=>{s.Ab("ReduceLogSum",g,{keepDims:!!b,noopWithEmptyAxes:!!S,axes:R?Array.from(X().subarray(Number(R)>>>0,Number(M)>>>0)):[]})},898815:(g,b,S,R,M)=>{s.Ab("ReduceSumSquare",g,{keepDims:!!b,noopWithEmptyAxes:!!S,axes:R?Array.from(X().subarray(Number(R)>>>0,Number(M)>>>0)):[]})},898995:(g,b,S,R,M)=>{s.Ab("ReduceLogSumExp",g,{keepDims:!!b,noopWithEmptyAxes:!!S,axes:R?Array.from(X().subarray(Number(R)>>>0,Number(M)>>>0)):[]})},899175:g=>{s.Ab("Where",g,void 0)},899228:(g,b,S)=>{s.Ab("Transpose",g,{perm:b?Array.from(X().subarray(Number(b)>>>0,Number(S)>>>0)):[]})},899352:(g,b,S,R)=>{s.Ab("DepthToSpace",g,{blocksize:b,mode:Pt(S),format:R?"NHWC":"NCHW"})},899485:(g,b,S,R)=>{s.Ab("DepthToSpace",g,{blocksize:b,mode:Pt(S),format:R?"NHWC":"NCHW"})},899618:(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt,gn)=>{s.Ab("ConvTranspose",g,{format:ue?"NHWC":"NCHW",autoPad:b,dilations:[S],group:R,kernelShape:[M],pads:[q,J],strides:[ne],wIsConst:()=>!!Y()[ge>>>0],outputPadding:Se?Array.from(X().subarray(Number(Se)>>>0,Number(Le)>>>0)):[],outputShape:Xe?Array.from(X().subarray(Number(Xe)>>>0,Number(mt)>>>0)):[],activation:Pt(gn)})},900051:(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt)=>{s.Ab("ConvTranspose",g,{format:ne?"NHWC":"NCHW",autoPad:b,dilations:Array.from(X().subarray(Number(S)>>>0,2+(Number(S)>>>0)>>>0)),group:R,kernelShape:Array.from(X().subarray(Number(M)>>>0,2+(Number(M)>>>0)>>>0)),pads:Array.from(X().subarray(Number(q)>>>0,4+(Number(q)>>>0)>>>0)),strides:Array.from(X().subarray(Number(J)>>>0,2+(Number(J)>>>0)>>>0)),wIsConst:()=>!!Y()[ue>>>0],outputPadding:ge?Array.from(X().subarray(Number(ge)>>>0,Number(Se)>>>0)):[],outputShape:Le?Array.from(X().subarray(Number(Le)>>>0,Number(Xe)>>>0)):[],activation:Pt(mt)})},900712:(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt,gn)=>{s.Ab("ConvTranspose",g,{format:ue?"NHWC":"NCHW",autoPad:b,dilations:[S],group:R,kernelShape:[M],pads:[q,J],strides:[ne],wIsConst:()=>!!Y()[ge>>>0],outputPadding:Se?Array.from(X().subarray(Number(Se)>>>0,Number(Le)>>>0)):[],outputShape:Xe?Array.from(X().subarray(Number(Xe)>>>0,Number(mt)>>>0)):[],activation:Pt(gn)})},901145:(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt)=>{s.Ab("ConvTranspose",g,{format:ne?"NHWC":"NCHW",autoPad:b,dilations:Array.from(X().subarray(Number(S)>>>0,2+(Number(S)>>>0)>>>0)),group:R,kernelShape:Array.from(X().subarray(Number(M)>>>0,2+(Number(M)>>>0)>>>0)),pads:Array.from(X().subarray(Number(q)>>>0,4+(Number(q)>>>0)>>>0)),strides:Array.from(X().subarray(Number(J)>>>0,2+(Number(J)>>>0)>>>0)),wIsConst:()=>!!Y()[ue>>>0],outputPadding:ge?Array.from(X().subarray(Number(ge)>>>0,Number(Se)>>>0)):[],outputShape:Le?Array.from(X().subarray(Number(Le)>>>0,Number(Xe)>>>0)):[],activation:Pt(mt)})},901806:(g,b)=>{s.Ab("GlobalAveragePool",g,{format:b?"NHWC":"NCHW"})},901897:(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt)=>{s.Ab("AveragePool",g,{format:mt?"NHWC":"NCHW",auto_pad:b,ceil_mode:S,count_include_pad:R,storage_order:M,dilations:q?Array.from(X().subarray(Number(q)>>>0,Number(J)>>>0)):[],kernel_shape:ne?Array.from(X().subarray(Number(ne)>>>0,Number(ue)>>>0)):[],pads:ge?Array.from(X().subarray(Number(ge)>>>0,Number(Se)>>>0)):[],strides:Le?Array.from(X().subarray(Number(Le)>>>0,Number(Xe)>>>0)):[]})},902376:(g,b)=>{s.Ab("GlobalAveragePool",g,{format:b?"NHWC":"NCHW"})},902467:(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt)=>{s.Ab("AveragePool",g,{format:mt?"NHWC":"NCHW",auto_pad:b,ceil_mode:S,count_include_pad:R,storage_order:M,dilations:q?Array.from(X().subarray(Number(q)>>>0,Number(J)>>>0)):[],kernel_shape:ne?Array.from(X().subarray(Number(ne)>>>0,Number(ue)>>>0)):[],pads:ge?Array.from(X().subarray(Number(ge)>>>0,Number(Se)>>>0)):[],strides:Le?Array.from(X().subarray(Number(Le)>>>0,Number(Xe)>>>0)):[]})},902946:(g,b)=>{s.Ab("GlobalMaxPool",g,{format:b?"NHWC":"NCHW"})},903033:(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt)=>{s.Ab("MaxPool",g,{format:mt?"NHWC":"NCHW",auto_pad:b,ceil_mode:S,count_include_pad:R,storage_order:M,dilations:q?Array.from(X().subarray(Number(q)>>>0,Number(J)>>>0)):[],kernel_shape:ne?Array.from(X().subarray(Number(ne)>>>0,Number(ue)>>>0)):[],pads:ge?Array.from(X().subarray(Number(ge)>>>0,Number(Se)>>>0)):[],strides:Le?Array.from(X().subarray(Number(Le)>>>0,Number(Xe)>>>0)):[]})},903508:(g,b)=>{s.Ab("GlobalMaxPool",g,{format:b?"NHWC":"NCHW"})},903595:(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt)=>{s.Ab("MaxPool",g,{format:mt?"NHWC":"NCHW",auto_pad:b,ceil_mode:S,count_include_pad:R,storage_order:M,dilations:q?Array.from(X().subarray(Number(q)>>>0,Number(J)>>>0)):[],kernel_shape:ne?Array.from(X().subarray(Number(ne)>>>0,Number(ue)>>>0)):[],pads:ge?Array.from(X().subarray(Number(ge)>>>0,Number(Se)>>>0)):[],strides:Le?Array.from(X().subarray(Number(Le)>>>0,Number(Xe)>>>0)):[]})},904070:(g,b,S,R,M)=>{s.Ab("Gemm",g,{alpha:b,beta:S,transA:R,transB:M})},904174:g=>{s.Ab("MatMul",g,void 0)},904228:(g,b,S,R)=>{s.Ab("ArgMax",g,{keepDims:!!b,selectLastIndex:!!S,axis:R})},904336:(g,b,S,R)=>{s.Ab("ArgMin",g,{keepDims:!!b,selectLastIndex:!!S,axis:R})},904444:(g,b)=>{s.Ab("Softmax",g,{axis:b})},904507:(g,b)=>{s.Ab("Concat",g,{axis:b})},904567:(g,b,S,R,M)=>{s.Ab("Split",g,{axis:b,numOutputs:S,splitSizes:R?Array.from(X().subarray(Number(R)>>>0,Number(M)>>>0)):[]})},904723:g=>{s.Ab("Expand",g,void 0)},904777:(g,b)=>{s.Ab("Gather",g,{axis:Number(b)})},904848:(g,b)=>{s.Ab("GatherElements",g,{axis:Number(b)})},904927:(g,b)=>{s.Ab("GatherND",g,{batch_dims:Number(b)})},905006:(g,b,S,R,M,q,J,ne,ue,ge,Se)=>{s.Ab("Resize",g,{antialias:b,axes:S?Array.from(X().subarray(Number(S)>>>0,Number(R)>>>0)):[],coordinateTransformMode:Pt(M),cubicCoeffA:q,excludeOutside:J,extrapolationValue:ne,keepAspectRatioPolicy:Pt(ue),mode:Pt(ge),nearestMode:Pt(Se)})},905368:(g,b,S,R,M,q,J)=>{s.Ab("Slice",g,{starts:b?Array.from(X().subarray(Number(b)>>>0,Number(S)>>>0)):[],ends:R?Array.from(X().subarray(Number(R)>>>0,Number(M)>>>0)):[],axes:q?Array.from(X().subarray(Number(q)>>>0,Number(J)>>>0)):[]})},905632:g=>{s.Ab("Tile",g,void 0)},905684:(g,b,S)=>{s.Ab("InstanceNormalization",g,{epsilon:b,format:S?"NHWC":"NCHW"})},905798:(g,b,S)=>{s.Ab("InstanceNormalization",g,{epsilon:b,format:S?"NHWC":"NCHW"})},905912:g=>{s.Ab("Range",g,void 0)},905965:(g,b)=>{s.Ab("Einsum",g,{equation:Pt(b)})},906046:(g,b,S,R,M)=>{s.Ab("Pad",g,{mode:b,value:S,pads:R?Array.from(X().subarray(Number(R)>>>0,Number(M)>>>0)):[]})},906189:(g,b,S,R,M,q)=>{s.Ab("BatchNormalization",g,{epsilon:b,momentum:S,spatial:!!M,trainingMode:!!R,format:q?"NHWC":"NCHW"})},906358:(g,b,S,R,M,q)=>{s.Ab("BatchNormalization",g,{epsilon:b,momentum:S,spatial:!!M,trainingMode:!!R,format:q?"NHWC":"NCHW"})},906527:(g,b,S)=>{s.Ab("CumSum",g,{exclusive:Number(b),reverse:Number(S)})},906624:(g,b,S)=>{s.Ab("DequantizeLinear",g,{axis:b,blockSize:S})},906714:(g,b,S,R,M)=>{s.Ab("GridSample",g,{align_corners:b,mode:Pt(S),padding_mode:Pt(R),format:M?"NHWC":"NCHW"})},906884:(g,b,S,R,M)=>{s.Ab("GridSample",g,{align_corners:b,mode:Pt(S),padding_mode:Pt(R),format:M?"NHWC":"NCHW"})},907054:(g,b)=>{s.Ab("ScatterND",g,{reduction:Pt(b)})},907139:(g,b,S,R,M,q,J,ne,ue)=>{s.Ab("Attention",g,{numHeads:b,isUnidirectional:S,maskFilterValue:R,scale:M,doRotary:q,qkvHiddenSizes:J?Array.from(X().subarray(Number(ne)>>>0,Number(ne)+J>>>0)):[],pastPresentShareBuffer:!!ue})},907411:g=>{s.Ab("BiasAdd",g,void 0)},907466:g=>{s.Ab("BiasSplitGelu",g,void 0)},907527:g=>{s.Ab("FastGelu",g,void 0)},907583:(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt,gn,dr)=>{s.Ab("Conv",g,{format:Le?"NHWC":"NCHW",auto_pad:b,dilations:S?Array.from(X().subarray(Number(S)>>>0,Number(R)>>>0)):[],group:M,kernel_shape:q?Array.from(X().subarray(Number(q)>>>0,Number(J)>>>0)):[],pads:ne?Array.from(X().subarray(Number(ne)>>>0,Number(ue)>>>0)):[],strides:ge?Array.from(X().subarray(Number(ge)>>>0,Number(Se)>>>0)):[],w_is_const:()=>!!Y()[Number(Xe)>>>0],activation:Pt(mt),activation_params:gn?Array.from(Ee().subarray(Number(gn)>>>0,Number(dr)>>>0)):[]})},908167:g=>{s.Ab("Gelu",g,void 0)},908219:(g,b,S,R,M,q,J,ne,ue)=>{s.Ab("GroupQueryAttention",g,{numHeads:b,kvNumHeads:S,scale:R,softcap:M,doRotary:q,rotaryInterleaved:J,smoothSoftmax:ne,localWindowSize:ue})},908436:(g,b,S,R)=>{s.Ab("LayerNormalization",g,{axis:b,epsilon:S,simplified:!!R})},908547:(g,b,S,R)=>{s.Ab("LayerNormalization",g,{axis:b,epsilon:S,simplified:!!R})},908658:(g,b,S,R,M,q)=>{s.Ab("MatMulNBits",g,{k:b,n:S,accuracyLevel:R,bits:M,blockSize:q})},908785:(g,b,S,R,M,q)=>{s.Ab("MultiHeadAttention",g,{numHeads:b,isUnidirectional:S,maskFilterValue:R,scale:M,doRotary:q})},908944:(g,b)=>{s.Ab("QuickGelu",g,{alpha:b})},909008:(g,b,S,R,M)=>{s.Ab("RotaryEmbedding",g,{interleaved:!!b,numHeads:S,rotaryEmbeddingDim:R,scale:M})},909147:(g,b,S)=>{s.Ab("SkipLayerNormalization",g,{epsilon:b,simplified:!!S})},909249:(g,b,S)=>{s.Ab("SkipLayerNormalization",g,{epsilon:b,simplified:!!S})},909351:(g,b,S,R)=>{s.Ab("GatherBlockQuantized",g,{gatherAxis:b,quantizeAxis:S,blockSize:R})},909472:g=>{s.$b(g)},909506:(g,b)=>s.bc(Number(g),Number(b),s.Gb.ec,s.Gb.errors)};function v6(g,b,S){return Dv(async()=>{await s.Yb(Number(g),Number(b),Number(S))})}function w6(){return typeof wasmOffsetConverter<"u"}var se=await async function(){function g(R,M){return se=R.exports,se=function(){var q=se,J={};for(let[ne,ue]of Object.entries(q))J[ne]=typeof ue=="function"?(...ge)=>{nc.push(ne);try{return ue(...ge)}finally{H||(nc.pop(),Hi&&ra===1&&nc.length===0&&(ra=0,lr+=1,cr(vk),typeof Fibers<"u"&&Fibers.sc()))}}:ue;return J}(),se=function(){var q=se,J=ue=>ge=>ue(ge)>>>0,ne=ue=>()=>ue()>>>0;return(q=Object.assign({},q)).Ea=J(q.Ea),q.gb=ne(q.gb),q.ib=J(q.ib),q.tb=J(q.tb),q.ub=ne(q.ub),q.__cxa_get_exception_ptr=J(q.__cxa_get_exception_ptr),q}(),em.push(se.jb),k=M,ls(),se}Xt++;var b=Mt();if(s.instantiateWasm)return new Promise(R=>{s.instantiateWasm(b,(M,q)=>{R(g(M,q))})});if(u)return new Promise(R=>{te=M=>{var q=new WebAssembly.Instance(M,Mt());R(g(q,M))}});Et??(Et=s.locateFile?s.locateFile?s.locateFile("ort-wasm-simd-threaded.jsep.wasm",v):v+"ort-wasm-simd-threaded.jsep.wasm":new URL("/blood-report-fitness-evaluation-system/assets/ort-wasm-simd-threaded.jsep-BGTZ4Y7F.wasm",import.meta.url).href);try{var S=await async function(R){var M=Et;if(!w&&typeof WebAssembly.instantiateStreaming=="function"&&!Q(M))try{var q=fetch(M,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(q,R)}catch(J){K(`wasm streaming compile failed: ${J}`),K("falling back to ArrayBuffer instantiation")}return async function(J,ne){try{var ue=await async function(ge){if(!w)try{var Se=await m(ge);return new Uint8Array(Se)}catch{}if(ge==Et&&w)ge=new Uint8Array(w);else{if(!y)throw"both async and sync fetching of the wasm failed";ge=y(ge)}return ge}(J);return await WebAssembly.instantiate(ue,ne)}catch(ge){K(`failed to asynchronously prepare wasm: ${ge}`),or(ge)}}(M,R)}(b);return g(S.instance,S.module)}catch(R){return r(R),Promise.reject(R)}}(),uk=g=>(uk=se.Ea)(g),ck=()=>(ck=se.Fa)();s._OrtInit=(g,b)=>(s._OrtInit=se.Ga)(g,b),s._OrtGetLastError=(g,b)=>(s._OrtGetLastError=se.Ha)(g,b),s._OrtCreateSessionOptions=(g,b,S,R,M,q,J,ne,ue,ge)=>(s._OrtCreateSessionOptions=se.Ia)(g,b,S,R,M,q,J,ne,ue,ge),s._OrtAppendExecutionProvider=(g,b,S,R,M)=>(s._OrtAppendExecutionProvider=se.Ja)(g,b,S,R,M),s._OrtAddFreeDimensionOverride=(g,b,S)=>(s._OrtAddFreeDimensionOverride=se.Ka)(g,b,S),s._OrtAddSessionConfigEntry=(g,b,S)=>(s._OrtAddSessionConfigEntry=se.La)(g,b,S),s._OrtReleaseSessionOptions=g=>(s._OrtReleaseSessionOptions=se.Ma)(g),s._OrtCreateSession=(g,b,S)=>(s._OrtCreateSession=se.Na)(g,b,S),s._OrtReleaseSession=g=>(s._OrtReleaseSession=se.Oa)(g),s._OrtGetInputOutputCount=(g,b,S)=>(s._OrtGetInputOutputCount=se.Pa)(g,b,S),s._OrtGetInputOutputMetadata=(g,b,S,R)=>(s._OrtGetInputOutputMetadata=se.Qa)(g,b,S,R),s._OrtFree=g=>(s._OrtFree=se.Ra)(g),s._OrtCreateTensor=(g,b,S,R,M,q)=>(s._OrtCreateTensor=se.Sa)(g,b,S,R,M,q),s._OrtGetTensorData=(g,b,S,R,M)=>(s._OrtGetTensorData=se.Ta)(g,b,S,R,M),s._OrtReleaseTensor=g=>(s._OrtReleaseTensor=se.Ua)(g),s._OrtCreateRunOptions=(g,b,S,R)=>(s._OrtCreateRunOptions=se.Va)(g,b,S,R),s._OrtAddRunConfigEntry=(g,b,S)=>(s._OrtAddRunConfigEntry=se.Wa)(g,b,S),s._OrtReleaseRunOptions=g=>(s._OrtReleaseRunOptions=se.Xa)(g),s._OrtCreateBinding=g=>(s._OrtCreateBinding=se.Ya)(g),s._OrtBindInput=(g,b,S)=>(s._OrtBindInput=se.Za)(g,b,S),s._OrtBindOutput=(g,b,S,R)=>(s._OrtBindOutput=se._a)(g,b,S,R),s._OrtClearBoundOutputs=g=>(s._OrtClearBoundOutputs=se.$a)(g),s._OrtReleaseBinding=g=>(s._OrtReleaseBinding=se.ab)(g),s._OrtRunWithBinding=(g,b,S,R,M)=>(s._OrtRunWithBinding=se.bb)(g,b,S,R,M),s._OrtRun=(g,b,S,R,M,q,J,ne)=>(s._OrtRun=se.cb)(g,b,S,R,M,q,J,ne),s._OrtEndProfiling=g=>(s._OrtEndProfiling=se.db)(g),s._JsepOutput=(g,b,S)=>(s._JsepOutput=se.eb)(g,b,S),s._JsepGetNodeName=g=>(s._JsepGetNodeName=se.fb)(g);var xx=()=>(xx=se.gb)(),Za=s._free=g=>(Za=s._free=se.hb)(g),Yv=s._malloc=g=>(Yv=s._malloc=se.ib)(g),Ex=(g,b,S,R,M,q)=>(Ex=se.kb)(g,b,S,R,M,q),dk=()=>(dk=se.lb)(),hk=(g,b,S,R,M)=>(hk=se.mb)(g,b,S,R,M),fk=g=>(fk=se.nb)(g),Ax=g=>(Ax=se.ob)(g),pk=(g,b)=>(pk=se.pb)(g,b),mk=()=>(mk=se.qb)(),gk=(g,b)=>(gk=se.rb)(g,b),Xv=g=>(Xv=se.sb)(g),Tx=g=>(Tx=se.tb)(g),Sx=()=>(Sx=se.ub)(),yk=s.dynCall_ii=(g,b)=>(yk=s.dynCall_ii=se.vb)(g,b);s.dynCall_vii=(g,b,S)=>(s.dynCall_vii=se.dynCall_vii)(g,b,S),s.dynCall_iiiii=(g,b,S,R,M)=>(s.dynCall_iiiii=se.dynCall_iiiii)(g,b,S,R,M),s.dynCall_iii=(g,b,S)=>(s.dynCall_iii=se.dynCall_iii)(g,b,S),s.dynCall_iiiiii=(g,b,S,R,M,q)=>(s.dynCall_iiiiii=se.dynCall_iiiiii)(g,b,S,R,M,q),s.dynCall_iiiiiiii=(g,b,S,R,M,q,J,ne)=>(s.dynCall_iiiiiiii=se.dynCall_iiiiiiii)(g,b,S,R,M,q,J,ne),s.dynCall_iiiiiii=(g,b,S,R,M,q,J)=>(s.dynCall_iiiiiii=se.dynCall_iiiiiii)(g,b,S,R,M,q,J),s.dynCall_vi=(g,b)=>(s.dynCall_vi=se.dynCall_vi)(g,b),s.dynCall_iiii=(g,b,S,R)=>(s.dynCall_iiii=se.dynCall_iiii)(g,b,S,R),s.dynCall_i=g=>(s.dynCall_i=se.dynCall_i)(g),s.dynCall_viiiiiiii=(g,b,S,R,M,q,J,ne,ue)=>(s.dynCall_viiiiiiii=se.dynCall_viiiiiiii)(g,b,S,R,M,q,J,ne,ue),s.dynCall_viii=(g,b,S,R)=>(s.dynCall_viii=se.dynCall_viii)(g,b,S,R),s.dynCall_viijj=(g,b,S,R,M)=>(s.dynCall_viijj=se.dynCall_viijj)(g,b,S,R,M),s.dynCall_viiiiii=(g,b,S,R,M,q,J)=>(s.dynCall_viiiiii=se.dynCall_viiiiii)(g,b,S,R,M,q,J),s.dynCall_viiii=(g,b,S,R,M)=>(s.dynCall_viiii=se.dynCall_viiii)(g,b,S,R,M),s.dynCall_viiiii=(g,b,S,R,M,q)=>(s.dynCall_viiiii=se.dynCall_viiiii)(g,b,S,R,M,q),s.dynCall_vfiii=(g,b,S,R,M)=>(s.dynCall_vfiii=se.dynCall_vfiii)(g,b,S,R,M),s.dynCall_viiiiff=(g,b,S,R,M,q,J)=>(s.dynCall_viiiiff=se.dynCall_viiiiff)(g,b,S,R,M,q,J),s.dynCall_viiiiiff=(g,b,S,R,M,q,J,ne)=>(s.dynCall_viiiiiff=se.dynCall_viiiiiff)(g,b,S,R,M,q,J,ne),s.dynCall_ffff=(g,b,S,R)=>(s.dynCall_ffff=se.dynCall_ffff)(g,b,S,R),s.dynCall_viiff=(g,b,S,R,M)=>(s.dynCall_viiff=se.dynCall_viiff)(g,b,S,R,M),s.dynCall_fffffff=(g,b,S,R,M,q,J)=>(s.dynCall_fffffff=se.dynCall_fffffff)(g,b,S,R,M,q,J),s.dynCall_jjjjjjj=(g,b,S,R,M,q,J)=>(s.dynCall_jjjjjjj=se.dynCall_jjjjjjj)(g,b,S,R,M,q,J),s.dynCall_jjjjjj=(g,b,S,R,M,q)=>(s.dynCall_jjjjjj=se.dynCall_jjjjjj)(g,b,S,R,M,q),s.dynCall_iijjii=(g,b,S,R,M,q)=>(s.dynCall_iijjii=se.dynCall_iijjii)(g,b,S,R,M,q),s.dynCall_viiiiiiiiiiiii=(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt)=>(s.dynCall_viiiiiiiiiiiii=se.dynCall_viiiiiiiiiiiii)(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt),s.dynCall_viiiiiiiiii=(g,b,S,R,M,q,J,ne,ue,ge,Se)=>(s.dynCall_viiiiiiiiii=se.dynCall_viiiiiiiiii)(g,b,S,R,M,q,J,ne,ue,ge,Se),s.dynCall_viiiiiiiiiii=(g,b,S,R,M,q,J,ne,ue,ge,Se,Le)=>(s.dynCall_viiiiiiiiiii=se.dynCall_viiiiiiiiiii)(g,b,S,R,M,q,J,ne,ue,ge,Se,Le),s.dynCall_viiiiiiiiiiii=(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe)=>(s.dynCall_viiiiiiiiiiii=se.dynCall_viiiiiiiiiiii)(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe),s.dynCall_viiiiiiiiiiiiiiiiii=(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt,gn,dr,eo,oc,Am)=>(s.dynCall_viiiiiiiiiiiiiiiiii=se.dynCall_viiiiiiiiiiiiiiiiii)(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt,gn,dr,eo,oc,Am),s.dynCall_viiiiiiiii=(g,b,S,R,M,q,J,ne,ue,ge)=>(s.dynCall_viiiiiiiii=se.dynCall_viiiiiiiii)(g,b,S,R,M,q,J,ne,ue,ge),s.dynCall_viiiiiiiiiiiiiiiiiii=(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt,gn,dr,eo,oc,Am,Ix)=>(s.dynCall_viiiiiiiiiiiiiiiiiii=se.dynCall_viiiiiiiiiiiiiiiiiii)(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt,gn,dr,eo,oc,Am,Ix),s.dynCall_viiiiiii=(g,b,S,R,M,q,J,ne)=>(s.dynCall_viiiiiii=se.dynCall_viiiiiii)(g,b,S,R,M,q,J,ne),s.dynCall_viiiiiiiiiiiiiii=(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt,gn,dr)=>(s.dynCall_viiiiiiiiiiiiiii=se.dynCall_viiiiiiiiiiiiiii)(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt,gn,dr),s.dynCall_jiji=(g,b,S,R)=>(s.dynCall_jiji=se.dynCall_jiji)(g,b,S,R),s.dynCall_v=g=>(s.dynCall_v=se.dynCall_v)(g),s.dynCall_iidiiii=(g,b,S,R,M,q,J)=>(s.dynCall_iidiiii=se.dynCall_iidiiii)(g,b,S,R,M,q,J),s.dynCall_iiiiiiiii=(g,b,S,R,M,q,J,ne,ue)=>(s.dynCall_iiiiiiiii=se.dynCall_iiiiiiiii)(g,b,S,R,M,q,J,ne,ue),s.dynCall_iiij=(g,b,S,R)=>(s.dynCall_iiij=se.dynCall_iiij)(g,b,S,R),s.dynCall_iiiiiiiiii=(g,b,S,R,M,q,J,ne,ue,ge)=>(s.dynCall_iiiiiiiiii=se.dynCall_iiiiiiiiii)(g,b,S,R,M,q,J,ne,ue,ge),s.dynCall_iiiiiiiiiiiii=(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe)=>(s.dynCall_iiiiiiiiiiiii=se.dynCall_iiiiiiiiiiiii)(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe),s.dynCall_iiiiiiiiiii=(g,b,S,R,M,q,J,ne,ue,ge,Se)=>(s.dynCall_iiiiiiiiiii=se.dynCall_iiiiiiiiiii)(g,b,S,R,M,q,J,ne,ue,ge,Se),s.dynCall_ji=(g,b)=>(s.dynCall_ji=se.dynCall_ji)(g,b),s.dynCall_iijii=(g,b,S,R,M)=>(s.dynCall_iijii=se.dynCall_iijii)(g,b,S,R,M),s.dynCall_vij=(g,b,S)=>(s.dynCall_vij=se.dynCall_vij)(g,b,S),s.dynCall_viiijii=(g,b,S,R,M,q,J)=>(s.dynCall_viiijii=se.dynCall_viiijii)(g,b,S,R,M,q,J),s.dynCall_viijiiiiiiiiiiiiii=(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt,gn,dr,eo,oc)=>(s.dynCall_viijiiiiiiiiiiiiii=se.dynCall_viijiiiiiiiiiiiiii)(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt,gn,dr,eo,oc),s.dynCall_viiiji=(g,b,S,R,M,q)=>(s.dynCall_viiiji=se.dynCall_viiiji)(g,b,S,R,M,q),s.dynCall_fiii=(g,b,S,R)=>(s.dynCall_fiii=se.dynCall_fiii)(g,b,S,R),s.dynCall_viijii=(g,b,S,R,M,q)=>(s.dynCall_viijii=se.dynCall_viijii)(g,b,S,R,M,q),s.dynCall_viij=(g,b,S,R)=>(s.dynCall_viij=se.dynCall_viij)(g,b,S,R),s.dynCall_jiij=(g,b,S,R)=>(s.dynCall_jiij=se.dynCall_jiij)(g,b,S,R),s.dynCall_fi=(g,b)=>(s.dynCall_fi=se.dynCall_fi)(g,b),s.dynCall_fii=(g,b,S)=>(s.dynCall_fii=se.dynCall_fii)(g,b,S),s.dynCall_jii=(g,b,S)=>(s.dynCall_jii=se.dynCall_jii)(g,b,S),s.dynCall_dii=(g,b,S)=>(s.dynCall_dii=se.dynCall_dii)(g,b,S),s.dynCall_fiiii=(g,b,S,R,M)=>(s.dynCall_fiiii=se.dynCall_fiiii)(g,b,S,R,M),s.dynCall_fif=(g,b,S)=>(s.dynCall_fif=se.dynCall_fif)(g,b,S),s.dynCall_jfi=(g,b,S)=>(s.dynCall_jfi=se.dynCall_jfi)(g,b,S),s.dynCall_viiiiiiiiiiiiii=(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt,gn)=>(s.dynCall_viiiiiiiiiiiiii=se.dynCall_viiiiiiiiiiiiii)(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt,gn),s.dynCall_viiiiiiiiiiiiiiiiiiii=(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt,gn,dr,eo,oc,Am,Ix,b6)=>(s.dynCall_viiiiiiiiiiiiiiiiiiii=se.dynCall_viiiiiiiiiiiiiiiiiiii)(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt,gn,dr,eo,oc,Am,Ix,b6),s.dynCall_viiiiiiiiiiiiiiii=(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt,gn,dr,eo)=>(s.dynCall_viiiiiiiiiiiiiiii=se.dynCall_viiiiiiiiiiiiiiii)(g,b,S,R,M,q,J,ne,ue,ge,Se,Le,Xe,mt,gn,dr,eo),s.dynCall_iif=(g,b,S)=>(s.dynCall_iif=se.dynCall_iif)(g,b,S),s.dynCall_jiiii=(g,b,S,R,M)=>(s.dynCall_jiiii=se.dynCall_jiiii)(g,b,S,R,M),s.dynCall_jiii=(g,b,S,R)=>(s.dynCall_jiii=se.dynCall_jiii)(g,b,S,R),s.dynCall_viif=(g,b,S,R)=>(s.dynCall_viif=se.dynCall_viif)(g,b,S,R),s.dynCall_viiij=(g,b,S,R,M)=>(s.dynCall_viiij=se.dynCall_viiij)(g,b,S,R,M),s.dynCall_viiiijii=(g,b,S,R,M,q,J,ne)=>(s.dynCall_viiiijii=se.dynCall_viiiijii)(g,b,S,R,M,q,J,ne),s.dynCall_iiiiij=(g,b,S,R,M,q)=>(s.dynCall_iiiiij=se.dynCall_iiiiij)(g,b,S,R,M,q),s.dynCall_iiiiid=(g,b,S,R,M,q)=>(s.dynCall_iiiiid=se.dynCall_iiiiid)(g,b,S,R,M,q),s.dynCall_iiiiijj=(g,b,S,R,M,q,J)=>(s.dynCall_iiiiijj=se.dynCall_iiiiijj)(g,b,S,R,M,q,J),s.dynCall_iiiiiijj=(g,b,S,R,M,q,J,ne)=>(s.dynCall_iiiiiijj=se.dynCall_iiiiiijj)(g,b,S,R,M,q,J,ne);var _k=g=>(_k=se.wb)(g),vk=()=>(vk=se.xb)(),wk=g=>(wk=se.yb)(g),bk=()=>(bk=se.zb)();return function g(){if(0<Xt)Yn=g;else if(u)i(s),nt();else{for(;0<Ka.length;)Ka.shift()(s);0<Xt?Yn=g:(s.calledRun=!0,H||(nt(),i(s)))}}(),s.PTR_SIZE=4,a},nV=xE,EP=(e=(n=globalThis.self)==null?void 0:n.name)==null?void 0:e.startsWith("em-pthread"),EP&&xE()}),EE,KT,AP,hr,iV,E0,TP,SP,AE,IP,TE,rV,SE,sV,fC=pe(()=>{hC(),EE=typeof location>"u"?void 0:location.origin,KT=import.meta.url>"file:"&&import.meta.url<"file;",AP=()=>{{if(KT){let n=URL;return new URL(new n("ort.bundle.min.mjs",import.meta.url).href,EE).href}return import.meta.url}},hr=AP(),iV=()=>{if(hr&&!hr.startsWith("blob:"))return hr.substring(0,hr.lastIndexOf("/")+1)},E0=(n,e)=>{try{let t=e??hr;return(t?new URL(n,t):new URL(n)).origin===EE}catch{return!1}},TP=(n,e)=>{let t=e??hr;try{return(t?new URL(n,t):new URL(n)).href}catch{return}},SP=(n,e)=>`${e??"./"}${n}`,AE=async n=>{let e=await(await fetch(n,{credentials:"same-origin"})).blob();return URL.createObjectURL(e)},IP=async n=>(await import(n)).default,TE=(zJ(),vy(Zz)).default,rV=async()=>{if(!hr)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(E0(hr))return[void 0,TE()];let n=await AE(hr);return[n,TE(n)]},SE=(VJ(),vy(tV)).default,sV=async(n,e,t,i)=>{let r=SE&&!(n||e);if(r)if(hr)r=E0(hr);else if(i&&!t)r=!0;else throw new Error("cannot determine the script source URL.");if(r)return[void 0,SE];{let s="ort-wasm-simd-threaded.jsep.mjs",a=n??TP(s,e),o=t&&a&&!E0(a,e),l=o?await AE(a):a??SP(s,e);return[o?l:void 0,await IP(l)]}}}),IE,A0,Mm,CE,CP,kP,$P,pC,Ct,hh=pe(()=>{fC(),A0=!1,Mm=!1,CE=!1,CP=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},kP=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},$P=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},pC=async n=>{if(A0)return Promise.resolve();if(Mm)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(CE)throw new Error("previous call to 'initializeWebAssembly()' failed.");Mm=!0;let e=n.initTimeout,t=n.numThreads;if(n.simd!==!1){if(n.simd==="relaxed"){if(!$P())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!kP())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let i=CP();t>1&&!i&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+t+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),n.numThreads=t=1);let r=n.wasmPaths,s=typeof r=="string"?r:void 0,a=r==null?void 0:r.mjs,o=(a==null?void 0:a.href)??a,l=r==null?void 0:r.wasm,u=(l==null?void 0:l.href)??l,c=n.wasmBinary,[h,f]=await sV(o,s,t>1,!!c||!!u),m=!1,y=[];if(e>0&&y.push(new Promise(_=>{setTimeout(()=>{m=!0,_()},e)})),y.push(new Promise((_,x)=>{let v={numThreads:t};if(c)v.wasmBinary=c;else if(u||s)v.locateFile=w=>u??s+w;else if(o&&o.indexOf("blob:")!==0)v.locateFile=w=>new URL(w,o).href;else if(h){let w=iV();w&&(v.locateFile=E=>w+E)}f(v).then(w=>{Mm=!1,A0=!0,IE=w,_(),h&&URL.revokeObjectURL(h)},w=>{Mm=!1,CE=!0,x(w)})})),await Promise.race(y),m)throw new Error(`WebAssembly backend initializing failed due to timeout: ${e}ms`)},Ct=()=>{if(A0&&IE)return IE;throw new Error("WebAssembly is not initialized yet.")}}),zs,Pb,bt,mC=pe(()=>{hh(),zs=(n,e)=>{let t=Ct(),i=t.lengthBytesUTF8(n)+1,r=t._malloc(i);return t.stringToUTF8(n,r,i),e.push(r),r},Pb=(n,e,t,i)=>{if(typeof n=="object"&&n!==null){if(t.has(n))throw new Error("Circular reference in options");t.add(n)}Object.entries(n).forEach(([r,s])=>{let a=e?e+r:r;if(typeof s=="object")Pb(s,a+".",t,i);else if(typeof s=="string"||typeof s=="number")i(a,s.toString());else if(typeof s=="boolean")i(a,s?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof s}`)})},bt=n=>{let e=Ct(),t=e.stackSave();try{let i=e.PTR_SIZE,r=e.stackAlloc(2*i);e._OrtGetLastError(r,r+i);let s=Number(e.getValue(r,i===4?"i32":"i64")),a=e.getValue(r+i,"*"),o=a?e.UTF8ToString(a):"";throw new Error(`${n} ERROR_CODE: ${s}, ERROR_MESSAGE: ${o}`)}finally{e.stackRestore(t)}}}),aV,jJ=pe(()=>{hh(),mC(),aV=n=>{let e=Ct(),t=0,i=[],r=n||{};try{if((n==null?void 0:n.logSeverityLevel)===void 0)r.logSeverityLevel=2;else if(typeof n.logSeverityLevel!="number"||!Number.isInteger(n.logSeverityLevel)||n.logSeverityLevel<0||n.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${n.logSeverityLevel}`);if((n==null?void 0:n.logVerbosityLevel)===void 0)r.logVerbosityLevel=0;else if(typeof n.logVerbosityLevel!="number"||!Number.isInteger(n.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${n.logVerbosityLevel}`);(n==null?void 0:n.terminate)===void 0&&(r.terminate=!1);let s=0;return(n==null?void 0:n.tag)!==void 0&&(s=zs(n.tag,i)),t=e._OrtCreateRunOptions(r.logSeverityLevel,r.logVerbosityLevel,!!r.terminate,s),t===0&&bt("Can't create run options."),(n==null?void 0:n.extra)!==void 0&&Pb(n.extra,"",new WeakSet,(a,o)=>{let l=zs(a,i),u=zs(o,i);e._OrtAddRunConfigEntry(t,l,u)!==0&&bt(`Can't set a run config entry: ${a} - ${o}.`)}),[t,i]}catch(s){throw t!==0&&e._OrtReleaseRunOptions(t),i.forEach(a=>e._free(a)),s}}}),RP,PP,NP,Om,DP,oV,BJ=pe(()=>{hh(),mC(),RP=n=>{switch(n){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${n}`)}},PP=n=>{switch(n){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${n}`)}},NP=n=>{n.extra||(n.extra={}),n.extra.session||(n.extra.session={});let e=n.extra.session;e.use_ort_model_bytes_directly||(e.use_ort_model_bytes_directly="1"),n.executionProviders&&n.executionProviders.some(t=>(typeof t=="string"?t:t.name)==="webgpu")&&(n.enableMemPattern=!1)},Om=(n,e,t,i)=>{let r=zs(e,i),s=zs(t,i);Ct()._OrtAddSessionConfigEntry(n,r,s)!==0&&bt(`Can't set a session config entry: ${e} - ${t}.`)},DP=async(n,e,t)=>{for(let i of e){let r=typeof i=="string"?i:i.name,s=[];switch(r){case"webnn":if(r="WEBNN",typeof i!="string"){let c=i==null?void 0:i.deviceType;c&&Om(n,"deviceType",c,t)}break;case"webgpu":if(r="JS",typeof i!="string"){let c=i;if(c!=null&&c.preferredLayout){if(c.preferredLayout!=="NCHW"&&c.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${c.preferredLayout}`);Om(n,"preferredLayout",c.preferredLayout,t)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${r}`)}let a=zs(r,t),o=s.length,l=0,u=0;if(o>0){l=Ct()._malloc(o*Ct().PTR_SIZE),t.push(l),u=Ct()._malloc(o*Ct().PTR_SIZE),t.push(u);for(let c=0;c<o;c++)Ct().setValue(l+c*Ct().PTR_SIZE,s[c][0],"*"),Ct().setValue(u+c*Ct().PTR_SIZE,s[c][1],"*")}await Ct()._OrtAppendExecutionProvider(n,a,l,u,o)!==0&&bt(`Can't append execution provider: ${r}.`)}},oV=async n=>{let e=Ct(),t=0,i=[],r=n||{};NP(r);try{let s=RP(r.graphOptimizationLevel??"all"),a=PP(r.executionMode??"sequential"),o=typeof r.logId=="string"?zs(r.logId,i):0,l=r.logSeverityLevel??2;if(!Number.isInteger(l)||l<0||l>4)throw new Error(`log severity level is not valid: ${l}`);let u=r.logVerbosityLevel??0;if(!Number.isInteger(u)||u<0||u>4)throw new Error(`log verbosity level is not valid: ${u}`);let c=typeof r.optimizedModelFilePath=="string"?zs(r.optimizedModelFilePath,i):0;if(t=e._OrtCreateSessionOptions(s,!!r.enableCpuMemArena,!!r.enableMemPattern,a,!!r.enableProfiling,0,o,l,u,c),t===0&&bt("Can't create session options."),r.executionProviders&&await DP(t,r.executionProviders,i),r.enableGraphCapture!==void 0){if(typeof r.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${r.enableGraphCapture}`);Om(t,"enableGraphCapture",r.enableGraphCapture.toString(),i)}if(r.freeDimensionOverrides)for(let[h,f]of Object.entries(r.freeDimensionOverrides)){if(typeof h!="string")throw new Error(`free dimension override name must be a string: ${h}`);if(typeof f!="number"||!Number.isInteger(f)||f<0)throw new Error(`free dimension override value must be a non-negative integer: ${f}`);let m=zs(h,i);e._OrtAddFreeDimensionOverride(t,m,f)!==0&&bt(`Can't set a free dimension override: ${h} - ${f}.`)}return r.extra!==void 0&&Pb(r.extra,"",new WeakSet,(h,f)=>{Om(t,h,f,i)}),[t,i]}catch(s){throw t!==0&&e._OrtReleaseSessionOptions(t)!==0&&bt("Can't release session options."),i.forEach(a=>e._free(a)),s}}}),bc,Mo,xc,nx,Nb,gC,yC,YT,Fe=pe(()=>{bc=n=>{switch(n){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${n}`)}},Mo=n=>{switch(n){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${n}`)}},xc=(n,e)=>{let t=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][n],i=typeof e=="number"?e:e.reduce((r,s)=>r*s,1);return t>0?Math.ceil(i*t):void 0},nx=n=>{switch(n){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${n}`)}},Nb=n=>{switch(n){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${n}`)}},gC=n=>n==="float32"||n==="float16"||n==="int32"||n==="int64"||n==="uint32"||n==="uint8"||n==="bool"||n==="uint4"||n==="int4",yC=n=>n==="float32"||n==="float16"||n==="int32"||n==="int64"||n==="uint32"||n==="uint64"||n==="int8"||n==="uint8"||n==="bool"||n==="uint4"||n==="int4",YT=n=>{switch(n){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${n}`)}}}),_C,lV=pe(()=>{hC(),_C=async n=>{if(typeof n=="string"){let e=await fetch(n);if(!e.ok)throw new Error(`failed to load external data file: ${n}`);let t=e.headers.get("Content-Length"),i=t?parseInt(t,10):0;if(i<1073741824)return new Uint8Array(await e.arrayBuffer());{if(!e.body)throw new Error(`failed to load external data file: ${n}, no response body.`);let r=e.body.getReader(),s;try{s=new ArrayBuffer(i)}catch(o){if(o instanceof RangeError){let l=Math.ceil(i/65536);s=new WebAssembly.Memory({initial:l,maximum:l}).buffer}else throw o}let a=0;for(;;){let{done:o,value:l}=await r.read();if(o)break;let u=l.byteLength;new Uint8Array(s,a,u).set(l),a+=u}return new Uint8Array(s,0,i)}}else return n instanceof Blob?new Uint8Array(await n.arrayBuffer()):n instanceof Uint8Array?n:new Uint8Array(n)}}),MP,OP,LP,FP,vC,zP,at,sl=pe(()=>{Fe(),MP=["V","I","W","E","F"],OP=(n,e)=>{console.log(`[${MP[n]},${new Date().toISOString()}]${e}`)},vC=(n,e)=>{LP=n,FP=e},zP=(n,e)=>{let t=Nb(n),i=Nb(LP);t>=i&&OP(t,typeof e=="function"?e():e)},at=(...n)=>{FP&&zP(...n)}}),VP,Vp,ie,Db,uV,cV,dV,We=pe(()=>{VP=class{static calcMatMulShape(n,e){return n[1]!==e[0]?void 0:[n[0],e[1]]}},Vp=class{static calcShape(n,e,t=!1){let i=n.length,r=e.length;if(i===0)return e;if(r===0)return n;let s=Math.max(n.length,e.length),a=new Array(s);if(t){if(i<2||r<2)return;let o=VP.calcMatMulShape([n[i-2],n[i-1]],[e[r-2],e[r-1]]);if(o===void 0)return;[a[s-2],a[s-1]]=o}for(let o=t?3:1;o<=s;o++){let l=i-o<0?1:n[i-o],u=r-o<0?1:e[r-o];if(l!==u&&l>1&&u>1)return;let c=Math.max(l,u);if(l&&u)a[s-o]=Math.max(l,u);else{if(c>1)return;a[s-o]=0}}return a}static isValidBroadcast(n,e){let t=n.length,i=e.length;if(t>i)return!1;for(let r=1;r<=t;r++)if(n[t-r]!==1&&n[t-r]!==e[i-r])return!1;return!0}},ie=class lw{static size(e){return lw.getSizeFromDimensionRange(e,0,e.length)}static convertShape(e,t=4){let i=e.length;if(i===0)return[];let r=new Array(i),s=i-1;for(;s>=0;){if(e[s]%t===0){r[s]=e[s]/t;break}if(t%e[s]!==0)throw new Error("cannot convert shape");r[s]=1,t/=e[s],s--}for(s--;s>=0;s--)r[s]=e[s];return r}static sizeFromDimension(e,t){if(t<0||t>e.length)throw new Error(`invalid dimension of ${t} for sizeFromDimension as Tensor has ${e.length} dimensions.`);return lw.getSizeFromDimensionRange(e,t,e.length)}static sizeToDimension(e,t){if(t<0||t>e.length)throw new Error(`invalid dimension of ${t} for sizeToDimension as Tensor has ${e.length} dimensions.`);return lw.getSizeFromDimensionRange(e,0,t)}static getSizeFromDimensionRange(e,t,i){let r=1;for(let s=t;s<i;s++){if(e[s]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");r*=Number(e[s])}return r}static computeStrides(e){let t=e.length;if(t===0)return[];if(t===1)return[1];let i=new Array(t);i[t-1]=1,i[t-2]=e[t-1];for(let r=t-3;r>=0;--r)i[r]=i[r+1]*e[r+1];return i}static normalizeAxis(e,t){if(e<-t&&e>=t)throw new Error("unsupported axis for this operation.");return e<0?e+t:e}static normalizeAxes(e,t){return e.map(i=>this.normalizeAxis(i,t??e.length))}static sortBasedOnPerm(e,t){return t?t.map(i=>e[i]):e.slice().reverse()}static padShape(e,t){let i=e.length;return e.map((r,s)=>r+t[s]+t[s+i])}static areEqual(e,t){return e.length!==t.length?!1:e.every((i,r)=>i===t[r])}},Db=class og{static adjustPoolAttributes(e,t,i,r,s,a){if(!e&&i.length!==t.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(e)for(let o=0;o<t.length-2;o++)o>=i.length?i.push(t[o+2]):i[o]=t[o+2];for(let o=0;o<i.length;o++)if(o<r.length){if(r[o]<0)throw new Error("strides should be greater than or equal to 1")}else r.push(1);for(let o=0;o<i.length;o++)if(o<s.length){if(s[o]<0)throw new Error("dilations should be greater than or equal to 1")}else s.push(1);for(let o=0;o<i.length*2;o++)if(o<a.length){if(a[o]<0)throw new Error("pad should be greater than or equal to 1")}else a.push(0);for(let o=0;o<i.length;o++){if(i[o]<=0)throw new Error("kernel shapes need to be greater than 0");if(a[o]>=i[o]||a[o+i.length]>=i[o])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(e,t,i,r,s,a,o){if(o){if(s.length!==2*(e.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(t.length!==e.length-2)throw new Error("length of strides should be the length of data dimensions");if(r.length!==e.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let l=0;l<e.length-2;l++)og.adjustPadAndReturnShape(e[l+(a?1:2)],t[l],i[l],r[l],s,l,l+e.length-2,o)}}static computePoolOutputShape(e,t,i,r,s,a,o){if(t.length<=0)throw new Error("input shape must be of size greater than 0");let l=[t[0],t[1]];return og.computeShapeHelper(e,t,l,i,r,s,a,o),l}static computeConvOutputShape(e,t,i,r,s,a,o){if(e.length<=0||t.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let l=[e[0],t[0]];return og.computeShapeHelper(!1,e,l,i,r,s,a,o),l}static computeShapeHelper(e,t,i,r,s,a,o,l){if(e)for(let u=0;u<t.length-2;u++)i.push(1);else for(let u=0;u<t.length-2;u++)i.push(og.adjustPadAndReturnShape(t[u+2],r[u],s[u],a[u],o,u,u+t.length-2,l))}static adjustPadAndReturnShape(e,t,i,r,s,a,o,l){let u=i*(r-1)+1;if(l&&l!=="NOTSET")switch(l){case"VALID":return s[a]=0,s[o]=0,Math.floor((e-u)/t+1);case"SAME_LOWER":case"SAME_UPPER":if(i!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let c=((e+t-1)/t-1)*t+r-e;return s[a]=Math.floor(l==="SAME_LOWER"?(c+1)/2:c/2),s[o]=c-s[a],Math.floor((e+c-r)/t+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((e+s[a]+s[o]-u)/t+1)}},uV=class{static getShapeOfGemmResult(n,e,t,i,r){if(n.length!==2||t.length!==2)throw new Error("shape need to be of size 2");let s,a,o;e?(s=n[1],a=n[0]):(s=n[0],a=n[1]);let l=-1;if(i?(o=t[0],l=1):(o=t[1],l=0),t[l]!==a)throw new Error("dimension mismatch");if(s<=0||o<=0||a<=0)throw new Error("invalid shape specified");if(r&&!Vp.isValidBroadcast(r,[s,o]))throw new Error("gemm: invalid bias shape for broadcast");return[s,o,a]}},cV=-34028234663852886e22,dV=34028234663852886e22}),wC,hV=pe(()=>{Fe(),wC=(n,e)=>new(nx(e))(n)}),kE,XT,$E,jP,RE,BP,PE,NE,DE,UP,fV,UJ=pe(()=>{Fe(),sl(),kE=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),XT=(n,e)=>{if(e==="int32")return n;let t=kE.get(e);if(!t)throw new Error(`WebNN backend does not support data type: ${e}`);let i=t/8;if(n.byteLength%i!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${i}.`);let r=n.byteLength/i,s=new(nx(e))(n.buffer,n.byteOffset,r);switch(e){case"int64":case"uint64":{let a=new Int32Array(r);for(let o=0;o<r;o++){let l=s[o];if(l>2147483647n||l<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");a[o]=Number(l)}return new Uint8Array(a.buffer)}case"int8":case"uint8":case"uint32":{if(e==="uint32"&&s.some(o=>o>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let a=Int32Array.from(s,Number);return new Uint8Array(a.buffer)}default:throw new Error(`Unsupported data conversion from ${e} to 'int32'`)}},$E=(n,e)=>{if(e==="int32")return n;if(n.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let t=n.byteLength/4,i=new Int32Array(n.buffer,n.byteOffset,t);switch(e){case"int64":{let r=BigInt64Array.from(i,BigInt);return new Uint8Array(r.buffer)}case"uint64":{if(i.some(s=>s<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let r=BigUint64Array.from(i,BigInt);return new Uint8Array(r.buffer)}case"int8":{if(i.some(s=>s<-128||s>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let r=Int8Array.from(i,Number);return new Uint8Array(r.buffer)}case"uint8":{if(i.some(r=>r<0||r>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(i,Number)}case"uint32":{if(i.some(s=>s<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let r=Uint32Array.from(i,Number);return new Uint8Array(r.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${e}`)}},jP=1,RE=()=>jP++,BP=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),PE=(n,e)=>{let t=kE.get(n);if(!t)throw new Error(`WebNN backend does not support data type: ${n}`);return e.length>0?Math.ceil(e.reduce((i,r)=>i*r)*t/8):0},NE=class{constructor(n){this.isDataConverted=!1;let{sessionId:e,context:t,tensor:i,dataType:r,shape:s,fallbackDataType:a}=n;this.sessionId=e,this.mlContext=t,this.mlTensor=i,this.dataType=r,this.tensorShape=s,this.fallbackDataType=a}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return PE(this.dataType,this.tensorShape)}destroy(){at("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(n){this.mlContext.writeTensor(this.mlTensor,n)}async read(n){if(this.fallbackDataType){let e=await this.mlContext.readTensor(this.mlTensor),t=$E(new Uint8Array(e),this.dataType);if(n){(n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)).set(t);return}else return t.buffer}else return n?this.mlContext.readTensor(this.mlTensor,n):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(n,e,t){return this.mlContext===n&&this.dataType===e&&this.tensorShape.length===t.length&&this.tensorShape.every((i,r)=>i===t[r])}setIsDataConverted(n){this.isDataConverted=n}},DE=class{constructor(n,e){this.tensorManager=n,this.wrapper=e}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(n,e,t,i){let r=this.tensorManager.getMLContext(n),s;if(!r.opSupportLimits().input.dataTypes.includes(e)){if(s=BP.get(e),!s||!r.opSupportLimits().input.dataTypes.includes(s))throw new Error(`WebNN backend does not support data type: ${e}`);at("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${e} to ${s}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(r,e,t))return this.wrapper.tensor;if(i){if(this.wrapper.byteLength!==PE(e,t))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let a=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(n,e,t,a,!0,!0,s),i&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(n){let e=n;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")e=XT(n,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(n.byteLength===this.wrapper.byteLength){this.wrapper.write(e);return}else at("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(e):this.activeUpload=new Uint8Array(e)}async download(n){var e,t;if(this.activeUpload){let i=(e=this.wrapper)!=null&&e.isDataConverted?$E(this.activeUpload,(t=this.wrapper)==null?void 0:t.type):this.activeUpload;if(n){n instanceof ArrayBuffer?new Uint8Array(n).set(i):new Uint8Array(n.buffer,n.byteOffset,n.byteLength).set(i);return}else return i.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return n?this.wrapper.read(n):this.wrapper.read()}},UP=class{constructor(n){this.backend=n,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(n){let e=this.backend.getMLContext(n);if(!e)throw new Error("MLContext not found for session.");return e}reserveTensorId(){let n=RE();return this.tensorTrackersById.set(n,new DE(this)),n}releaseTensorId(n){let e=this.tensorTrackersById.get(n);e&&(this.tensorTrackersById.delete(n),e.tensorWrapper&&this.releaseTensor(e.tensorWrapper))}async ensureTensor(n,e,t,i,r){at("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${e}, dataType: ${t}, shape: ${i}, copyOld: ${r}}`);let s=this.tensorTrackersById.get(e);if(!s)throw new Error("Tensor not found.");return s.ensureTensor(n,t,i,r)}upload(n,e){let t=this.tensorTrackersById.get(n);if(!t)throw new Error("Tensor not found.");t.upload(e)}async download(n,e){at("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${n}, dstBuffer: ${e==null?void 0:e.byteLength}}`);let t=this.tensorTrackersById.get(n);if(!t)throw new Error("Tensor not found.");return t.download(e)}releaseTensorsForSession(n){for(let e of this.freeTensors)e.sessionId===n&&e.destroy();this.freeTensors=this.freeTensors.filter(e=>e.sessionId!==n)}registerTensor(n,e,t,i){let r=this.getMLContext(n),s=RE(),a=new NE({sessionId:n,context:r,tensor:e,dataType:t,shape:i});return this.tensorTrackersById.set(s,new DE(this,a)),this.externalTensors.add(a),s}async getCachedTensor(n,e,t,i,r,s,a){let o=this.getMLContext(n);for(let[u,c]of this.freeTensors.entries())if(c.canReuseTensor(o,e,t)){at("verbose",()=>`[WebNN] Reusing tensor {dataType: ${e}, ${a?`fallbackDataType: ${a},`:""} shape: ${t}`);let h=this.freeTensors.splice(u,1)[0];return h.sessionId=n,h}at("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${e}, ${a?`fallbackDataType: ${a},`:""} shape: ${t}}`);let l=await o.createTensor({dataType:a??e,shape:t,dimensions:t,usage:i,writable:r,readable:s});return new NE({sessionId:n,context:o,tensor:l,dataType:e,shape:t,fallbackDataType:a})}releaseTensor(n){this.externalTensors.has(n)&&this.externalTensors.delete(n),this.freeTensors.push(n)}},fV=(...n)=>new UP(...n)}),Lm,HP,pV,HJ=pe(()=>{Fe(),hh(),hV(),UJ(),sl(),Lm=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),HP=(n,e)=>{if(n===e)return!0;if(n===void 0||e===void 0)return!1;let t=Object.keys(n).sort(),i=Object.keys(e).sort();return t.length===i.length&&t.every((r,s)=>r===i[s]&&n[r]===e[r])},pV=class{constructor(n){this.tensorManager=fV(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,vC(n.logLevel,!!n.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(n){at("verbose",()=>`[WebNN] onRunStart {sessionId: ${n}}`),this.activeSessionId=n}onRunEnd(n){at("verbose",()=>`[WebNN] onRunEnd {sessionId: ${n}}`);let e=this.temporarySessionTensorIds.get(n);if(e){for(let t of e)at("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${t}}`),this.tensorManager.releaseTensorId(t);this.temporarySessionTensorIds.delete(n),this.activeSessionId=void 0}}async createMLContext(n){if(n instanceof GPUDevice){let t=this.mlContextCache.findIndex(i=>i.gpuDevice===n);if(t!==-1)return this.mlContextCache[t].mlContext;{let i=await navigator.ml.createContext(n);return this.mlContextCache.push({gpuDevice:n,mlContext:i}),i}}else if(n===void 0){let t=this.mlContextCache.findIndex(i=>i.options===void 0&&i.gpuDevice===void 0);if(t!==-1)return this.mlContextCache[t].mlContext;{let i=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:i}),i}}let e=this.mlContextCache.findIndex(t=>HP(t.options,n));if(e!==-1)return this.mlContextCache[e].mlContext;{let t=await navigator.ml.createContext(n);return this.mlContextCache.push({options:n,mlContext:t}),t}}registerMLContext(n,e){this.mlContextBySessionId.set(n,e);let t=this.sessionIdsByMLContext.get(e);t||(t=new Set,this.sessionIdsByMLContext.set(e,t)),t.add(n),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(n,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(n,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(n){this.sessionGraphInputs.delete(n),this.sessionGraphOutputs.delete(n);let e=this.mlContextBySessionId.get(n);if(!e)return;this.tensorManager.releaseTensorsForSession(n),this.mlContextBySessionId.delete(n);let t=this.sessionIdsByMLContext.get(e);if(t.delete(n),t.size===0){this.sessionIdsByMLContext.delete(e);let i=this.mlContextCache.findIndex(r=>r.mlContext===e);i!==-1&&this.mlContextCache.splice(i,1)}}getMLContext(n){return this.mlContextBySessionId.get(n)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(n){at("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${n}}`),this.tensorManager.releaseTensorId(n)}async ensureTensor(n,e,t,i,r){let s=Lm.get(t);if(!s)throw new Error(`Unsupported ONNX data type: ${t}`);return this.tensorManager.ensureTensor(n??this.currentSessionId,e,s,i,r)}async createTemporaryTensor(n,e,t){at("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${e}, shape: ${t}}`);let i=Lm.get(e);if(!i)throw new Error(`Unsupported ONNX data type: ${e}`);let r=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(n,r,i,t,!1);let s=this.temporarySessionTensorIds.get(n);return s?s.push(r):this.temporarySessionTensorIds.set(n,[r]),r}uploadTensor(n,e){if(!Ct().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");at("verbose",()=>`[WebNN] uploadTensor {tensorId: ${n}, data: ${e.byteLength}}`),this.tensorManager.upload(n,e)}async downloadTensor(n,e){return this.tensorManager.download(n,e)}createMLTensorDownloader(n,e){return async()=>{let t=await this.tensorManager.download(n);return wC(t,e)}}registerMLTensor(n,e,t,i){let r=Lm.get(t);if(!r)throw new Error(`Unsupported ONNX data type: ${t}`);let s=this.tensorManager.registerTensor(n,e,r,i);return at("verbose",()=>`[WebNN] registerMLTensor {tensor: ${e}, dataType: ${r}, dimensions: ${i}} -> {tensorId: ${s}}`),s}registerMLConstant(n,e,t,i,r,s,a=!1){if(!s)throw new Error("External mounted files are not available.");let o=n;n.startsWith("./")&&(o=n.substring(2));let l=s.get(o);if(!l)throw new Error(`File with name ${o} not found in preloaded files.`);if(e+t>l.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let u=l.slice(e,e+t).buffer,c;switch(r.dataType){case"float32":c=new Float32Array(u);break;case"float16":c=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(u):new Uint16Array(u);break;case"int32":c=new Int32Array(u);break;case"uint32":c=new Uint32Array(u);break;case"int64":if(a){let h=XT(new Uint8Array(u),"int64");c=new Int32Array(h.buffer),r.dataType="int32"}else c=new BigInt64Array(u);break;case"uint64":c=new BigUint64Array(u);break;case"int8":c=new Int8Array(u);break;case"int4":case"uint4":case"uint8":c=new Uint8Array(u);break;default:throw new Error(`Unsupported data type: ${r.dataType} in creating WebNN Constant from external data.`)}return at("verbose",()=>`[WebNN] registerMLConstant {dataType: ${r.dataType}, shape: ${r.shape}}} ${a?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),i.constant(r,c)}registerGraphInput(n){this.temporaryGraphInputs.push(n)}registerGraphOutput(n){this.temporaryGraphOutputs.push(n)}isGraphInput(n,e){let t=this.sessionGraphInputs.get(n);return t?t.includes(e):!1}isGraphOutput(n,e){let t=this.sessionGraphOutputs.get(n);return t?t.includes(e):!1}isGraphInputOutputTypeSupported(n,e,t=!0){let i=this.mlContextBySessionId.get(n),r=Lm.get(bc(e));return typeof r>"u"?!1:t?!!(i!=null&&i.opSupportLimits().input.dataTypes.includes(r)):!!(i!=null&&i.opSupportLimits().output.dataTypes.includes(r))}flush(){}}}),bC=pe(()=>{}),ME,T0,S0,WP,qP,OE,QT,GP,mV,WJ=pe(()=>{sl(),bC(),ME=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),T0=[],S0=n=>Math.ceil(Number(n)/16)*16,WP=n=>{for(let e=0;e<T0.length;e++){let t=T0[e];if(n<=t)return t}return Math.ceil(n/16)*16},qP=1,OE=()=>qP++,QT=async(n,e,t,i)=>{let r=S0(t),s=n.device.createBuffer({size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let a=n.getCommandEncoder();n.endComputePass(),a.copyBufferToBuffer(e,0,s,0,r),n.flush(),await s.mapAsync(GPUMapMode.READ);let o=s.getMappedRange();if(i){let l=i();return l.set(new Uint8Array(o,0,t)),l}else return new Uint8Array(o.slice(0,t))}finally{s.destroy()}},GP=class{constructor(n){this.backend=n,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[e]of ME)T0.push(e),this.freeBuffers.set(e,[]),this.freeUniformBuffers.set(e,[]);this.sessionCount=0}upload(n,e){let t=e.buffer,i=e.byteOffset,r=e.byteLength,s=S0(r),a=this.storageCache.get(n);if(!a)throw new Error("gpu data for uploading does not exist");if(Number(a.originalSize)!==r)throw new Error(`inconsistent data size. gpu data size=${a.originalSize}, data size=${r}`);let o=this.backend.device.createBuffer({mappedAtCreation:!0,size:s,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),l=o.getMappedRange();new Uint8Array(l).set(new Uint8Array(t,i,r)),o.unmap();let u=this.backend.device.createCommandEncoder();u.copyBufferToBuffer(o,0,a.gpuData.buffer,0,s),this.backend.device.queue.submit([u.finish()]),o.destroy(),at("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${n})`)}memcpy(n,e){let t=this.storageCache.get(n);if(!t)throw new Error("source gpu data for memcpy does not exist");let i=this.storageCache.get(e);if(!i)throw new Error("destination gpu data for memcpy does not exist");if(t.originalSize!==i.originalSize)throw new Error("inconsistent source and destination gpu data size");let r=S0(t.originalSize),s=this.backend.getCommandEncoder();this.backend.endComputePass(),s.copyBufferToBuffer(t.gpuData.buffer,0,i.gpuData.buffer,0,r)}registerExternalBuffer(n,e,t){let i;if(t){if(i=t[0],n===t[1])return at("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${e}) => id=${i}, buffer is the same, skip.`),i;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else i=OE();return this.storageCache.set(i,{gpuData:{id:i,type:0,buffer:n},originalSize:e}),at("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${e}) => id=${i}, registered.`),i}unregisterExternalBuffer(n){n!==void 0&&(this.storageCache.delete(n),at("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${n}`))}create(n,e=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let t=WP(n),i,r=(e&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,s=(e&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(r||s){let o=(r?this.freeBuffers:this.freeUniformBuffers).get(t);o?o.length>0?i=o.pop():i=this.backend.device.createBuffer({size:t,usage:e}):i=this.backend.device.createBuffer({size:t,usage:e})}else i=this.backend.device.createBuffer({size:t,usage:e});let a={id:OE(),type:0,buffer:i};return this.storageCache.set(a.id,{gpuData:a,originalSize:Number(n)}),at("verbose",()=>`[WebGPU] GpuDataManager.create(size=${n}) => id=${a.id}`),a}get(n){var e;return(e=this.storageCache.get(n))==null?void 0:e.gpuData}release(n){let e=typeof n=="bigint"?Number(n):n,t=this.storageCache.get(e);if(!t){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return at("verbose",()=>`[WebGPU] GpuDataManager.release(id=${e}), gpuDataId=${t.gpuData.id}`),this.storageCache.delete(e),this.buffersPending.push(t.gpuData.buffer),t.originalSize}async download(n,e){let t=this.storageCache.get(Number(n));if(!t)throw new Error("data does not exist");await QT(this.backend,t.gpuData.buffer,t.originalSize,e)}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let n of this.buffersPending){let e=ME.get(n.size);if((n.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let t=this.freeBuffers.get(n.size)||[];e===void 0||t.length>=e?n.destroy():t.push(n)}else if((n.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let t=this.freeUniformBuffers.get(n.size)||[];e===void 0||t.length>=e?n.destroy():t.push(n)}else n.destroy()}this.buffersPending=[]}else{let n=this.capturedPendingBuffers.get(this.backend.currentSessionId);n||(n=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,n));for(let e of this.buffersPending)n.push(e);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(n=>{n.forEach(e=>{e.destroy()})}),this.freeUniformBuffers.forEach(n=>{n.forEach(e=>{e.destroy()})}),this.storageCache.forEach(n=>{n.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(n=>{n.forEach(e=>{e.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(n){let e=this.capturedPendingBuffers.get(n);e&&(e.forEach(t=>{t.destroy()}),this.capturedPendingBuffers.delete(n)),this.sessionCount-=1,this.sessionCount===0&&(at("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(t=>{t.gpuData.buffer.destroy()}),this.storageCache=new Map)}},mV=(...n)=>new GP(...n)}),KP,_t,sn=pe(()=>{KP=class{constructor(n){Object.assign(this,n)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(n=>`${this[n]}`).join(";")),this.key}},_t=n=>new KP(n)}),jp,I0,Pn,yi,Ne,Yt,JT,sf,Pu,Pe,Fm,ae,Ie,gV,xC,YP,yV,qe=pe(()=>{Fe(),We(),jp=64,I0=(n,e)=>{if(e===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(n)){case 10:return e>1?`vec${e}<f16>`:"f16";case 1:return e>1?`vec${e}<f32>`:"f32";case 6:return e>1?`vec${e}<i32>`:"i32";case 12:return e>1?`vec${e}<u32>`:"u32";case 7:if(e>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(e>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(e!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${n}`)}},Pn=(n,e=1)=>{let t=I0(n,e);return typeof t=="string"?t:t[0]},yi=(n,e=1)=>{let t=I0(n,e);return typeof t=="string"?t:t[1]},Ne=(...n)=>{let e=[];return n.forEach(t=>{t.length!==0&&e.push({type:12,data:t},{type:12,data:ie.computeStrides(t)})}),e},Yt=n=>n%4===0?4:n%2===0?2:1,JT=(n="f32",e,t="0")=>!e||e===1?`${n}(${t})`:`vec${e}<${n}>(${t})`,sf=(n,e,t)=>n==="f32"?t:e===1?`f32(${t})`:`vec${e}<f32>(${t})`,Pu=(n,e)=>e===4?`(${n}.x + ${n}.y + ${n}.z + ${n}.w)`:e===2?`(${n}.x + ${n}.y)`:e===3?`(${n}.x + ${n}.y + ${n}.z)`:n,Pe=(n,e,t,i)=>n.startsWith("uniforms.")&&t>4?typeof e=="string"?i==="f16"?`${n}[(${e}) / 8][(${e}) % 8 / 4][(${e}) % 8 % 4]`:`${n}[(${e}) / 4][(${e}) % 4]`:i==="f16"?`${n}[${Math.floor(e/8)}][${Math.floor(e%8/4)}][${e%8%4}]`:`${n}[${Math.floor(e/4)}][${e%4}]`:t>1?`${n}[${e}]`:n,Fm=(n,e,t,i,r)=>{let s=typeof t=="number",a=s?t:t.length,o=[...new Array(a).keys()],l=a<2?"u32":a<=4?`vec${a}<u32>`:`array<u32, ${a}>`,u=I0(e,r),c=typeof u=="string"?u:u[1],h=typeof u=="string"?u:u[0],f={indices:l,value:c,storage:h,tensor:e},m=H=>typeof H=="string"?H:`${H}u`,y={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},_=s?"uniforms.":"",x=`${_}${n}_shape`,v=`${_}${n}_strides`,w="";for(let H=0;H<a-1;H++)w+=`
    let dim${H} = current / ${Pe(v,H,a)};
    let rest${H} = current % ${Pe(v,H,a)};
    indices[${H}] = dim${H};
    current = rest${H};
    `;w+=`indices[${a-1}] = current;`;let E=a<2?"":`
  fn o2i_${n}(offset: u32) -> ${f.indices} {
    var indices: ${f.indices};
    var current = offset;
    ${w}
    return indices;
  }`,k=H=>(y.offsetToIndices=!0,a<2?H:`o2i_${n}(${H})`),$=[];if(a>=2)for(let H=a-1;H>=0;H--)$.push(`${Pe(v,H,a)} * (indices[${H}])`);let L=a<2?"":`
  fn i2o_${n}(indices: ${f.indices}) -> u32 {
    return ${$.join("+")};
  }`,I=H=>(y.indicesToOffset=!0,a<2?H:`i2o_${n}(${H})`),C=(...H)=>a===0?"0u":`${f.indices}(${H.map(m).join(",")})`,N=(H,Q)=>a<2?`${H}`:`${Pe(H,Q,a)}`,O=(H,Q,Y)=>a<2?`${H}=${Y};`:`${Pe(H,Q,a)}=${Y};`,V={},U=(H,Q)=>{y.broadcastedIndicesToOffset=!0;let Y=`${Q.name}broadcastedIndicesTo${n}Offset`;if(Y in V)return`${Y}(${H})`;let Z=[];for(let fe=a-1;fe>=0;fe--){let _e=Q.indicesGet("outputIndices",fe+Q.rank-a);Z.push(`${N(v,fe)} * (${_e} % ${N(x,fe)})`)}return V[Y]=`fn ${Y}(outputIndices: ${Q.type.indices}) -> u32 {
             return ${Z.length>0?Z.join("+"):"0u"};
           }`,`${Y}(${H})`},j=(H,Q)=>(()=>{if(f.storage===f.value)return`${n}[${H}]=${Q};`;if(f.storage==="vec2<u32>"&&f.value==="i32")return`${n}[${H}]=vec2<u32>(u32(${Q}), select(0u, 0xFFFFFFFFu, ${Q} < 0));`;if(f.storage==="vec2<u32>"&&f.value==="u32")return`${n}[${H}]=vec2<u32>(u32(${Q}), 0u);`;if(f.storage==="u32"&&f.value==="vec4<bool>")return`${n}[${H}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${Q}));`;throw new Error(`not supported combination of storage type ${f.storage} and value type ${f.value} yet`)})(),he=H=>(()=>{if(f.storage===f.value)return`${n}[${H}]`;if(f.storage==="vec2<u32>"&&f.value==="i32")return`i32(${n}[${H}].x)`;if(f.storage==="vec2<u32>"&&f.value==="u32")return`u32(${n}[${H}].x)`;if(f.storage==="u32"&&f.value==="vec4<bool>")return`vec4<bool>(bool(${n}[${H}] & 0xFFu), bool(${n}[${H}] & 0xFF00u), bool(${n}[${H}] & 0xFF0000u), bool(${n}[${H}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${f.storage} and value type ${f.value} yet`)})(),me=a<2?"":`
  fn get_${n}ByIndices(indices: ${f.indices}) -> ${c} {
    return ${he(`i2o_${n}(indices)`)};
  }`,te=a<2?"":(()=>{let H=o.map(Y=>`d${Y}: u32`).join(", "),Q=o.map(Y=>`d${Y}`).join(", ");return`
  fn get_${n}(${H}) -> ${c} {
    return get_${n}ByIndices(${C(Q)});
  }`})(),oe=(...H)=>{if(H.length!==a)throw new Error(`indices length must be ${a}`);let Q=H.map(m).join(",");return a===0?he("0u"):a===1?he(Q[0]):(y.get=!0,y.getByIndices=!0,y.indicesToOffset=!0,`get_${n}(${Q})`)},G=H=>a<2?he(H):(y.getByIndices=!0,y.indicesToOffset=!0,`get_${n}ByIndices(${H})`),W=a<2?"":`
  fn set_${n}ByIndices(indices: ${f.indices}, value: ${c}) {
    ${j(`i2o_${n}(indices)`,"value")}
  }`,K=a<2?"":(()=>{let H=o.map(Y=>`d${Y}: u32`).join(", "),Q=o.map(Y=>`d${Y}`).join(", ");return`
  fn set_${n}(${H}, value: ${c}) {
    set_${n}ByIndices(${C(Q)}, value);
  }`})();return{impl:()=>{let H=[],Q=!1;return y.offsetToIndices&&(H.push(E),Q=!0),y.indicesToOffset&&(H.push(L),Q=!0),y.broadcastedIndicesToOffset&&(Object.values(V).forEach(Y=>H.push(Y)),Q=!0),y.set&&(H.push(K),Q=!0),y.setByIndices&&(H.push(W),Q=!0),y.get&&(H.push(te),Q=!0),y.getByIndices&&(H.push(me),Q=!0),!s&&Q&&H.unshift(`const ${x} = ${f.indices}(${t.join(",")});`,`const ${v} = ${f.indices}(${ie.computeStrides(t).join(",")});`),H.join(`
`)},type:f,offsetToIndices:k,indicesToOffset:I,broadcastedIndicesToOffset:U,indices:C,indicesGet:N,indicesSet:O,set:(...H)=>{if(H.length!==a+1)throw new Error(`indices length must be ${a}`);let Q=H[a];if(typeof Q!="string")throw new Error("value must be string");let Y=H.slice(0,a).map(m).join(",");return a===0?j("0u",Q):a===1?j(Y[0],Q):(y.set=!0,y.setByIndices=!0,y.indicesToOffset=!0,`set_${n}(${Y}, ${Q})`)},setByOffset:j,setByIndices:(H,Q)=>a<2?j(H,Q):(y.setByIndices=!0,y.indicesToOffset=!0,`set_${n}ByIndices(${H}, ${Q});`),get:oe,getByOffset:he,getByIndices:G,usage:i,name:n,strides:v,shape:x,rank:a}},ae=(n,e,t,i=1)=>Fm(n,e,t,"input",i),Ie=(n,e,t,i=1)=>Fm(n,e,t,"output",i),gV=(n,e,t)=>Fm(n,e,t,"atomicOutput",1),xC=(n,e,t,i=1)=>Fm(n,e,t,"internal",i),YP=class{constructor(n,e){this.normalizedDispatchGroup=n,this.limits=e,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(n){return`if (global_idx >= ${typeof n=="number"?`${n}u`:n}) { return; }`}mainStart(n=jp){let e=typeof n=="number"?n:n[0],t=typeof n=="number"?1:n[1],i=typeof n=="number"?1:n[2];if(e>this.limits.maxComputeWorkgroupSizeX||t>this.limits.maxComputeWorkgroupSizeY||i>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${e}, ${t}, ${i}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(e*t*i>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${e}, ${t}, ${i}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let r=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,s=r?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,a=r?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${e*t*i}u + local_idx;`;return`@compute @workgroup_size(${e}, ${t}, ${i})
  fn main(${s}) {
    ${a}
  `}appendVariableUniforms(n){n.rank!==0&&(n.shape.startsWith("uniforms.")&&this.uniforms.push({name:n.shape.replace("uniforms.",""),type:"u32",length:n.rank}),n.strides.startsWith("uniforms.")&&this.uniforms.push({name:n.strides.replace("uniforms.",""),type:"u32",length:n.rank}))}declareVariable(n,e){if(n.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(n),this.appendVariableUniforms(n);let t=n.usage==="input"?"read":"read_write",i=n.usage==="atomicOutput"?"atomic<i32>":n.type.storage;return`@group(0) @binding(${e}) var<storage, ${t}> ${n.name}: array<${i}>;`}declareVariables(...n){return n.map(e=>this.declareVariable(e,this.variableIndex++)).join(`
`)}registerInternalVariable(n){if(n.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(n),this.appendVariableUniforms(n)}registerInternalVariables(...n){return n.forEach(e=>this.registerInternalVariable(e)),this}registerUniform(n,e,t=1){return this.uniforms.push({name:n,type:e,length:t}),this}registerUniforms(n){return this.uniforms=this.uniforms.concat(n),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let n=[];for(let{name:e,type:t,length:i}of this.uniforms)if(i&&i>4)t==="f16"?n.push(`@align(16) ${e}:array<mat2x4<${t}>, ${Math.ceil(i/8)}>`):n.push(`${e}:array<vec4<${t}>, ${Math.ceil(i/4)}>`);else{let r=i==null||i===1?t:`vec${i}<${t}>`;n.push(`${e}:${r}`)}return`
      struct Uniforms { ${n.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(n=>n.impl()).join(`
`)+this.internalVariables.map(n=>n.impl()).join(`
`)}get variablesInfo(){if(this.uniforms.length===0)return;let n=e=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(e)];return this.uniforms.map(e=>[n(e.type),e.length??1])}},yV=(n,e)=>new YP(n,e)}),XP,LE,QP,JP,ZP,eN,Mr,_V,vV,Hu=pe(()=>{Fe(),We(),sn(),qe(),XP=(n,e)=>{if(!n||n.length!==1)throw new Error("Transpose requires 1 input.");if(e.length!==0&&e.length!==n[0].dims.length)throw new Error(`perm size ${e.length} does not match input rank ${n[0].dims.length}`)},LE=(n,e)=>e.length!==0?e:[...new Array(n).keys()].reverse(),QP=(n,e)=>ie.sortBasedOnPerm(n,LE(n.length,e)),JP=(n,e,t,i)=>{let r=`fn perm(i: ${i.type.indices}) -> ${t.type.indices} {
    var a: ${t.type.indices};`;for(let s=0;s<e;++s)r+=`a[${n[s]}]=i[${s}];`;return r+="return a;}"},ZP=(n,e)=>{let t=[],i=[];for(let r=0;r<n.length;++r)n[r]!==1&&t.push(n[r]),n[e[r]]!==1&&i.push(e[r]);return{newShape:t,newPerm:i}},eN=(n,e)=>{let t=0;for(let i=0;i<n.length;++i)if(e[n[i]]!==1){if(n[i]<t)return!1;t=n[i]}return!0},Mr=(n,e)=>{let t=n.dataType,i=n.dims.length,r=LE(i,e),s=QP(n.dims,r),a=n.dims,o=s,l=i<2||eN(r,n.dims),u;if(l)return u=y=>{let _=ae("input",t,a,4),x=Ie("output",t,o,4);return`
  ${y.registerUniform("output_size","u32").declareVariables(_,x)}
  ${y.mainStart()}
    ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let y=ie.size(s);return{outputs:[{dims:s,dataType:n.dataType}],dispatchGroup:{x:Math.ceil(y/64/4)},programUniforms:[{type:12,data:Math.ceil(y/4)}]}},getShaderSource:u};let{newShape:c,newPerm:h}=ZP(n.dims,r),f=ie.areEqual(h,[2,3,1]),m=ie.areEqual(h,[3,1,2]);if(c.length===2||f||m){a=f?[c[0],c[1]*c[2]]:m?[c[0]*c[1],c[2]]:c,o=[a[1],a[0]];let y=16;return u=_=>{let x=ae("a",t,a.length),v=Ie("output",t,o.length);return`
  ${_.registerUniform("output_size","u32").declareVariables(x,v)}
  var<workgroup> tile : array<array<${v.type.value}, ${y+1}>, ${y}>;
  ${_.mainStart([y,y,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${y} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${y}u + local_id.x;
    let input_row = workgroup_id_x * ${y}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${x.getByIndices(`${x.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${y}u + local_id.x;
    let output_row = workgroup_id_y * ${y}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${v.setByIndices(`${v.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let _=ie.size(s);return{outputs:[{dims:s,dataType:n.dataType}],dispatchGroup:{x:Math.ceil(o[1]/y),y:Math.ceil(o[0]/y)},programUniforms:[{type:12,data:_},...Ne(a,o)]}},getShaderSource:u}}return u=y=>{let _=ae("a",t,a.length),x=Ie("output",t,o.length);return`
  ${y.registerUniform("output_size","u32").declareVariables(_,x)}

  ${JP(r,i,_,x)}

  ${y.mainStart()}
    ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${x.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${x.setByOffset("global_idx",_.getByIndices("aIndices"))}
  }`},{name:"Transpose",shaderCache:{hint:`${e}`,inputDependencies:["rank"]},getRunData:()=>{let y=ie.size(s);return{outputs:[{dims:s,dataType:n.dataType}],dispatchGroup:{x:Math.ceil(y/64)},programUniforms:[{type:12,data:y},...Ne(a,o)]}},getShaderSource:u}},_V=(n,e)=>{XP(n.inputs,e.perm),n.compute(Mr(n.inputs[0],e.perm))},vV=n=>_t({perm:n.perm})}),tN,nN,iN,rN,sN,aN,oN,lN,uN,cN,gs,wV,bV,xV,EV,AV,TV,SV,IV,CV,kV,qJ=pe(()=>{Fe(),We(),qe(),EC(),Hu(),tN={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},nN={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},iN={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},rN={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},sN=(n,e)=>{let t=[];for(let i=e-n;i<e;++i)t.push(i);return t},aN=(n,e)=>{let t=[],i=n.length;for(let s=0;s<i;s++)e.indexOf(s)===-1&&t.push(n[s]);let r=e.map(s=>n[s]);return[t,r]},oN=(n,e)=>{let t=n.length+e.length,i=[],r=0;for(let s=0;s<t;s++)e.indexOf(s)===-1?i.push(n[r++]):i.push(1);return i},lN=(n,e)=>{for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0},uN=(n,e)=>{let t=[];if(!lN(n,e)){for(let i=0;i<e;++i)n.indexOf(i)===-1&&t.push(i);n.forEach(i=>t.push(i))}return t},cN=(n,e,t,i,r,s,a)=>{let o=t[0].dims,l=ie.size(s),u=ie.size(a),c=ae("_A",t[0].dataType,o),h=Ie("output",r,s),f=64;l===1&&(f=256);let m=`
          var<workgroup> aBestValues : array<f32, ${f}>;
       `,y=_=>`
        ${_.registerUniform("reduceSize","u32").declareVariables(c,h)}
        ${m}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${_.mainStart(f)}

          let outputIndex = global_idx / ${f};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${iN[i]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${f}) {
           let candidate = f32(${c.getByOffset("offset + k")});
           bestValue = ${tN[i]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${f}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${nN[i]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${h.setByOffset("outputIndex",`${i==="mean"?`${h.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${h.type.storage}(${rN[i]})`}`)};
         }
        }`;return{name:n,shaderCache:{hint:`${e};${f}`,inputDependencies:["type"]},getShaderSource:y,getRunData:()=>({outputs:[{dims:s,dataType:r}],dispatchGroup:{x:l},programUniforms:[{type:12,data:u}]})}},gs=(n,e,t,i)=>{let r=n.inputs.length===1?t:ZT(n.inputs,t),s=r.axes;s.length===0&&!r.noopWithEmptyAxes&&(s=n.inputs[0].dims.map((m,y)=>y));let a=ie.normalizeAxes(s,n.inputs[0].dims.length),o=a,l=n.inputs[0],u=uN(o,n.inputs[0].dims.length);u.length>0&&(l=n.compute(Mr(n.inputs[0],u),{inputs:[0],outputs:[-1]})[0],o=sN(o.length,l.dims.length));let[c,h]=aN(l.dims,o),f=c;r.keepDims&&(f=oN(c,a)),n.compute(cN(e,r.cacheKey,[l],i,n.inputs[0].dataType,f,h),{inputs:[l]})},wV=(n,e)=>{gs(n,"ReduceMeanShared",e,"mean")},bV=(n,e)=>{gs(n,"ReduceL1Shared",e,"l1")},xV=(n,e)=>{gs(n,"ReduceL2Shared",e,"l2")},EV=(n,e)=>{gs(n,"ReduceLogSumExpShared",e,"logSumExp")},AV=(n,e)=>{gs(n,"ReduceMaxShared",e,"max")},TV=(n,e)=>{gs(n,"ReduceMinShared",e,"min")},SV=(n,e)=>{gs(n,"ReduceProdShared",e,"prod")},IV=(n,e)=>{gs(n,"ReduceSumShared",e,"sum")},CV=(n,e)=>{gs(n,"ReduceSumSquareShared",e,"sumSquare")},kV=(n,e)=>{gs(n,"ReduceLogSumShared",e,"logSum")}}),ys,dN,Mb,ZT,_s,hN,fN,pN,mN,gN,yN,_N,vN,wN,bN,vs,$V,RV,PV,NV,DV,MV,OV,LV,FV,zV,EC=pe(()=>{Fe(),We(),sn(),qe(),qJ(),ys=n=>{if(!n||n.length===0||n.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(n.length===2&&n[1].dims.length!==1)throw new Error("Invalid axes input dims.")},dN=n=>["","",`var value = ${n.getByIndices("input_indices")};`,""],Mb=(n,e,t,i,r,s,a=!1,o=!1)=>{let l=[],u=t[0].dims,c=u.length,h=ie.normalizeAxes(r,c),f=!o&&h.length===0;u.forEach((_,x)=>{f||h.indexOf(x)>=0?a&&l.push(1):l.push(_)});let m=l.length,y=ie.size(l);return{name:n,shaderCache:e,getShaderSource:_=>{let x=[],v=ae("_A",t[0].dataType,c),w=Ie("output",s,m),E=i(v,w,h),k=E[2];for(let $=0,L=0;$<c;$++)f||h.indexOf($)>=0?(a&&L++,k=`for(var j${$}: u32 = 0; j${$} < ${u[$]}; j${$}++) {
                  ${E[2].includes("last_index")?`let last_index = j${$};`:""}
                  ${v.indicesSet("input_indices",$,`j${$}`)}
                  ${k}
                }`):(x.push(`${v.indicesSet("input_indices",$,w.indicesGet("output_indices",L))};`),L++);return`

        ${_.registerUniform("output_size","u32").declareVariables(v,w)}

        ${_.mainStart()}
          ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${v.type.indices};
          let output_indices = ${w.offsetToIndices("global_idx")};

          ${x.join(`
`)}
          ${E[0]}       // init ops for reduce max/min
          ${E[1]}
          ${k}
          ${E[3]}
          ${E.length===4?w.setByOffset("global_idx","value"):E.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:l,dataType:s}],dispatchGroup:{x:Math.ceil(y/64)},programUniforms:[{type:12,data:y},...Ne(u,l)]})}},ZT=(n,e)=>{let t=[];return n[1].dims[0]>0&&n[1].getBigInt64Array().forEach(i=>t.push(Number(i))),_t({axes:t,keepDims:e.keepDims,noopWithEmptyAxes:e.noopWithEmptyAxes})},_s=(n,e,t,i)=>{let r=n.inputs,s=r.length===1?t:ZT(r,t);n.compute(Mb(e,{hint:s.cacheKey,inputDependencies:["rank"]},[r[0]],s.noopWithEmptyAxes&&s.axes.length===0?dN:i,s.axes,r[0].dataType,s.keepDims,s.noopWithEmptyAxes),{inputs:[0]})},hN=(n,e)=>{ys(n.inputs),_s(n,"ReduceLogSum",e,(t,i)=>[`var value = ${i.type.storage}(0);`,"",`value += ${t.getByIndices("input_indices")};`,"value = log(value);"])},fN=(n,e)=>{ys(n.inputs),_s(n,"ReduceL1",e,(t,i)=>[`var value = ${i.type.storage}(0);`,"",`value += abs(${t.getByIndices("input_indices")});`,""])},pN=(n,e)=>{ys(n.inputs),_s(n,"ReduceL2",e,(t,i)=>[`var t = ${i.type.value}(0); var value = ${i.type.value}(0);`,"",`t = ${t.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},mN=(n,e)=>{ys(n.inputs),_s(n,"ReduceLogSumExp",e,(t,i)=>[`var value = ${i.type.storage}(0);`,"",`value += exp(${t.getByIndices("input_indices")});`,"value = log(value);"])},gN=(n,e)=>{ys(n.inputs),_s(n,"ReduceMax",e,(t,i,r)=>{let s=[];for(let a=0;a<t.rank;a++)(r.indexOf(a)>=0||r.length===0)&&s.push(t.indicesSet("input_indices",a,0));return[`${s.join(`
`)}`,`var value = ${t.getByIndices("input_indices")};`,`value = max(value, ${t.getByIndices("input_indices")});`,""]})},yN=(n,e)=>{ys(n.inputs),_s(n,"ReduceMean",e,(t,i,r)=>{let s=1;for(let a=0;a<t.rank;a++)(r.indexOf(a)>=0||r.length===0)&&(s*=n.inputs[0].dims[a]);return["var sum = f32(0);","",`sum += f32(${t.getByIndices("input_indices")});`,`let value = ${i.type.value}(sum / ${s});`]})},_N=(n,e)=>{ys(n.inputs),_s(n,"ReduceMin",e,(t,i,r)=>{let s=[];for(let a=0;a<t.rank;a++)(r.indexOf(a)>=0||r.length===0)&&s.push(`input_indices[${a}] = 0;`);return[`${s.join(`
`)}`,`var value = ${t.getByIndices("input_indices")};`,`value = min(value, ${t.getByIndices("input_indices")});`,""]})},vN=(n,e)=>{ys(n.inputs),_s(n,"ReduceProd",e,(t,i)=>[`var value = ${i.type.storage}(1);`,"",`value *= ${t.getByIndices("input_indices")};`,""])},wN=(n,e)=>{ys(n.inputs),_s(n,"ReduceSum",e,(t,i)=>[`var value = ${i.type.storage}(0);`,"",`value += ${t.getByIndices("input_indices")};`,""])},bN=(n,e)=>{ys(n.inputs),_s(n,"ReduceSumSquare",e,(t,i)=>[`var t = ${i.type.value}(0); var value = ${i.type.value}(0);`,"",`t = ${t.getByIndices("input_indices")}; value += t * t;`,""])},vs=(n,e,t)=>{if(e.length===0)return t;let i=1,r=1;for(let s=0;s<e.length;s++)e.indexOf(s)===-1?i*=n[s]:r*=n[s];return r<32&&i>1024},$V=(n,e)=>{vs(n.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?yN(n,e):wV(n,e)},RV=(n,e)=>{vs(n.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?fN(n,e):bV(n,e)},PV=(n,e)=>{vs(n.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?pN(n,e):xV(n,e)},NV=(n,e)=>{vs(n.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?mN(n,e):EV(n,e)},DV=(n,e)=>{vs(n.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?gN(n,e):AV(n,e)},MV=(n,e)=>{vs(n.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?_N(n,e):TV(n,e)},OV=(n,e)=>{vs(n.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?vN(n,e):SV(n,e)},LV=(n,e)=>{vs(n.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?wN(n,e):IV(n,e)},FV=(n,e)=>{vs(n.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?bN(n,e):CV(n,e)},zV=(n,e)=>{vs(n.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?hN(n,e):kV(n,e)}}),FE,VV,jV,eS,GJ=pe(()=>{Fe(),sn(),EC(),FE=n=>{if(!n||n.length===0||n.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(n[0].dataType!==1)throw new Error("Invalid input type.")},VV=(n,e)=>{FE(n.inputs);let t=(i,r,s)=>{let a=[];for(let o=0;o<i.rank;o++)(s.indexOf(o)>=0||s.length===0)&&a.push(`input_indices[${o}] = 0;`);return[`${a.join(`
`)}`,`var value = ${i.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${i.getByIndices("input_indices")} ${e.selectLastIndex>0?"<=":"<"} value) {
         value = ${i.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",r.setByOffset("global_idx","best_index")]};n.compute(Mb("ArgMin",{hint:e.cacheKey,inputDependencies:["rank"]},[n.inputs[0]],t,[e.axis],7,e.keepDims),{inputs:[0]})},jV=(n,e)=>{FE(n.inputs);let t=(i,r,s)=>{let a=[];for(let o=0;o<i.rank;o++)(s.indexOf(o)>=0||s.length===0)&&a.push(`input_indices[${o}] = 0;`);return[`${a.join(`
`)}`,`var value = ${i.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${i.getByIndices("input_indices")} ${e.selectLastIndex>0?">=":">"} value) {
         value = ${i.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",r.setByOffset("global_idx","best_index")]};n.compute(Mb("argMax",{hint:e.cacheKey,inputDependencies:["rank"]},[n.inputs[0]],t,[e.axis],7,e.keepDims),{inputs:[0]})},eS=n=>_t(n)}),xN,C0,EN,AN,TN,wy,SN,BV,AC=pe(()=>{Fe(),We(),bC(),qe(),xN=(n,e)=>{let t=n[0],i=n[1],r=n[2],s=n[3],a=n[4],o=n[5];if(a&&o)throw new Error("Attention cannot have both past and attention_bias");if(t.dims.length!==3)throw new Error('Input "input" must have 3 dimensions');let l=t.dims[0],u=t.dims[1],c=t.dims[2];if(r.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimensions');if(i.dims.length!==2)throw new Error('Input "weights" is expected to have 2 dimensions');if(i.dims[0]!==c)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(r.dims[0]!==i.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let h=r.dims[0]/3,f=h,m=f;if(e.qkvHiddenSizes.length>0){if(e.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let E of e.qkvHiddenSizes)if(E%e.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");h=e.qkvHiddenSizes[0],f=e.qkvHiddenSizes[1],m=e.qkvHiddenSizes[2]}let y=u;if(h!==f)throw new Error("qkv_hidden_sizes first element should be same as the second");if(r.dims[0]!==h+f+m)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let _=0;if(a){if(f!==m)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(a.dims.length!==5)throw new Error('Input "past" must have 5 dimensions');if(a.dims[0]!==2)throw new Error('Input "past" first dimension must be 2');if(a.dims[1]!==l)throw new Error('Input "past" second dimension must be batch_size');if(a.dims[2]!==e.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(a.dims[4]!==f/e.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');e.pastPresentShareBuffer||(_=a.dims[3])}let x=y+_,v=-1,w=0;if(s)throw new Error("Mask not supported");if(a)throw new Error("past is not supported");if(o){if(o.dims.length!==4)throw new Error('Input "attention_bias" must have 4 dimensions');if(o.dims[0]!==l||o.dims[1]!==e.numHeads||o.dims[2]!==u||o.dims[3]!==x)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:l,sequenceLength:u,pastSequenceLength:_,kvSequenceLength:y,totalSequenceLength:x,maxSequenceLength:v,inputHiddenSize:c,hiddenSize:h,vHiddenSize:m,headSize:Math.floor(h/e.numHeads),vHeadSize:Math.floor(m/e.numHeads),numHeads:e.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:e.maskFilterValue,maskType:w,scale:e.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},C0=(n,e,t)=>e&&n?`
      let total_sequence_length_input = u32(${e.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${n==null?void 0:n.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${t?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,EN=(n,e,t,i,r,s,a,o)=>{let l=Yt(a?1:s),u=64,c=s/l;c<u&&(u=32);let h=Math.ceil(s/l/u),f=[{type:12,data:e},{type:12,data:t},{type:12,data:i},{type:12,data:r},{type:12,data:c},{type:12,data:h}],m=Pn(n.dataType,l),y=yi(1,l),_=["type"];a&&_.push("type"),o&&_.push("type");let x=v=>{let w=Ie("x",n.dataType,n.dims,l),E=[w],k=a?ae("seq_lens",a.dataType,a.dims):void 0;k&&E.push(k);let $=o?ae("total_sequence_length_input",o.dataType,o.dims):void 0;$&&E.push($);let L=yi(n.dataType),I=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${u}>;
  var<workgroup> thread_sum: array<f32, ${u}>;
  ${v.registerUniforms(I).declareVariables(...E)}
  ${v.mainStart([u,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${C0(k,$,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${u}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${a?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${y}(-3.402823e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${y}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(l){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${l}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.402823e+38f);
    for (var i = 0u; i < ${u}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${y}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${y}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(l){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${l}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${u}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${w.type.value}(${L}(1.0) / ${L}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${y}(x[offset + i]);
        x[offset + i] = ${w.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${a?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${w.type.value}(${L}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${u};${m};${l}`,inputDependencies:_},getShaderSource:x,getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:r,z:e*t},programUniforms:f})}},AN=(n,e,t,i,r,s,a,o,l)=>{let u=a+s.kvSequenceLength,c=[s.batchSize,s.numHeads,s.sequenceLength,u],h=n>1&&i,f=s.kvNumHeads?s.kvNumHeads:s.numHeads,m=h?[s.batchSize,f,u,s.headSize]:void 0,y=s.nReps?s.nReps:1,_=s.scale===0?1/Math.sqrt(s.headSize):s.scale,x=Yt(s.headSize),v=s.headSize/x,w=12,E={x:Math.ceil(u/w),y:Math.ceil(s.sequenceLength/w),z:s.batchSize*s.numHeads},k=[{type:12,data:s.sequenceLength},{type:12,data:v},{type:12,data:u},{type:12,data:s.numHeads},{type:12,data:s.headSize},{type:1,data:_},{type:12,data:a},{type:12,data:s.kvSequenceLength},{type:12,data:y}],$=h&&i&&ie.size(i.dims)>0,L=["type","type"];$&&L.push("type"),r&&L.push("type"),o&&L.push("type"),l&&L.push("type");let I=[{dims:c,dataType:e.dataType,gpuDataType:0}];h&&I.push({dims:m,dataType:e.dataType,gpuDataType:0});let C=N=>{let O=ae("q",e.dataType,e.dims,x),V=ae("key",t.dataType,t.dims,x),U=[O,V];if($){let W=ae("past_key",i.dataType,i.dims,x);U.push(W)}r&&U.push(ae("attention_bias",r.dataType,r.dims));let j=o?ae("seq_lens",o.dataType,o.dims):void 0;j&&U.push(j);let he=l?ae("total_sequence_length_input",l.dataType,l.dims):void 0;he&&U.push(he);let me=Ie("output",e.dataType,c),te=[me];h&&te.push(Ie("present_key",e.dataType,m,x));let oe=yi(1,x),G=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${w}u;

  var<workgroup> tileQ: array<${O.type.storage}, ${w*w}>;
  var<workgroup> tileK: array<${O.type.storage}, ${w*w}>;
  ${N.registerUniforms(G).declareVariables(...U,...te)}
  ${N.mainStart([w,w,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${y===1?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${y===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${C0(j,he,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${$&&h?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${h?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${oe}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${$&&h?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${h?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${oe}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch(x){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${x}`)}})()};
        output[outputIdx] = ${me.type.value} (sum * uniforms.alpha) + ${r?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${x};${r!==void 0};${i!==void 0};${n}`,inputDependencies:L},getRunData:()=>({outputs:I,dispatchGroup:E,programUniforms:k}),getShaderSource:C}},TN=(n,e,t,i,r,s,a=void 0,o=void 0)=>{let l=s+r.kvSequenceLength,u=r.nReps?r.nReps:1,c=r.vHiddenSize*u,h=n>1&&i,f=r.kvNumHeads?r.kvNumHeads:r.numHeads,m=h?[r.batchSize,f,l,r.headSize]:void 0,y=[r.batchSize,r.sequenceLength,c],_=12,x={x:Math.ceil(r.vHeadSize/_),y:Math.ceil(r.sequenceLength/_),z:r.batchSize*r.numHeads},v=[{type:12,data:r.sequenceLength},{type:12,data:l},{type:12,data:r.vHeadSize},{type:12,data:r.numHeads},{type:12,data:r.headSize},{type:12,data:c},{type:12,data:s},{type:12,data:r.kvSequenceLength},{type:12,data:u}],w=h&&i&&ie.size(i.dims)>0,E=["type","type"];w&&E.push("type"),a&&E.push("type"),o&&E.push("type");let k=[{dims:y,dataType:e.dataType,gpuDataType:0}];h&&k.push({dims:m,dataType:e.dataType,gpuDataType:0});let $=L=>{let I=ae("probs",e.dataType,e.dims),C=ae("v",t.dataType,t.dims),N=[I,C];w&&N.push(ae("past_value",i.dataType,i.dims));let O=a?ae("seq_lens",a.dataType,a.dims):void 0;a&&N.push(O);let V=o?ae("total_sequence_length_input",o.dataType,o.dims):void 0;o&&N.push(V);let U=[Ie("output",e.dataType,y)];h&&U.push(Ie("present_value",e.dataType,m));let j=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${_}u;
  var<workgroup> tileQ: array<${I.type.value}, ${_*_}>;
  var<workgroup> tileV: array<${I.type.value}, ${_*_}>;
  ${L.registerUniforms(j).declareVariables(...N,...U)}
  ${L.mainStart([_,_,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${u===1?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${u===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${C0(O,V,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${w&&h?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${h?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${I.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${w&&h?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${h?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${i!==void 0};${n}`,inputDependencies:E},getRunData:()=>({outputs:k,dispatchGroup:x,programUniforms:v}),getShaderSource:$}},wy=(n,e,t,i,r,s,a,o,l,u,c=void 0,h=void 0)=>{let f=Math.min(n.outputCount,1+(a?1:0)+(o?1:0)),m=f>1?u.pastSequenceLength:0,y=m+u.kvSequenceLength,_=l&&ie.size(l.dims)>0?l:void 0,x=[e,t];f>1&&a&&ie.size(a.dims)>0&&x.push(a),_&&x.push(_),c&&x.push(c),h&&x.push(h);let v=n.compute(AN(f,e,t,a,_,u,m,c,h),{inputs:x,outputs:f>1?[-1,1]:[-1]})[0];n.compute(EN(v,u.batchSize,u.numHeads,m,u.sequenceLength,y,c,h),{inputs:c&&h?[v,c,h]:[v],outputs:[]});let w=[v,i];f>1&&o&&ie.size(o.dims)>0&&w.push(o),c&&w.push(c),h&&w.push(h),n.compute(TN(f,v,i,o,u,m,c,h),{inputs:w,outputs:f>1?[0,2]:[0]})},SN=(n,e)=>{let t=[e.batchSize,e.numHeads,e.sequenceLength,e.headSize],i=e.sequenceLength,r=e.inputHiddenSize,s=e.headSize,a=12,o={x:Math.ceil(e.headSize/a),y:Math.ceil(e.sequenceLength/a),z:e.batchSize*e.numHeads},l=[n.inputs[0],n.inputs[1],n.inputs[2]],u=[{type:12,data:i},{type:12,data:r},{type:12,data:s},{type:12,data:e.numHeads},{type:12,data:e.headSize},{type:12,data:e.hiddenSize},{type:12,data:e.hiddenSize+e.hiddenSize+e.vHiddenSize}],c=h=>{let f=Ie("output_q",l[0].dataType,t),m=Ie("output_k",l[0].dataType,t),y=Ie("output_v",l[0].dataType,t),_=ae("input",l[0].dataType,l[0].dims),x=ae("weight",l[1].dataType,l[1].dims),v=ae("bias",l[2].dataType,l[2].dims),w=_.type.storage,E=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${a}u;
  var<workgroup> tileInput: array<${w}, ${a*a}>;
  var<workgroup> tileWeightQ: array<${w}, ${a*a}>;
  var<workgroup> tileWeightK: array<${w}, ${a*a}>;
  var<workgroup> tileWeightV: array<${w}, ${a*a}>;
  ${h.registerUniforms(E).declareVariables(_,x,v,f,m,y)}
  ${h.mainStart([a,a,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${w}(0);
    var valueK = ${w}(0);
    var valueV = ${w}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return n.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:t,dataType:n.inputs[0].dataType,gpuDataType:0},{dims:t,dataType:n.inputs[0].dataType,gpuDataType:0},{dims:t,dataType:n.inputs[0].dataType,gpuDataType:0}],dispatchGroup:o,programUniforms:u}),getShaderSource:c},{inputs:l,outputs:[-1,-1,-1]})},BV=(n,e)=>{let t=xN(n.inputs,e),[i,r,s]=SN(n,t);return wy(n,i,r,s,n.inputs[4],void 0,void 0,void 0,n.inputs[5],t)}}),IN,CN,kN,UV,KJ=pe(()=>{os(),Fe(),We(),sn(),qe(),IN=(n,e)=>{if(!n||n.length!==5)throw new Error("BatchNormalization requires 5 inputs");let t=(i,r,s)=>{let a=r.length;if(a!==i.length)throw new Error(`${s}: num dimensions != ${a}`);r.forEach((o,l)=>{if(o!==i[l])throw new Error(`${s}: dim[${l}] do not match`)})};if(n[0].dims.length>1){let i=e.format==="NHWC"?e.spatial?n[0].dims.slice(-1):n[0].dims.slice(-1).concat(n[0].dims.slice(1,n[0].dims.length-1)):n[0].dims.slice(1,e.spatial?2:void 0);t(n[1].dims,i,"Invalid input scale"),t(n[2].dims,i,"Invalid input B"),t(n[3].dims,i,"Invalid input mean"),t(n[4].dims,i,"Invalid input var")}else t(n[1].dims,[1],"Invalid input scale"),t(n[2].dims,[1],"Invalid input B"),t(n[3].dims,[1],"Invalid input mean"),t(n[4].dims,[1],"Invalid input var")},CN=(n,e)=>{let{epsilon:t,spatial:i,format:r}=e,s=n[0].dims,a=i?Yt(s[s.length-1]):1,o=r==="NHWC"&&s.length>1?a:1,l=ie.size(s)/a,u=i,c=u?s.length:s,h=ae("x",n[0].dataType,n[0].dims,a),f=ae("scale",n[1].dataType,n[1].dims,o),m=ae("bias",n[2].dataType,n[2].dims,o),y=ae("inputMean",n[3].dataType,n[3].dims,o),_=ae("inputVar",n[4].dataType,n[4].dims,o),x=Ie("y",n[0].dataType,c,a),v=()=>{let E="";if(i)E=`let cOffset = ${s.length===1?"0u":r==="NHWC"?`outputIndices[${s.length-1}] / ${a}`:"outputIndices[1]"};`;else if(r==="NCHW")E=`
            ${x.indicesSet("outputIndices","0","0")}
            let cOffset = ${x.indicesToOffset("outputIndices")};`;else{E=`var cIndices = ${f.type.indices}(0);
                       cIndices[0] = outputIndices[${s.length-1}];`;for(let k=1;k<f.rank;k++)E+=`cIndices[${k}] = outputIndices[${k}];`;E+=`let cOffset = ${f.indicesToOffset("cIndices")};`}return E},w=E=>`
  const epsilon = ${t};
  ${E.registerUniform("outputSize","u32").declareVariables(h,f,m,y,_,x)}
  ${E.mainStart()}
  ${E.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${x.offsetToIndices(`global_idx * ${a}`)};
    ${v()}
    let scale = ${f.getByOffset("cOffset")};
    let bias = ${m.getByOffset("cOffset")};
    let inputMean = ${y.getByOffset("cOffset")};
    let inputVar = ${_.getByOffset("cOffset")};
    let x = ${h.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${x.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${e.epsilon}_${e.format}_${i}_${a}`,inputDependencies:u?["rank","type","type","type","type"]:void 0},getShaderSource:w,getRunData:()=>({outputs:[{dims:n[0].dims,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:u?[{type:12,data:l},...Ne(s)]:[{type:12,data:l}]})}},kN=n=>_t(n),UV=(n,e)=>{let{inputs:t,outputCount:i}=n,r=kN({...e,outputCount:i});if(Lt.webgpu.validateInputContent&&IN(t,r),e.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");n.compute(CN(t,r))}}),$N,RN,HV,YJ=pe(()=>{We(),qe(),$N=n=>{if(n[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(n[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(n[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(n[0].dims[2]!==n[1].dims[0])throw new Error("last dimension of input and bias are not the same")},RN=n=>{let e=n[0].dims,t=n[0].dims[2],i=ie.size(e)/4,r=n[0].dataType,s=ae("input",r,e,4),a=ae("bias",r,[t],4),o=ae("residual",r,e,4),l=Ie("output",r,e,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:e,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(i/64)}}),getShaderSource:u=>`
  const channels = ${t}u / 4;
  ${u.declareVariables(s,a,o,l)}

  ${u.mainStart()}
    ${u.guardAgainstOutOfBoundsWorkgroupSizes(i)}
    let value = ${s.getByOffset("global_idx")}
      + ${a.getByOffset("global_idx % channels")} + ${o.getByOffset("global_idx")};
    ${l.setByOffset("global_idx","value")}
  }`}},HV=n=>{$N(n.inputs),n.compute(RN(n.inputs))}}),PN,pt,WV,qV,GV,KV,YV,XV,QV,JV,ZV,NN,ej,tj,nj,ij,lg,rj,uw,sj,aj,oj,lj,uj,cj,dj,hj,fj,pj,mj,gj,yj,_j,vj,wj,zE,bj,tS,nS,xj,Ej,Aj,DN,MN,Tj,TC=pe(()=>{Fe(),We(),sn(),qe(),PN=(n,e,t,i,r,s,a)=>{let o=Math.ceil(e/4),l="";typeof r=="string"?l=`${r}(a)`:l=r("a");let u=ae("inputData",t,[o],4),c=Ie("outputData",i,[o],4),h=[{name:"vec_size",type:"u32"}];return a&&h.push(...a),`
      ${n.registerUniforms(h).declareVariables(u,c)}

  ${s??""}

  ${n.mainStart()}
    ${n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${u.getByOffset("global_idx")};
    ${c.setByOffset("global_idx",l)}
  }`},pt=(n,e,t,i,r,s=n.dataType,a,o)=>{let l=[{type:12,data:Math.ceil(ie.size(n.dims)/4)}];return a&&l.push(...a),{name:e,shaderCache:{hint:r,inputDependencies:["type"]},getShaderSource:u=>PN(u,ie.size(n.dims),n.dataType,s,t,i,o),getRunData:u=>({outputs:[{dims:n.dims,dataType:s}],dispatchGroup:{x:Math.ceil(ie.size(u[0].dims)/64/4)},programUniforms:l})}},WV=n=>{n.compute(pt(n.inputs[0],"Abs","abs"))},qV=n=>{n.compute(pt(n.inputs[0],"Acos","acos"))},GV=n=>{n.compute(pt(n.inputs[0],"Acosh","acosh"))},KV=n=>{n.compute(pt(n.inputs[0],"Asin","asin"))},YV=n=>{n.compute(pt(n.inputs[0],"Asinh","asinh"))},XV=n=>{n.compute(pt(n.inputs[0],"Atan","atan"))},QV=n=>{n.compute(pt(n.inputs[0],"Atanh","atanh"))},JV=n=>_t(n),ZV=(n,e)=>{let t;switch(e.to){case 10:t="vec4<f16>";break;case 1:t="vec4<f32>";break;case 12:t="vec4<u32>";break;case 6:t="vec4<i32>";break;case 9:t="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${e.to}`)}n.compute(pt(n.inputs[0],"Cast",t,void 0,e.cacheKey,e.to))},NN=n=>{let e,t,i=n.length>=2&&n[1].data!==0,r=n.length>=3&&n[2].data!==0;switch(n[0].dataType){case 1:e=i?n[1].getFloat32Array()[0]:-34028234663852886e22,t=r?n[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:e=i?n[1].getUint16Array()[0]:64511,t=r?n[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return _t({min:e,max:t})},ej=(n,e)=>{let t=e||NN(n.inputs),i=yi(n.inputs[0].dataType);n.compute(pt(n.inputs[0],"Clip",r=>`clamp(${r}, vec4<${i}>(uniforms.min), vec4<${i}>(uniforms.max))`,void 0,t.cacheKey,void 0,[{type:n.inputs[0].dataType,data:t.min},{type:n.inputs[0].dataType,data:t.max}],[{name:"min",type:i},{name:"max",type:i}]),{inputs:[0]})},tj=n=>{n.compute(pt(n.inputs[0],"Ceil","ceil"))},nj=n=>{n.compute(pt(n.inputs[0],"Cos","cos"))},ij=n=>{n.compute(pt(n.inputs[0],"Cosh","cosh"))},lg=n=>_t(n),rj=(n,e)=>{let t=yi(n.inputs[0].dataType);n.compute(pt(n.inputs[0],"Elu",i=>`elu_vf32(${i})`,`
  const elu_alpha_ = ${t}(${e.alpha});

  fn elu_f32(a: ${t}) -> ${t} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${t}>) -> vec4<${t}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,e.cacheKey))},uw=(n="f32")=>`
const r0: ${n} = 0.3275911;
const r1: ${n} = 0.254829592;
const r2: ${n} = -0.284496736;
const r3: ${n} = 1.421413741;
const r4: ${n} = -1.453152027;
const r5: ${n} = 1.061405429;

fn erf_vf32(v: vec4<${n}>) -> vec4<${n}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,sj=n=>{let e=yi(n.inputs[0].dataType);n.compute(pt(n.inputs[0],"Erf",t=>`erf_vf32(${t})`,uw(e)))},aj=n=>{n.compute(pt(n.inputs[0],"Exp","exp"))},oj=n=>{n.compute(pt(n.inputs[0],"Floor","floor"))},lj=n=>{let e=yi(n.inputs[0].dataType);n.compute(pt(n.inputs[0],"Gelu",t=>`0.5 * ${t} * (1.0 + erf_vf32(${t} * 0.7071067811865475))`,uw(e)))},uj=(n,e)=>{let t=yi(n.inputs[0].dataType);n.compute(pt(n.inputs[0],"LeakyRelu",i=>`select(leaky_relu_alpha_ * ${i}, ${i}, ${i} >= vec4<${t}>(0.0))`,`const leaky_relu_alpha_ = ${t}(${e.alpha});`,e.cacheKey))},cj=n=>{n.compute(pt(n.inputs[0],"Not",e=>`!${e}`))},dj=n=>{n.compute(pt(n.inputs[0],"Neg",e=>`-${e}`))},hj=n=>{n.compute(pt(n.inputs[0],"Reciprocal",e=>`1.0/${e}`))},fj=n=>{let e=yi(n.inputs[0].dataType);n.compute(pt(n.inputs[0],"Relu",t=>`select(vec4<${e}>(0.0), ${t}, ${t} > vec4<${e}>(0.0))`))},pj=n=>{n.compute(pt(n.inputs[0],"Sigmoid",e=>`(1.0 / (1.0 + exp(-${e})))`))},mj=n=>_t(n),gj=(n,e)=>{let t=yi(n.inputs[0].dataType);n.compute(pt(n.inputs[0],"HardSigmoid",i=>`max(vec4<${t}>(0.0), min(vec4<${t}>(1.0), ${e.alpha} * ${i} + vec4<${t}>(${e.beta})))`,void 0,e.cacheKey))},yj=n=>{n.compute(pt(n.inputs[0],"Sin","sin"))},_j=n=>{n.compute(pt(n.inputs[0],"Sinh","sinh"))},vj=n=>{n.compute(pt(n.inputs[0],"Sqrt","sqrt"))},wj=n=>{n.compute(pt(n.inputs[0],"Tan","tan"))},zE=n=>`sign(${n}) * (1 - exp(-2 * abs(${n}))) / (1 + exp(-2 * abs(${n})))`,bj=n=>{n.compute(pt(n.inputs[0],"Tanh",zE))},tS=(n="f32")=>`
const fast_gelu_a: ${n} = 0.5;
const fast_gelu_b: ${n} = 0.7978845608028654;
const fast_gelu_c: ${n} = 0.035677408136300125;

fn tanh_v(v: vec4<${n}>) -> vec4<${n}> {
  return ${zE("v")};
}
`,nS=n=>`(fast_gelu_a + fast_gelu_a * tanh_v(${n} * (fast_gelu_c * ${n} * ${n} + fast_gelu_b))) * ${n}`,xj=n=>{let e=yi(n.inputs[0].dataType);n.compute(pt(n.inputs[0],"FastGelu",nS,tS(e),void 0,n.inputs[0].dataType))},Ej=(n,e)=>{let t=yi(n.inputs[0].dataType);return n.compute(pt(n.inputs[0],"ThresholdedRelu",i=>`select(vec4<${t}>(0.0), ${i}, ${i} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${t}>(${e.alpha});`,e.cacheKey)),0},Aj=n=>{n.compute(pt(n.inputs[0],"Log","log"))},DN=(n,e)=>`
const alpha = vec4<${n}>(${e});
const one = ${n}(1.0);
const zero = ${n}(0.0);

fn quick_gelu_impl(x: vec4<${n}>) -> vec4<${n}> {
  let v = x *alpha;
  var x1 : vec4<${n}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,MN=n=>`quick_gelu_impl(${n})`,Tj=(n,e)=>{let t=yi(n.inputs[0].dataType);n.compute(pt(n.inputs[0],"QuickGelu",MN,DN(t,e.alpha),e.cacheKey,n.inputs[0].dataType))}}),ON,LN,Sj,XJ=pe(()=>{We(),qe(),TC(),ON=n=>{if(n[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(n[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(n[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(n[0].dims[2]!==n[1].dims[0])throw new Error("last dimension of input and bias are not the same")},LN=n=>{let e=n[0].dims.slice();e[2]=e[2]/2;let t=ae("input",n[0].dataType,n[0].dims,4),i=ae("bias",n[0].dataType,[n[0].dims[2]],4),r=Ie("output",n[0].dataType,e,4),s=ie.size(e)/4,a=Pn(n[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:e,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)}}),getShaderSource:o=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${n[0].dims[2]/4/2}u;

  ${o.declareVariables(t,i,r)}

  ${uw(a)}

  ${o.mainStart()}
    ${o.guardAgainstOutOfBoundsWorkgroupSizes(s)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${r.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},Sj=n=>{ON(n.inputs),n.compute(LN(n.inputs))}}),FN,zN,ws,Ij,Cj,kj,$j,Rj,Pj,Nj,Dj,Mj,Oj,QJ=pe(()=>{Fe(),We(),qe(),FN=(n,e,t,i,r,s,a,o,l,u,c,h)=>{let f,m;typeof o=="string"?f=m=(w,E)=>`${o}((${w}),(${E}))`:typeof o=="function"?f=m=o:(f=o.scalar,m=o.vector);let y=Ie("outputData",c,i.length,4),_=ae("aData",l,e.length,4),x=ae("bData",u,t.length,4),v;if(r)if(s){let w=ie.size(e)===1,E=ie.size(t)===1,k=e.length>0&&e[e.length-1]%4===0,$=t.length>0&&t[t.length-1]%4===0;w||E?v=y.setByOffset("global_idx",m(w?`${_.type.value}(${_.getByOffset("0")}.x)`:_.getByOffset("global_idx"),E?`${x.type.value}(${x.getByOffset("0")}.x)`:x.getByOffset("global_idx"))):v=`
            let outputIndices = ${y.offsetToIndices("global_idx * 4u")};
            let offsetA = ${_.broadcastedIndicesToOffset("outputIndices",y)};
            let offsetB = ${x.broadcastedIndicesToOffset("outputIndices",y)};
            ${y.setByOffset("global_idx",m(a||k?_.getByOffset("offsetA / 4u"):`${_.type.value}(${_.getByOffset("offsetA / 4u")}[offsetA % 4u])`,a||$?x.getByOffset("offsetB / 4u"):`${x.type.value}(${x.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else v=y.setByOffset("global_idx",m(_.getByOffset("global_idx"),x.getByOffset("global_idx")));else{if(!s)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let w=(E,k,$="")=>{let L=`aData[indexA${k}][componentA${k}]`,I=`bData[indexB${k}][componentB${k}]`;return`
            let outputIndices${k} = ${y.offsetToIndices(`global_idx * 4u + ${k}u`)};
            let offsetA${k} = ${_.broadcastedIndicesToOffset(`outputIndices${k}`,y)};
            let offsetB${k} = ${x.broadcastedIndicesToOffset(`outputIndices${k}`,y)};
            let indexA${k} = offsetA${k} / 4u;
            let indexB${k} = offsetB${k} / 4u;
            let componentA${k} = offsetA${k} % 4u;
            let componentB${k} = offsetB${k} % 4u;
            ${E}[${k}] = ${$}(${f(L,I)});
          `};c===9?v=`
            var data = vec4<u32>(0);
            ${w("data",0,"u32")}
            ${w("data",1,"u32")}
            ${w("data",2,"u32")}
            ${w("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:v=`
            ${w("outputData[global_idx]",0)}
            ${w("outputData[global_idx]",1)}
            ${w("outputData[global_idx]",2)}
            ${w("outputData[global_idx]",3)}
          `}return`
        ${n.registerUniform("vec_size","u32").declareVariables(_,x,y)}

        ${h??""}

        ${n.mainStart()}
        ${n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${v}
      }`},zN=(n,e,t,i,r,s,a=t.dataType)=>{let o=t.dims.map(_=>Number(_)??1),l=i.dims.map(_=>Number(_)??1),u=!ie.areEqual(o,l),c=o,h=ie.size(o),f=!1,m=!1,y=[u];if(u){let _=Vp.calcShape(o,l,!1);if(!_)throw new Error("Can't perform binary op on the given tensors");c=_.slice(),h=ie.size(c);let x=ie.size(o)===1,v=ie.size(l)===1,w=o.length>0&&o[o.length-1]%4===0,E=l.length>0&&l[l.length-1]%4===0;y.push(x),y.push(v),y.push(w),y.push(E);let k=1;for(let $=1;$<c.length;$++){let L=o[o.length-$],I=l[l.length-$];if(L===I)k*=L;else break}k%4===0?(m=!0,f=!0):(x||v||w||E)&&(f=!0)}else f=!0;return y.push(f),{name:n,shaderCache:{hint:e+y.map(_=>_.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:_=>FN(_,o,l,c,f,u,m,r,t.dataType,i.dataType,a,s),getRunData:()=>({outputs:[{dims:c,dataType:a}],dispatchGroup:{x:Math.ceil(h/64/4)},programUniforms:[{type:12,data:Math.ceil(ie.size(c)/4)},...Ne(o,l,c)]})}},ws=(n,e,t,i,r,s)=>{n.compute(zN(e,r??"",n.inputs[0],n.inputs[1],t,i,s))},Ij=n=>{ws(n,"Add",(e,t)=>`${e}+${t}`)},Cj=n=>{ws(n,"Div",(e,t)=>`${e}/${t}`)},kj=n=>{ws(n,"Equal",{scalar:(e,t)=>`u32(${e}==${t})`,vector:(e,t)=>`vec4<u32>(${e}==${t})`},void 0,void 0,9)},$j=n=>{ws(n,"Mul",(e,t)=>`${e}*${t}`)},Rj=n=>{let e=ae("input",n.inputs[0].dataType,n.inputs[0].dims).type.value;ws(n,"Pow",{scalar:(t,i)=>`pow_custom(${t},${i})`,vector:(t,i)=>`pow_vector_custom(${t},${i})`},`
    fn pow_custom(a : ${e}, b : ${e}) -> ${e} {
      if (b == ${e}(0.0)) {
        return ${e}(1.0);
      } else if (a < ${e}(0.0) && f32(b) != floor(f32(b))) {
        return ${e}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${e}(1.0), round(f32(abs(b) % ${e}(2.0))) != 1.0) * ${e}(${e==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${e}>, b : vec4<${e}>) -> vec4<${e}> {
      // TODO: implement vectorized pow
      return vec4<${e}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},Pj=n=>{ws(n,"Sub",(e,t)=>`${e}-${t}`)},Nj=n=>{ws(n,"Greater",{scalar:(e,t)=>`u32(${e}>${t})`,vector:(e,t)=>`vec4<u32>(${e}>${t})`},void 0,void 0,9)},Dj=n=>{ws(n,"Less",{scalar:(e,t)=>`u32(${e}<${t})`,vector:(e,t)=>`vec4<u32>(${e}<${t})`},void 0,void 0,9)},Mj=n=>{ws(n,"GreaterOrEqual",{scalar:(e,t)=>`u32(${e}>=${t})`,vector:(e,t)=>`vec4<u32>(${e}>=${t})`},void 0,void 0,9)},Oj=n=>{ws(n,"LessOrEqual",{scalar:(e,t)=>`u32(${e}<=${t})`,vector:(e,t)=>`vec4<u32>(${e}<=${t})`},void 0,void 0,9)}}),VN,jN,BN,UN,Lj,Fj,JJ=pe(()=>{Fe(),We(),sn(),qe(),VN=(n,e)=>{if(!n||n.length<1)throw new Error("too few inputs");let t=0,i=n[t],r=i.dataType,s=i.dims.length;n.forEach((a,o)=>{if(o!==t){if(a.dataType!==r)throw new Error("input tensors should be one type");if(a.dims.length!==s)throw new Error("input tensors should have the same shape");a.dims.forEach((l,u)=>{if(u!==e&&l!==i.dims[u])throw new Error("non concat dimensions must match")})}})},jN=(n,e)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${n}u>(${e});
    for (var i: u32 = 0u; i < ${n}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${n}u;
  }`,BN=(n,e)=>{let t=n.length,i=[];for(let r=0;r<t;++r){let s=e.setByOffset("global_idx",n[r].getByIndices("indices"));t===1?i.push(s):r===0?i.push(`if (inputIndex == ${r}u) { ${s} }`):r===t-1?i.push(`else { ${s} }`):i.push(`else if (inputIndex == ${r}) { ${s} }`)}return i.join(`
`)},UN=(n,e,t,i)=>{let r=ie.size(t),s=new Array(n.length),a=new Array(n.length),o=0,l=[],u=[],c=[{type:12,data:r}];for(let _=0;_<n.length;++_)o+=n[_].dims[e],s[_]=o,u.push(n[_].dims.length),a[_]=ae(`input${_}`,i,u[_]),l.push("rank"),c.push({type:12,data:s[_]});for(let _=0;_<n.length;++_)c.push(...Ne(n[_].dims));c.push(...Ne(t));let h=Ie("output",i,t.length),f=h.indicesGet("indices",e),m=Array.from(Array(s.length).keys()).map(_=>`uniforms.sizeInConcatAxis${_}`).join(","),y=_=>`

  ${(()=>{_.registerUniform("outputSize","u32");for(let x=0;x<n.length;x++)_.registerUniform(`sizeInConcatAxis${x}`,"u32");return _.declareVariables(...a,h)})()}

  ${jN(s.length,m)}

  ${_.mainStart()}
    ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${h.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${f});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${s.length}u>(${m});
      ${f} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${BN(a,h)}
  }`;return{name:"Concat",shaderCache:{hint:`${e}`,inputDependencies:l},getRunData:()=>({outputs:[{dims:t,dataType:i}],dispatchGroup:{x:Math.ceil(r/64)},programUniforms:c}),getShaderSource:y}},Lj=(n,e)=>{let t=n.inputs,i=t[0].dims,r=ie.normalizeAxis(e.axis,i.length);VN(t,r);let s=i.slice();s[r]=t.reduce((o,l)=>o+(l.dims.length>r?l.dims[r]:0),0);let a=t.filter(o=>ie.size(o.dims)>0);n.compute(UN(a,r,s,t[0].dataType),{inputs:a})},Fj=n=>_t({axis:n.axis})}),Xd,Qd,Jd,SC,fh=pe(()=>{Fe(),We(),Xd=(n,e,t="f32")=>{switch(n.activation){case"Relu":return`value = max(value, ${e}(0.0));`;case"Sigmoid":return`value = (${e}(1.0) / (${e}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${e}(${t}(uniforms.clip_min)), ${e}(${t}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${e}(0.0), min(${e}(1.0), ${t}(uniforms.alpha) * value + ${t}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${t}(uniforms.alpha) * value, value, value >= ${e}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw new Error(`Unsupported activation ${n.activation}`)}},Qd=(n,e)=>{n.activation==="Clip"?e.push({type:1,data:n.clipMax},{type:1,data:n.clipMin}):n.activation==="HardSigmoid"?e.push({type:1,data:n.alpha},{type:1,data:n.beta}):n.activation==="LeakyRelu"&&e.push({type:1,data:n.alpha})},Jd=(n,e)=>{n.activation==="Clip"?e.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):n.activation==="HardSigmoid"?e.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):n.activation==="LeakyRelu"&&e.push({name:"alpha",type:"f32"})},SC=n=>{let e=(n==null?void 0:n.activation)||"";if(e==="HardSigmoid"){let[t,i]=(n==null?void 0:n.activation_params)||[.2,.5];return{activation:e,alpha:t,beta:i}}else if(e==="Clip"){let[t,i]=(n==null?void 0:n.activation_params)||[cV,dV];return{activation:e,clipMax:i,clipMin:t}}else if(e==="LeakyRelu"){let[t]=(n==null?void 0:n.activation_params)||[.01];return{activation:e,alpha:t}}return{activation:e}}}),Un,zj,IC=pe(()=>{Un=(n,e)=>{switch(n){case 1:return e;case 2:return`vec2<${e}>`;case 3:return`vec3<${e}>`;case 4:return`vec4<${e}>`;default:throw new Error(`${n}-component is not supported.`)}},zj=n=>`
      ${n?"value = value + getBiasByOutputCoords(coords);":""}
      `}),Vj,ZJ=pe(()=>{Vj=n=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${n}.x), i32(${n}.y), i32(${n}.z), 1));
}
`}),Ug,CC,kC=pe(()=>{Fe(),We(),qe(),fh(),Ug=(n,e,t,i,r)=>{let s=i-t;return`
      ${Array.from({length:t}).map((a,o)=>`
      if (${Pe(e.shape,o,e.rank)} != 1) {
        ${e.indicesSet(n,o,Pe(r,o+s,i))}
      } else {
        ${e.indicesSet(n,o,0)}
      }`).join("")}
`},CC=(n,e,t,i,r=!1,s)=>{let a=n[0].dims,o=n[1].dims,l=a[a.length-2],u=o[o.length-1],c=a[a.length-1],h=Yt(u),f=Yt(c),m=Yt(l),y=ie.size(t)/h/m,_=n.length>2,x=i?i.slice(0,-2):t.slice(0,-2),v=[ie.size(x),l,u],w=[{type:12,data:y},{type:12,data:l},{type:12,data:u},{type:12,data:c}];Qd(e,w),w.push(...Ne(x,a,o)),_&&w.push(...Ne(n[2].dims)),w.push(...Ne(v));let E=k=>{let $=xC("batch_dims",n[0].dataType,x.length),L=ae("a",n[0].dataType,a.length,f),I=ae("b",n[1].dataType,o.length,h),C=Ie("output",n[0].dataType,v.length,h),N=Pn(C.type.tensor),O=Xd(e,C.type.value,N),V=[L,I],U="";if(_){let me=r?h:1;V.push(ae("bias",n[2].dataType,n[2].dims.length,me)),U=`${r?`value += bias[col / ${me}];`:`value += ${C.type.value}(bias[row + i]);`}`}let j=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];Jd(e,j);let he=()=>{let me=`var a_data: ${L.type.value};`;for(let te=0;te<f;te++)me+=`
              let b_data${te} = b[(b_offset + (k + ${te}) * uniforms.N + col) / ${h}];`;for(let te=0;te<m;te++){me+=`a_data = a[(a_offset + (row + ${te}) * uniforms.K + k) / ${f}];`;for(let oe=0;oe<f;oe++)me+=`
            values[${te}] = fma(${I.type.value}(a_data${f===1?"":`[${oe}]`}), b_data${oe}, values[${te}]);
`}return me};return`
  ${k.registerUniforms(j).registerInternalVariables($).declareVariables(...V,C)}
  ${k.mainStart()}
    ${k.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${h})) * ${h};
    var index1 = global_idx / (uniforms.N / ${h});
    let stride1 = uniforms.M / ${m};
    let row = (index1 % stride1) * ${m};
    let batch = index1 / stride1;

    ${t.length===2?"":`let batch_indices = ${$.offsetToIndices("batch")};`}

    var a_indices: ${L.type.indices};
    ${Ug("a_indices",L,L.rank-2,$.rank,"batch_indices")}
    ${L.indicesSet("a_indices",L.rank-2,0)}
    ${L.indicesSet("a_indices",L.rank-1,0)}
    let a_offset = ${L.indicesToOffset("a_indices")};

    var b_indices: ${I.type.indices};
    ${Ug("b_indices",I,I.rank-2,$.rank,"batch_indices")}
    ${I.indicesSet("b_indices",I.rank-2,0)}
    ${I.indicesSet("b_indices",I.rank-1,0)}
    let b_offset = ${I.indicesToOffset("b_indices")};
    var values: array<${C.type.value}, ${m}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${f}) {
      ${he()}
    }
    for (var i = 0u; i < ${m}u; i++) {
      var value = values[i];
      ${U}
      ${O}
      let cur_indices = ${C.type.indices}(batch, row + i, col);
      let offset = ${C.indicesToOffset("cur_indices")};
      ${C.setByOffset(`offset / ${h}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${e.activation};${h};${f};${m};${r}`,inputDependencies:_?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:s?s(t):t,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(y/64)},programUniforms:w}),getShaderSource:E}}}),HN,WN,iS,VE,qN,rS,GN,Ob,$C=pe(()=>{Fe(),We(),qe(),fh(),kC(),IC(),HN=(n,e)=>n?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${e?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${e?", batchIndices":""});
        `,WN=(n,e)=>n?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${e===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${e===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${e===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,iS=(n,e,t="f32",i,r=!1,s=32,a=!1,o=32)=>{let l=e[1]*n[1],u=e[0]*n[0],c=r?l:s,h=r?s:l,f=c/e[0],m=s/e[1];if(!((r&&f===4&&n[1]===4||!r&&(f===3||f===4))&&c%e[0]===0&&s%e[1]===0&&n[0]===4))throw new Error(`If transposeA ${r} is true, innerElementSize ${f} and workPerThread[1] ${n[1]} must be 4.
      Otherwise, innerElementSize ${f} must be 3 or 4.
  tileAWidth ${c} must be divisible by workgroupSize[0]${e[0]}. tileInner ${s} must be divisible by workgroupSize[1] ${e[1]}. colPerThread ${n[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${f}<${t}>, ${c/f}>, ${h}>;
var<workgroup> mm_Bsub: array<array<vec4<${t}>, ${u/n[0]}>, ${s}>;

const rowPerThread = ${n[1]};
const colPerThread = ${n[0]};
const innerElementSize = ${f};
const tileInner = ${s};

@compute @workgroup_size(${e[0]}, ${e[1]}, ${e[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${a?"0":"i32(globalId.z)"};
  ${i?`let batchIndices = ${i.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${l};

  let num_tiles = ${a?`${Math.ceil(o/s)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${a?`i32(globalId.z) * ${o}`:"0"};

  var acc: array<vec4<${t}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${m};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${HN(r,i)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${m}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${i?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${f===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${WN(r,f)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},VE=(n,e)=>n?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${e?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${e?", batchIndices":""});
            `,qN=n=>n?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",rS=(n,e,t="f32",i,r=!1,s=32,a=!1,o=32,l=!1)=>{let u=n[1]*e[1],c=n[0]*e[0],h=r?u:s,f=r?s:u;if(!(f%e[1]===0&&h%e[0]===0&&s%e[1]===0))throw new Error(`tileAHight ${f} must be divisible by workgroupSize[1]${e[1]}, tileAWidth ${h} must be divisible by workgroupSize[0]${e[0]}, tileInner ${s} must be divisible by workgroupSize[1]${e[1]}`);let m=f/e[1],y=h/e[0],_=s/e[1],x=l?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${u};
    let globalColStart = i32(workgroupId.x) * ${c};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${f}; inputRow = inputRow + ${e[1]}) {
        for (var inputCol = localCol; inputCol < ${h}; inputCol = inputCol + ${e[0]}) {
          ${VE(r,i)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${s}; inputRow = inputRow + ${e[1]}) {
            for (var inputCol = localCol; inputCol < ${c}; inputCol = inputCol + ${e[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${i?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${t}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${e[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${r?`mm_Asub[k][localRow + innerRow * ${e[1]}];`:`mm_Asub[localRow + innerRow * ${e[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${e[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${e[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${u};

let tileRowA = i32(localId.y) * ${m};
let tileColA = i32(localId.x) * ${y};
let tileRowB = i32(localId.y) * ${_};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${m}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${y}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${VE(r,i)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${_}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${i?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${t}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${qN(r)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${t}, ${h}>, ${f}>;
  var<workgroup> mm_Bsub : array<array<${t}, ${c}>, ${s}>;
  const rowPerThread = ${n[1]};
  const colPerThread = ${n[0]};
  const tileInner = ${s};

@compute @workgroup_size(${e[0]}, ${e[1]}, ${e[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${a?"0":"i32(globalId.z)"};
    ${i?`let batchIndices = ${i.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${a?`${Math.ceil(o/s)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${a?`i32(globalId.z) * ${o}`:"0"};

    var acc : array<array<${t}, colPerThread>, rowPerThread>;
    ${x}
  }
`},GN=(n,e,t,i,r=!1)=>{let[s,a,o,l]=i,u=Pn(i[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${s.type.indices}) -> ${Un(n,u)} {
      var value = ${Un(n,u)}(0.0);
      let col = colIn * ${n};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${a.type.indices};
        ${Ug("aIndices",a,a.rank-2,s.rank,"batchIndices")}
        ${a.indicesSet("aIndices",a.rank-2,"u32(row)")}
        ${a.indicesSet("aIndices",a.rank-1,"u32(colIn)")}
        value = ${a.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${s.type.indices}) -> ${Un(n,u)} {
      var value = ${Un(n,u)}(0.0);
      let col = colIn * ${n};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${o.type.indices};
        ${Ug("bIndices",o,o.rank-2,s.rank,"batchIndices")}
        ${o.indicesSet("bIndices",o.rank-2,"u32(row)")}
        ${o.indicesSet("bIndices",o.rank-1,"u32(colIn)")}
        value = ${o.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${Un(n,u)}) {
      let col = colIn * ${n};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${e?`value = value + ${r?"bias[colIn]":`${Un(n,u)}(bias[row])`};`:""}
        ${t}
        ${l.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},Ob=(n,e,t,i,r=!1,s)=>{let a=n[0].dims,o=n[1].dims,l=a.slice(0,-2),u=o.slice(0,-2),c=i?i.slice(0,-2):t.slice(0,-2),h=ie.size(c),f=a[a.length-2],m=a[a.length-1],y=o[o.length-1],_=m%4===0&&y%4===0,x=f<=8?[4,1,1]:[4,4,1],v=[8,8,1],w=[Math.ceil(y/v[0]/x[0]),Math.ceil(f/v[1]/x[1]),Math.ceil(h/v[2]/x[2])],E=_?4:1,k=[...l,f,m/E],$=k.length,L=[...u,m,y/E],I=L.length,C=[h,f,y/E],N=[{type:6,data:f},{type:6,data:y},{type:6,data:m}];Qd(e,N),N.push(...Ne(c,k,L));let O=["rank","rank"],V=n.length>2;V&&(N.push(...Ne(n[2].dims)),O.push("rank")),N.push(...Ne(C));let U=j=>{let he=c.length,me=xC("batchDims",n[0].dataType,he,1),te=Pn(n[0].dataType),oe=ae("a",n[0].dataType,$,E),G=ae("b",n[1].dataType,I,E),W=Ie("result",n[0].dataType,C.length,E),K=[oe,G];if(V){let fe=r?E:1;K.push(ae("bias",n[2].dataType,n[2].dims.length,fe))}let H=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];Jd(e,H);let Q=Pn(W.type.tensor),Y=Xd(e,W.type.value,Q),Z=GN(E,V,Y,[me,oe,G,W],r);return`
  ${j.registerUniforms(H).registerInternalVariables(me).declareVariables(...K,W)}
  ${Z}
  ${_?iS(x,v,te,me):rS(x,v,te,me)}
                   `};return{name:"MatMul",shaderCache:{hint:`${x};${e.activation};${_};${r}`,inputDependencies:O},getRunData:()=>({outputs:[{dims:s?s(t):t,dataType:n[0].dataType}],dispatchGroup:{x:w[0],y:w[1],z:w[2]},programUniforms:N}),getShaderSource:U}}}),KN,jj,eZ=pe(()=>{Fe(),sl(),qe(),fh(),IC(),ZJ(),$C(),KN=(n,e,t,i,r=!1,s,a=4,o=4,l=4,u="f32")=>{let c=N=>{switch(N){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${u}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${N} is not supported.`)}},h=N=>{switch(N){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${N} is not supported.`)}},f=n?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,m=n?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,y=n?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",_=n?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",x=n?"row":"col",v=n?"col":"row",w=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${n?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${x} / outWidth;
    let outCol = ${x} % outWidth;

    let WRow = ${v} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${v} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${v} % inChannels;
    var resData = ${Un(a,u)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${y} && xCol >= 0 && xCol < ${_}) {
      ${f}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${c(a)}
    }
    return resData;`,E=n?e&&i?`
    let col = colIn * ${a};
    ${w}`:`
    let col = colIn * ${a};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${w}
    }
    return ${Un(a,u)}(0.0);`:i&&t?`
    let col = colIn * ${a};
    ${w}`:`
    let col = colIn * ${a};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${w}
    }
    return ${Un(a,u)}(0.0);`,k=n?i&&t?h(o):`
    let col = colIn * ${o};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${h(o)}
    }
    return ${Un(o,u)}(0.0);`:`
    let col = colIn * ${o};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${h(o)}
    }
    return ${Un(o,u)}(0.0);`,$=Un(l,u),L=Un(n?a:o,u),I=Un(n?o:a,u),C=Xd(s,$,u);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${L} {
      ${n?E:k}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${I} {
      ${n?k:E}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${$}) {
      let col = colIn * ${l};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${n?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${m}
      ${zj(r)}
      ${C}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},jj=(n,e,t,i,r,s,a,o,l)=>{let u=e.format==="NHWC",c=u?n[0].dims[3]:n[0].dims[1],h=t[0],f=u?t[2]:t[3],m=u?t[1]:t[2],y=u?t[3]:t[1],_=u&&(c%4===0||c%3===0)&&y%4===0,x=u?y:f*m,v=u?f*m:y,w=[8,8,1],E=i<=8?[4,1,1]:[4,4,1],k=[Math.ceil(x/w[0]/E[0]),Math.ceil(v/w[1]/E[1]),Math.ceil(h/w[2]/E[2])];at("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${k}`);let $=_?u&&c%4!==0?3:4:1,L=w[1]*E[1],I=w[0]*E[0],C=Math.max(w[0]*$,w[1]),N=i%L===0,O=r%I===0,V=s%C===0,U=_?[$,4,4]:[1,1,1],j=[{type:6,data:i},{type:6,data:r},{type:6,data:s},{type:6,data:[e.pads[0],e.pads[1]]},{type:6,data:e.strides},{type:6,data:e.dilations}];Qd(e,j),j.push(...Ne(n[0].dims,n[1].dims));let he=["rank","rank"];a&&(j.push(...Ne(n[2].dims)),he.push("rank")),j.push(...Ne(t));let me=te=>{let oe=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];Jd(e,oe);let G=_?4:1,W=Pn(n[0].dataType),K=`
      fn setOutputAtIndex(flatIndex : i32, value : ${_?`vec4<${W}>`:W}) {
        result[flatIndex] = ${_?`vec4<${W}>`:W}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${_?`vec4<${W}>`:W}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${_?"/ 4":""}, value);
      }`,H=ae("x",n[0].dataType,n[0].dims.length,$===3?1:$),Q=ae("w",n[1].dataType,n[1].dims.length,G),Y=[H,Q],Z=Ie("result",n[0].dataType,t.length,G);if(a){let fe=ae("bias",n[2].dataType,n[2].dims.length,G);Y.push(fe),K+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${_?`vec4<${W}>`:W} {
          return bias[coords.${u?"w":"y"}${_?"/ 4":""}];
        }`}return`
        ${Vj("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${te.registerUniforms(oe).declareVariables(...Y,Z)}
        ${K}
        ${KN(u,N,O,V,a,e,U[0],U[1],U[2],W)}
        ${_?iS(E,w,W,void 0,!u,C):rS(E,w,W,void 0,!u,C,!1,void 0,o)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${e.cacheKey};${$};${_};${N};${O};${V};${L};${I};${C}`,inputDependencies:he},getRunData:()=>({outputs:[{dims:l?l(t):t,dataType:n[0].dataType}],dispatchGroup:{x:k[0],y:k[1],z:k[2]},programUniforms:j}),getShaderSource:me}}}),YN,jE,zm,XN,BE,QN,Bj,Uj,tZ=pe(()=>{Fe(),sl(),We(),qe(),fh(),IC(),YN=n=>{let e=1;for(let t=0;t<n.length;t++)e*=n[t];return e},jE=n=>typeof n=="number"?[n,n,n]:n,zm=(n,e)=>e<=1?n:n+(n-1)*(e-1),XN=(n,e,t,i=1)=>{let r=zm(e,i);return Math.floor((n[0]*(t-1)-t+r)/2)},BE=(n,e,t,i,r)=>{r==null&&(r=XN(n,e[0],i[0]));let s=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*r>=e[a]&&(s[a]=Math.trunc((n[a]-e[a]+2*r)/i[a]+1));return s},QN=(n,e,t,i,r,s,a,o,l,u)=>{let c,h,f,m;if(n==="VALID"&&(n=0),typeof n=="number"){c={top:n,bottom:n,left:n,right:n,front:n,back:n};let y=BE([e,t,i,1],[o,l,u],1,[r,s,a],n);h=y[0],f=y[1],m=y[2]}else if(Array.isArray(n)){if(!n.every((_,x,v)=>_===v[0]))throw Error(`Unsupported padding parameter: ${n}`);c={top:n[0],bottom:n[1],left:n[2],right:n[3],front:n[4],back:n[5]};let y=BE([e,t,i,1],[o,l,u],1,[r,s,a],n[0]);h=y[0],f=y[1],m=y[2]}else if(n==="SAME_UPPER"){h=Math.ceil(e/r),f=Math.ceil(t/s),m=Math.ceil(i/a);let y=(h-1)*r+o-e,_=(f-1)*s+l-t,x=(m-1)*a+u-i,v=Math.floor(y/2),w=y-v,E=Math.floor(_/2),k=_-E,$=Math.floor(x/2),L=x-$;c={top:E,bottom:k,left:$,right:L,front:v,back:w}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:c,outDepth:h,outHeight:f,outWidth:m}},Bj=(n,e,t,i,r,s=!1,a="channelsLast")=>{let o,l,u,c,h;if(a==="channelsLast")[o,l,u,c,h]=n;else if(a==="channelsFirst")[o,h,l,u,c]=n;else throw new Error(`Unknown dataFormat ${a}`);let[f,,m,y,_]=e,[x,v,w]=jE(t),[E,k,$]=jE(i),L=zm(m,E),I=zm(y,k),C=zm(_,$),{padInfo:N,outDepth:O,outHeight:V,outWidth:U}=QN(r,l,u,c,x,v,w,L,I,C),j=s?f*h:f,he=[0,0,0,0,0];return a==="channelsFirst"?he=[o,j,O,V,U]:a==="channelsLast"&&(he=[o,O,V,U,j]),{batchSize:o,dataFormat:a,inDepth:l,inHeight:u,inWidth:c,inChannels:h,outDepth:O,outHeight:V,outWidth:U,outChannels:j,padInfo:N,strideDepth:x,strideHeight:v,strideWidth:w,filterDepth:m,filterHeight:y,filterWidth:_,effectiveFilterDepth:L,effectiveFilterHeight:I,effectiveFilterWidth:C,dilationDepth:E,dilationHeight:k,dilationWidth:$,inShape:n,outShape:he,filterShape:e}},Uj=(n,e,t,i,r,s)=>{let a=s==="channelsLast";a?n[0].dims[3]:n[0].dims[1];let o=[64,1,1],l={x:t.map((x,v)=>v)},u=[Math.ceil(YN(l.x.map(x=>t[x]))/o[0]),1,1];at("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${u}`);let c=1,h=ie.size(t),f=[{type:12,data:h},{type:12,data:i},{type:12,data:r},{type:12,data:e.strides},{type:12,data:e.dilations}];Qd(e,f),f.push(...Ne(n[0].dims,n[1].dims));let m=["rank","rank"],y=n.length===3;y&&(f.push(...Ne(n[2].dims)),m.push("rank")),f.push(...Ne(t));let _=x=>{let v=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:i.length},{name:"pads",type:"u32",length:r.length},{name:"strides",type:"u32",length:e.strides.length},{name:"dilations",type:"u32",length:e.dilations.length}];Jd(e,v);let w=1,E=Pn(n[0].dataType),k=ae("x",n[0].dataType,n[0].dims.length,c),$=ae("W",n[1].dataType,n[1].dims.length,w),L=[k,$],I=Ie("result",n[0].dataType,t.length,w),C="";if(y){let V=ae("bias",n[2].dataType,n[2].dims.length,w);L.push(V),C+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${E} {
          return bias[${a?Pe("coords",4,5):Pe("coords",1,5)}];
        }`}let N=Un(c,E),O=Xd(e,N,E);return`
            ${C}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${k.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${$.getByIndices("aIndices")};
            }
          ${x.registerUniforms(v).declareVariables(...L,I)}
          ${x.mainStart()}
          ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${I.offsetToIndices("global_idx")};
              let batch = ${Pe("coords",0,k.rank)};
              let d2 = ${a?Pe("coords",k.rank-1,k.rank):Pe("coords",1,k.rank)};
              let xFRCCorner = vec3<u32>(${a?Pe("coords",1,k.rank):Pe("coords",2,k.rank)},
              ${a?Pe("coords",2,k.rank):Pe("coords",3,k.rank)},
              ${a?Pe("coords",3,k.rank):Pe("coords",4,k.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${a?Pe("uniforms.x_shape",1,k.rank):Pe("uniforms.x_shape",2,k.rank)};
              let xShapeZ = ${a?Pe("uniforms.x_shape",2,k.rank):Pe("uniforms.x_shape",3,k.rank)};
              let xShapeW = ${a?Pe("uniforms.x_shape",3,k.rank):Pe("uniforms.x_shape",4,k.rank)};
              let xShapeU = ${a?Pe("uniforms.x_shape",4,k.rank):Pe("uniforms.x_shape",1,k.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${a?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${a?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${a?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${a?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${y?"value = value + getBiasByOutputCoords(coords)":""};
              ${O}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${e.cacheKey};${a};${c};${y}`,inputDependencies:m},getRunData:()=>({outputs:[{dims:t,dataType:n[0].dataType}],dispatchGroup:{x:u[0],y:u[1],z:u[2]},programUniforms:f}),getShaderSource:_}}}),Hj,Wj,nZ=pe(()=>{Fe(),We(),qe(),fh(),Hj=(n,e,t,i)=>{let r=n.length>2,s=r?"value += b[output_channel];":"",a=n[0].dims,o=n[1].dims,l=e.format==="NHWC",u=l?t[3]:t[1],c=u/e.group,h=l&&c>=4?Yt(u):1,f=ie.size(t)/h,m=[{type:12,data:f},{type:12,data:e.dilations},{type:12,data:[e.strides[0],e.strides[1]]},{type:12,data:[e.pads[0],e.pads[1]]},{type:12,data:c}];Qd(e,m),m.push(...Ne(a,[o[0],o[1],o[2],o[3]/h]));let y=r?["rank","rank","rank"]:["rank","rank"];m.push(...Ne([t[0],t[1],t[2],t[3]/h]));let _=x=>{let v=Ie("output",n[0].dataType,t.length,h),w=Pn(v.type.tensor),E=Xd(e,v.type.value,w),k=ae("x",n[0].dataType,a.length),$=ae("w",n[1].dataType,o.length,h),L=[k,$];r&&L.push(ae("b",n[2].dataType,n[2].dims,h));let I=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:e.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];Jd(e,I);let C=l?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${k.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${$.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${k.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${$.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${x.registerUniforms(I).declareVariables(...L,v)}

  ${x.mainStart()}
    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${v.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${l?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${l?1:2}], outputIndices[${l?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${h} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${l?2:1}];

    var value: ${v.type.value} = ${v.type.value}(0);
    ${C}
    ${s}
    ${E}
    ${v.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${e.cacheKey}_${h}`,inputDependencies:y},getRunData:()=>({outputs:[{dims:i?i(t):t,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:m}),getShaderSource:_}},Wj=(n,e,t,i)=>{let r=n.length>2,s=Yt(t[3]),a=Yt(t[2]),o=ie.size(t)/s/a,l=[n[0].dims[0],n[0].dims[1],n[0].dims[2],n[0].dims[3]/s],u=[n[1].dims[0],n[1].dims[1],n[1].dims[2],n[1].dims[3]/s],c=[t[0],t[1],t[2],t[3]/s],h=[{type:12,data:o},{type:6,data:[e.strides[0],e.strides[1]]},{type:6,data:[e.pads[0],e.pads[1]]}];Qd(e,h),h.push(...Ne(l,u,c));let f=(a-1)*e.strides[1]+u[1],m=y=>{let _=Ie("output",n[0].dataType,c.length,s),x=Pn(_.type.tensor),v=Xd(e,_.type.value,x),w=ae("x",n[0].dataType,l.length,s),E=ae("w",n[1].dataType,u.length,s),k=[w,E];r&&k.push(ae("b",n[2].dataType,n[2].dims,s));let $=r?"value += b[output_channel];":"",L=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return Jd(e,L),`
  ${y.registerUniforms(L).declareVariables(...k,_)}
  ${y.mainStart()}
    ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${a}u;
    let col = (index1 % width1) * ${a}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${w.type.value}, ${f}>;
    var values: array<${_.type.value}, ${a}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${u[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${f}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${w.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${w.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${u[1]}; w_width++) {
          let w_val = ${E.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${a}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${a}u; i++) {
      var value = values[i];
      ${$}
      ${v}
      ${_.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${e.cacheKey};${s};${a};${f};${u[0]};${u[1]}`,inputDependencies:r?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:i?i(t):t,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:h}),getShaderSource:m}}}),JN,k0,ZN,$0,sS,UE,eD,tD,aS,iZ=pe(()=>{We(),eZ(),tZ(),$C(),nZ(),fh(),kC(),Hu(),JN=(n,e,t,i,r,s)=>{let a=n[0],o=n.slice(s?1:2,s?3:4),l=o.length,u=e[0],c=e.slice(2).map((f,m)=>f+(f-1)*(t[m]-1)),h=o.map((f,m)=>f+i[m]+i[m+l]).map((f,m)=>Math.floor((f-c[m]+r[m])/r[m]));return h.splice(0,0,a),h.splice(s?3:1,0,u),h},k0=[2,3,1,0],ZN=(n,e)=>{if(!n||n.length!==2&&n.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(n[0].dims.length>5)throw new Error("greater than 5D is not supported");if(n[0].dims.length!==n[1].dims.length)throw new Error("filter does not have same dimension as input");let t=n[0].dims[e.format==="NHWC"?n[0].dims.length-1:1],i=n[1].dims[1]*e.group;if(t!==i)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(n.length===3&&(n[2].dims.length!==1||n[1].dims[0]!==n[2].dims[0]))throw new Error("invalid bias");let r=n[0].dims.length-2;if(e.dilations.length!==r)throw new Error(`dilations should be ${r}D`);if(e.strides.length!==r)throw new Error(`strides should be ${r}D`);if(e.pads.length!==r*2)throw new Error(`pads should be ${r*2}D`);if(e.kernelShape.length!==0&&e.kernelShape.length!==n[1].dims.length-2)throw new Error("invalid kernel shape")},$0=(n,e)=>{let t=n.kernelShape.slice();t.length<e[1].dims.length-2&&t.push(...Array(e[1].dims.length-2-t.length).fill(0));for(let s=2;s<e[1].dims.length;++s)t[s-2]===0&&(t[s-2]=e[1].dims[s]);let i=n.pads.slice();Db.adjustPadsBasedOnAutoPad(e[0].dims,n.strides,n.dilations,t,i,n.format==="NHWC",n.autoPad);let r=Object.assign({},n);return Object.assign(r,{kernelShape:t,pads:i}),r},sS=n=>{let e=SC(n),t=n.format,i=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][n.auto_pad],r=n.dilations,s=n.group,a=n.kernel_shape,o=n.pads,l=n.strides,u=n.w_is_const();return{autoPad:i,format:t,dilations:r,group:s,kernelShape:a,pads:o,strides:l,wIsConst:u,...e,cacheKey:`${n.format};${e.activation};`}},UE=(n,e,t,i)=>{let r=t.format==="NHWC",s=JN(e[0].dims,e[1].dims,t.dilations,t.pads,t.strides,r);if(t.group!==1){let L=[e[0]];if(r){let I=n.kernelCustomData.wT??n.compute(Mr(e[1],k0),{inputs:[1],outputs:[t.wIsConst?-2:-1]})[0];t.wIsConst&&!n.kernelCustomData.wT&&(n.kernelCustomData.wT=I),L.push(I)}else L.push(e[1]);e.length===3&&L.push(e[2]),!n.adapterInfo.isArchitecture("ampere")&&r&&e[1].dims[0]===t.group&&e[1].dims[1]===1&&t.dilations[0]===1&&t.dilations[1]===1?n.compute(Wj(L,t,s,i),{inputs:L}):n.compute(Hj(L,t,s,i),{inputs:L});return}let a=e.length===3,o=e[0].dims[r?1:2],l=e[0].dims[r?2:3],u=e[0].dims[r?3:1],c=e[1].dims[2],h=e[1].dims[3],f=s[r?1:2],m=s[r?2:3],y=s[r?3:1],_=r&&c===o&&h===l&&t.pads[0]===0&&t.pads[1]===0;if(_||c===1&&h===1&&t.dilations[0]===1&&t.dilations[1]===1&&t.strides[0]===1&&t.strides[1]===1&&t.pads[0]===0&&t.pads[1]===0){let L=s[0],I,C,N,O=[];if(r){let j=n.kernelCustomData.wT??n.compute(Mr(e[1],k0),{inputs:[1],outputs:[t.wIsConst?-2:-1]})[0];if(t.wIsConst&&!n.kernelCustomData.wT&&(n.kernelCustomData.wT=j),_){let he=o*l*u;I=e[0].reshape([1,L,he]),C=j.reshape([1,he,y]),N=[1,L,y]}else I=e[0].reshape([L,o*l,u]),C=j.reshape([1,u,y]),N=[L,f*m,y];O.push(I),O.push(C)}else I=e[0].reshape([L,u,o*l]),C=e[1].reshape([1,y,u]),N=[L,y,f*m],O.push(C),O.push(I);a&&O.push(e[2]);let V=N[2],U=O[0].dims[O[0].dims.length-1];V<8&&U<8?n.compute(CC(O,t,s,N,r,i),{inputs:O}):n.compute(Ob(O,t,s,N,r,i),{inputs:O});return}let x=!0,v=n.kernelCustomData.wT??n.compute(Mr(e[1],k0),{inputs:[1],outputs:[t.wIsConst?-2:-1]})[0];t.wIsConst&&!n.kernelCustomData.wT&&(n.kernelCustomData.wT=v);let w=[e[0],v];a&&w.push(e[2]);let E=r?f*m:y,k=r?y:f*m,$=c*h*u;n.compute(jj(w,t,s,E,k,$,a,x,i),{inputs:w})},eD=(n,e)=>{let t=e.format==="NHWC",i=[n.inputs[0].reshape(t?[n.inputs[0].dims[0],1,n.inputs[0].dims[1],n.inputs[0].dims[2]]:[n.inputs[0].dims[0],n.inputs[0].dims[1],1,n.inputs[0].dims[2]]),n.inputs[1].reshape([n.inputs[1].dims[0],n.inputs[1].dims[1],1,n.inputs[1].dims[2]])];n.inputs.length===3&&i.push(n.inputs[2]);let r=[0,e.pads[0],0,e.pads[1]],s=[1].concat(e.strides),a=[1].concat(e.dilations),o=[1].concat(e.kernelShape),l=$0({...e,pads:r,strides:s,dilations:a,kernelShape:o},i);UE(n,i,l,u=>t?[u[0],u[2],u[3]]:[u[0],u[1],u[3]])},tD=(n,e,t)=>{let i=t.format==="NHWC"?"channelsLast":"channelsFirst",r=$0(t,e),s=t.autoPad==="NOTSET"?t.pads:t.autoPad,a=Bj(e[0].dims,e[1].dims,t.strides,t.dilations,s,!1,i);n.compute(Uj(e,r,a.outShape,[a.filterDepth,a.filterHeight,a.filterWidth],[a.padInfo.front,a.padInfo.top,a.padInfo.left],i))},aS=(n,e)=>{if(ZN(n.inputs,e),n.inputs[0].dims.length===3)eD(n,e);else if(n.inputs[0].dims.length===5)tD(n,n.inputs,e);else{let t=$0(e,n.inputs);UE(n,n.inputs,t)}}}),qj,rZ=pe(()=>{Fe(),sl(),We(),qe(),qj=(n,e,t)=>{let i=n.length>2,r=e.outputShape,s=e.format==="NHWC",a=e.group,o=n[1].dims,l=o[2]/a,u=o[3],c=s?Yt(l):1,h=s&&u===1&&l>=4,f=h?Math.floor(l/4)*4:Math.floor(l/c)*c,m=l-f,y=s?Yt(u):1,_=s?u===1?c:y:1,x=ie.size(r)/y,v=[Math.ceil(x/64),1,1];at("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${v}`);let w=["rank","rank"],E=[e.strides[0],e.strides[1]],k=[e.kernelShape[s?1:2],e.kernelShape[s?2:3]],$=[e.dilations[0],e.dilations[1]],L=[k[0]+(e.dilations[0]<=1?0:(e.kernelShape[s?1:2]-1)*(e.dilations[0]-1)),k[1]+(e.dilations[1]<=1?0:(e.kernelShape[s?2:3]-1)*(e.dilations[1]-1))],I=[L[0]-1-Math.floor((e.pads[0]+e.pads[2])/2),L[1]-1-Math.floor((e.pads[1]+e.pads[3])/2)],C=[{type:12,data:x},{type:12,data:E},{type:12,data:k},{type:12,data:$},{type:12,data:L},{type:6,data:I},{type:12,data:f},{type:12,data:l},{type:12,data:u},...Ne(n[0].dims,n[1].dims)];i&&(C.push(...Ne(n[2].dims)),w.push("rank")),C.push(...Ne(r));let N=O=>{let V=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:E.length},{name:"filter_dims",type:"u32",length:k.length},{name:"dilations",type:"u32",length:k.length},{name:"effective_filter_dims",type:"u32",length:L.length},{name:"pads",type:"i32",length:I.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],U=Pn(n[0].dataType),j=s?1:2,he=s?2:3,me=s?3:1,te=ae("W",n[1].dataType,n[1].dims.length,_),oe=ae("Dy",n[0].dataType,n[0].dims.length,c),G=[oe,te];i&&G.push(ae("bias",n[2].dataType,[r[me]].length,y));let W=Ie("result",n[0].dataType,r.length,y),K=()=>{let Y="";if(h)c===4?Y+=`
        let xValue = ${oe.getByOffset("x_offset")};
        let wValue = ${te.getByOffset("w_offset")};
        dotProd = dotProd + dot(xValue, wValue);
        x_offset += 1u;
        w_offset += 1u;`:c===2?Y+=`
          dotProd = dotProd + dot(vec4<${U}>(${oe.getByOffset("x_offset")}, ${oe.getByOffset("x_offset + 1u")}), vec4<${U}>(${te.getByOffset("w_offset")}, ${te.getByOffset("w_offset + 1u")}));
          x_offset += 2u;
          w_offset += 2u;`:c===1&&(Y+=`
          dotProd = dotProd + dot(vec4<${U}>(${oe.getByOffset("x_offset")}, ${oe.getByOffset("x_offset + 1u")}, ${oe.getByOffset("x_offset + 2u")}, ${oe.getByOffset("x_offset + 3u")}), vec4<${U}>(${te.getByOffset("w_offset")}, ${te.getByOffset("w_offset + 1u")}, ${te.getByOffset("w_offset + 2u")}, ${te.getByOffset("w_offset + 3u")}));
          x_offset += 4u;
          w_offset += 4u;`);else if(Y+=`
                  let xValue = ${s?oe.getByOffset(`${oe.indicesToOffset(`${oe.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${c}`):oe.get("batch","inputChannel","idyR","idyC")};
        `,c===1)Y+=`
          let w_offset = ${te.indicesToOffset(`${te.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
          let wValue = ${te.getByOffset(`w_offset / ${_}`)};
          dotProd = dotProd + xValue * wValue;`;else for(let Z=0;Z<c;Z++)Y+=`
            let wValue${Z} = ${te.getByOffset(`${te.indicesToOffset(`${te.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${Z}, wOutChannel)`)} / ${_}`)};
            dotProd = dotProd + xValue[${Z}] * wValue${Z};`;return Y},H=()=>{if(m===0)return"";if(!h)throw new Error(`packInputAs4 ${h} is not true.`);let Y="";if(c===1){Y+="dotProd = dotProd";for(let Z=0;Z<m;Z++)Y+=`
            + ${oe.getByOffset(`x_offset + ${Z}`)} * ${te.getByOffset(`w_offset + ${Z}`)}`;Y+=";"}else if(c===2){if(m!==2)throw new Error(`Invalid inputChannelsRemainder ${m}.`);Y+=`
          let xValue = ${oe.getByOffset("x_offset")};
          let wValue = ${te.getByOffset("w_offset")};
          dotProd = dotProd + dot(xValue, wValue);`}return Y},Q=`
            let outputIndices = ${W.offsetToIndices(`global_idx * ${y}`)};
            let batch = ${W.indicesGet("outputIndices",0)};
            let d1 = ${W.indicesGet("outputIndices",me)};
            let r = ${W.indicesGet("outputIndices",j)};
            let c = ${W.indicesGet("outputIndices",he)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${W.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${U}(dyRCorner) + ${U}(wR)) / ${U}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${U}(uniforms.Dy_shape[${j}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }
              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${U}(dyCCorner) + ${U}(wC)) / ${U}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${U}(uniforms.Dy_shape[${he}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                ${h?`
                var x_offset = ${oe.indicesToOffset(`${oe.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${c};
                var w_offset = ${te.indicesToOffset(`${te.type.indices}(wRPerm, wCPerm, inputChannel, wOutChannel)`)} / ${_};
                  `:""}
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ${h?4:c}) {
                  ${K()}
                  inputChannel = inputChannel + ${h?4:c};
                }
                ${H()}
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${i?` + bias[d1 / ${y}]`:""};
            ${W.setByOffset("global_idx","value")};
          `;return`
    ${O.registerUniforms(V).declareVariables(...G,W)}
      ${O.mainStart()}
      ${O.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${Q}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${e.cacheKey};${c}${_}${y}${h}${m}`,inputDependencies:w},getRunData:()=>({dispatchGroup:{x:v[0],y:v[1],z:v[2]},outputs:[{dims:t?t(r):r,dataType:n[0].dataType}],programUniforms:C}),getShaderSource:N}}}),nD,iD,rD,HE,Gj,sD,WE,aD,Kj,sZ=pe(()=>{rZ(),fh(),Hu(),nD=(n,e,t,i,r,s)=>(n-1)*e+t+(i-1)*r+1-s,iD=(n,e,t,i,r)=>{let s=Math.floor(n/2);e==="SAME_UPPER"?(t[i]=s,t[r]=n-s):e==="SAME_LOWER"&&(t[i]=n-s,t[r]=s)},rD=(n,e,t,i,r,s,a,o,l,u)=>{let c=n.length-2,h=u.length===0;l.length<c&&l.push(...Array(c-l.length).fill(0));let f=n[0],m=e[o?3:1]*r;for(let y=0,_=n.length-c-(o?1:0);y<c;++y,++_){let x=n[_],v=h?x*a[y]:u[y],w=nD(x,a[y],s[y],e[_],t[y],v);iD(w,i,s,y,y+c),h&&u.push(a[y]*(x-1)+l[y]+(e[_]-1)*t[y]+1-s[y]-s[y+c])}u.splice(0,0,f),u.splice(o?3:1,0,m)},HE=(n,e)=>{let t=n.kernelShape.slice();if(n.kernelShape.length===0||n.kernelShape.reduce((h,f)=>h*f,1)===0){t.length=0;for(let h=2;h<e[1].dims.length;++h)t.push(e[1].dims[h])}let i=n.format==="NHWC";t.splice(0,0,e[1].dims[0]),t.splice(i?3:1,0,e[1].dims[1]);let r=n.pads.slice(),s=n.outputShape.slice(),a=n.outputPadding.slice(),o=e[0].dims,l=n.dilations.slice();if(l.reduce((h,f)=>h+f,0)===0){let h=e[0].dims.length-2;l=new Array(h).fill(1)}let u=n.strides.slice();if(u.reduce((h,f)=>h+f,0)===0){let h=e[0].dims.length-2;u=new Array(h).fill(1)}rD(o,t,l,n.autoPad,n.group,r,u,i,a,s);let c=Object.assign({},n);return Object.assign(c,{kernelShape:t,pads:r,outputPadding:a,outputShape:s,dilations:l,strides:u}),c},Gj=n=>{let e=SC(n),t=n.format,i=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof n.autoPad>"u"?0:n.autoPad],r=n.dilations,s=n.group,a=n.kernelShape,o=n.pads,l=n.strides,u=n.wIsConst(),c=n.outputPadding,h=n.outputShape;return{autoPad:i,format:t,dilations:r,group:s,kernelShape:a,outputPadding:c,outputShape:h,pads:o,strides:l,wIsConst:u,...e,cacheKey:`${n.format};${e.activation};`}},sD=(n,e)=>{if(!n||n.length!==2&&n.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(n[0].dims.length!==4&&n[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(n[0].dims.length!==n[1].dims.length)throw new Error("filter does not have same dimension as input");let t=n[0].dims[e.format==="NHWC"?n[0].dims.length-1:1],i=n[1].dims[0];if(t!==i)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let r=n[1].dims[1]*e.group;if(n.length===3&&(n[2].dims.length!==1||n[2].dims[0]!==r))throw new Error("invalid bias");let s=n[0].dims.length-2;if(e.dilations.reduce((a,o)=>a+o,0)>0&&e.dilations.length!==s)throw new Error(`dilations should be ${s}D`);if(e.strides.reduce((a,o)=>a+o,0)>0&&e.strides.length!==s)throw new Error(`strides should be ${s}D`);if(e.pads.reduce((a,o)=>a+o,0)>0&&e.pads.length!==s*2)throw new Error(`pads should be ${s*2}D`);if(e.outputPadding.length!==s&&e.outputPadding.length!==0)throw new Error(`output_padding should be ${s}D`);if(e.kernelShape.reduce((a,o)=>a+o,0)>0&&e.kernelShape.length!==0&&e.kernelShape.length!==n[1].dims.length-2)throw new Error("invalid kernel shape");if(e.outputShape.length!==0&&e.outputShape.length!==n[0].dims.length-2)throw new Error("invalid output shape")},WE=(n,e,t,i)=>{let r=n.kernelCustomData.wT??n.compute(Mr(e[1],[2,3,0,1]),{inputs:[1],outputs:[t.wIsConst?-2:-1]})[0];t.wIsConst&&!n.kernelCustomData.wT&&(n.kernelCustomData.wT=r);let s=[e[0],r];e.length===3&&s.push(e[2]),n.compute(qj(s,t,i),{inputs:s})},aD=(n,e)=>{let t=e.format==="NHWC",i=[n.inputs[0].reshape(t?[n.inputs[0].dims[0],1,n.inputs[0].dims[1],n.inputs[0].dims[2]]:[n.inputs[0].dims[0],n.inputs[0].dims[1],1,n.inputs[0].dims[2]]),n.inputs[1].reshape([n.inputs[1].dims[0],n.inputs[1].dims[1],1,n.inputs[1].dims[2]])];n.inputs.length===3&&i.push(n.inputs[2]);let r=e.kernelShape;(r.length===0||r[0]===0)&&(r=[n.inputs[1].dims[2]]);let s=e.dilations;(s.length===0||s[0]===0)&&(s=[1]);let a=e.strides;(a.length===0||a[0]===0)&&(a=[1]);let o=e.pads;o.length===0&&(o=[0,0]),o=[0,o[0],0,o[1]],a=[1].concat(a),s=[1].concat(s),r=[1].concat(r);let l=e.outputPadding;l=[0].concat(l);let u=HE({...e,pads:o,strides:a,dilations:s,kernelShape:r,outputPadding:l},i);WE(n,i,u,c=>t?[c[0],c[2],c[3]]:[c[0],c[1],c[3]])},Kj=(n,e)=>{if(sD(n.inputs,e),n.inputs[0].dims.length===3)aD(n,e);else{let t=HE(e,n.inputs);WE(n,n.inputs,t)}}}),oD,Yj,Xj,aZ=pe(()=>{Fe(),We(),sn(),qe(),oD=(n,e,t,i)=>{let r=ie.size(e),s=e.length,a=ae("input",n,s),o=Ie("output",n,s),l=t.dataType===6?t.getInt32Array()[0]:Number(t.getBigInt64Array()[0]),u=ie.normalizeAxis(l,s),c=h=>{let f=` i32(${a.indicesGet("inputIndices","uniforms.axis")}) `,m=Pe("uniforms.input_shape","uniforms.axis",s),y=i.reverse?f+(i.exclusive?" + 1":""):"0",_=i.reverse?m:f+(i.exclusive?"":" + 1");return`
                ${h.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(a,o)}
                ${h.mainStart()}
                  ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${o.offsetToIndices("global_idx")};
                  var sum = ${o.type.value}(0);
                  let first : i32 = ${y};
                  let last : i32 = ${_};
                  for (var i : i32 = first; i < last; i++) {
                    ${a.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${a.getByIndices("inputIndices")};
                  }
                  ${o.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:i.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:e,dataType:n}],dispatchGroup:{x:Math.ceil(r/64)},programUniforms:[{type:12,data:r},{type:12,data:u},...Ne(e,e)]}),getShaderSource:c}},Yj=(n,e)=>{let t=n.inputs[0].dims,i=n.inputs[0].dataType,r=n.inputs[1];n.compute(oD(i,t,r,e),{inputs:[0]})},Xj=n=>{let e=n.exclusive===1,t=n.reverse===1;return _t({exclusive:e,reverse:t})}}),lD,uD,cD,Qj,Jj,oZ=pe(()=>{Fe(),We(),sn(),qe(),lD=n=>{if(!n||n.length!==1)throw new Error("DepthToSpace requires 1 input.");if(n[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},uD=(n,e,t,i)=>{let r=[];r.push(`fn perm(i: ${i.type.indices}) -> ${t.type.indices} {
    var a: ${t.type.indices};`);for(let s=0;s<e;++s)r.push(t.indicesSet("a",n[s],`i[${s}]`));return r.push("return a;}"),r.join(`
`)},cD=(n,e)=>{let t,i,r,s,a,o,l=e.format==="NHWC",u=e.blocksize,c=e.mode==="DCR";l?([t,i,r,s]=n.dims,a=c?[t,i,r,u,u,s/u**2]:[t,i,r,s/u**2,u,u],o=c?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([t,i,r,s]=[n.dims[0],n.dims[2],n.dims[3],n.dims[1]],a=c?[t,u,u,s/u**2,i,r]:[t,s/u**2,u,u,i,r],o=c?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let h=n.reshape(a),f=h.dims.length,m=n.dataType,y=ae("a",m,f),_=Ie("output",m,f),x=v=>`
  ${v.registerUniform("output_size","u32").declareVariables(y,_)}

  ${uD(o,f,y,_)}

  ${v.mainStart()}
    ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${_.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${_.setByOffset("global_idx",y.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${n.dims};${e.blocksize};${e.mode}`,inputDependencies:["rank"]},getRunData:v=>{let w=l?[t,i*u,r*u,s/u**2]:[t,s/u**2,i*u,r*u],E=ie.size(w),k=h.dims,$=ie.sortBasedOnPerm(k,o);return{outputs:[{dims:w,dataType:v[0].dataType}],dispatchGroup:{x:Math.ceil(E/64)},programUniforms:[{type:12,data:E},...Ne(k,$)]}},getShaderSource:x}},Qj=(n,e)=>{lD(n.inputs),n.compute(cD(n.inputs[0],e))},Jj=n=>_t({blocksize:n.blocksize,mode:n.mode,format:n.format})}),R0,Vm,qE,dD,hD,fD,pD,GE,mD,Zj,eB,lZ=pe(()=>{Fe(),We(),sn(),qe(),R0="[a-zA-Z]|\\.\\.\\.",Vm="("+R0+")+",qE="^"+Vm+"$",dD="("+Vm+",)*"+Vm,hD="^"+dD+"$",fD=class{constructor(n=-1){this.symbolToIndices=new Map,this.inputIndex=n}addSymbol(n,e){let t=this.symbolToIndices.get(n);t===void 0?t=[e]:t.push(e),this.symbolToIndices.set(n,t)}},pD=class{constructor(n,e){var r;this.equation=e,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[t,i]=e.includes("->")?e.split("->",2):[e,""];if(!t.match(RegExp(hD)))throw new Error("Invalid LHS term");if(t.split(",").forEach((s,a)=>{let o=n[a].dims.slice();if(!s.match(RegExp(qE)))throw new Error("Invalid LHS term");let l=this.processTerm(s,!0,o,a);this.lhs.push(l)}),i==="")i+=[...this.symbolToInfo.entries()].filter(([s,a])=>a.count===1||s==="...").map(([s])=>s).join("");else if(!i.match(RegExp(Vm)))throw new Error("Invalid RHS");(r=i.match(RegExp(R0,"g")))==null||r.forEach(s=>{if(s==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let a=this.symbolToInfo.get(s);if(a===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(a.dimValue)}}),this.rhs=this.processTerm(i,!1,this.outputDims)}addSymbol(n,e,t){let i=this.symbolToInfo.get(n);if(i!==void 0){if(i.dimValue!==e&&i.count!==1)throw new Error("Dimension mismatch");i.count++,i.inputIndices.push(t)}else i={count:1,dimValue:e,inputIndices:[t]};this.symbolToInfo.set(n,i)}processTerm(n,e,t,i=-1){let r=t.length,s=!1,a=[],o=0;if(!n.match(RegExp(qE))&&!e&&n!=="")throw new Error("Invalid LHS term");let l=n.match(RegExp(R0,"g")),u=new fD(i);return l==null||l.forEach((c,h)=>{if(c==="..."){if(s)throw new Error("Only one ellipsis is allowed per input term");s=!0;let f=r-l.length+1;if(f<0)throw new Error("Ellipsis out of bounds");if(a=t.slice(o,o+f),this.hasEllipsis){if(this.ellipsisDims.length!==a.length||this.ellipsisDims.toString()!==a.toString())throw new Error("Ellipsis dimensions mismatch")}else if(e)this.hasEllipsis=!0,this.ellipsisDims=a;else throw new Error("Ellipsis must be specified in the LHS");for(let m=0;m<a.length;m++){let y=String.fromCharCode(48+m);u.addSymbol(y,h+m),this.addSymbol(y,t[o++],i)}}else u.addSymbol(c,h+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(c,t[o++],i)}),u}},GE=n=>n+"_max",mD=(n,e,t,i)=>{let r=n.map(u=>u.length).map((u,c)=>ae(`input${c}`,e,u)),s=ie.size(i),a=Ie("output",e,i.length),o=[...t.symbolToInfo.keys()].filter(u=>!t.rhs.symbolToIndices.has(u)),l=u=>{let c=[],h="var prod = 1.0;",f="var sum = 0.0;",m="sum += prod;",y=[],_=[],x=[],v=[],w=t.symbolToInfo.size===t.rhs.symbolToIndices.size;t.symbolToInfo.forEach((k,$)=>{var L;if(t.rhs.symbolToIndices.has($)){let I=(L=t.rhs.symbolToIndices.get($))==null?void 0:L[0];I!==void 0&&t.lhs.forEach((C,N)=>{if(k.inputIndices.includes(N)){let O=C.symbolToIndices.get($);if(O===void 0)throw new Error("Invalid symbol error");O.forEach(V=>{c.push(`${r[N].indicesSet(`input${N}Indices`,V,a.indicesGet("outputIndices",I))}`)})}})}else t.lhs.forEach((I,C)=>{if(k.inputIndices.includes(C)){let N=I.symbolToIndices.get($);if(N===void 0)throw new Error("Invalid symbol error");N.forEach(O=>{y.push(`${r[C].indicesSet(`input${C}Indices`,O,`${$}`)}`)}),v.push(`prod *= ${r[C].getByIndices(`input${C}Indices`)};`)}}),_.push(`for(var ${$}: u32 = 0; ${$} < uniforms.${GE($)}; ${$}++) {`),x.push("}")});let E=w?[...c,`let sum = ${r.map((k,$)=>k.getByIndices(`input${$}Indices`)).join(" * ")};`]:[...c,f,..._,...y,h,...v,m,...x];return`
            ${u.registerUniforms(o.map(k=>({name:`${GE(k)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...r,a)}

            ${u.mainStart()}
            ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${a.offsetToIndices("global_idx")};
            ${r.map((k,$)=>`var input${$}Indices: ${r[$].type.indices};`).join(`
`)}
            ${E.join(`
`)};
            ${a.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:t.equation,inputDependencies:n.map(()=>"rank")},getRunData:()=>{let u=o.filter(h=>t.symbolToInfo.has(h)).map(h=>{var f;return{type:12,data:((f=t.symbolToInfo.get(h))==null?void 0:f.dimValue)||0}});u.push({type:12,data:s});let c=n.map((h,f)=>[...Ne(h)]).reduce((h,f)=>h.concat(f),u);return c.push(...Ne(i)),{outputs:[{dims:i,dataType:e}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:c}},getShaderSource:l}},Zj=(n,e)=>{let t=new pD(n.inputs,e.equation),i=t.outputDims,r=n.inputs.map((s,a)=>s.dims);n.compute(mD(r,n.inputs[0].dataType,t,i))},eB=n=>{let e=n.equation.replace(/\s+/g,"");return _t({equation:e})}}),gD,KE,yD,_D,tB,uZ=pe(()=>{Fe(),We(),qe(),gD=n=>{if(!n||n.length!==2)throw new Error("Expand requires 2 input.");let e=n[0].dims,t=Array.from(n[1].getBigInt64Array(),Number),i=t.length<e.length?0:t.length-e.length,r=e.length<t.length?0:e.length-t.length;for(;i<t.length&&r<e.length;++i,++r)if(t[i]!==e[r]&&t[i]!==1&&e[r]!==1)throw new Error("Expand requires shape to be broadcastable to input")},KE=(n,e)=>{let t=n.length-e.length,i=[];for(let r=0;r<t;++r)i.push(n[r]);for(let r=0;r<e.length;++r)i.push(e[r]===1?n[r+t]:e[r]);return i},yD=(n,e)=>n.length>e.length?KE(n,e):KE(e,n),_D=n=>{let e=n[0].dims,t=Array.from(n[1].getBigInt64Array(),Number),i=yD(e,t),r=n[0].dataType,s=r===9||ie.size(e)===1,a=r===9||e.length>0&&e[e.length-1]%4===0?4:1,o=s||i.length>0&&i[i.length-1]%4===0?4:1,l=Math.ceil(ie.size(i)/o),u=h=>{let f=ae("input",r,e.length,a),m=Ie("output",r,i.length,o),y;if(r===9){let _=(x,v,w="")=>`
          let outputIndices${v} = ${m.offsetToIndices(`outputOffset + ${v}u`)};
          let offset${v} = ${f.broadcastedIndicesToOffset(`outputIndices${v}`,m)};
          let index${v} = offset${v} / 4u;
          let component${v} = offset${v} % 4u;
          ${x}[${v}] = ${w}(${f.getByOffset(`index${v}`)}[component${v}]);
        `;y=`
        let outputOffset = global_idx * ${o};
        var data = vec4<u32>(0);
        ${_("data",0,"u32")}
        ${_("data",1,"u32")}
        ${_("data",2,"u32")}
        ${_("data",3,"u32")}
        ${m.setByOffset("global_idx","data")}
      }`}else y=`
        let outputIndices = ${m.offsetToIndices(`global_idx * ${o}`)};
        let inputOffset = ${f.broadcastedIndicesToOffset("outputIndices",m)};
        let data = ${m.type.value}(${f.getByOffset(`inputOffset / ${a}`)});
        ${m.setByOffset("global_idx","data")}
      }`;return`
    ${h.registerUniform("vec_size","u32").declareVariables(f,m)}
    ${h.mainStart()}
    ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${y}`},c=[{type:12,data:l},...Ne(e,i)];return{name:"Expand",shaderCache:{hint:`${i.length};${a}${o}`,inputDependencies:["rank"]},getShaderSource:u,getRunData:()=>({outputs:[{dims:i,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:c})}},tB=n=>{gD(n.inputs),n.compute(_D(n.inputs),{inputs:[0]})}}),vD,nB,cZ=pe(()=>{Fe(),We(),qe(),TC(),vD=n=>{let e=n[0].dataType,t=ie.size(n[0].dims),i=ie.size(n[1].dims),r=i%4===0,s=a=>{let o=ae("x",e,[1],4),l=ae("bias",e,[1],4),u=Ie("y",e,[1],4),c=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],h=m=>`
      let bias${m}_offset: u32 = (global_idx * 4 + ${m}) % uniforms.bias_size;
      let bias${m} = ${l.getByOffset(`bias${m}_offset / 4`)}[bias${m}_offset % 4];`,f=r?`
      let bias = ${l.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${h(0)}${h(1)}${h(2)}${h(3)}
      let bias = ${o.type.value}(bias0, bias1, bias2, bias3);`;return`${a.registerUniforms(c).declareVariables(o,l,u)}

    ${tS(yi(e))}

    ${a.mainStart(jp)}
      ${a.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${o.getByOffset("global_idx")};
      ${f}
      let x_in = x + bias;
      ${u.setByOffset("global_idx",nS("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${r}`,inputDependencies:["type","type"]},getShaderSource:s,getRunData:a=>({outputs:[{dims:a[0].dims,dataType:a[0].dataType}],programUniforms:[{type:12,data:Math.ceil(t/4)},{type:12,data:i}],dispatchGroup:{x:Math.ceil(t/jp/4)}})}},nB=n=>{n.inputs.length<2||ie.size(n.inputs[1].dims)===0?xj(n):n.compute(vD(n.inputs))}}),wD,bD,iB,rB,dZ=pe(()=>{Fe(),We(),sn(),qe(),wD=n=>{if(!n||n.length!==2)throw new Error("Gather requires 2 inputs.")},bD=(n,e)=>{let t=n[0].dims,i=n[1].dims,r=t.length,s=ie.normalizeAxis(e.axis,r),a=t.slice(0);a.splice(s,1,...i);let o=t[s],l=n[0].dataType===9?4:1,u=Math.ceil(ie.size(a)/l),c=[{type:12,data:u},{type:6,data:o},{type:12,data:s},...Ne(n[0].dims,n[1].dims,a)],h=f=>{let m=ae("data",n[0].dataType,n[0].dims.length,l),y=ae("inputIndices",n[1].dataType,n[1].dims.length),_=Ie("output",n[0].dataType,a.length,l),x=w=>{let E=i.length,k=`var indicesIndices${w}  = ${y.type.indices}(0);`;for(let $=0;$<E;$++)k+=`${E>1?`indicesIndices${w}[${$}]`:`indicesIndices${w}`} = ${a.length>1?`outputIndices${w}[uniforms.axis + ${$}]`:`outputIndices${w}`};`;k+=`
          var idx${w} = ${y.getByIndices(`indicesIndices${w}`)};
          if (idx${w} < 0) {
            idx${w} = idx${w} + uniforms.axisDimLimit;
          }
          var dataIndices${w} : ${m.type.indices};
        `;for(let $=0,L=0;$<r;$++)$===s?(k+=`${r>1?`dataIndices${w}[${$}]`:`dataIndices${w}`} = u32(idx${w});`,L+=E):(k+=`${r>1?`dataIndices${w}[${$}]`:`dataIndices${w}`} = ${a.length>1?`outputIndices${w}[${L}]`:`outputIndices${w}`};`,L++);return k},v;if(n[0].dataType===9){let w=(E,k,$="")=>`
          let outputIndices${k} = ${_.offsetToIndices(`outputOffset + ${k}u`)};
          ${x(k)};
          let offset${k} = ${m.indicesToOffset(`dataIndices${k}`)};
          let index${k} = offset${k} / 4u;
          let component${k} = offset${k} % 4u;
          ${E}[${k}] = ${$}(${m.getByOffset(`index${k}`)}[component${k}]);
        `;v=`
        let outputOffset = global_idx * ${l};
        var value = vec4<u32>(0);
        ${w("value",0,"u32")}
        ${w("value",1,"u32")}
        ${w("value",2,"u32")}
        ${w("value",3,"u32")}
        ${_.setByOffset("global_idx","value")}
      `}else v=`
      let outputIndices = ${_.offsetToIndices("global_idx")};
      ${x("")};
      let value = ${m.getByIndices("dataIndices")};
      ${_.setByOffset("global_idx","value")};
      `;return`
      ${f.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(m,y,_)}
      ${f.mainStart()}
        ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${v}
      }`};return{name:"Gather",shaderCache:{hint:e.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:a,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:c}),getShaderSource:h}},iB=n=>_t({axis:n.axis}),rB=(n,e)=>{let t=n.inputs;wD(t),n.compute(bD(n.inputs,e))}}),xD,sB,aB,hZ=pe(()=>{Fe(),We(),qe(),xD=(n,e,t,i,r,s,a,o,l)=>{let u=[{type:12,data:s},{type:12,data:i},{type:12,data:r},{type:12,data:t},{type:12,data:a},{type:12,data:o},{type:12,data:l}],c=[s];u.push(...Ne(e.dims,c));let h=f=>{let m=ae("indices_data",e.dataType,e.dims.length),y=Ie("input_slice_offsets_data",12,1,1),_=[m,y],x=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:r.length},{name:"sizes_from_slice_dims_data",type:"u32",length:t.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${f.registerUniforms(x).declareVariables(..._)}
  ${f.mainStart()}
    ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${r.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${t.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return n.compute({name:"computeSliceOffsets",shaderCache:{hint:`${r.length}_${t.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:c,dataType:n.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:u}),getShaderSource:h},{inputs:[e],outputs:[-1]})[0]},sB=(n,e)=>{let t=n.inputs,i=t[0].dims,r=t[0].dataType,s=t[1].dims,a=s[s.length-1],o=ie.sizeToDimension(s,s.length-1),l=ie.sizeFromDimension(i,e.batchDims+a),u=ie.sizeToDimension(i,e.batchDims),c=ie.sizeFromDimension(i,e.batchDims),h=o/u,f=new Array(a),m=l;for(let k=0;k<a;++k)f[a-1-k]=m,m*=i[e.batchDims+a-1-k];let y=xD(n,t[1],f,e.batchDims,i,o,h,c,a),_=e.batchDims+a;if(_>i.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let x=s.slice(0,-1).concat(i.slice(_)),v=ie.size(x),w=[{type:12,data:v},{type:12,data:l},...Ne(t[0].dims,y.dims,x)],E=k=>{let $=ae("data",t[0].dataType,t[0].dims.length),L=ae("slice_offsets",12,y.dims.length),I=Ie("output",t[0].dataType,x.length);return`
          ${k.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables($,L,I)}
            ${k.mainStart()}
            ${k.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};n.compute({name:"GatherND",shaderCache:{hint:e.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:x,dataType:r}],dispatchGroup:{x:Math.ceil(v/64)},programUniforms:w}),getShaderSource:E},{inputs:[t[0],y]})},aB=n=>({batchDims:n.batch_dims,cacheKey:""})}),ED,AD,oB,lB,fZ=pe(()=>{Fe(),We(),sn(),qe(),ED=(n,e)=>{if(n.length<3||n.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let t=ie.normalizeAxis(e.quantizeAxis,n[0].dims.length),i=e.blockSize,r=n[0],s=n[2],a=n.length===4?n[3]:void 0;if(s.dims.length!==r.dims.length||!r.dims.map((o,l)=>l===t?Math.ceil(o/i)===s.dims[l]:o===s.dims[l]).reduce((o,l)=>o&&l,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(a){if(a.dataType!==r.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(a.dims.length!==s.dims.length||!a.dims.map((o,l)=>o===s.dims[l]).reduce((o,l)=>o&&l,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},AD=(n,e)=>{let t=n[0].dims,i=n[1].dims,r=t.length,s=ie.normalizeAxis(e.gatherAxis,r),a=ie.normalizeAxis(e.quantizeAxis,r),o=t.slice(0);o.splice(s,1,...i);let l=ie.size(o),u=n[2].dataType,c=n[0].dataType===22,h=[{type:12,data:l},{type:12,data:a},{type:12,data:s},{type:12,data:e.blockSize},...Ne(...n.map((m,y)=>m.dims),o)],f=m=>{let y=ae("data",n[0].dataType,n[0].dims.length),_=ae("inputIndices",n[1].dataType,n[1].dims.length),x=ae("scales",n[2].dataType,n[2].dims.length),v=n.length>3?ae("zeroPoint",n[3].dataType,n[3].dims.length):void 0,w=Ie("output",u,o.length),E=[y,_,x];v&&E.push(v);let k=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${m.registerUniforms(k).declareVariables(...E,w)}
        ${m.mainStart()}
        let output_indices = ${w.offsetToIndices("global_idx")};
        var indices_indices = ${_.type.indices}(0);
        ${i.length>1?`
          for (var i: u32 = 0; i < ${i.length}; i++) {
            let index = ${w.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${_.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${w.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${y.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${w.indicesGet("output_indices","i")};
          ${y.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${_.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${t[s]};
        }
        ${y.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${o.length}; i++) {
          let index = ${w.indicesGet("output_indices",`i + ${i.length} - 1`)};
          ${y.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${y.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${y.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${c?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${x.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${x.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${x.getByIndices("scale_indices")};
        ${v?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${v.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${v.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${c?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${yi(u)}(quantized_data - zero_point) * scale;
        ${w.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${e.cacheKey};${n.filter((m,y)=>y!==1).map(m=>m.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:n.length},(m,y)=>"rank")},getRunData:()=>({outputs:[{dims:o,dataType:u}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:h}),getShaderSource:f}},oB=(n,e)=>{let t=n.inputs;ED(t,e),n.compute(AD(n.inputs,e))},lB=n=>_t({blockSize:n.blockSize,gatherAxis:n.gatherAxis,quantizeAxis:n.quantizeAxis})}),TD,SD,uB,cB,pZ=pe(()=>{Fe(),We(),sn(),qe(),TD=n=>{if(!n||n.length!==2)throw new Error("GatherElements requires 2 inputs.");if(n[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(n[0].dims.length!==n[1].dims.length)throw new Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},SD=(n,e)=>{let t=n[0].dims,i=n[0].dataType,r=t.length,s=n[1].dims,a=n[1].dataType,o=ie.normalizeAxis(e.axis,r),l=t[o],u=s.slice(0),c=ie.size(u),h=ae("input",i,r),f=ae("indicesInput",a,s.length),m=Ie("output",i,u.length),y=[{type:12,data:c},{type:6,data:l},{type:12,data:o}];return y.push(...Ne(t,s,u)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:u,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:y}),getShaderSource:_=>`
      ${_.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(h,f,m)}
      ${_.mainStart()}
      ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${m.offsetToIndices("global_idx")};

      var idx = ${f.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${h.type.indices}(outputIndices);
      ${h.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${h.getByIndices("inputIndices")};

      ${m.setByOffset("global_idx","value")};
  }`}},uB=n=>_t({axis:n.axis}),cB=(n,e)=>{let t=n.inputs;TD(t),n.compute(SD(n.inputs,e))}}),ID,CD,dB,hB,mZ=pe(()=>{Fe(),We(),qe(),ID=n=>{if(!n)throw new Error("Input is missing");if(n.length<2||n.length>3)throw new Error("Invaid input number.");if(n.length===3&&n[2].dims.length>2)throw new Error("Invalid input shape of C");if(n[0].dataType!==n[1].dataType||n.length===3&&n[0].dataType!==n[2].dataType)throw new Error("Input types are mismatched")},CD=(n,e)=>{let t=n[0].dims.slice(),i=n[1].dims.slice(),[r,s,a]=uV.getShapeOfGemmResult(t,e.transA,i,e.transB,n.length===3?n[2].dims:void 0),o=[r,s];if(!o)throw new Error("Can't use gemm on the given tensors");let l=16,u=Math.ceil(s/l),c=Math.ceil(r/l),h=!0,f=ie.size(o),m=[{type:12,data:h?u:f},{type:12,data:r},{type:12,data:s},{type:12,data:a},{type:1,data:e.alpha},{type:1,data:e.beta}],y=["type","type"];n.length===3&&(m.push(...Ne(n[2].dims)),y.push("rank")),m.push(...Ne(o));let _=v=>{let w="";e.transA&&e.transB?w="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":e.transA&&!e.transB?w="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!e.transA&&e.transB?w="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!e.transA&&!e.transB&&(w="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let E=e.alpha===1?"":"value *= uniforms.alpha;",k=ae("a",n[0].dataType,n[0].dims),$=ae("b",n[1].dataType,n[1].dims),L=k.type.value,I=null,C=[k,$];n.length===3&&(I=ae("c",n[2].dataType,n[2].dims.length),C.push(I));let N=Ie("output",n[0].dataType,o.length);C.push(N);let O=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`
  ${v.registerUniforms(O).declareVariables(...C)}

  ${v.mainStart()}
    ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let m = global_idx / uniforms.N;
    let n = global_idx % uniforms.N;

    var value = ${L}(0);
    for (var k: u32 = 0u; k < uniforms.K; k++) {
      ${w}
    }

    ${E}
    ${I!=null?`let cOffset = ${I.broadcastedIndicesToOffset("vec2(m, n)",N)}; value += ${L}(uniforms.beta) * ${I.getByOffset("cOffset")};`:""}
    output[global_idx] = value;
  }`},x=v=>{let w=ae("a",n[0].dataType,n[0].dims),E=ae("b",n[1].dataType,n[1].dims),k=null,$=[w,E];n.length===3&&(k=ae("c",n[2].dataType,n[2].dims.length),$.push(k));let L=Ie("output",n[0].dataType,o.length);$.push(L);let I=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],C="",N="";e.transA&&e.transB?(N=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${w.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${E.type.value}(0);
      }
      `,C="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):e.transA&&!e.transB?(N=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${w.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${E.type.value}(0);
      }
      `,C="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!e.transA&&e.transB?(N=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${w.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${E.type.value}(0);
      }
      `,C="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!e.transA&&!e.transB&&(N=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${w.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${E.type.value}(0);
      }
      `,C="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let O=e.alpha===1?"":"value *= uniforms.alpha;";return`
  ${v.registerUniforms(I).declareVariables(...$)}
  var<workgroup> tile_a: array<array<${w.type.storage}, ${l}>, ${l}>;
  var<workgroup> tile_b: array<array<${E.type.storage}, ${l}>, ${l}>;
  ${v.mainStart([l,l,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${l};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${l};
    let num_tiles = (uniforms.K - 1) / ${l} + 1;
    var k_start = 0u;
    var value = ${L.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${N}
      k_start = k_start + ${l};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${l}; k++) {
        ${C}
      }
      workgroupBarrier();
    }

    ${O}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${k!=null?`let cOffset = ${k.broadcastedIndicesToOffset("vec2(m, n)",L)}; value += ${L.type.value}(uniforms.beta) * ${k.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return h?{name:"GemmShared",shaderCache:{hint:`${e.cacheKey}`,inputDependencies:y},getRunData:()=>({outputs:[{dims:o,dataType:n[0].dataType}],dispatchGroup:{x:u*c},programUniforms:m}),getShaderSource:x}:{name:"Gemm",shaderCache:{hint:`${e.cacheKey}`,inputDependencies:y},getRunData:()=>({outputs:[{dims:o,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:m}),getShaderSource:_}},dB=n=>{let e=n.transA,t=n.transB,i=n.alpha,r=n.beta;return{transA:e,transB:t,alpha:i,beta:r,cacheKey:`${n.transA};${n.transB};${n.alpha===1}`}},hB=(n,e)=>{ID(n.inputs),n.compute(CD(n.inputs,e))}}),ua,to,uc,cc,kD,$D,RD,PD,ND,DD,MD,OD,fB,pB,gZ=pe(()=>{Fe(),We(),sn(),qe(),[ua,to,uc,cc]=[0,1,2,3],kD=n=>{if(n[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(n[0].dims.length!==n[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(n[0].dims.length-2!==n[1].dims[n[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${n[0].dims.length-2}`);if(n[0].dims[0]!==n[1].dims[0])throw new Error("grid batch size must match input batch size")},$D=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,RD=n=>`
  fn gs_bicubic_interpolate(p: mat4x4<${n}>, x: f32, y: f32) -> ${n} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${n}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,PD=n=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${n.alignCorners===0?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,ND=n=>`
  ${n.paddingMode==="reflection"?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,DD=(n,e,t)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${e} {
     var pixel = ${e}(0);
     var indices = vec4<u32>(0);
     indices[${ua}] = batch;
     indices[${to}] = channel;`+(()=>{switch(t.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${uc}] = u32(r);
            indices[${cc}] = u32(c);
          } else {
            return ${e}(0);
          }
        `;case"border":return`
          indices[${uc}] = u32(clamp(r, 0, H - 1));
          indices[${cc}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${uc}] = gs_reflect(r, border[1], border[3]);
          indices[${cc}] = gs_reflect(c, border[0], border[2]);
        `;default:throw new Error(`padding mode ${t.paddingMode} is not supported`)}})()+`
    return ${n.getByIndices("indices")};
  }
`,MD=(n,e,t)=>(()=>{switch(t.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${ua}], indices[${to}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${ua}], indices[${to}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${ua}], indices[${to}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${ua}], indices[${to}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${ua}], indices[${to}], border);

          let dx2 = ${e}(f32(x2) - x);
          let dx1 = ${e}(x - f32(x1));
          let dy2 = ${e}(f32(y2) - y);
          let dy1 = ${e}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${e}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${ua}], indices[${to}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw new Error(`mode ${t.mode} is not supported`)}})()+`${n.setByOffset("global_idx","result")}`,OD=(n,e)=>{let t=ae("x",n[0].dataType,n[0].dims.length),i=[n[1].dims[0],n[1].dims[1],n[1].dims[2]],r=ae("grid",n[1].dataType,i.length,2),s=[n[0].dims[0],n[0].dims[1],n[1].dims[1],n[1].dims[2]];e.format==="NHWC"&&(s=[n[0].dims[0],n[1].dims[1],n[1].dims[2],n[0].dims[3]],[ua,to,uc,cc]=[0,3,1,2]);let a=Ie("output",n[0].dataType,s.length),o=t.type.value,l=ie.size(s),u=[{type:12,data:l},...Ne(n[0].dims,i,s)],c=h=>`
  ${h.registerUniform("output_size","u32").declareVariables(t,r,a)}
  ${$D}
  ${RD(o)}
  ${PD(e)}
  ${ND(e)}
  ${DD(t,o,e)}

  ${h.mainStart()}
    ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${uc}]);
      let W_in = i32(uniforms.x_shape[${cc}]);

      ${e.alignCorners===0?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${a.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${ua}], indices[${uc}], indices[${cc}]);
      let nxy = ${r.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${MD(a,o,e)}
  }`;return{name:"GridSample",shaderCache:{hint:`${e.cacheKey}`,inputDependencies:["type","type"]},getRunData:h=>{let f=ie.size(s);return{outputs:[{dims:s,dataType:h[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:u}},getShaderSource:c}},fB=(n,e)=>{kD(n.inputs),n.compute(OD(n.inputs,e))},pB=n=>_t({alignCorners:n.align_corners,mode:n.mode,paddingMode:n.padding_mode,format:n.format})}),Ci,LD,mB,YE,FD,ug,gB,yB=pe(()=>{Fe(),We(),sn(),bC(),AC(),qe(),Hu(),Ci=(n,e)=>n.length>e&&n[e].dims.length>0?n[e]:void 0,LD=(n,e)=>{let t=n[0],i=Ci(n,1),r=Ci(n,2),s=Ci(n,3),a=Ci(n,4),o=Ci(n,5),l=Ci(n,6),u=Ci(n,7);if(t.dims.length!==3&&t.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let c=t.dims[0],h=t.dims[1],f=t.dims.length===3?t.dims[2]:e.numHeads*t.dims[4],m=h,y=0,_=0,x=Math.floor(f/e.numHeads);if(l&&u&&ie.size(l.dims)&&ie.size(u.dims)){if(l.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(l.dims[0]!==c||l.dims[1]!==e.numHeads||l.dims[3]!==x)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(u.dims[0]!==c||u.dims[1]!==e.numHeads||u.dims[3]!==x)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(l.dims[2]!==u.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(u.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');y=l.dims[2],_=l.dims[2]}else if(l&&ie.size(l.dims)||u&&ie.size(u.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let v;if(i&&ie.size(i.dims)>0){if(t.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(i.dims.length<3||i.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(t.dims[0]!==i.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(i.dims.length===3){if(i.dims[2]!==t.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');v=2,m=i.dims[1]}else if(i.dims.length===5){if(i.dims[2]!==e.numHeads||i.dims[3]!==2||i.dims[4]!==x)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(r)throw new Error('Expect "value" be none when "key" has packed kv format.');v=5,m=i.dims[1]}else{if(i.dims[1]!==e.numHeads||i.dims[3]!==x)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');v=0,m=i.dims[2]}}else{if(t.dims.length!==5)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(t.dims[2]!==e.numHeads||t.dims[3]!==3)throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');v=3}if(s&&ie.size(s.dims)>0){if(s.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimension');if(i&&i.dims.length===5&&i.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let w=y+m,E=0;if(a&&ie.size(a.dims)>0){E=8;let I=a.dims;throw I.length===1?I[0]===c?E=1:I[0]===3*c+2&&(E=3):I.length===2&&I[0]===c&&I[1]===w&&(E=5),E===8?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let k=!1,$=f;if(r&&ie.size(r.dims)>0){if(r.dims.length!==3&&r.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(t.dims[0]!==r.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(r.dims.length===3){if(m!==r.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');$=r.dims[2]}else{if(m!==r.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');$=r.dims[1]*r.dims[3],k=!0}}let L=!1;if(a&&ie.size(a.dims)>0)throw new Error("Key padding mask is not supported");if(o&&ie.size(o.dims)>0){if(o.dims.length!==4)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(o.dims[0]!==c||o.dims[1]!==e.numHeads||o.dims[2]!==h||o.dims[3]!==w)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:c,sequenceLength:h,pastSequenceLength:y,kvSequenceLength:m,totalSequenceLength:w,maxSequenceLength:_,inputHiddenSize:0,hiddenSize:f,vHiddenSize:$,headSize:x,vHeadSize:Math.floor($/e.numHeads),numHeads:e.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:e.maskFilterValue,maskType:E,scale:e.scale,broadcastResPosBias:L,passPastInKv:k,qkvFormat:v}},mB=n=>_t({...n}),YE=_t({perm:[0,2,1,3]}),FD=(n,e,t,i,r,s,a)=>{let o=[i,r,s],l=ie.size(o),u=[{type:12,data:l},{type:12,data:a},{type:12,data:s}],c=h=>{let f=Ie("qkv_with_bias",e.dataType,o),m=ae("qkv",e.dataType,o),y=ae("bias",t.dataType,o),_=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${h.registerUniforms(_).declareVariables(m,y,f)}
  ${h.mainStart()}
    ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return n.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:o,dataType:e.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:u}),getShaderSource:c},{inputs:[e,t],outputs:[-1]})[0]},ug=(n,e,t,i,r,s,a,o)=>{let l=s;if(a&&ie.size(a.dims)>0){if(i===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return l=FD(n,s,a,e,i,t*r,o),l=l.reshape([e,i,t,r]),t===1||i===1?l:n.compute(Mr(l,YE.perm),{inputs:[l],outputs:[-1]})[0]}else return s.dims.length===3&&(l=s.reshape([e,i,t,r])),t===1||i===1?l:n.compute(Mr(l,YE.perm),{inputs:[l],outputs:[-1]})[0]},gB=(n,e)=>{let t=LD(n.inputs,e),i=n.inputs[0],r=Ci(n.inputs,1),s=Ci(n.inputs,2),a=Ci(n.inputs,3),o=Ci(n.inputs,4),l=Ci(n.inputs,5),u=Ci(n.inputs,6),c=Ci(n.inputs,7);if(i.dims.length===5)throw new Error("Packed QKV is not implemented");if((r==null?void 0:r.dims.length)===5)throw new Error("Packed KV is not implemented");let h=r&&s&&r.dims.length===4&&s.dims.length===4,f=ug(n,t.batchSize,t.numHeads,t.sequenceLength,t.headSize,i,a,0);if(h)return wy(n,f,r,s,o,void 0,u,c,l,t);if(!r||!s)throw new Error("key and value must be provided");let m=ug(n,t.batchSize,t.numHeads,t.kvSequenceLength,t.headSize,r,a,t.hiddenSize),y=ug(n,t.batchSize,t.numHeads,t.kvSequenceLength,t.vHeadSize,s,a,2*t.hiddenSize);wy(n,f,m,y,o,void 0,u,c,l,t)}}),zD,VD,jD,BD,oS,_B,vB,wB=pe(()=>{Fe(),We(),sn(),qe(),zD=n=>{if(!n||n.length<1)throw new Error("too few inputs")},VD=(n,e)=>{let t=[],i=e.numOutputs;return n[1].dims[0]>0&&(n[1].getBigInt64Array().forEach(r=>t.push(Number(r))),i=t.length),_t({numOutputs:i,axis:e.axis,splitSizes:t})},jD=n=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${n}u; i += 1u ) {
    if (index < ${Pe("uniforms.size_in_split_axis","i",n)}) {
        return i;
    }
    }
    return ${n}u;
}`,BD=n=>{let e=n.length,t=[];for(let i=0;i<e;++i){let r=n[i].setByIndices("indices","input[global_idx]");e===1?t.push(r):i===0?t.push(`if (output_number == ${i}u) { ${r} }`):i===e-1?t.push(`else { ${r} }`):t.push(`else if (output_number == ${i}) { ${r} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${n[0].type.indices}, global_idx: u32) {
        ${t.join(`
`)}
      }`},oS=(n,e)=>{let t=n[0].dims,i=ie.size(t),r=n[0].dataType,s=ie.normalizeAxis(e.axis,t.length),a=new Array(e.numOutputs),o=ae("input",r,t.length),l=new Array(e.numOutputs),u=[],c=[],h=0,f=[{type:12,data:i}];for(let y=0;y<e.numOutputs;y++){h+=e.splitSizes[y],l[y]=h;let _=t.slice();_[s]=e.splitSizes[y],c.push(_),a[y]=Ie(`output${y}`,r,_.length),u.push({dims:c[y],dataType:n[0].dataType})}f.push({type:12,data:l},...Ne(t,...c));let m=y=>`
  ${y.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",l.length).declareVariables(o,...a)}
  ${jD(l.length)}
  ${BD(a)}

  ${y.mainStart()}
    ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${o.offsetToIndices("global_idx")};
    var index = ${o.indicesGet("indices",s)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${Pe("uniforms.size_in_split_axis","output_number - 1u",l.length)};
      ${o.indicesSet("indices",s,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:e.cacheKey,inputDependencies:["rank"]},getShaderSource:m,getRunData:()=>({outputs:u,dispatchGroup:{x:Math.ceil(i/64)},programUniforms:f})}},_B=(n,e)=>{zD(n.inputs);let t=n.inputs.length===1?e:VD(n.inputs,e);n.compute(oS(n.inputs,t),{inputs:[0]})},vB=n=>{let e=n.axis,t=n.splitSizes,i=n.numOutputs<0?t.length:n.numOutputs;if(i!==t.length)throw new Error("numOutputs and splitSizes length must be equal");return _t({axis:e,numOutputs:i,splitSizes:t})}}),UD,Lb,bB,xB=pe(()=>{Fe(),We(),sn(),qe(),UD=(n,e)=>{let[t,i,r,s]=n,{numHeads:a,rotaryEmbeddingDim:o}=e;if(t.dims.length!==3&&t.dims.length!==4)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${t.dims.length}`);if(!ie.areEqual(i.dims,[])&&!ie.areEqual(i.dims,[1])&&i.dims.length!==2)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${i.dims.length}`);if(r.dims.length!==2)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${r.dims.length}`);if(s.dims.length!==2)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${s.dims.length}`);if(!ie.areEqual(r.dims,s.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(o>0&&a===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let l=t.dims[0],u=t.dims[t.dims.length-2],c=r.dims[0],h=ie.sizeFromDimension(t.dims,1)/u,f=o===0?r.dims[1]*2:h/a;if(o>f)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(i.dims.length===2){if(l!==i.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${i.dims[0]}`);if(u!==i.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${i.dims[1]}`)}if(f/2!==r.dims[1]&&o/2!==r.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${r.dims[1]}`);if(u>c)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},Lb=(n,e)=>{let{interleaved:t,numHeads:i,rotaryEmbeddingDim:r,scale:s}=e,a=n[0].dims[0],o=ie.sizeFromDimension(n[0].dims,1),l=n[0].dims[n[0].dims.length-2],u=o/l,c=n[2].dims[1],h=r===0?c*2:u/i,f=new Array(a,l,u/h,h-c),m=ie.computeStrides(f),y=[{type:1,data:s},{type:12,data:f},{type:12,data:m},...n[0].dims.length===3?new Array({type:12,data:[o,u,h,1]}):[],...n[0].dims.length===4?new Array({type:12,data:[o,h,l*h,1]}):[],...Ne(n[0].dims,n[1].dims,n[2].dims,n[3].dims,n[0].dims)],_=x=>{let v=ae("input",n[0].dataType,n[0].dims.length),w=ae("position_ids",n[1].dataType,n[1].dims.length),E=ae("cos_cache",n[2].dataType,n[2].dims.length),k=ae("sin_cache",n[3].dataType,n[3].dims.length),$=Ie("output",n[0].dataType,n[0].dims.length);return x.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:f.length},{name:"global_strides",type:"u32",length:m.length},{name:"input_output_strides",type:"u32",length:m.length}]),`
        ${x.declareVariables(v,w,E,k,$)}

        ${x.mainStart(jp)}
          let half_rotary_emb_dim = uniforms.${E.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${x.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${w.broadcastedIndicesToOffset("bsnh.xy",Ie("",w.type.tensor,2))};
            let position_id =
                u32(${w.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${t});
            let j = i + select(half_rotary_emb_dim, 1, ${t});
            let re = ${v.getByOffset("i")} * ${E.get("position_id","bsnh[3]")} -
                ${v.getByOffset("j")} * ${k.get("position_id","bsnh[3]")};
            ${$.setByOffset("i","re")}
            let im = ${v.getByOffset("i")} * ${k.get("position_id","bsnh[3]")} +
                ${v.getByOffset("j")} * ${E.get("position_id","bsnh[3]")};
            ${$.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${$.setByOffset("k",v.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:_t({interleaved:t}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:_,getRunData:()=>({outputs:[{dims:n[0].dims,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(ie.size(f)/jp)},programUniforms:y})}},bB=(n,e)=>{UD(n.inputs,e),n.compute(Lb(n.inputs,e))}}),HD,WD,XE,qD,EB,yZ=pe(()=>{sn(),Fe(),AC(),yB(),wB(),Hu(),xB(),qe(),HD=(n,e)=>{if(e.doRotary&&n.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let t=n[0],i=n[1],r=n[2],s=n[3],a=n[4];if(e.doRotary!==0&&n.length<=7)throw new Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(e.localWindowSize!==-1)throw new Error("Local attention is not supported");if(e.softcap!==0)throw new Error("Softcap is not supported");if(e.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(e.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(t.dims.length!==3&&t.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let o=!1,l=t.dims[0],u=t.dims[1],c=t.dims.length===3?o?t.dims[2]/3:t.dims[2]:e.numHeads*t.dims[4],h=u,f=0,m=!i||i.dims.length===0,y=Math.floor(m?c/(e.numHeads+2*e.kvNumHeads):c/e.numHeads);m&&(c=y*e.numHeads);let _=s&&s.dims.length!==0,x=a&&a.dims.length!==0;if(_&&s.dims.length===4&&s.dims[0]===l&&s.dims[1]!==e.kvNumHeads&&s.dims[2]===e.kvNumHeads&&s.dims[3]===y)throw new Error("BSNH pastKey/pastValue is not supported");if(_&&x){if(s.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(a.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');f=s.dims[2]}else if(_||x)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let v=1;if(i&&i.dims.length>0){if(t.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(i.dims.length<3||i.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(t.dims[0]!==i.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(i.dims.length===3){if(t.dims[2]%i.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');h=i.dims[1]}else if(i.dims.length===5){if(i.dims[2]!==e.numHeads||i.dims[3]!==2||i.dims[4]!==y)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(r)throw new Error('Expect "value" be none when "key" has packed kv format.');h=i.dims[1]}else{if(i.dims[1]!==e.numHeads||i.dims[3]!==y)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');h=i.dims[2]}}else{if(t.dims.length!==3&&t.dims.length!==5)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(t.dims.length===5&&(t.dims[2]!==e.numHeads||t.dims[3]!==3))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');v=3}let w=0,E=!1,k=e.kvNumHeads?y*e.kvNumHeads:c;if(r&&r.dims.length>0){if(r.dims.length!==3&&r.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(t.dims[0]!==r.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(r.dims.length===3){if(h!==r.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');k=r.dims[2]}else{if(h!==r.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');k=r.dims[1]*r.dims[3],E=!0}}let $=n.length>4?n[5]:void 0;if($&&$.dims.length!==1&&$.dims[0]!==l)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:l,sequenceLength:u,pastSequenceLength:f,kvSequenceLength:h,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:c,vHiddenSize:k,headSize:y,vHeadSize:Math.floor(k/e.kvNumHeads),numHeads:e.numHeads,kvNumHeads:e.kvNumHeads,nReps:e.numHeads/e.kvNumHeads,pastPresentShareBuffer:!1,maskType:w,scale:e.scale,broadcastResPosBias:!1,passPastInKv:E,qkvFormat:v}},WD=_t({perm:[0,2,1,3]}),XE=(n,e,t)=>{let i=e,r=t.kvNumHeads;return e.dims.length===3&&t.kvSequenceLength!==0&&(i=e.reshape([t.batchSize,t.kvSequenceLength,r,t.headSize]),i=n.compute(Mr(i,WD.perm),{inputs:[i],outputs:[-1]})[0]),i},qD=(n,e,t,i)=>{let r=7,s=["type","type"],a=[n*e],o=n*e,l=[{type:12,data:o},{type:12,data:e},{type:12,data:n}],u=c=>{let h=ae("seq_lens",t.dataType,t.dims),f=ae("total_seq_lens",i.dataType,i.dims),m=Ie("pos_ids",r,a),y=[{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}];return`
  ${c.registerUniforms(y).declareVariables(h,f,m)}
  ${c.mainStart()}
    ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let total_sequence_length = u32(${f.getByOffset("0")});
    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;
    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;
    let batch_idx = global_idx / uniforms.sequence_length;
    let sequence_idx = i32(global_idx % uniforms.sequence_length);
    var pos_id: i32 = 0;
    let seqlen = ${h.getByOffset("batch_idx")};
    let total_seqlen = seqlen + 1;
    if (is_first_prompt) {
      if (sequence_idx < total_seqlen) {
        pos_id = sequence_idx;
      } else {
        pos_id = 1;
      }
      ${m.setByOffset("global_idx","pos_id")}
    } else if (is_subsequent_prompt) {
      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);
      if (past_seqlen + sequence_idx < total_seqlen) {
        pos_id = past_seqlen + sequence_idx;
      } else {
        pos_id = 1;
      }
      ${m.setByOffset("global_idx","pos_id")}
    } else if (global_idx < uniforms.batch_size) {
      ${m.setByOffset("global_idx","seqlen")}
    };
  }
  `};return{name:"GeneratePositionIds",shaderCache:{hint:`${n};${e}`,inputDependencies:s},getRunData:()=>({outputs:[{dims:a,dataType:r}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:l}),getShaderSource:u}},EB=(n,e)=>{var k;let t=HD(n.inputs,e);if(n.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(((k=n.inputs[1])==null?void 0:k.dims.length)===5)throw new Error("Packed KV is not implemented");let i=n.inputs[0],r=n.inputs[1]&&n.inputs[1].dims.length>0?n.inputs[1]:void 0,s=n.inputs[2]&&n.inputs[2].dims.length>0?n.inputs[2]:void 0,a=n.inputs[3]&&n.inputs[3].dims.length!==0?n.inputs[3]:void 0,o=n.inputs[4]&&n.inputs[4].dims.length!==0?n.inputs[4]:void 0,l=n.inputs.length>4?n.inputs[5]:void 0,u=n.inputs.length>5?n.inputs[6]:void 0,c=t.kvNumHeads?t.kvNumHeads:t.numHeads,h=_t({axis:2,numOutputs:3,splitSizes:[t.numHeads*t.headSize,c*t.headSize,c*t.headSize]}),[f,m,y]=!r&&!s?n.compute(oS([i],h),{inputs:[i],outputs:[-1,-1,-1]}):[i,r,s],_,x;if(e.doRotary){let $=n.compute(qD(t.batchSize,t.sequenceLength,l,u),{inputs:[l,u],outputs:[-1]})[0],L=n.inputs[7],I=n.inputs[8],C=_t({interleaved:e.rotaryInterleaved!==0,numHeads:t.numHeads,rotaryEmbeddingDim:0,scale:e.scale}),N=[f,$,L,I],O=[-1];_=n.compute(Lb(N,C),{inputs:N,outputs:O})[0],N.splice(0,1,m);let V=_t({interleaved:e.rotaryInterleaved!==0,numHeads:t.kvNumHeads,rotaryEmbeddingDim:0,scale:e.scale});x=n.compute(Lb(N,V),{inputs:N,outputs:O})[0]}let v=ug(n,t.batchSize,t.numHeads,t.sequenceLength,t.headSize,e.doRotary?_:f,void 0,0),w=XE(n,e.doRotary?x:m,t),E=XE(n,y,t);wy(n,v,w,E,void 0,void 0,a,o,void 0,t,l,u)}}),QE,GD,KD,AB,_Z=pe(()=>{Fe(),We(),Hu(),qe(),QE=(n,e,t,i,r,s,a,o)=>{let l=Yt(s),u=l===1?"f32":`vec${l}f`,c=l===1?"vec2f":`mat2x${l}f`,h=r*a,f=64;h===1&&(f=256);let m=[r,a,s/l],y=[r,a,2],_=["rank","type","type"],x=[];x.push(...Ne(m,y));let v=w=>{let E=ae("x",e.dataType,3,l),k=ae("scale",t.dataType,t.dims),$=ae("bias",i.dataType,i.dims),L=Ie("output",1,3,2),I=[E,k,$,L];return`
  var<workgroup> workgroup_shared : array<${c}, ${f}>;
  const workgroup_size = ${f}u;
  ${w.declareVariables(...I)}
  ${w.mainStart(f)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${u}(0);
    var squared_sum = ${u}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${u}(${E.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${c}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${Pu("workgroup_shared[0][0]",l)} / f32(hight * ${l});
      let squared_sum_final = ${Pu("workgroup_shared[0][1]",l)} / f32(hight * ${l});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${o}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return n.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${l};${o};${f}`,inputDependencies:_},getRunData:()=>({outputs:[{dims:y,dataType:1}],dispatchGroup:{x:h},programUniforms:x}),getShaderSource:v},{inputs:[e,t,i],outputs:[-1]})[0]},GD=(n,e,t)=>{let i=e[0].dims,r=i,s=2,a=i[0],o=i[1],l=ie.sizeFromDimension(i,s),u=Yt(l),c=ie.size(r)/u,h=QE(n,e[0],e[1],e[2],a,l,o,t.epsilon),f=[a,o,l/u],m=[a,o],y=["type","none"],_=x=>{let v=ae("x",e[0].dataType,f.length,u),w=ae("scale_shift",1,m.length,2),E=Ie("output",e[0].dataType,f.length,u),k=[v,w,E];return`
  ${x.registerUniform("output_size","u32").declareVariables(...k)}
  ${x.mainStart()}
  ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${E.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${w.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${v.getByOffset("global_idx")} * ${E.type.value}(scale_shift.x) + ${E.type.value}(scale_shift.y);
      ${E.setByOffset("global_idx","value")};
  }`};n.compute({name:"InstanceNormalization",shaderCache:{hint:`${u}`,inputDependencies:y},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:[{type:12,data:c},...Ne(f,m,f)]}),getShaderSource:_},{inputs:[e[0],h]})},KD=(n,e,t)=>{let i=e[0].dims,r=i,s=i[0],a=i[i.length-1],o=ie.sizeFromDimension(i,1)/a,l=Yt(a),u=ie.size(r)/l,c=[{type:12,data:o},{type:12,data:Math.floor(a/l)}],h=["type","type"],f=!1,m=[0,i.length-1];for(let v=0;v<i.length-2;v++)f=f||i[v+1]!==1,m.push(v+1);f=f&&i[i.length-1]!==1;let y=f?n.compute(Mr(n.inputs[0],m),{inputs:[n.inputs[0]],outputs:[-1]})[0]:n.inputs[0].reshape(Array.from({length:i.length},(v,w)=>i[m[w]])),_=QE(n,y,e[1],e[2],s,o,a,t.epsilon),x=v=>{let w=Pn(e[0].dataType),E=l===1?"vec2f":`mat${l}x2f`,k=I=>{let C=I===0?"x":"y",N=l===1?"f32":`vec${l}f`;switch(l){case 1:return`${w}(${N}(scale.${C}))`;case 2:return`vec2<${w}>(${N}(scale[0].${C}, scale[1].${C}))`;case 4:return`vec4<${w}>(${N}(scale[0].${C}, scale[1].${C}, scale[2].${C}, scale[3].${C}))`;default:throw new Error(`Not supported compoents ${l}`)}},$=ae("input",e[0].dataType,e[0].dims,l),L=Ie("output",e[0].dataType,r,l);return`
  @group(0) @binding(0) var<storage, read> input : array<${$.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${E}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${L.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${v.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${k(0)}, ${k(1)});
  }`};n.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${l}`,inputDependencies:h},getRunData:()=>({outputs:[{dims:r,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:c}),getShaderSource:x},{inputs:[e[0],_]})},AB=(n,e)=>{e.format==="NHWC"?KD(n,n.inputs,e):GD(n,n.inputs,e)}}),YD,XD,TB,vZ=pe(()=>{Fe(),We(),qe(),YD=n=>{if(!n||n.length<2)throw new Error("layerNorm requires at least 2 inputs.")},XD=(n,e,t)=>{let i=e.simplified,r=n[0].dims,s=n[1],a=!i&&n[2],o=r,l=ie.normalizeAxis(e.axis,r.length),u=ie.sizeToDimension(r,l),c=ie.sizeFromDimension(r,l),h=ie.size(s.dims),f=a?ie.size(a.dims):0;if(h!==c||a&&f!==c)throw new Error(`Size of X.shape()[axis:] == ${c}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${h} and bias size of ${f}`);let m=[];for(let $=0;$<r.length;++$)$<l?m.push(r[$]):m.push(1);let y=Yt(c),_=["type","type"],x=[{type:12,data:u},{type:1,data:c},{type:12,data:Math.floor(c/y)},{type:1,data:e.epsilon}];a&&_.push("type");let v=t>1,w=t>2,E=$=>{let L=Pn(n[0].dataType),I=[ae("x",n[0].dataType,n[0].dims,y),ae("scale",s.dataType,s.dims,y)];a&&I.push(ae("bias",a.dataType,a.dims,y)),I.push(Ie("output",n[0].dataType,o,y)),v&&I.push(Ie("mean_data_output",1,m)),w&&I.push(Ie("inv_std_output",1,m));let C=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${$.registerUniforms(C).declareVariables(...I)}
  ${$.mainStart()}
    ${$.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${JT("f32",y)};
    var mean_square_vector = ${JT("f32",y)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${sf(L,y,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${Pu("mean_vector",y)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${Pu("mean_square_vector",y)} / uniforms.norm_size ${i?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${sf(L,y,"x[j + offset]")};
      let f32scale = ${sf(L,y,"scale[j]")};
      output[j + offset] = ${I[0].type.value}((f32input ${i?"":"- mean"}) * inv_std_dev * f32scale
        ${a?`+ ${sf(L,y,"bias[j]")}`:""}
      );
    }

    ${v?"mean_data_output[global_idx] = mean":""};
    ${w?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},k=[{dims:o,dataType:n[0].dataType}];return v&&k.push({dims:m,dataType:1}),w&&k.push({dims:m,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${y};${t};${i}`,inputDependencies:_},getRunData:()=>({outputs:k,dispatchGroup:{x:Math.ceil(u/64)},programUniforms:x}),getShaderSource:E}},TB=(n,e)=>{YD(n.inputs),n.compute(XD(n.inputs,e,n.outputCount))}}),QD,SB,wZ=pe(()=>{We(),kC(),$C(),QD=n=>{if(!n||n.length!==2)throw new Error("MatMul requires 2 inputs.");if(n[0].dims[n[0].dims.length-1]!==n[1].dims[n[1].dims.length-2])throw new Error("shared dimension does not match.")},SB=n=>{QD(n.inputs);let e=Vp.calcShape(n.inputs[0].dims,n.inputs[1].dims,!0);if(!e)throw new Error("Can't use matmul on the given tensors");let t=e[e.length-1],i=n.inputs[0].dims[n.inputs[0].dims.length-1];if(t<8&&i<8)n.compute(CC(n.inputs,{activation:""},e));else{let r=e[e.length-2],s=ie.size(n.inputs[0].dims.slice(0,-2)),a=ie.size(n.inputs[1].dims.slice(0,-2));if(s!==1&&r===1&&a===1){let o=n.inputs[0].reshape([1,s,i]),l=n.inputs[1].reshape([1,i,t]),u=[1,s,t],c=[o,l];n.compute(Ob(c,{activation:""},e,u),{inputs:c})}else n.compute(Ob(n.inputs,{activation:""},e))}}}),JD,ZD,eM,IB,CB,bZ=pe(()=>{Fe(),We(),sn(),qe(),JD=(n,e)=>{if(n.length<3||n.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let t=n[0],i=t.dims.length;if(t.dims[i-1]!==e.k)throw new Error("The last dim of input shape does not match the k value");let r=Math.floor((e.k+e.blockSize-1)/e.blockSize),s=e.blockSize/8*e.bits,a=n[1];if(!ie.areEqual(a.dims,[e.n,r,s]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let o=n[2].dims;if(ie.size(o)!==e.n*r)throw new Error("scales input size error.");if(n.length===4){let l=n[3].dims,u=e.n*(e.bits===8?r:Math.floor((r*e.bits+7)/8));if(ie.size(l)!==u)throw new Error("zeroPoints input size error.")}},ZD=(n,e)=>{let t=n[0].dims,i=t.length,r=t[i-2],s=e.k,a=e.n,o=t.slice(0,i-2),l=ie.size(o),u=n[1].dims[2]/4,c=n[0].dataType,h=Yt(e.k),f=Yt(u),m=Yt(a),y=o.concat([r,a]),_=r>1&&a/m%2===0?2:1,x=ie.size(y)/m/_,v=64,w=[],E=[l,r,s/h],k=ie.convertShape(n[1].dims).slice();k.splice(-1,1,u/f),w.push(...Ne(E)),w.push(...Ne(k)),w.push(...Ne(n[2].dims)),n.length===4&&w.push(...Ne(ie.convertShape(n[3].dims)));let $=[l,r,a/m];w.push(...Ne($));let L=I=>{let C=E.length,N=ae("a",n[0].dataType,C,h),O=ae("b",12,k.length,f),V=ae("scales",n[2].dataType,n[2].dims.length),U=[N,O,V],j=n.length===4?ae("zero_points",12,n[3].dims.length):void 0;j&&U.push(j);let he=$.length,me=Ie("output",n[0].dataType,he,m),te=Pn(n[0].dataType),oe=(()=>{switch(h){case 1:return`array<${te}, 8>`;case 2:return`mat4x2<${te}>`;case 4:return`mat2x4<${te}>`;default:throw new Error(`${h}-component is not supported.`)}})(),G=()=>{let H=`
          // reuse a data
            var input_offset = ${N.indicesToOffset(`${N.type.indices}(batch, row, word_offset)`)};
            var a_data: ${oe};
            for (var j: u32 = 0; j < ${8/h}; j++) {
              a_data[j] = ${N.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let Q=0;Q<m*_;Q++)H+=`
            b_value = ${f===1?`b${Q}_data`:`b${Q}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${oe}(${Array.from({length:4},(Y,Z)=>`${te}(b_value_lower[${Z}]), ${te}(b_value_upper[${Z}])`).join(", ")});
            b_dequantized_values = ${h===1?`${oe}(${Array.from({length:8},(Y,Z)=>`(b_quantized_values[${Z}] - ${j?`zero_point${Q}`:"zero_point"}) * scale${Q}`).join(", ")});`:`(b_quantized_values - ${oe}(${Array(8).fill(`${j?`zero_point${Q}`:"zero_point"}`).join(",")})) * scale${Q};`};
            workgroup_shared[local_id.x * ${_} + ${Math.floor(Q/m)}]${m>1?`[${Q%m}]`:""} += ${Array.from({length:8/h},(Y,Z)=>`${h===1?`a_data[${Z}] * b_dequantized_values[${Z}]`:`dot(a_data[${Z}], b_dequantized_values[${Z}])`}`).join(" + ")};
          `;return H},W=()=>{let H=`
            var col_index = col * ${m};
            ${j?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${te}(8);`}
            `;for(let Q=0;Q<m*_;Q++)H+=`
            let scale${Q} = ${V.getByOffset("col_index * nBlocksPerCol + block")};
            ${j?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${j.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${Q} = ${te}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return H},K=()=>{let H=`col_index = col * ${m};`;for(let Q=0;Q<m*_;Q++)H+=`
            let b${Q}_data = ${O.getByIndices(`${O.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return H+=`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${oe};
            var b_dequantized_values: ${oe};`,H};return`
        var<workgroup> workgroup_shared: array<${me.type.value}, ${_*v}>;
        ${I.declareVariables(...U,me)}
        ${I.mainStart([v,1,1])}
          let output_indices = ${me.offsetToIndices(`(global_idx / ${v}) * ${_}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${v}) {
            //process one block
            var word_offset: u32 = block * ${e.blockSize/h};
            ${W()}
            for (var word: u32 = 0; word < ${u}; word += ${f}) {
              ${K()}
              for (var i: u32 = 0; i < ${f}; i++) {
                ${G()}
                word_offset += ${8/h};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${_}) {
            var output_value: ${me.type.value} = ${me.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${v}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${_};
            }
            ${me.setByIndices(`${me.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${e.blockSize};${e.bits};${h};${f};${m};${_};${v}`,inputDependencies:Array(n.length).fill("rank")},getRunData:()=>({outputs:[{dims:y,dataType:c}],dispatchGroup:{x},programUniforms:w}),getShaderSource:L}},eM=(n,e)=>{let t=n[0].dims,i=t.length,r=t[i-2],s=e.k,a=e.n,o=t.slice(0,i-2),l=ie.size(o),u=n[1].dims[2]/4,c=n[0].dataType,h=Yt(e.k),f=Yt(u),m=o.concat([r,a]),y=128,_=a%8===0?8:a%4===0?4:1,x=y/_,v=x*f*8,w=v/h,E=v/e.blockSize,k=ie.size(m)/_,$=[],L=[l,r,s/h],I=ie.convertShape(n[1].dims).slice();I.splice(-1,1,u/f),$.push(...Ne(L)),$.push(...Ne(I)),$.push(...Ne(n[2].dims)),n.length===4&&$.push(...Ne(ie.convertShape(n[3].dims)));let C=[l,r,a];$.push(...Ne(C));let N=O=>{let V=L.length,U=ae("a",n[0].dataType,V,h),j=ae("b",12,I.length,f),he=ae("scales",n[2].dataType,n[2].dims.length),me=[U,j,he],te=n.length===4?ae("zero_points",12,n[3].dims.length):void 0;te&&me.push(te);let oe=C.length,G=Ie("output",n[0].dataType,oe),W=Pn(n[0].dataType),K=()=>{switch(h){case 1:return`
          let a_data0 = vec4<${W}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${W}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${W}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${W}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${h}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${U.type.value}, ${w}>;
        var<workgroup> inter_results: array<array<${G.type.value}, ${x}>, ${_}>;
        ${O.declareVariables(...me,G)}
        ${O.mainStart([x,_,1])}
          let output_indices = ${G.offsetToIndices(`workgroup_index * ${_}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${E} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${w};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${w}; a_offset += ${y})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${U.getByIndices(`${U.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${U.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${E} + local_id.x;
            ${te?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${te.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${W}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${W}(8);`}
            let scale = ${he.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${j.getByIndices(`${j.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${e.blockSize/h};
            for (var i: u32 = 0; i < ${f}; i++) {
              ${K()}
              let b_value = ${f===1?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${W}>(${Array.from({length:4},(H,Q)=>`${W}(b_value_lower[${Q}]), ${W}(b_value_upper[${Q}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${W}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(H,Q)=>`${`dot(a_data${Q}, b_dequantized_values[${Q}])`}`).join(" + ")};
              word_offset += ${8/h};
            }
            workgroupBarrier();
          }

          if (local_idx < ${_}) {
            var output_value: ${G.type.value} = ${G.type.value}(0);
            for (var b = 0u; b < ${x}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${G.setByIndices(`${G.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${e.blockSize};${h};${f};${x};${_}`,inputDependencies:Array(n.length).fill("rank")},getRunData:()=>({outputs:[{dims:m,dataType:c}],dispatchGroup:{x:k},programUniforms:$}),getShaderSource:N}},IB=(n,e)=>{JD(n.inputs,e),e.blockSize===32&&n.adapterInfo.isVendor("intel")&&n.adapterInfo.isArchitecture("gen-12lp")?n.compute(eM(n.inputs,e)):n.compute(ZD(n.inputs,e))},CB=n=>_t(n)}),tM,nM,iM,rM,sM,aM,oM,lM,kB,xZ=pe(()=>{Fe(),We(),qe(),tM=n=>{if(!n||n.length<1)throw new Error("Too few inputs");if(n[0].dataType!==1&&n[0].dataType!==10)throw new Error("Input type must be float or float16.");if(n.length>=2){let e=n[0].dims.length*2===n[1].dims[0];if(n.length===4&&(e=n[3].dims[0]*2===n[1].dims[0]),!e)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},nM=(n,e,t)=>{let i="";for(let r=e-1;r>=0;--r)i+=`
            k = i32(${n.indicesGet("indices",r)}) - ${Pe("uniforms.pads",r,t)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${Pe("uniforms.x_shape",r,e)})) {
              break;
            }
            offset += k * i32(${Pe("uniforms.x_strides",r,e)});
        `;return`
          value = ${n.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${i}
            value = x[offset];
          }
      `},iM=(n,e,t)=>{let i="";for(let r=e-1;r>=0;--r)i+=`
                k = i32(${n.indicesGet("indices",r)}) - ${Pe("uniforms.pads",r,t)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${Pe("uniforms.x_shape",r,e)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${Pe("uniforms.x_shape",r,e)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${Pe("uniforms.x_strides",r,e)});
            `;return`
              var offset = 0;
              var k = 0;
              ${i}
              value = x[offset];
          `},rM=(n,e,t)=>{let i="";for(let r=e-1;r>=0;--r)i+=`
                k = i32(${n.indicesGet("indices",r)}) - ${Pe("uniforms.pads",r,t)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${Pe("uniforms.x_shape",r,e)})) {
                  k = i32(${Pe("uniforms.x_shape",r,e)}) - 1;
                }
                offset += k * i32(${Pe("uniforms.x_strides",r,e)});
            `;return`
              var offset = 0;
              var k = 0;
              ${i}
              value = x[offset];
          `},sM=(n,e,t)=>{let i="";for(let r=e-1;r>=0;--r)i+=`
                k = i32(${n.indicesGet("indices",r)}) - ${Pe("uniforms.pads",r,t)};
                if (k < 0)  {
                  k += i32(${Pe("uniforms.x_shape",r,e)}]);
                }
                if (k >= i32(${Pe("uniforms.x_shape",r,e)})) {
                  k -= i32(${Pe("uniforms.x_shape",r,e)});
                }
                offset += k * i32(${Pe("uniforms.x_strides",r,e)});
            `;return`
              var offset = 0;
              var k = 0;
              ${i}
              value = x[offset];
          `},aM=(n,e,t)=>{switch(t.mode){case 0:return nM(n,e,t.pads.length);case 1:return iM(n,e,t.pads.length);case 2:return rM(n,e,t.pads.length);case 3:return sM(n,e,t.pads.length);default:throw new Error("Invalid mode")}},oM=(n,e)=>{let t=ie.padShape(n[0].dims.slice(),e.pads),i=n[0].dims,r=ie.size(t),s=[{type:12,data:r},{type:6,data:e.pads}],a=n.length>=3&&n[2].data;e.mode===0&&s.push({type:a?n[2].dataType:1,data:e.value}),s.push(...Ne(n[0].dims,t));let o=["rank"],l=u=>{let c=Ie("output",n[0].dataType,t.length),h=ae("x",n[0].dataType,i.length),f=h.type.value,m=aM(c,i.length,e),y=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:e.pads.length}];return e.mode===0&&y.push({name:"constant_value",type:a?f:"f32"}),`
            ${u.registerUniforms(y).declareVariables(h,c)}
            ${u.mainStart()}
            ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${c.offsetToIndices("global_idx")};

            var value = ${f}(0);
            ${m}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${e.mode}${a}`,inputDependencies:o},getRunData:()=>({outputs:[{dims:t,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(ie.size(t)/64)},programUniforms:s}),getShaderSource:l}},lM=(n,e)=>{if(n.length>1){let t=n[1].getBigInt64Array(),i=n.length>=3&&n[2].data?n[2].dataType===10?n[2].getUint16Array()[0]:n[2].getFloat32Array()[0]:0,r=n[0].dims.length,s=new Int32Array(2*r).fill(0);if(n.length>=4){let o=n[3].getBigInt64Array();for(let l=0;l<o.length;l++)s[Number(o[l])]=Number(t[l]),s[Number(o[l])+r]=Number(t[l+o.length])}else t.forEach((o,l)=>s[Number(l)]=Number(o));let a=[];return s.forEach(o=>a.push(o)),{mode:e.mode,value:i,pads:a}}else return e},kB=(n,e)=>{tM(n.inputs);let t=lM(n.inputs,e);n.compute(oM(n.inputs,t),{inputs:[0]})}}),jm,JE,ZE,eA,tA,uM,cM,nA,iA,$B,RB,rA,PB,NB,sA,DB,MB,OB,LB,EZ=pe(()=>{os(),Fe(),We(),qe(),jm=n=>{if(Lt.webgpu.validateInputContent&&(!n||n.length!==1))throw new Error("Pool ops requires 1 input.")},JE=(n,e,t)=>{let i=e.format==="NHWC",r=n.dims.slice();i&&r.splice(1,0,r.pop());let s=Object.hasOwnProperty.call(e,"dilations"),a=e.kernelShape.slice(),o=e.strides.slice(),l=s?e.dilations.slice():[],u=e.pads.slice();Db.adjustPoolAttributes(t,r,a,o,l,u);let c=Db.computePoolOutputShape(t,r,o,l,a,u,e.autoPad),h=Object.assign({},e);s?Object.assign(h,{kernelShape:a,strides:o,pads:u,dilations:l,cacheKey:e.cacheKey}):Object.assign(h,{kernelShape:a,strides:o,pads:u,cacheKey:e.cacheKey});let f=c.slice();return f.push(f.splice(1,1)[0]),[h,i?f:c]},ZE=(n,e)=>{let t=e.format==="NHWC",i=ie.size(n),r=ie.size(e.kernelShape),s=[{type:12,data:i},{type:12,data:r}],a=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(e.kernelShape.length<=2){let o=e.kernelShape[e.kernelShape.length-1],l=e.strides[e.strides.length-1],u=e.pads[e.pads.length/2-1],c=e.pads[e.pads.length-1],h=!!(u+c);s.push({type:12,data:o},{type:12,data:l},{type:12,data:u},{type:12,data:c}),a.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let f=!1;if(e.kernelShape.length===2){let m=e.kernelShape[e.kernelShape.length-2],y=e.strides[e.strides.length-2],_=e.pads[e.pads.length/2-2],x=e.pads[e.pads.length-2];f=!!(_+x),s.push({type:12,data:m},{type:12,data:y},{type:12,data:_},{type:12,data:x}),a.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[s,a,!0,h,f]}else{if(t)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let o=ie.computeStrides(e.kernelShape);s.push({type:12,data:o},{type:12,data:e.pads},{type:12,data:e.strides}),a.push({name:"kernelStrides",type:"u32",length:o.length},{name:"pads",type:"u32",length:e.pads.length},{name:"strides",type:"u32",length:e.strides.length});let l=e.pads.reduce((u,c)=>u+c);return[s,a,!!l,!1,!1]}},eA=(n,e,t,i,r,s,a,o,l,u,c,h)=>{let f=r.format==="NHWC",m=e.type.value,y=Ie("output",e.type.tensor,i);if(r.kernelShape.length<=2){let _="",x="",v="",w=t-(f?2:1);if(c?_=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${w}] = indices[${w}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${w}] < 0 || xIndices[${w}]
                      >= uniforms.x_shape[${w}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${e.indicesToOffset("xIndices")}];
                  ${s}
                }`:_=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${w}] = indices[${w}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${e.indicesToOffset("xIndices")}];
                  ${s}
                }`,r.kernelShape.length===2){let E=t-(f?3:2);h?x=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${E}] = indices[${E}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${E}] < 0 || xIndices[${E}] >= uniforms.x_shape[${E}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:x=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${E}] = indices[${E}] * uniforms.sh - uniforms.phStart + j;
                `,v=`
              }
            `}return`
            ${n.registerUniforms(l).declareVariables(e,y)}

            ${n.mainStart()}
              ${n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${y.offsetToIndices("global_idx")};
              var xIndices = ${y.offsetToIndices("global_idx")};

              var value = ${m}(${o});
              var pad = 0;
              ${x}
              ${_}
              ${v}
              ${a}

              output[global_idx] = value;
            }`}else{if(f)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let _=r.kernelShape.length,x=r.pads.length,v="";return u?v=`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${e.indicesToOffset("xIndices")}];
                ${s}
              }`:v=`
              }
              let x_val = x[${e.indicesToOffset("xIndices")}];
              ${s}
            `,`
            ${n.registerUniforms(l).declareVariables(e,y)}

            ${n.mainStart()}
              ${n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${y.offsetToIndices("global_idx")};
              var xIndices = ${y.offsetToIndices("global_idx")};

              var offsets: array<u32, ${_}>;

              var value = ${m}(${o});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${_-1}u; j++) {
                  offsets[j] = offset / ${Pe("uniforms.kernelStrides","j",_)};
                  offset -= offsets[j] * ${Pe("uniforms.kernelStrides","j",_)};
                }
                offsets[${_-1}] = offset;

                isPad = false;
                for (var j = ${t-_}u; j < ${t}u; j++) {
                  xIndices[j] = indices[j] * ${Pe("uniforms.strides",`j - ${t-_}u`,_)}
                    + offsets[j - ${t-_}u] - ${Pe("uniforms.pads","j - 2u",x)};
                  ${v}
              }
              ${a}

              output[global_idx] = value;
            }`}},tA=n=>`${n.format};${n.ceilMode};${n.autoPad};${n.kernelShape.length}`,uM=n=>`${tA(n)};${n.countIncludePad}`,cM=n=>`${tA(n)};${n.storageOrder};${n.dilations}`,nA=n=>({format:n.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][n.auto_pad],ceilMode:n.ceil_mode,kernelShape:n.kernel_shape,strides:n.strides,pads:n.pads}),iA=(n,e,t,i)=>{let[r,s]=JE(e,i,t),a=ae("x",e.dataType,e.dims.length),o=a.type.value,l="value += x_val;",u="";r.countIncludePad?u+=`value /= ${o}(uniforms.kernelSize);`:u+=`value /= ${o}(i32(uniforms.kernelSize) - pad);`;let[c,h,f,m,y]=ZE(s,r);c.push(...Ne(e.dims,s));let _=["rank"];return{name:n,shaderCache:{hint:`${i.cacheKey};${f};${m};${y}`,inputDependencies:_},getRunData:()=>({outputs:[{dims:s,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(ie.size(s)/64)},programUniforms:c}),getShaderSource:x=>eA(x,a,e.dims.length,s.length,r,l,u,0,h,f,m,y)}},$B=n=>{let e=n.count_include_pad!==0,t=nA(n);if(t.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let i={countIncludePad:e,...t,cacheKey:""};return{...i,cacheKey:uM(i)}},RB=(n,e)=>{jm(n.inputs),n.compute(iA("AveragePool",n.inputs[0],!1,e))},rA={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},PB=n=>{let e=n.format;return{format:e,...rA,cacheKey:e}},NB=(n,e)=>{jm(n.inputs),n.compute(iA("GlobalAveragePool",n.inputs[0],!0,e))},sA=(n,e,t,i)=>{let[r,s]=JE(e,i,t),a=`
      value = max(x_val, value);
    `,o="",l=ae("x",e.dataType,e.dims.length),u=["rank"],[c,h,f,m,y]=ZE(s,r);return c.push(...Ne(e.dims,s)),{name:n,shaderCache:{hint:`${i.cacheKey};${f};${m};${y}`,inputDependencies:u},getRunData:()=>({outputs:[{dims:s,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(ie.size(s)/64)},programUniforms:c}),getShaderSource:_=>eA(_,l,e.dims.length,s.length,r,a,o,e.dataType===10?-65504:-1e5,h,f,m,y)}},DB=(n,e)=>{jm(n.inputs),n.compute(sA("MaxPool",n.inputs[0],!1,e))},MB=n=>{let e=n.storage_order,t=n.dilations,i=nA(n);if(e!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(i.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let r={storageOrder:e,dilations:t,...i,cacheKey:""};return{...r,cacheKey:cM(r)}},OB=n=>{let e=n.format;return{format:e,...rA,cacheKey:e}},LB=(n,e)=>{jm(n.inputs),n.compute(sA("GlobalMaxPool",n.inputs[0],!0,e))}}),dM,hM,FB,zB,AZ=pe(()=>{Fe(),We(),sn(),qe(),dM=(n,e)=>{if(n.length<2||n.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(n.length===3&&n[1].dims===n[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(n.length===3&&n[0].dataType!==n[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(n[0].dataType===6&&n.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(n[1].dims.length!==0&&n[1].dims.length!==1&&n[1].dims.length!==n[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(n.length>2){if(n[0].dataType!==n[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(n[1].dims.length!==n[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!n[1].dims.map((t,i)=>t===n[2].dims[i]).reduce((t,i)=>t&&i,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(e.blockSize>0){if(n[1].dims.length===0||n[1].dims.length===1&&n[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!n[1].dims.map((r,s)=>s===e.axis||r===n[0].dims[s]).reduce((r,s)=>r&&s,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(n[1].dims.length!==n[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let t=n[0].dims[e.axis],i=n[1].dims[e.axis];if(e.blockSize<Math.ceil(t/i)||e.blockSize>Math.ceil(t/(i-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},hM=(n,e)=>{let t=ie.normalizeAxis(e.axis,n[0].dims.length),i=n[0].dataType,r=i===3,s=n[0].dims,a=n[1].dataType,o=ie.size(s),l=i===3||i===2,u=l?[Math.ceil(ie.size(n[0].dims)/4)]:n[0].dims,c=n[1].dims,h=n.length>2?n[2]:void 0,f=h?l?[Math.ceil(ie.size(h.dims)/4)]:h.dims:void 0,m=c.length===0||c.length===1&&c[0]===1,y=m===!1&&c.length===1,_=Yt(o),x=m&&(!l||_===4),v=x?_:1,w=x&&!l?_:1,E=ae("input",l?12:i,u.length,w),k=ae("scale",a,c.length),$=h?ae("zero_point",l?12:i,f.length):void 0,L=Ie("output",a,s.length,v),I=[E,k];$&&I.push($);let C=[u,c];h&&C.push(f);let N=[{type:12,data:o/v},{type:12,data:t},{type:12,data:e.blockSize},...Ne(...C,s)],O=V=>{let U=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${V.registerUniforms(U).declareVariables(...I,L)}
      ${V.mainStart()}
          ${V.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${L.offsetToIndices("global_idx")};

          // Set input x
          ${l?`
            let input = ${E.getByOffset("global_idx / 4")};
            let x_vec = ${r?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${v===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${E.getByOffset("global_idx")};`};

          // Set scale input
          ${m?`let scale_value= ${k.getByOffset("0")}`:y?`
            let scale_index = ${L.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${k.getByOffset("scale_index")};`:`
            var scale_indices: ${k.type.indices} = output_indices;
            let index = ${k.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${k.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${k.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${$?m?l?`
                let zero_point_input = ${$.getByOffset("0")};
                let zero_point_vec =  ${r?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${$.getByOffset("0")}`:y?l?`
                let zero_point_index = ${L.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${$.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${r?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${L.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${$.getByOffset("zero_point_index")};`:l?`
                let zero_point_offset = ${k.indicesToOffset("scale_indices")};
                let zero_point_input = ${$.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${r?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${$.getByIndices("scale_indices")};`:`let zero_point_value = ${l?r?"i32":"u32":E.type.value}(0);`};
      // Compute and write output
      ${L.setByOffset("global_idx",`${L.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:e.cacheKey,inputDependencies:$?["rank","rank","rank"]:["rank","rank"]},getShaderSource:O,getRunData:()=>({outputs:[{dims:s,dataType:a}],dispatchGroup:{x:Math.ceil(o/v/64),y:1,z:1},programUniforms:N})}},FB=(n,e)=>{dM(n.inputs,e),n.compute(hM(n.inputs,e))},zB=n=>_t({axis:n.axis,blockSize:n.blockSize})}),fM,pM,VB,TZ=pe(()=>{os(),Fe(),qe(),fM=(n,e,t)=>{let i=n===e,r=n<e&&t<0,s=n>e&&t>0;if(i||r||s)throw new Error("Range these inputs' contents are invalid.")},pM=(n,e,t,i)=>{let r=Math.abs(Math.ceil((e-n)/t)),s=[r],a=r,o=[{type:12,data:a},{type:i,data:n},{type:i,data:t},...Ne(s)],l=u=>{let c=Ie("output",i,s.length),h=c.type.value,f=[{name:"outputSize",type:"u32"},{name:"start",type:h},{name:"delta",type:h}];return`
        ${u.registerUniforms(f).declareVariables(c)}
        ${u.mainStart()}
        ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${h}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${i}`},getShaderSource:l,getRunData:()=>({outputs:[{dims:s,dataType:i}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:o})}},VB=n=>{let e=0,t=0,i=0;n.inputs[0].dataType===6?(e=n.inputs[0].getInt32Array()[0],t=n.inputs[1].getInt32Array()[0],i=n.inputs[2].getInt32Array()[0]):n.inputs[0].dataType===1&&(e=n.inputs[0].getFloat32Array()[0],t=n.inputs[1].getFloat32Array()[0],i=n.inputs[2].getFloat32Array()[0]),Lt.webgpu.validateInputContent&&fM(e,t,i),n.compute(pM(e,t,i,n.inputs[0].dataType),{inputs:[]})}}),mM,gM,jB,BB,SZ=pe(()=>{Fe(),We(),sn(),qe(),mM=(n,e,t,i)=>{if(n!=="none"&&i!=="i32"&&i!=="u32"&&i!=="f32")throw new Error(`Input ${i} is not supported with reduction ${n}.`);let r=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,s=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${e}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(n){case"none":return`${e}=${t};`;case"add":return i==="i32"||i==="u32"?`atomicAdd(&${e}, bitcast<${i}>(${t}));`:`
              ${r}bitcast<${i}>(oldValue) + (${t})${s}`;case"max":return i==="i32"||i==="u32"?`atomicMax(&${e}, bitcast<${i}>(${t}));`:`
                ${r}max(bitcast<f32>(oldValue), (${t}))${s}`;case"min":return i==="i32"||i==="u32"?`atomicMin(&${e}, bitcast<${i}>(${t}));`:`${r}min(bitcast<${i}>(oldValue), (${t}))${s}`;case"mul":return`${r}(bitcast<${i}>(oldValue) * (${t}))${s}`;default:throw new Error(`Reduction ${n} is not supported.`)}},gM=(n,e)=>{let t=n[0].dims,i=n[1].dims,r=t,s=1,a=Math.ceil(ie.sizeToDimension(i,i.length-1)/s),o=i[i.length-1],l=ie.sizeFromDimension(t,o),u=[{type:12,data:a},{type:12,data:o},{type:12,data:l},...Ne(n[1].dims,n[2].dims,r)],c=h=>{let f=ae("indices",n[1].dataType,n[1].dims.length),m=ae("updates",n[2].dataType,n[2].dims.length,s),y=e.reduction!=="none"&&e.reduction!==""?gV("output",n[0].dataType,r.length):Ie("output",n[0].dataType,r.length,s);return`
      ${h.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(f,m,y)}
      ${h.mainStart()}
        ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var data_offset = 0u;
  let indices_start = uniforms.last_index_dimension * global_idx;
  let indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${n[0].dims.length===1?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[i - indices_start];
    let dim_value = uniforms.output_shape[i - indices_start];`}
    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));
  }

  for (var i = 0u; i < uniforms.num_updates_elements; i++) {
    let value = updates[uniforms.num_updates_elements * global_idx + i];
    ${mM(e.reduction,"output[data_offset + i]","value",y.type.value)}
  }

      }`};return{name:"ScatterND",shaderCache:{hint:`${e.cacheKey}_${e.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:r,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:u}),getShaderSource:c}},jB=n=>_t({reduction:n.reduction}),BB=(n,e)=>{n.compute(gM(n.inputs,e),{inputs:[n.inputs[1],n.inputs[2]],outputs:[]})}}),yM,_M,vM,aA,wM,bM,xM,EM,AM,TM,SM,IM,oA,CM,kM,$M,RM,PM,UB,HB,IZ=pe(()=>{Fe(),We(),sn(),qe(),yM=(n,e)=>{if(n.every(t=>t>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),n.length>0){if(e.mode==="linear"){if(!(n.length===2||n.length===3||n.length===4&&n[0]===1&&n[1]===1||n.length===4&&n[0]===1&&n[3]===1||n.length===5&&n[0]===1&&n[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(e.mode==="cubic"&&!(n.length===2||n.length===4&&n[0]===1&&n[1]===1||n.length===4&&n[0]===1&&n[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},_M=(n,e,t)=>{e.every(r=>r>=0&&r<t||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let i=new Array(t).fill(1);return e.forEach((r,s)=>i[r]=n[s]),i},vM=(n,e,t,i,r,s)=>{let[a,o,l]=t>10?[1,2,3]:[-1,n.length>1?1:-1,-1],u=n[0].dims.length;if(a>0&&n.length>a&&n[a].dims.length>0)n[a].getFloat32Array().forEach(c=>s.push(c));else if(e.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(o>0&&n.length>o&&n[o].dims.length===1&&n[o].dims[0]>0){if(n[o].getFloat32Array().forEach(c=>i.push(c)),i.length!==0&&i.length!==u&&t>=18&&i.length!==e.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");yM(i,e),e.axes.length>0&&_M(i,e.axes,u).forEach((c,h)=>i[h]=c)}if(l>0&&n.length>l&&n[l].dims.length===1&&n[l].dims[0]>0&&(n[l].getBigInt64Array().forEach(c=>r.push(Number(c))),r.length!==0&&r.length!==u&&t>=18&&r.length!==e.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(e.axes.length>0){if(i.length!==0&&i.length!==e.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(r.length!==0&&r.length!==e.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof i<"u"&&typeof r<"u"&&i.length>0&&r.length>u)throw new Error("Resize requires only of scales or sizes to be specified")},aA=(n,e,t,i)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${n}) * (${e});
  let whole = ${i}(big / (${t}));
  let fract = ${i}(big % (${t})) / ${i}(${t});
  return whole + fract;
`,wM=(n,e)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${e} { `+(()=>{switch(n){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${e}(xResized) / ${e}(xScale);
          } else {
            ${aA("xResized","lengthOriginal","lengthResized",e)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${e}(xResized) + 0.5) / ${e}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${e}(xResized) + 0.5) / ${e}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${aA("xResized","lengthOriginal - 1","lengthResized - 1",e)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${e}(roiStart) * ${e}(lengthOriginal - 1) +
                        (${e}(xResized) * ${e}(roiEnd - roiStart) * ${e}(lengthOriginal - 1)) /
                        ${e}(lengthResized - 1);
                  } else {
                    return 0.5 * ${e}(roiStart + roiEnd) * ${e}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${e}xScale * ${e}(lengthResized);
                  const adjustment = ${e}(lengthResized) / outputWidth;
                  const center = ${e}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${e}(xResized) + 0.5) / ${e}(xScale)) - 0.5;`;case"half_pixel":return`return ((${e}(xResized) + 0.5) / ${e}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${n} is not supported`)}})()+"}",bM=(n,e,t)=>`fn getNearestPixelFromOriginal(xOriginal: ${t}, isDownSample: bool) -> ${t} {`+(()=>{switch(n){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(e<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${n} is not supported`)}})()+"}",xM=(n,e,t)=>{let i=new Array(t).fill(0).concat(new Array(t).fill(1)),r=n.length===0?i:n.slice();return e.length>0?(e.forEach((s,a)=>{i[s]=r[a],i[a+t]=r[e.length+a]}),i):r},EM=(n,e,t,i)=>{let r=[];if(t.length>0)if(i.length>0){if(n.forEach(s=>r.push(s)),Math.max(...i)>n.length)throw new Error("axes is out of bound");i.forEach((s,a)=>r[s]=t[a])}else t.forEach(s=>r.push(s));else{if(e.length===0)throw new Error("Resize requires either scales or sizes.");r=n.map((s,a)=>Math.round(s*e[a]))}return r},AM=(n,e,t)=>{let i=(()=>{switch(t.keepAspectRatioPolicy){case"not_larger":return t.axes.length>0?Math.min(...t.axes.map(s=>e[s]),Number.MAX_VALUE):Math.min(...e,Number.MAX_VALUE);case"not_smaller":return t.axes.length>0?Math.max(...t.axes.map(s=>e[s]),Number.MIN_VALUE):Math.max(...e,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${t.keepAspectRatioPolicy} is not supported`)}})();e.fill(1,0,e.length);let r=n.slice();return t.axes.length>0?(t.axes.forEach(s=>e[s]=i),t.axes.forEach(s=>r[s]=Math.round(n[s]*e[s]))):(e.fill(i,0,e.length),r.forEach((s,a)=>r[a]=Math.round(s*e[a]))),r},TM=(n,e,t,i,r)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${n.type.indices}) -> array<${n.type.value}, ${t.length}> {
      var original_indices: array<${n.type.value}, ${t.length}>;
      for (var i:u32 = 0; i < ${t.length}; i++) {
        var output_index = ${n.indicesGet("output_indices","i")};
        var scale = ${Pe("uniforms.scales","i",i)};
        var roi_low = ${Pe("uniforms.roi","i",r)};
        var roi_hi = ${Pe("uniforms.roi",`i + ${e.length}`,r)};
        if (scale == 1.0) {
          original_indices[i] = ${n.type.value}(output_index);
        } else {
          var input_shape_i = ${Pe("uniforms.input_shape","i",e.length)};
          var output_shape_i = ${Pe("uniforms.output_shape","i",t.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,SM=(n,e,t,i,r,s,a)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${e.type.indices}) -> ${n.type.indices} {
      var input_indices: ${n.type.indices};
      for (var i:u32 = 0; i < ${i.length}; i++) {
        var output_index = ${e.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${Pe("uniforms.scales","i",r)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${Pe("uniforms.roi","i",s)};
          var roi_hi = ${Pe("uniforms.roi",`i + ${t.length}`,s)};
          var input_shape_i = ${Pe("uniforms.input_shape","i",t.length)};
          var output_shape_i = ${Pe("uniforms.output_shape","i",i.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${a} || (original_idx >= 0 && original_idx < ${e.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${e.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${n.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,IM=(n,e)=>`
    fn checkInputIndices(input_indices: ${n.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${e.length}; i++) {
        var input_index = ${n.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${Pe("uniforms.input_shape","i",e.length)}) {
          return false;
        }
      }
      return true;
    }`,oA=(n,e,t,i)=>n.rank>i?`
    ${n.indicesSet("input_indices",e,"channel")};
    ${n.indicesSet("input_indices",t,"batch")};
`:"",CM=(n,e,t,i,r)=>{let[s,a,o,l]=t.length===2?[-1,0,1,-1]:[0,2,3,1],u=n.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${u} {
      var input_indices: ${n.type.indices};
      ${n.indicesSet("input_indices",a,`max(0, min(row, ${t[a]} - 1))`)};
      ${n.indicesSet("input_indices",o,`max(0, min(col, ${t[o]} - 1))`)};
      ${oA(n,l,s,2)}
      return ${n.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${e.type.indices}) -> ${u} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${u} = originalIndices[${a}];
      var col:${u} = originalIndices[${o}];
      ${i?`if (row < 0 || row > (${t[a]} - 1) || col < 0 || col > (${t[o]} - 1)) {
        return ${r};
      }`:""};
      row = max(0, min(row, ${t[a]} - 1));
      col = max(0, min(col, ${t[o]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${t.length>2?`u32(originalIndices[${l}])`:"0"};
      var batch: u32 =  ${t.length>2?`u32(originalIndices[${s}])`:"0"};
      var x11: ${u} = getInputValue(batch, channel, row1, col1);
      var x12: ${u} = getInputValue(batch, channel, row1, col2);
      var x21: ${u} = getInputValue(batch, channel, row2, col1);
      var x22: ${u} = getInputValue(batch, channel, row2, col2);
      var dx1: ${u} = abs(row - ${u}(row1));
      var dx2: ${u} = abs(${u}(row2) - row);
      var dy1: ${u} = abs(col - ${u}(col1));
      var dy2: ${u} = abs(${u}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},kM=(n,e,t,i,r,s,a,o,l,u)=>{let c=t.length===2,[h,f]=c?[0,1]:[2,3],m=n.type.value,y=_=>{let x=_===h?"row":"col";return`
      fn ${x}CubicInterpolation(input_indices: ${n.type.indices}, output_indices: ${e.type.indices}) -> ${m} {
        var output_index = ${e.indicesGet("output_indices",_)};
        var originalIdx: ${m} = getOriginalCoordinateFromResizedCoordinate(output_index, ${r[_]},
        ${i[_]}, ${t[_]}, ${s[_]}, ${s[_]} + ${t.length});
        var fractOriginalIdx: ${m} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${o} && (originalIdx < 0 || originalIdx > (${t[_]} - 1))) {
          return ${l};
        }
        var data: array<${m}, 4> = array<${m}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${x}: ${m} = originalIdx + ${m}(i);
          if (${x} < 0 || ${x} >= ${t[_]}) {
            ${u?`coefs[i + 1] = 0.0;
                        continue;`:o?`return ${l};`:`${x} = max(0, min(${x}, ${t[_]} - 1));`};
          }
        var input_indices_copy: ${n.type.indices} = input_indices;
          ${n.indicesSet("input_indices_copy",_,`u32(${x})`)};
          data[i + 1] = ${_===h?n.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${y(h)};
    ${y(f)};
  fn getCubicInterpolationCoefs(s: ${m}) -> array<${m}, 4> {
    var absS = abs(s);
    var coeffs: array<${m}, 4> = array<${m}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${m} = 1.0 - absS;
    var twoMinusAbsS: ${m} = 2.0 - absS;
    var onePlusAbsS: ${m} = 1.0 + absS;
    coeffs[0] = ((${a} * onePlusAbsS - 5 * ${a}) * onePlusAbsS + 8 * ${a}) * onePlusAbsS - 4 * ${a};
    coeffs[1] = ((${a} + 2) * absS - (${a} + 3)) * absS * absS + 1;
    coeffs[2] = ((${a} + 2) * oneMinusAbsS - (${a} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${a} * twoMinusAbsS - 5 * ${a}) * twoMinusAbsS + 8 * ${a}) * twoMinusAbsS - 4 * ${a};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${m}, 4>, coefs: array<${m}, 4>) -> ${m} {
    var coefsSum: ${m} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${e.type.indices}) -> ${m} {
    var input_indices: ${n.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},$M=(n,e,t,i,r)=>{let[s,a,o,l,u]=t.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],c=n.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${c} {
      var input_indices: ${n.type.indices};
      ${n.indicesSet("input_indices",a,`max(0, min(depth, ${t[a]} - 1))`)};
      ${n.indicesSet("input_indices",o,`max(0, min(height, ${t[o]} - 1))`)};
      ${n.indicesSet("input_indices",l,`max(0, min(width, ${t[l]} - 1))`)};
      ${oA(n,u,s,3)}
      return ${n.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${e.type.indices}) -> ${c} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${c} = originalIndices[${a}];
      var height:${c} = originalIndices[${o}];
      var width:${c} = originalIndices[${l}];
      ${i?`if (depth < 0 || depth > (${t[a]} - 1) || height < 0 || height > (${t[o]} - 1) || width < 0 || (width > ${t[l]} - 1)) {
      return ${r};
        }`:""};

    depth = max(0, min(depth, ${t[a]} - 1));
      height = max(0, min(height, ${t[o]} - 1));
      width = max(0, min(width, ${t[l]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${t.length>3?`u32(originalIndices[${u}])`:"0"};
      var batch: u32 =  ${t.length>3?`u32(originalIndices[${s}])`:"0"};

      var x111: ${c} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${c} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${c} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${c} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${c} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${c} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${c} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${c} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${c} = abs(depth - ${c}(depth1));
      var dx2: ${c} = abs(${c}(depth2) - depth);
      var dy1: ${c} = abs(height - ${c}(height1));
      var dy2: ${c} = abs(${c}(height2) - height);
      var dz1: ${c} = abs(width - ${c}(width1));
      var dz2: ${c} = abs(${c}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},RM=(n,e,t,i,r,s)=>{let a=n.dims,o=xM(s,e.axes,a.length),l=EM(a,i,r,e.axes),u=i.slice();i.length===0&&(u=a.map((w,E)=>w===0?1:l[E]/w),e.keepAspectRatioPolicy!=="stretch"&&(l=AM(a,u,e)));let c=Ie("output",n.dataType,l.length),h=ae("input",n.dataType,a.length),f=ie.size(l),m=a.length===l.length&&a.every((w,E)=>w===l[E]),y=e.coordinateTransformMode==="tf_crop_and_resize",_=e.extrapolationValue,x=h.type.value,v=w=>`
      ${m?"":`
      ${wM(e.coordinateTransformMode,x)};
      ${(()=>{switch(e.mode){case"nearest":return`
              ${IM(h,a)};
              ${bM(e.nearestMode,t,x)};
              ${SM(h,c,a,l,u.length,o.length,y)};
              `;case"linear":return`
              ${TM(c,a,l,u.length,o.length)};
              ${(()=>{if(a.length===2||a.length===4)return`${CM(h,c,a,y,_)}`;if(a.length===3||a.length===5)return`${$M(h,c,a,y,_)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(a.length===2||a.length===4)return`${kM(h,c,a,l,u,o,e.cubicCoeffA,y,e.extrapolationValue,e.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${w.registerUniform("output_size","u32").registerUniform("scales","f32",u.length).registerUniform("roi","f32",o.length).declareVariables(h,c)}
      ${w.mainStart()}
        ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${m?"output[global_idx] = input[global_idx];":`
        let output_indices = ${c.offsetToIndices("global_idx")};
        var input_indices: ${h.type.indices};
        ${(()=>{switch(e.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${h.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${e.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${a.length===2||a.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${e.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${e.cacheKey}|${t}|${u.length>0?e.mode==="cubic"?u:u.length:""}|${r.length>0?r:""}|${o.length>0?o:""}|${m}|${e.mode==="nearest"?a.length:a}`,inputDependencies:["rank"]},getShaderSource:v,getRunData:()=>({outputs:[{dims:l,dataType:n.dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:[{type:12,data:f},{type:1,data:u},{type:1,data:o},...Ne(a,l)]})}},PM=n=>{let e=n.customDataBuffer;return new Uint32Array(e,e.byteOffset,1)[0]},UB=(n,e)=>{let t=[],i=[],r=[],s=PM(n);if(e.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");vM(n.inputs,e,s,t,i,r),n.compute(RM(n.inputs[0],e,s,t,i,r),{inputs:[0]})},HB=n=>{let e=n.antialias,t=n.axes,i=n.coordinateTransformMode,r=n.cubicCoeffA,s=n.excludeOutside!==0,a=n.extrapolationValue,o=n.keepAspectRatioPolicy,l=n.mode,u=n.nearestMode===""?"simple":n.nearestMode;return _t({antialias:e,axes:t,coordinateTransformMode:i,cubicCoeffA:r,excludeOutside:s,extrapolationValue:a,keepAspectRatioPolicy:o,mode:l,nearestMode:u})}}),NM,DM,WB,CZ=pe(()=>{Fe(),We(),qe(),NM=n=>{if(!n||n.length<3)throw new Error("layerNorm requires at least 3 inputs.");let e=n[0],t=n[1],i=n[2];if(e.dataType!==t.dataType||e.dataType!==i.dataType)throw new Error("All inputs must have the same data type");if(e.dims.length!==3&&e.dims.length!==2)throw new Error("Input must be 2D or 3D");if(t.dims.length!==3&&t.dims.length!==2)throw new Error("Skip must be 2D or 3D");let r=e.dims[e.dims.length-1],s=e.dims[e.dims.length-2];if(t.dims[t.dims.length-1]!==r)throw new Error("Skip must have the same hidden size as input");if(t.dims[t.dims.length-2]!==s)throw new Error("Skip must have the same sequence length as input");if(i.dims.length!==1)throw new Error("Gamma must be 1D");if(i.dims[i.dims.length-1]!==r)throw new Error("Gamma must have the same hidden size as input");if(n.length>3){let a=n[3];if(a.dims.length!==1)throw new Error("Beta must be 1D");if(a.dims[a.dims.length-1]!==r)throw new Error("Beta must have the same hidden size as input")}if(n.length>4){let a=n[4];if(a.dims.length!==1)throw new Error("Bias must be 1D");if(a.dims[a.dims.length-1]!==r)throw new Error("Bias must have the same hidden size as input")}},DM=(n,e,t,i)=>{let r=e.simplified,s=n[0].dims,a=ie.size(s),o=s,l=a,u=s.slice(-1)[0],c=i?s.slice(0,-1).concat(1):[],h=!r&&n.length>3,f=n.length>4,m=i&&t>1,y=i&&t>2,_=t>3,x=64,v=Yt(u),w=[{type:12,data:l},{type:12,data:v},{type:12,data:u},{type:1,data:e.epsilon}],E=$=>{let L=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],I=[ae("x",n[0].dataType,n[0].dims,v),ae("skip",n[1].dataType,n[1].dims,v),ae("gamma",n[2].dataType,n[2].dims,v)];h&&I.push(ae("beta",n[3].dataType,n[3].dims,v)),f&&I.push(ae("bias",n[4].dataType,n[4].dims,v)),I.push(Ie("output",n[0].dataType,o,v)),m&&I.push(Ie("mean_output",1,c)),y&&I.push(Ie("inv_std_output",1,c)),_&&I.push(Ie("input_skip_bias_sum",n[0].dataType,o,v));let C=Pn(n[0].dataType),N=Pn(1,v);return`

      ${$.registerUniforms(L).declareVariables(...I)}
      var<workgroup> sum_shared : array<${N}, ${x}>;
      var<workgroup> sum_squared_shared : array<${N}, ${x}>;

      ${$.mainStart([x,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${x};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${x};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${x-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${f?"bias[offset1d + i]":C+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${_?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${sf(C,v,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${x};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${Pu("sum",v)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${Pu("square_sum",v)} / f32(uniforms.hidden_size) ${r?"":"- mean * mean"} + uniforms.epsilon);
        ${m?"mean_output[global_idx] = mean;":""}
        ${y?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${r?"":`- ${C}(mean)`}) *
            ${C}(inv_std_dev) * gamma[offset1d + i]
            ${h?"+ beta[offset1d + i]":""};
        }
      }`},k=[{dims:o,dataType:n[0].dataType}];return t>1&&k.push({dims:c,dataType:1}),t>2&&k.push({dims:c,dataType:1}),t>3&&k.push({dims:s,dataType:n[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${v};${m};${y};${_}`,inputDependencies:n.map(($,L)=>"type")},getShaderSource:E,getRunData:()=>({outputs:k,dispatchGroup:{x:Math.ceil(l/u)},programUniforms:w})}},WB=(n,e)=>{NM(n.inputs);let t=[0];n.outputCount>1&&t.push(-3),n.outputCount>2&&t.push(-3),n.outputCount>3&&t.push(3),n.compute(DM(n.inputs,e,n.outputCount,!1),{outputs:t})}}),MM,Bm,OM,lA,LM,FM,qB,GB,kZ=pe(()=>{Fe(),We(),sn(),qe(),MM=(n,e)=>{if(!n||n.length<1)throw new Error("too few inputs");if(e.axes.length!==0){if(e.axes.length!==e.starts.length||e.axes.length!==e.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(e.starts.length!==e.ends.length)throw new Error("starts and ends must have the same length");n.slice(1).forEach((t,i)=>{if(n[i+1].dataType!==6&&n[i+1].dataType!==7)throw new Error(`Input ${i} must be an array of int32 or int64`)})},Bm=(n,e)=>{let t=[];if(n.length>e)if(n[e].dataType===7)n[e].getBigInt64Array().forEach(i=>t.push(Number(i)));else if(n[e].dataType===6)n[e].getInt32Array().forEach(i=>t.push(Number(i)));else throw new Error(`Input ${e} must be an array of int32 or int64`);return t},OM=(n,e)=>{if(n.length>1){let t=Bm(n,1),i=Bm(n,2),r=Bm(n,3);return r.length===0&&(r=[...Array(n[0].dims.length).keys()]),_t({starts:t,ends:i,axes:r})}else return e},lA=(n,e,t,i,r)=>{let s=n;return n<0&&(s+=t[i[e]]),r[e]<0?Math.max(0,Math.min(s,t[i[e]]-1)):Math.max(0,Math.min(s,t[i[e]]))},LM=(n,e,t)=>`fn calculateInputIndices(output_indices: ${e.type.indices}) -> ${n.type.indices} {
          var input_indices: ${n.type.indices};
          var carry = 0u;
          for (var i = ${t.length-1}; i >= 0; i--) {
            let input_shape_i = ${Pe("uniforms.input_shape","i",t.length)};
            let steps_i = ${Pe("uniforms.steps","i",t.length)};
            let signs_i = ${Pe("uniforms.signs","i",t.length)};
            let starts_i = ${Pe("uniforms.starts","i",t.length)};
            var output_index = ${e.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${n.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,FM=(n,e)=>{let t=n[0].dims,i=ie.size(t),r=e.axes.length>0?ie.normalizeAxes(e.axes,t.length):[...Array(t.length).keys()],s=Bm(n,4);s.forEach(v=>v!==0||(()=>{throw new Error("step cannot be 0")})),s.length===0&&(s=Array(r.length).fill(1));let a=e.starts.map((v,w)=>lA(v,w,t,r,s)),o=e.ends.map((v,w)=>lA(v,w,t,r,s));if(r.length!==a.length||r.length!==o.length)throw new Error("start, ends and axes should have the same number of elements");if(r.length!==t.length)for(let v=0;v<t.length;++v)r.includes(v)||(a.splice(v,0,0),o.splice(v,0,t[v]),s.splice(v,0,1));let l=s.map(v=>Math.sign(v));s.forEach((v,w,E)=>{if(v<0){let k=(o[w]-a[w])/v,$=a[w],L=$+k*s[w];a[w]=L,o[w]=$,E[w]=-v}});let u=t.slice(0);r.forEach((v,w)=>{u[v]=Math.ceil((o[v]-a[v])/s[v])});let c={dims:u,dataType:n[0].dataType},h=Ie("output",n[0].dataType,u.length),f=ae("input",n[0].dataType,n[0].dims.length),m=ie.size(u),y=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:a.length},{name:"signs",type:"i32",length:l.length},{name:"steps",type:"u32",length:s.length}],_=[{type:12,data:m},{type:12,data:a},{type:6,data:l},{type:12,data:s},...Ne(n[0].dims,u)],x=v=>`
      ${v.registerUniforms(y).declareVariables(f,h)}
        ${LM(f,h,t)}
        ${v.mainStart()}
          ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${h.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${h.setByOffset("global_idx",f.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${l.length}_${a.length}_${s.length}`,inputDependencies:["rank"]},getShaderSource:x,getRunData:()=>({outputs:[c],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:_})}},qB=(n,e)=>{MM(n.inputs,e);let t=OM(n.inputs,e);n.compute(FM(n.inputs,t),{inputs:[0]})},GB=n=>{let e=n.starts,t=n.ends,i=n.axes;return _t({starts:e,ends:t,axes:i})}}),zM,VM,KB,YB,$Z=pe(()=>{Fe(),We(),sn(),Hu(),qe(),zM=n=>{if(!n||n.length!==1)throw new Error("Softmax op requires 1 input.")},VM=(n,e)=>{let t=n.inputs[0],i=t.dims,r=ie.size(i),s=i.length,a=ie.normalizeAxis(e.axis,s),o=a<i.length-1,l,u=[];o?(u=Array.from({length:s},(I,C)=>C),u[a]=s-1,u[s-1]=a,l=n.compute(Mr(t,u),{inputs:[t],outputs:[-1]})[0]):l=t;let c=l.dims,h=c[s-1],f=r/h,m=Yt(h),y=h/m,_=64;f===1&&(_=256);let x=(I,C)=>C===4?`max(max(${I}.x, ${I}.y), max(${I}.z, ${I}.w))`:C===2?`max(${I}.x, ${I}.y)`:C===3?`max(max(${I}.x, ${I}.y), ${I}.z)`:I,v=ae("x",l.dataType,l.dims,m),w=Ie("result",l.dataType,l.dims,m),E=v.type.value,k=Pn(l.dataType)==="f32"?`var threadMax = ${E}(-3.402823e+38f);`:`var threadMax = ${E}(-65504.0h);`,$=I=>`
      var<workgroup> rowMaxShared : ${E};
      var<workgroup> rowSumShared : ${E};
      var<workgroup> threadShared : array<${E}, ${_}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${E} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${E}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${I.registerUniform("packedCols","i32").declareVariables(v,w)}
      ${I.mainStart(_)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${_};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${k}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${E}(${x("threadShared[0]",m)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${E}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${E}(${Pu("threadShared[0]",m)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          var value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          // max operation protects against NaN since all values should be >=0
          value = max(value, ${E}(0.0));
          setValue(row, col, row_stride, value);
        }
      }`,L=n.compute({name:"Softmax",shaderCache:{hint:`${m};${_}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:c,dataType:l.dataType}],dispatchGroup:{x:f},programUniforms:[{type:6,data:y}]}),getShaderSource:$},{inputs:[l],outputs:[o?-1:0]})[0];o&&n.compute(Mr(L,u),{inputs:[L]})},KB=(n,e)=>{zM(n.inputs),VM(n,e)},YB=n=>_t({axis:n.axis})}),uA,jM,BM,UM,XB,RZ=pe(()=>{Fe(),We(),qe(),uA=n=>Array.from(n.getBigInt64Array(),Number),jM=n=>{if(!n||n.length!==2)throw new Error("Tile requires 2 inputs.");if(n[0].dataType!==1&&n[0].dataType!==10&&n[0].dataType!==6&&n[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(n[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(n[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(uA(n[1]).length!==n[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},BM=(n,e)=>{let t=[];for(let i=0;i<n.length;++i)t.push(n[i]*e[i]);return t},UM=(n,e)=>{let t=n[0].dims,i=e??uA(n[1]),r=BM(t,i),s=ie.size(r),a=n[0].dataType,o=ae("input",a,t.length),l=Ie("output",a,r.length),u=c=>`
      const inputShape = ${o.indices(...t)};
      ${c.registerUniform("output_size","u32").declareVariables(o,l)}
      ${c.mainStart()}
      ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${l.offsetToIndices("global_idx")};
      var input_indices: ${o.type.indices};
      for (var i = 0; i < ${t.length}; i++) {
        let input_dim_i = ${o.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${l.indicesGet("output_indices","i")}  % input_dim_i;

        ${o.indicesSet("input_indices","i","input_dim_value")}
      }
      ${l.setByOffset("global_idx",o.getByIndices("input_indices"))}
    }`;return{name:"Tile",shaderCache:{hint:`${i}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:r,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:[{type:12,data:s},...Ne(n[0].dims,r)]}),getShaderSource:u}},XB=n=>{jM(n.inputs),n.compute(UM(n.inputs),{inputs:[0]})}}),HM,WM,QB,PZ=pe(()=>{Fe(),We(),qe(),HM=(n,e,t,i,r)=>{let s=Ie("output_data",r,t.length,4),a=ae("a_data",e[1].dataType,e[1].dims.length,4),o=ae("b_data",e[2].dataType,e[2].dims.length,4),l=ae("c_data",e[0].dataType,e[0].dims.length,4),u,c=(h,f,m)=>`select(${f}, ${h}, ${m})`;if(!i)u=s.setByOffset("global_idx",c(a.getByOffset("global_idx"),o.getByOffset("global_idx"),l.getByOffset("global_idx")));else{let h=(f,m,y="")=>{let _=`a_data[index_a${m}][component_a${m}]`,x=`b_data[index_b${m}][component_b${m}]`,v=`bool(c_data[index_c${m}] & (0xffu << (component_c${m} * 8)))`;return`
            let output_indices${m} = ${s.offsetToIndices(`global_idx * 4u + ${m}u`)};
            let offset_a${m} = ${a.broadcastedIndicesToOffset(`output_indices${m}`,s)};
            let offset_b${m} = ${o.broadcastedIndicesToOffset(`output_indices${m}`,s)};
            let offset_c${m} = ${l.broadcastedIndicesToOffset(`output_indices${m}`,s)};
            let index_a${m} = offset_a${m} / 4u;
            let index_b${m} = offset_b${m} / 4u;
            let index_c${m} = offset_c${m} / 4u;
            let component_a${m} = offset_a${m} % 4u;
            let component_b${m} = offset_b${m} % 4u;
            let component_c${m} = offset_c${m} % 4u;
            ${f}[${m}] = ${y}(${c(_,x,v)});
          `};r===9?u=`
            var data = vec4<u32>(0);
            ${h("data",0,"u32")}
            ${h("data",1,"u32")}
            ${h("data",2,"u32")}
            ${h("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:u=`
            ${h("output_data[global_idx]",0)}
            ${h("output_data[global_idx]",1)}
            ${h("output_data[global_idx]",2)}
            ${h("output_data[global_idx]",3)}
          `}return`
        ${n.registerUniform("vec_size","u32").declareVariables(l,a,o,s)}
        ${n.mainStart()}
        ${n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${u}
      }`},WM=n=>{let e=n[1].dims,t=n[2].dims,i=n[0].dims,r=n[1].dataType,s=!(ie.areEqual(e,t)&&ie.areEqual(t,i)),a=e,o=ie.size(e);if(s){let u=Vp.calcShape(Vp.calcShape(e,t,!1),i,!1);if(!u)throw new Error("Can't perform where op on the given tensors");a=u,o=ie.size(a)}let l=Math.ceil(o/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:u=>HM(u,n,a,s,r),getRunData:()=>({outputs:[{dims:a,dataType:r}],dispatchGroup:{x:Math.ceil(o/64/4)},programUniforms:[{type:12,data:l},...Ne(i,e,t,a)]})}},QB=n=>{n.compute(WM(n.inputs))}}),JB,NZ=pe(()=>{GJ(),AC(),KJ(),YJ(),XJ(),QJ(),JJ(),iZ(),sZ(),aZ(),oZ(),lZ(),uZ(),cZ(),dZ(),hZ(),fZ(),pZ(),mZ(),gZ(),yZ(),_Z(),vZ(),wZ(),bZ(),yB(),xZ(),EZ(),AZ(),TZ(),SZ(),EC(),IZ(),xB(),CZ(),kZ(),$Z(),wB(),RZ(),Hu(),TC(),PZ(),JB=new Map([["Abs",[WV]],["Acos",[qV]],["Acosh",[GV]],["Add",[Ij]],["ArgMax",[jV,eS]],["ArgMin",[VV,eS]],["Asin",[KV]],["Asinh",[YV]],["Atan",[XV]],["Atanh",[QV]],["Attention",[BV]],["AveragePool",[RB,$B]],["BatchNormalization",[UV]],["BiasAdd",[HV]],["BiasSplitGelu",[Sj]],["Cast",[ZV,JV]],["Ceil",[tj]],["Clip",[ej]],["Concat",[Lj,Fj]],["Conv",[aS,sS]],["ConvTranspose",[Kj,Gj]],["Cos",[nj]],["Cosh",[ij]],["CumSum",[Yj,Xj]],["DepthToSpace",[Qj,Jj]],["DequantizeLinear",[FB,zB]],["Div",[Cj]],["Einsum",[Zj,eB]],["Elu",[rj,lg]],["Equal",[kj]],["Erf",[sj]],["Exp",[aj]],["Expand",[tB]],["FastGelu",[nB]],["Floor",[oj]],["FusedConv",[aS,sS]],["Gather",[rB,iB]],["GatherElements",[cB,uB]],["GatherBlockQuantized",[oB,lB]],["GatherND",[sB,aB]],["Gelu",[lj]],["Gemm",[hB,dB]],["GlobalAveragePool",[NB,PB]],["GlobalMaxPool",[LB,OB]],["Greater",[Nj]],["GreaterOrEqual",[Mj]],["GridSample",[fB,pB]],["GroupQueryAttention",[EB]],["HardSigmoid",[gj,mj]],["InstanceNormalization",[AB]],["LayerNormalization",[TB]],["LeakyRelu",[uj,lg]],["Less",[Dj]],["LessOrEqual",[Oj]],["Log",[Aj]],["MatMul",[SB]],["MatMulNBits",[IB,CB]],["MaxPool",[DB,MB]],["Mul",[$j]],["MultiHeadAttention",[gB,mB]],["Neg",[dj]],["Not",[cj]],["Pad",[kB]],["Pow",[Rj]],["QuickGelu",[Tj,lg]],["Range",[VB]],["Reciprocal",[hj]],["ReduceMin",[MV]],["ReduceMean",[$V]],["ReduceMax",[DV]],["ReduceSum",[LV]],["ReduceProd",[OV]],["ReduceL1",[RV]],["ReduceL2",[PV]],["ReduceLogSum",[zV]],["ReduceLogSumExp",[NV]],["ReduceSumSquare",[FV]],["Relu",[fj]],["Resize",[UB,HB]],["RotaryEmbedding",[bB]],["ScatterND",[BB,jB]],["Sigmoid",[pj]],["Sin",[yj]],["Sinh",[_j]],["Slice",[qB,GB]],["SkipLayerNormalization",[WB]],["Split",[_B,vB]],["Sqrt",[vj]],["Softmax",[KB,YB]],["Sub",[Pj]],["Tan",[wj]],["Tanh",[bj]],["ThresholdedRelu",[Ej,lg]],["Tile",[XB]],["Transpose",[_V,vV]],["Where",[QB]]])}),ZB,DZ=pe(()=>{os(),sl(),qe(),ZB=class{constructor(n){this.backend=n,this.repo=new Map,this.attributesBound=!1}getArtifact(n){return this.repo.get(n)}setArtifact(n,e){this.repo.set(n,e)}run(n,e,t,i,r){Ua(n.programInfo.name);let s=this.backend.device,a=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let o=[];for(let u of e)o.push({binding:o.length,resource:{buffer:u.buffer}});for(let u of t)o.push({binding:o.length,resource:{buffer:u.buffer}});r&&o.push({binding:o.length,resource:r});let l=s.createBindGroup({layout:n.computePipeline.getBindGroupLayout(0),entries:o,label:n.programInfo.name});if(this.backend.sessionStatus==="capturing"){let u={kernelId:this.backend.currentKernelId,computePipeline:n.computePipeline,bindGroup:l,dispatchGroup:i};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(u)}a.setPipeline(n.computePipeline),a.setBindGroup(0,l),a.dispatchWorkgroups(...i),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),Gs(n.programInfo.name)}dispose(){}build(n,e){Ua(n.name);let t=this.backend.device,i=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(u=>{t.features.has(u.feature)&&i.push(`enable ${u.extension};`)});let r=yV(e,this.backend.device.limits),s=n.getShaderSource(r),a=`${i.join(`
`)}
${r.additionalImplementations}
${s}`,o=t.createShaderModule({code:a,label:n.name});at("verbose",()=>`[WebGPU] ${n.name} shader code: ${a}`);let l=t.createComputePipeline({compute:{module:o,entryPoint:"main"},layout:"auto",label:n.name});return Gs(n.name),{programInfo:n,computePipeline:l,uniformVariablesInfo:r.variablesInfo}}normalizeDispatchGroupSize(n){let e=typeof n=="number"?n:n.x,t=typeof n=="number"?1:n.y||1,i=typeof n=="number"?1:n.z||1,r=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(e<=r&&t<=r&&i<=r)return[e,t,i];let s=e*t*i,a=Math.ceil(Math.sqrt(s));if(a>r){if(a=Math.ceil(Math.cbrt(s)),a>r)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[a,a,a]}else return[a,a,1]}}}),eU={};Zp(eU,{WebGpuBackend:()=>tU});var qM,GM,KM,tU,MZ=pe(()=>{os(),Fe(),sl(),hV(),WJ(),NZ(),DZ(),qM=(n,e)=>{if(e.length!==n.length)throw new Error(`inputDependencies length ${e.length} is not equal to inputTensors length ${n.length}.`);let t=[];for(let i=0;i<n.length;++i){let r=n[i].dataType;switch(e[i]){case"none":{t.push("");break}case"type":{t.push(`${r}`);break}case"rank":{let s=n[i].dims.length;t.push(`${r};${s}`);break}case"dims":{let s=n[i].dims.join(",");t.push(`${r};${s}`);break}default:throw new Error(`unsupported input dependency: ${e[i]}`)}}return t.join("|")},GM=(n,e,t)=>{var r,s;let i=n.name;return(r=n.shaderCache)!=null&&r.hint&&(i+="["+n.shaderCache.hint+"]"),i+=":"+t+`:${qM(e,((s=n.shaderCache)==null?void 0:s.inputDependencies)??new Array(e.length).fill("dims"))}`,i},KM=class{constructor(n){n&&(this.architecture=n.architecture,this.vendor=n.vendor)}isArchitecture(n){return this.architecture===n}isVendor(n){return this.vendor===n}},tU=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let n=this.kernelCustomData.get(this.currentKernelId);return n||(n={},this.kernelCustomData.set(this.currentKernelId,n)),n}async initialize(n,e){this.env=n;let t=[],i={requiredLimits:{maxComputeWorkgroupStorageSize:e.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:e.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:e.limits.maxStorageBufferBindingSize,maxBufferSize:e.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:e.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:e.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:e.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:e.limits.maxComputeWorkgroupSizeZ},requiredFeatures:t},r=s=>e.features.has(s)&&t.push(s)&&!0;r("chromium-experimental-timestamp-query-inside-passes")||r("timestamp-query"),r("shader-f16"),r("subgroups"),this.device=await e.requestDevice(i),this.adapterInfo=new KM(e.info||await e.requestAdapterInfo()),this.gpuDataManager=mV(this),this.programManager=new ZB(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,vC(n.logLevel,!!n.debug),this.device.onuncapturederror=s=>{s.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${s.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:e,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let n=this.getCommandEncoder(),e={};this.queryType==="at-passes"&&(e.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=n.beginComputePass(e)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;Ua(),this.endComputePass();let n;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),n=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(n,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,n,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&n.mapAsync(GPUMapMode.READ).then(()=>{var i;let e=new BigUint64Array(n.getMappedRange()),t=this.pendingQueries.get(n);for(let r=0;r<e.length/2;r++){let s=t[r],a=s.kernelId,o=this.kernels.get(a),l=o.kernelType,u=o.kernelName,c=s.programName,h=s.inputTensorViews,f=s.outputTensorViews,m=e[r*2],y=e[r*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=m);let _=Number(m-this.queryTimeBase),x=Number(y-this.queryTimeBase);if(!Number.isSafeInteger(_)||!Number.isSafeInteger(x))throw new RangeError("incorrect timestamp range");if((i=this.env.webgpu.profiling)!=null&&i.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:h.map(v=>({dims:v.dims,dataType:Mo(v.dataType)})),outputsMetadata:f.map(v=>({dims:v.dims,dataType:Mo(v.dataType)})),kernelId:a,kernelType:l,kernelName:u,programName:c,startTime:_,endTime:x});else{let v="";h.forEach((E,k)=>{v+=`input[${k}]: [${E.dims}] | ${Mo(E.dataType)}, `});let w="";f.forEach((E,k)=>{w+=`output[${k}]: [${E.dims}] | ${Mo(E.dataType)}, `}),console.log(`[profiling] kernel "${a}|${l}|${u}|${c}" ${v}${w}start time: ${_} ns, execution time: ${x-_} ns`)}Rb("GPU",`${c}::${m}::${y}`)}n.unmap(),this.pendingQueries.delete(n)}),Gs()}run(n,e,t,i,r,s){Ua(n.name);let a=[];for(let w=0;w<e.length;++w){let E=e[w].data;if(E===0)continue;let k=this.gpuDataManager.get(E);if(!k)throw new Error(`no GPU data for input: ${E}`);a.push(k)}let{outputs:o,dispatchGroup:l,programUniforms:u}=n.getRunData(e),c=t.length===0?o.map((w,E)=>E):t;if(c.length!==o.length)throw new Error(`Output size ${c.length} must be equal to ${o.length}.`);let h=[],f=[];for(let w=0;w<o.length;++w){if(!Number.isInteger(c[w])||c[w]<-3||c[w]>=s)throw new Error(`Invalid output index: ${c[w]}`);if(c[w]===-3)continue;let E=c[w]===-1,k=c[w]===-2,$=E||k?r(o[w].dataType,o[w].dims):i(c[w],o[w].dataType,o[w].dims);if(h.push($),$.data===0)continue;let L=this.gpuDataManager.get($.data);if(!L)throw new Error(`no GPU data for output: ${$.data}`);if(E&&this.temporaryData.push(L),k){let I=this.kernelPersistentData.get(this.currentKernelId);I||(I=[],this.kernelPersistentData.set(this.currentKernelId,I)),I.push(L)}f.push(L)}if(a.length!==e.length||f.length!==h.length){if(f.length===0)return Gs(n.name),h;throw new Error(`Program ${n.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let m;if(u){let w=0,E=[];u.forEach(I=>{let C=typeof I.data=="number"?[I.data]:I.data;if(C.length===0)return;let N=I.type===10?2:4,O,V;I.type===10?(V=C.length>4?16:C.length>2?8:C.length*N,O=C.length>4?16:N*C.length):(V=C.length<=2?C.length*N:16,O=16),w=Math.ceil(w/V)*V,E.push(w);let U=I.type===10?8:4;w+=C.length>4?Math.ceil(C.length/U)*O:C.length*N});let k=16;w=Math.ceil(w/k)*k;let $=new ArrayBuffer(w);u.forEach((I,C)=>{let N=E[C],O=typeof I.data=="number"?[I.data]:I.data;if(I.type===6)new Int32Array($,N,O.length).set(O);else if(I.type===12)new Uint32Array($,N,O.length).set(O);else if(I.type===10)new Uint16Array($,N,O.length).set(O);else if(I.type===1)new Float32Array($,N,O.length).set(O);else throw new Error(`Unsupported uniform type: ${Mo(I.type)}`)});let L=this.gpuDataManager.create(w,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(L.buffer,0,$,0,w),this.gpuDataManager.release(L.id),m={offset:0,size:w,buffer:L.buffer}}let y=this.programManager.normalizeDispatchGroupSize(l),_=y[1]===1&&y[2]===1,x=GM(n,e,_),v=this.programManager.getArtifact(x);if(v||(v=this.programManager.build(n,y),this.programManager.setArtifact(x,v),at("info",()=>`[artifact] key: ${x}, programName: ${n.name}`)),u&&v.uniformVariablesInfo){if(u.length!==v.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${v.uniformVariablesInfo.length}, got ${u.length} in program "${v.programInfo.name}".`);for(let w=0;w<u.length;w++){let E=u[w],k=E.type,$=typeof E.data=="number"?1:E.data.length,[L,I]=v.uniformVariablesInfo[w];if(k!==L||$!==I)throw new Error(`Uniform variable ${w} mismatch: expect type ${L} with size ${I}, got type ${k} with size ${$} in program "${v.programInfo.name}".`)}}if(at("info",()=>`[ProgramManager] run "${n.name}" (key=${x}) with ${y[0]}x${y[1]}x${y[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let w={kernelId:this.currentKernelId,programName:v.programInfo.name,inputTensorViews:e,outputTensorViews:h};this.pendingKernels.push(w),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push(w)}return this.programManager.run(v,a,f,y,m),Gs(n.name),h}upload(n,e){this.gpuDataManager.upload(n,e)}memcpy(n,e){this.gpuDataManager.memcpy(n,e)}async download(n,e){await this.gpuDataManager.download(n,e)}alloc(n){return this.gpuDataManager.create(n).id}free(n){return this.gpuDataManager.release(n)}createKernel(n,e,t,i){let r=JB.get(n);if(!r)throw new Error(`kernel not implemented: ${n}`);let s={kernelType:n,kernelName:i,kernelEntry:r[0],attributes:[r[1],t]};this.kernels.set(e,s)}releaseKernel(n){let e=this.kernelPersistentData.get(n);if(e){for(let t of e)this.gpuDataManager.release(t.id);this.kernelPersistentData.delete(n)}this.kernelCustomData.delete(n),this.kernels.delete(n)}computeKernel(n,e,t){let i=this.kernels.get(n);if(!i)throw new Error(`kernel not created: ${n}`);let r=i.kernelType,s=i.kernelName,a=i.kernelEntry,o=i.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${r}] ${s}" is not allowed to be called recursively`);this.currentKernelId=n,o[0]&&(o[1]=o[0](o[1]),o[0]=void 0),at("info",()=>`[WebGPU] Start to run kernel "[${r}] ${s}"...`);let l=this.env.debug;this.temporaryData=[];try{return l&&this.device.pushErrorScope("validation"),a(e,o[1]),0}catch(u){return t.push(Promise.resolve(`[WebGPU] Kernel "[${r}] ${s}" failed. ${u}`)),1}finally{l&&t.push(this.device.popErrorScope().then(u=>u?`GPU validation error for kernel "[${r}] ${s}": ${u.message}`:null));for(let u of this.temporaryData)this.gpuDataManager.release(u.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(n,e,t,i){let r=this.sessionExternalDataMapping.get(n);r||(r=new Map,this.sessionExternalDataMapping.set(n,r));let s=r.get(e),a=this.gpuDataManager.registerExternalBuffer(t,i,s);return r.set(e,[a,t]),a}unregisterBuffers(n){let e=this.sessionExternalDataMapping.get(n);e&&(e.forEach(t=>this.gpuDataManager.unregisterExternalBuffer(t[0])),this.sessionExternalDataMapping.delete(n))}getBuffer(n){let e=this.gpuDataManager.get(n);if(!e)throw new Error(`no GPU data for buffer: ${n}`);return e.buffer}createDownloader(n,e,t){return async()=>{let i=await QT(this,n,e);return wC(i.buffer,t)}}writeTimestamp(n){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,n)}setQueryType(){var n;this.queryType="none",(((n=this.env.webgpu.profiling)==null?void 0:n.mode)==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){at("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){at("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){at("info","replay"),this.sessionStatus="replaying";let n=this.capturedCommandList.get(this.currentSessionId),e=this.capturedPendingKernels.get(this.currentSessionId),t=n.length;this.pendingKernels=[];for(let i=0;i<t;i++){let r=this.getComputePassEncoder(),s=n[i];this.writeTimestamp(this.pendingDispatchNumber*2),r.setPipeline(s.computePipeline),r.setBindGroup(0,s.bindGroup),r.dispatchWorkgroups(...s.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(e[i]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(n){this.unregisterBuffers(n),this.capturedCommandList.has(n)&&this.capturedCommandList.delete(n),this.capturedPendingKernels.has(n)&&this.capturedPendingKernels.delete(n),this.gpuDataManager.onReleaseSession(n)}onRunStart(n){this.currentSessionId=n,this.setQueryType()}}}),nU={};Zp(nU,{init:()=>iU});var P0,YM,iU,OZ=pe(()=>{Fe(),sl(),We(),HJ(),P0=class rU{constructor(e,t,i,r){this.module=e,this.dataType=t,this.data=i,this.dims=r}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let e=ie.size(this.dims);return e===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,e)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let e=ie.size(this.dims);return e===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,e)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let e=ie.size(this.dims);return e===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,e)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let e=ie.size(this.dims);return e===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,e)}reshape(e){if(ie.size(e)!==ie.size(this.dims))throw new Error("Invalid new shape");return new rU(this.module,this.dataType,this.data,e)}},YM=class{constructor(n,e,t){this.module=n,this.backend=e,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=e.adapterInfo;let i=n.PTR_SIZE,r=t/n.PTR_SIZE,s=i===4?"i32":"i64";this.opKernelContext=Number(n.getValue(i*r++,s));let a=Number(n.getValue(i*r++,s));this.outputCount=Number(n.getValue(i*r++,s)),this.customDataOffset=Number(n.getValue(i*r++,"*")),this.customDataSize=Number(n.getValue(i*r++,s));let o=[];for(let l=0;l<a;l++){let u=Number(n.getValue(i*r++,s)),c=Number(n.getValue(i*r++,"*")),h=Number(n.getValue(i*r++,s)),f=[];for(let m=0;m<h;m++)f.push(Number(n.getValue(i*r++,s)));o.push(new P0(n,u,c,f))}this.inputs=o}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(n,e){var a;let t=((a=e==null?void 0:e.inputs)==null?void 0:a.map(o=>typeof o=="number"?this.inputs[o]:o))??this.inputs,i=(e==null?void 0:e.outputs)??[],r=(o,l,u)=>new P0(this.module,l,this.output(o,u),u),s=(o,l)=>{let u=xc(o,l);if(!u)throw new Error(`Unsupported data type: ${o}`);let c=u>0?this.backend.gpuDataManager.create(u).id:0;return new P0(this.module,o,c,l)};return this.backend.run(n,t,i,r,s,this.outputCount)}output(n,e){let t=this.module.stackSave();try{let i=this.module.PTR_SIZE,r=i===4?"i32":"i64",s=this.module.stackAlloc((1+e.length)*i);this.module.setValue(s,e.length,r);for(let a=0;a<e.length;a++)this.module.setValue(s+i*(a+1),e[a],r);return this.module._JsepOutput(this.opKernelContext,n,s)}catch(i){throw new Error(`Failed to generate kernel's output[${n}] with dims [${e}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${i}`)}finally{this.module.stackRestore(t)}}},iU=async(n,e,t,i)=>{let r=e.jsepInit;if(!r)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(n==="webgpu"){let s=(MZ(),vy(eU)).WebGpuBackend,a=new s;await a.initialize(t,i),r("webgpu",[a,o=>a.alloc(Number(o)),o=>a.free(o),(o,l,u,c=!1)=>{if(c)at("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(o)}, dst=${Number(l)}, size=${Number(u)}`),a.memcpy(Number(o),Number(l));else{at("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(o)}, gpuDataId=${Number(l)}, size=${Number(u)}`);let h=e.HEAPU8.subarray(Number(o>>>0),Number(o>>>0)+Number(u));a.upload(Number(l),h)}},async(o,l,u)=>{at("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${o}, dataOffset=${l}, size=${u}`),await a.download(Number(o),()=>e.HEAPU8.subarray(Number(l)>>>0,Number(l+u)>>>0))},(o,l,u)=>a.createKernel(o,Number(l),u,e.UTF8ToString(e._JsepGetNodeName(Number(l)))),o=>a.releaseKernel(o),(o,l,u,c)=>{at("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${u}, kernel=${o}, contextDataOffset=${l}`);let h=new YM(e,a,Number(l));return a.computeKernel(Number(o),h,c)},()=>a.captureBegin(),()=>a.captureEnd(),()=>a.replay()])}else{let s=new pV(t);r("webnn",[s,()=>s.reserveTensorId(),a=>s.releaseTensorId(a),async(a,o,l,u,c)=>s.ensureTensor(a,o,l,u,c),(a,o)=>{s.uploadTensor(a,o)},async(a,o)=>s.downloadTensor(a,o),(a,o)=>s.registerMLContext(a,o),!!t.trace])}}}),XM,RC,PC,_l,QM,cA,Fb,NC,DC,dA,MC,OC,LC,sU=pe(()=>{os(),jJ(),BJ(),Fe(),hh(),mC(),lV(),XM=(n,e)=>{Ct()._OrtInit(n,e)!==0&&bt("Can't initialize onnxruntime.")},RC=async n=>{XM(n.wasm.numThreads,Nb(n.logLevel))},PC=async(n,e)=>{var i,r;(r=(i=Ct()).asyncInit)==null||r.call(i);let t=n.webgpu.adapter;if(e==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(t){if(typeof t.limits!="object"||typeof t.features!="object"||typeof t.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let s=n.webgpu.powerPreference;if(s!==void 0&&s!=="low-power"&&s!=="high-performance")throw new Error(`Invalid powerPreference setting: "${s}"`);let a=n.webgpu.forceFallbackAdapter;if(a!==void 0&&typeof a!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${a}"`);if(t=await navigator.gpu.requestAdapter({powerPreference:s,forceFallbackAdapter:a}),!t)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(e==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");{let s=(OZ(),vy(nU)).init;e==="webgpu"&&await s("webgpu",Ct(),n,t),e==="webnn"&&await s("webnn",Ct(),n)}},_l=new Map,QM=n=>{let e=Ct(),t=e.stackSave();try{let i=e.PTR_SIZE,r=e.stackAlloc(2*i);e._OrtGetInputOutputCount(n,r,r+i)!==0&&bt("Can't get session input/output count.");let s=i===4?"i32":"i64";return[Number(e.getValue(r,s)),Number(e.getValue(r+i,s))]}finally{e.stackRestore(t)}},cA=(n,e)=>{let t=Ct(),i=t.stackSave(),r=0;try{let s=t.PTR_SIZE,a=t.stackAlloc(2*s);t._OrtGetInputOutputMetadata(n,e,a,a+s)!==0&&bt("Can't get session input/output metadata.");let o=Number(t.getValue(a,"*"));r=Number(t.getValue(a+s,"*"));let l=t.HEAP32[r/4];if(l===0)return[o,0];let u=t.HEAPU32[r/4+1],c=[];for(let h=0;h<u;h++){let f=Number(t.getValue(r+8+h*s,"*"));c.push(f!==0?t.UTF8ToString(f):Number(t.getValue(r+8+(h+u)*s,"*")))}return[o,l,c]}finally{t.stackRestore(i),r!==0&&t._OrtFree(r)}},Fb=n=>{let e=Ct(),t=e._malloc(n.byteLength);if(t===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${n.byteLength}.`);return e.HEAPU8.set(n,t),[t,n.byteLength]},NC=async(n,e)=>{var h,f,m,y;let t,i,r=Ct();Array.isArray(n)?[t,i]=n:n.buffer===r.HEAPU8.buffer?[t,i]=[n.byteOffset,n.byteLength]:[t,i]=Fb(n);let s=0,a=0,o=0,l=[],u=[],c=[];try{if([a,l]=await oV(e),(e==null?void 0:e.externalData)&&r.mountExternalData){let C=[];for(let N of e.externalData){let O=typeof N=="string"?N:N.path;C.push(_C(typeof N=="string"?N:N.data).then(V=>{r.mountExternalData(O,V)}))}await Promise.all(C)}for(let C of(e==null?void 0:e.executionProviders)??[])if((typeof C=="string"?C:C.name)==="webnn"){if(r.shouldTransferToMLTensor=!1,typeof C!="string"){let N=C,O=N==null?void 0:N.context,V=N==null?void 0:N.gpuDevice,U=N==null?void 0:N.deviceType,j=N==null?void 0:N.powerPreference;O?r.currentContext=O:V?r.currentContext=await r.webnnCreateMLContext(V):r.currentContext=await r.webnnCreateMLContext({deviceType:U,powerPreference:j})}else r.currentContext=await r.webnnCreateMLContext();break}s=await r._OrtCreateSession(t,i,a),(h=r.webgpuOnCreateSession)==null||h.call(r,s),s===0&&bt("Can't create a session."),(f=r.jsepOnCreateSession)==null||f.call(r),r.currentContext&&(r.webnnRegisterMLContext(s,r.currentContext),r.currentContext=void 0,r.shouldTransferToMLTensor=!0);let[_,x]=QM(s),v=!!(e!=null&&e.enableGraphCapture),w=[],E=[],k=[],$=[],L=[];for(let C=0;C<_;C++){let[N,O,V]=cA(s,C);N===0&&bt("Can't get an input name."),u.push(N);let U=r.UTF8ToString(N);w.push(U),k.push(O===0?{name:U,isTensor:!1}:{name:U,isTensor:!0,type:Mo(O),shape:V})}for(let C=0;C<x;C++){let[N,O,V]=cA(s,C+_);N===0&&bt("Can't get an output name."),c.push(N);let U=r.UTF8ToString(N);E.push(U),$.push(O===0?{name:U,isTensor:!1}:{name:U,isTensor:!0,type:Mo(O),shape:V});{if(v&&(e==null?void 0:e.preferredOutputLocation)===void 0){L.push("gpu-buffer");continue}let j=typeof(e==null?void 0:e.preferredOutputLocation)=="string"?e.preferredOutputLocation:((m=e==null?void 0:e.preferredOutputLocation)==null?void 0:m[U])??"cpu",he=r.webnnIsGraphOutput;if(j==="cpu"&&he&&he(s,U)){L.push("ml-tensor-cpu-output");continue}if(j!=="cpu"&&j!=="cpu-pinned"&&j!=="gpu-buffer"&&j!=="ml-tensor")throw new Error(`Not supported preferred output location: ${j}.`);if(v&&j!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${j}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);L.push(j)}}let I=null;return L.some(C=>C==="gpu-buffer"||C==="ml-tensor"||C==="ml-tensor-cpu-output")&&(o=r._OrtCreateBinding(s),o===0&&bt("Can't create IO binding."),I={handle:o,outputPreferredLocations:L,outputPreferredLocationsEncoded:L.map(C=>C==="ml-tensor-cpu-output"?"ml-tensor":C).map(C=>YT(C))}),_l.set(s,[s,u,c,I,v,!1]),[s,w,E,k,$]}catch(_){throw u.forEach(x=>r._OrtFree(x)),c.forEach(x=>r._OrtFree(x)),o!==0&&r._OrtReleaseBinding(o)!==0&&bt("Can't release IO binding."),s!==0&&r._OrtReleaseSession(s)!==0&&bt("Can't release session."),_}finally{r._free(t),a!==0&&r._OrtReleaseSessionOptions(a)!==0&&bt("Can't release session options."),l.forEach(_=>r._free(_)),(y=r.unmountExternalData)==null||y.call(r)}},DC=n=>{var l,u,c;let e=Ct(),t=_l.get(n);if(!t)throw new Error(`cannot release session. invalid session id: ${n}`);let[i,r,s,a,o]=t;a&&(o&&e._OrtClearBoundOutputs(a.handle)!==0&&bt("Can't clear bound outputs."),e._OrtReleaseBinding(a.handle)!==0&&bt("Can't release IO binding.")),(l=e.jsepOnReleaseSession)==null||l.call(e,n),(u=e.webnnOnReleaseSession)==null||u.call(e,n),(c=e.webgpuOnReleaseSession)==null||c.call(e,n),r.forEach(h=>e._OrtFree(h)),s.forEach(h=>e._OrtFree(h)),e._OrtReleaseSession(i)!==0&&bt("Can't release session."),_l.delete(n)},dA=async(n,e,t,i,r,s,a=!1)=>{if(!n){e.push(0);return}let o=Ct(),l=o.PTR_SIZE,u=n[0],c=n[1],h=n[3],f=h,m,y;if(u==="string"&&(h==="gpu-buffer"||h==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(a&&h!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${s} when enableGraphCapture is true.`);if(h==="gpu-buffer"){let v=n[2].gpuBuffer;y=xc(bc(u),c);{let w=o.jsepRegisterBuffer;if(!w)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');m=w(i,s,v,y)}}else if(h==="ml-tensor"){let v=n[2].mlTensor;y=xc(bc(u),c);let w=o.webnnRegisterMLTensor;if(!w)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');m=w(i,v,bc(u),c)}else{let v=n[2];if(Array.isArray(v)){y=l*v.length,m=o._malloc(y),t.push(m);for(let w=0;w<v.length;w++){if(typeof v[w]!="string")throw new TypeError(`tensor data at index ${w} is not a string`);o.setValue(m+w*l,zs(v[w],t),"*")}}else{let w=o.webnnIsGraphInput,E=o.webnnIsGraphOutput;if(u!=="string"&&w&&E){let k=o.UTF8ToString(r);if(w(i,k)||E(i,k)){let $=bc(u);y=xc($,c),f="ml-tensor";let L=o.webnnCreateTemporaryTensor,I=o.webnnUploadTensor;if(!L||!I)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let C=await L(i,$,c);I(C,new Uint8Array(v.buffer,v.byteOffset,v.byteLength)),m=C}else y=v.byteLength,m=o._malloc(y),t.push(m),o.HEAPU8.set(new Uint8Array(v.buffer,v.byteOffset,y),m)}else y=v.byteLength,m=o._malloc(y),t.push(m),o.HEAPU8.set(new Uint8Array(v.buffer,v.byteOffset,y),m)}}let _=o.stackSave(),x=o.stackAlloc(4*c.length);try{c.forEach((w,E)=>o.setValue(x+E*l,w,l===4?"i32":"i64"));let v=o._OrtCreateTensor(bc(u),m,y,x,c.length,YT(f));v===0&&bt(`Can't create tensor for input/output. session=${i}, index=${s}.`),e.push(v)}finally{o.stackRestore(_)}},MC=async(n,e,t,i,r,s)=>{var V,U,j,he;let a=Ct(),o=a.PTR_SIZE,l=_l.get(n);if(!l)throw new Error(`cannot run inference. invalid session id: ${n}`);let u=l[0],c=l[1],h=l[2],f=l[3],m=l[4],y=l[5],_=e.length,x=i.length,v=0,w=[],E=[],k=[],$=[],L=a.stackSave(),I=a.stackAlloc(_*o),C=a.stackAlloc(_*o),N=a.stackAlloc(x*o),O=a.stackAlloc(x*o);try{[v,w]=aV(s),Od("wasm prepareInputOutputTensor");for(let G=0;G<_;G++)await dA(t[G],E,$,n,c[e[G]],e[G],m);for(let G=0;G<x;G++)await dA(r[G],k,$,n,h[i[G]],_+i[G],m);Ld("wasm prepareInputOutputTensor");for(let G=0;G<_;G++)a.setValue(I+G*o,E[G],"*"),a.setValue(C+G*o,c[e[G]],"*");for(let G=0;G<x;G++)a.setValue(N+G*o,k[G],"*"),a.setValue(O+G*o,h[i[G]],"*");if(f&&!y){let{handle:G,outputPreferredLocations:W,outputPreferredLocationsEncoded:K}=f;if(c.length!==_)throw new Error(`input count from feeds (${_}) is expected to be always equal to model's input count (${c.length}).`);Od("wasm bindInputsOutputs");for(let H=0;H<_;H++){let Q=e[H];await a._OrtBindInput(G,c[Q],E[H])!==0&&bt(`Can't bind input[${H}] for session=${n}.`)}for(let H=0;H<x;H++){let Q=i[H];(V=r[H])!=null&&V[3]?a._OrtBindOutput(G,h[Q],k[H],0)!==0&&bt(`Can't bind pre-allocated output[${H}] for session=${n}.`):a._OrtBindOutput(G,h[Q],0,K[Q])!==0&&bt(`Can't bind output[${H}] to ${W[H]} for session=${n}.`)}Ld("wasm bindInputsOutputs"),_l.set(n,[u,c,h,f,m,!0])}(U=a.jsepOnRunStart)==null||U.call(a,u),(j=a.webnnOnRunStart)==null||j.call(a,u);let me;f?me=await a._OrtRunWithBinding(u,f.handle,x,N,v):me=await a._OrtRun(u,C,I,_,O,x,N,v),me!==0&&bt("failed to call OrtRun().");let te=[],oe=[];Od("wasm ProcessOutputTensor");for(let G=0;G<x;G++){let W=Number(a.getValue(N+G*o,"*"));if(W===k[G]){te.push(r[G]);continue}let K=a.stackSave(),H=a.stackAlloc(4*o),Q=!1,Y,Z=0;try{a._OrtGetTensorData(W,H,H+o,H+2*o,H+3*o)!==0&&bt(`Can't access output tensor data on index ${G}.`);let fe=o===4?"i32":"i64",_e=Number(a.getValue(H,fe));Z=a.getValue(H+o,"*");let X=a.getValue(H+o*2,"*"),de=Number(a.getValue(H+o*3,fe)),Ee=[];for(let He=0;He<de;He++)Ee.push(Number(a.getValue(X+He*o,fe)));a._OrtFree(X)!==0&&bt("Can't free memory for tensor dims.");let $e=Ee.reduce((He,nt)=>He*nt,1);Y=Mo(_e);let je=f==null?void 0:f.outputPreferredLocations[i[G]];if(Y==="string"){if(je==="gpu-buffer"||je==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let He=[];for(let nt=0;nt<$e;nt++){let Et=a.getValue(Z+nt*o,"*"),Xt=a.getValue(Z+(nt+1)*o,"*"),Yn=nt===$e-1?void 0:Xt-Et;He.push(a.UTF8ToString(Et,Yn))}te.push([Y,Ee,He,"cpu"])}else if(je==="gpu-buffer"&&$e>0){let He=a.jsepGetBuffer;if(!He)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let nt=He(Z),Et=xc(_e,$e);if(Et===void 0||!gC(Y))throw new Error(`Unsupported data type: ${Y}`);Q=!0,te.push([Y,Ee,{gpuBuffer:nt,download:a.jsepCreateDownloader(nt,Et,Y),dispose:()=>{a._OrtReleaseTensor(W)!==0&&bt("Can't release tensor.")}},"gpu-buffer"])}else if(je==="ml-tensor"&&$e>0){let He=a.webnnEnsureTensor,nt=a.webnnIsGraphInputOutputTypeSupported;if(!He||!nt)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(xc(_e,$e)===void 0||!yC(Y))throw new Error(`Unsupported data type: ${Y}`);if(!nt(n,Y,!1))throw new Error(`preferredLocation "ml-tensor" for ${Y} output is not supported by current WebNN Context.`);let Et=await He(n,Z,_e,Ee,!1);Q=!0,te.push([Y,Ee,{mlTensor:Et,download:a.webnnCreateMLTensorDownloader(Z,Y),dispose:()=>{a.webnnReleaseTensorId(Z),a._OrtReleaseTensor(W)}},"ml-tensor"])}else if(je==="ml-tensor-cpu-output"&&$e>0){let He=a.webnnCreateMLTensorDownloader(Z,Y)(),nt=te.length;Q=!0,oe.push((async()=>{let Et=[nt,await He];return a.webnnReleaseTensorId(Z),a._OrtReleaseTensor(W),Et})()),te.push([Y,Ee,[],"cpu"])}else{let He=nx(Y),nt=new He($e);new Uint8Array(nt.buffer,nt.byteOffset,nt.byteLength).set(a.HEAPU8.subarray(Z,Z+nt.byteLength)),te.push([Y,Ee,nt,"cpu"])}}finally{a.stackRestore(K),Y==="string"&&Z&&a._free(Z),Q||a._OrtReleaseTensor(W)}}f&&!m&&(a._OrtClearBoundOutputs(f.handle)!==0&&bt("Can't clear bound outputs."),_l.set(n,[u,c,h,f,m,!1]));for(let[G,W]of await Promise.all(oe))te[G][2]=W;return Ld("wasm ProcessOutputTensor"),te}finally{(he=a.webnnOnRunEnd)==null||he.call(a,u),a.stackRestore(L),E.forEach(me=>a._OrtReleaseTensor(me)),k.forEach(me=>a._OrtReleaseTensor(me)),$.forEach(me=>a._free(me)),v!==0&&a._OrtReleaseRunOptions(v),w.forEach(me=>a._free(me))}},OC=n=>{let e=Ct(),t=_l.get(n);if(!t)throw new Error("invalid session id");let i=t[0],r=e._OrtEndProfiling(i);r===0&&bt("Can't get an profile file name."),e._OrtFree(r)},LC=n=>{let e=[];for(let t of n){let i=t[2];!Array.isArray(i)&&"buffer"in i&&e.push(i.buffer)}return e}}),vl,qi,Ch,Um,Hm,N0,hA,D0,dc,hc,JM,aU,oU,lU,uU,cU,dU,hU,fU=pe(()=>{os(),sU(),hh(),fC(),vl=()=>!!Lt.wasm.proxy&&typeof document<"u",Ch=!1,Um=!1,Hm=!1,D0=new Map,dc=(n,e)=>{let t=D0.get(n);t?t.push(e):D0.set(n,[e])},hc=()=>{if(Ch||!Um||Hm||!qi)throw new Error("worker not ready")},JM=n=>{switch(n.data.type){case"init-wasm":Ch=!1,n.data.err?(Hm=!0,hA[1](n.data.err)):(Um=!0,hA[0]()),N0&&(URL.revokeObjectURL(N0),N0=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let e=D0.get(n.data.type);n.data.err?e.shift()[1](n.data.err):e.shift()[0](n.data.out);break}}},aU=async()=>{if(!Um){if(Ch)throw new Error("multiple calls to 'initWasm()' detected.");if(Hm)throw new Error("previous call to 'initWasm()' failed.");if(Ch=!0,vl())return new Promise((n,e)=>{qi==null||qi.terminate(),rV().then(([t,i])=>{try{qi=i,qi.onerror=s=>e(s),qi.onmessage=JM,hA=[n,e];let r={type:"init-wasm",in:Lt};!r.in.wasm.wasmPaths&&(t||KT)&&(r.in.wasm.wasmPaths={wasm:new URL("/blood-report-fitness-evaluation-system/assets/ort-wasm-simd-threaded.jsep-BGTZ4Y7F.wasm",import.meta.url).href}),qi.postMessage(r),N0=t}catch(r){e(r)}},e)});try{await pC(Lt.wasm),await RC(Lt),Um=!0}catch(n){throw Hm=!0,n}finally{Ch=!1}}},oU=async n=>{if(vl())return hc(),new Promise((e,t)=>{dc("init-ep",[e,t]);let i={type:"init-ep",in:{epName:n,env:Lt}};qi.postMessage(i)});await PC(Lt,n)},lU=async n=>vl()?(hc(),new Promise((e,t)=>{dc("copy-from",[e,t]);let i={type:"copy-from",in:{buffer:n}};qi.postMessage(i,[n.buffer])})):Fb(n),uU=async(n,e)=>{if(vl()){if(e!=null&&e.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return hc(),new Promise((t,i)=>{dc("create",[t,i]);let r={type:"create",in:{model:n,options:{...e}}},s=[];n instanceof Uint8Array&&s.push(n.buffer),qi.postMessage(r,s)})}else return NC(n,e)},cU=async n=>{if(vl())return hc(),new Promise((e,t)=>{dc("release",[e,t]);let i={type:"release",in:n};qi.postMessage(i)});DC(n)},dU=async(n,e,t,i,r,s)=>{if(vl()){if(t.some(a=>a[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(r.some(a=>a))throw new Error("pre-allocated output tensor is not supported for proxy.");return hc(),new Promise((a,o)=>{dc("run",[a,o]);let l=t,u={type:"run",in:{sessionId:n,inputIndices:e,inputs:l,outputIndices:i,options:s}};qi.postMessage(u,LC(l))})}else return MC(n,e,t,i,r,s)},hU=async n=>{if(vl())return hc(),new Promise((e,t)=>{dc("end-profiling",[e,t]);let i={type:"end-profiling",in:n};qi.postMessage(i)});OC(n)}}),fA,ZM,pU,LZ=pe(()=>{os(),fU(),Fe(),hC(),lV(),fA=(n,e)=>{switch(n.location){case"cpu":return[n.type,n.dims,n.data,"cpu"];case"gpu-buffer":return[n.type,n.dims,{gpuBuffer:n.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[n.type,n.dims,{mlTensor:n.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${n.location} for ${e()}`)}},ZM=n=>{switch(n[3]){case"cpu":return new Na(n[0],n[2],n[1]);case"gpu-buffer":{let e=n[0];if(!gC(e))throw new Error(`not supported data type: ${e} for deserializing GPU tensor`);let{gpuBuffer:t,download:i,dispose:r}=n[2];return Na.fromGpuBuffer(t,{dataType:e,dims:n[1],download:i,dispose:r})}case"ml-tensor":{let e=n[0];if(!yC(e))throw new Error(`not supported data type: ${e} for deserializing MLTensor tensor`);let{mlTensor:t,download:i,dispose:r}=n[2];return Na.fromMLTensor(t,{dataType:e,dims:n[1],download:i,dispose:r})}default:throw new Error(`invalid data location: ${n[3]}`)}},pU=class{async fetchModelAndCopyToWasmMemory(n){return lU(await _C(n))}async loadModel(n,e){Ua();let t;typeof n=="string"?t=await this.fetchModelAndCopyToWasmMemory(n):t=n,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await uU(t,e),Gs()}async dispose(){return cU(this.sessionId)}async run(n,e,t){Ua();let i=[],r=[];Object.entries(n).forEach(h=>{let f=h[0],m=h[1],y=this.inputNames.indexOf(f);if(y===-1)throw new Error(`invalid input '${f}'`);i.push(m),r.push(y)});let s=[],a=[];Object.entries(e).forEach(h=>{let f=h[0],m=h[1],y=this.outputNames.indexOf(f);if(y===-1)throw new Error(`invalid output '${f}'`);s.push(m),a.push(y)});let o=i.map((h,f)=>fA(h,()=>`input "${this.inputNames[r[f]]}"`)),l=s.map((h,f)=>h?fA(h,()=>`output "${this.outputNames[a[f]]}"`):null),u=await dU(this.sessionId,r,o,a,l,t),c={};for(let h=0;h<u.length;h++)c[this.outputNames[a[h]]]=s[h]??ZM(u[h]);return Gs(),c}startProfiling(){}endProfiling(){hU(this.sessionId)}}}),mU={};Zp(mU,{OnnxruntimeWebAssemblyBackend:()=>uS,initializeFlags:()=>lS,wasmBackend:()=>gU});var lS,uS,gU,FZ=pe(()=>{os(),fU(),LZ(),lS=()=>{(typeof Lt.wasm.initTimeout!="number"||Lt.wasm.initTimeout<0)&&(Lt.wasm.initTimeout=0);let n=Lt.wasm.simd;if(typeof n!="boolean"&&n!==void 0&&n!=="fixed"&&n!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${n}". Reset it to \`false\` and ignore SIMD feature checking.`),Lt.wasm.simd=!1),typeof Lt.wasm.proxy!="boolean"&&(Lt.wasm.proxy=!1),typeof Lt.wasm.trace!="boolean"&&(Lt.wasm.trace=!1),typeof Lt.wasm.numThreads!="number"||!Number.isInteger(Lt.wasm.numThreads)||Lt.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)Lt.wasm.numThreads=1;else{let e=typeof navigator>"u"?EJ("node:os").cpus().length:navigator.hardwareConcurrency;Lt.wasm.numThreads=Math.min(4,Math.ceil((e||1)/2))}},uS=class{async init(n){lS(),await aU(),await oU(n)}async createInferenceSessionHandler(n,e){let t=new pU;return await t.loadModel(n,e),t}},gU=new uS});os();os();os();var zZ="1.23.2";{let n=(FZ(),vy(mU)).wasmBackend;rf("webgpu",n,5),rf("webnn",n,5),rf("cpu",n,10),rf("wasm",n,10)}Object.defineProperty(Lt.versions,"web",{value:zZ,enumerable:!0});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VZ=({predictions:n})=>!n||n.length===0?T.jsxs("div",{className:"prediction-card safe fade-in",children:[T.jsx("div",{className:"status-icon",children:""}),T.jsxs("div",{className:"content",children:[T.jsx("h3",{children:"Great News!"}),T.jsx("p",{children:"Our AI didn't detect any high-risk patterns in your report."})]})]}):T.jsxs("div",{className:"prediction-container fade-in",children:[T.jsx("h3",{children:"AI Health Insights "}),T.jsx("p",{className:"disclaimer",children:"Based on your blood values, we identified potential risks:"}),T.jsx("div",{className:"prediction-list",children:n.map((e,t)=>T.jsxs("div",{className:"prediction-card warning",children:[T.jsx("div",{className:"status-icon",children:""}),T.jsxs("div",{className:"content",children:[T.jsx("h4",{children:e.label}),T.jsx("p",{children:e.warning})]})]},t))}),T.jsx("div",{className:"recommendation",children:T.jsxs("p",{children:[T.jsx("strong",{children:"Recommendation:"})," Please consult a certified doctor for precise diagnosis."]})}),T.jsx("style",{children:`
                .prediction-container {
                    margin-top: 20px;
                    padding: 20px;
                    background: #fff;
                    border-radius: 16px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
                    border: 1px solid #f1f5f9;
                }
                .prediction-container h3 {
                    margin: 0 0 10px 0;
                    color: #1e293b;
                    font-size: 18px;
                }
                .disclaimer {
                    color: #64748b;
                    font-size: 13px;
                    margin-bottom: 15px;
                }
                .prediction-list {
                    display: flex;
                    flex-direction: column;
                    gap: 12px;
                }
                .prediction-card {
                    display: flex;
                    align-items: flex-start;
                    gap: 15px;
                    padding: 16px;
                    border-radius: 12px;
                }
                .prediction-card.safe {
                    background: #f0fdf4;
                    border: 1px solid #dcfce7;
                }
                .prediction-card.warning {
                    background: #fef2f2;
                    border: 1px solid #fee2e2;
                }
                .status-icon {
                    font-size: 24px;
                }
                .content h3, .content h4 {
                    margin: 0 0 5px 0;
                    color: #1e293b;
                }
                .content p {
                    margin: 0;
                    font-size: 13px;
                    color: #475569;
                    line-height: 1.4;
                }
                .recommendation {
                    margin-top: 20px;
                    padding-top: 15px;
                    border-top: 1px solid #e2e8f0;
                    font-size: 13px;
                    color: #334155;
                }
            `})]});var Hg={};Hg.d=(n,e)=>{for(var t in e)Hg.o(e,t)&&!Hg.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})};Hg.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var Ge=globalThis.pdfjsLib={};Hg.d(Ge,{AbortException:()=>Nu,AnnotationEditorLayer:()=>_2,AnnotationEditorParamsType:()=>ht,AnnotationEditorType:()=>Ze,AnnotationEditorUIManager:()=>eh,AnnotationLayer:()=>Mte,AnnotationMode:()=>$l,ColorPicker:()=>Hb,DOMSVGFactory:()=>qC,DrawLayer:()=>b2,FeatureTest:()=>Oi,GlobalWorkerOptions:()=>Oo,ImageKind:()=>cw,InvalidPDFException:()=>dS,MissingPDFException:()=>by,OPS:()=>As,OutputScale:()=>fS,PDFDataRangeTransport:()=>_5,PDFDateString:()=>BC,PDFWorker:()=>wf,PasswordResponses:()=>HZ,PermissionFlag:()=>UZ,PixelsPerInch:()=>Du,RenderingCancelledException:()=>VC,TextLayer:()=>xy,TouchManager:()=>Bb,UnexpectedResponseException:()=>zb,Util:()=>Me,VerbosityLevel:()=>ix,XfaLayer:()=>w5,build:()=>mte,createValidAbsoluteUrl:()=>KZ,fetchData:()=>ox,getDocument:()=>ate,getFilenameFromUrl:()=>iee,getPdfFilenameFromUrl:()=>ree,getXfaPageViewport:()=>see,isDataScheme:()=>lx,isPdfFile:()=>jC,noContextMenu:()=>Js,normalizeUnicode:()=>eee,setLayerDimensions:()=>Zd,shadow:()=>st,stopEvent:()=>Rr,version:()=>pte});const xi=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),yU=[1,0,0,1,0,0],cS=[.001,0,0,.001,0,0],jZ=1e7,pA=1.35,Tr={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},$l={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},BZ="pdfjs_internal_editor_",Ze={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},ht={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},UZ={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},ci={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},cw={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},An={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,WIDGET:20},Wm={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},ix={ERRORS:0,WARNINGS:1,INFOS:5},As={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},HZ={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let rx=ix.WARNINGS;function WZ(n){Number.isInteger(n)&&(rx=n)}function qZ(){return rx}function sx(n){rx>=ix.INFOS&&console.log(`Info: ${n}`)}function et(n){rx>=ix.WARNINGS&&console.log(`Warning: ${n}`)}function Dt(n){throw new Error(n)}function bn(n,e){n||Dt(e)}function GZ(n){switch(n==null?void 0:n.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function KZ(n,e=null,t=null){if(!n)return null;try{if(t&&typeof n=="string"){if(t.addDefaultProtocol&&n.startsWith("www.")){const r=n.match(/\./g);(r==null?void 0:r.length)>=2&&(n=`http://${n}`)}if(t.tryConvertEncoding)try{n=ZZ(n)}catch{}}const i=e?new URL(n,e):new URL(n);if(GZ(i))return i}catch{}return null}function st(n,e,t,i=!1){return Object.defineProperty(n,e,{value:t,enumerable:!i,configurable:!0,writable:!1}),t}const Wu=function(){function e(t,i){this.message=t,this.name=i}return e.prototype=new Error,e.constructor=e,e}();class e3 extends Wu{constructor(e,t){super(e,"PasswordException"),this.code=t}}class mA extends Wu{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class dS extends Wu{constructor(e){super(e,"InvalidPDFException")}}class by extends Wu{constructor(e){super(e,"MissingPDFException")}}class zb extends Wu{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}}class YZ extends Wu{constructor(e){super(e,"FormatError")}}class Nu extends Wu{constructor(e){super(e,"AbortException")}}function _U(n){(typeof n!="object"||(n==null?void 0:n.length)===void 0)&&Dt("Invalid argument for bytesToString");const e=n.length,t=8192;if(e<t)return String.fromCharCode.apply(null,n);const i=[];for(let r=0;r<e;r+=t){const s=Math.min(r+t,e),a=n.subarray(r,s);i.push(String.fromCharCode.apply(null,a))}return i.join("")}function ax(n){typeof n!="string"&&Dt("Invalid argument for stringToBytes");const e=n.length,t=new Uint8Array(e);for(let i=0;i<e;++i)t[i]=n.charCodeAt(i)&255;return t}function XZ(n){return String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,n&255)}function FC(n){const e=Object.create(null);for(const[t,i]of n)e[t]=i;return e}function QZ(){const n=new Uint8Array(4);return n[0]=1,new Uint32Array(n.buffer,0,1)[0]===1}function JZ(){try{return new Function(""),!0}catch{return!1}}class Oi{static get isLittleEndian(){return st(this,"isLittleEndian",QZ())}static get isEvalSupported(){return st(this,"isEvalSupported",JZ())}static get isOffscreenCanvasSupported(){return st(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return st(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.platform)=="string"?st(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof(navigator==null?void 0:navigator.userAgent)=="string"&&navigator.userAgent.includes("Firefox")}):st(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var e,t;return st(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const gA=Array.from(Array(256).keys(),n=>n.toString(16).padStart(2,"0"));var Wo,dw,hS;class Me{static makeHexColor(e,t,i){return`#${gA[e]}${gA[t]}${gA[i]}`}static scaleMinMax(e,t){let i;e[0]?(e[0]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[3],t[3]*=e[3]):(i=t[0],t[0]=t[1],t[1]=i,i=t[2],t[2]=t[3],t[3]=i,e[1]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){const i=e[0]*t[0]+e[1]*t[2]+t[4],r=e[0]*t[1]+e[1]*t[3]+t[5];return[i,r]}static applyInverseTransform(e,t){const i=t[0]*t[3]-t[1]*t[2],r=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/i,s=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/i;return[r,s]}static getAxialAlignedBoundingBox(e,t){const i=this.applyTransform(e,t),r=this.applyTransform(e.slice(2,4),t),s=this.applyTransform([e[0],e[3]],t),a=this.applyTransform([e[2],e[1]],t);return[Math.min(i[0],r[0],s[0],a[0]),Math.min(i[1],r[1],s[1],a[1]),Math.max(i[0],r[0],s[0],a[0]),Math.max(i[1],r[1],s[1],a[1])]}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){const t=[e[0],e[2],e[1],e[3]],i=e[0]*t[0]+e[1]*t[2],r=e[0]*t[1]+e[1]*t[3],s=e[2]*t[0]+e[3]*t[2],a=e[2]*t[1]+e[3]*t[3],o=(i+a)/2,l=Math.sqrt((i+a)**2-4*(i*a-s*r))/2,u=o+l||1,c=o-l||1;return[Math.sqrt(u),Math.sqrt(c)]}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const i=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),r=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(i>r)return null;const s=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return s>a?null:[i,s,r,a]}static bezierBoundingBox(e,t,i,r,s,a,o,l,u){return u?(u[0]=Math.min(u[0],e,o),u[1]=Math.min(u[1],t,l),u[2]=Math.max(u[2],e,o),u[3]=Math.max(u[3],t,l)):u=[Math.min(e,o),Math.min(t,l),Math.max(e,o),Math.max(t,l)],z(this,Wo,hS).call(this,e,i,s,o,t,r,a,l,3*(-e+3*(i-s)+o),6*(e-2*i+s),3*(i-e),u),z(this,Wo,hS).call(this,e,i,s,o,t,r,a,l,3*(-t+3*(r-a)+l),6*(t-2*r+a),3*(r-t),u),u}}Wo=new WeakSet,dw=function(e,t,i,r,s,a,o,l,u,c){if(u<=0||u>=1)return;const h=1-u,f=u*u,m=f*u,y=h*(h*(h*e+3*u*t)+3*f*i)+m*r,_=h*(h*(h*s+3*u*a)+3*f*o)+m*l;c[0]=Math.min(c[0],y),c[1]=Math.min(c[1],_),c[2]=Math.max(c[2],y),c[3]=Math.max(c[3],_)},hS=function(e,t,i,r,s,a,o,l,u,c,h,f){if(Math.abs(u)<1e-12){Math.abs(c)>=1e-12&&z(this,Wo,dw).call(this,e,t,i,r,s,a,o,l,-h/c,f);return}const m=c**2-4*h*u;if(m<0)return;const y=Math.sqrt(m),_=2*u;z(this,Wo,dw).call(this,e,t,i,r,s,a,o,l,(-c+y)/_,f),z(this,Wo,dw).call(this,e,t,i,r,s,a,o,l,(-c-y)/_,f)},F(Me,Wo);function ZZ(n){return decodeURIComponent(escape(n))}let yA=null,t3=null;function eee(n){return yA||(yA=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,t3=new Map([["","t"]])),n.replaceAll(yA,(e,t,i)=>t?t.normalize("NFKC"):t3.get(i))}function tee(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const n=new Uint8Array(32);return crypto.getRandomValues(n),_U(n)}const zC="pdfjs_internal_id_";function nee(n){return Uint8Array.prototype.toBase64?n.toBase64():btoa(_U(n))}typeof Promise.try!="function"&&(Promise.try=function(n,...e){return new Promise(t=>{t(n(...e))})});const no="http://www.w3.org/2000/svg",Ec=class Ec{};ze(Ec,"CSS",96),ze(Ec,"PDF",72),ze(Ec,"PDF_TO_CSS_UNITS",Ec.CSS/Ec.PDF);let Du=Ec;async function ox(n,e="text"){if(cg(n,document.baseURI)){const t=await fetch(n);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,i)=>{const r=new XMLHttpRequest;r.open("GET",n,!0),r.responseType=e,r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE){if(r.status===200||r.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(r.response);return}t(r.responseText);return}i(new Error(r.statusText))}},r.send(null)})}class fv{constructor({viewBox:e,userUnit:t,scale:i,rotation:r,offsetX:s=0,offsetY:a=0,dontFlip:o=!1}){this.viewBox=e,this.userUnit=t,this.scale=i,this.rotation=r,this.offsetX=s,this.offsetY=a,i*=t;const l=(e[2]+e[0])/2,u=(e[3]+e[1])/2;let c,h,f,m;switch(r%=360,r<0&&(r+=360),r){case 180:c=-1,h=0,f=0,m=1;break;case 90:c=0,h=1,f=1,m=0;break;case 270:c=0,h=-1,f=-1,m=0;break;case 0:c=1,h=0,f=0,m=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(f=-f,m=-m);let y,_,x,v;c===0?(y=Math.abs(u-e[1])*i+s,_=Math.abs(l-e[0])*i+a,x=(e[3]-e[1])*i,v=(e[2]-e[0])*i):(y=Math.abs(l-e[0])*i+s,_=Math.abs(u-e[1])*i+a,x=(e[2]-e[0])*i,v=(e[3]-e[1])*i),this.transform=[c*i,h*i,f*i,m*i,y-c*i*l-f*i*u,_-h*i*l-m*i*u],this.width=x,this.height=v}get rawDims(){const{userUnit:e,viewBox:t}=this,i=t.map(r=>r*e);return st(this,"rawDims",{pageWidth:i[2]-i[0],pageHeight:i[3]-i[1],pageX:i[0],pageY:i[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:i=this.offsetX,offsetY:r=this.offsetY,dontFlip:s=!1}={}){return new fv({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:i,offsetY:r,dontFlip:s})}convertToViewportPoint(e,t){return Me.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=Me.applyTransform([e[0],e[1]],this.transform),i=Me.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],i[0],i[1]]}convertToPdfPoint(e,t){return Me.applyInverseTransform([e,t],this.transform)}}class VC extends Wu{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function lx(n){const e=n.length;let t=0;for(;t<e&&n[t].trim()==="";)t++;return n.substring(t,t+5).toLowerCase()==="data:"}function jC(n){return typeof n=="string"&&/\.pdf$/i.test(n)}function iee(n){return[n]=n.split(/[#?]/,1),n.substring(n.lastIndexOf("/")+1)}function ree(n,e="document.pdf"){if(typeof n!="string")return e;if(lx(n))return et('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,i=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,r=t.exec(n);let s=i.exec(r[1])||i.exec(r[2])||i.exec(r[3]);if(s&&(s=s[0],s.includes("%")))try{s=i.exec(decodeURIComponent(s))[0]}catch{}return s||e}class n3{constructor(){ze(this,"started",Object.create(null));ze(this,"times",[])}time(e){e in this.started&&et(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||et(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:i}of this.times)t=Math.max(i.length,t);for(const{name:i,start:r,end:s}of this.times)e.push(`${i.padEnd(t)} ${s-r}ms
`);return e.join("")}}function cg(n,e){try{const{protocol:t}=e?new URL(n,e):new URL(n);return t==="http:"||t==="https:"}catch{return!1}}function Js(n){n.preventDefault()}function Rr(n){n.preventDefault(),n.stopPropagation()}var Ay;class BC{static toDateObject(e){if(!e||typeof e!="string")return null;d(this,Ay)||P(this,Ay,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=d(this,Ay).exec(e);if(!t)return null;const i=parseInt(t[1],10);let r=parseInt(t[2],10);r=r>=1&&r<=12?r-1:0;let s=parseInt(t[3],10);s=s>=1&&s<=31?s:1;let a=parseInt(t[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(t[5],10);o=o>=0&&o<=59?o:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;const u=t[7]||"Z";let c=parseInt(t[8],10);c=c>=0&&c<=23?c:0;let h=parseInt(t[9],10)||0;return h=h>=0&&h<=59?h:0,u==="-"?(a+=c,o+=h):u==="+"&&(a-=c,o-=h),new Date(Date.UTC(i,r,s,a,o,l))}}Ay=new WeakMap,F(BC,Ay);function see(n,{scale:e=1,rotation:t=0}){const{width:i,height:r}=n.attributes.style,s=[0,0,parseInt(i),parseInt(r)];return new fv({viewBox:s,userUnit:1,scale:e,rotation:t})}function UC(n){if(n.startsWith("#")){const e=parseInt(n.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return n.startsWith("rgb(")?n.slice(4,-1).split(",").map(e=>parseInt(e)):n.startsWith("rgba(")?n.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(et(`Not a valid color format: "${n}"`),[0,0,0])}function aee(n){const e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(const t of n.keys()){e.style.color=t;const i=window.getComputedStyle(e).color;n.set(t,UC(i))}e.remove()}function qt(n){const{a:e,b:t,c:i,d:r,e:s,f:a}=n.getTransform();return[e,t,i,r,s,a]}function ca(n){const{a:e,b:t,c:i,d:r,e:s,f:a}=n.getTransform().invertSelf();return[e,t,i,r,s,a]}function Zd(n,e,t=!1,i=!0){if(e instanceof fv){const{pageWidth:r,pageHeight:s}=e.rawDims,{style:a}=n,o=Oi.isCSSRoundSupported,l=`var(--scale-factor) * ${r}px`,u=`var(--scale-factor) * ${s}px`,c=o?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,h=o?`round(down, ${u}, var(--scale-round-y, 1px))`:`calc(${u})`;!t||e.rotation%180===0?(a.width=c,a.height=h):(a.width=h,a.height=c)}i&&n.setAttribute("data-main-rotation",e.rotation)}class fS{constructor(){const e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}}var Rl,kc,Ts,$c,Ty,Sy,Kb,vU,Li,wU,bU,hw,xU,mS;const ao=class ao{constructor(e){F(this,Li);F(this,Rl,null);F(this,kc,null);F(this,Ts);F(this,$c,null);F(this,Ty,null);P(this,Ts,e),d(ao,Sy)||P(ao,Sy,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){const e=P(this,Rl,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=d(this,Ts)._uiManager._signal;e.addEventListener("contextmenu",Js,{signal:t}),e.addEventListener("pointerdown",z(ao,Kb,vU),{signal:t});const i=P(this,$c,document.createElement("div"));i.className="buttons",e.append(i);const r=d(this,Ts).toolbarPosition;if(r){const{style:s}=e,a=d(this,Ts)._uiManager.direction==="ltr"?1-r[0]:r[0];s.insetInlineEnd=`${100*a}%`,s.top=`calc(${100*r[1]}% + var(--editor-toolbar-vert-offset))`}return z(this,Li,xU).call(this),e}get div(){return d(this,Rl)}hide(){var e;d(this,Rl).classList.add("hidden"),(e=d(this,kc))==null||e.hideDropdown()}show(){var e;d(this,Rl).classList.remove("hidden"),(e=d(this,Ty))==null||e.shown()}async addAltText(e){const t=await e.render();z(this,Li,hw).call(this,t),d(this,$c).prepend(t,d(this,Li,mS)),P(this,Ty,e)}addColorPicker(e){P(this,kc,e);const t=e.renderButton();z(this,Li,hw).call(this,t),d(this,$c).prepend(t,d(this,Li,mS))}remove(){var e;d(this,Rl).remove(),(e=d(this,kc))==null||e.destroy(),P(this,kc,null)}};Rl=new WeakMap,kc=new WeakMap,Ts=new WeakMap,$c=new WeakMap,Ty=new WeakMap,Sy=new WeakMap,Kb=new WeakSet,vU=function(e){e.stopPropagation()},Li=new WeakSet,wU=function(e){d(this,Ts)._focusEventsAllowed=!1,Rr(e)},bU=function(e){d(this,Ts)._focusEventsAllowed=!0,Rr(e)},hw=function(e){const t=d(this,Ts)._uiManager._signal;e.addEventListener("focusin",z(this,Li,wU).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",z(this,Li,bU).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Js,{signal:t})},xU=function(){const{editorType:e,_uiManager:t}=d(this,Ts),i=document.createElement("button");i.className="delete",i.tabIndex=0,i.setAttribute("data-l10n-id",d(ao,Sy)[e]),z(this,Li,hw).call(this,i),i.addEventListener("click",r=>{t.delete()},{signal:t._signal}),d(this,$c).append(i)},mS=function(){const e=document.createElement("div");return e.className="divider",e},F(ao,Kb),F(ao,Sy,null);let pS=ao;var Iy,Rc,Pc,Mu,EU,AU,TU;class oee{constructor(e){F(this,Mu);F(this,Iy,null);F(this,Rc,null);F(this,Pc);P(this,Pc,e)}show(e,t,i){const[r,s]=z(this,Mu,AU).call(this,t,i),{style:a}=d(this,Rc)||P(this,Rc,z(this,Mu,EU).call(this));e.append(d(this,Rc)),a.insetInlineEnd=`${100*r}%`,a.top=`calc(${100*s}% + var(--editor-toolbar-vert-offset))`}hide(){d(this,Rc).remove()}}Iy=new WeakMap,Rc=new WeakMap,Pc=new WeakMap,Mu=new WeakSet,EU=function(){const e=P(this,Rc,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",Js,{signal:d(this,Pc)._signal});const t=P(this,Iy,document.createElement("div"));return t.className="buttons",e.append(t),z(this,Mu,TU).call(this),e},AU=function(e,t){let i=0,r=0;for(const s of e){const a=s.y+s.height;if(a<i)continue;const o=s.x+(t?s.width:0);if(a>i){r=o,i=a;continue}t?o>r&&(r=o):o<r&&(r=o)}return[t?1-r:r,i]},TU=function(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const i=d(this,Pc)._signal;e.addEventListener("contextmenu",Js,{signal:i}),e.addEventListener("click",()=>{d(this,Pc).highlightSelection("floating_button")},{signal:i}),d(this,Iy).append(e)};function Vb(n,e,t){for(const i of t)e.addEventListener(i,n[i].bind(n))}var Yb;class lee{constructor(){F(this,Yb,0)}get id(){return`${BZ}${Ii(this,Yb)._++}`}}Yb=new WeakMap;var bf,Cy,fi,xf,fw;const YC=class YC{constructor(){F(this,xf);F(this,bf,tee());F(this,Cy,0);F(this,fi,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',i=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),r=new Image;r.src=e;const s=r.decode().then(()=>(i.drawImage(r,0,0,1,1,0,0,1,3),new Uint32Array(i.getImageData(0,0,1,1).data.buffer)[0]===0));return st(this,"_isSVGFittingCanvas",s)}async getFromFile(e){const{lastModified:t,name:i,size:r,type:s}=e;return z(this,xf,fw).call(this,`${t}_${i}_${r}_${s}`,e)}async getFromUrl(e){return z(this,xf,fw).call(this,e,e)}async getFromBlob(e,t){const i=await t;return z(this,xf,fw).call(this,e,i)}async getFromId(e){d(this,fi)||P(this,fi,new Map);const t=d(this,fi).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:i}=t;return delete t.blobPromise,this.getFromBlob(t.id,i)}return this.getFromUrl(t.url)}getFromCanvas(e,t){d(this,fi)||P(this,fi,new Map);let i=d(this,fi).get(e);if(i!=null&&i.bitmap)return i.refCounter+=1,i;const r=new OffscreenCanvas(t.width,t.height);return r.getContext("2d").drawImage(t,0,0),i={bitmap:r.transferToImageBitmap(),id:`image_${d(this,bf)}_${Ii(this,Cy)._++}`,refCounter:1,isSvg:!1},d(this,fi).set(e,i),d(this,fi).set(i.id,i),i}getSvgUrl(e){const t=d(this,fi).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var r;d(this,fi)||P(this,fi,new Map);const t=d(this,fi).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:i}=t;if(!t.url&&!t.file){const s=new OffscreenCanvas(i.width,i.height);s.getContext("bitmaprenderer").transferFromImageBitmap(i),t.blobPromise=s.convertToBlob()}(r=i.close)==null||r.call(i),t.bitmap=null}isValidId(e){return e.startsWith(`image_${d(this,bf)}_`)}};bf=new WeakMap,Cy=new WeakMap,fi=new WeakMap,xf=new WeakSet,fw=async function(e,t){d(this,fi)||P(this,fi,new Map);let i=d(this,fi).get(e);if(i===null)return null;if(i!=null&&i.bitmap)return i.refCounter+=1,i;try{i||(i={bitmap:null,id:`image_${d(this,bf)}_${Ii(this,Cy)._++}`,refCounter:0,isSvg:!1});let r;if(typeof t=="string"?(i.url=t,r=await ox(t,"blob")):t instanceof File?r=i.file=t:t instanceof Blob&&(r=t),r.type==="image/svg+xml"){const s=YC._isSVGFittingCanvas,a=new FileReader,o=new Image,l=new Promise((u,c)=>{o.onload=()=>{i.bitmap=o,i.isSvg=!0,u()},a.onload=async()=>{const h=i.svgUrl=a.result;o.src=await s?`${h}#svgView(preserveAspectRatio(none))`:h},o.onerror=a.onerror=c});a.readAsDataURL(r),await l}else i.bitmap=await createImageBitmap(r);i.refCounter=1}catch(r){et(r),i=null}return d(this,fi).set(e,i),i&&d(this,fi).set(i.id,i),i};let gS=YC;var cn,Pl,ky,Qt;class uee{constructor(e=128){F(this,cn,[]);F(this,Pl,!1);F(this,ky);F(this,Qt,-1);P(this,ky,e)}add({cmd:e,undo:t,post:i,mustExec:r,type:s=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(r&&e(),d(this,Pl))return;const l={cmd:e,undo:t,post:i,type:s};if(d(this,Qt)===-1){d(this,cn).length>0&&(d(this,cn).length=0),P(this,Qt,0),d(this,cn).push(l);return}if(a&&d(this,cn)[d(this,Qt)].type===s){o&&(l.undo=d(this,cn)[d(this,Qt)].undo),d(this,cn)[d(this,Qt)]=l;return}const u=d(this,Qt)+1;u===d(this,ky)?d(this,cn).splice(0,1):(P(this,Qt,u),u<d(this,cn).length&&d(this,cn).splice(u)),d(this,cn).push(l)}undo(){if(d(this,Qt)===-1)return;P(this,Pl,!0);const{undo:e,post:t}=d(this,cn)[d(this,Qt)];e(),t==null||t(),P(this,Pl,!1),P(this,Qt,d(this,Qt)-1)}redo(){if(d(this,Qt)<d(this,cn).length-1){P(this,Qt,d(this,Qt)+1),P(this,Pl,!0);const{cmd:e,post:t}=d(this,cn)[d(this,Qt)];e(),t==null||t(),P(this,Pl,!1)}}hasSomethingToUndo(){return d(this,Qt)!==-1}hasSomethingToRedo(){return d(this,Qt)<d(this,cn).length-1}cleanType(e){if(d(this,Qt)!==-1){for(let t=d(this,Qt);t>=0;t--)if(d(this,cn)[t].type!==e){d(this,cn).splice(t+1,d(this,Qt)-t),P(this,Qt,t);return}d(this,cn).length=0,P(this,Qt,-1)}}destroy(){P(this,cn,null)}}cn=new WeakMap,Pl=new WeakMap,ky=new WeakMap,Qt=new WeakMap;var Xb,SU;class pv{constructor(e){F(this,Xb);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=Oi.platform;for(const[i,r,s={}]of e)for(const a of i){const o=a.startsWith("mac+");t&&o?(this.callbacks.set(a.slice(4),{callback:r,options:s}),this.allKeys.add(a.split("+").at(-1))):!t&&!o&&(this.callbacks.set(a,{callback:r,options:s}),this.allKeys.add(a.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const i=this.callbacks.get(z(this,Xb,SU).call(this,t));if(!i)return;const{callback:r,options:{bubbles:s=!1,args:a=[],checker:o=null}}=i;o&&!o(e,t)||(r.bind(e,...a,t)(),s||Rr(t))}}Xb=new WeakSet,SU=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const Qb=class Qb{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return aee(e),st(this,"_colors",e)}convert(e){const t=UC(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[i,r]of this._colors)if(r.every((s,a)=>s===t[a]))return Qb._colorsMapping.get(i);return t}getHexCode(e){const t=this._colors.get(e);return t?Me.makeHexColor(...t):e}};ze(Qb,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let yS=Qb;var Ef,fr,Sn,Xn,Af,uo,Tf,Hr,Nl,Nc,Sf,Dc,ma,Ss,Mc,$y,Ry,If,Py,ga,Dl,Cf,Ml,ya,Jb,Ol,Ny,Ll,Oc,Dy,My,Ln,Tt,co,Lc,Oy,Ly,Fl,_a,ho,Fy,Wr,we,pw,_S,IU,CU,mw,kU,$U,RU,vS,PU,wS,bS,NU,ki,io,DU,MU,xS,OU,dg,ES;const af=class af{constructor(e,t,i,r,s,a,o,l,u,c,h,f,m){F(this,we);F(this,Ef,new AbortController);F(this,fr,null);F(this,Sn,new Map);F(this,Xn,new Map);F(this,Af,null);F(this,uo,null);F(this,Tf,null);F(this,Hr,new uee);F(this,Nl,null);F(this,Nc,null);F(this,Sf,0);F(this,Dc,new Set);F(this,ma,null);F(this,Ss,null);F(this,Mc,new Set);ze(this,"_editorUndoBar",null);F(this,$y,!1);F(this,Ry,!1);F(this,If,!1);F(this,Py,null);F(this,ga,null);F(this,Dl,null);F(this,Cf,null);F(this,Ml,!1);F(this,ya,null);F(this,Jb,new lee);F(this,Ol,!1);F(this,Ny,!1);F(this,Ll,null);F(this,Oc,null);F(this,Dy,null);F(this,My,null);F(this,Ln,Ze.NONE);F(this,Tt,new Set);F(this,co,null);F(this,Lc,null);F(this,Oy,null);F(this,Ly,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});F(this,Fl,[0,0]);F(this,_a,null);F(this,ho,null);F(this,Fy,null);F(this,Wr,null);const y=this._signal=d(this,Ef).signal;P(this,ho,e),P(this,Fy,t),P(this,Af,i),this._eventBus=r,r._on("editingaction",this.onEditingAction.bind(this),{signal:y}),r._on("pagechanging",this.onPageChanging.bind(this),{signal:y}),r._on("scalechanging",this.onScaleChanging.bind(this),{signal:y}),r._on("rotationchanging",this.onRotationChanging.bind(this),{signal:y}),r._on("setpreference",this.onSetPreference.bind(this),{signal:y}),r._on("switchannotationeditorparams",_=>this.updateParams(_.type,_.value),{signal:y}),z(this,we,kU).call(this),z(this,we,NU).call(this),z(this,we,vS).call(this),P(this,uo,s.annotationStorage),P(this,Py,s.filterFactory),P(this,Lc,a),P(this,Cf,o||null),P(this,$y,l),P(this,Ry,u),P(this,If,c),P(this,My,h||null),this.viewParameters={realScale:Du.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=f||null,this._supportsPinchToZoom=m!==!1}static get _keyboardManager(){const e=af.prototype,t=a=>d(a,ho).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),i=(a,{target:o})=>{if(o instanceof HTMLInputElement){const{type:l}=o;return l!=="text"&&l!=="number"}return!0},r=this.TRANSLATE_SMALL,s=this.TRANSLATE_BIG;return st(this,"_keyboardManager",new pv([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:i}],[["ctrl+z","mac+meta+z"],e.undo,{checker:i}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:i}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:i}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&d(a,ho).contains(o)&&!a.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&d(a,ho).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}]]))}destroy(){var e,t,i,r,s;(e=d(this,Wr))==null||e.resolve(),P(this,Wr,null),(t=d(this,Ef))==null||t.abort(),P(this,Ef,null),this._signal=null;for(const a of d(this,Xn).values())a.destroy();d(this,Xn).clear(),d(this,Sn).clear(),d(this,Mc).clear(),P(this,fr,null),d(this,Tt).clear(),d(this,Hr).destroy(),(i=d(this,Af))==null||i.destroy(),(r=d(this,ya))==null||r.hide(),P(this,ya,null),d(this,ga)&&(clearTimeout(d(this,ga)),P(this,ga,null)),d(this,_a)&&(clearTimeout(d(this,_a)),P(this,_a,null)),(s=this._editorUndoBar)==null||s.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return d(this,My)}get useNewAltTextFlow(){return d(this,Ry)}get useNewAltTextWhenAddingImage(){return d(this,If)}get hcmFilter(){return st(this,"hcmFilter",d(this,Lc)?d(this,Py).addHCMFilter(d(this,Lc).foreground,d(this,Lc).background):"none")}get direction(){return st(this,"direction",getComputedStyle(d(this,ho)).direction)}get highlightColors(){return st(this,"highlightColors",d(this,Cf)?new Map(d(this,Cf).split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return st(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),P(this,Nc,e)}setMainHighlightColorPicker(e){P(this,Dy,e)}editAltText(e,t=!1){var i;(i=d(this,Af))==null||i.editAltText(this,e,t)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":P(this,If,t);break}}onPageChanging({pageNumber:e}){P(this,Sf,e-1)}focusMainContainer(){d(this,ho).focus()}findParent(e,t){for(const i of d(this,Xn).values()){const{x:r,y:s,width:a,height:o}=i.div.getBoundingClientRect();if(e>=r&&e<=r+a&&t>=s&&t<=s+o)return i}return null}disableUserSelect(e=!1){d(this,Fy).classList.toggle("noUserSelect",e)}addShouldRescale(e){d(this,Mc).add(e)}removeShouldRescale(e){d(this,Mc).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*Du.PDF_TO_CSS_UNITS;for(const i of d(this,Mc))i.onScaleChanging();(t=d(this,Nc))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:i,anchorOffset:r,focusNode:s,focusOffset:a}=t,o=t.toString(),u=z(this,we,pw).call(this,t).closest(".textLayer"),c=this.getSelectionBoxes(u);if(!c)return;t.empty();const h=z(this,we,_S).call(this,u),f=d(this,Ln)===Ze.NONE,m=()=>{h==null||h.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:c,anchorNode:i,anchorOffset:r,focusNode:s,focusOffset:a,text:o}),f&&this.showAllEditors("highlight",!0,!0)};if(f){this.switchToMode(Ze.HIGHLIGHT,m);return}m()}addToAnnotationStorage(e){!e.isEmpty()&&d(this,uo)&&!d(this,uo).has(e.id)&&d(this,uo).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,d(this,Ml)&&(P(this,Ml,!1),z(this,we,mw).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of d(this,Tt))if(t.div.contains(e)){P(this,Oc,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!d(this,Oc))return;const[e,t]=d(this,Oc);P(this,Oc,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){z(this,we,vS).call(this),z(this,we,wS).call(this)}removeEditListeners(){z(this,we,PU).call(this),z(this,we,bS).call(this)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const i of d(this,Ss))if(i.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const i of d(this,Ss))if(i.isHandlingMimeForPasting(t.type)){i.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var i;if(e.preventDefault(),(i=d(this,fr))==null||i.commitOrRemove(),!this.hasSelection)return;const t=[];for(const r of d(this,Tt)){const s=r.serialize(!0);s&&t.push(s)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const s of t.items)for(const a of d(this,Ss))if(a.isHandlingMimeForPasting(s.type)){a.paste(s,this.currentLayer);return}let i=t.getData("application/pdfjs");if(!i)return;try{i=JSON.parse(i)}catch(s){et(`paste: "${s.message}".`);return}if(!Array.isArray(i))return;this.unselectAll();const r=this.currentLayer;try{const s=[];for(const l of i){const u=await r.deserialize(l);if(!u)return;s.push(u)}const a=()=>{for(const l of s)z(this,we,xS).call(this,l);z(this,we,ES).call(this,s)},o=()=>{for(const l of s)l.remove()};this.addCommands({cmd:a,undo:o,mustExec:!0})}catch(s){et(`paste: "${s.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),d(this,Ln)!==Ze.NONE&&!this.isEditorHandlingKeyboard&&af._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,d(this,Ml)&&(P(this,Ml,!1),z(this,we,mw).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(z(this,we,$U).call(this),z(this,we,wS).call(this),z(this,we,ki).call(this,{isEditing:d(this,Ln)!==Ze.NONE,isEmpty:z(this,we,dg).call(this),hasSomethingToUndo:d(this,Hr).hasSomethingToUndo(),hasSomethingToRedo:d(this,Hr).hasSomethingToRedo(),hasSelectedEditor:!1})):(z(this,we,RU).call(this),z(this,we,bS).call(this),z(this,we,ki).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!d(this,Ss)){P(this,Ss,e);for(const t of d(this,Ss))z(this,we,io).call(this,t.defaultPropertiesToUpdate)}}getId(){return d(this,Jb).id}get currentLayer(){return d(this,Xn).get(d(this,Sf))}getLayer(e){return d(this,Xn).get(e)}get currentPageIndex(){return d(this,Sf)}addLayer(e){d(this,Xn).set(e.pageIndex,e),d(this,Ol)?e.enable():e.disable()}removeLayer(e){d(this,Xn).delete(e.pageIndex)}async updateMode(e,t=null,i=!1){var r;if(d(this,Ln)!==e&&!(d(this,Wr)&&(await d(this,Wr).promise,!d(this,Wr)))){if(P(this,Wr,Promise.withResolvers()),P(this,Ln,e),e===Ze.NONE){this.setEditingState(!1),z(this,we,MU).call(this),(r=this._editorUndoBar)==null||r.hide(),d(this,Wr).resolve();return}this.setEditingState(!0),await z(this,we,DU).call(this),this.unselectAll();for(const s of d(this,Xn).values())s.updateMode(e);if(!t){i&&this.addNewEditorFromKeyboard(),d(this,Wr).resolve();return}for(const s of d(this,Sn).values())s.annotationElementId===t?(this.setSelected(s),s.enterInEditMode()):s.unselect();d(this,Wr).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==d(this,Ln)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){var i;if(d(this,Ss)){switch(e){case ht.CREATE:this.currentLayer.addNewEditor();return;case ht.HIGHLIGHT_DEFAULT_COLOR:(i=d(this,Dy))==null||i.updateColor(t);break;case ht.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(d(this,Oy)||P(this,Oy,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(const r of d(this,Tt))r.updateParams(e,t);for(const r of d(this,Ss))r.updateDefaultParams(e,t)}}showAllEditors(e,t,i=!1){var s;for(const a of d(this,Sn).values())a.editorType===e&&a.show(t);(((s=d(this,Oy))==null?void 0:s.get(ht.HIGHLIGHT_SHOW_ALL))??!0)!==t&&z(this,we,io).call(this,[[ht.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(d(this,Ny)!==e){P(this,Ny,e);for(const t of d(this,Xn).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){const t=[];for(const i of d(this,Sn).values())i.pageIndex===e&&t.push(i);return t}getEditor(e){return d(this,Sn).get(e)}addEditor(e){d(this,Sn).set(e.id,e)}removeEditor(e){var t;e.div.contains(document.activeElement)&&(d(this,ga)&&clearTimeout(d(this,ga)),P(this,ga,setTimeout(()=>{this.focusMainContainer(),P(this,ga,null)},0))),d(this,Sn).delete(e.id),this.unselect(e),(!e.annotationElementId||!d(this,Dc).has(e.annotationElementId))&&((t=d(this,uo))==null||t.remove(e.id))}addDeletedAnnotationElement(e){d(this,Dc).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return d(this,Dc).has(e)}removeDeletedAnnotationElement(e){d(this,Dc).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){d(this,fr)!==e&&(P(this,fr,e),e&&z(this,we,io).call(this,e.propertiesToUpdate))}updateUI(e){d(this,we,OU)===e&&z(this,we,io).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){z(this,we,io).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(d(this,Tt).has(e)){d(this,Tt).delete(e),e.unselect(),z(this,we,ki).call(this,{hasSelectedEditor:this.hasSelection});return}d(this,Tt).add(e),e.select(),z(this,we,io).call(this,e.propertiesToUpdate),z(this,we,ki).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;(t=d(this,Nc))==null||t.commitOrRemove();for(const i of d(this,Tt))i!==e&&i.unselect();d(this,Tt).clear(),d(this,Tt).add(e),e.select(),z(this,we,io).call(this,e.propertiesToUpdate),z(this,we,ki).call(this,{hasSelectedEditor:!0})}isSelected(e){return d(this,Tt).has(e)}get firstSelectedEditor(){return d(this,Tt).values().next().value}unselect(e){e.unselect(),d(this,Tt).delete(e),z(this,we,ki).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return d(this,Tt).size!==0}get isEnterHandled(){return d(this,Tt).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;d(this,Hr).undo(),z(this,we,ki).call(this,{hasSomethingToUndo:d(this,Hr).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:z(this,we,dg).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){d(this,Hr).redo(),z(this,we,ki).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:d(this,Hr).hasSomethingToRedo(),isEmpty:z(this,we,dg).call(this)})}addCommands(e){d(this,Hr).add(e),z(this,we,ki).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:z(this,we,dg).call(this)})}cleanUndoStack(e){d(this,Hr).cleanType(e)}delete(){var s;this.commitOrRemove();const e=(s=this.currentLayer)==null?void 0:s.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...d(this,Tt)],i=()=>{var a;(a=this._editorUndoBar)==null||a.show(r,t.length===1?t[0].editorType:t.length);for(const o of t)o.remove()},r=()=>{for(const a of t)z(this,we,xS).call(this,a)};this.addCommands({cmd:i,undo:r,mustExec:!0})}commitOrRemove(){var e;(e=d(this,fr))==null||e.commitOrRemove()}hasSomethingToControl(){return d(this,fr)||this.hasSelection}selectAll(){for(const e of d(this,Tt))e.commit();z(this,we,ES).call(this,d(this,Sn).values())}unselectAll(){var e;if(!(d(this,fr)&&(d(this,fr).commitOrRemove(),d(this,Ln)!==Ze.NONE))&&!((e=d(this,Nc))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of d(this,Tt))t.unselect();d(this,Tt).clear(),z(this,we,ki).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,i=!1){if(i||this.commitOrRemove(),!this.hasSelection)return;d(this,Fl)[0]+=e,d(this,Fl)[1]+=t;const[r,s]=d(this,Fl),a=[...d(this,Tt)],o=1e3;d(this,_a)&&clearTimeout(d(this,_a)),P(this,_a,setTimeout(()=>{P(this,_a,null),d(this,Fl)[0]=d(this,Fl)[1]=0,this.addCommands({cmd:()=>{for(const l of a)d(this,Sn).has(l.id)&&l.translateInPage(r,s)},undo:()=>{for(const l of a)d(this,Sn).has(l.id)&&l.translateInPage(-r,-s)},mustExec:!1})},o));for(const l of a)l.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),P(this,ma,new Map);for(const e of d(this,Tt))d(this,ma).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!d(this,ma))return!1;this.disableUserSelect(!1);const e=d(this,ma);P(this,ma,null);let t=!1;for(const[{x:r,y:s,pageIndex:a},o]of e)o.newX=r,o.newY=s,o.newPageIndex=a,t||(t=r!==o.savedX||s!==o.savedY||a!==o.savedPageIndex);if(!t)return!1;const i=(r,s,a,o)=>{if(d(this,Sn).has(r.id)){const l=d(this,Xn).get(o);l?r._setParentAndPosition(l,s,a):(r.pageIndex=o,r.x=s,r.y=a)}};return this.addCommands({cmd:()=>{for(const[r,{newX:s,newY:a,newPageIndex:o}]of e)i(r,s,a,o)},undo:()=>{for(const[r,{savedX:s,savedY:a,savedPageIndex:o}]of e)i(r,s,a,o)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(d(this,ma))for(const i of d(this,ma).keys())i.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||d(this,Tt).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return d(this,fr)===e}getActive(){return d(this,fr)}getMode(){return d(this,Ln)}get imageManager(){return st(this,"imageManager",new gS)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let u=0,c=t.rangeCount;u<c;u++)if(!e.contains(t.getRangeAt(u).commonAncestorContainer))return null;const{x:i,y:r,width:s,height:a}=e.getBoundingClientRect();let o;switch(e.getAttribute("data-main-rotation")){case"90":o=(u,c,h,f)=>({x:(c-r)/a,y:1-(u+h-i)/s,width:f/a,height:h/s});break;case"180":o=(u,c,h,f)=>({x:1-(u+h-i)/s,y:1-(c+f-r)/a,width:h/s,height:f/a});break;case"270":o=(u,c,h,f)=>({x:1-(c+f-r)/a,y:(u-i)/s,width:f/a,height:h/s});break;default:o=(u,c,h,f)=>({x:(u-i)/s,y:(c-r)/a,width:h/s,height:f/a});break}const l=[];for(let u=0,c=t.rangeCount;u<c;u++){const h=t.getRangeAt(u);if(!h.collapsed)for(const{x:f,y:m,width:y,height:_}of h.getClientRects())y===0||_===0||l.push(o(f,m,y,_))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(d(this,Tf)||P(this,Tf,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=d(this,Tf))==null||t.delete(e)}renderAnnotationElement(e){var r;const t=(r=d(this,Tf))==null?void 0:r.get(e.data.id);if(!t)return;const i=d(this,uo).getRawValue(t);i&&(d(this,Ln)===Ze.NONE&&!i.hasBeenModified||i.renderAnnotationElement(e))}};Ef=new WeakMap,fr=new WeakMap,Sn=new WeakMap,Xn=new WeakMap,Af=new WeakMap,uo=new WeakMap,Tf=new WeakMap,Hr=new WeakMap,Nl=new WeakMap,Nc=new WeakMap,Sf=new WeakMap,Dc=new WeakMap,ma=new WeakMap,Ss=new WeakMap,Mc=new WeakMap,$y=new WeakMap,Ry=new WeakMap,If=new WeakMap,Py=new WeakMap,ga=new WeakMap,Dl=new WeakMap,Cf=new WeakMap,Ml=new WeakMap,ya=new WeakMap,Jb=new WeakMap,Ol=new WeakMap,Ny=new WeakMap,Ll=new WeakMap,Oc=new WeakMap,Dy=new WeakMap,My=new WeakMap,Ln=new WeakMap,Tt=new WeakMap,co=new WeakMap,Lc=new WeakMap,Oy=new WeakMap,Ly=new WeakMap,Fl=new WeakMap,_a=new WeakMap,ho=new WeakMap,Fy=new WeakMap,Wr=new WeakMap,we=new WeakSet,pw=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},_S=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const i of d(this,Xn).values())if(i.hasTextLayer(e))return i;return null},IU=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const i=z(this,we,pw).call(this,e).closest(".textLayer"),r=this.getSelectionBoxes(i);r&&(d(this,ya)||P(this,ya,new oee(this)),d(this,ya).show(i,r,this.direction==="ltr"))},CU=function(){var s,a,o;const e=document.getSelection();if(!e||e.isCollapsed){d(this,co)&&((s=d(this,ya))==null||s.hide(),P(this,co,null),z(this,we,ki).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===d(this,co))return;const r=z(this,we,pw).call(this,e).closest(".textLayer");if(!r){d(this,co)&&((a=d(this,ya))==null||a.hide(),P(this,co,null),z(this,we,ki).call(this,{hasSelectedText:!1}));return}if((o=d(this,ya))==null||o.hide(),P(this,co,t),z(this,we,ki).call(this,{hasSelectedText:!0}),!(d(this,Ln)!==Ze.HIGHLIGHT&&d(this,Ln)!==Ze.NONE)&&(d(this,Ln)===Ze.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),P(this,Ml,this.isShiftKeyDown),!this.isShiftKeyDown)){const l=d(this,Ln)===Ze.HIGHLIGHT?z(this,we,_S).call(this,r):null;l==null||l.toggleDrawing();const u=new AbortController,c=this.combinedSignal(u),h=f=>{f.type==="pointerup"&&f.button!==0||(u.abort(),l==null||l.toggleDrawing(!0),f.type==="pointerup"&&z(this,we,mw).call(this,"main_toolbar"))};window.addEventListener("pointerup",h,{signal:c}),window.addEventListener("blur",h,{signal:c})}},mw=function(e=""){d(this,Ln)===Ze.HIGHLIGHT?this.highlightSelection(e):d(this,$y)&&z(this,we,IU).call(this)},kU=function(){document.addEventListener("selectionchange",z(this,we,CU).bind(this),{signal:this._signal})},$U=function(){if(d(this,Dl))return;P(this,Dl,new AbortController);const e=this.combinedSignal(d(this,Dl));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},RU=function(){var e;(e=d(this,Dl))==null||e.abort(),P(this,Dl,null)},vS=function(){if(d(this,Ll))return;P(this,Ll,new AbortController);const e=this.combinedSignal(d(this,Ll));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},PU=function(){var e;(e=d(this,Ll))==null||e.abort(),P(this,Ll,null)},wS=function(){if(d(this,Nl))return;P(this,Nl,new AbortController);const e=this.combinedSignal(d(this,Nl));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},bS=function(){var e;(e=d(this,Nl))==null||e.abort(),P(this,Nl,null)},NU=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},ki=function(e){Object.entries(e).some(([i,r])=>d(this,Ly)[i]!==r)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(d(this,Ly),e)}),d(this,Ln)===Ze.HIGHLIGHT&&e.hasSelectedEditor===!1&&z(this,we,io).call(this,[[ht.HIGHLIGHT_FREE,!0]]))},io=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},DU=async function(){if(!d(this,Ol)){P(this,Ol,!0);const e=[];for(const t of d(this,Xn).values())e.push(t.enable());await Promise.all(e);for(const t of d(this,Sn).values())t.enable()}},MU=function(){if(this.unselectAll(),d(this,Ol)){P(this,Ol,!1);for(const e of d(this,Xn).values())e.disable();for(const e of d(this,Sn).values())e.disable()}},xS=function(e){const t=d(this,Xn).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},OU=function(){let e=null;for(e of d(this,Tt));return e},dg=function(){if(d(this,Sn).size===0)return!0;if(d(this,Sn).size===1)for(const e of d(this,Sn).values())return e.isEmpty();return!1},ES=function(e){for(const t of d(this,Tt))t.unselect();d(this,Tt).clear();for(const t of e)t.isEmpty()||(d(this,Tt).add(t),t.select());z(this,we,ki).call(this,{hasSelectedEditor:this.hasSelection})},ze(af,"TRANSLATE_SMALL",1),ze(af,"TRANSLATE_BIG",10);let eh=af;var Fn,va,Is,kf,wa,pr,$f,ba,Xi,fo,Fc,xa,zl,Bs,hg,gw;const $i=class $i{constructor(e){F(this,Bs);F(this,Fn,null);F(this,va,!1);F(this,Is,null);F(this,kf,null);F(this,wa,null);F(this,pr,null);F(this,$f,!1);F(this,ba,null);F(this,Xi,null);F(this,fo,null);F(this,Fc,null);F(this,xa,!1);P(this,Xi,e),P(this,xa,e._uiManager.useNewAltTextFlow),d($i,zl)||P($i,zl,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){$i._l10n??($i._l10n=e)}async render(){const e=P(this,Is,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=P(this,kf,document.createElement("span"));e.append(t),d(this,xa)?(e.classList.add("new"),e.setAttribute("data-l10n-id",d($i,zl).missing),t.setAttribute("data-l10n-id",d($i,zl)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const i=d(this,Xi)._uiManager._signal;e.addEventListener("contextmenu",Js,{signal:i}),e.addEventListener("pointerdown",s=>s.stopPropagation(),{signal:i});const r=s=>{s.preventDefault(),d(this,Xi)._uiManager.editAltText(d(this,Xi)),d(this,xa)&&d(this,Xi)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:d(this,Bs,hg)}})};return e.addEventListener("click",r,{capture:!0,signal:i}),e.addEventListener("keydown",s=>{s.target===e&&s.key==="Enter"&&(P(this,$f,!0),r(s))},{signal:i}),await z(this,Bs,gw).call(this),e}finish(){d(this,Is)&&(d(this,Is).focus({focusVisible:d(this,$f)}),P(this,$f,!1))}isEmpty(){return d(this,xa)?d(this,Fn)===null:!d(this,Fn)&&!d(this,va)}hasData(){return d(this,xa)?d(this,Fn)!==null||!!d(this,fo):this.isEmpty()}get guessedText(){return d(this,fo)}async setGuessedText(e){d(this,Fn)===null&&(P(this,fo,e),P(this,Fc,await $i._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),z(this,Bs,gw).call(this))}toggleAltTextBadge(e=!1){var t;if(!d(this,xa)||d(this,Fn)){(t=d(this,ba))==null||t.remove(),P(this,ba,null);return}if(!d(this,ba)){const i=P(this,ba,document.createElement("div"));i.className="noAltTextBadge",d(this,Xi).div.append(i)}d(this,ba).classList.toggle("hidden",!e)}serialize(e){let t=d(this,Fn);return!e&&d(this,fo)===t&&(t=d(this,Fc)),{altText:t,decorative:d(this,va),guessedText:d(this,fo),textWithDisclaimer:d(this,Fc)}}get data(){return{altText:d(this,Fn),decorative:d(this,va)}}set data({altText:e,decorative:t,guessedText:i,textWithDisclaimer:r,cancel:s=!1}){i&&(P(this,fo,i),P(this,Fc,r)),!(d(this,Fn)===e&&d(this,va)===t)&&(s||(P(this,Fn,e),P(this,va,t)),z(this,Bs,gw).call(this))}toggle(e=!1){d(this,Is)&&(!e&&d(this,pr)&&(clearTimeout(d(this,pr)),P(this,pr,null)),d(this,Is).disabled=!e)}shown(){d(this,Xi)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:d(this,Bs,hg)}})}destroy(){var e,t;(e=d(this,Is))==null||e.remove(),P(this,Is,null),P(this,kf,null),P(this,wa,null),(t=d(this,ba))==null||t.remove(),P(this,ba,null)}};Fn=new WeakMap,va=new WeakMap,Is=new WeakMap,kf=new WeakMap,wa=new WeakMap,pr=new WeakMap,$f=new WeakMap,ba=new WeakMap,Xi=new WeakMap,fo=new WeakMap,Fc=new WeakMap,xa=new WeakMap,zl=new WeakMap,Bs=new WeakSet,hg=function(){return d(this,Fn)&&"added"||d(this,Fn)===null&&this.guessedText&&"review"||"missing"},gw=async function(){var r,s,a;const e=d(this,Is);if(!e)return;if(d(this,xa)){if(e.classList.toggle("done",!!d(this,Fn)),e.setAttribute("data-l10n-id",d($i,zl)[d(this,Bs,hg)]),(r=d(this,kf))==null||r.setAttribute("data-l10n-id",d($i,zl)[`${d(this,Bs,hg)}-label`]),!d(this,Fn)){(s=d(this,wa))==null||s.remove();return}}else{if(!d(this,Fn)&&!d(this,va)){e.classList.remove("done"),(a=d(this,wa))==null||a.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=d(this,wa);if(!t){P(this,wa,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${d(this,Xi).id}`;const o=100,l=d(this,Xi)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(d(this,pr)),P(this,pr,null)},{once:!0}),e.addEventListener("mouseenter",()=>{P(this,pr,setTimeout(()=>{P(this,pr,null),d(this,wa).classList.add("show"),d(this,Xi)._reportTelemetry({action:"alt_text_tooltip"})},o))},{signal:l}),e.addEventListener("mouseleave",()=>{var u;d(this,pr)&&(clearTimeout(d(this,pr)),P(this,pr,null)),(u=d(this,wa))==null||u.classList.remove("show")},{signal:l})}d(this,va)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=d(this,Fn)),t.parentNode||e.append(t);const i=d(this,Xi).getImageForAltText();i==null||i.setAttribute("aria-describedby",t.id)},F($i,zl,null),ze($i,"_l10n",null);let jb=$i;var zy,zc,Vy,jy,By,Uy,Hy,Rf,po,Vc,Vl,nl,LU,FU,AS;const XC=class XC{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:i=null,onPinchStart:r=null,onPinching:s=null,onPinchEnd:a=null,signal:o}){F(this,nl);F(this,zy);F(this,zc,!1);F(this,Vy,null);F(this,jy);F(this,By);F(this,Uy);F(this,Hy);F(this,Rf);F(this,po,null);F(this,Vc);F(this,Vl,null);P(this,zy,e),P(this,Vy,i),P(this,jy,t),P(this,By,r),P(this,Uy,s),P(this,Hy,a),P(this,Vc,new AbortController),P(this,Rf,AbortSignal.any([o,d(this,Vc).signal])),e.addEventListener("touchstart",z(this,nl,LU).bind(this),{passive:!1,signal:d(this,Rf)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return st(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}destroy(){var e;(e=d(this,Vc))==null||e.abort(),P(this,Vc,null)}};zy=new WeakMap,zc=new WeakMap,Vy=new WeakMap,jy=new WeakMap,By=new WeakMap,Uy=new WeakMap,Hy=new WeakMap,Rf=new WeakMap,po=new WeakMap,Vc=new WeakMap,Vl=new WeakMap,nl=new WeakSet,LU=function(e){var r,s,a;if((r=d(this,jy))!=null&&r.call(this)||e.touches.length<2)return;if(!d(this,Vl)){P(this,Vl,new AbortController);const o=AbortSignal.any([d(this,Rf),d(this,Vl).signal]),l=d(this,zy),u={signal:o,passive:!1};l.addEventListener("touchmove",z(this,nl,FU).bind(this),u),l.addEventListener("touchend",z(this,nl,AS).bind(this),u),l.addEventListener("touchcancel",z(this,nl,AS).bind(this),u),(s=d(this,By))==null||s.call(this)}if(Rr(e),e.touches.length!==2||(a=d(this,Vy))!=null&&a.call(this)){P(this,po,null);return}let[t,i]=e.touches;t.identifier>i.identifier&&([t,i]=[i,t]),P(this,po,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:i.screenX,touch1Y:i.screenY})},FU=function(e){var k;if(!d(this,po)||e.touches.length!==2)return;let[t,i]=e.touches;t.identifier>i.identifier&&([t,i]=[i,t]);const{screenX:r,screenY:s}=t,{screenX:a,screenY:o}=i,l=d(this,po),{touch0X:u,touch0Y:c,touch1X:h,touch1Y:f}=l,m=h-u,y=f-c,_=a-r,x=o-s,v=Math.hypot(_,x)||1,w=Math.hypot(m,y)||1;if(!d(this,zc)&&Math.abs(w-v)<=XC.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=r,l.touch0Y=s,l.touch1X=a,l.touch1Y=o,e.preventDefault(),!d(this,zc)){P(this,zc,!0);return}const E=[(r+a)/2,(s+o)/2];(k=d(this,Uy))==null||k.call(this,E,w,v)},AS=function(e){var t;d(this,Vl).abort(),P(this,Vl,null),(t=d(this,Hy))==null||t.call(this),d(this,po)&&(e.preventDefault(),P(this,po,null),P(this,zc,!1))};let Bb=XC;var jc,Cs,Bt,Pf,jl,Wy,Bc,Qn,Uc,mo,Bl,qy,Hc,mr,Gy,Wc,go,Ea,Nf,Df,qr,qc,Ky,Zb,Ve,TS,Yy,SS,yw,zU,VU,IS,_w,CS,jU,BU,UU,kS,HU,$S,WU,qU,GU,RS,fg;const tt=class tt{constructor(e){F(this,Ve);F(this,jc,null);F(this,Cs,null);F(this,Bt,null);F(this,Pf,!1);F(this,jl,null);F(this,Wy,"");F(this,Bc,!1);F(this,Qn,null);F(this,Uc,null);F(this,mo,null);F(this,Bl,null);F(this,qy,"");F(this,Hc,!1);F(this,mr,null);F(this,Gy,!1);F(this,Wc,!1);F(this,go,!1);F(this,Ea,null);F(this,Nf,0);F(this,Df,0);F(this,qr,null);F(this,qc,null);ze(this,"_editToolbar",null);ze(this,"_initialOptions",Object.create(null));ze(this,"_initialData",null);ze(this,"_isVisible",!0);ze(this,"_uiManager",null);ze(this,"_focusEventsAllowed",!0);F(this,Ky,!1);F(this,Zb,tt._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:i,pageHeight:r,pageX:s,pageY:a}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,r],this.pageTranslation=[s,a];const[o,l]=this.parentDimensions;this.x=e.x/o,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=tt.prototype._resizeWithKeyboard,t=eh.TRANSLATE_SMALL,i=eh.TRANSLATE_BIG;return st(this,"_resizerKeyboardManager",new pv([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,i]}],[["Escape","mac+Escape"],tt.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return st(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new cee({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(tt._l10n??(tt._l10n=e),tt._l10nResizer||(tt._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),tt._borderLineWidth!==-1)return;const i=getComputedStyle(document.documentElement);tt._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){Dt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return d(this,Ky)}set _isDraggable(e){var t;P(this,Ky,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=d(this,Zb)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):z(this,Ve,fg).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(d(this,Hc)?P(this,Hc,!1):this.parent.setSelected(this))}focusout(e){var i;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(i=this.parent)!=null&&i.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,i,r){const[s,a]=this.parentDimensions;[i,r]=this.screenToPageTranslation(i,r),this.x=(e+i)/s,this.y=(t+r)/a,this.fixAndSetPosition()}translate(e,t){z(this,Ve,TS).call(this,this.parentDimensions,e,t)}translateInPage(e,t){d(this,mr)||P(this,mr,[this.x,this.y,this.width,this.height]),z(this,Ve,TS).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){d(this,mr)||P(this,mr,[this.x,this.y,this.width,this.height]);const{div:i,parentDimensions:[r,s]}=this;if(this.x+=e/r,this.y+=t/s,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:h,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,h,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:o}=this;const[l,u]=this.getBaseTranslation();a+=l,o+=u;const{style:c}=i;c.left=`${(100*a).toFixed(2)}%`,c.top=`${(100*o).toFixed(2)}%`,this._onTranslating(a,o),i.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!d(this,mr)&&(d(this,mr)[0]!==this.x||d(this,mr)[1]!==this.y)}get _hasBeenResized(){return!!d(this,mr)&&(d(this,mr)[2]!==this.width||d(this,mr)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:i}=tt,r=i/e,s=i/t;switch(this.rotation){case 90:return[-r,s];case 180:return[r,s];case 270:return[r,-s];default:return[-r,-s]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[i,r]}=this;let{x:s,y:a,width:o,height:l}=this;if(o*=i,l*=r,s*=i,a*=r,this._mustFixPosition)switch(e){case 0:s=Math.max(0,Math.min(i-o,s)),a=Math.max(0,Math.min(r-l,a));break;case 90:s=Math.max(0,Math.min(i-l,s)),a=Math.min(r,Math.max(o,a));break;case 180:s=Math.min(i,Math.max(o,s)),a=Math.min(r,Math.max(l,a));break;case 270:s=Math.min(i,Math.max(l,s)),a=Math.max(0,Math.min(r-o,a));break}this.x=s/=i,this.y=a/=r;const[u,c]=this.getBaseTranslation();s+=u,a+=c,t.left=`${(100*s).toFixed(2)}%`,t.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var i;return z(i=tt,Yy,SS).call(i,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var i;return z(i=tt,Yy,SS).call(i,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,i]}=this;return[t*e,i*e]}setDims(e,t){const[i,r]=this.parentDimensions,{style:s}=this.div;s.width=`${(100*e/i).toFixed(2)}%`,d(this,Bc)||(s.height=`${(100*t/r).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:i}=e,r=i.endsWith("%"),s=!d(this,Bc)&&t.endsWith("%");if(r&&s)return;const[a,o]=this.parentDimensions;r||(e.width=`${(100*parseFloat(i)/a).toFixed(2)}%`),!d(this,Bc)&&!s&&(e.height=`${(100*parseFloat(t)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=d(this,Bt))==null||e.finish()}async addEditToolbar(){return this._editToolbar||d(this,Wc)?this._editToolbar:(this._editToolbar=new pS(this),this.div.append(this._editToolbar.render()),d(this,Bt)&&await this._editToolbar.addAltText(d(this,Bt)),this._editToolbar)}removeEditToolbar(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(e=d(this,Bt))==null||e.destroy())}addContainer(e){var i;const t=(i=this._editToolbar)==null?void 0:i.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){d(this,Bt)||(jb.initialize(tt._l10n),P(this,Bt,new jb(this)),d(this,jc)&&(d(this,Bt).data=d(this,jc),P(this,jc,null)),await this.addEditToolbar())}get altTextData(){var e;return(e=d(this,Bt))==null?void 0:e.data}set altTextData(e){d(this,Bt)&&(d(this,Bt).data=e)}get guessedAltText(){var e;return(e=d(this,Bt))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=d(this,Bt))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=d(this,Bt))==null?void 0:t.serialize(e)}hasAltText(){return!!d(this,Bt)&&!d(this,Bt).isEmpty()}hasAltTextData(){var e;return((e=d(this,Bt))==null?void 0:e.hasData())??!1}render(){var s;this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=d(this,Pf)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),z(this,Ve,$S).call(this);const[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);const[i,r]=this.getInitialTranslation();return this.translate(i,r),Vb(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(d(this,qc)||P(this,qc,new Bb({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:z(this,Ve,jU).bind(this),onPinching:z(this,Ve,BU).bind(this),onPinchEnd:z(this,Ve,UU).bind(this),signal:this._uiManager._signal}))),(s=this._uiManager._editorUndoBar)==null||s.hide(),this.div}pointerdown(e){const{isMac:t}=Oi.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(P(this,Hc,!0),this._isDraggable){z(this,Ve,HU).call(this,e);return}z(this,Ve,kS).call(this,e)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){d(this,Ea)&&clearTimeout(d(this,Ea)),P(this,Ea,setTimeout(()=>{var e;P(this,Ea,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,i){e.changeParent(this),this.x=t,this.y=i,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,i=this.rotation){const r=this.parentScale,[s,a]=this.pageDimensions,[o,l]=this.pageTranslation,u=e/r,c=t/r,h=this.x*s,f=this.y*a,m=this.width*s,y=this.height*a;switch(i){case 0:return[h+u+o,a-f-c-y+l,h+u+m+o,a-f-c+l];case 90:return[h+c+o,a-f+u+l,h+c+y+o,a-f+u+m+l];case 180:return[h-u-m+o,a-f+c+l,h-u+o,a-f+c+y+l];case 270:return[h-c-y+o,a-f-u-m+l,h-c+o,a-f-u+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[i,r,s,a]=e,o=s-i,l=a-r;switch(this.rotation){case 0:return[i,t-a,o,l];case 90:return[i,t-r,l,o];case 180:return[s,t-r,o,l];case 270:return[s,t-a,l,o];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){P(this,Wc,!0)}disableEditMode(){P(this,Wc,!1)}isInEditMode(){return d(this,Wc)}shouldGetKeyboardEvents(){return d(this,go)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:i,right:r}=this.getClientDimensions(),{innerHeight:s,innerWidth:a}=window;return t<a&&r>0&&e<s&&i>0}rebuild(){z(this,Ve,$S).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){Dt("An editor must be serializable")}static async deserialize(e,t,i){const r=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:i});r.rotation=e.rotation,P(r,jc,e.accessibilityData);const[s,a]=r.pageDimensions,[o,l,u,c]=r.getRectInCurrentCoords(e.rect,a);return r.x=o/s,r.y=l/a,r.width=u/s,r.height=c/a,r}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t;if((e=d(this,Bl))==null||e.abort(),P(this,Bl,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),d(this,Ea)&&(clearTimeout(d(this,Ea)),P(this,Ea,null)),z(this,Ve,fg).call(this),this.removeEditToolbar(),d(this,qr)){for(const i of d(this,qr).values())clearTimeout(i);P(this,qr,null)}this.parent=null,(t=d(this,qc))==null||t.destroy(),P(this,qc,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(z(this,Ve,zU).call(this),d(this,Qn).classList.remove("hidden"),Vb(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),P(this,mo,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=d(this,Qn).children;if(!d(this,Cs)){P(this,Cs,Array.from(t));const a=z(this,Ve,WU).bind(this),o=z(this,Ve,qU).bind(this),l=this._uiManager._signal;for(const u of d(this,Cs)){const c=u.getAttribute("data-resizer-name");u.setAttribute("role","spinbutton"),u.addEventListener("keydown",a,{signal:l}),u.addEventListener("blur",o,{signal:l}),u.addEventListener("focus",z(this,Ve,GU).bind(this,c),{signal:l}),u.setAttribute("data-l10n-id",tt._l10nResizer[c])}}const i=d(this,Cs)[0];let r=0;for(const a of t){if(a===i)break;r++}const s=(360-this.rotation+this.parentRotation)%360/90*(d(this,Cs).length/4);if(s!==r){if(s<r)for(let o=0;o<r-s;o++)d(this,Qn).append(d(this,Qn).firstChild);else if(s>r)for(let o=0;o<s-r;o++)d(this,Qn).firstChild.before(d(this,Qn).lastChild);let a=0;for(const o of t){const u=d(this,Cs)[a++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",tt._l10nResizer[u])}}z(this,Ve,RS).call(this,0),P(this,go,!0),d(this,Qn).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){d(this,go)&&z(this,Ve,CS).call(this,d(this,qy),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){z(this,Ve,fg).call(this),this.div.focus()}select(){var e,t,i;if(this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var r,s;(r=this.div)!=null&&r.classList.contains("selectedEditor")&&((s=this._editToolbar)==null||s.show())});return}(t=this._editToolbar)==null||t.show(),(i=d(this,Bt))==null||i.toggleAltTextBadge(!1)}unselect(){var e,t,i,r,s;(e=d(this,Qn))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(i=this.div)!=null&&i.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(r=this._editToolbar)==null||r.hide(),(s=d(this,Bt))==null||s.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return d(this,Gy)}set isEditing(e){P(this,Gy,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){P(this,Bc,!0);const i=e/t,{style:r}=this.div;r.aspectRatio=i,r.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){d(this,qr)||P(this,qr,new Map);const{action:i}=e;let r=d(this,qr).get(i);r&&clearTimeout(r),r=setTimeout(()=>{this._reportTelemetry(e),d(this,qr).delete(i),d(this,qr).size===0&&P(this,qr,null)},tt._telemetryTimeout),d(this,qr).set(i,r);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),P(this,Pf,!1)}disable(){this.div&&(this.div.tabIndex=-1),P(this,Pf,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const i=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),i.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};jc=new WeakMap,Cs=new WeakMap,Bt=new WeakMap,Pf=new WeakMap,jl=new WeakMap,Wy=new WeakMap,Bc=new WeakMap,Qn=new WeakMap,Uc=new WeakMap,mo=new WeakMap,Bl=new WeakMap,qy=new WeakMap,Hc=new WeakMap,mr=new WeakMap,Gy=new WeakMap,Wc=new WeakMap,go=new WeakMap,Ea=new WeakMap,Nf=new WeakMap,Df=new WeakMap,qr=new WeakMap,qc=new WeakMap,Ky=new WeakMap,Zb=new WeakMap,Ve=new WeakSet,TS=function([e,t],i,r){[i,r]=this.screenToPageTranslation(i,r),this.x+=i/e,this.y+=r/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},Yy=new WeakSet,SS=function(e,t,i){switch(i){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},yw=function(e){switch(e){case 90:{const[t,i]=this.pageDimensions;return[0,-t/i,i/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,i]=this.pageDimensions;return[0,t/i,-i/t,0]}default:return[1,0,0,1]}},zU=function(){if(d(this,Qn))return;P(this,Qn,document.createElement("div")),d(this,Qn).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const i of e){const r=document.createElement("div");d(this,Qn).append(r),r.classList.add("resizer",i),r.setAttribute("data-resizer-name",i),r.addEventListener("pointerdown",z(this,Ve,VU).bind(this,i),{signal:t}),r.addEventListener("contextmenu",Js,{signal:t}),r.tabIndex=-1}this.div.prepend(d(this,Qn))},VU=function(e,t){var c;t.preventDefault();const{isMac:i}=Oi.platform;if(t.button!==0||t.ctrlKey&&i)return;(c=d(this,Bt))==null||c.toggle(!1);const r=this._isDraggable;this._isDraggable=!1,P(this,Uc,[t.screenX,t.screenY]);const s=new AbortController,a=this._uiManager.combinedSignal(s);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",z(this,Ve,CS).bind(this,e),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",Rr,{passive:!1,signal:a}),window.addEventListener("contextmenu",Js,{signal:a}),P(this,mo,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const o=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const u=()=>{var h;s.abort(),this.parent.togglePointerEvents(!0),(h=d(this,Bt))==null||h.toggle(!0),this._isDraggable=r,this.parent.div.style.cursor=o,this.div.style.cursor=l,z(this,Ve,_w).call(this)};window.addEventListener("pointerup",u,{signal:a}),window.addEventListener("blur",u,{signal:a})},IS=function(e,t,i,r){this.width=i,this.height=r,this.x=e,this.y=t;const[s,a]=this.parentDimensions;this.setDims(s*i,a*r),this.fixAndSetPosition(),this._onResized()},_w=function(){if(!d(this,mo))return;const{savedX:e,savedY:t,savedWidth:i,savedHeight:r}=d(this,mo);P(this,mo,null);const s=this.x,a=this.y,o=this.width,l=this.height;s===e&&a===t&&o===i&&l===r||this.addCommands({cmd:z(this,Ve,IS).bind(this,s,a,o,l),undo:z(this,Ve,IS).bind(this,e,t,i,r),mustExec:!0})},CS=function(e,t){const[i,r]=this.parentDimensions,s=this.x,a=this.y,o=this.width,l=this.height,u=tt.MIN_SIZE/i,c=tt.MIN_SIZE/r,h=z(this,Ve,yw).call(this,this.rotation),f=(te,oe)=>[h[0]*te+h[2]*oe,h[1]*te+h[3]*oe],m=z(this,Ve,yw).call(this,360-this.rotation),y=(te,oe)=>[m[0]*te+m[2]*oe,m[1]*te+m[3]*oe];let _,x,v=!1,w=!1;switch(e){case"topLeft":v=!0,_=(te,oe)=>[0,0],x=(te,oe)=>[te,oe];break;case"topMiddle":_=(te,oe)=>[te/2,0],x=(te,oe)=>[te/2,oe];break;case"topRight":v=!0,_=(te,oe)=>[te,0],x=(te,oe)=>[0,oe];break;case"middleRight":w=!0,_=(te,oe)=>[te,oe/2],x=(te,oe)=>[0,oe/2];break;case"bottomRight":v=!0,_=(te,oe)=>[te,oe],x=(te,oe)=>[0,0];break;case"bottomMiddle":_=(te,oe)=>[te/2,oe],x=(te,oe)=>[te/2,0];break;case"bottomLeft":v=!0,_=(te,oe)=>[0,oe],x=(te,oe)=>[te,0];break;case"middleLeft":w=!0,_=(te,oe)=>[0,oe/2],x=(te,oe)=>[te,oe/2];break}const E=_(o,l),k=x(o,l);let $=f(...k);const L=tt._round(s+$[0]),I=tt._round(a+$[1]);let C=1,N=1,O,V;if(t.fromKeyboard)({deltaX:O,deltaY:V}=t);else{const{screenX:te,screenY:oe}=t,[G,W]=d(this,Uc);[O,V]=this.screenToPageTranslation(te-G,oe-W),d(this,Uc)[0]=te,d(this,Uc)[1]=oe}if([O,V]=y(O/i,V/r),v){const te=Math.hypot(o,l);C=N=Math.max(Math.min(Math.hypot(k[0]-E[0]-O,k[1]-E[1]-V)/te,1/o,1/l),u/o,c/l)}else w?C=Math.max(u,Math.min(1,Math.abs(k[0]-E[0]-O)))/o:N=Math.max(c,Math.min(1,Math.abs(k[1]-E[1]-V)))/l;const U=tt._round(o*C),j=tt._round(l*N);$=f(...x(U,j));const he=L-$[0],me=I-$[1];d(this,mr)||P(this,mr,[this.x,this.y,this.width,this.height]),this.width=U,this.height=j,this.x=he,this.y=me,this.setDims(i*U,r*j),this.fixAndSetPosition(),this._onResizing()},jU=function(){var e;P(this,mo,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=d(this,Bt))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},BU=function(e,t,i){let s=.7*(i/t)+1-.7;if(s===1)return;const a=z(this,Ve,yw).call(this,this.rotation),o=(L,I)=>[a[0]*L+a[2]*I,a[1]*L+a[3]*I],[l,u]=this.parentDimensions,c=this.x,h=this.y,f=this.width,m=this.height,y=tt.MIN_SIZE/l,_=tt.MIN_SIZE/u;s=Math.max(Math.min(s,1/f,1/m),y/f,_/m);const x=tt._round(f*s),v=tt._round(m*s);if(x===f&&v===m)return;d(this,mr)||P(this,mr,[c,h,f,m]);const w=o(f/2,m/2),E=tt._round(c+w[0]),k=tt._round(h+w[1]),$=o(x/2,v/2);this.x=E-$[0],this.y=k-$[1],this.width=x,this.height=v,this.setDims(l*x,u*v),this.fixAndSetPosition(),this._onResizing()},UU=function(){var e;(e=d(this,Bt))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),z(this,Ve,_w).call(this)},kS=function(e){const{isMac:t}=Oi.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},HU=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let i=!1;const r=new AbortController,s=this._uiManager.combinedSignal(r),a={capture:!0,passive:!1,signal:s},o=u=>{r.abort(),P(this,jl,null),P(this,Hc,!1),this._uiManager.endDragSession()||z(this,Ve,kS).call(this,u),i&&this._onStopDragging()};t&&(P(this,Nf,e.clientX),P(this,Df,e.clientY),P(this,jl,e.pointerId),P(this,Wy,e.pointerType),window.addEventListener("pointermove",u=>{i||(i=!0,this._onStartDragging());const{clientX:c,clientY:h,pointerId:f}=u;if(f!==d(this,jl)){Rr(u);return}const[m,y]=this.screenToPageTranslation(c-d(this,Nf),h-d(this,Df));P(this,Nf,c),P(this,Df,h),this._uiManager.dragSelectedEditors(m,y)},a),window.addEventListener("touchmove",Rr,a),window.addEventListener("pointerdown",u=>{u.pointerType===d(this,Wy)&&(d(this,qc)||u.isPrimary)&&o(u),Rr(u)},a));const l=u=>{if(!d(this,jl)||d(this,jl)===u.pointerId){o(u);return}Rr(u)};window.addEventListener("pointerup",l,{signal:s}),window.addEventListener("blur",l,{signal:s})},$S=function(){if(d(this,Bl)||!this.div)return;P(this,Bl,new AbortController);const e=this._uiManager.combinedSignal(d(this,Bl));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},WU=function(e){tt._resizerKeyboardManager.exec(this,e)},qU=function(e){var t;d(this,go)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==d(this,Qn)&&z(this,Ve,fg).call(this)},GU=function(e){P(this,qy,d(this,go)?e:"")},RS=function(e){if(d(this,Cs))for(const t of d(this,Cs))t.tabIndex=e},fg=function(){P(this,go,!1),z(this,Ve,RS).call(this,-1),z(this,Ve,_w).call(this)},F(tt,Yy),ze(tt,"_l10n",null),ze(tt,"_l10nResizer",null),ze(tt,"_borderLineWidth",-1),ze(tt,"_colorManager",new yS),ze(tt,"_zIndex",1),ze(tt,"_telemetryTimeout",1e3);let en=tt;class cee extends en{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const i3=3285377520,Ur=4294901760,da=65535;class KU{constructor(e){this.h1=e?e&4294967295:i3,this.h2=e?e&4294967295:i3}update(e){let t,i;if(typeof e=="string"){t=new Uint8Array(e.length*2),i=0;for(let _=0,x=e.length;_<x;_++){const v=e.charCodeAt(_);v<=255?t[i++]=v:(t[i++]=v>>>8,t[i++]=v&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),i=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const r=i>>2,s=i-r*4,a=new Uint32Array(t.buffer,0,r);let o=0,l=0,u=this.h1,c=this.h2;const h=3432918353,f=461845907,m=h&da,y=f&da;for(let _=0;_<r;_++)_&1?(o=a[_],o=o*h&Ur|o*m&da,o=o<<15|o>>>17,o=o*f&Ur|o*y&da,u^=o,u=u<<13|u>>>19,u=u*5+3864292196):(l=a[_],l=l*h&Ur|l*m&da,l=l<<15|l>>>17,l=l*f&Ur|l*y&da,c^=l,c=c<<13|c>>>19,c=c*5+3864292196);switch(o=0,s){case 3:o^=t[r*4+2]<<16;case 2:o^=t[r*4+1]<<8;case 1:o^=t[r*4],o=o*h&Ur|o*m&da,o=o<<15|o>>>17,o=o*f&Ur|o*y&da,r&1?u^=o:c^=o}this.h1=u,this.h2=c}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&Ur|e*36045&da,t=t*4283543511&Ur|((t<<16|e>>>16)*2950163797&Ur)>>>16,e^=t>>>1,e=e*444984403&Ur|e*60499&da,t=t*3301882366&Ur|((t<<16|e>>>16)*3120437893&Ur)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const PS=Object.freeze({map:null,hash:"",transfer:void 0});var Gc,Kc,zn,e1,YU;class HC{constructor(){F(this,e1);F(this,Gc,!1);F(this,Kc,null);F(this,zn,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const i=d(this,zn).get(e);return i===void 0?t:Object.assign(t,i)}getRawValue(e){return d(this,zn).get(e)}remove(e){if(d(this,zn).delete(e),d(this,zn).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const t of d(this,zn).values())if(t instanceof en)return;this.onAnnotationEditor(null)}}setValue(e,t){const i=d(this,zn).get(e);let r=!1;if(i!==void 0)for(const[s,a]of Object.entries(t))i[s]!==a&&(r=!0,i[s]=a);else r=!0,d(this,zn).set(e,t);r&&z(this,e1,YU).call(this),t instanceof en&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return d(this,zn).has(e)}getAll(){return d(this,zn).size>0?FC(d(this,zn)):null}setAll(e){for(const[t,i]of Object.entries(e))this.setValue(t,i)}get size(){return d(this,zn).size}resetModified(){d(this,Gc)&&(P(this,Gc,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new XU(this)}get serializable(){if(d(this,zn).size===0)return PS;const e=new Map,t=new KU,i=[],r=Object.create(null);let s=!1;for(const[a,o]of d(this,zn)){const l=o instanceof en?o.serialize(!1,r):o;l&&(e.set(a,l),t.update(`${a}:${JSON.stringify(l)}`),s||(s=!!l.bitmap))}if(s)for(const a of e.values())a.bitmap&&i.push(a.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:i}:PS}get editorStats(){let e=null;const t=new Map;for(const i of d(this,zn).values()){if(!(i instanceof en))continue;const r=i.telemetryFinalData;if(!r)continue;const{type:s}=r;t.has(s)||t.set(s,Object.getPrototypeOf(i).constructor),e||(e=Object.create(null));const a=e[s]||(e[s]=new Map);for(const[o,l]of Object.entries(r)){if(o==="type")continue;let u=a.get(o);u||(u=new Map,a.set(o,u));const c=u.get(l)??0;u.set(l,c+1)}}for(const[i,r]of t)e[i]=r.computeTelemetryFinalData(e[i]);return e}resetModifiedIds(){P(this,Kc,null)}get modifiedIds(){if(d(this,Kc))return d(this,Kc);const e=[];for(const t of d(this,zn).values())!(t instanceof en)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return P(this,Kc,{ids:new Set(e),hash:e.join(",")})}}Gc=new WeakMap,Kc=new WeakMap,zn=new WeakMap,e1=new WeakSet,YU=function(){d(this,Gc)||(P(this,Gc,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var Xy;class XU extends HC{constructor(t){super();F(this,Xy);const{map:i,hash:r,transfer:s}=t.serializable,a=structuredClone(i,s?{transfer:s}:null);P(this,Xy,{map:a,hash:r,transfer:s})}get print(){Dt("Should not call PrintAnnotationStorage.print")}get serializable(){return d(this,Xy)}get modifiedIds(){return st(this,"modifiedIds",{ids:new Set,hash:""})}}Xy=new WeakMap;var Mf;class dee{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){F(this,Mf,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),d(this,Mf).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,_inspectFont:t}){if(!(!e||d(this,Mf).has(e.loadedName))){if(bn(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:r,style:s}=e,a=new FontFace(i,r,s);this.addNativeFontFace(a);try{await a.load(),d(this,Mf).add(i),t==null||t(e)}catch{et(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}Dt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const i=e.createNativeFontFace();if(i){this.addNativeFontFace(i);try{await i.loaded}catch(r){throw et(`Failed to load font '${i.family}': '${r}'.`),e.disableFontFace=!0,r}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(i=>{const r=this._queueLoadingCallback(i);this._prepareFontLoadEvent(e,r)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return st(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(xi||typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),st(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(bn(!r.done,"completeRequest() cannot be called twice."),r.done=!0;i.length>0&&i[0].done;){const s=i.shift();setTimeout(s.callback,0)}}const{loadingRequests:i}=this,r={done:!1,complete:t,callback:e};return i.push(r),r}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return st(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function i(k,$){return k.charCodeAt($)<<24|k.charCodeAt($+1)<<16|k.charCodeAt($+2)<<8|k.charCodeAt($+3)&255}function r(k,$,L,I){const C=k.substring(0,$),N=k.substring($+L);return C+I+N}let s,a;const o=this._document.createElement("canvas");o.width=1,o.height=1;const l=o.getContext("2d");let u=0;function c(k,$){if(++u>30){et("Load test font never loaded."),$();return}if(l.font="30px "+k,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){$();return}setTimeout(c.bind(null,k,$))}const h=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=r(f,976,h.length,h);const y=16,_=1482184792;let x=i(f,y);for(s=0,a=h.length-3;s<a;s+=4)x=x-_+i(h,s)|0;s<h.length&&(x=x-_+i(h+"XXX",s)|0),f=r(f,y,4,XZ(x));const v=`url(data:font/opentype;base64,${btoa(f)});`,w=`@font-face {font-family:"${h}";src:${v}}`;this.insertRule(w);const E=this._document.createElement("div");E.style.visibility="hidden",E.style.width=E.style.height="10px",E.style.position="absolute",E.style.top=E.style.left="0px";for(const k of[e.loadedName,h]){const $=this._document.createElement("span");$.textContent="Hi",$.style.fontFamily=k,E.append($)}this._document.body.append(E),c(h,()=>{E.remove(),t.complete()})}}Mf=new WeakMap;class hee{constructor(e,{disableFontFace:t=!1,fontExtraProperties:i=!1,inspectFont:r=null}){this.compiledGlyphs=Object.create(null);for(const s in e)this[s]=e[s];this.disableFontFace=t===!0,this.fontExtraProperties=i===!0,this._inspectFont=r}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const i={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(i.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,i)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var i;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${nee(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let r=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(r+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${r}src:${e}}`}return(i=this._inspectFont)==null||i.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const i=this.loadedName+"_path_"+t;let r;try{r=e.get(i)}catch(a){et(`getPathGenerator - ignoring character: "${a}".`)}const s=new Path2D(r||"");return this.fontExtraProperties||e.delete(i),this.compiledGlyphs[t]=s}}const M0={DATA:1,ERROR:2},yn={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function r3(){}function Ki(n){if(n instanceof Nu||n instanceof dS||n instanceof by||n instanceof e3||n instanceof zb||n instanceof mA)return n;switch(n instanceof Error||typeof n=="object"&&n!==null||Dt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),n.name){case"AbortException":return new Nu(n.message);case"InvalidPDFException":return new dS(n.message);case"MissingPDFException":return new by(n.message);case"PasswordException":return new e3(n.message,n.code);case"UnexpectedResponseException":return new zb(n.message,n.status);case"UnknownErrorException":return new mA(n.message,n.details)}return new mA(n.message,n.toString())}var Of,rs,QU,JU,ZU,vw;class pg{constructor(e,t,i){F(this,rs);F(this,Of,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),i.addEventListener("message",z(this,rs,QU).bind(this),{signal:d(this,Of).signal})}on(e,t){const i=this.actionHandler;if(i[e])throw new Error(`There is already an actionName called "${e}"`);i[e]=t}send(e,t,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},i)}sendWithPromise(e,t,i){const r=this.callbackId++,s=Promise.withResolvers();this.callbackCapabilities[r]=s;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:r,data:t},i)}catch(a){s.reject(a)}return s.promise}sendWithStream(e,t,i,r){const s=this.streamId++,a=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:u=>{const c=Promise.withResolvers();return this.streamControllers[s]={controller:u,startCall:c,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:a,targetName:o,action:e,streamId:s,data:t,desiredSize:u.desiredSize},r),c.promise},pull:u=>{const c=Promise.withResolvers();return this.streamControllers[s].pullCall=c,l.postMessage({sourceName:a,targetName:o,stream:yn.PULL,streamId:s,desiredSize:u.desiredSize}),c.promise},cancel:u=>{bn(u instanceof Error,"cancel must have a valid reason");const c=Promise.withResolvers();return this.streamControllers[s].cancelCall=c,this.streamControllers[s].isClosed=!0,l.postMessage({sourceName:a,targetName:o,stream:yn.CANCEL,streamId:s,reason:Ki(u)}),c.promise}},i)}destroy(){var e;(e=d(this,Of))==null||e.abort(),P(this,Of,null)}}Of=new WeakMap,rs=new WeakSet,QU=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){z(this,rs,ZU).call(this,e);return}if(e.callback){const i=e.callbackId,r=this.callbackCapabilities[i];if(!r)throw new Error(`Cannot resolve callback ${i}`);if(delete this.callbackCapabilities[i],e.callback===M0.DATA)r.resolve(e.data);else if(e.callback===M0.ERROR)r.reject(Ki(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const i=this.sourceName,r=e.sourceName,s=this.comObj;Promise.try(t,e.data).then(function(a){s.postMessage({sourceName:i,targetName:r,callback:M0.DATA,callbackId:e.callbackId,data:a})},function(a){s.postMessage({sourceName:i,targetName:r,callback:M0.ERROR,callbackId:e.callbackId,reason:Ki(a)})});return}if(e.streamId){z(this,rs,JU).call(this,e);return}t(e.data)},JU=function(e){const t=e.streamId,i=this.sourceName,r=e.sourceName,s=this.comObj,a=this,o=this.actionHandler[e.action],l={enqueue(u,c=1,h){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=c,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),s.postMessage({sourceName:i,targetName:r,stream:yn.ENQUEUE,streamId:t,chunk:u},h)},close(){this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:i,targetName:r,stream:yn.CLOSE,streamId:t}),delete a.streamSinks[t])},error(u){bn(u instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,s.postMessage({sourceName:i,targetName:r,stream:yn.ERROR,streamId:t,reason:Ki(u)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(o,e.data,l).then(function(){s.postMessage({sourceName:i,targetName:r,stream:yn.START_COMPLETE,streamId:t,success:!0})},function(u){s.postMessage({sourceName:i,targetName:r,stream:yn.START_COMPLETE,streamId:t,reason:Ki(u)})})},ZU=function(e){const t=e.streamId,i=this.sourceName,r=e.sourceName,s=this.comObj,a=this.streamControllers[t],o=this.streamSinks[t];switch(e.stream){case yn.START_COMPLETE:e.success?a.startCall.resolve():a.startCall.reject(Ki(e.reason));break;case yn.PULL_COMPLETE:e.success?a.pullCall.resolve():a.pullCall.reject(Ki(e.reason));break;case yn.PULL:if(!o){s.postMessage({sourceName:i,targetName:r,stream:yn.PULL_COMPLETE,streamId:t,success:!0});break}o.desiredSize<=0&&e.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=e.desiredSize,Promise.try(o.onPull||r3).then(function(){s.postMessage({sourceName:i,targetName:r,stream:yn.PULL_COMPLETE,streamId:t,success:!0})},function(u){s.postMessage({sourceName:i,targetName:r,stream:yn.PULL_COMPLETE,streamId:t,reason:Ki(u)})});break;case yn.ENQUEUE:if(bn(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case yn.CLOSE:if(bn(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),z(this,rs,vw).call(this,a,t);break;case yn.ERROR:bn(a,"error should have stream controller"),a.controller.error(Ki(e.reason)),z(this,rs,vw).call(this,a,t);break;case yn.CANCEL_COMPLETE:e.success?a.cancelCall.resolve():a.cancelCall.reject(Ki(e.reason)),z(this,rs,vw).call(this,a,t);break;case yn.CANCEL:if(!o)break;const l=Ki(e.reason);Promise.try(o.onCancel||r3,l).then(function(){s.postMessage({sourceName:i,targetName:r,stream:yn.CANCEL_COMPLETE,streamId:t,success:!0})},function(u){s.postMessage({sourceName:i,targetName:r,stream:yn.CANCEL_COMPLETE,streamId:t,reason:Ki(u)})}),o.sinkCapability.reject(l),o.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},vw=async function(e,t){var i,r,s;await Promise.allSettled([(i=e.startCall)==null?void 0:i.promise,(r=e.pullCall)==null?void 0:r.promise,(s=e.cancelCall)==null?void 0:s.promise]),delete this.streamControllers[t]};var Qy;class e5{constructor({enableHWA:e=!1}){F(this,Qy,!1);P(this,Qy,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const i=this._createCanvas(e,t);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!d(this,Qy)})}}reset(e,t,i){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||i<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=i}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){Dt("Abstract method `_createCanvas` called.")}}Qy=new WeakMap;class fee extends e5{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const i=this._document.createElement("canvas");return i.width=e,i.height=t,i}}class t5{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(i=>({cMapData:i,isCompressed:this.isCompressed})).catch(i=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){Dt("Abstract method `_fetch` called.")}}class n5 extends t5{async _fetch(e){const t=await ox(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):ax(t)}}class i5{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,i,r,s){return"none"}destroy(e=!1){}}var Yc,Lf,yo,_o,pi,Xc,Qc,Te,di,mg,Dh,ww,Mh,r5,NS,Oh,gg,yg,DS,_g;class pee extends i5{constructor({docId:t,ownerDocument:i=globalThis.document}){super();F(this,Te);F(this,Yc);F(this,Lf);F(this,yo);F(this,_o);F(this,pi);F(this,Xc);F(this,Qc,0);P(this,_o,t),P(this,pi,i)}addFilter(t){if(!t)return"none";let i=d(this,Te,di).get(t);if(i)return i;const[r,s,a]=z(this,Te,ww).call(this,t),o=t.length===1?r:`${r}${s}${a}`;if(i=d(this,Te,di).get(o),i)return d(this,Te,di).set(t,i),i;const l=`g_${d(this,_o)}_transfer_map_${Ii(this,Qc)._++}`,u=z(this,Te,Mh).call(this,l);d(this,Te,di).set(t,u),d(this,Te,di).set(o,u);const c=z(this,Te,Oh).call(this,l);return z(this,Te,yg).call(this,r,s,a,c),u}addHCMFilter(t,i){var y;const r=`${t}-${i}`,s="base";let a=d(this,Te,mg).get(s);if((a==null?void 0:a.key)===r||(a?((y=a.filter)==null||y.remove(),a.key=r,a.url="none",a.filter=null):(a={key:r,url:"none",filter:null},d(this,Te,mg).set(s,a)),!t||!i))return a.url;const o=z(this,Te,_g).call(this,t);t=Me.makeHexColor(...o);const l=z(this,Te,_g).call(this,i);if(i=Me.makeHexColor(...l),d(this,Te,Dh).style.color="",t==="#000000"&&i==="#ffffff"||t===i)return a.url;const u=new Array(256);for(let _=0;_<=255;_++){const x=_/255;u[_]=x<=.03928?x/12.92:((x+.055)/1.055)**2.4}const c=u.join(","),h=`g_${d(this,_o)}_hcm_filter`,f=a.filter=z(this,Te,Oh).call(this,h);z(this,Te,yg).call(this,c,c,c,f),z(this,Te,NS).call(this,f);const m=(_,x)=>{const v=o[_]/255,w=l[_]/255,E=new Array(x+1);for(let k=0;k<=x;k++)E[k]=v+k/x*(w-v);return E.join(",")};return z(this,Te,yg).call(this,m(0,5),m(1,5),m(2,5),f),a.url=z(this,Te,Mh).call(this,h),a.url}addAlphaFilter(t){let i=d(this,Te,di).get(t);if(i)return i;const[r]=z(this,Te,ww).call(this,[t]),s=`alpha_${r}`;if(i=d(this,Te,di).get(s),i)return d(this,Te,di).set(t,i),i;const a=`g_${d(this,_o)}_alpha_map_${Ii(this,Qc)._++}`,o=z(this,Te,Mh).call(this,a);d(this,Te,di).set(t,o),d(this,Te,di).set(s,o);const l=z(this,Te,Oh).call(this,a);return z(this,Te,DS).call(this,r,l),o}addLuminosityFilter(t){let i=d(this,Te,di).get(t||"luminosity");if(i)return i;let r,s;if(t?([r]=z(this,Te,ww).call(this,[t]),s=`luminosity_${r}`):s="luminosity",i=d(this,Te,di).get(s),i)return d(this,Te,di).set(t,i),i;const a=`g_${d(this,_o)}_luminosity_map_${Ii(this,Qc)._++}`,o=z(this,Te,Mh).call(this,a);d(this,Te,di).set(t,o),d(this,Te,di).set(s,o);const l=z(this,Te,Oh).call(this,a);return z(this,Te,r5).call(this,l),t&&z(this,Te,DS).call(this,r,l),o}addHighlightHCMFilter(t,i,r,s,a){var w;const o=`${i}-${r}-${s}-${a}`;let l=d(this,Te,mg).get(t);if((l==null?void 0:l.key)===o||(l?((w=l.filter)==null||w.remove(),l.key=o,l.url="none",l.filter=null):(l={key:o,url:"none",filter:null},d(this,Te,mg).set(t,l)),!i||!r))return l.url;const[u,c]=[i,r].map(z(this,Te,_g).bind(this));let h=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),f=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),[m,y]=[s,a].map(z(this,Te,_g).bind(this));f<h&&([h,f,m,y]=[f,h,y,m]),d(this,Te,Dh).style.color="";const _=(E,k,$)=>{const L=new Array(256),I=(f-h)/$,C=E/255,N=(k-E)/(255*$);let O=0;for(let V=0;V<=$;V++){const U=Math.round(h+V*I),j=C+V*N;for(let he=O;he<=U;he++)L[he]=j;O=U+1}for(let V=O;V<256;V++)L[V]=L[O-1];return L.join(",")},x=`g_${d(this,_o)}_hcm_${t}_filter`,v=l.filter=z(this,Te,Oh).call(this,x);return z(this,Te,NS).call(this,v),z(this,Te,yg).call(this,_(m[0],y[0],5),_(m[1],y[1],5),_(m[2],y[2],5),v),l.url=z(this,Te,Mh).call(this,x),l.url}destroy(t=!1){var i,r,s,a;t&&((i=d(this,Xc))!=null&&i.size)||((r=d(this,yo))==null||r.parentNode.parentNode.remove(),P(this,yo,null),(s=d(this,Lf))==null||s.clear(),P(this,Lf,null),(a=d(this,Xc))==null||a.clear(),P(this,Xc,null),P(this,Qc,0))}}Yc=new WeakMap,Lf=new WeakMap,yo=new WeakMap,_o=new WeakMap,pi=new WeakMap,Xc=new WeakMap,Qc=new WeakMap,Te=new WeakSet,di=function(){return d(this,Lf)||P(this,Lf,new Map)},mg=function(){return d(this,Xc)||P(this,Xc,new Map)},Dh=function(){if(!d(this,yo)){const t=d(this,pi).createElement("div"),{style:i}=t;i.visibility="hidden",i.contain="strict",i.width=i.height=0,i.position="absolute",i.top=i.left=0,i.zIndex=-1;const r=d(this,pi).createElementNS(no,"svg");r.setAttribute("width",0),r.setAttribute("height",0),P(this,yo,d(this,pi).createElementNS(no,"defs")),t.append(r),r.append(d(this,yo)),d(this,pi).body.append(t)}return d(this,yo)},ww=function(t){if(t.length===1){const u=t[0],c=new Array(256);for(let f=0;f<256;f++)c[f]=u[f]/255;const h=c.join(",");return[h,h,h]}const[i,r,s]=t,a=new Array(256),o=new Array(256),l=new Array(256);for(let u=0;u<256;u++)a[u]=i[u]/255,o[u]=r[u]/255,l[u]=s[u]/255;return[a.join(","),o.join(","),l.join(",")]},Mh=function(t){if(d(this,Yc)===void 0){P(this,Yc,"");const i=d(this,pi).URL;i!==d(this,pi).baseURI&&(lx(i)?et('#createUrl: ignore "data:"-URL for performance reasons.'):P(this,Yc,i.split("#",1)[0]))}return`url(${d(this,Yc)}#${t})`},r5=function(t){const i=d(this,pi).createElementNS(no,"feColorMatrix");i.setAttribute("type","matrix"),i.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(i)},NS=function(t){const i=d(this,pi).createElementNS(no,"feColorMatrix");i.setAttribute("type","matrix"),i.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(i)},Oh=function(t){const i=d(this,pi).createElementNS(no,"filter");return i.setAttribute("color-interpolation-filters","sRGB"),i.setAttribute("id",t),d(this,Te,Dh).append(i),i},gg=function(t,i,r){const s=d(this,pi).createElementNS(no,i);s.setAttribute("type","discrete"),s.setAttribute("tableValues",r),t.append(s)},yg=function(t,i,r,s){const a=d(this,pi).createElementNS(no,"feComponentTransfer");s.append(a),z(this,Te,gg).call(this,a,"feFuncR",t),z(this,Te,gg).call(this,a,"feFuncG",i),z(this,Te,gg).call(this,a,"feFuncB",r)},DS=function(t,i){const r=d(this,pi).createElementNS(no,"feComponentTransfer");i.append(r),z(this,Te,gg).call(this,r,"feFuncA",t)},_g=function(t){return d(this,Te,Dh).style.color=t,UC(getComputedStyle(d(this,Te,Dh)).getPropertyValue("color"))};class s5{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(i=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){Dt("Abstract method `_fetch` called.")}}class a5 extends s5{async _fetch(e){const t=await ox(e,"arraybuffer");return new Uint8Array(t)}}xi&&et("Please use the `legacy` build in Node.js environments.");async function o5(n){const t=await process.getBuiltinModule("fs").promises.readFile(n);return new Uint8Array(t)}class mee extends i5{}class gee extends e5{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class yee extends t5{async _fetch(e){return o5(e)}}class _ee extends s5{async _fetch(e){return o5(e)}}const vi={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function MS(n,e){if(!e)return;const t=e[2]-e[0],i=e[3]-e[1],r=new Path2D;r.rect(e[0],e[1],t,i),n.clip(r)}class WC{getPattern(){Dt("Abstract method `getPattern` called.")}}class vee extends WC{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const i of this._colorStops)t.addColorStop(i[0],i[1]);return t}getPattern(e,t,i,r){let s;if(r===vi.STROKE||r===vi.FILL){const a=t.current.getClippedPathBoundingBox(r,qt(e))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,l=Math.ceil(a[3]-a[1])||1,u=t.cachedCanvases.getCanvas("pattern",o,l),c=u.context;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.beginPath(),c.rect(0,0,c.canvas.width,c.canvas.height),c.translate(-a[0],-a[1]),i=Me.transform(i,[1,0,0,1,a[0],a[1]]),c.transform(...t.baseTransform),this.matrix&&c.transform(...this.matrix),MS(c,this._bbox),c.fillStyle=this._createGradient(c),c.fill(),s=e.createPattern(u.canvas,"no-repeat");const h=new DOMMatrix(i);s.setTransform(h)}else MS(e,this._bbox),s=this._createGradient(e);return s}}function _A(n,e,t,i,r,s,a,o){const l=e.coords,u=e.colors,c=n.data,h=n.width*4;let f;l[t+1]>l[i+1]&&(f=t,t=i,i=f,f=s,s=a,a=f),l[i+1]>l[r+1]&&(f=i,i=r,r=f,f=a,a=o,o=f),l[t+1]>l[i+1]&&(f=t,t=i,i=f,f=s,s=a,a=f);const m=(l[t]+e.offsetX)*e.scaleX,y=(l[t+1]+e.offsetY)*e.scaleY,_=(l[i]+e.offsetX)*e.scaleX,x=(l[i+1]+e.offsetY)*e.scaleY,v=(l[r]+e.offsetX)*e.scaleX,w=(l[r+1]+e.offsetY)*e.scaleY;if(y>=w)return;const E=u[s],k=u[s+1],$=u[s+2],L=u[a],I=u[a+1],C=u[a+2],N=u[o],O=u[o+1],V=u[o+2],U=Math.round(y),j=Math.round(w);let he,me,te,oe,G,W,K,H;for(let Q=U;Q<=j;Q++){if(Q<x){const X=Q<y?0:(y-Q)/(y-x);he=m-(m-_)*X,me=E-(E-L)*X,te=k-(k-I)*X,oe=$-($-C)*X}else{let X;Q>w?X=1:x===w?X=0:X=(x-Q)/(x-w),he=_-(_-v)*X,me=L-(L-N)*X,te=I-(I-O)*X,oe=C-(C-V)*X}let Y;Q<y?Y=0:Q>w?Y=1:Y=(y-Q)/(y-w),G=m-(m-v)*Y,W=E-(E-N)*Y,K=k-(k-O)*Y,H=$-($-V)*Y;const Z=Math.round(Math.min(he,G)),fe=Math.round(Math.max(he,G));let _e=h*Q+Z*4;for(let X=Z;X<=fe;X++)Y=(he-X)/(he-G),Y<0?Y=0:Y>1&&(Y=1),c[_e++]=me-(me-W)*Y|0,c[_e++]=te-(te-K)*Y|0,c[_e++]=oe-(oe-H)*Y|0,c[_e++]=255}}function wee(n,e,t){const i=e.coords,r=e.colors;let s,a;switch(e.type){case"lattice":const o=e.verticesPerRow,l=Math.floor(i.length/o)-1,u=o-1;for(s=0;s<l;s++){let c=s*o;for(let h=0;h<u;h++,c++)_A(n,t,i[c],i[c+1],i[c+o],r[c],r[c+1],r[c+o]),_A(n,t,i[c+o+1],i[c+1],i[c+o],r[c+o+1],r[c+1],r[c+o])}break;case"triangles":for(s=0,a=i.length;s<a;s+=3)_A(n,t,i[s],i[s+1],i[s+2],r[s],r[s+1],r[s+2]);break;default:throw new Error("illegal figure")}}class bee extends WC{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,i){const o=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),u=Math.ceil(this._bounds[2])-o,c=Math.ceil(this._bounds[3])-l,h=Math.min(Math.ceil(Math.abs(u*e[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(c*e[1]*1.1)),3e3),m=u/h,y=c/f,_={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-l,scaleX:1/m,scaleY:1/y},x=h+2*2,v=f+2*2,w=i.getCanvas("mesh",x,v),E=w.context,k=E.createImageData(h,f);if(t){const L=k.data;for(let I=0,C=L.length;I<C;I+=4)L[I]=t[0],L[I+1]=t[1],L[I+2]=t[2],L[I+3]=255}for(const L of this._figures)wee(k,L,_);return E.putImageData(k,2,2),{canvas:w.canvas,offsetX:o-2*m,offsetY:l-2*y,scaleX:m,scaleY:y}}getPattern(e,t,i,r){MS(e,this._bbox);let s;if(r===vi.SHADING)s=Me.singularValueDecompose2dScale(qt(e));else if(s=Me.singularValueDecompose2dScale(t.baseTransform),this.matrix){const o=Me.singularValueDecompose2dScale(this.matrix);s=[s[0]*o[0],s[1]*o[1]]}const a=this._createMeshCanvas(s,r===vi.SHADING?null:this._background,t.cachedCanvases);return r!==vi.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(a.offsetX,a.offsetY),e.scale(a.scaleX,a.scaleY),e.createPattern(a.canvas,"no-repeat")}}class xee extends WC{getPattern(){return"hotpink"}}function Eee(n){switch(n[0]){case"RadialAxial":return new vee(n);case"Mesh":return new bee(n);case"Dummy":return new xee}throw new Error(`Unknown IR type: ${n[0]}`)}const s3={COLORED:1,UNCOLORED:2},t1=class t1{constructor(e,t,i,r,s){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=i,this.canvasGraphicsFactory=r,this.baseTransform=s}createPatternCanvas(e){const{bbox:t,operatorList:i,paintType:r,tilingType:s,color:a,canvasGraphicsFactory:o}=this;let{xstep:l,ystep:u}=this;l=Math.abs(l),u=Math.abs(u),sx("TilingType: "+s);const c=t[0],h=t[1],f=t[2],m=t[3],y=f-c,_=m-h,x=Me.singularValueDecompose2dScale(this.matrix),v=Me.singularValueDecompose2dScale(this.baseTransform),w=x[0]*v[0],E=x[1]*v[1];let k=y,$=_,L=!1,I=!1;const C=Math.ceil(l*w),N=Math.ceil(u*E),O=Math.ceil(y*w),V=Math.ceil(_*E);C>=O?k=l:L=!0,N>=V?$=u:I=!0;const U=this.getSizeAndScale(k,this.ctx.canvas.width,w),j=this.getSizeAndScale($,this.ctx.canvas.height,E),he=e.cachedCanvases.getCanvas("pattern",U.size,j.size),me=he.context,te=o.createCanvasGraphics(me);if(te.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(te,r,a),me.translate(-U.scale*c,-j.scale*h),te.transform(U.scale,0,0,j.scale,0,0),me.save(),this.clipBbox(te,c,h,f,m),te.baseTransform=qt(te.ctx),te.executeOperatorList(i),te.endDrawing(),me.restore(),L||I){const oe=he.canvas;L&&(k=l),I&&($=u);const G=this.getSizeAndScale(k,this.ctx.canvas.width,w),W=this.getSizeAndScale($,this.ctx.canvas.height,E),K=G.size,H=W.size,Q=e.cachedCanvases.getCanvas("pattern-workaround",K,H),Y=Q.context,Z=L?Math.floor(y/l):0,fe=I?Math.floor(_/u):0;for(let _e=0;_e<=Z;_e++)for(let X=0;X<=fe;X++)Y.drawImage(oe,K*_e,H*X,K,H,0,0,K,H);return{canvas:Q.canvas,scaleX:G.scale,scaleY:W.scale,offsetX:c,offsetY:h}}return{canvas:he.canvas,scaleX:U.scale,scaleY:j.scale,offsetX:c,offsetY:h}}getSizeAndScale(e,t,i){const r=Math.max(t1.MAX_PATTERN_SIZE,t);let s=Math.ceil(e*i);return s>=r?s=r:i=s/e,{scale:i,size:s}}clipBbox(e,t,i,r,s){const a=r-t,o=s-i;e.ctx.rect(t,i,a,o),e.current.updateRectMinMax(qt(e.ctx),[t,i,r,s]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,i){const r=e.ctx,s=e.current;switch(t){case s3.COLORED:const a=this.ctx;r.fillStyle=a.fillStyle,r.strokeStyle=a.strokeStyle,s.fillColor=a.fillStyle,s.strokeColor=a.strokeStyle;break;case s3.UNCOLORED:const o=Me.makeHexColor(i[0],i[1],i[2]);r.fillStyle=o,r.strokeStyle=o,s.fillColor=o,s.strokeColor=o;break;default:throw new YZ(`Unsupported paint type: ${t}`)}}getPattern(e,t,i,r){let s=i;r!==vi.SHADING&&(s=Me.transform(s,t.baseTransform),this.matrix&&(s=Me.transform(s,this.matrix)));const a=this.createPatternCanvas(t);let o=new DOMMatrix(s);o=o.translate(a.offsetX,a.offsetY),o=o.scale(1/a.scaleX,1/a.scaleY);const l=e.createPattern(a.canvas,"repeat");return l.setTransform(o),l}};ze(t1,"MAX_PATTERN_SIZE",3e3);let OS=t1;function Aee({src:n,srcPos:e=0,dest:t,width:i,height:r,nonBlackColor:s=4294967295,inverseDecode:a=!1}){const o=Oi.isLittleEndian?4278190080:255,[l,u]=a?[s,o]:[o,s],c=i>>3,h=i&7,f=n.length;t=new Uint32Array(t.buffer);let m=0;for(let y=0;y<r;y++){for(const x=e+c;e<x;e++){const v=e<f?n[e]:255;t[m++]=v&128?u:l,t[m++]=v&64?u:l,t[m++]=v&32?u:l,t[m++]=v&16?u:l,t[m++]=v&8?u:l,t[m++]=v&4?u:l,t[m++]=v&2?u:l,t[m++]=v&1?u:l}if(h===0)continue;const _=e<f?n[e++]:255;for(let x=0;x<h;x++)t[m++]=_&1<<7-x?u:l}return{srcPos:e,destPos:m}}const a3=16,o3=100,Tee=15,l3=10,u3=1e3,Zi=16;function See(n,e){if(n._removeMirroring)throw new Error("Context is already forwarding operations.");n.__originalSave=n.save,n.__originalRestore=n.restore,n.__originalRotate=n.rotate,n.__originalScale=n.scale,n.__originalTranslate=n.translate,n.__originalTransform=n.transform,n.__originalSetTransform=n.setTransform,n.__originalResetTransform=n.resetTransform,n.__originalClip=n.clip,n.__originalMoveTo=n.moveTo,n.__originalLineTo=n.lineTo,n.__originalBezierCurveTo=n.bezierCurveTo,n.__originalRect=n.rect,n.__originalClosePath=n.closePath,n.__originalBeginPath=n.beginPath,n._removeMirroring=()=>{n.save=n.__originalSave,n.restore=n.__originalRestore,n.rotate=n.__originalRotate,n.scale=n.__originalScale,n.translate=n.__originalTranslate,n.transform=n.__originalTransform,n.setTransform=n.__originalSetTransform,n.resetTransform=n.__originalResetTransform,n.clip=n.__originalClip,n.moveTo=n.__originalMoveTo,n.lineTo=n.__originalLineTo,n.bezierCurveTo=n.__originalBezierCurveTo,n.rect=n.__originalRect,n.closePath=n.__originalClosePath,n.beginPath=n.__originalBeginPath,delete n._removeMirroring},n.save=function(){e.save(),this.__originalSave()},n.restore=function(){e.restore(),this.__originalRestore()},n.translate=function(i,r){e.translate(i,r),this.__originalTranslate(i,r)},n.scale=function(i,r){e.scale(i,r),this.__originalScale(i,r)},n.transform=function(i,r,s,a,o,l){e.transform(i,r,s,a,o,l),this.__originalTransform(i,r,s,a,o,l)},n.setTransform=function(i,r,s,a,o,l){e.setTransform(i,r,s,a,o,l),this.__originalSetTransform(i,r,s,a,o,l)},n.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},n.rotate=function(i){e.rotate(i),this.__originalRotate(i)},n.clip=function(i){e.clip(i),this.__originalClip(i)},n.moveTo=function(t,i){e.moveTo(t,i),this.__originalMoveTo(t,i)},n.lineTo=function(t,i){e.lineTo(t,i),this.__originalLineTo(t,i)},n.bezierCurveTo=function(t,i,r,s,a,o){e.bezierCurveTo(t,i,r,s,a,o),this.__originalBezierCurveTo(t,i,r,s,a,o)},n.rect=function(t,i,r,s){e.rect(t,i,r,s),this.__originalRect(t,i,r,s)},n.closePath=function(){e.closePath(),this.__originalClosePath()},n.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class Iee{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,i){let r;return this.cache[e]!==void 0?(r=this.cache[e],this.canvasFactory.reset(r,t,i)):(r=this.canvasFactory.create(t,i),this.cache[e]=r),r}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function O0(n,e,t,i,r,s,a,o,l,u){const[c,h,f,m,y,_]=qt(n);if(h===0&&f===0){const w=a*c+y,E=Math.round(w),k=o*m+_,$=Math.round(k),L=(a+l)*c+y,I=Math.abs(Math.round(L)-E)||1,C=(o+u)*m+_,N=Math.abs(Math.round(C)-$)||1;return n.setTransform(Math.sign(c),0,0,Math.sign(m),E,$),n.drawImage(e,t,i,r,s,0,0,I,N),n.setTransform(c,h,f,m,y,_),[I,N]}if(c===0&&m===0){const w=o*f+y,E=Math.round(w),k=a*h+_,$=Math.round(k),L=(o+u)*f+y,I=Math.abs(Math.round(L)-E)||1,C=(a+l)*h+_,N=Math.abs(Math.round(C)-$)||1;return n.setTransform(0,Math.sign(h),Math.sign(f),0,E,$),n.drawImage(e,t,i,r,s,0,0,N,I),n.setTransform(c,h,f,m,y,_),[N,I]}n.drawImage(e,t,i,r,s,a,o,l,u);const x=Math.hypot(c,h),v=Math.hypot(f,m);return[x*l,v*u]}function Cee(n){const{width:e,height:t}=n;if(e>u3||t>u3)return null;const i=1e3,r=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),s=e+1;let a=new Uint8Array(s*(t+1)),o,l,u;const c=e+7&-8;let h=new Uint8Array(c*t),f=0;for(const v of n.data){let w=128;for(;w>0;)h[f++]=v&w?0:255,w>>=1}let m=0;for(f=0,h[f]!==0&&(a[0]=1,++m),l=1;l<e;l++)h[f]!==h[f+1]&&(a[l]=h[f]?2:1,++m),f++;for(h[f]!==0&&(a[l]=2,++m),o=1;o<t;o++){f=o*c,u=o*s,h[f-c]!==h[f]&&(a[u]=h[f]?1:8,++m);let v=(h[f]?4:0)+(h[f-c]?8:0);for(l=1;l<e;l++)v=(v>>2)+(h[f+1]?4:0)+(h[f-c+1]?8:0),r[v]&&(a[u+l]=r[v],++m),f++;if(h[f-c]!==h[f]&&(a[u+l]=h[f]?2:4,++m),m>i)return null}for(f=c*(t-1),u=o*s,h[f]!==0&&(a[u]=8,++m),l=1;l<e;l++)h[f]!==h[f+1]&&(a[u+l]=h[f]?4:8,++m),f++;if(h[f]!==0&&(a[u+l]=4,++m),m>i)return null;const y=new Int32Array([0,s,-1,0,-s,0,0,0,1]),_=new Path2D;for(o=0;m&&o<=t;o++){let v=o*s;const w=v+e;for(;v<w&&!a[v];)v++;if(v===w)continue;_.moveTo(v%s,o);const E=v;let k=a[v];do{const $=y[k];do v+=$;while(!a[v]);const L=a[v];L!==5&&L!==10?(k=L,a[v]=0):(k=L&51*k>>4,a[v]&=k>>2|k<<2),_.lineTo(v%s,v/s|0),a[v]||--m}while(E!==v);--o}return h=null,a=null,function(v){v.save(),v.scale(1/e,-1/t),v.translate(0,-t),v.fill(_),v.beginPath(),v.restore()}}class c3{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=yU,this.textMatrixScale=1,this.fontMatrix=cS,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=ci.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,i){[t,i]=Me.applyTransform([t,i],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,i),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,i)}updateRectMinMax(e,t){const i=Me.applyTransform(t,e),r=Me.applyTransform(t.slice(2),e),s=Me.applyTransform([t[0],t[3]],e),a=Me.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,i[0],r[0],s[0],a[0]),this.minY=Math.min(this.minY,i[1],r[1],s[1],a[1]),this.maxX=Math.max(this.maxX,i[0],r[0],s[0],a[0]),this.maxY=Math.max(this.maxY,i[1],r[1],s[1],a[1])}updateScalingPathMinMax(e,t){Me.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,i,r,s,a,o,l,u,c){const h=Me.bezierBoundingBox(t,i,r,s,a,o,l,u,c);c||this.updateRectMinMax(e,h)}getPathBoundingBox(e=vi.FILL,t=null){const i=[this.minX,this.minY,this.maxX,this.maxY];if(e===vi.STROKE){t||Dt("Stroke bounding box must include transform.");const r=Me.singularValueDecompose2dScale(t),s=r[0]*this.lineWidth/2,a=r[1]*this.lineWidth/2;i[0]-=s,i[1]-=a,i[2]+=s,i[3]+=a}return i}updateClipFromPath(){const e=Me.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=vi.FILL,t=null){return Me.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function d3(n,e){if(e instanceof ImageData){n.putImageData(e,0,0);return}const t=e.height,i=e.width,r=t%Zi,s=(t-r)/Zi,a=r===0?s:s+1,o=n.createImageData(i,Zi);let l=0,u;const c=e.data,h=o.data;let f,m,y,_;if(e.kind===cw.GRAYSCALE_1BPP){const x=c.byteLength,v=new Uint32Array(h.buffer,0,h.byteLength>>2),w=v.length,E=i+7>>3,k=4294967295,$=Oi.isLittleEndian?4278190080:255;for(f=0;f<a;f++){for(y=f<s?Zi:r,u=0,m=0;m<y;m++){const L=x-l;let I=0;const C=L>E?i:L*8-7,N=C&-8;let O=0,V=0;for(;I<N;I+=8)V=c[l++],v[u++]=V&128?k:$,v[u++]=V&64?k:$,v[u++]=V&32?k:$,v[u++]=V&16?k:$,v[u++]=V&8?k:$,v[u++]=V&4?k:$,v[u++]=V&2?k:$,v[u++]=V&1?k:$;for(;I<C;I++)O===0&&(V=c[l++],O=128),v[u++]=V&O?k:$,O>>=1}for(;u<w;)v[u++]=0;n.putImageData(o,0,f*Zi)}}else if(e.kind===cw.RGBA_32BPP){for(m=0,_=i*Zi*4,f=0;f<s;f++)h.set(c.subarray(l,l+_)),l+=_,n.putImageData(o,0,m),m+=Zi;f<a&&(_=i*r*4,h.set(c.subarray(l,l+_)),n.putImageData(o,0,m))}else if(e.kind===cw.RGB_24BPP)for(y=Zi,_=i*y,f=0;f<a;f++){for(f>=s&&(y=r,_=i*y),u=0,m=_;m--;)h[u++]=c[l++],h[u++]=c[l++],h[u++]=c[l++],h[u++]=255;n.putImageData(o,0,f*Zi)}else throw new Error(`bad image kind: ${e.kind}`)}function h3(n,e){if(e.bitmap){n.drawImage(e.bitmap,0,0);return}const t=e.height,i=e.width,r=t%Zi,s=(t-r)/Zi,a=r===0?s:s+1,o=n.createImageData(i,Zi);let l=0;const u=e.data,c=o.data;for(let h=0;h<a;h++){const f=h<s?Zi:r;({srcPos:l}=Aee({src:u,srcPos:l,dest:c,width:i,height:f,nonBlackColor:0})),n.putImageData(o,0,h*Zi)}}function qm(n,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of t)n[i]!==void 0&&(e[i]=n[i]);n.setLineDash!==void 0&&(e.setLineDash(n.getLineDash()),e.lineDashOffset=n.lineDashOffset)}function L0(n){if(n.strokeStyle=n.fillStyle="#000000",n.fillRule="nonzero",n.globalAlpha=1,n.lineWidth=1,n.lineCap="butt",n.lineJoin="miter",n.miterLimit=10,n.globalCompositeOperation="source-over",n.font="10px sans-serif",n.setLineDash!==void 0&&(n.setLineDash([]),n.lineDashOffset=0),!xi){const{filter:e}=n;e!=="none"&&e!==""&&(n.filter="none")}}function f3(n,e){if(e)return!0;const t=Me.singularValueDecompose2dScale(n);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);const i=Math.fround((globalThis.devicePixelRatio||1)*Du.PDF_TO_CSS_UNITS);return t[0]<=i&&t[1]<=i}const kee=["butt","round","square"],$ee=["miter","round","bevel"],Ree={},p3={};var Zs,LS,FS,zS;const QC=class QC{constructor(e,t,i,r,s,{optionalContentConfig:a,markedContentStack:o=null},l,u){F(this,Zs);this.ctx=e,this.current=new c3(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=i,this.canvasFactory=r,this.filterFactory=s,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new Iee(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=u,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:i=!1,background:r=null}){const s=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=r||"#ffffff",this.ctx.fillRect(0,0,s,a),this.ctx.fillStyle=o,i){const l=this.cachedCanvases.getCanvas("transparent",s,a);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...qt(this.compositeCtx))}this.ctx.save(),L0(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=qt(this.ctx)}executeOperatorList(e,t,i,r){const s=e.argsArray,a=e.fnArray;let o=t||0;const l=s.length;if(l===o)return o;const u=l-o>l3&&typeof i=="function",c=u?Date.now()+Tee:0;let h=0;const f=this.commonObjs,m=this.objs;let y;for(;;){if(r!==void 0&&o===r.nextBreakPoint)return r.breakIt(o,i),o;if(y=a[o],y!==As.dependency)this[y].apply(this,s[o]);else for(const _ of s[o]){const x=_.startsWith("g_")?f:m;if(!x.has(_))return x.get(_,i),o}if(o++,o===l)return o;if(u&&++h>l3){if(Date.now()>c)return i(),o;h=0}}}endDrawing(){z(this,Zs,LS).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),z(this,Zs,FS).call(this)}_scaleImage(e,t){const i=e.width??e.displayWidth,r=e.height??e.displayHeight;let s=Math.max(Math.hypot(t[0],t[1]),1),a=Math.max(Math.hypot(t[2],t[3]),1),o=i,l=r,u="prescale1",c,h;for(;s>2&&o>1||a>2&&l>1;){let f=o,m=l;s>2&&o>1&&(f=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),s/=o/f),a>2&&l>1&&(m=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,a/=l/m),c=this.cachedCanvases.getCanvas(u,f,m),h=c.context,h.clearRect(0,0,f,m),h.drawImage(e,0,0,o,l,0,0,f,m),e=c.canvas,o=f,l=m,u=u==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:o,paintHeight:l}}_createMaskCanvas(e){const t=this.ctx,{width:i,height:r}=e,s=this.current.fillColor,a=this.current.patternFill,o=qt(t);let l,u,c,h;if((e.bitmap||e.data)&&e.count>1){const C=e.bitmap||e.data.buffer;u=JSON.stringify(a?o:[o.slice(0,4),s]),l=this._cachedBitmapsMap.get(C),l||(l=new Map,this._cachedBitmapsMap.set(C,l));const N=l.get(u);if(N&&!a){const O=Math.round(Math.min(o[0],o[2])+o[4]),V=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:N,offsetX:O,offsetY:V}}c=N}c||(h=this.cachedCanvases.getCanvas("maskCanvas",i,r),h3(h.context,e));let f=Me.transform(o,[1/i,0,0,-1/r,0,0]);f=Me.transform(f,[1,0,0,1,0,-r]);const[m,y,_,x]=Me.getAxialAlignedBoundingBox([0,0,i,r],f),v=Math.round(_-m)||1,w=Math.round(x-y)||1,E=this.cachedCanvases.getCanvas("fillCanvas",v,w),k=E.context,$=m,L=y;k.translate(-$,-L),k.transform(...f),c||(c=this._scaleImage(h.canvas,ca(k)),c=c.img,l&&a&&l.set(u,c)),k.imageSmoothingEnabled=f3(qt(k),e.interpolate),O0(k,c,0,0,c.width,c.height,0,0,i,r),k.globalCompositeOperation="source-in";const I=Me.transform(ca(k),[1,0,0,1,-$,-L]);return k.fillStyle=a?s.getPattern(t,this,I,vi.FILL):s,k.fillRect(0,0,i,r),l&&!a&&(this.cachedCanvases.delete("fillCanvas"),l.set(u,E.canvas)),{canvas:E.canvas,offsetX:Math.round($),offsetY:Math.round(L)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=kee[e]}setLineJoin(e){this.ctx.lineJoin=$ee[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(e),i.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,i]of e)switch(t){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i[0],i[1]);break;case"CA":this.current.strokeAlpha=i;break;case"ca":this.current.fillAlpha=i,this.ctx.globalAlpha=i;break;case"BM":this.ctx.globalCompositeOperation=i;break;case"SMask":this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(i,e,t);this.suspendedCtx=this.ctx,this.ctx=r.context;const s=this.ctx;s.setTransform(...qt(this.suspendedCtx)),qm(this.suspendedCtx,s),See(s,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),qm(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,i=this.suspendedCtx;this.composeSMask(i,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,i,r){const s=r[0],a=r[1],o=r[2]-s,l=r[3]-a;o===0||l===0||(this.genericComposeSMask(t.context,i,o,l,t.subtype,t.backdrop,t.transferMap,s,a,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(i.canvas,0,0),e.restore())}genericComposeSMask(e,t,i,r,s,a,o,l,u,c,h){let f=e.canvas,m=l-c,y=u-h;if(a){const x=Me.makeHexColor(...a);if(m<0||y<0||m+i>f.width||y+r>f.height){const v=this.cachedCanvases.getCanvas("maskExtension",i,r),w=v.context;w.drawImage(f,-m,-y),w.globalCompositeOperation="destination-atop",w.fillStyle=x,w.fillRect(0,0,i,r),w.globalCompositeOperation="source-over",f=v.canvas,m=y=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const v=new Path2D;v.rect(m,y,i,r),e.clip(v),e.globalCompositeOperation="destination-atop",e.fillStyle=x,e.fillRect(m,y,i,r),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),s==="Alpha"&&o?t.filter=this.filterFactory.addAlphaFilter(o):s==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(o));const _=new Path2D;_.rect(l,u,i,r),t.clip(_),t.globalCompositeOperation="destination-in",t.drawImage(f,m,y,i,r,l,u,i,r),t.restore()}save(){this.inSMaskMode?(qm(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),qm(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,i,r,s,a){this.ctx.transform(e,t,i,r,s,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,i){const r=this.ctx,s=this.current;let a=s.x,o=s.y,l,u;const c=qt(r),h=c[0]===0&&c[3]===0||c[1]===0&&c[2]===0,f=h?i.slice(0):null;for(let m=0,y=0,_=e.length;m<_;m++)switch(e[m]|0){case As.rectangle:a=t[y++],o=t[y++];const x=t[y++],v=t[y++],w=a+x,E=o+v;r.moveTo(a,o),x===0||v===0?r.lineTo(w,E):(r.lineTo(w,o),r.lineTo(w,E),r.lineTo(a,E)),h||s.updateRectMinMax(c,[a,o,w,E]),r.closePath();break;case As.moveTo:a=t[y++],o=t[y++],r.moveTo(a,o),h||s.updatePathMinMax(c,a,o);break;case As.lineTo:a=t[y++],o=t[y++],r.lineTo(a,o),h||s.updatePathMinMax(c,a,o);break;case As.curveTo:l=a,u=o,a=t[y+4],o=t[y+5],r.bezierCurveTo(t[y],t[y+1],t[y+2],t[y+3],a,o),s.updateCurvePathMinMax(c,l,u,t[y],t[y+1],t[y+2],t[y+3],a,o,f),y+=6;break;case As.curveTo2:l=a,u=o,r.bezierCurveTo(a,o,t[y],t[y+1],t[y+2],t[y+3]),s.updateCurvePathMinMax(c,l,u,a,o,t[y],t[y+1],t[y+2],t[y+3],f),a=t[y+2],o=t[y+3],y+=4;break;case As.curveTo3:l=a,u=o,a=t[y+2],o=t[y+3],r.bezierCurveTo(t[y],t[y+1],a,o,a,o),s.updateCurvePathMinMax(c,l,u,t[y],t[y+1],a,o,a,o,f),y+=4;break;case As.closePath:r.closePath();break}h&&s.updateScalingPathMinMax(c,f),s.setCurrentPoint(a,o)}closePath(){this.ctx.closePath()}stroke(e=!0){const t=this.ctx,i=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof i=="object"&&(i!=null&&i.getPattern)?(t.save(),t.strokeStyle=i.getPattern(t,this,ca(t),vi.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){const t=this.ctx,i=this.current.fillColor,r=this.current.patternFill;let s=!1;r&&(t.save(),t.fillStyle=i.getPattern(t,this,ca(t),vi.FILL),s=!0);const a=this.current.getClippedPathBoundingBox();this.contentVisible&&a!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),s&&t.restore(),e&&this.consumePath(a)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=Ree}eoClip(){this.pendingClip=p3}beginText(){this.current.textMatrix=yU,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}const i=new Path2D,r=t.getTransform().invertSelf();for(const{transform:s,x:a,y:o,fontSize:l,path:u}of e)i.addPath(u,new DOMMatrix(s).preMultiplySelf(r).translate(a,o).scale(l,-l));t.clip(i),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var c;const i=this.commonObjs.get(e),r=this.current;if(!i)throw new Error(`Can't find font for ${e}`);if(r.fontMatrix=i.fontMatrix||cS,(r.fontMatrix[0]===0||r.fontMatrix[3]===0)&&et("Invalid font matrix for font "+e),t<0?(t=-t,r.fontDirection=-1):r.fontDirection=1,this.current.font=i,this.current.fontSize=t,i.isType3Font)return;const s=i.loadedName||"sans-serif",a=((c=i.systemFontInfo)==null?void 0:c.css)||`"${s}", ${i.fallbackName}`;let o="normal";i.black?o="900":i.bold&&(o="bold");const l=i.italic?"italic":"normal";let u=t;t<a3?u=a3:t>o3&&(u=o3),this.current.fontSizeScale=t/u,this.ctx.font=`${l} ${o} ${u}px ${a}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,i,r,s,a){this.current.textMatrix=[e,t,i,r,s,a],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,i,r,s){const a=this.ctx,o=this.current,l=o.font,u=o.textRenderingMode,c=o.fontSize/o.fontSizeScale,h=u&ci.FILL_STROKE_MASK,f=!!(u&ci.ADD_TO_PATH_FLAG),m=o.patternFill&&!l.missingFile,y=o.patternStroke&&!l.missingFile;let _;if((l.disableFontFace||f||m||y)&&(_=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||m||y){if(a.save(),a.translate(t,i),a.scale(c,-c),h===ci.FILL||h===ci.FILL_STROKE)if(r){const x=a.getTransform();a.setTransform(...r),a.fill(z(this,Zs,zS).call(this,_,x,r))}else a.fill(_);if(h===ci.STROKE||h===ci.FILL_STROKE)if(s){const x=a.getTransform();a.setTransform(...s),a.stroke(z(this,Zs,zS).call(this,_,x,s))}else a.lineWidth/=c,a.stroke(_);a.restore()}else(h===ci.FILL||h===ci.FILL_STROKE)&&a.fillText(e,t,i),(h===ci.STROKE||h===ci.FILL_STROKE)&&a.strokeText(e,t,i);f&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:qt(a),x:t,y:i,fontSize:c,path:_})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let i=!1;for(let r=3;r<t.length;r+=4)if(t[r]>0&&t[r]<255){i=!0;break}return st(this,"isFontSubpixelAAEnabled",i)}showText(e){const t=this.current,i=t.font;if(i.isType3Font)return this.showType3Text(e);const r=t.fontSize;if(r===0)return;const s=this.ctx,a=t.fontSizeScale,o=t.charSpacing,l=t.wordSpacing,u=t.fontDirection,c=t.textHScale*u,h=e.length,f=i.vertical,m=f?1:-1,y=i.defaultVMetrics,_=r*t.fontMatrix[0],x=t.textRenderingMode===ci.FILL&&!i.disableFontFace&&!t.patternFill;s.save(),s.transform(...t.textMatrix),s.translate(t.x,t.y+t.textRise),u>0?s.scale(c,-1):s.scale(c,1);let v,w;if(t.patternFill){s.save();const I=t.fillColor.getPattern(s,this,ca(s),vi.FILL);v=qt(s),s.restore(),s.fillStyle=I}if(t.patternStroke){s.save();const I=t.strokeColor.getPattern(s,this,ca(s),vi.STROKE);w=qt(s),s.restore(),s.strokeStyle=I}let E=t.lineWidth;const k=t.textMatrixScale;if(k===0||E===0){const I=t.textRenderingMode&ci.FILL_STROKE_MASK;(I===ci.STROKE||I===ci.FILL_STROKE)&&(E=this.getSinglePixelWidth())}else E/=k;if(a!==1&&(s.scale(a,a),E/=a),s.lineWidth=E,i.isInvalidPDFjsFont){const I=[];let C=0;for(const N of e)I.push(N.unicode),C+=N.width;s.fillText(I.join(""),0,0),t.x+=C*_*c,s.restore(),this.compose();return}let $=0,L;for(L=0;L<h;++L){const I=e[L];if(typeof I=="number"){$+=m*I*r/1e3;continue}let C=!1;const N=(I.isSpace?l:0)+o,O=I.fontChar,V=I.accent;let U,j,he=I.width;if(f){const te=I.vmetric||y,oe=-(I.vmetric?te[1]:he*.5)*_,G=te[2]*_;he=te?-te[0]:he,U=oe/a,j=($+G)/a}else U=$/a,j=0;if(i.remeasure&&he>0){const te=s.measureText(O).width*1e3/r*a;if(he<te&&this.isFontSubpixelAAEnabled){const oe=he/te;C=!0,s.save(),s.scale(oe,1),U/=oe}else he!==te&&(U+=(he-te)/2e3*r/a)}if(this.contentVisible&&(I.isInFont||i.missingFile)){if(x&&!V)s.fillText(O,U,j);else if(this.paintChar(O,U,j,v,w),V){const te=U+r*V.offset.x/a,oe=j-r*V.offset.y/a;this.paintChar(V.fontChar,te,oe,v,w)}}const me=f?he*_-N*u:he*_+N*u;$+=me,C&&s.restore()}f?t.y-=$:t.x+=$*c,s.restore(),this.compose()}showType3Text(e){const t=this.ctx,i=this.current,r=i.font,s=i.fontSize,a=i.fontDirection,o=r.vertical?1:-1,l=i.charSpacing,u=i.wordSpacing,c=i.textHScale*a,h=i.fontMatrix||cS,f=e.length,m=i.textRenderingMode===ci.INVISIBLE;let y,_,x,v;if(!(m||s===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...i.textMatrix),t.translate(i.x,i.y),t.scale(c,a),y=0;y<f;++y){if(_=e[y],typeof _=="number"){v=o*_*s/1e3,this.ctx.translate(v,0),i.x+=v*c;continue}const w=(_.isSpace?u:0)+l,E=r.charProcOperatorList[_.operatorListId];if(!E){et(`Type3 character "${_.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=_,this.save(),t.scale(s,s),t.transform(...h),this.executeOperatorList(E),this.restore()),x=Me.applyTransform([_.width,0],h)[0]*s+w,t.translate(x,0),i.x+=x*c}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,i,r,s,a){this.ctx.rect(i,r,s-i,a-r),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){const i=e[1],r=this.baseTransform||qt(this.ctx),s={createCanvasGraphics:a=>new QC(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new OS(e,i,this.ctx,s,r)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,i){this.ctx.strokeStyle=this.current.strokeColor=Me.makeHexColor(e,t,i),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,i){this.ctx.fillStyle=this.current.fillColor=Me.makeHexColor(e,t,i),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let i;return this.cachedPatterns.has(e)?i=this.cachedPatterns.get(e):(i=Eee(this.getObject(e)),this.cachedPatterns.set(e,i)),t&&(i.matrix=t),i}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const i=this._getPattern(e);t.fillStyle=i.getPattern(t,this,ca(t),vi.SHADING);const r=ca(t);if(r){const{width:s,height:a}=t.canvas,[o,l,u,c]=Me.getAxialAlignedBoundingBox([0,0,s,a],r);this.ctx.fillRect(o,l,u-o,c-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){Dt("Should not call beginInlineImage")}beginImageData(){Dt("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=qt(this.ctx),t)){const i=t[2]-t[0],r=t[3]-t[1];this.ctx.rect(t[0],t[1],i,r),this.current.updateRectMinMax(qt(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||sx("TODO: Support non-isolated groups."),e.knockout&&et("Knockout groups not supported.");const i=qt(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let r=Me.getAxialAlignedBoundingBox(e.bbox,qt(t));const s=[0,0,t.canvas.width,t.canvas.height];r=Me.intersect(r,s)||[0,0,0,0];const a=Math.floor(r[0]),o=Math.floor(r[1]),l=Math.max(Math.ceil(r[2])-a,1),u=Math.max(Math.ceil(r[3])-o,1);this.current.startNewPathAndClipBox([0,0,l,u]);let c="groupAt"+this.groupLevel;e.smask&&(c+="_smask_"+this.smaskCounter++%2);const h=this.cachedCanvases.getCanvas(c,l,u),f=h.context;f.translate(-a,-o),f.transform(...i),e.smask?this.smaskStack.push({canvas:h.canvas,context:f,offsetX:a,offsetY:o,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(a,o),t.save()),qm(t,f),this.ctx=f,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const r=qt(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...r);const s=Me.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],r);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(s)}}beginAnnotation(e,t,i,r,s){if(z(this,Zs,LS).call(this),L0(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const a=t[2]-t[0],o=t[3]-t[1];if(s&&this.annotationCanvasMap){i=i.slice(),i[4]-=t[0],i[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=a,t[3]=o;const[l,u]=Me.singularValueDecompose2dScale(qt(this.ctx)),{viewportScale:c}=this,h=Math.ceil(a*this.outputScaleX*c),f=Math.ceil(o*this.outputScaleY*c);this.annotationCanvas=this.canvasFactory.create(h,f);const{canvas:m,context:y}=this.annotationCanvas;this.annotationCanvasMap.set(e,m),this.annotationCanvas.savedCtx=this.ctx,this.ctx=y,this.ctx.save(),this.ctx.setTransform(l,0,0,-u,0,o*u),L0(this.ctx)}else L0(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],a,o),this.ctx.clip(),this.ctx.beginPath()}this.current=new c3(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...i),this.transform(...r)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),z(this,Zs,FS).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;e=this.getObject(e.data,e),e.count=t;const i=this.ctx,r=this.processingType3;if(r&&(r.compiled===void 0&&(r.compiled=Cee(e)),r.compiled)){r.compiled(i);return}const s=this._createMaskCanvas(e),a=s.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(a,s.offsetX,s.offsetY),i.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,i=0,r=0,s,a){if(!this.contentVisible)return;e=this.getObject(e.data,e);const o=this.ctx;o.save();const l=qt(o);o.transform(t,i,r,s,0,0);const u=this._createMaskCanvas(e);o.setTransform(1,0,0,1,u.offsetX-l[4],u.offsetY-l[5]);for(let c=0,h=a.length;c<h;c+=2){const f=Me.transform(l,[t,i,r,s,a[c],a[c+1]]),[m,y]=Me.applyTransform([0,0],f);o.drawImage(u.canvas,m,y)}o.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,i=this.current.fillColor,r=this.current.patternFill;for(const s of e){const{data:a,width:o,height:l,transform:u}=s,c=this.cachedCanvases.getCanvas("maskCanvas",o,l),h=c.context;h.save();const f=this.getObject(a,s);h3(h,f),h.globalCompositeOperation="source-in",h.fillStyle=r?i.getPattern(h,this,ca(t),vi.FILL):i,h.fillRect(0,0,o,l),h.restore(),t.save(),t.transform(...u),t.scale(1,-1),O0(t,c.canvas,0,0,o,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);if(!t){et("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,i,r){if(!this.contentVisible)return;const s=this.getObject(e);if(!s){et("Dependent image isn't ready yet");return}const a=s.width,o=s.height,l=[];for(let u=0,c=r.length;u<c;u+=2)l.push({transform:[t,0,0,i,r[u],r[u+1]],x:0,y:0,w:a,h:o});this.paintInlineImageXObjectGroup(s,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:i,height:r}=e,s=this.cachedCanvases.getCanvas("inlineImage",i,r),a=s.context;return a.filter=this.current.transferMaps,a.drawImage(t,0,0),a.filter="none",s.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,i=e.height,r=this.ctx;if(this.save(),!xi){const{filter:o}=r;o!=="none"&&o!==""&&(r.filter="none")}r.scale(1/t,-1/i);let s;if(e.bitmap)s=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)s=e;else{const l=this.cachedCanvases.getCanvas("inlineImage",t,i).context;d3(l,e),s=this.applyTransferMapsToCanvas(l)}const a=this._scaleImage(s,ca(r));r.imageSmoothingEnabled=f3(qt(r),e.interpolate),O0(r,a.img,0,0,a.paintWidth,a.paintHeight,0,-i,t,i),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const i=this.ctx;let r;if(e.bitmap)r=e.bitmap;else{const s=e.width,a=e.height,l=this.cachedCanvases.getCanvas("inlineImage",s,a).context;d3(l,e),r=this.applyTransferMapsToCanvas(l)}for(const s of t)i.save(),i.transform(...s.transform),i.scale(1,-1),O0(i,r,s.x,s.y,s.w,s.h,0,-1,1,1),i.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){const t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const i=this.ctx;this.pendingClip&&(t||(this.pendingClip===p3?i.clip("evenodd"):i.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),i.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=qt(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),i=Math.hypot(e[0],e[2]),r=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(i,r)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:i,c:r,d:s}=this.ctx.getTransform();let a,o;if(i===0&&r===0){const l=Math.abs(t),u=Math.abs(s);if(l===u)if(e===0)a=o=1/l;else{const c=l*e;a=o=c<1?1/c:1}else if(e===0)a=1/l,o=1/u;else{const c=l*e,h=u*e;a=c<1?1/c:1,o=h<1?1/h:1}}else{const l=Math.abs(t*s-i*r),u=Math.hypot(t,i),c=Math.hypot(r,s);if(e===0)a=c/l,o=u/l;else{const h=e*l;a=c>h?c/h:1,o=u>h?u/h:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(e){const{ctx:t}=this,{lineWidth:i}=this.current,[r,s]=this.getScaleForStroking();if(t.lineWidth=i||1,r===1&&s===1){t.stroke();return}const a=t.getLineDash();if(e&&t.save(),t.scale(r,s),a.length>0){const o=Math.max(r,s);t.setLineDash(a.map(l=>l/o)),t.lineDashOffset/=o}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};Zs=new WeakSet,LS=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},FS=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},zS=function(e,t,i){const r=new Path2D;return r.addPath(e,new DOMMatrix(i).invertSelf().multiplySelf(t)),r};let vf=QC;for(const n in As)vf.prototype[n]!==void 0&&(vf.prototype[As[n]]=vf.prototype[n]);var Jy,Zy;class Oo{static get workerPort(){return d(this,Jy)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");P(this,Jy,e)}static get workerSrc(){return d(this,Zy)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");P(this,Zy,e)}}Jy=new WeakMap,Zy=new WeakMap,F(Oo,Jy,null),F(Oo,Zy,"");var Jc,e_;class Pee{constructor({parsedData:e,rawData:t}){F(this,Jc);F(this,e_);P(this,Jc,e),P(this,e_,t)}getRaw(){return d(this,e_)}get(e){return d(this,Jc).get(e)??null}getAll(){return FC(d(this,Jc))}has(e){return d(this,Jc).has(e)}}Jc=new WeakMap,e_=new WeakMap;const Lh=Symbol("INTERNAL");var t_,n_,i_,Ff;class Nee{constructor(e,{name:t,intent:i,usage:r,rbGroups:s}){F(this,t_,!1);F(this,n_,!1);F(this,i_,!1);F(this,Ff,!0);P(this,t_,!!(e&Tr.DISPLAY)),P(this,n_,!!(e&Tr.PRINT)),this.name=t,this.intent=i,this.usage=r,this.rbGroups=s}get visible(){if(d(this,i_))return d(this,Ff);if(!d(this,Ff))return!1;const{print:e,view:t}=this.usage;return d(this,t_)?(t==null?void 0:t.viewState)!=="OFF":d(this,n_)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,i=!1){e!==Lh&&Dt("Internal method `_setVisible` called."),P(this,i_,i),P(this,Ff,t)}}t_=new WeakMap,n_=new WeakMap,i_=new WeakMap,Ff=new WeakMap;var Ul,St,zf,Vf,r_,VS;class Dee{constructor(e,t=Tr.DISPLAY){F(this,r_);F(this,Ul,null);F(this,St,new Map);F(this,zf,null);F(this,Vf,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,P(this,Vf,e.order);for(const i of e.groups)d(this,St).set(i.id,new Nee(t,i));if(e.baseState==="OFF")for(const i of d(this,St).values())i._setVisible(Lh,!1);for(const i of e.on)d(this,St).get(i)._setVisible(Lh,!0);for(const i of e.off)d(this,St).get(i)._setVisible(Lh,!1);P(this,zf,this.getHash())}}isVisible(e){if(d(this,St).size===0)return!0;if(!e)return sx("Optional content group not defined."),!0;if(e.type==="OCG")return d(this,St).has(e.id)?d(this,St).get(e.id).visible:(et(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return z(this,r_,VS).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!d(this,St).has(t))return et(`Optional content group not found: ${t}`),!0;if(d(this,St).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!d(this,St).has(t))return et(`Optional content group not found: ${t}`),!0;if(!d(this,St).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!d(this,St).has(t))return et(`Optional content group not found: ${t}`),!0;if(!d(this,St).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!d(this,St).has(t))return et(`Optional content group not found: ${t}`),!0;if(d(this,St).get(t).visible)return!1}return!0}return et(`Unknown optional content policy ${e.policy}.`),!0}return et(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,i=!0){var s;const r=d(this,St).get(e);if(!r){et(`Optional content group not found: ${e}`);return}if(i&&t&&r.rbGroups.length)for(const a of r.rbGroups)for(const o of a)o!==e&&((s=d(this,St).get(o))==null||s._setVisible(Lh,!1,!0));r._setVisible(Lh,!!t,!0),P(this,Ul,null)}setOCGState({state:e,preserveRB:t}){let i;for(const r of e){switch(r){case"ON":case"OFF":case"Toggle":i=r;continue}const s=d(this,St).get(r);if(s)switch(i){case"ON":this.setVisibility(r,!0,t);break;case"OFF":this.setVisibility(r,!1,t);break;case"Toggle":this.setVisibility(r,!s.visible,t);break}}P(this,Ul,null)}get hasInitialVisibility(){return d(this,zf)===null||this.getHash()===d(this,zf)}getOrder(){return d(this,St).size?d(this,Vf)?d(this,Vf).slice():[...d(this,St).keys()]:null}getGroups(){return d(this,St).size>0?FC(d(this,St)):null}getGroup(e){return d(this,St).get(e)||null}getHash(){if(d(this,Ul)!==null)return d(this,Ul);const e=new KU;for(const[t,i]of d(this,St))e.update(`${t}:${i.visible}`);return P(this,Ul,e.hexdigest())}}Ul=new WeakMap,St=new WeakMap,zf=new WeakMap,Vf=new WeakMap,r_=new WeakSet,VS=function(e){const t=e.length;if(t<2)return!0;const i=e[0];for(let r=1;r<t;r++){const s=e[r];let a;if(Array.isArray(s))a=z(this,r_,VS).call(this,s);else if(d(this,St).has(s))a=d(this,St).get(s).visible;else return et(`Optional content group not found: ${s}`),!0;switch(i){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return i==="And"};class Mee{constructor(e,{disableRange:t=!1,disableStream:i=!1}){bn(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:r,initialData:s,progressiveDone:a,contentDispositionFilename:o}=e;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,(s==null?void 0:s.length)>0){const l=s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength?s.buffer:new Uint8Array(s).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!i,this._isRangeSupported=!t,this._contentLength=r,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,u)=>{this._onReceiveData({begin:l,chunk:u})}),e.addProgressListener((l,u)=>{this._onProgress({loaded:l,total:u})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const i=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{const r=this._rangeReaders.some(function(s){return s._begin!==e?!1:(s._enqueue(i),!0)});bn(r,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,i,r,s;e.total===void 0?(i=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||i.call(t,{loaded:e.loaded}):(s=(r=this._fullRequestReader)==null?void 0:r.onProgress)==null||s.call(r,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){bn(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new Oee(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new Lee(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(i),i}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const i of this._rangeReaders.slice(0))i.cancel(e);this._pdfDataRangeTransport.abort()}}class Oee{constructor(e,t,i=!1,r=null){this._stream=e,this._done=i||!1,this._filename=jC(r)?r:null,this._queuedChunks=t||[],this._loaded=0;for(const s of this._queuedChunks)this._loaded+=s.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class Lee{constructor(e,t,i){this._stream=e,this._begin=t,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Fee(n){let e=!0,t=i("filename\\*","i").exec(n);if(t){t=t[1];let c=o(t);return c=unescape(c),c=l(c),c=u(c),s(c)}if(t=a(n),t){const c=u(t);return s(c)}if(t=i("filename","i").exec(n),t){t=t[1];let c=o(t);return c=u(c),s(c)}function i(c,h){return new RegExp("(?:^|;)\\s*"+c+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',h)}function r(c,h){if(c){if(!/^[\x00-\xFF]+$/.test(h))return h;try{const f=new TextDecoder(c,{fatal:!0}),m=ax(h);h=f.decode(m),e=!1}catch{}}return h}function s(c){return e&&/[\x80-\xff]/.test(c)&&(c=r("utf-8",c),e&&(c=r("iso-8859-1",c))),c}function a(c){const h=[];let f;const m=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=m.exec(c))!==null;){let[,_,x,v]=f;if(_=parseInt(_,10),_ in h){if(_===0)break;continue}h[_]=[x,v]}const y=[];for(let _=0;_<h.length&&_ in h;++_){let[x,v]=h[_];v=o(v),x&&(v=unescape(v),_===0&&(v=l(v))),y.push(v)}return y.join("")}function o(c){if(c.startsWith('"')){const h=c.slice(1).split('\\"');for(let f=0;f<h.length;++f){const m=h[f].indexOf('"');m!==-1&&(h[f]=h[f].slice(0,m),h.length=f+1),h[f]=h[f].replaceAll(/\\(.)/g,"$1")}c=h.join('"')}return c}function l(c){const h=c.indexOf("'");if(h===-1)return c;const f=c.slice(0,h),y=c.slice(h+1).replace(/^[^']*'/,"");return r(f,y)}function u(c){return!c.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(c)?c:c.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(h,f,m,y){if(m==="q"||m==="Q")return y=y.replaceAll("_"," "),y=y.replaceAll(/=([0-9a-fA-F]{2})/g,function(_,x){return String.fromCharCode(parseInt(x,16))}),r(f,y);try{y=atob(y)}catch{}return r(f,y)})}return""}function l5(n,e){const t=new Headers;if(!n||!e||typeof e!="object")return t;for(const i in e){const r=e[i];r!==void 0&&t.append(i,r)}return t}function ux(n){try{return new URL(n).origin}catch{}return null}function u5({responseHeaders:n,isHttp:e,rangeChunkSize:t,disableRange:i}){const r={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(n.get("Content-Length"),10);return!Number.isInteger(s)||(r.suggestedLength=s,s<=2*t)||i||!e||n.get("Accept-Ranges")!=="bytes"||(n.get("Content-Encoding")||"identity")!=="identity"||(r.allowRangeRequests=!0),r}function c5(n){const e=n.get("Content-Disposition");if(e){let t=Fee(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(jC(t))return t}return null}function cx(n,e){return n===404||n===0&&e.startsWith("file:")?new by('Missing PDF "'+e+'".'):new zb(`Unexpected server response (${n}) while retrieving PDF "${e}".`,n)}function d5(n){return n===200||n===206}function h5(n,e,t){return{method:"GET",headers:n,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function f5(n){return n instanceof Uint8Array?n.buffer:n instanceof ArrayBuffer?n:(et(`getArrayBuffer - unexpected data format: ${n}`),new Uint8Array(n).buffer)}class m3{constructor(e){ze(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=l5(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return bn(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new zee(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new Vee(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const i of this._rangeRequestReaders.slice(0))i.cancel(e)}}class zee{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const i=new Headers(e.headers),r=t.url;fetch(r,h5(i,this._withCredentials,this._abortController)).then(s=>{if(e._responseOrigin=ux(s.url),!d5(s.status))throw cx(s.status,r);this._reader=s.body.getReader(),this._headersCapability.resolve();const a=s.headers,{allowRangeRequests:o,suggestedLength:l}=u5({responseHeaders:a,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=l||this._contentLength,this._filename=c5(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Nu("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded,total:this._contentLength}),{value:f5(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class Vee{constructor(e,t,i){this._stream=e,this._reader=null,this._loaded=0;const r=e.source;this._withCredentials=r.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!r.disableStream,this._abortController=new AbortController;const s=new Headers(e.headers);s.append("Range",`bytes=${t}-${i-1}`);const a=r.url;fetch(a,h5(s,this._withCredentials,this._abortController)).then(o=>{const l=ux(o.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!d5(o.status))throw cx(o.status,a);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded}),{value:f5(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const vA=200,wA=206;function jee(n){const e=n.response;return typeof e!="string"?e:ax(e).buffer}class Bee{constructor({url:e,httpHeaders:t,withCredentials:i}){ze(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=l5(this.isHttp,t),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,i=this.currXhrId++,r=this.pendingRequests[i]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[s,a]of this.headers)t.setRequestHeader(s,a);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),r.expectedStatus=wA):r.expectedStatus=vA,t.responseType="arraybuffer",bn(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,i),t.onprogress=this.onProgress.bind(this,i),r.onHeadersReceived=e.onHeadersReceived,r.onDone=e.onDone,r.onError=e.onError,r.onProgress=e.onProgress,t.send(null),i}onProgress(e,t){var r;const i=this.pendingRequests[e];i&&((r=i.onProgress)==null||r.call(i,t))}onStateChange(e,t){const i=this.pendingRequests[e];if(!i)return;const r=i.xhr;if(r.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),r.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],r.status===0&&this.isHttp){i.onError(r.status);return}const s=r.status||vA;if(!(s===vA&&i.expectedStatus===wA)&&s!==i.expectedStatus){i.onError(r.status);return}const o=jee(r);if(s===wA){const l=r.getResponseHeader("Content-Range"),u=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);u?i.onDone({begin:parseInt(u[1],10),chunk:o}):(et('Missing or invalid "Content-Range" header.'),i.onError(0))}else o?i.onDone({begin:0,chunk:o}):i.onError(r.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class Uee{constructor(e){this._source=e,this._manager=new Bee(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return bn(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Hee(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const i=new Wee(this._manager,e,t);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const i of this._rangeRequestReaders.slice(0))i.cancel(e)}}class Hee{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=ux(t.responseURL);const i=t.getAllResponseHeaders(),r=new Headers(i?i.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{const[l,...u]=o.split(": ");return[l,u.join(": ")]}):[]),{allowRangeRequests:s,suggestedLength:a}=u5({responseHeaders:r,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});s&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=c5(r),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=cx(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Wee{constructor(e,t,i){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:i,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=ux((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=cx(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const qee=/^[a-z][a-z0-9\-+.]+:/i;function Gee(n){if(qee.test(n))return new URL(n);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(n))}class Kee{constructor(e){this.source=e,this.url=Gee(e.url),bn(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return bn(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Yee(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new Xee(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const i of this._rangeRequestReaders.slice(0))i.cancel(e)}}class Yee{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const i=process.getBuiltinModule("fs");i.promises.lstat(this._url).then(r=>{this._contentLength=r.size,this._setReadableStream(i.createReadStream(this._url)),this._headersCapability.resolve()},r=>{r.code==="ENOENT"&&(r=new by(`Missing PDF "${this._url}".`)),this._storedError=r,this._headersCapability.reject(r)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Nu("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Xee{constructor(e,t,i){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const r=e.source;this._isStreamingSupported=!r.disableStream;const s=process.getBuiltinModule("fs");this._setReadableStream(s.createReadStream(this._url,{start:t,end:i-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Qee=1e5,Gi=30,Jee=.8;var E3,Hl,Qi,s_,a_,Zc,vo,o_,l_,ed,jf,Bf,Wl,Uf,u_,Hf,td,c_,d_,nd,id,h_,ql,Wf,il,p5,m5,jS,Or,bw,BS,g5,y5;const Tn=class Tn{constructor({textContentSource:e,container:t,viewport:i}){F(this,il);F(this,Hl,Promise.withResolvers());F(this,Qi,null);F(this,s_,!1);F(this,a_,!!((E3=globalThis.FontInspector)!=null&&E3.enabled));F(this,Zc,null);F(this,vo,null);F(this,o_,0);F(this,l_,0);F(this,ed,null);F(this,jf,null);F(this,Bf,0);F(this,Wl,0);F(this,Uf,Object.create(null));F(this,u_,[]);F(this,Hf,null);F(this,td,[]);F(this,c_,new WeakMap);F(this,d_,null);var l;if(e instanceof ReadableStream)P(this,Hf,e);else if(typeof e=="object")P(this,Hf,new ReadableStream({start(u){u.enqueue(e),u.close()}}));else throw new Error('No "textContentSource" parameter specified.');P(this,Qi,P(this,jf,t)),P(this,Wl,i.scale*(globalThis.devicePixelRatio||1)),P(this,Bf,i.rotation),P(this,vo,{div:null,properties:null,ctx:null});const{pageWidth:r,pageHeight:s,pageX:a,pageY:o}=i.rawDims;P(this,d_,[1,0,0,-1,-a,o+s]),P(this,l_,r),P(this,o_,s),z(l=Tn,Or,g5).call(l),Zd(t,i),d(this,Hl).promise.finally(()=>{d(Tn,Wf).delete(this),P(this,vo,null),P(this,Uf,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=Oi.platform;return st(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{d(this,ed).read().then(({value:t,done:i})=>{if(i){d(this,Hl).resolve();return}d(this,Zc)??P(this,Zc,t.lang),Object.assign(d(this,Uf),t.styles),z(this,il,p5).call(this,t.items),e()},d(this,Hl).reject)};return P(this,ed,d(this,Hf).getReader()),d(Tn,Wf).add(this),e(),d(this,Hl).promise}update({viewport:e,onBefore:t=null}){var s;const i=e.scale*(globalThis.devicePixelRatio||1),r=e.rotation;if(r!==d(this,Bf)&&(t==null||t(),P(this,Bf,r),Zd(d(this,jf),{rotation:r})),i!==d(this,Wl)){t==null||t(),P(this,Wl,i);const a={div:null,properties:null,ctx:z(s=Tn,Or,bw).call(s,d(this,Zc))};for(const o of d(this,td))a.properties=d(this,c_).get(o),a.div=o,z(this,il,jS).call(this,a)}}cancel(){var t;const e=new Nu("TextLayer task cancelled.");(t=d(this,ed))==null||t.cancel(e).catch(()=>{}),P(this,ed,null),d(this,Hl).reject(e)}get textDivs(){return d(this,td)}get textContentItemsStr(){return d(this,u_)}static cleanup(){if(!(d(this,Wf).size>0)){d(this,nd).clear();for(const{canvas:e}of d(this,id).values())e.remove();d(this,id).clear()}}};Hl=new WeakMap,Qi=new WeakMap,s_=new WeakMap,a_=new WeakMap,Zc=new WeakMap,vo=new WeakMap,o_=new WeakMap,l_=new WeakMap,ed=new WeakMap,jf=new WeakMap,Bf=new WeakMap,Wl=new WeakMap,Uf=new WeakMap,u_=new WeakMap,Hf=new WeakMap,td=new WeakMap,c_=new WeakMap,d_=new WeakMap,nd=new WeakMap,id=new WeakMap,h_=new WeakMap,ql=new WeakMap,Wf=new WeakMap,il=new WeakSet,p5=function(e){var r,s;if(d(this,s_))return;(s=d(this,vo)).ctx??(s.ctx=z(r=Tn,Or,bw).call(r,d(this,Zc)));const t=d(this,td),i=d(this,u_);for(const a of e){if(t.length>Qee){et("Ignoring additional textDivs for performance reasons."),P(this,s_,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){const o=d(this,Qi);P(this,Qi,document.createElement("span")),d(this,Qi).classList.add("markedContent"),a.id!==null&&d(this,Qi).setAttribute("id",`${a.id}`),o.append(d(this,Qi))}else a.type==="endMarkedContent"&&P(this,Qi,d(this,Qi).parentNode);continue}i.push(a.str),z(this,il,m5).call(this,a)}},m5=function(e){var _;const t=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};d(this,td).push(t);const r=Me.transform(d(this,d_),e.transform);let s=Math.atan2(r[1],r[0]);const a=d(this,Uf)[e.fontName];a.vertical&&(s+=Math.PI/2);let o=d(this,a_)&&a.fontSubstitution||a.fontFamily;o=Tn.fontFamilyMap.get(o)||o;const l=Math.hypot(r[2],r[3]),u=l*z(_=Tn,Or,y5).call(_,o,d(this,Zc));let c,h;s===0?(c=r[4],h=r[5]-u):(c=r[4]+u*Math.sin(s),h=r[5]-u*Math.cos(s));const f="calc(var(--scale-factor)*",m=t.style;d(this,Qi)===d(this,jf)?(m.left=`${(100*c/d(this,l_)).toFixed(2)}%`,m.top=`${(100*h/d(this,o_)).toFixed(2)}%`):(m.left=`${f}${c.toFixed(2)}px)`,m.top=`${f}${h.toFixed(2)}px)`),m.fontSize=`${f}${(d(Tn,ql)*l).toFixed(2)}px)`,m.fontFamily=o,i.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,d(this,a_)&&(t.dataset.fontName=a.fontSubstitutionLoadedName||e.fontName),s!==0&&(i.angle=s*(180/Math.PI));let y=!1;if(e.str.length>1)y=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const x=Math.abs(e.transform[0]),v=Math.abs(e.transform[3]);x!==v&&Math.max(x,v)/Math.min(x,v)>1.5&&(y=!0)}if(y&&(i.canvasWidth=a.vertical?e.height:e.width),d(this,c_).set(t,i),d(this,vo).div=t,d(this,vo).properties=i,z(this,il,jS).call(this,d(this,vo)),i.hasText&&d(this,Qi).append(t),i.hasEOL){const x=document.createElement("br");x.setAttribute("role","presentation"),d(this,Qi).append(x)}},jS=function(e){var o;const{div:t,properties:i,ctx:r}=e,{style:s}=t;let a="";if(d(Tn,ql)>1&&(a=`scale(${1/d(Tn,ql)})`),i.canvasWidth!==0&&i.hasText){const{fontFamily:l}=s,{canvasWidth:u,fontSize:c}=i;z(o=Tn,Or,BS).call(o,r,c*d(this,Wl),l);const{width:h}=r.measureText(t.textContent);h>0&&(a=`scaleX(${u*d(this,Wl)/h}) ${a}`)}i.angle!==0&&(a=`rotate(${i.angle}deg) ${a}`),a.length>0&&(s.transform=a)},Or=new WeakSet,bw=function(e=null){let t=d(this,id).get(e||(e=""));if(!t){const i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=e,document.body.append(i),t=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),d(this,id).set(e,t),d(this,h_).set(t,{size:0,family:""})}return t},BS=function(e,t,i){const r=d(this,h_).get(e);t===r.size&&i===r.family||(e.font=`${t}px ${i}`,r.size=t,r.family=i)},g5=function(){if(d(this,ql)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),P(this,ql,e.getBoundingClientRect().height),e.remove()},y5=function(e,t){const i=d(this,nd).get(e);if(i)return i;const r=z(this,Or,bw).call(this,t);r.canvas.width=r.canvas.height=Gi,z(this,Or,BS).call(this,r,Gi,e);const s=r.measureText("");let a=s.fontBoundingBoxAscent,o=Math.abs(s.fontBoundingBoxDescent);if(a){const c=a/(a+o);return d(this,nd).set(e,c),r.canvas.width=r.canvas.height=0,c}r.strokeStyle="red",r.clearRect(0,0,Gi,Gi),r.strokeText("g",0,0);let l=r.getImageData(0,0,Gi,Gi).data;o=0;for(let c=l.length-1-3;c>=0;c-=4)if(l[c]>0){o=Math.ceil(c/4/Gi);break}r.clearRect(0,0,Gi,Gi),r.strokeText("A",0,Gi),l=r.getImageData(0,0,Gi,Gi).data,a=0;for(let c=0,h=l.length;c<h;c+=4)if(l[c]>0){a=Gi-Math.floor(c/4/Gi);break}r.canvas.width=r.canvas.height=0;const u=a?a/(a+o):Jee;return d(this,nd).set(e,u),u},F(Tn,Or),F(Tn,nd,new Map),F(Tn,id,new Map),F(Tn,h_,new WeakMap),F(Tn,ql,null),F(Tn,Wf,new Set);let xy=Tn;class Ey{static textContent(e){const t=[],i={items:t,styles:Object.create(null)};function r(s){var l;if(!s)return;let a=null;const o=s.name;if(o==="#text")a=s.value;else if(Ey.shouldBuildText(o))(l=s==null?void 0:s.attributes)!=null&&l.textContent?a=s.attributes.textContent:s.value&&(a=s.value);else return;if(a!==null&&t.push({str:a}),!!s.children)for(const u of s.children)r(u)}return r(e),i}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}const Zee=65536,ete=100,tte=5e3,nte=xi?gee:fee,ite=xi?yee:n5,rte=xi?mee:pee,ste=xi?_ee:a5;function ate(n={}){typeof n=="string"||n instanceof URL?n={url:n}:(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n={data:n});const e=new US,{docId:t}=e,i=n.url?ote(n.url):null,r=n.data?lte(n.data):null,s=n.httpHeaders||null,a=n.withCredentials===!0,o=n.password??null,l=n.range instanceof _5?n.range:null,u=Number.isInteger(n.rangeChunkSize)&&n.rangeChunkSize>0?n.rangeChunkSize:Zee;let c=n.worker instanceof wf?n.worker:null;const h=n.verbosity,f=typeof n.docBaseUrl=="string"&&!lx(n.docBaseUrl)?n.docBaseUrl:null,m=typeof n.cMapUrl=="string"?n.cMapUrl:null,y=n.cMapPacked!==!1,_=n.CMapReaderFactory||ite,x=typeof n.standardFontDataUrl=="string"?n.standardFontDataUrl:null,v=n.StandardFontDataFactory||ste,w=n.stopAtErrors!==!0,E=Number.isInteger(n.maxImageSize)&&n.maxImageSize>-1?n.maxImageSize:-1,k=n.isEvalSupported!==!1,$=typeof n.isOffscreenCanvasSupported=="boolean"?n.isOffscreenCanvasSupported:!xi,L=typeof n.isImageDecoderSupported=="boolean"?n.isImageDecoderSupported:!xi&&(Oi.platform.isFirefox||!globalThis.chrome),I=Number.isInteger(n.canvasMaxAreaInBytes)?n.canvasMaxAreaInBytes:-1,C=typeof n.disableFontFace=="boolean"?n.disableFontFace:xi,N=n.fontExtraProperties===!0,O=n.enableXfa===!0,V=n.ownerDocument||globalThis.document,U=n.disableRange===!0,j=n.disableStream===!0,he=n.disableAutoFetch===!0,me=n.pdfBug===!0,te=n.CanvasFactory||nte,oe=n.FilterFactory||rte,G=n.enableHWA===!0,W=l?l.length:n.length??NaN,K=typeof n.useSystemFonts=="boolean"?n.useSystemFonts:!xi&&!C,H=typeof n.useWorkerFetch=="boolean"?n.useWorkerFetch:_===n5&&v===a5&&m&&x&&cg(m,document.baseURI)&&cg(x,document.baseURI),Q=null;WZ(h);const Y={canvasFactory:new te({ownerDocument:V,enableHWA:G}),filterFactory:new oe({docId:t,ownerDocument:V}),cMapReaderFactory:H?null:new _({baseUrl:m,isCompressed:y}),standardFontDataFactory:H?null:new v({baseUrl:x})};if(!c){const _e={verbosity:h,port:Oo.workerPort};c=_e.port?wf.fromPort(_e):new wf(_e),e._worker=c}const Z={docId:t,apiVersion:"4.10.38",data:r,password:o,disableAutoFetch:he,rangeChunkSize:u,length:W,docBaseUrl:f,enableXfa:O,evaluatorOptions:{maxImageSize:E,disableFontFace:C,ignoreErrors:w,isEvalSupported:k,isOffscreenCanvasSupported:$,isImageDecoderSupported:L,canvasMaxAreaInBytes:I,fontExtraProperties:N,useSystemFonts:K,cMapUrl:H?m:null,standardFontDataUrl:H?x:null}},fe={disableFontFace:C,fontExtraProperties:N,ownerDocument:V,pdfBug:me,styleElement:Q,loadingParams:{disableAutoFetch:he,enableXfa:O}};return c.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const _e=c.messageHandler.sendWithPromise("GetDocRequest",Z,r?[r.buffer]:null);let X;if(l)X=new Mee(l,{disableRange:U,disableStream:j});else if(!r){if(!i)throw new Error("getDocument - no `url` parameter provided.");let de;if(xi)if(cg(i)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");de=m3}else de=Kee;else de=cg(i)?m3:Uee;X=new de({url:i,length:W,httpHeaders:s,withCredentials:a,rangeChunkSize:u,disableRange:U,disableStream:j})}return _e.then(de=>{if(e.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const Ee=new pg(t,de,c.port),$e=new hte(Ee,e,X,fe,Y);e._transport=$e,Ee.send("Ready",null)})}).catch(e._capability.reject),e}function ote(n){if(n instanceof URL)return n.href;try{return new URL(n,window.location).href}catch{if(xi&&typeof n=="string")return n}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function lte(n){if(xi&&typeof Buffer<"u"&&n instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength)return n;if(typeof n=="string")return ax(n);if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)||typeof n=="object"&&!isNaN(n==null?void 0:n.length))return new Uint8Array(n);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function g3(n){return typeof n=="object"&&Number.isInteger(n==null?void 0:n.num)&&n.num>=0&&Number.isInteger(n==null?void 0:n.gen)&&n.gen>=0}var n1;const i1=class i1{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${Ii(i1,n1)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var e,t,i,r;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(s){throw(i=this._worker)!=null&&i.port&&delete this._worker._pendingDestroy,s}this._transport=null,(r=this._worker)==null||r.destroy(),this._worker=null}};n1=new WeakMap,F(i1,n1,0);let US=i1;class _5{constructor(e,t,i=!1,r=null){this.length=e,this.initialData=t,this.progressiveDone=i,this.contentDispositionFilename=r,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const i of this._rangeListeners)i(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(const i of this._progressListeners)i(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(const t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){Dt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class ute{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return st(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var Gl,wo,Zr,Fh,xw;class cte{constructor(e,t,i,r=!1){F(this,Zr);F(this,Gl,null);F(this,wo,!1);this._pageIndex=e,this._pageInfo=t,this._transport=i,this._stats=r?new n3:null,this._pdfBug=r,this.commonObjs=i.commonObjs,this.objs=new v5,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:i=0,offsetY:r=0,dontFlip:s=!1}={}){return new fv({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:i,offsetY:r,dontFlip:s})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return st(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,viewport:t,intent:i="display",annotationMode:r=$l.ENABLE,transform:s=null,background:a=null,optionalContentConfigPromise:o=null,annotationCanvasMap:l=null,pageColors:u=null,printAnnotationStorage:c=null,isEditing:h=!1}){var k,$;(k=this._stats)==null||k.time("Overall");const f=this._transport.getRenderingIntent(i,r,c,h),{renderingIntent:m,cacheKey:y}=f;P(this,wo,!1),z(this,Zr,xw).call(this),o||(o=this._transport.getOptionalContentConfig(m));let _=this._intentStates.get(y);_||(_=Object.create(null),this._intentStates.set(y,_)),_.streamReaderCancelTimeout&&(clearTimeout(_.streamReaderCancelTimeout),_.streamReaderCancelTimeout=null);const x=!!(m&Tr.PRINT);_.displayReadyCapability||(_.displayReadyCapability=Promise.withResolvers(),_.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},($=this._stats)==null||$.time("Page Request"),this._pumpOperatorList(f));const v=L=>{var I;_.renderTasks.delete(w),(this._maybeCleanupAfterRender||x)&&P(this,wo,!0),z(this,Zr,Fh).call(this,!x),L?(w.capability.reject(L),this._abortOperatorList({intentState:_,reason:L instanceof Error?L:new Error(L)})):w.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(I=globalThis.Stats)!=null&&I.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},w=new WS({callback:v,params:{canvasContext:e,viewport:t,transform:s,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:_.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!x,pdfBug:this._pdfBug,pageColors:u});(_.renderTasks||(_.renderTasks=new Set)).add(w);const E=w.task;return Promise.all([_.displayReadyCapability.promise,o]).then(([L,I])=>{var C;if(this.destroyed){v();return}if((C=this._stats)==null||C.time("Rendering"),!(I.renderingIntent&m))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");w.initializeGraphics({transparency:L,optionalContentConfig:I}),w.operatorListChanged()}).catch(v),E}getOperatorList({intent:e="display",annotationMode:t=$l.ENABLE,printAnnotationStorage:i=null,isEditing:r=!1}={}){var u;function s(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(l))}const a=this._transport.getRenderingIntent(e,t,i,r,!0);let o=this._intentStates.get(a.cacheKey);o||(o=Object.create(null),this._intentStates.set(a.cacheKey,o));let l;return o.opListReadCapability||(l=Object.create(null),l.operatorListChanged=s,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||(o.renderTasks=new Set)).add(l),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(u=this._stats)==null||u.time("Page Request"),this._pumpOperatorList(a)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(r){return r.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>Ey.textContent(i));const t=this.streamTextContent(e);return new Promise(function(i,r){function s(){a.read().then(function({value:l,done:u}){if(u){i(o);return}o.lang??(o.lang=l.lang),Object.assign(o.styles,l.styles),o.items.push(...l.items),s()},r)}const a=t.getReader(),o={items:[],styles:Object.create(null),lang:null};s()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const i of t.renderTasks)e.push(i.completed),i.cancel();return this.objs.clear(),P(this,wo,!1),z(this,Zr,xw).call(this),Promise.all(e)}cleanup(e=!1){P(this,wo,!0);const t=z(this,Zr,Fh).call(this,!1);return e&&t&&this._stats&&(this._stats=new n3),t}_startRenderPage(e,t){var r,s;const i=this._intentStates.get(t);i&&((r=this._stats)==null||r.timeEnd("Page Request"),(s=i.displayReadyCapability)==null||s.resolve(e))}_renderPageChunk(e,t){for(let i=0,r=e.length;i<r;i++)t.operatorList.fnArray.push(e.fnArray[i]),t.operatorList.argsArray.push(e.argsArray[i]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const i of t.renderTasks)i.operatorListChanged();e.lastChunk&&z(this,Zr,Fh).call(this,!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:i,modifiedIds:r}){const{map:s,transfer:a}=i,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:s,modifiedIds:r},a).getReader(),u=this._intentStates.get(t);u.streamReader=l;const c=()=>{l.read().then(({value:h,done:f})=>{if(f){u.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(h,u),c())},h=>{if(u.streamReader=null,!this._transport.destroyed){if(u.operatorList){u.operatorList.lastChunk=!0;for(const f of u.renderTasks)f.operatorListChanged();z(this,Zr,Fh).call(this,!0)}if(u.displayReadyCapability)u.displayReadyCapability.reject(h);else if(u.opListReadCapability)u.opListReadCapability.reject(h);else throw h}})};c()}_abortOperatorList({intentState:e,reason:t,force:i=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!i){if(e.renderTasks.size>0)return;if(t instanceof VC){let r=ete;t.extraDelay>0&&t.extraDelay<1e3&&(r+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},r);return}}if(e.streamReader.cancel(new Nu(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[r,s]of this._intentStates)if(s===e){this._intentStates.delete(r);break}this.cleanup()}}}get stats(){return this._stats}}Gl=new WeakMap,wo=new WeakMap,Zr=new WeakSet,Fh=function(e=!1){if(z(this,Zr,xw).call(this),!d(this,wo)||this.destroyed)return!1;if(e)return P(this,Gl,setTimeout(()=>{P(this,Gl,null),z(this,Zr,Fh).call(this,!1)},tte)),!1;for(const{renderTasks:t,operatorList:i}of this._intentStates.values())if(t.size>0||!i.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),P(this,wo,!1),!0},xw=function(){d(this,Gl)&&(clearTimeout(d(this,Gl)),P(this,Gl,null))};var bo,r1;class dte{constructor(){F(this,bo,new Map);F(this,r1,Promise.resolve())}postMessage(e,t){const i={data:structuredClone(e,t?{transfer:t}:null)};d(this,r1).then(()=>{for(const[r]of d(this,bo))r.call(this,i)})}addEventListener(e,t,i=null){let r=null;if((i==null?void 0:i.signal)instanceof AbortSignal){const{signal:s}=i;if(s.aborted){et("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(e,t);r=()=>s.removeEventListener("abort",a),s.addEventListener("abort",a)}d(this,bo).set(t,r)}removeEventListener(e,t){const i=d(this,bo).get(t);i==null||i(),d(this,bo).delete(t)}terminate(){for(const[,e]of d(this,bo))e==null||e();d(this,bo).clear()}}bo=new WeakMap,r1=new WeakMap;var s1,rd,sd,qf,Ew,Gf,Aw;const Wt=class Wt{constructor({name:e=null,port:t=null,verbosity:i=qZ()}={}){F(this,qf);var r;if(this.name=e,this.destroyed=!1,this.verbosity=i,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if((r=d(Wt,sd))!=null&&r.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(d(Wt,sd)||P(Wt,sd,new WeakMap)).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new pg("main","worker",e),this._messageHandler.on("ready",function(){}),z(this,qf,Ew).call(this)}_initialize(){if(d(Wt,rd)||d(Wt,Gf,Aw)){this._setupFakeWorker();return}let{workerSrc:e}=Wt;try{Wt._isSameOrigin(window.location.href,e)||(e=Wt._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),i=new pg("main","worker",t),r=()=>{s.abort(),i.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},s=new AbortController;t.addEventListener("error",()=>{this._webWorker||r()},{signal:s.signal}),i.on("test",o=>{if(s.abort(),this.destroyed||!o){r();return}this._messageHandler=i,this._port=t,this._webWorker=t,z(this,qf,Ew).call(this)}),i.on("ready",o=>{if(s.abort(),this.destroyed){r();return}try{a()}catch{this._setupFakeWorker()}});const a=()=>{const o=new Uint8Array;i.send("test",o,[o.buffer])};a();return}catch{sx("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){d(Wt,rd)||(et("Setting up fake worker."),P(Wt,rd,!0)),Wt._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const t=new dte;this._port=t;const i=`fake${Ii(Wt,s1)._++}`,r=new pg(i+"_worker",i,t);e.setup(r,t),this._messageHandler=new pg(i,i+"_worker",t),z(this,qf,Ew).call(this)}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){var e,t,i;this.destroyed=!0,(e=this._webWorker)==null||e.terminate(),this._webWorker=null,(t=d(Wt,sd))==null||t.delete(this._port),this._port=null,(i=this._messageHandler)==null||i.destroy(),this._messageHandler=null}static fromPort(e){var i;if(!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const t=(i=d(this,sd))==null?void 0:i.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new Wt(e)}static get workerSrc(){if(Oo.workerSrc)return Oo.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return st(this,"_setupFakeWorkerGlobal",(async()=>d(this,Gf,Aw)?d(this,Gf,Aw):(await import(this.workerSrc)).WorkerMessageHandler)())}};s1=new WeakMap,rd=new WeakMap,sd=new WeakMap,qf=new WeakSet,Ew=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},Gf=new WeakSet,Aw=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},F(Wt,Gf),F(Wt,s1,0),F(Wt,rd,!1),F(Wt,sd),xi&&(P(Wt,rd,!0),Oo.workerSrc||(Oo.workerSrc="./pdf.worker.mjs")),Wt._isSameOrigin=(e,t)=>{let i;try{if(i=new URL(e),!i.origin||i.origin==="null")return!1}catch{return!1}const r=new URL(t,i);return i.origin===r.origin},Wt._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};let wf=Wt;var xo,Aa,Kf,Yf,Eo,ad,vg;class hte{constructor(e,t,i,r,s){F(this,ad);F(this,xo,new Map);F(this,Aa,new Map);F(this,Kf,new Map);F(this,Yf,new Map);F(this,Eo,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new v5,this.fontLoader=new dee({ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this.loadingParams=r.loadingParams,this._params=r,this.canvasFactory=s.canvasFactory,this.filterFactory=s.filterFactory,this.cMapReaderFactory=s.cMapReaderFactory,this.standardFontDataFactory=s.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return st(this,"annotationStorage",new HC)}getRenderingIntent(e,t=$l.ENABLE,i=null,r=!1,s=!1){let a=Tr.DISPLAY,o=PS;switch(e){case"any":a=Tr.ANY;break;case"display":break;case"print":a=Tr.PRINT;break;default:et(`getRenderingIntent - invalid intent: ${e}`)}const l=a&Tr.PRINT&&i instanceof XU?i:this.annotationStorage;switch(t){case $l.DISABLE:a+=Tr.ANNOTATIONS_DISABLE;break;case $l.ENABLE:break;case $l.ENABLE_FORMS:a+=Tr.ANNOTATIONS_FORMS;break;case $l.ENABLE_STORAGE:a+=Tr.ANNOTATIONS_STORAGE,o=l.serializable;break;default:et(`getRenderingIntent - invalid annotationMode: ${t}`)}r&&(a+=Tr.IS_EDITING),s&&(a+=Tr.OPLIST);const{ids:u,hash:c}=l.modifiedIds,h=[a,o.hash,c];return{renderingIntent:a,cacheKey:h.join("_"),annotationStorageSerializable:o,modifiedIds:u}}destroy(){var i;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(i=d(this,Eo))==null||i.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const r of d(this,Aa).values())e.push(r._destroy());d(this,Aa).clear(),d(this,Kf).clear(),d(this,Yf).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var r,s;this.commonObjs.clear(),this.fontLoader.clear(),d(this,xo).clear(),this.filterFactory.destroy(),xy.cleanup(),(r=this._networkStream)==null||r.cancelAllRequests(new Nu("Worker was terminated.")),(s=this.messageHandler)==null||s.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(i,r)=>{bn(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=s=>{this._lastProgress={loaded:s.loaded,total:s.total}},r.onPull=()=>{this._fullReader.read().then(function({value:s,done:a}){if(a){r.close();return}bn(s instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(s),1,[s])}).catch(s=>{r.error(s)})},r.onCancel=s=>{this._fullReader.cancel(s),r.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("ReaderHeadersReady",async i=>{var o;await this._fullReader.headersReady;const{isStreamingSupported:r,isRangeSupported:s,contentLength:a}=this._fullReader;return(!r||!s)&&(this._lastProgress&&((o=t.onProgress)==null||o.call(t,this._lastProgress)),this._fullReader.onProgress=l=>{var u;(u=t.onProgress)==null||u.call(t,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:r,isRangeSupported:s,contentLength:a}}),e.on("GetRangeReader",(i,r)=>{bn(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const s=this._networkStream.getRangeReader(i.begin,i.end);if(!s){r.close();return}r.onPull=()=>{s.read().then(function({value:a,done:o}){if(o){r.close();return}bn(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{r.error(a)})},r.onCancel=a=>{s.cancel(a),r.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,t._capability.resolve(new ute(i,this))}),e.on("DocException",i=>{t._capability.reject(Ki(i))}),e.on("PasswordRequest",i=>{P(this,Eo,Promise.withResolvers());try{if(!t.onPassword)throw Ki(i);const r=s=>{s instanceof Error?d(this,Eo).reject(s):d(this,Eo).resolve({password:s})};t.onPassword(r,i.code)}catch(r){d(this,Eo).reject(r)}return d(this,Eo).promise}),e.on("DataLoaded",i=>{var r;(r=t.onProgress)==null||r.call(t,{loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),e.on("StartRenderPage",i=>{if(this.destroyed)return;d(this,Aa).get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),e.on("commonobj",([i,r,s])=>{var a;if(this.destroyed||this.commonObjs.has(i))return null;switch(r){case"Font":const{disableFontFace:o,fontExtraProperties:l,pdfBug:u}=this._params;if("error"in s){const m=s.error;et(`Error during font loading: ${m}`),this.commonObjs.resolve(i,m);break}const c=u&&((a=globalThis.FontInspector)!=null&&a.enabled)?(m,y)=>globalThis.FontInspector.fontAdded(m,y):null,h=new hee(s,{disableFontFace:o,fontExtraProperties:l,inspectFont:c});this.fontLoader.bind(h).catch(()=>e.sendWithPromise("FontFallback",{id:i})).finally(()=>{!l&&h.data&&(h.data=null),this.commonObjs.resolve(i,h)});break;case"CopyLocalImage":const{imageRef:f}=s;bn(f,"The imageRef must be defined.");for(const m of d(this,Aa).values())for(const[,y]of m.objs)if((y==null?void 0:y.ref)===f)return y.dataLen?(this.commonObjs.resolve(i,structuredClone(y)),y.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(i,s);break;default:throw new Error(`Got unknown common object type ${r}`)}return null}),e.on("obj",([i,r,s,a])=>{var l;if(this.destroyed)return;const o=d(this,Aa).get(r);if(!o.objs.has(i)){if(o._intentStates.size===0){(l=a==null?void 0:a.bitmap)==null||l.close();return}switch(s){case"Image":o.objs.resolve(i,a),(a==null?void 0:a.dataLen)>jZ&&(o._maybeCleanupAfterRender=!0);break;case"Pattern":o.objs.resolve(i,a);break;default:throw new Error(`Got unknown object type ${s}`)}}}),e.on("DocProgress",i=>{var r;this.destroyed||(r=t.onProgress)==null||r.call(t,{loaded:i.loaded,total:i.total})}),e.on("FetchBuiltInCMap",async i=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(i)}),e.on("FetchStandardFontData",async i=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(i)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var i;this.annotationStorage.size<=0&&et("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((i=this._fullReader)==null?void 0:i.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,i=d(this,Kf).get(t);if(i)return i;const r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(s=>{if(this.destroyed)throw new Error("Transport destroyed");s.refStr&&d(this,Yf).set(s.refStr,e);const a=new cte(t,s,this,this._params.pdfBug);return d(this,Aa).set(t,a),a});return d(this,Kf).set(t,r),r}getPageIndex(e){return g3(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return z(this,ad,vg).call(this,"GetFieldObjects")}hasJSActions(){return z(this,ad,vg).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return z(this,ad,vg).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return z(this,ad,vg).call(this,"GetOptionalContentConfig").then(t=>new Dee(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=d(this,xo).get(e);if(t)return t;const i=this.messageHandler.sendWithPromise(e,null).then(r=>{var s,a;return{info:r[0],metadata:r[1]?new Pee(r[1]):null,contentDispositionFilename:((s=this._fullReader)==null?void 0:s.filename)??null,contentLength:((a=this._fullReader)==null?void 0:a.contentLength)??null}});return d(this,xo).set(e,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of d(this,Aa).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),d(this,xo).clear(),this.filterFactory.destroy(!0),xy.cleanup()}}cachedPageNumber(e){if(!g3(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return d(this,Yf).get(t)??null}}xo=new WeakMap,Aa=new WeakMap,Kf=new WeakMap,Yf=new WeakMap,Eo=new WeakMap,ad=new WeakSet,vg=function(e,t=null){const i=d(this,xo).get(e);if(i)return i;const r=this.messageHandler.sendWithPromise(e,t);return d(this,xo).set(e,r),r};const Gm=Symbol("INITIAL_DATA");var gr,f_,HS;class v5{constructor(){F(this,f_);F(this,gr,Object.create(null))}get(e,t=null){if(t){const r=z(this,f_,HS).call(this,e);return r.promise.then(()=>t(r.data)),null}const i=d(this,gr)[e];if(!i||i.data===Gm)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return i.data}has(e){const t=d(this,gr)[e];return!!t&&t.data!==Gm}delete(e){const t=d(this,gr)[e];return!t||t.data===Gm?!1:(delete d(this,gr)[e],!0)}resolve(e,t=null){const i=z(this,f_,HS).call(this,e);i.data=t,i.resolve()}clear(){var e;for(const t in d(this,gr)){const{data:i}=d(this,gr)[t];(e=i==null?void 0:i.bitmap)==null||e.close()}P(this,gr,Object.create(null))}*[Symbol.iterator](){for(const e in d(this,gr)){const{data:t}=d(this,gr)[e];t!==Gm&&(yield[e,t])}}}gr=new WeakMap,f_=new WeakSet,HS=function(e){var t;return(t=d(this,gr))[e]||(t[e]={...Promise.withResolvers(),data:Gm})};var Kl;class fte{constructor(e){F(this,Kl,null);P(this,Kl,e),this.onContinue=null}get promise(){return d(this,Kl).capability.promise}cancel(e=0){d(this,Kl).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=d(this,Kl).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=d(this,Kl);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}Kl=new WeakMap;var Yl,od;const Ac=class Ac{constructor({callback:e,params:t,objs:i,commonObjs:r,annotationCanvasMap:s,operatorList:a,pageIndex:o,canvasFactory:l,filterFactory:u,useRequestAnimationFrame:c=!1,pdfBug:h=!1,pageColors:f=null}){F(this,Yl,null);this.callback=e,this.params=t,this.objs=i,this.commonObjs=r,this.annotationCanvasMap=s,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=u,this._pdfBug=h,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=c===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new fte(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var o,l;if(this.cancelled)return;if(this._canvas){if(d(Ac,od).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");d(Ac,od).add(this._canvas)}this._pdfBug&&((o=globalThis.StepperManager)!=null&&o.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:i,viewport:r,transform:s,background:a}=this.params;this.gfx=new vf(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:s,viewport:r,transparency:e,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(e=null,t=0){var i;this.running=!1,this.cancelled=!0,(i=this.gfx)==null||i.endDrawing(),d(this,Yl)&&(window.cancelAnimationFrame(d(this,Yl)),P(this,Yl,null)),d(Ac,od).delete(this._canvas),this.callback(e||new VC(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){var e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?P(this,Yl,window.requestAnimationFrame(()=>{P(this,Yl,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),d(Ac,od).delete(this._canvas),this.callback())))}};Yl=new WeakMap,od=new WeakMap,F(Ac,od,new WeakSet);let WS=Ac;const pte="4.10.38",mte="f9bea397f";function y3(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0")}function Km(n){return Math.max(0,Math.min(255,255*n))}class _3{static CMYK_G([e,t,i,r]){return["G",1-Math.min(1,.3*e+.59*i+.11*t+r)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=Km(e),[e,e,e]}static G_HTML([e]){const t=y3(e);return`#${t}${t}${t}`}static RGB_G([e,t,i]){return["G",.3*e+.59*t+.11*i]}static RGB_rgb(e){return e.map(Km)}static RGB_HTML(e){return`#${e.map(y3).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,i,r]){return["RGB",1-Math.min(1,e+r),1-Math.min(1,i+r),1-Math.min(1,t+r)]}static CMYK_rgb([e,t,i,r]){return[Km(1-Math.min(1,e+r)),Km(1-Math.min(1,i+r)),Km(1-Math.min(1,t+r))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,i]){const r=1-e,s=1-t,a=1-i,o=Math.min(r,s,a);return["CMYK",r,s,a,o]}}class gte{create(e,t,i=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const r=this._createSVG("svg:svg");return r.setAttribute("version","1.1"),i||(r.setAttribute("width",`${e}px`),r.setAttribute("height",`${t}px`)),r.setAttribute("preserveAspectRatio","none"),r.setAttribute("viewBox",`0 0 ${e} ${t}`),r}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){Dt("Abstract method `_createSVG` called.")}}class qC extends gte{_createSVG(e){return document.createElementNS(no,e)}}class w5{static setupStorage(e,t,i,r,s){const a=r.getValue(t,{value:null});switch(i.name){case"textarea":if(a.value!==null&&(e.textContent=a.value),s==="print")break;e.addEventListener("input",o=>{r.setValue(t,{value:o.target.value})});break;case"input":if(i.attributes.type==="radio"||i.attributes.type==="checkbox"){if(a.value===i.attributes.xfaOn?e.setAttribute("checked",!0):a.value===i.attributes.xfaOff&&e.removeAttribute("checked"),s==="print")break;e.addEventListener("change",o=>{r.setValue(t,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&e.setAttribute("value",a.value),s==="print")break;e.addEventListener("input",o=>{r.setValue(t,{value:o.target.value})})}break;case"select":if(a.value!==null){e.setAttribute("value",a.value);for(const o of i.children)o.attributes.value===a.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}e.addEventListener("input",o=>{const l=o.target.options,u=l.selectedIndex===-1?"":l[l.selectedIndex].value;r.setValue(t,{value:u})});break}}static setAttributes({html:e,element:t,storage:i=null,intent:r,linkService:s}){const{attributes:a}=t,o=e instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${r}`);for(const[l,u]of Object.entries(a))if(u!=null)switch(l){case"class":u.length&&e.setAttribute(l,u.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",u);break;case"style":Object.assign(e.style,u);break;case"textContent":e.textContent=u;break;default:(!o||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,u)}o&&s.addLinkAttributes(e,a.href,a.newWindow),i&&a.dataId&&this.setupStorage(e,a.dataId,t,i)}static render(e){var h,f;const t=e.annotationStorage,i=e.linkService,r=e.xfaHtml,s=e.intent||"display",a=document.createElement(r.name);r.attributes&&this.setAttributes({html:a,element:r,intent:s,linkService:i});const o=s!=="richText",l=e.div;if(l.append(a),e.viewport){const m=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=m}o&&l.setAttribute("class","xfaLayer xfaFont");const u=[];if(r.children.length===0){if(r.value){const m=document.createTextNode(r.value);a.append(m),o&&Ey.shouldBuildText(r.name)&&u.push(m)}return{textDivs:u}}const c=[[r,-1,a]];for(;c.length>0;){const[m,y,_]=c.at(-1);if(y+1===m.children.length){c.pop();continue}const x=m.children[++c.at(-1)[1]];if(x===null)continue;const{name:v}=x;if(v==="#text"){const E=document.createTextNode(x.value);u.push(E),_.append(E);continue}const w=(h=x==null?void 0:x.attributes)!=null&&h.xmlns?document.createElementNS(x.attributes.xmlns,v):document.createElement(v);if(_.append(w),x.attributes&&this.setAttributes({html:w,element:x,storage:t,intent:s,linkService:i}),((f=x.children)==null?void 0:f.length)>0)c.push([x,-1,w]);else if(x.value){const E=document.createTextNode(x.value);o&&Ey.shouldBuildText(v)&&u.push(E),w.append(E)}}for(const m of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))m.setAttribute("readOnly",!0);return{textDivs:u}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const mv=1e3,yte=9,th=new WeakSet;function xu(n){return{width:n[2]-n[0],height:n[3]-n[1]}}class _te{static create(e){switch(e.data.annotationType){case An.LINK:return new b5(e);case An.TEXT:return new vte(e);case An.WIDGET:switch(e.data.fieldType){case"Tx":return new wte(e);case"Btn":return e.data.radioButton?new A5(e):e.data.checkBox?new xte(e):new Ete(e);case"Ch":return new Ate(e);case"Sig":return new bte(e)}return new ph(e);case An.POPUP:return new GS(e);case An.FREETEXT:return new k5(e);case An.LINE:return new Ste(e);case An.SQUARE:return new Ite(e);case An.CIRCLE:return new Cte(e);case An.POLYLINE:return new $5(e);case An.CARET:return new $te(e);case An.INK:return new GC(e);case An.POLYGON:return new kte(e);case An.HIGHLIGHT:return new R5(e);case An.UNDERLINE:return new Rte(e);case An.SQUIGGLY:return new Pte(e);case An.STRIKEOUT:return new Nte(e);case An.STAMP:return new P5(e);case An.FILEATTACHMENT:return new Dte(e);default:return new pn(e)}}}var ld,Xf,Qf,p_,qS;const JC=class JC{constructor(e,{isRenderable:t=!1,ignoreBorder:i=!1,createQuadrilaterals:r=!1}={}){F(this,p_);F(this,ld,null);F(this,Xf,!1);F(this,Qf,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(i)),r&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:i}){return!!(e!=null&&e.str||t!=null&&t.str||i!=null&&i.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return JC._hasPopupData(this.data)}updateEdited(e){var i;if(!this.container)return;d(this,ld)||P(this,ld,{rect:this.data.rect.slice(0)});const{rect:t}=e;t&&z(this,p_,qS).call(this,t),(i=d(this,Qf))==null||i.popup.updateEdited(e)}resetEdited(){var e;d(this,ld)&&(z(this,p_,qS).call(this,d(this,ld).rect),(e=d(this,Qf))==null||e.popup.resetEdited(),P(this,ld,null))}_createContainer(e){const{data:t,parent:{page:i,viewport:r}}=this,s=document.createElement("section");s.setAttribute("data-annotation-id",t.id),this instanceof ph||(s.tabIndex=mv);const{style:a}=s;if(a.zIndex=this.parent.zIndex++,t.alternativeText&&(s.title=t.alternativeText),t.noRotate&&s.classList.add("norotate"),!t.rect||this instanceof GS){const{rotation:_}=t;return!t.hasOwnCanvas&&_!==0&&this.setRotation(_,s),s}const{width:o,height:l}=xu(t.rect);if(!e&&t.borderStyle.width>0){a.borderWidth=`${t.borderStyle.width}px`;const _=t.borderStyle.horizontalCornerRadius,x=t.borderStyle.verticalCornerRadius;if(_>0||x>0){const w=`calc(${_}px * var(--scale-factor)) / calc(${x}px * var(--scale-factor))`;a.borderRadius=w}else if(this instanceof A5){const w=`calc(${o}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;a.borderRadius=w}switch(t.borderStyle.style){case Wm.SOLID:a.borderStyle="solid";break;case Wm.DASHED:a.borderStyle="dashed";break;case Wm.BEVELED:et("Unimplemented border style: beveled");break;case Wm.INSET:et("Unimplemented border style: inset");break;case Wm.UNDERLINE:a.borderBottomStyle="solid";break}const v=t.borderColor||null;v?(P(this,Xf,!0),a.borderColor=Me.makeHexColor(v[0]|0,v[1]|0,v[2]|0)):a.borderWidth=0}const u=Me.normalizeRect([t.rect[0],i.view[3]-t.rect[1]+i.view[1],t.rect[2],i.view[3]-t.rect[3]+i.view[1]]),{pageWidth:c,pageHeight:h,pageX:f,pageY:m}=r.rawDims;a.left=`${100*(u[0]-f)/c}%`,a.top=`${100*(u[1]-m)/h}%`;const{rotation:y}=t;return t.hasOwnCanvas||y===0?(a.width=`${100*o/c}%`,a.height=`${100*l/h}%`):this.setRotation(y,s),s}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:i,pageHeight:r}=this.parent.viewport.rawDims,{width:s,height:a}=xu(this.data.rect);let o,l;e%180===0?(o=100*s/i,l=100*a/r):(o=100*a/i,l=100*s/r),t.style.width=`${o}%`,t.style.height=`${l}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,i,r)=>{const s=r.detail[t],a=s[0],o=s.slice(1);r.target.style[i]=_3[`${a}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[i]:_3[`${a}_rgb`](o)})};return st(this,"_commonActions",{display:t=>{const{display:i}=t.detail,r=i%2===1;this.container.style.visibility=r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:r,noPrint:i===1||i===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:i}=t.detail;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:i,noView:i})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const i=t.detail.rotation;this.setRotation(i),this.annotationStorage.setValue(this.data.id,{rotation:i})}})}_dispatchEventFromSandbox(e,t){const i=this._commonActions;for(const r of Object.keys(t.detail)){const s=e[r]||i[r];s==null||s(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const i=this._commonActions;for(const[r,s]of Object.entries(t)){const a=i[r];if(a){const o={detail:{[r]:s},target:e};a(o),delete t[r]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,i,r,s]=this.data.rect.map(_=>Math.fround(_));if(e.length===8){const[_,x,v,w]=e.subarray(2,6);if(r===_&&s===x&&t===v&&i===w)return}const{style:a}=this.container;let o;if(d(this,Xf)){const{borderColor:_,borderWidth:x}=a;a.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${_}" stroke-width="${x}">`],this.container.classList.add("hasBorder")}const l=r-t,u=s-i,{svgFactory:c}=this,h=c.createElement("svg");h.classList.add("quadrilateralsContainer"),h.setAttribute("width",0),h.setAttribute("height",0);const f=c.createElement("defs");h.append(f);const m=c.createElement("clipPath"),y=`clippath_${this.data.id}`;m.setAttribute("id",y),m.setAttribute("clipPathUnits","objectBoundingBox"),f.append(m);for(let _=2,x=e.length;_<x;_+=8){const v=e[_],w=e[_+1],E=e[_+2],k=e[_+3],$=c.createElement("rect"),L=(E-t)/l,I=(s-w)/u,C=(v-E)/l,N=(w-k)/u;$.setAttribute("x",L),$.setAttribute("y",I),$.setAttribute("width",C),$.setAttribute("height",N),m.append($),o==null||o.push(`<rect vector-effect="non-scaling-stroke" x="${L}" y="${I}" width="${C}" height="${N}"/>`)}d(this,Xf)&&(o.push("</g></svg>')"),a.backgroundImage=o.join("")),this.container.append(h),this.container.style.clipPath=`url(#${y})`}_createPopup(){const{data:e}=this,t=P(this,Qf,new GS({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){Dt("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const i=[];if(this._fieldObjects){const r=this._fieldObjects[e];if(r)for(const{page:s,id:a,exportValues:o}of r){if(s===-1||a===t)continue;const l=typeof o=="string"?o:null,u=document.querySelector(`[data-element-id="${a}"]`);if(u&&!th.has(u)){et(`_getElementsByName - element not allowed: ${a}`);continue}i.push({id:a,exportValue:l,domElement:u})}return i}for(const r of document.getElementsByName(e)){const{exportValue:s}=r,a=r.getAttribute("data-element-id");a!==t&&th.has(r)&&i.push({id:a,exportValue:s,domElement:r})}return i}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var i;(i=this.linkService.eventBus)==null||i.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}};ld=new WeakMap,Xf=new WeakMap,Qf=new WeakMap,p_=new WeakSet,qS=function(e){const{container:{style:t},data:{rect:i,rotation:r},parent:{viewport:{rawDims:{pageWidth:s,pageHeight:a,pageX:o,pageY:l}}}}=this;i==null||i.splice(0,4,...e);const{width:u,height:c}=xu(e);t.left=`${100*(e[0]-o)/s}%`,t.top=`${100*(a-e[3]+l)/a}%`,r===0?(t.width=`${100*u/s}%`,t.height=`${100*c/a}%`):this.setRotation(r)};let pn=JC;var Cr,yc,x5,E5;class b5 extends pn{constructor(t,i=null){super(t,{isRenderable:!0,ignoreBorder:!!(i!=null&&i.ignoreBorder),createQuadrilaterals:!0});F(this,Cr);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:i}=this,r=document.createElement("a");r.setAttribute("data-element-id",t.id);let s=!1;return t.url?(i.addLinkAttributes(r,t.url,t.newWindow),s=!0):t.action?(this._bindNamedAction(r,t.action),s=!0):t.attachment?(z(this,Cr,x5).call(this,r,t.attachment,t.attachmentDest),s=!0):t.setOCGState?(z(this,Cr,E5).call(this,r,t.setOCGState),s=!0):t.dest?(this._bindLink(r,t.dest),s=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(r,t),s=!0),t.resetForm?(this._bindResetFormAction(r,t.resetForm),s=!0):this.isTooltipOnly&&!s&&(this._bindLink(r,""),s=!0)),this.container.classList.add("linkAnnotation"),s&&this.container.append(r),this.container}_bindLink(t,i){t.href=this.linkService.getDestinationHash(i),t.onclick=()=>(i&&this.linkService.goToDestination(i),!1),(i||i==="")&&z(this,Cr,yc).call(this)}_bindNamedAction(t,i){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(i),!1),z(this,Cr,yc).call(this)}_bindJSAction(t,i){t.href=this.linkService.getAnchorUrl("");const r=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const s of Object.keys(i.actions)){const a=r.get(s);a&&(t[a]=()=>{var o;return(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:i.id,name:s}}),!1})}t.onclick||(t.onclick=()=>!1),z(this,Cr,yc).call(this)}_bindResetFormAction(t,i){const r=t.onclick;if(r||(t.href=this.linkService.getAnchorUrl("")),z(this,Cr,yc).call(this),!this._fieldObjects){et('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),r||(t.onclick=()=>!1);return}t.onclick=()=>{var h;r==null||r();const{fields:s,refs:a,include:o}=i,l=[];if(s.length!==0||a.length!==0){const f=new Set(a);for(const m of s){const y=this._fieldObjects[m]||[];for(const{id:_}of y)f.add(_)}for(const m of Object.values(this._fieldObjects))for(const y of m)f.has(y.id)===o&&l.push(y)}else for(const f of Object.values(this._fieldObjects))l.push(...f);const u=this.annotationStorage,c=[];for(const f of l){const{id:m}=f;switch(c.push(m),f.type){case"text":{const _=f.defaultValue||"";u.setValue(m,{value:_});break}case"checkbox":case"radiobutton":{const _=f.defaultValue===f.exportValues;u.setValue(m,{value:_});break}case"combobox":case"listbox":{const _=f.defaultValue||"";u.setValue(m,{value:_});break}default:continue}const y=document.querySelector(`[data-element-id="${m}"]`);if(y){if(!th.has(y)){et(`_bindResetFormAction - element not allowed: ${m}`);continue}}else continue;y.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((h=this.linkService.eventBus)==null||h.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:c,name:"ResetForm"}})),!1}}}Cr=new WeakSet,yc=function(){this.container.setAttribute("data-internal-link","")},x5=function(t,i,r=null){t.href=this.linkService.getAnchorUrl(""),i.description&&(t.title=i.description),t.onclick=()=>{var s;return(s=this.downloadManager)==null||s.openOrDownloadData(i.content,i.filename,r),!1},z(this,Cr,yc).call(this)},E5=function(t,i){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(i),!1),z(this,Cr,yc).call(this)};class vte extends pn{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class ph extends pn{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Oi.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,i,r,s){i.includes("mouse")?e.addEventListener(i,a=>{var o;(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:s(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):e.addEventListener(i,a=>{var o;if(i==="blur"){if(!t.focused||!a.relatedTarget)return;t.focused=!1}else if(i==="focus"){if(t.focused)return;t.focused=!0}s&&((o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:s(a)}}))})}_setEventListeners(e,t,i,r){var s,a,o;for(const[l,u]of i)(u==="Action"||(s=this.data.actions)!=null&&s[u])&&((u==="Focus"||u==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,l,u,r),u==="Focus"&&!((a=this.data.actions)!=null&&a.Blur)?this._setEventListener(e,t,"blur","Blur",null):u==="Blur"&&!((o=this.data.actions)!=null&&o.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":Me.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:i}=this.data.defaultAppearanceData,r=this.data.defaultAppearanceData.fontSize||yte,s=e.style;let a;const o=2,l=u=>Math.round(10*u)/10;if(this.data.multiLine){const u=Math.abs(this.data.rect[3]-this.data.rect[1]-o),c=Math.round(u/(pA*r))||1,h=u/c;a=Math.min(r,l(h/pA))}else{const u=Math.abs(this.data.rect[3]-this.data.rect[1]-o);a=Math.min(r,l(u/pA))}s.fontSize=`calc(${a}px * var(--scale-factor))`,s.color=Me.makeHexColor(i[0],i[1],i[2]),this.data.textAlignment!==null&&(s.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class wte extends ph{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,i,r){const s=this.annotationStorage;for(const a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[t]=i),s.setValue(a.id,{[r]:i})}render(){var r,s;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){const a=e.getValue(t,{value:this.data.fieldValue});let o=a.value||"";const l=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;l&&o.length>l&&(o=o.slice(0,l));let u=a.formattedValue||((r=this.data.textContent)==null?void 0:r.join(`
`))||null;u&&this.data.comb&&(u=u.replaceAll(/\s+/g,""));const c={userValue:o,formattedValue:u,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=u??o,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type="text",i.setAttribute("value",u??o),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),th.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=mv,this._setRequired(i,this.data.required),l&&(i.maxLength=l),i.addEventListener("input",f=>{e.setValue(t,{value:f.target.value}),this.setPropertyOnSiblings(i,"value",f.target.value,"value"),c.formattedValue=null}),i.addEventListener("resetform",f=>{const m=this.data.defaultFieldValue??"";i.value=c.userValue=m,c.formattedValue=null});let h=f=>{const{formattedValue:m}=c;m!=null&&(f.target.value=m),f.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",m=>{var _;if(c.focused)return;const{target:y}=m;c.userValue&&(y.value=c.userValue),c.lastCommittedValue=y.value,c.commitKey=1,(_=this.data.actions)!=null&&_.Focus||(c.focused=!0)}),i.addEventListener("updatefromsandbox",m=>{this.showElementAndHideCanvas(m.target);const y={value(_){c.userValue=_.detail.value??"",e.setValue(t,{value:c.userValue.toString()}),_.target.value=c.userValue},formattedValue(_){const{formattedValue:x}=_.detail;c.formattedValue=x,x!=null&&_.target!==document.activeElement&&(_.target.value=x),e.setValue(t,{formattedValue:x})},selRange(_){_.target.setSelectionRange(..._.detail.selRange)},charLimit:_=>{var E;const{charLimit:x}=_.detail,{target:v}=_;if(x===0){v.removeAttribute("maxLength");return}v.setAttribute("maxLength",x);let w=c.userValue;!w||w.length<=x||(w=w.slice(0,x),v.value=c.userValue=w,e.setValue(t,{value:w}),(E=this.linkService.eventBus)==null||E.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:w,willCommit:!0,commitKey:1,selStart:v.selectionStart,selEnd:v.selectionEnd}}))}};this._dispatchEventFromSandbox(y,m)}),i.addEventListener("keydown",m=>{var x;c.commitKey=1;let y=-1;if(m.key==="Escape"?y=0:m.key==="Enter"&&!this.data.multiLine?y=2:m.key==="Tab"&&(c.commitKey=3),y===-1)return;const{value:_}=m.target;c.lastCommittedValue!==_&&(c.lastCommittedValue=_,c.userValue=_,(x=this.linkService.eventBus)==null||x.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:_,willCommit:!0,commitKey:y,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}}))});const f=h;h=null,i.addEventListener("blur",m=>{var _,x;if(!c.focused||!m.relatedTarget)return;(_=this.data.actions)!=null&&_.Blur||(c.focused=!1);const{value:y}=m.target;c.userValue=y,c.lastCommittedValue!==y&&((x=this.linkService.eventBus)==null||x.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:y,willCommit:!0,commitKey:c.commitKey,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}})),f(m)}),(s=this.data.actions)!=null&&s.Keystroke&&i.addEventListener("beforeinput",m=>{var $;c.lastCommittedValue=null;const{data:y,target:_}=m,{value:x,selectionStart:v,selectionEnd:w}=_;let E=v,k=w;switch(m.inputType){case"deleteWordBackward":{const L=x.substring(0,v).match(/\w*[^\w]*$/);L&&(E-=L[0].length);break}case"deleteWordForward":{const L=x.substring(v).match(/^[^\w]*\w*/);L&&(k+=L[0].length);break}case"deleteContentBackward":v===w&&(E-=1);break;case"deleteContentForward":v===w&&(k+=1);break}m.preventDefault(),($=this.linkService.eventBus)==null||$.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:x,change:y||"",willCommit:!1,selStart:E,selEnd:k}})}),this._setEventListeners(i,c,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],m=>m.target.value)}if(h&&i.addEventListener("blur",h),this.data.comb){const m=(this.data.rect[2]-this.data.rect[0])/l;i.classList.add("comb"),i.style.letterSpacing=`calc(${m}px * var(--scale-factor) - 1ch)`}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class bte extends ph{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class xte extends ph{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,i=t.id;let r=e.getValue(i,{value:t.exportValue===t.fieldValue}).value;typeof r=="string"&&(r=r!=="Off",e.setValue(i,{value:r})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const s=document.createElement("input");return th.add(s),s.setAttribute("data-element-id",i),s.disabled=t.readOnly,this._setRequired(s,this.data.required),s.type="checkbox",s.name=t.fieldName,r&&s.setAttribute("checked",!0),s.setAttribute("exportValue",t.exportValue),s.tabIndex=mv,s.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const u of this._getElementsByName(o,i)){const c=l&&u.exportValue===t.exportValue;u.domElement&&(u.domElement.checked=c),e.setValue(u.id,{value:c})}e.setValue(i,{value:l})}),s.addEventListener("resetform",a=>{const o=t.defaultFieldValue||"Off";a.target.checked=o===t.exportValue}),this.enableScripting&&this.hasJSActions&&(s.addEventListener("updatefromsandbox",a=>{const o={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(i,{value:l.target.checked})}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class A5 extends ph{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,i=t.id;let r=e.getValue(i,{value:t.fieldValue===t.buttonValue}).value;if(typeof r=="string"&&(r=r!==t.buttonValue,e.setValue(i,{value:r})),r)for(const a of this._getElementsByName(t.fieldName,i))e.setValue(a.id,{value:!1});const s=document.createElement("input");if(th.add(s),s.setAttribute("data-element-id",i),s.disabled=t.readOnly,this._setRequired(s,this.data.required),s.type="radio",s.name=t.fieldName,r&&s.setAttribute("checked",!0),s.tabIndex=mv,s.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const u of this._getElementsByName(o,i))e.setValue(u.id,{value:!1});e.setValue(i,{value:l})}),s.addEventListener("resetform",a=>{const o=t.defaultFieldValue;a.target.checked=o!=null&&o===t.buttonValue}),this.enableScripting&&this.hasJSActions){const a=t.buttonValue;s.addEventListener("updatefromsandbox",o=>{const l={value:u=>{const c=a===u.detail.value;for(const h of this._getElementsByName(u.target.name)){const f=c&&h.id===i;h.domElement&&(h.domElement.checked=f),e.setValue(h.id,{value:f})}}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Ete extends b5{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({},i)})),e}}class Ate extends ph{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,i=e.getValue(t,{value:this.data.fieldValue}),r=document.createElement("select");th.add(r),r.setAttribute("data-element-id",t),r.disabled=this.data.readOnly,this._setRequired(r,this.data.required),r.name=this.data.fieldName,r.tabIndex=mv;let s=this.data.combo&&this.data.options.length>0;this.data.combo||(r.size=this.data.options.length,this.data.multiSelect&&(r.multiple=!0)),r.addEventListener("resetform",c=>{const h=this.data.defaultFieldValue;for(const f of r.options)f.selected=f.value===h});for(const c of this.data.options){const h=document.createElement("option");h.textContent=c.displayValue,h.value=c.exportValue,i.value.includes(c.exportValue)&&(h.setAttribute("selected",!0),s=!1),r.append(h)}let a=null;if(s){const c=document.createElement("option");c.value=" ",c.setAttribute("hidden",!0),c.setAttribute("selected",!0),r.prepend(c),a=()=>{c.remove(),r.removeEventListener("input",a),a=null},r.addEventListener("input",a)}const o=c=>{const h=c?"value":"textContent",{options:f,multiple:m}=r;return m?Array.prototype.filter.call(f,y=>y.selected).map(y=>y[h]):f.selectedIndex===-1?null:f[f.selectedIndex][h]};let l=o(!1);const u=c=>{const h=c.target.options;return Array.prototype.map.call(h,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(r.addEventListener("updatefromsandbox",c=>{const h={value(f){a==null||a();const m=f.detail.value,y=new Set(Array.isArray(m)?m:[m]);for(const _ of r.options)_.selected=y.has(_.value);e.setValue(t,{value:o(!0)}),l=o(!1)},multipleSelection(f){r.multiple=!0},remove(f){const m=r.options,y=f.detail.remove;m[y].selected=!1,r.remove(y),m.length>0&&Array.prototype.findIndex.call(m,x=>x.selected)===-1&&(m[0].selected=!0),e.setValue(t,{value:o(!0),items:u(f)}),l=o(!1)},clear(f){for(;r.length!==0;)r.remove(0);e.setValue(t,{value:null,items:[]}),l=o(!1)},insert(f){const{index:m,displayValue:y,exportValue:_}=f.detail.insert,x=r.children[m],v=document.createElement("option");v.textContent=y,v.value=_,x?x.before(v):r.append(v),e.setValue(t,{value:o(!0),items:u(f)}),l=o(!1)},items(f){const{items:m}=f.detail;for(;r.length!==0;)r.remove(0);for(const y of m){const{displayValue:_,exportValue:x}=y,v=document.createElement("option");v.textContent=_,v.value=x,r.append(v)}r.options.length>0&&(r.options[0].selected=!0),e.setValue(t,{value:o(!0),items:u(f)}),l=o(!1)},indices(f){const m=new Set(f.detail.indices);for(const y of f.target.options)y.selected=m.has(y.index);e.setValue(t,{value:o(!0)}),l=o(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(h,c)}),r.addEventListener("input",c=>{var m;const h=o(!0),f=o(!1);e.setValue(t,{value:h}),c.preventDefault(),(m=this.linkService.eventBus)==null||m.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:f,changeEx:h,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(r,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],c=>c.target.value)):r.addEventListener("input",function(c){e.setValue(t,{value:o(!0)})}),this.data.combo&&this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class GS extends pn{constructor(e){const{data:t,elements:i}=e;super(e,{isRenderable:pn._hasPopupData(t)}),this.elements=i,this.popup=null}render(){this.container.classList.add("popupAnnotation");const e=this.popup=new Tte({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(const i of this.elements)i.popup=e,i.container.ariaHasPopup="dialog",t.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(i=>`${zC}${i}`).join(",")),this.container}}var Jf,a1,o1,Zf,ud,an,Ao,ep,m_,g_,tp,To,ks,So,y_,Io,__,cd,dd,$t,Tw,KS,T5,S5,I5,C5,Sw,Iw,YS;class Tte{constructor({container:e,color:t,elements:i,titleObj:r,modificationDate:s,contentsObj:a,richText:o,parent:l,rect:u,parentRect:c,open:h}){F(this,$t);F(this,Jf,z(this,$t,I5).bind(this));F(this,a1,z(this,$t,YS).bind(this));F(this,o1,z(this,$t,Iw).bind(this));F(this,Zf,z(this,$t,Sw).bind(this));F(this,ud,null);F(this,an,null);F(this,Ao,null);F(this,ep,null);F(this,m_,null);F(this,g_,null);F(this,tp,null);F(this,To,!1);F(this,ks,null);F(this,So,null);F(this,y_,null);F(this,Io,null);F(this,__,null);F(this,cd,null);F(this,dd,!1);var f;P(this,an,e),P(this,__,r),P(this,Ao,a),P(this,Io,o),P(this,g_,l),P(this,ud,t),P(this,y_,u),P(this,tp,c),P(this,m_,i),P(this,ep,BC.toDateObject(s)),this.trigger=i.flatMap(m=>m.getElementsToTriggerPopup());for(const m of this.trigger)m.addEventListener("click",d(this,Zf)),m.addEventListener("mouseenter",d(this,o1)),m.addEventListener("mouseleave",d(this,a1)),m.classList.add("popupTriggerArea");for(const m of i)(f=m.container)==null||f.addEventListener("keydown",d(this,Jf));d(this,an).hidden=!0,h&&z(this,$t,Sw).call(this)}render(){if(d(this,ks))return;const e=P(this,ks,document.createElement("div"));if(e.className="popup",d(this,ud)){const s=e.style.outlineColor=Me.makeHexColor(...d(this,ud));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${s} 30%, white)`:e.style.backgroundColor=Me.makeHexColor(...d(this,ud).map(o=>Math.floor(.7*(255-o)+o)))}const t=document.createElement("span");t.className="header";const i=document.createElement("h1");if(t.append(i),{dir:i.dir,str:i.textContent}=d(this,__),e.append(t),d(this,ep)){const s=document.createElement("span");s.classList.add("popupDate"),s.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),s.setAttribute("data-l10n-args",JSON.stringify({dateObj:d(this,ep).valueOf()})),t.append(s)}const r=d(this,$t,Tw);if(r)w5.render({xfaHtml:r,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const s=this._formatContents(d(this,Ao));e.append(s)}d(this,an).append(e)}_formatContents({str:e,dir:t}){const i=document.createElement("p");i.classList.add("popupContent"),i.dir=t;const r=e.split(/(?:\r\n?|\n)/);for(let s=0,a=r.length;s<a;++s){const o=r[s];i.append(document.createTextNode(o)),s<a-1&&i.append(document.createElement("br"))}return i}updateEdited({rect:e,popupContent:t}){var i;d(this,cd)||P(this,cd,{contentsObj:d(this,Ao),richText:d(this,Io)}),e&&P(this,So,null),t&&(P(this,Io,z(this,$t,S5).call(this,t)),P(this,Ao,null)),(i=d(this,ks))==null||i.remove(),P(this,ks,null)}resetEdited(){var e;d(this,cd)&&({contentsObj:Ii(this,Ao)._,richText:Ii(this,Io)._}=d(this,cd),P(this,cd,null),(e=d(this,ks))==null||e.remove(),P(this,ks,null),P(this,So,null))}forceHide(){P(this,dd,this.isVisible),d(this,dd)&&(d(this,an).hidden=!0)}maybeShow(){d(this,dd)&&(d(this,ks)||z(this,$t,Iw).call(this),P(this,dd,!1),d(this,an).hidden=!1)}get isVisible(){return d(this,an).hidden===!1}}Jf=new WeakMap,a1=new WeakMap,o1=new WeakMap,Zf=new WeakMap,ud=new WeakMap,an=new WeakMap,Ao=new WeakMap,ep=new WeakMap,m_=new WeakMap,g_=new WeakMap,tp=new WeakMap,To=new WeakMap,ks=new WeakMap,So=new WeakMap,y_=new WeakMap,Io=new WeakMap,__=new WeakMap,cd=new WeakMap,dd=new WeakMap,$t=new WeakSet,Tw=function(){const e=d(this,Io),t=d(this,Ao);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&d(this,Io).html||null},KS=function(){var e,t,i;return((i=(t=(e=d(this,$t,Tw))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:i.fontSize)||0},T5=function(){var e,t,i;return((i=(t=(e=d(this,$t,Tw))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:i.color)||null},S5=function(e){const t=[],i={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},r={style:{color:d(this,$t,T5),fontSize:d(this,$t,KS)?`calc(${d(this,$t,KS)}px * var(--scale-factor))`:""}};for(const s of e.split(`
`))t.push({name:"span",value:s,attributes:r});return i},I5=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&d(this,To))&&z(this,$t,Sw).call(this)},C5=function(){if(d(this,So)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:i,pageX:r,pageY:s}}}=d(this,g_);let a=!!d(this,tp),o=a?d(this,tp):d(this,y_);for(const y of d(this,m_))if(!o||Me.intersect(y.data.rect,o)!==null){o=y.data.rect,a=!0;break}const l=Me.normalizeRect([o[0],e[3]-o[1]+e[1],o[2],e[3]-o[3]+e[1]]),c=a?o[2]-o[0]+5:0,h=l[0]+c,f=l[1];P(this,So,[100*(h-r)/t,100*(f-s)/i]);const{style:m}=d(this,an);m.left=`${d(this,So)[0]}%`,m.top=`${d(this,So)[1]}%`},Sw=function(){P(this,To,!d(this,To)),d(this,To)?(z(this,$t,Iw).call(this),d(this,an).addEventListener("click",d(this,Zf)),d(this,an).addEventListener("keydown",d(this,Jf))):(z(this,$t,YS).call(this),d(this,an).removeEventListener("click",d(this,Zf)),d(this,an).removeEventListener("keydown",d(this,Jf)))},Iw=function(){d(this,ks)||this.render(),this.isVisible?d(this,To)&&d(this,an).classList.add("focused"):(z(this,$t,C5).call(this),d(this,an).hidden=!1,d(this,an).style.zIndex=parseInt(d(this,an).style.zIndex)+1e3)},YS=function(){d(this,an).classList.remove("focused"),!(d(this,To)||!this.isVisible)&&(d(this,an).hidden=!0,d(this,an).style.zIndex=parseInt(d(this,an).style.zIndex)-1e3)};class k5 extends pn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=Ze.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const i=document.createElement("span");i.textContent=t,e.append(i)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var v_;class Ste extends pn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});F(this,v_,null)}render(){this.container.classList.add("lineAnnotation");const t=this.data,{width:i,height:r}=xu(t.rect),s=this.svgFactory.create(i,r,!0),a=P(this,v_,this.svgFactory.createElement("svg:line"));return a.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),a.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),a.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),a.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),a.setAttribute("stroke-width",t.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,v_)}addHighlightArea(){this.container.classList.add("highlightArea")}}v_=new WeakMap;var w_;class Ite extends pn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});F(this,w_,null)}render(){this.container.classList.add("squareAnnotation");const t=this.data,{width:i,height:r}=xu(t.rect),s=this.svgFactory.create(i,r,!0),a=t.borderStyle.width,o=P(this,w_,this.svgFactory.createElement("svg:rect"));return o.setAttribute("x",a/2),o.setAttribute("y",a/2),o.setAttribute("width",i-a),o.setAttribute("height",r-a),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),s.append(o),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,w_)}addHighlightArea(){this.container.classList.add("highlightArea")}}w_=new WeakMap;var b_;class Cte extends pn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});F(this,b_,null)}render(){this.container.classList.add("circleAnnotation");const t=this.data,{width:i,height:r}=xu(t.rect),s=this.svgFactory.create(i,r,!0),a=t.borderStyle.width,o=P(this,b_,this.svgFactory.createElement("svg:ellipse"));return o.setAttribute("cx",i/2),o.setAttribute("cy",r/2),o.setAttribute("rx",i/2-a/2),o.setAttribute("ry",r/2-a/2),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),s.append(o),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,b_)}addHighlightArea(){this.container.classList.add("highlightArea")}}b_=new WeakMap;var x_;class $5 extends pn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});F(this,x_,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:i,borderStyle:r,popupRef:s}}=this;if(!i)return this.container;const{width:a,height:o}=xu(t),l=this.svgFactory.create(a,o,!0);let u=[];for(let h=0,f=i.length;h<f;h+=2){const m=i[h]-t[0],y=t[3]-i[h+1];u.push(`${m},${y}`)}u=u.join(" ");const c=P(this,x_,this.svgFactory.createElement(this.svgElementName));return c.setAttribute("points",u),c.setAttribute("stroke-width",r.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),l.append(c),this.container.append(l),!s&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,x_)}addHighlightArea(){this.container.classList.add("highlightArea")}}x_=new WeakMap;class kte extends $5{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class $te extends pn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var E_,hd,A_,XS;class GC extends pn{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});F(this,A_);F(this,E_,null);F(this,hd,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Ze.HIGHLIGHT:Ze.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:i,inkLists:r,borderStyle:s,popupRef:a}}=this,{transform:o,width:l,height:u}=z(this,A_,XS).call(this,i,t),c=this.svgFactory.create(l,u,!0),h=P(this,E_,this.svgFactory.createElement("svg:g"));c.append(h),h.setAttribute("stroke-width",s.width||1),h.setAttribute("stroke-linecap","round"),h.setAttribute("stroke-linejoin","round"),h.setAttribute("stroke-miterlimit",10),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),h.setAttribute("transform",o);for(let f=0,m=r.length;f<m;f++){const y=this.svgFactory.createElement(this.svgElementName);d(this,hd).push(y),y.setAttribute("points",r[f].join(",")),h.append(y)}return!a&&this.hasPopupData&&this._createPopup(),this.container.append(c),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:i,points:r,rect:s}=t,a=d(this,E_);if(i>=0&&a.setAttribute("stroke-width",i||1),r)for(let o=0,l=d(this,hd).length;o<l;o++)d(this,hd)[o].setAttribute("points",r[o].join(","));if(s){const{transform:o,width:l,height:u}=z(this,A_,XS).call(this,this.data.rotation,s);a.parentElement.setAttribute("viewBox",`0 0 ${l} ${u}`),a.setAttribute("transform",o)}}getElementsToTriggerPopup(){return d(this,hd)}addHighlightArea(){this.container.classList.add("highlightArea")}}E_=new WeakMap,hd=new WeakMap,A_=new WeakSet,XS=function(t,i){switch(t){case 90:return{transform:`rotate(90) translate(${-i[0]},${i[1]}) scale(1,-1)`,width:i[3]-i[1],height:i[2]-i[0]};case 180:return{transform:`rotate(180) translate(${-i[2]},${i[1]}) scale(1,-1)`,width:i[2]-i[0],height:i[3]-i[1]};case 270:return{transform:`rotate(270) translate(${-i[2]},${i[3]}) scale(1,-1)`,width:i[3]-i[1],height:i[2]-i[0]};default:return{transform:`translate(${-i[0]},${i[3]}) scale(1,-1)`,width:i[2]-i[0],height:i[3]-i[1]}}};class R5 extends pn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Ze.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class Rte extends pn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class Pte extends pn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class Nte extends pn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class P5 extends pn{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Ze.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var T_,S_,QS;class Dte extends pn{constructor(t){var r;super(t,{isRenderable:!0});F(this,S_);F(this,T_,null);const{file:i}=this.data;this.filename=i.filename,this.content=i.content,(r=this.linkService.eventBus)==null||r.dispatch("fileattachmentannotation",{source:this,...i})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:i}=this;let r;i.hasAppearance||i.fillAlpha===0?r=document.createElement("div"):(r=document.createElement("img"),r.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(i.name)?"paperclip":"pushpin"}.svg`,i.fillAlpha&&i.fillAlpha<1&&(r.style=`filter: opacity(${Math.round(i.fillAlpha*100)}%);`)),r.addEventListener("dblclick",z(this,S_,QS).bind(this)),P(this,T_,r);const{isMac:s}=Oi.platform;return t.addEventListener("keydown",a=>{a.key==="Enter"&&(s?a.metaKey:a.ctrlKey)&&z(this,S_,QS).call(this)}),!i.popupRef&&this.hasPopupData?this._createPopup():r.classList.add("popupTriggerArea"),t.append(r),t}getElementsToTriggerPopup(){return d(this,T_)}addHighlightArea(){this.container.classList.add("highlightArea")}}T_=new WeakMap,S_=new WeakSet,QS=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var I_,fd,pd,C_,ih,N5,JS;class Mte{constructor({div:e,accessibilityManager:t,annotationCanvasMap:i,annotationEditorUIManager:r,page:s,viewport:a,structTreeLayer:o}){F(this,ih);F(this,I_,null);F(this,fd,null);F(this,pd,new Map);F(this,C_,null);this.div=e,P(this,I_,t),P(this,fd,i),P(this,C_,o||null),this.page=s,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=r}hasEditableAnnotations(){return d(this,pd).size>0}async render(e){var a;const{annotations:t}=e,i=this.div;Zd(i,this.viewport);const r=new Map,s={data:null,layer:i,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new qC,annotationStorage:e.annotationStorage||new HC,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const o of t){if(o.noHTML)continue;const l=o.annotationType===An.POPUP;if(l){const h=r.get(o.id);if(!h)continue;s.elements=h}else{const{width:h,height:f}=xu(o.rect);if(h<=0||f<=0)continue}s.data=o;const u=_te.create(s);if(!u.isRenderable)continue;if(!l&&o.popupRef){const h=r.get(o.popupRef);h?h.push(u):r.set(o.popupRef,[u])}const c=u.render();o.hidden&&(c.style.visibility="hidden"),await z(this,ih,N5).call(this,c,o.id),u._isEditable&&(d(this,pd).set(u.data.id,u),(a=this._annotationEditorUIManager)==null||a.renderAnnotationElement(u))}z(this,ih,JS).call(this)}update({viewport:e}){const t=this.div;this.viewport=e,Zd(t,{rotation:e.rotation}),z(this,ih,JS).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(d(this,pd).values())}getEditableAnnotation(e){return d(this,pd).get(e)}}I_=new WeakMap,fd=new WeakMap,pd=new WeakMap,C_=new WeakMap,ih=new WeakSet,N5=async function(e,t){var a,o;const i=e.firstChild||e,r=i.id=`${zC}${t}`,s=await((a=d(this,C_))==null?void 0:a.getAriaAttributes(r));if(s)for(const[l,u]of s)i.setAttribute(l,u);this.div.append(e),(o=d(this,I_))==null||o.moveElementInDOM(this.div,e,i,!1)},JS=function(){if(!d(this,fd))return;const e=this.div;for(const[t,i]of d(this,fd)){const r=e.querySelector(`[data-annotation-id="${t}"]`);if(!r)continue;i.className="annotationContent";const{firstChild:s}=r;s?s.nodeName==="CANVAS"?s.replaceWith(i):s.classList.contains("annotationContent")?s.after(i):s.before(i):r.append(i)}d(this,fd).clear()};const F0=/\r\n?|\n/g;var $s,yr,k_,md,_r,En,D5,M5,O5,Cw,qo,kw,$w,L5,e2,F5;const Ot=class Ot extends en{constructor(t){super({...t,name:"freeTextEditor"});F(this,En);F(this,$s);F(this,yr,"");F(this,k_,`${this.id}-editor`);F(this,md,null);F(this,_r);P(this,$s,t.color||Ot._defaultColor||en._defaultLineColor),P(this,_r,t.fontSize||Ot._defaultFontSize)}static get _keyboardManager(){const t=Ot.prototype,i=a=>a.isEmpty(),r=eh.TRANSLATE_SMALL,s=eh.TRANSLATE_BIG;return st(this,"_keyboardManager",new pv([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:i}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:i}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[r,0],checker:i}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[s,0],checker:i}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:i}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:i}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,r],checker:i}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,s],checker:i}]]))}static initialize(t,i){en.initialize(t,i);const r=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(r.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,i){switch(t){case ht.FREETEXT_SIZE:Ot._defaultFontSize=i;break;case ht.FREETEXT_COLOR:Ot._defaultColor=i;break}}updateParams(t,i){switch(t){case ht.FREETEXT_SIZE:z(this,En,D5).call(this,i);break;case ht.FREETEXT_COLOR:z(this,En,M5).call(this,i);break}}static get defaultPropertiesToUpdate(){return[[ht.FREETEXT_SIZE,Ot._defaultFontSize],[ht.FREETEXT_COLOR,Ot._defaultColor||en._defaultLineColor]]}get propertiesToUpdate(){return[[ht.FREETEXT_SIZE,d(this,_r)],[ht.FREETEXT_COLOR,d(this,$s)]]}_translateEmpty(t,i){this._uiManager.translateSelectedEditors(t,i,!0)}getInitialTranslation(){const t=this.parentScale;return[-Ot._internalPadding*t,-(Ot._internalPadding+d(this,_r))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(Ze.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),P(this,md,new AbortController);const t=this._uiManager.combinedSignal(d(this,md));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){var t;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",d(this,k_)),this._isDraggable=!0,(t=d(this,md))==null||t.abort(),P(this,md,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var i;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(i=this._initialOptions)!=null&&i.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=d(this,yr),i=P(this,yr,z(this,En,O5).call(this).trimEnd());if(t===i)return;const r=s=>{if(P(this,yr,s),!s){this.remove();return}z(this,En,$w).call(this),this._uiManager.rebuild(this),z(this,En,Cw).call(this)};this.addCommands({cmd:()=>{r(i)},undo:()=>{r(t)},mustExec:!1}),z(this,En,Cw).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){Ot._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,i;this.width&&(t=this.x,i=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",d(this,k_)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:r}=this.editorDiv;if(r.fontSize=`calc(${d(this,_r)}px * var(--scale-factor))`,r.color=d(this,$s),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Vb(this,this.div,["dblclick","keydown"]),this.width){const[s,a]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[l,u]=this.getInitialTranslation();[l,u]=this.pageTranslationToScreen(l,u);const[c,h]=this.pageDimensions,[f,m]=this.pageTranslation;let y,_;switch(this.rotation){case 0:y=t+(o[0]-f)/c,_=i+this.height-(o[1]-m)/h;break;case 90:y=t+(o[0]-f)/c,_=i-(o[1]-m)/h,[l,u]=[u,-l];break;case 180:y=t-this.width+(o[0]-f)/c,_=i-(o[1]-m)/h,[l,u]=[-l,-u];break;case 270:y=t+(o[0]-f-this.height*h)/c,_=i+(o[1]-m-this.width*c)/h,[l,u]=[-u,l];break}this.setAt(y*s,_*a,l,u)}else this.setAt(t*s,i*a,this.width*s,this.height*a);z(this,En,$w).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var y,_,x;const i=t.clipboardData||window.clipboardData,{types:r}=i;if(r.length===1&&r[0]==="text/plain")return;t.preventDefault();const s=z(y=Ot,qo,e2).call(y,i.getData("text")||"").replaceAll(F0,`
`);if(!s)return;const a=window.getSelection();if(!a.rangeCount)return;this.editorDiv.normalize(),a.deleteFromDocument();const o=a.getRangeAt(0);if(!s.includes(`
`)){o.insertNode(document.createTextNode(s)),this.editorDiv.normalize(),a.collapseToStart();return}const{startContainer:l,startOffset:u}=o,c=[],h=[];if(l.nodeType===Node.TEXT_NODE){const v=l.parentElement;if(h.push(l.nodeValue.slice(u).replaceAll(F0,"")),v!==this.editorDiv){let w=c;for(const E of this.editorDiv.childNodes){if(E===v){w=h;continue}w.push(z(_=Ot,qo,kw).call(_,E))}}c.push(l.nodeValue.slice(0,u).replaceAll(F0,""))}else if(l===this.editorDiv){let v=c,w=0;for(const E of this.editorDiv.childNodes)w++===u&&(v=h),v.push(z(x=Ot,qo,kw).call(x,E))}P(this,yr,`${c.join(`
`)}${s}${h.join(`
`)}`),z(this,En,$w).call(this);const f=new Range;let m=c.reduce((v,w)=>v+w.length,0);for(const{firstChild:v}of this.editorDiv.childNodes)if(v.nodeType===Node.TEXT_NODE){const w=v.nodeValue.length;if(m<=w){f.setStart(v,m),f.setEnd(v,m);break}m-=w}a.removeAllRanges(),a.addRange(f)}get contentDiv(){return this.editorDiv}static async deserialize(t,i,r){var o;let s=null;if(t instanceof k5){const{data:{defaultAppearanceData:{fontSize:l,fontColor:u},rect:c,rotation:h,id:f,popupRef:m},textContent:y,textPosition:_,parent:{page:{pageNumber:x}}}=t;if(!y||y.length===0)return null;s=t={annotationType:Ze.FREETEXT,color:Array.from(u),fontSize:l,value:y.join(`
`),position:_,pageIndex:x-1,rect:c.slice(0),rotation:h,id:f,deleted:!1,popupRef:m}}const a=await super.deserialize(t,i,r);return P(a,_r,t.fontSize),P(a,$s,Me.makeHexColor(...t.color)),P(a,yr,z(o=Ot,qo,e2).call(o,t.value)),a.annotationElementId=t.id||null,a._initialData=s,a}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i=Ot._internalPadding*this.parentScale,r=this.getRect(i,i),s=en._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:d(this,$s)),a={annotationType:Ze.FREETEXT,color:s,fontSize:d(this,_r),value:z(this,En,L5).call(this),pageIndex:this.pageIndex,rect:r,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?a:this.annotationElementId&&!z(this,En,F5).call(this,a)?null:(a.id=this.annotationElementId,a)}renderAnnotationElement(t){const i=super.renderAnnotationElement(t);if(this.deleted)return i;const{style:r}=i;r.fontSize=`calc(${d(this,_r)}px * var(--scale-factor))`,r.color=d(this,$s),i.replaceChildren();for(const a of d(this,yr).split(`
`)){const o=document.createElement("div");o.append(a?document.createTextNode(a):document.createElement("br")),i.append(o)}const s=Ot._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(s,s),popupContent:d(this,yr)}),i}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};$s=new WeakMap,yr=new WeakMap,k_=new WeakMap,md=new WeakMap,_r=new WeakMap,En=new WeakSet,D5=function(t){const i=s=>{this.editorDiv.style.fontSize=`calc(${s}px * var(--scale-factor))`,this.translate(0,-(s-d(this,_r))*this.parentScale),P(this,_r,s),z(this,En,Cw).call(this)},r=d(this,_r);this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ht.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},M5=function(t){const i=s=>{P(this,$s,this.editorDiv.style.color=s)},r=d(this,$s);this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ht.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},O5=function(){var r;const t=[];this.editorDiv.normalize();let i=null;for(const s of this.editorDiv.childNodes)(i==null?void 0:i.nodeType)===Node.TEXT_NODE&&s.nodeName==="BR"||(t.push(z(r=Ot,qo,kw).call(r,s)),i=s);return t.join(`
`)},Cw=function(){const[t,i]=this.parentDimensions;let r;if(this.isAttachedToDOM)r=this.div.getBoundingClientRect();else{const{currentLayer:s,div:a}=this,o=a.style.display,l=a.classList.contains("hidden");a.classList.remove("hidden"),a.style.display="hidden",s.div.append(this.div),r=a.getBoundingClientRect(),a.remove(),a.style.display=o,a.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=r.width/t,this.height=r.height/i):(this.width=r.height/t,this.height=r.width/i),this.fixAndSetPosition()},qo=new WeakSet,kw=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(F0,"")},$w=function(){if(this.editorDiv.replaceChildren(),!!d(this,yr))for(const t of d(this,yr).split(`
`)){const i=document.createElement("div");i.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(i)}},L5=function(){return d(this,yr).replaceAll(""," ")},e2=function(t){return t.replaceAll(" ","")},F5=function(t){const{value:i,fontSize:r,color:s,pageIndex:a}=this._initialData;return this._hasBeenMoved||t.value!==i||t.fontSize!==r||t.color.some((o,l)=>o!==s[l])||t.pageIndex!==a},F(Ot,qo),ze(Ot,"_freeTextDefaultContent",""),ze(Ot,"_internalPadding",0),ze(Ot,"_defaultColor",null),ze(Ot,"_defaultFontSize",10),ze(Ot,"_type","freetext"),ze(Ot,"_editorType",Ze.FREETEXT);let ZS=Ot;class Ce{toSVGPath(){Dt("Abstract method `toSVGPath` must be implemented.")}get box(){Dt("Abstract getter `box` must be implemented.")}serialize(e,t){Dt("Abstract method `serialize` must be implemented.")}static _rescale(e,t,i,r,s,a){a||(a=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)a[o]=t+e[o]*r,a[o+1]=i+e[o+1]*s;return a}static _rescaleAndSwap(e,t,i,r,s,a){a||(a=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)a[o]=t+e[o+1]*r,a[o+1]=i+e[o]*s;return a}static _translate(e,t,i,r){r||(r=new Float32Array(e.length));for(let s=0,a=e.length;s<a;s+=2)r[s]=t+e[s],r[s+1]=i+e[s+1];return r}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,i,r,s){switch(s){case 90:return[1-t/i,e/r];case 180:return[1-e/i,1-t/r];case 270:return[t/i,1-e/r];default:return[e/i,t/r]}}static _normalizePagePoint(e,t,i){switch(i){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,i,r,s,a){return[(e+5*i)/6,(t+5*r)/6,(5*i+s)/6,(5*r+a)/6,(i+s)/2,(r+a)/2]}}ze(Ce,"PRECISION",1e-4);var vr,Rs,np,ip,Ta,rt,gd,yd,$_,R_,rp,sp,Xl,P_,l1,u1,$n,wg,z5,V5,j5,B5,U5,H5;const oo=class oo{constructor({x:e,y:t},i,r,s,a,o=0){F(this,$n);F(this,vr);F(this,Rs,[]);F(this,np);F(this,ip);F(this,Ta,[]);F(this,rt,new Float32Array(18));F(this,gd);F(this,yd);F(this,$_);F(this,R_);F(this,rp);F(this,sp);F(this,Xl,[]);P(this,vr,i),P(this,sp,s*r),P(this,ip,a),d(this,rt).set([NaN,NaN,NaN,NaN,e,t],6),P(this,np,o),P(this,R_,d(oo,P_)*r),P(this,$_,d(oo,u1)*r),P(this,rp,r),d(this,Xl).push(e,t)}isEmpty(){return isNaN(d(this,rt)[8])}add({x:e,y:t}){var N;P(this,gd,e),P(this,yd,t);const[i,r,s,a]=d(this,vr);let[o,l,u,c]=d(this,rt).subarray(8,12);const h=e-u,f=t-c,m=Math.hypot(h,f);if(m<d(this,$_))return!1;const y=m-d(this,R_),_=y/m,x=_*h,v=_*f;let w=o,E=l;o=u,l=c,u+=x,c+=v,(N=d(this,Xl))==null||N.push(e,t);const k=-v/y,$=x/y,L=k*d(this,sp),I=$*d(this,sp);return d(this,rt).set(d(this,rt).subarray(2,8),0),d(this,rt).set([u+L,c+I],4),d(this,rt).set(d(this,rt).subarray(14,18),12),d(this,rt).set([u-L,c-I],16),isNaN(d(this,rt)[6])?(d(this,Ta).length===0&&(d(this,rt).set([o+L,l+I],2),d(this,Ta).push(NaN,NaN,NaN,NaN,(o+L-i)/s,(l+I-r)/a),d(this,rt).set([o-L,l-I],14),d(this,Rs).push(NaN,NaN,NaN,NaN,(o-L-i)/s,(l-I-r)/a)),d(this,rt).set([w,E,o,l,u,c],6),!this.isEmpty()):(d(this,rt).set([w,E,o,l,u,c],6),Math.abs(Math.atan2(E-l,w-o)-Math.atan2(v,x))<Math.PI/2?([o,l,u,c]=d(this,rt).subarray(2,6),d(this,Ta).push(NaN,NaN,NaN,NaN,((o+u)/2-i)/s,((l+c)/2-r)/a),[o,l,w,E]=d(this,rt).subarray(14,18),d(this,Rs).push(NaN,NaN,NaN,NaN,((w+o)/2-i)/s,((E+l)/2-r)/a),!0):([w,E,o,l,u,c]=d(this,rt).subarray(0,6),d(this,Ta).push(((w+5*o)/6-i)/s,((E+5*l)/6-r)/a,((5*o+u)/6-i)/s,((5*l+c)/6-r)/a,((o+u)/2-i)/s,((l+c)/2-r)/a),[u,c,o,l,w,E]=d(this,rt).subarray(12,18),d(this,Rs).push(((w+5*o)/6-i)/s,((E+5*l)/6-r)/a,((5*o+u)/6-i)/s,((5*l+c)/6-r)/a,((o+u)/2-i)/s,((l+c)/2-r)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const e=d(this,Ta),t=d(this,Rs);if(isNaN(d(this,rt)[6])&&!this.isEmpty())return z(this,$n,z5).call(this);const i=[];i.push(`M${e[4]} ${e[5]}`);for(let r=6;r<e.length;r+=6)isNaN(e[r])?i.push(`L${e[r+4]} ${e[r+5]}`):i.push(`C${e[r]} ${e[r+1]} ${e[r+2]} ${e[r+3]} ${e[r+4]} ${e[r+5]}`);z(this,$n,j5).call(this,i);for(let r=t.length-6;r>=6;r-=6)isNaN(t[r])?i.push(`L${t[r+4]} ${t[r+5]}`):i.push(`C${t[r]} ${t[r+1]} ${t[r+2]} ${t[r+3]} ${t[r+4]} ${t[r+5]}`);return z(this,$n,V5).call(this,i),i.join(" ")}newFreeDrawOutline(e,t,i,r,s,a){return new W5(e,t,i,r,s,a)}getOutlines(){var h;const e=d(this,Ta),t=d(this,Rs),i=d(this,rt),[r,s,a,o]=d(this,vr),l=new Float32Array((((h=d(this,Xl))==null?void 0:h.length)??0)+2);for(let f=0,m=l.length-2;f<m;f+=2)l[f]=(d(this,Xl)[f]-r)/a,l[f+1]=(d(this,Xl)[f+1]-s)/o;if(l[l.length-2]=(d(this,gd)-r)/a,l[l.length-1]=(d(this,yd)-s)/o,isNaN(i[6])&&!this.isEmpty())return z(this,$n,B5).call(this,l);const u=new Float32Array(d(this,Ta).length+24+d(this,Rs).length);let c=e.length;for(let f=0;f<c;f+=2){if(isNaN(e[f])){u[f]=u[f+1]=NaN;continue}u[f]=e[f],u[f+1]=e[f+1]}c=z(this,$n,H5).call(this,u,c);for(let f=t.length-6;f>=6;f-=6)for(let m=0;m<6;m+=2){if(isNaN(t[f+m])){u[c]=u[c+1]=NaN,c+=2;continue}u[c]=t[f+m],u[c+1]=t[f+m+1],c+=2}return z(this,$n,U5).call(this,u,c),this.newFreeDrawOutline(u,l,d(this,vr),d(this,rp),d(this,np),d(this,ip))}};vr=new WeakMap,Rs=new WeakMap,np=new WeakMap,ip=new WeakMap,Ta=new WeakMap,rt=new WeakMap,gd=new WeakMap,yd=new WeakMap,$_=new WeakMap,R_=new WeakMap,rp=new WeakMap,sp=new WeakMap,Xl=new WeakMap,P_=new WeakMap,l1=new WeakMap,u1=new WeakMap,$n=new WeakSet,wg=function(){const e=d(this,rt).subarray(4,6),t=d(this,rt).subarray(16,18),[i,r,s,a]=d(this,vr);return[(d(this,gd)+(e[0]-t[0])/2-i)/s,(d(this,yd)+(e[1]-t[1])/2-r)/a,(d(this,gd)+(t[0]-e[0])/2-i)/s,(d(this,yd)+(t[1]-e[1])/2-r)/a]},z5=function(){const[e,t,i,r]=d(this,vr),[s,a,o,l]=z(this,$n,wg).call(this);return`M${(d(this,rt)[2]-e)/i} ${(d(this,rt)[3]-t)/r} L${(d(this,rt)[4]-e)/i} ${(d(this,rt)[5]-t)/r} L${s} ${a} L${o} ${l} L${(d(this,rt)[16]-e)/i} ${(d(this,rt)[17]-t)/r} L${(d(this,rt)[14]-e)/i} ${(d(this,rt)[15]-t)/r} Z`},V5=function(e){const t=d(this,Rs);e.push(`L${t[4]} ${t[5]} Z`)},j5=function(e){const[t,i,r,s]=d(this,vr),a=d(this,rt).subarray(4,6),o=d(this,rt).subarray(16,18),[l,u,c,h]=z(this,$n,wg).call(this);e.push(`L${(a[0]-t)/r} ${(a[1]-i)/s} L${l} ${u} L${c} ${h} L${(o[0]-t)/r} ${(o[1]-i)/s}`)},B5=function(e){const t=d(this,rt),[i,r,s,a]=d(this,vr),[o,l,u,c]=z(this,$n,wg).call(this),h=new Float32Array(36);return h.set([NaN,NaN,NaN,NaN,(t[2]-i)/s,(t[3]-r)/a,NaN,NaN,NaN,NaN,(t[4]-i)/s,(t[5]-r)/a,NaN,NaN,NaN,NaN,o,l,NaN,NaN,NaN,NaN,u,c,NaN,NaN,NaN,NaN,(t[16]-i)/s,(t[17]-r)/a,NaN,NaN,NaN,NaN,(t[14]-i)/s,(t[15]-r)/a],0),this.newFreeDrawOutline(h,e,d(this,vr),d(this,rp),d(this,np),d(this,ip))},U5=function(e,t){const i=d(this,Rs);return e.set([NaN,NaN,NaN,NaN,i[4],i[5]],t),t+=6},H5=function(e,t){const i=d(this,rt).subarray(4,6),r=d(this,rt).subarray(16,18),[s,a,o,l]=d(this,vr),[u,c,h,f]=z(this,$n,wg).call(this);return e.set([NaN,NaN,NaN,NaN,(i[0]-s)/o,(i[1]-a)/l,NaN,NaN,NaN,NaN,u,c,NaN,NaN,NaN,NaN,h,f,NaN,NaN,NaN,NaN,(r[0]-s)/o,(r[1]-a)/l],t),t+=24},F(oo,P_,8),F(oo,l1,2),F(oo,u1,d(oo,P_)+d(oo,l1));let Ub=oo;var ap,_d,Co,N_,wr,D_,dn,c1,q5;class W5 extends Ce{constructor(t,i,r,s,a,o){super();F(this,c1);F(this,ap);F(this,_d,new Float32Array(4));F(this,Co);F(this,N_);F(this,wr);F(this,D_);F(this,dn);P(this,dn,t),P(this,wr,i),P(this,ap,r),P(this,D_,s),P(this,Co,a),P(this,N_,o),this.lastPoint=[NaN,NaN],z(this,c1,q5).call(this,o);const[l,u,c,h]=d(this,_d);for(let f=0,m=t.length;f<m;f+=2)t[f]=(t[f]-l)/c,t[f+1]=(t[f+1]-u)/h;for(let f=0,m=i.length;f<m;f+=2)i[f]=(i[f]-l)/c,i[f+1]=(i[f+1]-u)/h}toSVGPath(){const t=[`M${d(this,dn)[4]} ${d(this,dn)[5]}`];for(let i=6,r=d(this,dn).length;i<r;i+=6){if(isNaN(d(this,dn)[i])){t.push(`L${d(this,dn)[i+4]} ${d(this,dn)[i+5]}`);continue}t.push(`C${d(this,dn)[i]} ${d(this,dn)[i+1]} ${d(this,dn)[i+2]} ${d(this,dn)[i+3]} ${d(this,dn)[i+4]} ${d(this,dn)[i+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,i,r,s],a){const o=r-t,l=s-i;let u,c;switch(a){case 0:u=Ce._rescale(d(this,dn),t,s,o,-l),c=Ce._rescale(d(this,wr),t,s,o,-l);break;case 90:u=Ce._rescaleAndSwap(d(this,dn),t,i,o,l),c=Ce._rescaleAndSwap(d(this,wr),t,i,o,l);break;case 180:u=Ce._rescale(d(this,dn),r,i,-o,l),c=Ce._rescale(d(this,wr),r,i,-o,l);break;case 270:u=Ce._rescaleAndSwap(d(this,dn),r,s,-o,-l),c=Ce._rescaleAndSwap(d(this,wr),r,s,-o,-l);break}return{outline:Array.from(u),points:[Array.from(c)]}}get box(){return d(this,_d)}newOutliner(t,i,r,s,a,o=0){return new Ub(t,i,r,s,a,o)}getNewOutline(t,i){const[r,s,a,o]=d(this,_d),[l,u,c,h]=d(this,ap),f=a*c,m=o*h,y=r*c+l,_=s*h+u,x=this.newOutliner({x:d(this,wr)[0]*f+y,y:d(this,wr)[1]*m+_},d(this,ap),d(this,D_),t,d(this,N_),i??d(this,Co));for(let v=2;v<d(this,wr).length;v+=2)x.add({x:d(this,wr)[v]*f+y,y:d(this,wr)[v+1]*m+_});return x.getOutlines()}}ap=new WeakMap,_d=new WeakMap,Co=new WeakMap,N_=new WeakMap,wr=new WeakMap,D_=new WeakMap,dn=new WeakMap,c1=new WeakSet,q5=function(t){const i=d(this,dn);let r=i[4],s=i[5],a=r,o=s,l=r,u=s,c=r,h=s;const f=t?Math.max:Math.min;for(let y=6,_=i.length;y<_;y+=6){if(isNaN(i[y]))a=Math.min(a,i[y+4]),o=Math.min(o,i[y+5]),l=Math.max(l,i[y+4]),u=Math.max(u,i[y+5]),h<i[y+5]?(c=i[y+4],h=i[y+5]):h===i[y+5]&&(c=f(c,i[y+4]));else{const x=Me.bezierBoundingBox(r,s,...i.slice(y,y+6));a=Math.min(a,x[0]),o=Math.min(o,x[1]),l=Math.max(l,x[2]),u=Math.max(u,x[3]),h<x[3]?(c=x[2],h=x[3]):h===x[3]&&(c=f(c,x[2]))}r=i[y+4],s=i[y+5]}const m=d(this,_d);m[0]=a-d(this,Co),m[1]=o-d(this,Co),m[2]=l-a+2*d(this,Co),m[3]=u-o+2*d(this,Co),this.lastPoint=[c,h]};var M_,O_,Ql,Ps,Fi,G5,Rw,K5,Y5,n2;class t2{constructor(e,t=0,i=0,r=!0){F(this,Fi);F(this,M_);F(this,O_);F(this,Ql,[]);F(this,Ps,[]);let s=1/0,a=-1/0,o=1/0,l=-1/0;const u=10**-4;for(const{x,y:v,width:w,height:E}of e){const k=Math.floor((x-t)/u)*u,$=Math.ceil((x+w+t)/u)*u,L=Math.floor((v-t)/u)*u,I=Math.ceil((v+E+t)/u)*u,C=[k,L,I,!0],N=[$,L,I,!1];d(this,Ql).push(C,N),s=Math.min(s,k),a=Math.max(a,$),o=Math.min(o,L),l=Math.max(l,I)}const c=a-s+2*i,h=l-o+2*i,f=s-i,m=o-i,y=d(this,Ql).at(r?-1:-2),_=[y[0],y[2]];for(const x of d(this,Ql)){const[v,w,E]=x;x[0]=(v-f)/c,x[1]=(w-m)/h,x[2]=(E-m)/h}P(this,M_,new Float32Array([f,m,c,h])),P(this,O_,_)}getOutlines(){d(this,Ql).sort((t,i)=>t[0]-i[0]||t[1]-i[1]||t[2]-i[2]);const e=[];for(const t of d(this,Ql))t[3]?(e.push(...z(this,Fi,n2).call(this,t)),z(this,Fi,K5).call(this,t)):(z(this,Fi,Y5).call(this,t),e.push(...z(this,Fi,n2).call(this,t)));return z(this,Fi,G5).call(this,e)}}M_=new WeakMap,O_=new WeakMap,Ql=new WeakMap,Ps=new WeakMap,Fi=new WeakSet,G5=function(e){const t=[],i=new Set;for(const a of e){const[o,l,u]=a;t.push([o,l,a],[o,u,a])}t.sort((a,o)=>a[1]-o[1]||a[0]-o[0]);for(let a=0,o=t.length;a<o;a+=2){const l=t[a][2],u=t[a+1][2];l.push(u),u.push(l),i.add(l),i.add(u)}const r=[];let s;for(;i.size>0;){const a=i.values().next().value;let[o,l,u,c,h]=a;i.delete(a);let f=o,m=l;for(s=[o,u],r.push(s);;){let y;if(i.has(c))y=c;else if(i.has(h))y=h;else break;i.delete(y),[o,l,u,c,h]=y,f!==o&&(s.push(f,m,o,m===l?l:u),f=o),m=m===l?u:l}s.push(f,m)}return new Ote(r,d(this,M_),d(this,O_))},Rw=function(e){const t=d(this,Ps);let i=0,r=t.length-1;for(;i<=r;){const s=i+r>>1,a=t[s][0];if(a===e)return s;a<e?i=s+1:r=s-1}return r+1},K5=function([,e,t]){const i=z(this,Fi,Rw).call(this,e);d(this,Ps).splice(i,0,[e,t])},Y5=function([,e,t]){const i=z(this,Fi,Rw).call(this,e);for(let r=i;r<d(this,Ps).length;r++){const[s,a]=d(this,Ps)[r];if(s!==e)break;if(s===e&&a===t){d(this,Ps).splice(r,1);return}}for(let r=i-1;r>=0;r--){const[s,a]=d(this,Ps)[r];if(s!==e)break;if(s===e&&a===t){d(this,Ps).splice(r,1);return}}},n2=function(e){const[t,i,r]=e,s=[[t,i,r]],a=z(this,Fi,Rw).call(this,r);for(let o=0;o<a;o++){const[l,u]=d(this,Ps)[o];for(let c=0,h=s.length;c<h;c++){const[,f,m]=s[c];if(!(u<=f||m<=l)){if(f>=l){if(m>u)s[c][1]=u;else{if(h===1)return[];s.splice(c,1),c--,h--}continue}s[c][2]=l,m>u&&s.push([t,u,m])}}}return s};var L_,op;class Ote extends Ce{constructor(t,i,r){super();F(this,L_);F(this,op);P(this,op,t),P(this,L_,i),this.lastPoint=r}toSVGPath(){const t=[];for(const i of d(this,op)){let[r,s]=i;t.push(`M${r} ${s}`);for(let a=2;a<i.length;a+=2){const o=i[a],l=i[a+1];o===r?(t.push(`V${l}`),s=l):l===s&&(t.push(`H${o}`),r=o)}t.push("Z")}return t.join(" ")}serialize([t,i,r,s],a){const o=[],l=r-t,u=s-i;for(const c of d(this,op)){const h=new Array(c.length);for(let f=0;f<c.length;f+=2)h[f]=t+c[f]*l,h[f+1]=s-c[f+1]*u;o.push(h)}return o}get box(){return d(this,L_)}get classNamesForOutlining(){return["highlightOutline"]}}L_=new WeakMap,op=new WeakMap;class i2 extends Ub{newFreeDrawOutline(e,t,i,r,s,a){return new Lte(e,t,i,r,s,a)}}class Lte extends W5{newOutliner(e,t,i,r,s,a=0){return new i2(e,t,i,r,s,a)}}var Ns,vd,lp,In,F_,up,z_,V_,Jl,Ds,cp,j_,kt,r2,s2,a2,_c,X5,bl;const Yi=class Yi{constructor({editor:e=null,uiManager:t=null}){F(this,kt);F(this,Ns,null);F(this,vd,null);F(this,lp);F(this,In,null);F(this,F_,!1);F(this,up,!1);F(this,z_,null);F(this,V_);F(this,Jl,null);F(this,Ds,null);F(this,cp);var i;e?(P(this,up,!1),P(this,cp,ht.HIGHLIGHT_COLOR),P(this,z_,e)):(P(this,up,!0),P(this,cp,ht.HIGHLIGHT_DEFAULT_COLOR)),P(this,Ds,(e==null?void 0:e._uiManager)||t),P(this,V_,d(this,Ds)._eventBus),P(this,lp,(e==null?void 0:e.color)||((i=d(this,Ds))==null?void 0:i.highlightColors.values().next().value)||"#FFFF98"),d(Yi,j_)||P(Yi,j_,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return st(this,"_keyboardManager",new pv([[["Escape","mac+Escape"],Yi.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Yi.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Yi.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Yi.prototype._moveToPrevious],[["Home","mac+Home"],Yi.prototype._moveToBeginning],[["End","mac+End"],Yi.prototype._moveToEnd]]))}renderButton(){const e=P(this,Ns,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);const t=d(this,Ds)._signal;e.addEventListener("click",z(this,kt,_c).bind(this),{signal:t}),e.addEventListener("keydown",z(this,kt,a2).bind(this),{signal:t});const i=P(this,vd,document.createElement("span"));return i.className="swatch",i.setAttribute("aria-hidden",!0),i.style.backgroundColor=d(this,lp),e.append(i),e}renderMainDropdown(){const e=P(this,In,z(this,kt,r2).call(this));return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}_colorSelectFromKeyboard(e){if(e.target===d(this,Ns)){z(this,kt,_c).call(this,e);return}const t=e.target.getAttribute("data-color");t&&z(this,kt,s2).call(this,t,e)}_moveToNext(e){var t,i;if(!d(this,kt,bl)){z(this,kt,_c).call(this,e);return}if(e.target===d(this,Ns)){(t=d(this,In).firstChild)==null||t.focus();return}(i=e.target.nextSibling)==null||i.focus()}_moveToPrevious(e){var t,i;if(e.target===((t=d(this,In))==null?void 0:t.firstChild)||e.target===d(this,Ns)){d(this,kt,bl)&&this._hideDropdownFromKeyboard();return}d(this,kt,bl)||z(this,kt,_c).call(this,e),(i=e.target.previousSibling)==null||i.focus()}_moveToBeginning(e){var t;if(!d(this,kt,bl)){z(this,kt,_c).call(this,e);return}(t=d(this,In).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!d(this,kt,bl)){z(this,kt,_c).call(this,e);return}(t=d(this,In).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=d(this,In))==null||e.classList.add("hidden"),(t=d(this,Jl))==null||t.abort(),P(this,Jl,null)}_hideDropdownFromKeyboard(){var e;if(!d(this,up)){if(!d(this,kt,bl)){(e=d(this,z_))==null||e.unselect();return}this.hideDropdown(),d(this,Ns).focus({preventScroll:!0,focusVisible:d(this,F_)})}}updateColor(e){if(d(this,vd)&&(d(this,vd).style.backgroundColor=e),!d(this,In))return;const t=d(this,Ds).highlightColors.values();for(const i of d(this,In).children)i.setAttribute("aria-selected",t.next().value===e)}destroy(){var e,t;(e=d(this,Ns))==null||e.remove(),P(this,Ns,null),P(this,vd,null),(t=d(this,In))==null||t.remove(),P(this,In,null)}};Ns=new WeakMap,vd=new WeakMap,lp=new WeakMap,In=new WeakMap,F_=new WeakMap,up=new WeakMap,z_=new WeakMap,V_=new WeakMap,Jl=new WeakMap,Ds=new WeakMap,cp=new WeakMap,j_=new WeakMap,kt=new WeakSet,r2=function(){const e=document.createElement("div"),t=d(this,Ds)._signal;e.addEventListener("contextmenu",Js,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[i,r]of d(this,Ds).highlightColors){const s=document.createElement("button");s.tabIndex="0",s.role="option",s.setAttribute("data-color",r),s.title=i,s.setAttribute("data-l10n-id",d(Yi,j_)[i]);const a=document.createElement("span");s.append(a),a.className="swatch",a.style.backgroundColor=r,s.setAttribute("aria-selected",r===d(this,lp)),s.addEventListener("click",z(this,kt,s2).bind(this,r),{signal:t}),e.append(s)}return e.addEventListener("keydown",z(this,kt,a2).bind(this),{signal:t}),e},s2=function(e,t){t.stopPropagation(),d(this,V_).dispatch("switchannotationeditorparams",{source:this,type:d(this,cp),value:e})},a2=function(e){Yi._keyboardManager.exec(this,e)},_c=function(e){if(d(this,kt,bl)){this.hideDropdown();return}if(P(this,F_,e.detail===0),d(this,Jl)||(P(this,Jl,new AbortController),window.addEventListener("pointerdown",z(this,kt,X5).bind(this),{signal:d(this,Ds).combinedSignal(d(this,Jl))})),d(this,In)){d(this,In).classList.remove("hidden");return}const t=P(this,In,z(this,kt,r2).call(this));d(this,Ns).append(t)},X5=function(e){var t;(t=d(this,In))!=null&&t.contains(e.target)||this.hideDropdown()},bl=function(){return d(this,In)&&!d(this,In).classList.contains("hidden")},F(Yi,j_,null);let Hb=Yi;var dp,B_,ko,wd,hp,Ji,U_,H_,bd,Gr,br,Jn,fp,$o,mi,pp,Kr,W_,Je,o2,Pw,Q5,J5,Z5,l2,vc,es,zh,e6,Nw,bg,t6,n6,i6,r6,s6;const wt=class wt extends en{constructor(t){super({...t,name:"highlightEditor"});F(this,Je);F(this,dp,null);F(this,B_,0);F(this,ko);F(this,wd,null);F(this,hp,null);F(this,Ji,null);F(this,U_,null);F(this,H_,0);F(this,bd,null);F(this,Gr,null);F(this,br,null);F(this,Jn,!1);F(this,fp,null);F(this,$o);F(this,mi,null);F(this,pp,"");F(this,Kr);F(this,W_,"");this.color=t.color||wt._defaultColor,P(this,Kr,t.thickness||wt._defaultThickness),P(this,$o,t.opacity||wt._defaultOpacity),P(this,ko,t.boxes||null),P(this,W_,t.methodOfCreation||""),P(this,pp,t.text||""),this._isDraggable=!1,t.highlightId>-1?(P(this,Jn,!0),z(this,Je,Pw).call(this,t),z(this,Je,vc).call(this)):d(this,ko)&&(P(this,dp,t.anchorNode),P(this,B_,t.anchorOffset),P(this,U_,t.focusNode),P(this,H_,t.focusOffset),z(this,Je,o2).call(this),z(this,Je,vc).call(this),this.rotate(this.rotation))}static get _keyboardManager(){const t=wt.prototype;return st(this,"_keyboardManager",new pv([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:d(this,Jn)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:d(this,Kr),methodOfCreation:d(this,W_)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,i){var r;en.initialize(t,i),wt._defaultColor||(wt._defaultColor=((r=i.highlightColors)==null?void 0:r.values().next().value)||"#fff066")}static updateDefaultParams(t,i){switch(t){case ht.HIGHLIGHT_DEFAULT_COLOR:wt._defaultColor=i;break;case ht.HIGHLIGHT_THICKNESS:wt._defaultThickness=i;break}}translateInPage(t,i){}get toolbarPosition(){return d(this,fp)}updateParams(t,i){switch(t){case ht.HIGHLIGHT_COLOR:z(this,Je,Q5).call(this,i);break;case ht.HIGHLIGHT_THICKNESS:z(this,Je,J5).call(this,i);break}}static get defaultPropertiesToUpdate(){return[[ht.HIGHLIGHT_DEFAULT_COLOR,wt._defaultColor],[ht.HIGHLIGHT_THICKNESS,wt._defaultThickness]]}get propertiesToUpdate(){return[[ht.HIGHLIGHT_COLOR,this.color||wt._defaultColor],[ht.HIGHLIGHT_THICKNESS,d(this,Kr)||wt._defaultThickness],[ht.HIGHLIGHT_FREE,d(this,Jn)]]}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(P(this,hp,new Hb({editor:this})),t.addColorPicker(d(this,hp))),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(z(this,Je,bg).call(this))}getBaseTranslation(){return[0,0]}getRect(t,i){return super.getRect(t,i,z(this,Je,bg).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){z(this,Je,l2).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(z(this,Je,vc).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var r;let i=!1;this.parent&&!t?z(this,Je,l2).call(this):t&&(z(this,Je,vc).call(this,t),i=!this.parent&&((r=this.div)==null?void 0:r.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),i&&this.select()}rotate(t){var s,a,o;const{drawLayer:i}=this.parent;let r;d(this,Jn)?(t=(t-this.rotation+360)%360,r=z(s=wt,es,zh).call(s,d(this,Gr).box,t)):r=z(a=wt,es,zh).call(a,[this.x,this.y,this.width,this.height],t),i.updateProperties(d(this,br),{bbox:r,root:{"data-main-rotation":t}}),i.updateProperties(d(this,mi),{bbox:z(o=wt,es,zh).call(o,d(this,Ji).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();d(this,pp)&&(t.setAttribute("aria-label",d(this,pp)),t.setAttribute("role","mark")),d(this,Jn)?t.classList.add("free"):this.div.addEventListener("keydown",z(this,Je,e6).bind(this),{signal:this._uiManager._signal});const i=P(this,bd,document.createElement("div"));t.append(i),i.setAttribute("aria-hidden","true"),i.className="internal",i.style.clipPath=d(this,wd);const[r,s]=this.parentDimensions;return this.setDims(this.width*r,this.height*s),Vb(this,d(this,bd),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(d(this,mi),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(d(this,mi),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:z(this,Je,Nw).call(this,!0);break;case 1:case 3:z(this,Je,Nw).call(this,!1);break}}select(){var t;super.select(),d(this,mi)&&((t=this.parent)==null||t.drawLayer.updateProperties(d(this,mi),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),d(this,mi)&&((t=this.parent)==null||t.drawLayer.updateProperties(d(this,mi),{rootClass:{selected:!1}}),d(this,Jn)||z(this,Je,Nw).call(this,!1))}get _mustFixPosition(){return!d(this,Jn)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(d(this,br),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(d(this,mi),{rootClass:{hidden:!t}}))}static startHighlighting(t,i,{target:r,x:s,y:a}){const{x:o,y:l,width:u,height:c}=r.getBoundingClientRect(),h=new AbortController,f=t.combinedSignal(h),m=y=>{h.abort(),z(this,es,r6).call(this,t,y)};window.addEventListener("blur",m,{signal:f}),window.addEventListener("pointerup",m,{signal:f}),window.addEventListener("pointerdown",Rr,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",Js,{signal:f}),r.addEventListener("pointermove",z(this,es,i6).bind(this,t),{signal:f}),this._freeHighlight=new i2({x:s,y:a},[o,l,u,c],t.scale,this._defaultThickness/2,i,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,i,r){var _,x,v,w;let s=null;if(t instanceof R5){const{data:{quadPoints:E,rect:k,rotation:$,id:L,color:I,opacity:C,popupRef:N},parent:{page:{pageNumber:O}}}=t;s=t={annotationType:Ze.HIGHLIGHT,color:Array.from(I),opacity:C,quadPoints:E,boxes:null,pageIndex:O-1,rect:k.slice(0),rotation:$,id:L,deleted:!1,popupRef:N}}else if(t instanceof GC){const{data:{inkLists:E,rect:k,rotation:$,id:L,color:I,borderStyle:{rawWidth:C},popupRef:N},parent:{page:{pageNumber:O}}}=t;s=t={annotationType:Ze.HIGHLIGHT,color:Array.from(I),thickness:C,inkLists:E,boxes:null,pageIndex:O-1,rect:k.slice(0),rotation:$,id:L,deleted:!1,popupRef:N}}const{color:a,quadPoints:o,inkLists:l,opacity:u}=t,c=await super.deserialize(t,i,r);c.color=Me.makeHexColor(...a),P(c,$o,u||1),l&&P(c,Kr,t.thickness),c.annotationElementId=t.id||null,c._initialData=s;const[h,f]=c.pageDimensions,[m,y]=c.pageTranslation;if(o){const E=P(c,ko,[]);for(let k=0;k<o.length;k+=8)E.push({x:(o[k]-m)/h,y:1-(o[k+1]-y)/f,width:(o[k+2]-o[k])/h,height:(o[k+1]-o[k+5])/f});z(_=c,Je,o2).call(_),z(x=c,Je,vc).call(x),c.rotate(c.rotation)}else if(l){P(c,Jn,!0);const E=l[0],k={x:E[0]-m,y:f-(E[1]-y)},$=new i2(k,[0,0,h,f],1,d(c,Kr)/2,!0,.001);for(let C=0,N=E.length;C<N;C+=2)k.x=E[C]-m,k.y=f-(E[C+1]-y),$.add(k);const{id:L,clipPathId:I}=i.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:c.color,"fill-opacity":c._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:$.toSVGPath()}},!0,!0);z(v=c,Je,Pw).call(v,{highlightOutlines:$.getOutlines(),highlightId:L,clipPathId:I}),z(w=c,Je,vc).call(w)}return c}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const i=this.getRect(0,0),r=en._colorManager.convert(this.color),s={annotationType:Ze.HIGHLIGHT,color:r,opacity:d(this,$o),thickness:d(this,Kr),quadPoints:z(this,Je,t6).call(this),outlines:z(this,Je,n6).call(this,i),pageIndex:this.pageIndex,rect:i,rotation:z(this,Je,bg).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!z(this,Je,s6).call(this,s)?null:(s.id=this.annotationElementId,s)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};dp=new WeakMap,B_=new WeakMap,ko=new WeakMap,wd=new WeakMap,hp=new WeakMap,Ji=new WeakMap,U_=new WeakMap,H_=new WeakMap,bd=new WeakMap,Gr=new WeakMap,br=new WeakMap,Jn=new WeakMap,fp=new WeakMap,$o=new WeakMap,mi=new WeakMap,pp=new WeakMap,Kr=new WeakMap,W_=new WeakMap,Je=new WeakSet,o2=function(){const t=new t2(d(this,ko),.001);P(this,Gr,t.getOutlines()),[this.x,this.y,this.width,this.height]=d(this,Gr).box;const i=new t2(d(this,ko),.0025,.001,this._uiManager.direction==="ltr");P(this,Ji,i.getOutlines());const{lastPoint:r}=d(this,Ji);P(this,fp,[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height])},Pw=function({highlightOutlines:t,highlightId:i,clipPathId:r}){var h,f;if(P(this,Gr,t),P(this,Ji,t.getNewOutline(d(this,Kr)/2+1.5,.0025)),i>=0)P(this,br,i),P(this,wd,r),this.parent.drawLayer.finalizeDraw(i,{bbox:t.box,path:{d:t.toSVGPath()}}),P(this,mi,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:d(this,Ji).box,path:{d:d(this,Ji).toSVGPath()}},!0));else if(this.parent){const m=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(d(this,br),{bbox:z(h=wt,es,zh).call(h,d(this,Gr).box,(m-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(d(this,mi),{bbox:z(f=wt,es,zh).call(f,d(this,Ji).box,m),path:{d:d(this,Ji).toSVGPath()}})}const[a,o,l,u]=t.box;switch(this.rotation){case 0:this.x=a,this.y=o,this.width=l,this.height=u;break;case 90:{const[m,y]=this.parentDimensions;this.x=o,this.y=1-a,this.width=l*y/m,this.height=u*m/y;break}case 180:this.x=1-a,this.y=1-o,this.width=l,this.height=u;break;case 270:{const[m,y]=this.parentDimensions;this.x=1-o,this.y=a,this.width=l*y/m,this.height=u*m/y;break}}const{lastPoint:c}=d(this,Ji);P(this,fp,[(c[0]-a)/l,(c[1]-o)/u])},Q5=function(t){const i=(a,o)=>{var l,u;this.color=a,P(this,$o,o),(l=this.parent)==null||l.drawLayer.updateProperties(d(this,br),{root:{fill:a,"fill-opacity":o}}),(u=d(this,hp))==null||u.updateColor(a)},r=this.color,s=d(this,$o);this.addCommands({cmd:i.bind(this,t,wt._defaultOpacity),undo:i.bind(this,r,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ht.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},J5=function(t){const i=d(this,Kr),r=s=>{P(this,Kr,s),z(this,Je,Z5).call(this,s)};this.addCommands({cmd:r.bind(this,t),undo:r.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ht.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},Z5=function(t){if(!d(this,Jn))return;z(this,Je,Pw).call(this,{highlightOutlines:d(this,Gr).getNewOutline(t/2)}),this.fixAndSetPosition();const[i,r]=this.parentDimensions;this.setDims(this.width*i,this.height*r)},l2=function(){d(this,br)===null||!this.parent||(this.parent.drawLayer.remove(d(this,br)),P(this,br,null),this.parent.drawLayer.remove(d(this,mi)),P(this,mi,null))},vc=function(t=this.parent){d(this,br)===null&&({id:Ii(this,br)._,clipPathId:Ii(this,wd)._}=t.drawLayer.draw({bbox:d(this,Gr).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":d(this,$o)},rootClass:{highlight:!0,free:d(this,Jn)},path:{d:d(this,Gr).toSVGPath()}},!1,!0),P(this,mi,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:d(this,Jn)},bbox:d(this,Ji).box,path:{d:d(this,Ji).toSVGPath()}},d(this,Jn))),d(this,bd)&&(d(this,bd).style.clipPath=d(this,wd)))},es=new WeakSet,zh=function([t,i,r,s],a){switch(a){case 90:return[1-i-s,t,s,r];case 180:return[1-t-r,1-i-s,r,s];case 270:return[i,1-t-r,s,r]}return[t,i,r,s]},e6=function(t){wt._keyboardManager.exec(this,t)},Nw=function(t){if(!d(this,dp))return;const i=window.getSelection();t?i.setPosition(d(this,dp),d(this,B_)):i.setPosition(d(this,U_),d(this,H_))},bg=function(){return d(this,Jn)?this.rotation:0},t6=function(){if(d(this,Jn))return null;const[t,i]=this.pageDimensions,[r,s]=this.pageTranslation,a=d(this,ko),o=new Float32Array(a.length*8);let l=0;for(const{x:u,y:c,width:h,height:f}of a){const m=u*t+r,y=(1-c)*i+s;o[l]=o[l+4]=m,o[l+1]=o[l+3]=y,o[l+2]=o[l+6]=m+h*t,o[l+5]=o[l+7]=y-f*i,l+=8}return o},n6=function(t){return d(this,Gr).serialize(t,z(this,Je,bg).call(this))},i6=function(t,i){this._freeHighlight.add(i)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},r6=function(t,i){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(i,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},s6=function(t){const{color:i}=this._initialData;return t.color.some((r,s)=>r!==i[s])},F(wt,es),ze(wt,"_defaultColor",null),ze(wt,"_defaultOpacity",1),ze(wt,"_defaultThickness",12),ze(wt,"_type","highlight"),ze(wt,"_editorType",Ze.HIGHLIGHT),ze(wt,"_freeHighlightId",-1),ze(wt,"_freeHighlight",null),ze(wt,"_freeHighlightClipId","");let Wb=wt;var xd;class Fte{constructor(){F(this,xd,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,i]of Object.entries(e))this.updateProperty(t,i)}updateSVGProperty(e,t){d(this,xd)[e]=t}toSVGProperties(){const e=d(this,xd);return P(this,xd,Object.create(null)),{root:e}}reset(){P(this,xd,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){Dt("Not implemented")}}xd=new WeakMap;var xr,mp,Vn,Ed,Ad,Zl,eu,tu,Td,yt,c2,d2,h2,xg,a6,Dw,Eg,Vh;const Re=class Re extends en{constructor(t){super(t);F(this,yt);F(this,xr,null);F(this,mp);ze(this,"_drawId",null);P(this,mp,t.mustBeCommitted||!1),t.drawOutlines&&(z(this,yt,c2).call(this,t),z(this,yt,xg).call(this))}static _mergeSVGProperties(t,i){const r=new Set(Object.keys(t));for(const[s,a]of Object.entries(i))r.has(s)?Object.assign(t[s],a):t[s]=a;return t}static getDefaultDrawingOptions(t){Dt("Not implemented")}static get typesMap(){Dt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,i){const r=this.typesMap.get(t);r&&this._defaultDrawingOptions.updateProperty(r,i),this._currentParent&&(d(Re,Vn).updateProperty(r,i),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,i){const r=this.constructor.typesMap.get(t);r&&this._updateProperty(t,r,i)}static get defaultPropertiesToUpdate(){const t=[],i=this._defaultDrawingOptions;for(const[r,s]of this.typesMap)t.push([r,i[s]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:i}=this;for(const[r,s]of this.constructor.typesMap)t.push([r,i[s]]);return t}_updateProperty(t,i,r){const s=this._drawingOptions,a=s[i],o=l=>{var c;s.updateProperty(i,l);const u=d(this,xr).updateProperty(i,l);u&&z(this,yt,Eg).call(this,u),(c=this.parent)==null||c.drawLayer.updateProperties(this._drawId,s.toSVGProperties())};this.addCommands({cmd:o.bind(this,r),undo:o.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Re._mergeSVGProperties(d(this,xr).getPathResizingSVGProperties(z(this,yt,Dw).call(this)),{bbox:z(this,yt,Vh).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Re._mergeSVGProperties(d(this,xr).getPathResizedSVGProperties(z(this,yt,Dw).call(this)),{bbox:z(this,yt,Vh).call(this)}))}_onTranslating(t,i){var r;(r=this.parent)==null||r.drawLayer.updateProperties(this._drawId,{bbox:z(this,yt,Vh).call(this,t,i)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Re._mergeSVGProperties(d(this,xr).getPathTranslatedSVGProperties(z(this,yt,Dw).call(this),this.parentDimensions),{bbox:z(this,yt,Vh).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,d(this,mp)&&(P(this,mp,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){z(this,yt,h2).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(z(this,yt,xg).call(this),z(this,yt,Eg).call(this,d(this,xr).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var r;let i=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),z(this,yt,h2).call(this)):t&&(this._uiManager.addShouldRescale(this),z(this,yt,xg).call(this,t),i=!this.parent&&((r=this.div)==null?void 0:r.classList.contains("selectedEditor"))),super.setParent(t),i&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,Re._mergeSVGProperties({bbox:z(this,yt,Vh).call(this)},d(this,xr).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&z(this,yt,Eg).call(this,d(this,xr).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;const t=super.render();t.classList.add("draw");const i=document.createElement("div");t.append(i),i.setAttribute("aria-hidden","true"),i.className="internal";const[r,s]=this.parentDimensions;return this.setDims(this.width*r,this.height*s),this._uiManager.addShouldRescale(this),this.disableEditing(),t}static createDrawerInstance(t,i,r,s,a){Dt("Not implemented")}static startDrawing(t,i,r,s){var x;const{target:a,offsetX:o,offsetY:l,pointerId:u,pointerType:c}=s;if(d(Re,eu)&&d(Re,eu)!==c)return;const{viewport:{rotation:h}}=t,{width:f,height:m}=a.getBoundingClientRect(),y=P(Re,Ed,new AbortController),_=t.combinedSignal(y);if(d(Re,Zl)||P(Re,Zl,u),d(Re,eu)??P(Re,eu,c),window.addEventListener("pointerup",v=>{var w;d(Re,Zl)===v.pointerId?this._endDraw(v):(w=d(Re,tu))==null||w.delete(v.pointerId)},{signal:_}),window.addEventListener("pointercancel",v=>{var w;d(Re,Zl)===v.pointerId?this._currentParent.endDrawingSession():(w=d(Re,tu))==null||w.delete(v.pointerId)},{signal:_}),window.addEventListener("pointerdown",v=>{d(Re,eu)===v.pointerType&&((d(Re,tu)||P(Re,tu,new Set)).add(v.pointerId),d(Re,Vn).isCancellable()&&(d(Re,Vn).removeLastElement(),d(Re,Vn).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:_}),window.addEventListener("contextmenu",Js,{signal:_}),a.addEventListener("pointermove",this._drawMove.bind(this),{signal:_}),a.addEventListener("touchmove",v=>{v.timeStamp===d(Re,Td)&&Rr(v)},{signal:_}),t.toggleDrawing(),(x=i._editorUndoBar)==null||x.hide(),d(Re,Vn)){t.drawLayer.updateProperties(this._currentDrawId,d(Re,Vn).startNew(o,l,f,m,h));return}i.updateUIForDefaultProperties(this),P(Re,Vn,this.createDrawerInstance(o,l,f,m,h)),P(Re,Ad,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(d(Re,Ad).toSVGProperties(),d(Re,Vn).defaultSVGProperties),!0,!1)}static _drawMove(t){var a;if(P(Re,Td,-1),!d(Re,Vn))return;const{offsetX:i,offsetY:r,pointerId:s}=t;if(d(Re,Zl)===s){if(((a=d(Re,tu))==null?void 0:a.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,d(Re,Vn).add(i,r)),P(Re,Td,t.timeStamp),Rr(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,P(Re,Vn,null),P(Re,Ad,null),P(Re,eu,null),P(Re,Td,NaN)),d(Re,Ed)&&(d(Re,Ed).abort(),P(Re,Ed,null),P(Re,Zl,NaN),P(Re,tu,null))}static _endDraw(t){const i=this._currentParent;if(i){if(i.toggleDrawing(!0),this._cleanup(!1),t&&i.drawLayer.updateProperties(this._currentDrawId,d(Re,Vn).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const r=d(Re,Vn),s=this._currentDrawId,a=r.getLastElement();i.addCommands({cmd:()=>{i.drawLayer.updateProperties(s,r.setLastElement(a))},undo:()=>{i.drawLayer.updateProperties(s,r.removeLastElement())},mustExec:!1,type:ht.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const i=this._currentParent;if(!i)return null;if(i.toggleDrawing(!0),i.cleanUndoStack(ht.DRAW_STEP),!d(Re,Vn).isEmpty()){const{pageDimensions:[r,s],scale:a}=i,o=i.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:d(Re,Vn).getOutlines(r*a,s*a,a,this._INNER_MARGIN),drawingOptions:d(Re,Ad),mustBeCommitted:!t});return this._cleanup(!0),o}return i.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,i,r,s,a,o){Dt("Not implemented")}static async deserialize(t,i,r){var h,f;const{rawDims:{pageWidth:s,pageHeight:a,pageX:o,pageY:l}}=i.viewport,u=this.deserializeDraw(o,l,s,a,this._INNER_MARGIN,t),c=await super.deserialize(t,i,r);return c.createDrawingOptions(t),z(h=c,yt,c2).call(h,{drawOutlines:u}),z(f=c,yt,xg).call(f),c.onScaleChanging(),c.rotate(),c}serializeDraw(t){const[i,r]=this.pageTranslation,[s,a]=this.pageDimensions;return d(this,xr).serialize([i,r,s,a],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};xr=new WeakMap,mp=new WeakMap,Vn=new WeakMap,Ed=new WeakMap,Ad=new WeakMap,Zl=new WeakMap,eu=new WeakMap,tu=new WeakMap,Td=new WeakMap,yt=new WeakSet,c2=function({drawOutlines:t,drawId:i,drawingOptions:r}){P(this,xr,t),this._drawingOptions||(this._drawingOptions=r),i>=0?(this._drawId=i,this.parent.drawLayer.finalizeDraw(i,t.defaultProperties)):this._drawId=z(this,yt,d2).call(this,t,this.parent),z(this,yt,Eg).call(this,t.box)},d2=function(t,i){const{id:r}=i.drawLayer.draw(Re._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return r},h2=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},xg=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=z(this,yt,d2).call(this,d(this,xr),t)}},a6=function([t,i,r,s]){const{parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[i,1-t,r*(o/a),s*(a/o)];case 180:return[1-t,1-i,r,s];case 270:return[1-i,t,r*(o/a),s*(a/o)];default:return[t,i,r,s]}},Dw=function(){const{x:t,y:i,width:r,height:s,parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[1-i,t,r*(a/o),s*(o/a)];case 180:return[1-t,1-i,r,s];case 270:return[i,1-t,r*(a/o),s*(o/a)];default:return[t,i,r,s]}},Eg=function(t){if([this.x,this.y,this.width,this.height]=z(this,yt,a6).call(this,t),this.div){this.fixAndSetPosition();const[i,r]=this.parentDimensions;this.setDims(this.width*i,this.height*r)}this._onResized()},Vh=function(){const{x:t,y:i,width:r,height:s,rotation:a,parentRotation:o,parentDimensions:[l,u]}=this;switch((a*4+o)/90){case 1:return[1-i-s,t,s,r];case 2:return[1-t-r,1-i-s,r,s];case 3:return[i,1-t-r,s,r];case 4:return[t,i-r*(l/u),s*(u/l),r*(l/u)];case 5:return[1-i,t,r*(l/u),s*(u/l)];case 6:return[1-t-s*(u/l),1-i,s*(u/l),r*(l/u)];case 7:return[i-r*(l/u),1-t-s*(u/l),r*(l/u),s*(u/l)];case 8:return[t-r,i-s,r,s];case 9:return[1-i,t-r,s,r];case 10:return[1-t,1-i,r,s];case 11:return[i-s,1-t,s,r];case 12:return[t-s*(u/l),i,s*(u/l),r*(l/u)];case 13:return[1-i-r*(l/u),t-s*(u/l),r*(l/u),s*(u/l)];case 14:return[1-t,1-i-r*(l/u),s*(u/l),r*(l/u)];case 15:return[i,1-t,r*(l/u),s*(u/l)];default:return[t,i,r,s]}},ze(Re,"_currentDrawId",-1),ze(Re,"_currentParent",null),F(Re,Vn,null),F(Re,Ed,null),F(Re,Ad,null),F(Re,Zl,NaN),F(Re,eu,null),F(Re,tu,null),F(Re,Td,NaN),ze(Re,"_INNER_MARGIN",3);let u2=Re;var Sa,jn,Bn,Sd,gp,Ri,Zn,Yr,Id,Cd,kd,yp,Mw;class zte{constructor(e,t,i,r,s,a){F(this,yp);F(this,Sa,new Float64Array(6));F(this,jn);F(this,Bn);F(this,Sd);F(this,gp);F(this,Ri);F(this,Zn,"");F(this,Yr,0);F(this,Id,new qb);F(this,Cd);F(this,kd);P(this,Cd,i),P(this,kd,r),P(this,Sd,s),P(this,gp,a),[e,t]=z(this,yp,Mw).call(this,e,t);const o=P(this,jn,[NaN,NaN,NaN,NaN,e,t]);P(this,Ri,[e,t]),P(this,Bn,[{line:o,points:d(this,Ri)}]),d(this,Sa).set(o,0)}updateProperty(e,t){e==="stroke-width"&&P(this,gp,t)}isEmpty(){return!d(this,Bn)||d(this,Bn).length===0}isCancellable(){return d(this,Ri).length<=10}add(e,t){[e,t]=z(this,yp,Mw).call(this,e,t);const[i,r,s,a]=d(this,Sa).subarray(2,6),o=e-s,l=t-a;return Math.hypot(d(this,Cd)*o,d(this,kd)*l)<=2?null:(d(this,Ri).push(e,t),isNaN(i)?(d(this,Sa).set([s,a,e,t],2),d(this,jn).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(d(this,Sa)[0])&&d(this,jn).splice(6,6),d(this,Sa).set([i,r,s,a,e,t],0),d(this,jn).push(...Ce.createBezierPoints(i,r,s,a,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const i=this.add(e,t);return i||(d(this,Ri).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,i,r,s){P(this,Cd,i),P(this,kd,r),P(this,Sd,s),[e,t]=z(this,yp,Mw).call(this,e,t);const a=P(this,jn,[NaN,NaN,NaN,NaN,e,t]);P(this,Ri,[e,t]);const o=d(this,Bn).at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),d(this,Bn).push({line:a,points:d(this,Ri)}),d(this,Sa).set(a,0),P(this,Yr,0),this.toSVGPath(),null}getLastElement(){return d(this,Bn).at(-1)}setLastElement(e){return d(this,Bn)?(d(this,Bn).push(e),P(this,jn,e.line),P(this,Ri,e.points),P(this,Yr,0),{path:{d:this.toSVGPath()}}):d(this,Id).setLastElement(e)}removeLastElement(){if(!d(this,Bn))return d(this,Id).removeLastElement();d(this,Bn).pop(),P(this,Zn,"");for(let e=0,t=d(this,Bn).length;e<t;e++){const{line:i,points:r}=d(this,Bn)[e];P(this,jn,i),P(this,Ri,r),P(this,Yr,0),this.toSVGPath()}return{path:{d:d(this,Zn)}}}toSVGPath(){const e=Ce.svgRound(d(this,jn)[4]),t=Ce.svgRound(d(this,jn)[5]);if(d(this,Ri).length===2)return P(this,Zn,`${d(this,Zn)} M ${e} ${t} Z`),d(this,Zn);if(d(this,Ri).length<=6){const r=d(this,Zn).lastIndexOf("M");P(this,Zn,`${d(this,Zn).slice(0,r)} M ${e} ${t}`),P(this,Yr,6)}if(d(this,Ri).length===4){const r=Ce.svgRound(d(this,jn)[10]),s=Ce.svgRound(d(this,jn)[11]);return P(this,Zn,`${d(this,Zn)} L ${r} ${s}`),P(this,Yr,12),d(this,Zn)}const i=[];d(this,Yr)===0&&(i.push(`M ${e} ${t}`),P(this,Yr,6));for(let r=d(this,Yr),s=d(this,jn).length;r<s;r+=6){const[a,o,l,u,c,h]=d(this,jn).slice(r,r+6).map(Ce.svgRound);i.push(`C${a} ${o} ${l} ${u} ${c} ${h}`)}return P(this,Zn,d(this,Zn)+i.join(" ")),P(this,Yr,d(this,jn).length),d(this,Zn)}getOutlines(e,t,i,r){const s=d(this,Bn).at(-1);return s.line=new Float32Array(s.line),s.points=new Float32Array(s.points),d(this,Id).build(d(this,Bn),e,t,i,d(this,Sd),d(this,gp),r),P(this,Sa,null),P(this,jn,null),P(this,Bn,null),P(this,Zn,null),d(this,Id)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}Sa=new WeakMap,jn=new WeakMap,Bn=new WeakMap,Sd=new WeakMap,gp=new WeakMap,Ri=new WeakMap,Zn=new WeakMap,Yr=new WeakMap,Id=new WeakMap,Cd=new WeakMap,kd=new WeakMap,yp=new WeakSet,Mw=function(e,t){return Ce._normalizePoint(e,t,d(this,Cd),d(this,kd),d(this,Sd))};var Pi,q_,G_,Er,Ia,Ca,_p,vp,wp,ii,ro,o6,l6,u6;const ZC=class ZC extends Ce{constructor(){super(...arguments);F(this,ii);F(this,Pi);F(this,q_,0);F(this,G_);F(this,Er);F(this,Ia);F(this,Ca);F(this,_p);F(this,vp);F(this,wp)}build(t,i,r,s,a,o,l){P(this,Ia,i),P(this,Ca,r),P(this,_p,s),P(this,vp,a),P(this,wp,o),P(this,G_,l??0),P(this,Er,t),z(this,ii,l6).call(this)}setLastElement(t){return d(this,Er).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return d(this,Er).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:i}of d(this,Er)){if(t.push(`M${Ce.svgRound(i[4])} ${Ce.svgRound(i[5])}`),i.length===6){t.push("Z");continue}if(i.length===12){t.push(`L${Ce.svgRound(i[10])} ${Ce.svgRound(i[11])}`);continue}for(let r=6,s=i.length;r<s;r+=6){const[a,o,l,u,c,h]=i.subarray(r,r+6).map(Ce.svgRound);t.push(`C${a} ${o} ${l} ${u} ${c} ${h}`)}}return t.join("")}serialize([t,i,r,s],a){const o=[],l=[],[u,c,h,f]=z(this,ii,o6).call(this);let m,y,_,x,v,w,E,k,$;switch(d(this,vp)){case 0:$=Ce._rescale,m=t,y=i+s,_=r,x=-s,v=t+u*r,w=i+(1-c-f)*s,E=t+(u+h)*r,k=i+(1-c)*s;break;case 90:$=Ce._rescaleAndSwap,m=t,y=i,_=r,x=s,v=t+c*r,w=i+u*s,E=t+(c+f)*r,k=i+(u+h)*s;break;case 180:$=Ce._rescale,m=t+r,y=i,_=-r,x=s,v=t+(1-u-h)*r,w=i+c*s,E=t+(1-u)*r,k=i+(c+f)*s;break;case 270:$=Ce._rescaleAndSwap,m=t+r,y=i+s,_=-r,x=-s,v=t+(1-c-f)*r,w=i+(1-u-h)*s,E=t+(1-c)*r,k=i+(1-u)*s;break}for(const{line:L,points:I}of d(this,Er))o.push($(L,m,y,_,x,a?new Array(L.length):null)),l.push($(I,m,y,_,x,a?new Array(I.length):null));return{lines:o,points:l,rect:[v,w,E,k]}}static deserialize(t,i,r,s,a,{paths:{lines:o,points:l},rotation:u,thickness:c}){const h=[];let f,m,y,_,x;switch(u){case 0:x=Ce._rescale,f=-t/r,m=i/s+1,y=1/r,_=-1/s;break;case 90:x=Ce._rescaleAndSwap,f=-i/s,m=-t/r,y=1/s,_=1/r;break;case 180:x=Ce._rescale,f=t/r+1,m=-i/s,y=-1/r,_=1/s;break;case 270:x=Ce._rescaleAndSwap,f=i/s+1,m=t/r+1,y=-1/s,_=-1/r;break}if(!o){o=[];for(const w of l){const E=w.length;if(E===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1]]));continue}if(E===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1],NaN,NaN,NaN,NaN,w[2],w[3]]));continue}const k=new Float32Array(3*(E-2));o.push(k);let[$,L,I,C]=w.subarray(0,4);k.set([NaN,NaN,NaN,NaN,$,L],0);for(let N=4;N<E;N+=2){const O=w[N],V=w[N+1];k.set(Ce.createBezierPoints($,L,I,C,O,V),(N-2)*3),[$,L,I,C]=[I,C,O,V]}}}for(let w=0,E=o.length;w<E;w++)h.push({line:x(o[w].map(k=>k??NaN),f,m,y,_),points:x(l[w].map(k=>k??NaN),f,m,y,_)});const v=new ZC;return v.build(h,r,s,1,u,c,a),v}get box(){return d(this,Pi)}updateProperty(t,i){return t==="stroke-width"?z(this,ii,u6).call(this,i):null}updateParentDimensions([t,i],r){const[s,a]=z(this,ii,ro).call(this);P(this,Ia,t),P(this,Ca,i),P(this,_p,r);const[o,l]=z(this,ii,ro).call(this),u=o-s,c=l-a,h=d(this,Pi);return h[0]-=u,h[1]-=c,h[2]+=2*u,h[3]+=2*c,h}updateRotation(t){return P(this,q_,t),{path:{transform:this.rotationTransform}}}get viewBox(){return d(this,Pi).map(Ce.svgRound).join(" ")}get defaultProperties(){const[t,i]=d(this,Pi);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Ce.svgRound(t)} ${Ce.svgRound(i)}`}}}get rotationTransform(){const[,,t,i]=d(this,Pi);let r=0,s=0,a=0,o=0,l=0,u=0;switch(d(this,q_)){case 90:s=i/t,a=-t/i,l=t;break;case 180:r=-1,o=-1,l=t,u=i;break;case 270:s=-i/t,a=t/i,u=i;break;default:return""}return`matrix(${r} ${s} ${a} ${o} ${Ce.svgRound(l)} ${Ce.svgRound(u)})`}getPathResizingSVGProperties([t,i,r,s]){const[a,o]=z(this,ii,ro).call(this),[l,u,c,h]=d(this,Pi);if(Math.abs(c-a)<=Ce.PRECISION||Math.abs(h-o)<=Ce.PRECISION){const x=t+r/2-(l+c/2),v=i+s/2-(u+h/2);return{path:{"transform-origin":`${Ce.svgRound(t)} ${Ce.svgRound(i)}`,transform:`${this.rotationTransform} translate(${x} ${v})`}}}const f=(r-2*a)/(c-2*a),m=(s-2*o)/(h-2*o),y=c/r,_=h/s;return{path:{"transform-origin":`${Ce.svgRound(l)} ${Ce.svgRound(u)}`,transform:`${this.rotationTransform} scale(${y} ${_}) translate(${Ce.svgRound(a)} ${Ce.svgRound(o)}) scale(${f} ${m}) translate(${Ce.svgRound(-a)} ${Ce.svgRound(-o)})`}}}getPathResizedSVGProperties([t,i,r,s]){const[a,o]=z(this,ii,ro).call(this),l=d(this,Pi),[u,c,h,f]=l;if(l[0]=t,l[1]=i,l[2]=r,l[3]=s,Math.abs(h-a)<=Ce.PRECISION||Math.abs(f-o)<=Ce.PRECISION){const v=t+r/2-(u+h/2),w=i+s/2-(c+f/2);for(const{line:E,points:k}of d(this,Er))Ce._translate(E,v,w,E),Ce._translate(k,v,w,k);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Ce.svgRound(t)} ${Ce.svgRound(i)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const m=(r-2*a)/(h-2*a),y=(s-2*o)/(f-2*o),_=-m*(u+a)+t+a,x=-y*(c+o)+i+o;if(m!==1||y!==1||_!==0||x!==0)for(const{line:v,points:w}of d(this,Er))Ce._rescale(v,_,x,m,y,v),Ce._rescale(w,_,x,m,y,w);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Ce.svgRound(t)} ${Ce.svgRound(i)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,i],r){const[s,a]=r,o=d(this,Pi),l=t-o[0],u=i-o[1];if(d(this,Ia)===s&&d(this,Ca)===a)for(const{line:c,points:h}of d(this,Er))Ce._translate(c,l,u,c),Ce._translate(h,l,u,h);else{const c=d(this,Ia)/s,h=d(this,Ca)/a;P(this,Ia,s),P(this,Ca,a);for(const{line:f,points:m}of d(this,Er))Ce._rescale(f,l,u,c,h,f),Ce._rescale(m,l,u,c,h,m);o[2]*=c,o[3]*=h}return o[0]=t,o[1]=i,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${Ce.svgRound(t)} ${Ce.svgRound(i)}`}}}get defaultSVGProperties(){const t=d(this,Pi);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${Ce.svgRound(t[0])} ${Ce.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}};Pi=new WeakMap,q_=new WeakMap,G_=new WeakMap,Er=new WeakMap,Ia=new WeakMap,Ca=new WeakMap,_p=new WeakMap,vp=new WeakMap,wp=new WeakMap,ii=new WeakSet,ro=function(t=d(this,wp)){const i=d(this,G_)+t/2*d(this,_p);return d(this,vp)%180===0?[i/d(this,Ia),i/d(this,Ca)]:[i/d(this,Ca),i/d(this,Ia)]},o6=function(){const[t,i,r,s]=d(this,Pi),[a,o]=z(this,ii,ro).call(this,0);return[t+a,i+o,r-2*a,s-2*o]},l6=function(){const t=P(this,Pi,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:s}of d(this,Er)){if(s.length<=12){for(let l=4,u=s.length;l<u;l+=6){const[c,h]=s.subarray(l,l+2);t[0]=Math.min(t[0],c),t[1]=Math.min(t[1],h),t[2]=Math.max(t[2],c),t[3]=Math.max(t[3],h)}continue}let a=s[4],o=s[5];for(let l=6,u=s.length;l<u;l+=6){const[c,h,f,m,y,_]=s.subarray(l,l+6);Me.bezierBoundingBox(a,o,c,h,f,m,y,_,t),a=y,o=_}}const[i,r]=z(this,ii,ro).call(this);t[0]=Math.min(1,Math.max(0,t[0]-i)),t[1]=Math.min(1,Math.max(0,t[1]-r)),t[2]=Math.min(1,Math.max(0,t[2]+i)),t[3]=Math.min(1,Math.max(0,t[3]+r)),t[2]-=t[0],t[3]-=t[1]},u6=function(t){const[i,r]=z(this,ii,ro).call(this);P(this,wp,t);const[s,a]=z(this,ii,ro).call(this),[o,l]=[s-i,a-r],u=d(this,Pi);return u[0]-=o,u[1]-=l,u[2]+=2*o,u[3]+=2*l,u};let qb=ZC;var bp;const ek=class ek extends Fte{constructor(t){super();F(this,bp);P(this,bp,t),super.updateProperties({fill:"none",stroke:en._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,i){t==="stroke-width"&&(i??(i=this["stroke-width"]),i*=d(this,bp).realScale),super.updateSVGProperty(t,i)}clone(){const t=new ek(d(this,bp));return t.updateAll(this),t}};bp=new WeakMap;let f2=ek;var d1,c6;const of=class of extends u2{constructor(t){super({...t,name:"inkEditor"});F(this,d1);this._willKeepAspectRatio=!0}static initialize(t,i){en.initialize(t,i),this._defaultDrawingOptions=new f2(i.viewParameters)}static getDefaultDrawingOptions(t){const i=this._defaultDrawingOptions.clone();return i.updateProperties(t),i}static get supportMultipleDrawings(){return!0}static get typesMap(){return st(this,"typesMap",new Map([[ht.INK_THICKNESS,"stroke-width"],[ht.INK_COLOR,"stroke"],[ht.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,i,r,s,a){return new zte(t,i,r,s,a,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,i,r,s,a,o){return qb.deserialize(t,i,r,s,a,o)}static async deserialize(t,i,r){let s=null;if(t instanceof GC){const{data:{inkLists:o,rect:l,rotation:u,id:c,color:h,opacity:f,borderStyle:{rawWidth:m},popupRef:y},parent:{page:{pageNumber:_}}}=t;s=t={annotationType:Ze.INK,color:Array.from(h),thickness:m,opacity:f,paths:{points:o},boxes:null,pageIndex:_-1,rect:l.slice(0),rotation:u,id:c,deleted:!1,popupRef:y}}const a=await super.deserialize(t,i,r);return a.annotationElementId=t.id||null,a._initialData=s,a}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:i,parent:r}=this;i.updateSVGProperty("stroke-width"),r.drawLayer.updateProperties(t,i.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:i,opacity:r}){this._drawingOptions=of.getDefaultDrawingOptions({stroke:Me.makeHexColor(...t),"stroke-width":i,"stroke-opacity":r})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:i,points:r,rect:s}=this.serializeDraw(t),{_drawingOptions:{stroke:a,"stroke-opacity":o,"stroke-width":l}}=this,u={annotationType:Ze.INK,color:en._colorManager.convert(a),opacity:o,thickness:l,paths:{lines:i,points:r},pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?u:this.annotationElementId&&!z(this,d1,c6).call(this,u)?null:(u.id=this.annotationElementId,u)}renderAnnotationElement(t){const{points:i,rect:r}=this.serializeDraw(!1);return t.updateEdited({rect:r,thickness:this._drawingOptions["stroke-width"],points:i}),null}};d1=new WeakSet,c6=function(t){const{color:i,thickness:r,opacity:s,pageIndex:a}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((o,l)=>o!==i[l])||t.thickness!==r||t.opacity!==s||t.pageIndex!==a},ze(of,"_type","ink"),ze(of,"_editorType",Ze.INK),ze(of,"_defaultDrawingOptions",null);let p2=of;var Jt,ei,nu,Ro,iu,xp,ka,$a,Ar,Ep,vt,Ag,Tg,Ow,g2,Lw,y2,Fw,d6;const Wg=class Wg extends en{constructor(t){super({...t,name:"stampEditor"});F(this,vt);F(this,Jt,null);F(this,ei,null);F(this,nu,null);F(this,Ro,null);F(this,iu,null);F(this,xp,"");F(this,ka,null);F(this,$a,null);F(this,Ar,!1);F(this,Ep,!1);P(this,Ro,t.bitmapUrl),P(this,iu,t.bitmapFile)}static initialize(t,i){en.initialize(t,i)}static get supportedTypes(){return st(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(i=>`image/${i}`))}static get supportedTypesStr(){return st(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,i){i.pasteEditor(Ze.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const i=t.get("hasAltText");return{hasAltText:i.get(!0)??0,hasNoAltText:i.get(!1)??0}}async mlGuessAltText(t=null,i=!0){if(this.hasAltTextData())return null;const{mlManager:r}=this._uiManager;if(!r)throw new Error("No ML.");if(!await r.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:s,width:a,height:o}=t||this.copyCanvas(null,null,!0).imageData,l=await r.guess({name:"altText",request:{data:s,width:a,height:o,channels:s.length/(a*o)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const u=l.output;return await this.setGuessedAltText(u),i&&!this.hasAltTextData()&&(this.altTextData={alt:u,decorative:!1}),u}remove(){var t;d(this,ei)&&(P(this,Jt,null),this._uiManager.imageManager.deleteId(d(this,ei)),(t=d(this,ka))==null||t.remove(),P(this,ka,null),d(this,$a)&&(clearTimeout(d(this,$a)),P(this,$a,null))),super.remove()}rebuild(){if(!this.parent){d(this,ei)&&z(this,vt,Ow).call(this);return}super.rebuild(),this.div!==null&&(d(this,ei)&&d(this,ka)===null&&z(this,vt,Ow).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(d(this,nu)||d(this,Jt)||d(this,Ro)||d(this,iu)||d(this,ei))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,i;if(this.width&&(t=this.x,i=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),d(this,Jt)?z(this,vt,g2).call(this):z(this,vt,Ow).call(this),this.width&&!this.annotationElementId){const[r,s]=this.parentDimensions;this.setAt(t*r,i*s,this.width*r,this.height*s)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;d(this,$a)!==null&&clearTimeout(d(this,$a)),P(this,$a,setTimeout(()=>{P(this,$a,null),z(this,vt,y2).call(this)},200))}copyCanvas(t,i,r=!1){var m;t||(t=224);const{width:s,height:a}=d(this,Jt),o=new fS;let l=d(this,Jt),u=s,c=a,h=null;if(i){if(s>i||a>i){const C=Math.min(i/s,i/a);u=Math.floor(s*C),c=Math.floor(a*C)}h=document.createElement("canvas");const y=h.width=Math.ceil(u*o.sx),_=h.height=Math.ceil(c*o.sy);d(this,Ar)||(l=z(this,vt,Lw).call(this,y,_));const x=h.getContext("2d");x.filter=this._uiManager.hcmFilter;let v="white",w="#cfcfd8";this._uiManager.hcmFilter!=="none"?w="black":(m=window.matchMedia)!=null&&m.call(window,"(prefers-color-scheme: dark)").matches&&(v="#8f8f9d",w="#42414d");const E=15,k=E*o.sx,$=E*o.sy,L=new OffscreenCanvas(k*2,$*2),I=L.getContext("2d");I.fillStyle=v,I.fillRect(0,0,k*2,$*2),I.fillStyle=w,I.fillRect(0,0,k,$),I.fillRect(k,$,k,$),x.fillStyle=x.createPattern(L,"repeat"),x.fillRect(0,0,y,_),x.drawImage(l,0,0,l.width,l.height,0,0,y,_)}let f=null;if(r){let y,_;if(o.symmetric&&l.width<t&&l.height<t)y=l.width,_=l.height;else if(l=d(this,Jt),s>t||a>t){const w=Math.min(t/s,t/a);y=Math.floor(s*w),_=Math.floor(a*w),d(this,Ar)||(l=z(this,vt,Lw).call(this,y,_))}const v=new OffscreenCanvas(y,_).getContext("2d",{willReadFrequently:!0});v.drawImage(l,0,0,l.width,l.height,0,0,y,_),f={width:y,height:_,data:v.getImageData(0,0,y,_).data}}return{canvas:h,width:u,height:c,imageData:f}}getImageForAltText(){return d(this,ka)}static async deserialize(t,i,r){var _;let s=null;if(t instanceof P5){const{data:{rect:x,rotation:v,id:w,structParent:E,popupRef:k},container:$,parent:{page:{pageNumber:L}}}=t,I=$.querySelector("canvas"),C=r.imageManager.getFromCanvas($.id,I);I.remove();const N=((_=await i._structTree.getAriaAttributes(`${zC}${w}`))==null?void 0:_.get("aria-label"))||"";s=t={annotationType:Ze.STAMP,bitmapId:C.id,bitmap:C.bitmap,pageIndex:L-1,rect:x.slice(0),rotation:v,id:w,deleted:!1,accessibilityData:{decorative:!1,altText:N},isSvg:!1,structParent:E,popupRef:k}}const a=await super.deserialize(t,i,r),{rect:o,bitmap:l,bitmapUrl:u,bitmapId:c,isSvg:h,accessibilityData:f}=t;c&&r.imageManager.isValidId(c)?(P(a,ei,c),l&&P(a,Jt,l)):P(a,Ro,u),P(a,Ar,h);const[m,y]=a.pageDimensions;return a.width=(o[2]-o[0])/m,a.height=(o[3]-o[1])/y,a.annotationElementId=t.id||null,f&&(a.altTextData=f),a._initialData=s,P(a,Ep,!!s),a}serialize(t=!1,i=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const r={annotationType:Ze.STAMP,bitmapId:d(this,ei),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:d(this,Ar),structTreeParentId:this._structTreeParentId};if(t)return r.bitmapUrl=z(this,vt,Fw).call(this,!0),r.accessibilityData=this.serializeAltText(!0),r;const{decorative:s,altText:a}=this.serializeAltText(!1);if(!s&&a&&(r.accessibilityData={type:"Figure",alt:a}),this.annotationElementId){const l=z(this,vt,d6).call(this,r);if(l.isSame)return null;l.isSameAltText?delete r.accessibilityData:r.accessibilityData.structParent=this._initialData.structParent??-1}if(r.id=this.annotationElementId,i===null)return r;i.stamps||(i.stamps=new Map);const o=d(this,Ar)?(r.rect[2]-r.rect[0])*(r.rect[3]-r.rect[1]):null;if(!i.stamps.has(d(this,ei)))i.stamps.set(d(this,ei),{area:o,serialized:r}),r.bitmap=z(this,vt,Fw).call(this,!1);else if(d(this,Ar)){const l=i.stamps.get(d(this,ei));o>l.area&&(l.area=o,l.serialized.bitmap.close(),l.serialized.bitmap=z(this,vt,Fw).call(this,!1))}return r}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}};Jt=new WeakMap,ei=new WeakMap,nu=new WeakMap,Ro=new WeakMap,iu=new WeakMap,xp=new WeakMap,ka=new WeakMap,$a=new WeakMap,Ar=new WeakMap,Ep=new WeakMap,vt=new WeakSet,Ag=function(t,i=!1){if(!t){this.remove();return}P(this,Jt,t.bitmap),i||(P(this,ei,t.id),P(this,Ar,t.isSvg)),t.file&&P(this,xp,t.file.name),z(this,vt,g2).call(this)},Tg=function(){if(P(this,nu,null),this._uiManager.enableWaiting(!1),!!d(this,ka)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&d(this,Jt)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&d(this,Jt)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},Ow=function(){if(d(this,ei)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(d(this,ei)).then(r=>z(this,vt,Ag).call(this,r,!0)).finally(()=>z(this,vt,Tg).call(this));return}if(d(this,Ro)){const r=d(this,Ro);P(this,Ro,null),this._uiManager.enableWaiting(!0),P(this,nu,this._uiManager.imageManager.getFromUrl(r).then(s=>z(this,vt,Ag).call(this,s)).finally(()=>z(this,vt,Tg).call(this)));return}if(d(this,iu)){const r=d(this,iu);P(this,iu,null),this._uiManager.enableWaiting(!0),P(this,nu,this._uiManager.imageManager.getFromFile(r).then(s=>z(this,vt,Ag).call(this,s)).finally(()=>z(this,vt,Tg).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=Wg.supportedTypesStr;const i=this._uiManager._signal;P(this,nu,new Promise(r=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const s=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),z(this,vt,Ag).call(this,s)}r()},{signal:i}),t.addEventListener("cancel",()=>{this.remove(),r()},{signal:i})}).finally(()=>z(this,vt,Tg).call(this))),t.click()},g2=function(){var h;const{div:t}=this;let{width:i,height:r}=d(this,Jt);const[s,a]=this.pageDimensions,o=.75;if(this.width)i=this.width*s,r=this.height*a;else if(i>o*s||r>o*a){const f=Math.min(o*s/i,o*a/r);i*=f,r*=f}const[l,u]=this.parentDimensions;this.setDims(i*l/s,r*u/a),this._uiManager.enableWaiting(!1);const c=P(this,ka,document.createElement("canvas"));c.setAttribute("role","img"),this.addContainer(c),this.width=i/s,this.height=r/a,(h=this._initialOptions)!=null&&h.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),z(this,vt,y2).call(this),d(this,Ep)||(this.parent.addUndoableEditor(this),P(this,Ep,!0)),this._reportTelemetry({action:"inserted_image"}),d(this,xp)&&c.setAttribute("aria-label",d(this,xp))},Lw=function(t,i){const{width:r,height:s}=d(this,Jt);let a=r,o=s,l=d(this,Jt);for(;a>2*t||o>2*i;){const u=a,c=o;a>2*t&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2)),o>2*i&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const h=new OffscreenCanvas(a,o);h.getContext("2d").drawImage(l,0,0,u,c,0,0,a,o),l=h.transferToImageBitmap()}return l},y2=function(){const[t,i]=this.parentDimensions,{width:r,height:s}=this,a=new fS,o=Math.ceil(r*t*a.sx),l=Math.ceil(s*i*a.sy),u=d(this,ka);if(!u||u.width===o&&u.height===l)return;u.width=o,u.height=l;const c=d(this,Ar)?d(this,Jt):z(this,vt,Lw).call(this,o,l),h=u.getContext("2d");h.filter=this._uiManager.hcmFilter,h.drawImage(c,0,0,c.width,c.height,0,0,o,l)},Fw=function(t){if(t){if(d(this,Ar)){const s=this._uiManager.imageManager.getSvgUrl(d(this,ei));if(s)return s}const i=document.createElement("canvas");return{width:i.width,height:i.height}=d(this,Jt),i.getContext("2d").drawImage(d(this,Jt),0,0),i.toDataURL()}if(d(this,Ar)){const[i,r]=this.pageDimensions,s=Math.round(this.width*i*Du.PDF_TO_CSS_UNITS),a=Math.round(this.height*r*Du.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(s,a);return o.getContext("2d").drawImage(d(this,Jt),0,0,d(this,Jt).width,d(this,Jt).height,0,0,s,a),o.transferToImageBitmap()}return structuredClone(d(this,Jt))},d6=function(t){var o;const{pageIndex:i,accessibilityData:{altText:r}}=this._initialData,s=t.pageIndex===i,a=(((o=t.accessibilityData)==null?void 0:o.alt)||"")===r;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&s&&a,isSameAltText:a}},ze(Wg,"_type","stamp"),ze(Wg,"_editorType",Ze.STAMP);let m2=Wg;var $d,Ap,Ra,ru,Po,Xr,su,Tp,Rd,Ms,No,gi,Do,De,au,Gt,h6,ha,v2,w2,zw;const xs=class xs{constructor({uiManager:e,pageIndex:t,div:i,structTreeLayer:r,accessibilityManager:s,annotationLayer:a,drawLayer:o,textLayer:l,viewport:u,l10n:c}){F(this,Gt);F(this,$d);F(this,Ap,!1);F(this,Ra,null);F(this,ru,null);F(this,Po,null);F(this,Xr,new Map);F(this,su,!1);F(this,Tp,!1);F(this,Rd,!1);F(this,Ms,null);F(this,No,null);F(this,gi,null);F(this,Do,null);F(this,De);const h=[...d(xs,au).values()];if(!xs._initialized){xs._initialized=!0;for(const f of h)f.initialize(c,e)}e.registerEditorTypes(h),P(this,De,e),this.pageIndex=t,this.div=i,P(this,$d,s),P(this,Ra,a),this.viewport=u,P(this,gi,l),this.drawLayer=o,this._structTree=r,d(this,De).addLayer(this)}get isEmpty(){return d(this,Xr).size===0}get isInvisible(){return this.isEmpty&&d(this,De).getMode()===Ze.NONE}updateToolbar(e){d(this,De).updateToolbar(e)}updateMode(e=d(this,De).getMode()){switch(z(this,Gt,zw).call(this),e){case Ze.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Ze.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Ze.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const i of d(xs,au).values())t.toggle(`${i._type}Editing`,e===i._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=d(this,gi))==null?void 0:t.div)}setEditingState(e){d(this,De).setEditingState(e)}addCommands(e){d(this,De).addCommands(e)}cleanUndoStack(e){d(this,De).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=d(this,Ra))==null||t.div.classList.toggle("disabled",!e)}async enable(){P(this,Rd,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);const e=new Set;for(const i of d(this,Xr).values())i.enableEditing(),i.show(!0),i.annotationElementId&&(d(this,De).removeChangedExistingAnnotation(i),e.add(i.annotationElementId));if(!d(this,Ra)){P(this,Rd,!1);return}const t=d(this,Ra).getEditableAnnotations();for(const i of t){if(i.hide(),d(this,De).isDeletedAnnotationElement(i.data.id)||e.has(i.data.id))continue;const r=await this.deserialize(i);r&&(this.addOrRebuild(r),r.enableEditing())}P(this,Rd,!1)}disable(){var r;P(this,Tp,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const e=new Map,t=new Map;for(const s of d(this,Xr).values())if(s.disableEditing(),!!s.annotationElementId){if(s.serialize()!==null){e.set(s.annotationElementId,s);continue}else t.set(s.annotationElementId,s);(r=this.getEditableAnnotation(s.annotationElementId))==null||r.show(),s.remove()}if(d(this,Ra)){const s=d(this,Ra).getEditableAnnotations();for(const a of s){const{id:o}=a.data;if(d(this,De).isDeletedAnnotationElement(o))continue;let l=t.get(o);if(l){l.resetAnnotationElement(a),l.show(!1),a.show();continue}l=e.get(o),l&&(d(this,De).addChangedExistingAnnotation(l),l.renderAnnotationElement(a)&&l.show(!1)),a.show()}}z(this,Gt,zw).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:i}=this.div;for(const s of d(xs,au).values())i.remove(`${s._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),P(this,Tp,!1)}getEditableAnnotation(e){var t;return((t=d(this,Ra))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){d(this,De).getActive()!==e&&d(this,De).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=d(this,gi))!=null&&e.div&&!d(this,Do)){P(this,Do,new AbortController);const t=d(this,De).combinedSignal(d(this,Do));d(this,gi).div.addEventListener("pointerdown",z(this,Gt,h6).bind(this),{signal:t}),d(this,gi).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=d(this,gi))!=null&&e.div&&d(this,Do)&&(d(this,Do).abort(),P(this,Do,null),d(this,gi).div.classList.remove("highlighting"))}enableClick(){if(d(this,ru))return;P(this,ru,new AbortController);const e=d(this,De).combinedSignal(d(this,ru));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=d(this,ru))==null||e.abort(),P(this,ru,null)}attach(e){d(this,Xr).set(e.id,e);const{annotationElementId:t}=e;t&&d(this,De).isDeletedAnnotationElement(t)&&d(this,De).removeDeletedAnnotationElement(e)}detach(e){var t;d(this,Xr).delete(e.id),(t=d(this,$d))==null||t.removePointerInTextLayer(e.contentDiv),!d(this,Tp)&&e.annotationElementId&&d(this,De).addDeletedAnnotationElement(e)}remove(e){this.detach(e),d(this,De).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(d(this,De).addDeletedAnnotationElement(e.annotationElementId),en.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),d(this,De).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!d(this,Rd)),d(this,De).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var i;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!d(this,Po)&&(e._focusEventsAllowed=!1,P(this,Po,setTimeout(()=>{P(this,Po,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:d(this,De)._signal}),t.focus())},0))),e._structTreeParentId=(i=d(this,$d))==null?void 0:i.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),i=()=>{e.remove()};this.addCommands({cmd:t,undo:i,mustExec:!1})}getNextId(){return d(this,De).getId()}combinedSignal(e){return d(this,De).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=d(this,Gt,ha))==null?void 0:e.canCreateNewEmptyEditor()}pasteEditor(e,t){d(this,De).updateToolbar(e),d(this,De).updateMode(e);const{offsetX:i,offsetY:r}=z(this,Gt,w2).call(this),s=this.getNextId(),a=z(this,Gt,v2).call(this,{parent:this,id:s,x:i,y:r,uiManager:d(this,De),isCentered:!0,...t});a&&this.add(a)}async deserialize(e){var t;return await((t=d(xs,au).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,d(this,De)))||null}createAndAddNewEditor(e,t,i={}){const r=this.getNextId(),s=z(this,Gt,v2).call(this,{parent:this,id:r,x:e.offsetX,y:e.offsetY,uiManager:d(this,De),isCentered:t,...i});return s&&this.add(s),s}addNewEditor(){this.createAndAddNewEditor(z(this,Gt,w2).call(this),!0)}setSelected(e){d(this,De).setSelected(e)}toggleSelected(e){d(this,De).toggleSelected(e)}unselect(e){d(this,De).unselect(e)}pointerup(e){var i;const{isMac:t}=Oi.platform;if(!(e.button!==0||e.ctrlKey&&t)&&e.target===this.div&&d(this,su)&&(P(this,su,!1),!((i=d(this,Gt,ha))!=null&&i.isDrawer&&d(this,Gt,ha).supportMultipleDrawings))){if(!d(this,Ap)){P(this,Ap,!0);return}if(d(this,De).getMode()===Ze.STAMP){d(this,De).unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){var r;if(d(this,De).getMode()===Ze.HIGHLIGHT&&this.enableTextSelection(),d(this,su)){P(this,su,!1);return}const{isMac:t}=Oi.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(P(this,su,!0),(r=d(this,Gt,ha))!=null&&r.isDrawer){this.startDrawingSession(e);return}const i=d(this,De).getActive();P(this,Ap,!i||i.isEmpty())}startDrawingSession(e){if(this.div.focus(),d(this,Ms)){d(this,Gt,ha).startDrawing(this,d(this,De),!1,e);return}d(this,De).setCurrentDrawingSession(this),P(this,Ms,new AbortController);const t=d(this,De).combinedSignal(d(this,Ms));this.div.addEventListener("blur",({relatedTarget:i})=>{i&&!this.div.contains(i)&&(P(this,No,null),this.commitOrRemove())},{signal:t}),d(this,Gt,ha).startDrawing(this,d(this,De),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&P(this,No,t);return}d(this,No)&&setTimeout(()=>{var t;(t=d(this,No))==null||t.focus(),P(this,No,null)},0)}endDrawingSession(e=!1){return d(this,Ms)?(d(this,De).setCurrentDrawingSession(null),d(this,Ms).abort(),P(this,Ms,null),P(this,No,null),d(this,Gt,ha).endDrawing(e)):null}findNewParent(e,t,i){const r=d(this,De).findParent(t,i);return r===null||r===this?!1:(r.changeParent(e),!0)}commitOrRemove(){return d(this,Ms)?(this.endDrawingSession(),!0):!1}onScaleChanging(){d(this,Ms)&&d(this,Gt,ha).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=d(this,De).getActive())==null?void 0:e.parent)===this&&(d(this,De).commitOrRemove(),d(this,De).setActiveEditor(null)),d(this,Po)&&(clearTimeout(d(this,Po)),P(this,Po,null));for(const i of d(this,Xr).values())(t=d(this,$d))==null||t.removePointerInTextLayer(i.contentDiv),i.setParent(null),i.isAttachedToDOM=!1,i.div.remove();this.div=null,d(this,Xr).clear(),d(this,De).removeLayer(this)}render({viewport:e}){this.viewport=e,Zd(this.div,e);for(const t of d(this,De).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){d(this,De).commitOrRemove(),z(this,Gt,zw).call(this);const t=this.viewport.rotation,i=e.rotation;if(this.viewport=e,Zd(this.div,{rotation:i}),t!==i)for(const r of d(this,Xr).values())r.rotate(i)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return d(this,De).viewParameters.realScale}};$d=new WeakMap,Ap=new WeakMap,Ra=new WeakMap,ru=new WeakMap,Po=new WeakMap,Xr=new WeakMap,su=new WeakMap,Tp=new WeakMap,Rd=new WeakMap,Ms=new WeakMap,No=new WeakMap,gi=new WeakMap,Do=new WeakMap,De=new WeakMap,au=new WeakMap,Gt=new WeakSet,h6=function(e){d(this,De).unselectAll();const{target:t}=e;if(t===d(this,gi).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&d(this,gi).div.contains(t)){const{isMac:i}=Oi.platform;if(e.button!==0||e.ctrlKey&&i)return;d(this,De).showAllEditors("highlight",!0,!0),d(this,gi).div.classList.add("free"),this.toggleDrawing(),Wb.startHighlighting(this,d(this,De).direction==="ltr",{target:d(this,gi).div,x:e.x,y:e.y}),d(this,gi).div.addEventListener("pointerup",()=>{d(this,gi).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:d(this,De)._signal}),e.preventDefault()}},ha=function(){return d(xs,au).get(d(this,De).getMode())},v2=function(e){const t=d(this,Gt,ha);return t?new t.prototype.constructor(e):null},w2=function(){const{x:e,y:t,width:i,height:r}=this.div.getBoundingClientRect(),s=Math.max(0,e),a=Math.max(0,t),o=Math.min(window.innerWidth,e+i),l=Math.min(window.innerHeight,t+r),u=(s+o)/2-e,c=(a+l)/2-t,[h,f]=this.viewport.rotation%180===0?[u,c]:[c,u];return{offsetX:h,offsetY:f}},zw=function(){for(const e of d(this,Xr).values())e.isEmpty()&&e.remove()},ze(xs,"_initialized",!1),F(xs,au,new Map([ZS,p2,m2,Wb].map(e=>[e._editorType,e])));let _2=xs;var Os,K_,Ni,Pd,h1,f6,Ha,x2,p6,E2;const hi=class hi{constructor({pageIndex:e}){F(this,Ha);F(this,Os,null);F(this,K_,0);F(this,Ni,new Map);F(this,Pd,new Map);this.pageIndex=e}setParent(e){if(!d(this,Os)){P(this,Os,e);return}if(d(this,Os)!==e){if(d(this,Ni).size>0)for(const t of d(this,Ni).values())t.remove(),e.append(t);P(this,Os,e)}}static get _svgFactory(){return st(this,"_svgFactory",new qC)}draw(e,t=!1,i=!1){const r=Ii(this,K_)._++,s=z(this,Ha,x2).call(this),a=hi._svgFactory.createElement("defs");s.append(a);const o=hi._svgFactory.createElement("path");a.append(o);const l=`path_p${this.pageIndex}_${r}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),t&&d(this,Pd).set(r,o);const u=i?z(this,Ha,p6).call(this,a,l):null,c=hi._svgFactory.createElement("use");return s.append(c),c.setAttribute("href",`#${l}`),this.updateProperties(s,e),d(this,Ni).set(r,s),{id:r,clipPathId:`url(#${u})`}}drawOutline(e,t){const i=Ii(this,K_)._++,r=z(this,Ha,x2).call(this),s=hi._svgFactory.createElement("defs");r.append(s);const a=hi._svgFactory.createElement("path");s.append(a);const o=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){const h=hi._svgFactory.createElement("mask");s.append(h),l=`mask_p${this.pageIndex}_${i}`,h.setAttribute("id",l),h.setAttribute("maskUnits","objectBoundingBox");const f=hi._svgFactory.createElement("rect");h.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const m=hi._svgFactory.createElement("use");h.append(m),m.setAttribute("href",`#${o}`),m.setAttribute("stroke","none"),m.setAttribute("fill","black"),m.setAttribute("fill-rule","nonzero"),m.classList.add("mask")}const u=hi._svgFactory.createElement("use");r.append(u),u.setAttribute("href",`#${o}`),l&&u.setAttribute("mask",`url(#${l})`);const c=u.cloneNode();return r.append(c),u.classList.add("mainOutline"),c.classList.add("secondaryOutline"),this.updateProperties(r,e),d(this,Ni).set(i,r),i}finalizeDraw(e,t){d(this,Pd).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var l;if(!t)return;const{root:i,bbox:r,rootClass:s,path:a}=t,o=typeof e=="number"?d(this,Ni).get(e):e;if(o){if(i&&z(this,Ha,E2).call(this,o,i),r&&z(l=hi,h1,f6).call(l,o,r),s){const{classList:u}=o;for(const[c,h]of Object.entries(s))u.toggle(c,h)}if(a){const c=o.firstChild.firstChild;z(this,Ha,E2).call(this,c,a)}}}updateParent(e,t){if(t===this)return;const i=d(this,Ni).get(e);i&&(d(t,Os).append(i),d(this,Ni).delete(e),d(t,Ni).set(e,i))}remove(e){d(this,Pd).delete(e),d(this,Os)!==null&&(d(this,Ni).get(e).remove(),d(this,Ni).delete(e))}destroy(){P(this,Os,null);for(const e of d(this,Ni).values())e.remove();d(this,Ni).clear(),d(this,Pd).clear()}};Os=new WeakMap,K_=new WeakMap,Ni=new WeakMap,Pd=new WeakMap,h1=new WeakSet,f6=function(e,[t,i,r,s]){const{style:a}=e;a.top=`${100*i}%`,a.left=`${100*t}%`,a.width=`${100*r}%`,a.height=`${100*s}%`},Ha=new WeakSet,x2=function(){const e=hi._svgFactory.create(1,1,!0);return d(this,Os).append(e),e.setAttribute("aria-hidden",!0),e},p6=function(e,t){const i=hi._svgFactory.createElement("clipPath");e.append(i);const r=`clip_${t}`;i.setAttribute("id",r),i.setAttribute("clipPathUnits","objectBoundingBox");const s=hi._svgFactory.createElement("use");return i.append(s),s.setAttribute("href",`#${t}`),s.classList.add("clip"),r},E2=function(e,t){for(const[i,r]of Object.entries(t))r===null?e.removeAttribute(i):e.setAttribute(i,r)},F(hi,h1);let b2=hi;globalThis.pdfjsTestingUtils={HighlightOutliner:t2};Ge.AbortException;Ge.AnnotationEditorLayer;Ge.AnnotationEditorParamsType;Ge.AnnotationEditorType;Ge.AnnotationEditorUIManager;Ge.AnnotationLayer;Ge.AnnotationMode;Ge.ColorPicker;Ge.DOMSVGFactory;Ge.DrawLayer;Ge.FeatureTest;var Vte=Ge.GlobalWorkerOptions;Ge.ImageKind;Ge.InvalidPDFException;Ge.MissingPDFException;Ge.OPS;Ge.OutputScale;Ge.PDFDataRangeTransport;Ge.PDFDateString;Ge.PDFWorker;Ge.PasswordResponses;Ge.PermissionFlag;Ge.PixelsPerInch;Ge.RenderingCancelledException;Ge.TextLayer;Ge.TouchManager;Ge.UnexpectedResponseException;Ge.Util;Ge.VerbosityLevel;Ge.XfaLayer;Ge.build;Ge.createValidAbsoluteUrl;Ge.fetchData;var jte=Ge.getDocument;Ge.getFilenameFromUrl;Ge.getPdfFilenameFromUrl;Ge.getXfaPageViewport;Ge.isDataScheme;Ge.isPdfFile;Ge.noContextMenu;Ge.normalizeUnicode;Ge.setLayerDimensions;Ge.shadow;Ge.stopEvent;Ge.version;const Bte="/blood-report-fitness-evaluation-system/assets/pdf.worker-BgryrOlp.mjs";Vte.workerSrc=Bte;const Ute=({onBack:n,user:e,initialViewReport:t})=>{const[i,r]=xe.useState(null),[s,a]=xe.useState(null),[o,l]=xe.useState([]),[u,c]=xe.useState(!1),[h,f]=xe.useState(""),[m,y]=xe.useState([]),[_,x]=xe.useState({}),[v,w]=xe.useState(null),[E,k]=xe.useState(null),[$,L]=xe.useState("expert"),[I,C]=xe.useState(!1);xe.useEffect(()=>{const G=e&&e.email?`reports_${e.email}`:`temp_reports_${Date.now()}`,W=localStorage.getItem(G);l(W?JSON.parse(W):[]),t&&a(t)},[e,t]);const N=G=>new Promise(W=>{const K=new Image;K.src=URL.createObjectURL(G),K.onload=()=>{const H=document.createElement("canvas"),Q=H.getContext("2d");H.width=K.width,H.height=K.height,Q.drawImage(K,0,0);const Y=Q.getImageData(0,0,H.width,H.height),Z=Y.data,fe=50,_e=259*(fe+255)/(255*(259-fe));for(let X=0;X<Z.length;X+=4){const de=(Z[X]+Z[X+1]+Z[X+2])/3;let Ee=_e*(de-128)+128;Ee<0&&(Ee=0),Ee>255&&(Ee=255),Z[X]=Ee,Z[X+1]=Ee,Z[X+2]=Ee}Q.putImageData(Y,0,0),H.toBlob(X=>{W(X)})}}),O=G=>{console.log("Processing Extracted Text (Gen-2 Engine)..."),console.log("--- RAW EXTRACTED TEXT ---"),console.log(G),console.log("--------------------------");const W=G.split(`
`),K={};let H={Age:30,Gender:"M"};for(let X=0;X<Math.min(W.length,20);X++){const de=W[X].toLowerCase();if(de.includes("age")){const Ee=de.match(/(\d{1,3})/);Ee&&(H.Age=parseInt(Ee[0]))}de.includes("male")||de.includes("sex : m")?H.Gender="M":(de.includes("female")||de.includes("sex : f"))&&(H.Gender="F")}const Q=(X,de)=>{const Ee=[];for(let $e=0;$e<=de.length;$e++)Ee[$e]=[$e];for(let $e=0;$e<=X.length;$e++)Ee[0][$e]=$e;for(let $e=1;$e<=de.length;$e++)for(let je=1;je<=X.length;je++)de.charAt($e-1)===X.charAt(je-1)?Ee[$e][je]=Ee[$e-1][je-1]:Ee[$e][je]=Math.min(Ee[$e-1][je-1]+1,Math.min(Ee[$e][je-1]+1,Ee[$e-1][je]+1));return Ee[de.length][X.length]},Y=(X,de)=>{const Ee=X.toLowerCase().replace(/[^a-z0-9]/g,""),$e=de.toLowerCase().replace(/[^a-z0-9]/g,"");if(Ee.includes($e))return!0;const je=$e.length>5?2:1;return Ee.split(/(?:[a-z]+)/).filter(nt=>nt.length>=3).some(nt=>Math.abs(nt.length-$e.length)<=je&&Q(nt,$e)<=je)};let Z=0;const fe=["investigation","test name","result","observed value","unit","reference range","biological reference"];for(let X=0;X<W.length;X++){const de=W[X].toLowerCase();if(fe.some(Ee=>de.includes(Ee))){Z=X,console.log(`Table header detected at line ${X}. Ignoring previous text.`);break}}W.slice(Z).forEach(X=>{const de=X.toLowerCase().trim();!de||["patient","name:","age:","sex:","gender:","id:","referred by:","dr.","date:","time:"].some($e=>de.includes($e))||Object.keys(bP).forEach($e=>{let je=$e;if($e==="total_count"&&(de.includes("10^12")||de.includes("x10^12"))&&(console.log("Auto-Correcting 'White Blood Cell' to 'RBC' based on 10^12 unit"),je="rbc_count"),K[je])return;const nt=bP[je].find(Et=>{const Xt=de.replace(/[^a-z0-9\s]/g,"");return Xt.includes(Et)?!0:Et.split(" ").every(Yn=>Xt.includes(Yn)||Y(Xt,Yn))});if(nt){console.log(` Potential match found for ${je} via synonym: "${nt}" in row: "${de}"`);let Et=de.replace(/(\d)\s+[\.,]\s+(\d)/g,"$1.$2").replace(/(\d)\s+[\.,](?=\d)/g,"$1.").replace(new RegExp("(?<=\\d)[\\.,]\\s+(\\d)","g"),".$1");["total_count","platelet_count","absolute_neutrophil_count"].includes(je)?Et=Et.replace(/,/g,""):Et=Et.replace(/,/g,".");let Xt=Et;Xt=Xt.replace(/(\d+\.?\d*)\s*-\s*(\d+\.?\d*)/g,"   "),Xt=Xt.replace(/(\d+\.?\d*)\s+to\s+(\d+\.?\d*)/gi,"   "),Xt=Xt.replace(/[<>]\s*\d+(\.\d+)?/g,"   "),Xt=Xt.replace(/[oO](?=\d)/g,"0").replace(new RegExp("(?<=\\d)[oO]","g"),"0").replace(/\.\./g,".");const Yn=Xt.match(/(\d+\.?\d*)/g);if(Yn){let ls=null;for(const or of Yn){let Mt=parseFloat(or);if(isNaN(Mt)||Mt>1900&&Mt<2100&&je!=="total_count"||Mt===0&&je!=="basophil")continue;const Rt=nf[je];if(Rt){const Ga=[1,10,100,1e3,.1,.01,.001];let Ka=null,al=1/0;for(let lr of Ga){const it=Mt*lr,ol=Rt.min*.2,qu=Rt.max*3;if(it>=ol&&it<=qu){let ji;it<Rt.min?ji=Rt.min-it:it>Rt.max?ji=it-Rt.max:ji=0,lr===1&&(ji*=.9),ji<al&&(al=ji,Ka=it)}}if(Ka!==null){ls=Ka;break}}else{ls=Mt;break}}ls!==null&&(K[je]=ls)}}})}),Object.keys(K).length===0&&G.length>50&&console.warn("No values extracted despite text content."),U(K,H)},V=async G=>{try{const{collection:W,addDoc:K,serverTimestamp:H}=await cb(async()=>{const{collection:Z,addDoc:fe,serverTimestamp:_e}=await Promise.resolve().then(()=>dX);return{collection:Z,addDoc:fe,serverTimestamp:_e}},[]),{db:Q}=await cb(async()=>{const{db:Z}=await Promise.resolve().then(()=>BX);return{db:Z}},void 0),Y={userId:e?e.uid:"anonymous",userEmail:e?e.email:"anonymous",timestamp:H(),mode:$,values:G.values,risks:G.risks||[],mlPredictions:G.mlPredictions||[],summary:$==="expert"?"Expert Rule Analysis":"ML Model Analysis"};await K(W(Q,"reports"),Y),console.log(" Report saved to Firestore")}catch(W){console.error(" Error saving to Firestore:",W)}},U=async(G,W={Age:30,Gender:"M"})=>{let K=[],H=null;if($==="expert")console.log(" Running Expert Mode (Rule-Based System)..."),K=Pz(G);else if($==="ml")try{console.log(" Running Advanced ML Mode...");const fe={Total_Leukocyte_Count:G.total_count||0,RBC_Count:G.rbc_count||0,Hemoglobin:G.hemoglobin||0,Hematocrit:G.hematocrit||0,MCV:G.mcv||0,MCH:G.mch||0,MCHC:G.mchc||0,RDW_CV:G.rdw||0,Platelet_Count:G.platelet_count||0,Neutrophils:G.neutrophil||0,Lymphocytes:G.lymphocyte||0,Monocytes:G.monocyte||0,Eosinophils:G.eosinophil||0,Basophils:G.basophil||0,Absolute_Neutrophil_Count:G.absolute_neutrophil_count||0,Absolute_Lymphocyte_Count:G.absolute_lymphocyte_count||0},_e=await fetch("https://blood-report-fitness-evaluation-system.onrender.com/predict",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(fe)});if(_e.ok){const X=await _e.json();X.status==="success"&&(H={prediction:X.prediction,confidence:X.confidence},console.log(` ML Assessment: ${X.prediction}`))}}catch(fe){console.warn("ML Service unavailable:",fe),w(" ML Service Offline. Please start the backend server.")}const Q=$==="expert"?K:[],Y=$==="ml"&&H?[{disease:"AI Health Score",warning:`ML Assessment: ${H.prediction} (${H.confidence} Confidence)`,probability:H.confidence,isDetected:H.prediction!=="Normal",isSupplementary:!1}]:[],Z={date:new Date().toLocaleDateString(),values:G,risks:Q,mlPredictions:Y};te(Z),await V(Z),c(!1),f("")},j=async G=>{c(!0),f(" Scanning PDF..."),f(" Using local extraction (fallback)...");try{const W=await G.arrayBuffer(),K=await jte(W).promise;let H="",Q={},Y=$==="ml";for(let Z=1;Z<=K.numPages;Z++){f(`Scanning Page ${Z} of ${K.numPages}...`);const fe=await K.getPage(Z);if(Y){const de=fe.getViewport({scale:2.5}),Ee=document.createElement("canvas"),$e=Ee.getContext("2d");Ee.height=de.height,Ee.width=de.width,await fe.render({canvasContext:$e,viewport:de}).promise;const je=await new Promise(He=>Ee.toBlob(He,"image/png"));if(je)try{const He=new FormData;He.append("image",je);const nt=await fetch("https://blood-report-fitness-evaluation-system.onrender.com/ocr",{method:"POST",body:He});if(nt.ok){const Et=await nt.json();if(Et.success&&Et.detected_values){Q={...Q,...Et.detected_values};continue}}}catch(He){console.error("Backend OCR failed for PDF page, falling back:",He)}}const X=(await fe.getTextContent()).items.map(de=>de.str).join(`
`);if(X.length>50)H+=X+`
`;else{const de=fe.getViewport({scale:2.5}),Ee=document.createElement("canvas"),$e=Ee.getContext("2d");Ee.height=de.height,Ee.width=de.width,await fe.render({canvasContext:$e,viewport:de}).promise;const je=await new Promise(He=>Ee.toBlob(He,"image/png"));if(je){const{data:{text:He}}=await GT.recognize(je,"eng");H+=He+`
`}}}Y&&Object.keys(Q).length>0?(f("Mapping AI results..."),k(Q),c(!1)):H.length>20?(f("Analyzing compiled report..."),O(H)):(alert("Could not extract meaningful text from this PDF."),c(!1))}catch(W){console.error(W),alert("Error processing PDF: "+W.message),c(!1)}},he=async(G,W=!1)=>{c(!0),f("Preprocessing Image...");try{if($==="ml")try{f("Analyzing with Advanced AI...");const Y=new FormData;Y.append("image",G);const Z=await fetch("https://blood-report-fitness-evaluation-system.onrender.com/ocr",{method:"POST",body:Y});if(Z.ok){const fe=await Z.json();if(fe.success&&fe.detected_values&&Object.keys(fe.detected_values).length>0){console.log(" Using Backend OCR Results:",fe);const _e=fe.corrections?Object.keys(fe.corrections).length:0;_e>0&&(f(`Corrected ${_e} values with AI...`),await new Promise($e=>setTimeout($e,1e3)));let X={Age:30,Gender:"M"};const de=fe.raw_text.toLowerCase(),Ee=de.match(/age\s*[:\-\.]?\s*(\d{1,3})/);Ee&&(X.Age=parseInt(Ee[1])),(de.includes("female")||de.includes("sex: f"))&&(X.Gender="F"),k(fe.detected_values),c(!1);return}}}catch(Y){console.warn("Backend OCR unavailable, falling back to local Tesseract:",Y)}f("Scanning Text (Local)...");const H=!W&&I?await N(G):G,{data:{text:Q}}=await GT.recognize(H,"eng",{logger:Y=>f(`${Y.status} (${Math.round(Y.progress*100)}%)`)});O(Q)}catch(K){console.error(K),alert("Error scanning image. Please check the file and try again."),c(!1)}},me=G=>{const W=G.target.files[0];W&&(W.type==="application/pdf"?j(W):W.type.startsWith("image/")?(r(W),he(W)):alert("Please upload an Image (JPG/PNG) or PDF report."))},te=G=>{const W=Nz(G.values,G.risks);G.mlPredictions&&(W.mlPredictions=G.mlPredictions),a(W);const K=e&&e.email?`reports_${e.email}`:`temp_reports_${Date.now()}`,H=JSON.parse(localStorage.getItem(K)||"[]"),Q=[W,...H];l(Q),localStorage.setItem(K,JSON.stringify(Q))},oe=()=>E?T.jsxs("div",{className:"review-card fade-in",children:[T.jsxs("div",{className:"card-header-gradient",children:[T.jsx(lQ,{size:24,color:"white"}),T.jsx("h3",{children:"Review AI Extraction"})]}),T.jsx("p",{className:"text-muted",style:{margin:"10px 0"},children:"The AI found these values in your report. Please verify they are correct."}),T.jsxs("div",{className:"review-table",children:[T.jsxs("div",{className:"table-header",children:[T.jsx("span",{children:"Parameter"}),T.jsx("span",{children:"Value"})]}),Object.entries(E).map(([G,W])=>T.jsxs("div",{className:"review-row",children:[T.jsx("span",{className:"param-label",children:G.toUpperCase().replace(/_/g," ")}),T.jsx("input",{type:"number",className:"edit-input",value:W,onChange:K=>k({...E,[G]:parseFloat(K.target.value)})})]},G))]}),T.jsxs("div",{className:"review-actions",children:[T.jsx("button",{className:"btn-outline",onClick:()=>k(null),children:"Cancel"}),T.jsx("button",{className:"btn-primary",onClick:()=>{U(E),k(null)},children:"Confirm & Analyze"})]}),T.jsx("style",{children:`
                        .review-card { background: white; border-radius: 16px; padding: 0; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
                        .card-header-gradient { background: linear-gradient(135deg, #6366f1, #a855f7); padding: 20px; color: white; display: flex; align-items: center; gap: 12px; }
                        .review-table { padding: 10px 20px; }
                        .table-header { display: flex; justify-content: space-between; font-weight: 700; color: #475569; padding: 10px 0; border-bottom: 2px solid #f1f5f9; font-size: 13px; }
                        .review-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f8fafc; }
                        .param-label { color: #64748b; font-size: 14px; font-weight: 500; }
                        .edit-input { width: 80px; padding: 6px; border: 1px solid #e2e8f0; border-radius: 6px; text-align: right; font-weight: 700; color: #1e293b; }
                        .review-actions { display: flex; gap: 10px; padding: 20px; background: #f8fafc; }
                        .btn-outline { flex: 1; padding: 12px; border: 1px solid #e2e8f0; background: white; border-radius: 12px; cursor: pointer; font-weight: 600; }
                    `})]}):T.jsxs("div",{className:"evaluation-card",children:[T.jsxs("div",{className:"mode-toggle-container",children:[T.jsx("label",{className:"mode-label",children:"Analysis Mode:"}),T.jsxs("div",{className:"mode-switch",children:[T.jsx("button",{className:`mode-btn ${$==="expert"?"active":""}`,onClick:()=>L("expert"),children:" Expert"}),T.jsx("button",{className:`mode-btn ${$==="manual"?"active":""}`,onClick:()=>L("manual"),children:" Manual"}),T.jsx("button",{className:`mode-btn ${$==="ml"?"active":""}`,onClick:()=>L("ml"),children:" ML"})]}),T.jsx("p",{className:"mode-desc",children:$==="expert"?"Rule-based expert system. Specific & verified diagnosis.":$==="manual"?"Enter results manually. Select up to 20 parameters.":"Experimental AI model. Predicts overall health risk."}),v&&$==="ml"&&T.jsx("div",{className:"error-banner",style:{background:"#fee2e2",color:"#b91c1c",padding:"10px",borderRadius:"8px",marginTop:"10px",fontSize:"13px",textAlign:"center"},children:v})]}),T.jsx("div",{className:"divider"}),$==="manual"?T.jsxs("div",{className:"card manual-scanner-card",children:[T.jsx("h3",{children:" Manual Scanner"}),T.jsx("p",{className:"sub-label",children:"Select up to 20 parameters and enter values."}),T.jsxs("div",{className:"param-counter",style:{margin:"15px 0",padding:"10px",background:"#f0f9ff",borderRadius:"8px",textAlign:"center",fontSize:"14px",fontWeight:"600",color:"#0369a1"},children:["Selected: ",m.length,"/20"]}),T.jsx("div",{className:"param-select-row",style:{marginBottom:"20px"},children:T.jsxs("select",{className:"input-field",onChange:G=>{const W=G.target.value;W&&!m.includes(W)&&m.length<20&&(y([...m,W]),x({..._,[W]:""})),G.target.value=""},disabled:m.length>=20,style:{width:"100%"},children:[T.jsxs("option",{value:"",children:["+ Add Parameter (",50-m.length," available)"]}),Object.keys(nf).filter(G=>!m.includes(G)).map(G=>T.jsxs("option",{value:G,children:[G.replace(/_/g," ").replace(/\b\w/g,W=>W.toUpperCase())," (",nf[G].unit,")"]},G))]})}),T.jsx("div",{className:"manual-inputs-grid",style:{maxHeight:"400px",overflowY:"auto",marginBottom:"20px"},children:m.map(G=>T.jsxs("div",{className:"manual-input-row",style:{display:"flex",gap:"10px",marginBottom:"12px",alignItems:"center"},children:[T.jsx("label",{style:{flex:"1",fontSize:"13px",fontWeight:"500"},children:G.replace(/_/g," ").replace(/\b\w/g,W=>W.toUpperCase())}),T.jsx("input",{type:"number",step:"0.01",className:"input-field",placeholder:`Enter ${nf[G].unit}`,value:_[G]||"",onChange:W=>x({..._,[G]:W.target.value}),style:{flex:"0.6"}}),T.jsx("button",{type:"button",onClick:()=>{y(m.filter(K=>K!==G));const W={..._};delete W[G],x(W)},style:{background:"#fee2e2",color:"#991b1b",border:"none",borderRadius:"4px",padding:"6px 10px",cursor:"pointer",fontSize:"12px"},children:""})]},G))}),m.length>0&&T.jsxs("button",{className:"btn-primary",onClick:()=>{const G={};if(m.forEach(W=>{const K=parseFloat(_[W]);isNaN(K)||(G[W]=K)}),Object.keys(G).length===0){alert("Please enter at least one value.");return}U(G,{})},style:{width:"100%"},children:[" Analyze Health (",Object.values(_).filter(G=>G).length," values)"]})]}):T.jsx(T.Fragment,{children:T.jsxs("div",{className:"upload-card",children:[T.jsx("div",{className:"icon-circle",children:T.jsx(Sz,{size:32,color:"var(--color-primary)"})}),T.jsx("h3",{children:"Upload Report Image"}),T.jsx("p",{children:"Take a clear photo of your report. AI will scan for values."}),T.jsx("div",{style:{marginBottom:"15px"},children:T.jsxs("label",{className:"checkbox-container",children:[T.jsx("input",{type:"checkbox",checked:I,onChange:G=>C(G.target.checked)}),T.jsx("span",{className:"checkmark"}),"Enable Digital Lens (Enhance Image)"]})}),T.jsxs("label",{className:"btn-secondary upload-btn",children:[u?h||"Scanning...":"Select Image (JPG/PNG)",T.jsx("input",{type:"file",accept:"image/*,application/pdf",hidden:!0,onChange:me,disabled:u})]})]})}),T.jsx("div",{className:"divider"}),o.length>0&&T.jsxs("div",{className:"history-section",children:[T.jsx("h3",{children:"Recent Reports"}),o.map((G,W)=>T.jsxs("div",{className:"history-item",onClick:()=>a(G),children:[T.jsx(oC,{size:18,className:"text-muted"}),T.jsx("span",{children:G.date}),T.jsx("span",{className:"arrow",children:""})]},W))]})]});return T.jsxs("div",{className:"blood-container fade-in",children:[T.jsxs("div",{className:"header-row",children:[T.jsx("button",{onClick:n,className:"back-btn",children:T.jsx(tl,{size:24})}),T.jsx("h2",{children:"Blood Evaluation"})]}),s?T.jsxs("div",{className:"results-section fade-in",children:[T.jsxs("div",{className:"results-header",children:[T.jsx("h3",{children:"Report Analysis"}),T.jsx("button",{className:"text-btn",onClick:()=>a(null),children:"Close"})]}),s.mlPredictions&&T.jsx(VZ,{predictions:s.mlPredictions}),s.risks&&s.risks.length>0&&T.jsxs("div",{className:"risk-container fade-up",children:[T.jsx("h4",{children:" AI Health Risk Detection"}),T.jsx("div",{className:"risk-grid",children:s.risks.map((G,W)=>T.jsxs("div",{className:"risk-card",style:{borderLeft:`4px solid ${G.color}`},children:[T.jsxs("div",{className:"risk-header",children:[T.jsx("span",{className:"condition-title",children:G.condition}),T.jsx("span",{className:"risk-badge",style:{background:G.color},children:G.risk})]}),T.jsx("p",{className:"risk-advice",children:G.advice}),T.jsx("button",{className:"view-details",onClick:()=>alert(`Detailed explanation for ${G.condition}: 

This condition was flagged based on your values. Please consult a doctor for verification.`),children:"View Details"})]},W))})]}),T.jsx("div",{className:"params-list",children:s.results.map((G,W)=>T.jsxs("div",{className:"param-card",children:[T.jsxs("div",{className:"param-header",children:[T.jsx("h4",{children:G.parameter.replace(/_/g," ").toUpperCase()}),T.jsxs("span",{className:`status-badge ${G.status.toLowerCase()}`,children:[G.status==="Normal"&&T.jsx(ZX,{size:14}),G.status==="High"&&T.jsx(GX,{size:14}),G.status==="Low"&&T.jsx(Az,{size:14}),G.status]})]}),T.jsxs("div",{className:"param-value",children:[T.jsx("span",{className:"val",children:G.value}),T.jsx("span",{className:"unit",children:G.unit})]}),T.jsxs("p",{className:"range-info",children:["Ref Range: ",G.range]})]},W))}),s.suggestions.length>0&&T.jsxs("div",{className:"suggestions-box",children:[T.jsx("h3",{children:" Health & Fitness Recommendations"}),s.suggestions.map((G,W)=>T.jsxs("div",{className:"suggestion-item",children:[T.jsx("div",{className:"suggestion-header",children:T.jsxs("strong",{children:[G.status," ",G.parameter.replace(/_/g," ").toUpperCase()]})}),G.foods.length>0&&T.jsxs("p",{className:"food-list",children:[" ",T.jsx("b",{children:"Diety Tip:"})," Eat ",G.foods.join(", ")]}),G.fitnessImpact&&T.jsxs("p",{className:"fitness-list",children:[" ",T.jsx("b",{children:"Fitness Impact:"})," ",G.fitnessImpact]})]},W))]})]}):oe(),T.jsx("style",{children:`
        .blood-container {
           padding: var(--spacing-md);
        }
        /* ... Existing Styles ... */
        /* Risk Styles */
        .risk-container {
            background: #fffafa; border: 1px solid #fee2e2; padding: 15px; border-radius: 12px; margin-bottom: 20px;
        }
        .risk-container h4 { color: #b91c1c; margin-top: 0; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        .risk-grid { display: flex; flex-direction: column; gap: 10px; }
        .risk-card { background: white; padding: 12px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .risk-header { display: flex; justify-content: space-between; margin-bottom: 5px; align-items: center; }
        .condition-title { font-weight: 700; color: #1f2937; }
        .risk-badge { font-size: 10px; color: white; padding: 2px 8px; border-radius: 99px; font-weight: 700; text-transform: uppercase; }
        .risk-advice { font-size: 13px; color: #4b5563; margin: 0; line-height: 1.4; }
        .view-details { margin-top: 8px; font-size: 11px; background: white; border: 1px solid #e5e7eb; padding: 4px 10px; border-radius: 4px; cursor: pointer; }
        
        .header-row {
           display: flex;
           align-items: center;
           gap: var(--spacing-md);
           margin-bottom: var(--spacing-lg);
        }
        .back-btn, .text-btn {
           background: transparent;
           color: var(--color-text-main);
           padding: 0;
           font-weight: 600;
        }

        .card {
           background: white;
           padding: var(--spacing-md);
           border-radius: var(--radius-md);
           box-shadow: var(--shadow-sm);
           margin-bottom: var(--spacing-lg);
        }

        /* Manual Entry */
        .manual-card h3 { font-size: var(--font-size-base); margin-bottom: 5px; }
        .sub-label { font-size: 12px; color: var(--color-text-secondary); margin-bottom: 15px; }
        .manual-form {
           display: flex;
           flex-direction: column;
           gap: 10px;
        }
        .manual-form .row { display: flex; gap: 10px; }
        .manual-form .input-field { 
            padding: 10px; 
            border: 1px solid #e2e8f0; 
            border-radius: var(--radius-sm); 
            flex: 1;
            font-size: 14px;
        }
        .small-btn { padding: 10px; width: 100%; display: flex; justify-content: center; gap: 8px; }

        .manual-result {
            margin-top: 15px;
            padding: 10px;
            background: #f8fafc;
            border-radius: var(--radius-sm);
            border-left: 3px solid var(--color-text-muted);
        }
        .result-badge {
            display: inline-block;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 99px;
            margin-bottom: 5px;
            text-transform: uppercase;
        }
        .result-badge.normal { background: #dcfce7; color: #166534; border-color: #166534; }
        .result-badge.high { background: #fee2e2; color: #991b1b; }
        .result-badge.low { background: #fef9c3; color: #854d0e; }
        
        .diet-tip { margin-top: 8px; font-size: 12px; color: #155724; background: #d4edda; padding: 5px; border-radius: 4px; }

        .divider { text-align: center; color: var(--color-text-muted); font-size: 12px; margin: 20px 0; font-weight: bold; }

        .upload-card {
           text-align: center;
           padding: 20px;
           background: #F8F9FA;
           border: 1px dashed #cbd5e1;
           border-radius: var(--radius-lg);
        }
        .icon-circle {
           width: 60px; height: 60px;
           background: #eef2ff;
           border-radius: 50%;
           display: flex; align-items: center; justify-content: center;
           margin: 0 auto 15px;
        }
        .upload-btn {
           display: inline-block;
           margin-top: 15px;
           font-size: 14px;
           padding: 8px 16px;
           background: white; border: 1px solid #e2e8f0; border-radius: 99px;
        }

        .results-header {
           display: flex; justify-content: space-between; align-items: center;
           margin-bottom: 20px;
        }
        .params-list { display: grid; gap: 10px; }
        .param-card {
           background: white; padding: 15px; border-radius: var(--radius-md); box-shadow: var(--shadow-sm);
        }
        .param-header { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .status-badge { font-size: 10px; padding: 2px 8px; border-radius: 99px; font-weight: bold; float: right; }
        .status-badge.normal { background: #dcfce7; color: #166534; }
        .status-badge.high { background: #fee2e2; color: #991b1b; }
        .status-badge.low { background: #fef9c3; color: #854d0e; }

        .param-value .val { font-size: 18px; font-weight: bold; margin-right: 5px; }
        .param-value .unit { font-size: 12px; color: #64748b; }
        .range-info { font-size: 10px; color: #94a3b8; margin-top: 2px; }

        .suggestions-box { margin-top: 20px; background: #fffbeb; padding: 15px; border-radius: var(--radius-md); border-left: 4px solid #f59e0b; }
        .suggestions-box h3 { font-size: 14px; margin-bottom: 12px; color: #92400e; display: flex; align-items: center; gap: 8px; }
        .suggestion-item { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #fef3c7; }
        .suggestion-item:last-child { border-bottom: none; }
        .suggestion-header { margin-bottom: 6px; color: #92400e; }
        .food-list, .fitness-list { font-size: 11px; margin-top: 4px; line-height: 1.4; color: #78350f; }
        .fitness-list { font-style: italic; color: #b45309; }
        .fitness-tip { margin-top: 8px; font-size: 11px; color: #b45309; background: #fffbeb; padding: 8px; border-radius: 4px; border: 1px dashed #f59e0b; }

        .scan-mode-toggle {
            display: flex; justify-content: center; gap: 10px; margin: 15px 0;
        }
        .mode-btn {
            padding: 6px 12px;
            font-size: 12px;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 99px;
            cursor: pointer;
            position: relative;
        }
        .mode-btn.active {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }
        .dot {
            width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-left: 5px;
        }
        .dot.online { background: #22c55e; }
        .dot.offline { background: #ef4444; }
      `})]})},z0={breakfast:[{name:"Puttu & Kadala Curry",cal:450},{name:"Appam & Egg Roast",cal:400},{name:"Idli & Sambar",cal:300},{name:"Dosa & Chutney",cal:350},{name:"Oats Upma",cal:250}],lunch:[{name:"Kerala Rice Meals with Fish Curry",cal:650},{name:"Red Rice, Thoran & Curd",cal:500},{name:"Biriyani (Chicken)",cal:800},{name:"Kanji & Payar",cal:400}],snack:[{name:"Banana Fry (Pazham Pori) - 2 pcs",cal:300},{name:"Tea & Vada",cal:250},{name:"Fruit Salad",cal:150},{name:"Nuts & Dates",cal:200}],dinner:[{name:"Chapati & Veg Curry",cal:400},{name:"Wheat Porotta & Chicken",cal:600},{name:"Kanji (Rice Gruel)",cal:300},{name:"Salad & Grilled Fish",cal:350}]},Hte=({userProfile:n,onBack:e})=>{const[t,i]=xe.useState(null),[r,s]=xe.useState(0),[a,o]=xe.useState(null);xe.useEffect(()=>{t&&n&&u()},[t]);const l=()=>{if(!n)return 2e3;const{weight:c,heightCm:h,age:f,gender:m}=n;let y=10*c+6.25*h-5*f;m==="male"?y+=5:y-=161;let _=Math.round(y*1.375);return t==="loss"?_-500:t==="gain"?_+500:_},u=()=>{const c=l();s(c);const h=f=>f[Math.floor(Math.random()*f.length)];o({breakfast:h(z0.breakfast),lunch:h(z0.lunch),snack:h(z0.snack),dinner:h(z0.dinner)})};return T.jsxs("div",{className:"fitness-container fade-in",children:[T.jsxs("div",{className:"header-row",children:[T.jsx("button",{onClick:e,className:"back-btn",children:T.jsx(tl,{size:24})}),T.jsx("h2",{children:"Fitness Helper"})]}),t?T.jsxs("div",{className:"plan-view fade-in",children:[T.jsxs("div",{className:"summary-card",children:[T.jsxs("div",{className:"cal-target",children:[T.jsx("span",{className:"label",children:"Daily Target"}),T.jsx("h1",{children:r}),T.jsx("span",{className:"unit",children:"kcal"})]}),T.jsx("div",{className:"goal-badge",children:t==="loss"?"Weight Loss":t==="gain"?"Weight Gain":"Maintain"}),T.jsx("button",{className:"change-btn",onClick:()=>i(null),children:"Change Goal"})]}),T.jsxs("div",{className:"meals-list",children:[T.jsx("h3",{children:" Today's Kerala Diet Plan"}),a&&T.jsxs(T.Fragment,{children:[T.jsx(V0,{type:"Breakfast",icon:T.jsx(pP,{size:18}),data:a.breakfast}),T.jsx(V0,{type:"Lunch",icon:T.jsx(Bg,{size:18}),data:a.lunch}),T.jsx(V0,{type:"Snack",icon:T.jsx(pP,{size:18}),data:a.snack}),T.jsx(V0,{type:"Dinner",icon:T.jsx(Bg,{size:18}),data:a.dinner})]})]})]}):T.jsxs("div",{className:"goal-selection",children:[T.jsx("h3",{children:"What is your goal?"}),T.jsxs("button",{className:"goal-card",onClick:()=>i("loss"),children:[T.jsx("div",{className:"icon-box loss",children:T.jsx(dQ,{size:24})}),T.jsxs("div",{className:"text",children:[T.jsx("h4",{children:"Weight Loss"}),T.jsx("p",{children:"Reduce body fat locally."})]})]}),T.jsxs("button",{className:"goal-card",onClick:()=>i("maintain"),children:[T.jsx("div",{className:"icon-box maintain",children:T.jsx(yQ,{size:24})}),T.jsxs("div",{className:"text",children:[T.jsx("h4",{children:"Maintain Weight"}),T.jsx("p",{children:"Stay healthy and fit."})]})]}),T.jsxs("button",{className:"goal-card",onClick:()=>i("gain"),children:[T.jsx("div",{className:"icon-box gain",children:T.jsx(Bg,{size:24})}),T.jsxs("div",{className:"text",children:[T.jsx("h4",{children:"Weight Gain"}),T.jsx("p",{children:"Build muscle mass."})]})]})]}),T.jsx("style",{children:`
        .fitness-container {
           padding: var(--spacing-md);
        }
        .header-row {
           display: flex;
           align-items: center;
           gap: var(--spacing-md);
           margin-bottom: var(--spacing-xl);
        }
        .back-btn {
           background: transparent;
           color: var(--color-text-main);
           padding: 0;
        }
        .goal-selection {
           display: flex;
           flex-direction: column;
           gap: var(--spacing-md);
        }
        .goal-selection h3 {
           text-align: center;
           margin-bottom: var(--spacing-md);
        }
        .goal-card {
           display: flex;
           align-items: center;
           gap: var(--spacing-md);
           background: white;
           padding: var(--spacing-md);
           border-radius: var(--radius-lg);
           box-shadow: var(--shadow-sm);
           text-align: left;
           width: 100%;
           transition: transform 0.2s;
        }
        .goal-card:active { transform: scale(0.98); }
        .icon-box {
           width: 50px;
           height: 50px;
           border-radius: var(--radius-md);
           display: flex;
           align-items: center;
           justify-content: center;
           color: white;
        }
        .icon-box.loss { background: #FF6B6B; }
        .icon-box.maintain { background: #4CC9F0; }
        .icon-box.gain { background: #4ECDC4; }
        
        .summary-card {
           background: linear-gradient(135deg, #1D3557 0%, #457B9D 100%);
           color: white;
           padding: var(--spacing-lg);
           border-radius: var(--radius-lg);
           text-align: center;
           margin-bottom: var(--spacing-xl);
           box-shadow: var(--shadow-md);
           position: relative;
        }
        .cal-target h1 {
           font-size: 3rem;
           line-height: 1;
           margin: 10px 0;
        }
        .change-btn {
           position: absolute;
           top: 10px;
           right: 10px;
           background: rgba(255,255,255,0.2);
           color: white;
           font-size: 10px;
           padding: 4px 8px;
           border-radius: var(--radius-full);
        }

        .meals-list h3 {
           margin-bottom: var(--spacing-md);
        }
        .meal-card {
           background: white;
           padding: var(--spacing-md);
           border-radius: var(--radius-md);
           margin-bottom: var(--spacing-sm);
           box-shadow: var(--shadow-sm);
           display: flex;
           justify-content: space-between;
           align-items: center;
        }
        .meal-info h4 {
           font-size: var(--font-size-sm);
           color: var(--color-text-secondary);
           margin-bottom: 2px;
           display: flex;
           align-items: center;
           gap: 6px;
        }
        .meal-info p {
           font-weight: 600;
           color: var(--color-text-main);
        }
        .meal-cal {
           font-size: var(--font-size-sm);
           color: var(--color-primary);
           font-weight: bold;
        }
      `})]})},V0=({type:n,icon:e,data:t})=>T.jsxs("div",{className:"meal-card",children:[T.jsxs("div",{className:"meal-info",children:[T.jsxs("h4",{children:[e," ",n]}),T.jsx("p",{children:t.name})]}),T.jsxs("div",{className:"meal-cal",children:[t.cal," kcal"]})]}),Wte=[{id:1,name:"Jumping Jacks",calories:"10-15 cal/min",duration:"1 min",desc:"Full body cardio warm-up.",steps:["Stand with feet together, hands at sides.","Jump legs apart and raise arms overhead.","Jump back to starting position.","Repeat quickly."]},{id:2,name:"Push-ups",calories:"0.3-0.6 cal/rep",duration:"15-20 reps",desc:"Strengthens chest, shoulders, and triceps.",steps:["Start in plank position.","Lower chest to floor.","Push back up strongly.","Keep core tight."]},{id:3,name:"Plank",calories:"3-4 cal/min",duration:"30-45 sec",desc:"Core stability and abdominal strength.",steps:["Rest on forearms and toes.","Keep body in straight line.","Hold selection tight.","Breathe normally."]},{id:4,name:"Squats",calories:"0.3-0.5 cal/rep",duration:"20 reps",desc:"Legs and glutes builder.",steps:["Stand feet shoulder-width apart.","Lower hips like sitting in a chair.","Keep chest up.","Return to standing."]},{id:5,name:"Lunges",calories:"0.5 cal/rep",duration:"15 reps/leg",desc:"Balance and leg strength.",steps:["Step forward with one leg.","Lower hips until both knees are 90.","Push back to start.","Switch legs."]},{id:6,name:"Burpees",calories:"10-15 cal/min",duration:"10-15 reps",desc:"High intensity full body calorie burner.",steps:["Squat down.","Kick feet back to plank.","Do a push-up.","Jump feet forward and jump up."]},{id:7,name:"High Knees",calories:"7-9 cal/min",duration:"1 min",desc:"Cardio and core engagement.",steps:["Run in place.","Lift knees as high as possible.","Pump arms.","Keep a fast pace."]},{id:8,name:"Mountain Climbers",calories:"8-10 cal/min",duration:"45 sec",desc:"Cardio, core, and arm endurance.",steps:["Start in plank.","Drive one knee to chest.","Switch legs quickly.","Keep hips down."]}],qte=({onBack:n})=>{const[e,t]=xe.useState(null);return T.jsxs("div",{className:"workout-container fade-in",children:[T.jsxs("div",{className:"header-row",children:[T.jsx("button",{onClick:n,className:"back-btn",children:T.jsx(tl,{size:24})}),T.jsx("h2",{children:"Home Workouts"})]}),T.jsxs("div",{className:"info-card",children:[T.jsx("div",{className:"intro-icon",children:T.jsx(mP,{size:28,color:"#FF6B6B"})}),T.jsx("p",{children:"Burn calories with these 8 basic home exercises. No equipment needed!"})]}),T.jsx("div",{className:"workout-list",children:Wte.map(i=>T.jsxs("div",{className:"workout-card",children:[T.jsxs("div",{className:"w-header",children:[T.jsx("h3",{children:i.name}),T.jsxs("span",{className:"cal-badge",children:[T.jsx(mP,{size:12,fill:"currentColor"})," ",i.calories]})]}),T.jsx("p",{className:"w-desc",children:i.desc}),T.jsxs("div",{className:"w-footer",children:[T.jsxs("span",{className:"duration",children:[T.jsx(hQ,{size:14})," ",i.duration]}),T.jsx("button",{className:"start-btn",onClick:()=>t(i),children:"Steps"})]})]},i.id))}),e&&T.jsx("div",{className:"modal-overlay fade-in",onClick:()=>t(null),children:T.jsxs("div",{className:"modal-content",onClick:i=>i.stopPropagation(),children:[T.jsx("button",{className:"close-btn",onClick:()=>t(null),children:T.jsx(gQ,{size:24})}),T.jsxs("div",{className:"modal-header",children:[T.jsx("h3",{children:e.name}),T.jsx("span",{className:"cal-pill",children:e.calories})]}),(()=>{const r={"Jumping Jacks":"iSSAk4XCsRA",Squats:"YaXPRqUwItQ","Push-ups":"IODxDxX7oi4",Burpees:"dZgVxmf6jkA","High Knees":"oDdkytliOqE",Lunges:"QOVaHwm-Q6U",Plank:"pSHjTRCQxIw","Mountain Climbers":"zT-9L3CEcmk"}[e.name]||"UpH7rm0cYbM";return T.jsx("div",{style:{width:"100%",height:"220px",marginBottom:"20px",borderRadius:"12px",overflow:"hidden",background:"#000"},children:T.jsx("iframe",{width:"100%",height:"100%",src:`https://www.youtube.com/embed/${r}?autoplay=1&mute=1&loop=1&playlist=${r}&controls=0&showinfo=0&modestbranding=1`,title:"Workout Demonstration",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,style:{display:"block"}})})})(),T.jsxs("div",{className:"modal-body",children:[T.jsxs("h4",{children:[T.jsx(Tz,{size:16})," How to do it:"]}),T.jsx("ul",{className:"steps-list",children:e.steps.map((i,r)=>T.jsxs("li",{children:[T.jsx("span",{className:"step-num",children:r+1}),i]},r))})]})]})}),T.jsx("style",{children:`
                .workout-container {
                    padding: var(--spacing-md);
                    padding-bottom: 40px;
                }
                .header-row {
                   display: flex;
                   align-items: center;
                   gap: var(--spacing-md);
                   margin-bottom: var(--spacing-lg);
                }
                .back-btn {
                   background: transparent;
                   color: var(--color-text-main);
                   padding: 0;
                }
                
                .info-card {
                    background: #FFF0F1;
                    padding: 15px;
                    border-radius: var(--radius-md);
                    margin-bottom: 20px;
                    display: flex;
                    align-items: center;
                    gap: 15px;
                    color: var(--color-text-main);
                    border: 1px solid #FFD1D1;
                }
                .intro-icon {
                    background: white;
                    padding: 10px;
                    border-radius: 50%;
                    box-shadow: var(--shadow-sm);
                }

                .workout-list {
                    display: flex;
                    flex-direction: column;
                    gap: 15px;
                }

                .workout-card {
                    background: white;
                    padding: 15px;
                    border-radius: var(--radius-md);
                    box-shadow: var(--shadow-sm);
                    transition: transform 0.2s;
                    border: 1px solid #f1f5f9;
                }
                .workout-card:hover {
                    transform: translateY(-2px);
                    box-shadow: var(--shadow-md);
                }

                .w-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 8px;
                }
                .w-header h3 {
                    font-size: 16px;
                    color: var(--color-text-main);
                }
                .cal-badge {
                    font-size: 11px;
                    background: #ffe4e6;
                    color: #be123c;
                    padding: 4px 8px;
                    border-radius: 99px;
                    display: flex;
                    align-items: center;
                    gap: 4px;
                    font-weight: 600;
                }

                .w-desc {
                    font-size: 12px;
                    color: var(--color-text-secondary);
                    margin-bottom: 15px;
                }

                .w-footer {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding-top: 10px;
                    border-top: 1px solid #f1f5f9;
                }
                .start-now-btn {
                    background: var(--color-primary);
                    color: white;
                    padding: 10px 20px;
                    border-radius: 99px;
                    font-weight: 600;
                    box-shadow: var(--shadow-md);
                }

                .modal-body h4 { display: flex; align-items: center; gap: 8px; font-size: 14px; margin-bottom: 10px; margin-top: 15px; color: var(--color-text-main); }
                .steps-list { list-style: none; padding: 0; }
                .steps-list li {
                    display: flex; gap: 10px;
                    font-size: 14px; color: var(--color-text-secondary);
                    margin-bottom: 12px;
                    line-height: 1.4;
                }
                .step-num {
                    background: #eef2ff; color: var(--color-primary);
                    font-weight: bold; font-size: 12px;
                    width: 20px; height: 20px;
                    border-radius: 50%;
                    display: flex; align-items: center; justify-content: center;
                    flex-shrink: 0;
                }
            `})]})},Gte=({onBack:n,userProfile:e})=>{const[t,i]=xe.useState(()=>{if(!(e!=null&&e.email))return[];const h=localStorage.getItem(`weight_log_${e.email}`);return h?JSON.parse(h):[]}),[r,s]=xe.useState(""),a=()=>{if(!r||isNaN(r))return;const h={weight:parseFloat(r),date:new Date().toISOString(),displayDate:new Date().toLocaleDateString()},f=[...t,h];i(f),e!=null&&e.email&&localStorage.setItem(`weight_log_${e.email}`,JSON.stringify(f)),s("")},l=(()=>{if(t.length<2)return{change:0,type:"neutral"};const h=t[t.length-1].weight,f=t[t.length-2].weight,m=h-f;return{change:Math.abs(m).toFixed(1),type:m>0?"gain":m<0?"loss":"neutral"}})(),u=(e==null?void 0:e.weight)||(t.length>0?t[0].weight:0),c=t.length>0?t[t.length-1].weight:u;return T.jsxs("div",{className:"weight-container fade-in",children:[T.jsxs("div",{className:"header-row",children:[T.jsx("button",{onClick:n,className:"back-btn",children:T.jsx(tl,{size:24})}),T.jsx("h2",{children:"Weight Progress"})]}),T.jsxs("div",{className:"stats-card",children:[T.jsxs("div",{className:"stat-item",children:[T.jsx("span",{className:"label",children:"Starting Weight"}),T.jsxs("span",{className:"value",children:[u," kg"]})]}),T.jsx("div",{className:"divider"}),T.jsxs("div",{className:"stat-item",children:[T.jsx("span",{className:"label",children:"Current Weight"}),T.jsxs("span",{className:"value primary",children:[c," kg"]})]}),T.jsx("div",{className:"divider"}),T.jsxs("div",{className:"stat-item",children:[T.jsx("span",{className:"label",children:"Change"}),T.jsxs("span",{className:`value ${l.type}`,children:[l.type==="gain"&&T.jsx(mQ,{size:16}),l.type==="loss"&&T.jsx(pQ,{size:16}),l.type==="neutral"&&T.jsx(sQ,{size:16}),l.change," kg"]})]})]}),T.jsxs("div",{className:"input-section",children:[T.jsx("h3",{children:"Log Current Weight"}),T.jsxs("div",{className:"input-group",children:[T.jsx("input",{type:"number",placeholder:"Enter weight in kg",value:r,onChange:h=>s(h.target.value),step:"0.1"}),T.jsx("button",{className:"add-btn",onClick:a,children:"Add"})]})]}),T.jsxs("div",{className:"history-section",children:[T.jsx("h3",{children:"Weight History"}),t.length===0?T.jsxs("div",{className:"empty-state",children:[T.jsx(Ez,{size:40,color:"#cbd5e1"}),T.jsx("p",{children:"No entries yet. Start logging your weight!"})]}):T.jsx("div",{className:"history-list",children:[...t].reverse().map((h,f)=>T.jsxs("div",{className:"history-item",children:[T.jsxs("div",{className:"date-badge",children:[T.jsx(QX,{size:14}),h.displayDate]}),T.jsxs("div",{className:"weight-display",children:[h.weight," kg"]})]},f))})]}),T.jsx("style",{children:`
                .weight-container {
                    padding: var(--spacing-md);
                    padding-bottom: 40px;
                }
                .header-row {
                   display: flex;
                   align-items: center;
                   gap: var(--spacing-md);
                   margin-bottom: 20px;
                }
                .back-btn { background: transparent; color: var(--color-text-main); padding: 0; }
                
                .stats-card {
                    background: white;
                    padding: 20px;
                    border-radius: var(--radius-lg);
                    box-shadow: var(--shadow-md);
                    display: flex;
                    justify-content: space-around;
                    margin-bottom: 25px;
                }
                .stat-item {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 5px;
                }
                .label {
                    font-size: 11px;
                    color: var(--color-text-muted);
                    text-transform: uppercase;
                }
                .value {
                    font-size: 18px;
                    font-weight: bold;
                    color: var(--color-text-main);
                    display: flex;
                    align-items: center;
                    gap: 4px;
                }
                .value.primary { color: var(--color-primary); }
                .value.gain { color: #f59e0b; }
                .value.loss { color: #10b981; }
                .value.neutral { color: #64748b; }
                .divider {
                    width: 1px;
                    background: #e2e8f0;
                    align-self: stretch;
                }

                .input-section {
                    background: white;
                    padding: 20px;
                    border-radius: var(--radius-lg);
                    box-shadow: var(--shadow-sm);
                    margin-bottom: 25px;
                }
                .input-section h3 {
                    font-size: 14px;
                    margin-bottom: 15px;
                    color: var(--color-text-main);
                }
                .input-group {
                    display: flex;
                    gap: 10px;
                }
                .input-group input {
                    flex: 1;
                    padding: 12px;
                    border: 1px solid #e2e8f0;
                    border-radius: var(--radius-md);
                    font-size: 14px;
                }
                .add-btn {
                    background: var(--color-primary);
                    color: white;
                    padding: 12px 24px;
                    border-radius: var(--radius-md);
                    font-weight: 600;
                    box-shadow: var(--shadow-sm);
                }

                .history-section h3 {
                    font-size: 14px;
                    margin-bottom: 15px;
                    color: var(--color-text-main);
                }
                .empty-state {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 10px;
                    padding: 40px 20px;
                    color: var(--color-text-muted);
                    font-size: 13px;
                }
                .history-list {
                    display: flex;
                    flex-direction: column;
                    gap: 10px;
                }
                .history-item {
                    background: white;
                    padding: 15px;
                    border-radius: var(--radius-md);
                    box-shadow: var(--shadow-sm);
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                .date-badge {
                    display: flex;
                    align-items: center;
                    gap: 5px;
                    font-size: 12px;
                    color: var(--color-text-secondary);
                }
                .weight-display {
                    font-size: 16px;
                    font-weight: bold;
                    color: var(--color-primary);
                }
            `})]})},Kte="https://blood-report-fitness-evaluation-system.onrender.com",bA={blood:{title:"Blood Report Help",questions:[{q:"How to read my blood report parameters?",a:"Blood reports list parameters (like Hemoglobin) with your result and a reference range. If your value is outside this range, it's flagged as High or Low. Always focus on the 'Status' column in our app for a quick summary."},{q:"What does 'Normal Range' mean?",a:"The normal range is the set of values that 95% of healthy individuals fall into. Being slightly outside doesn't always mean a serious problem, but it's a sign to check with your doctor."},{q:"Why are my Hemoglobin levels low?",a:"Low hemoglobin often indicates anemia. This can be caused by iron deficiency, vitamin B12 deficiency, or chronic conditions. It's best to look at your RBC count and Iron levels together for a better picture."},{q:"What should I do if my glucose is high?",a:"High fasting glucose levels suggest pre-diabetes or diabetes. You should reduce sugary foods, increase fiber, and stay active. Monitoring your HbA1c is also recommended for long-term tracking."},{q:"Is high cholesterol dangerous?",a:"High 'Bad' cholesterol (LDL) can cause plaque buildup in arteries, increasing heart risk. However, 'Good' cholesterol (HDL) helps protect your heart. Balance is key!"}]},diet:{title:"Diet Help",questions:[{q:"What is a balanced diet?",a:"A balanced diet includes a mix of proteins (30%), healthy fats (30%), and complex carbohydrates (40%), along with plenty of fiber and micronutrients from fruits and vegetables."},{q:"Best foods to increase Hemoglobin?",a:"Focus on iron-rich foods: Spinach, red meat, lentils, dates, and pomegranate. Tip: Eat these with Vitamin C (like lemon or citrus) to boost absorption!"},{q:"How to control blood sugar through diet?",a:"Choose low Glycemic Index (GI) foods like oats, quinoa, and non-starchy vegetables. Avoid refined carbs like white rice and sugary drinks which cause sharp spikes."},{q:"Foods that help lower bad cholesterol?",a:"Oats, nuts (walnuts/almonds), fatty fish, and olive oil are excellent. Avoid trans fats found in fried and processed foods."},{q:"Should I take protein supplements?",a:"If you can't meet your protein needs through whole foods (eggs, chicken, paneer, sprouts), a supplement like Whey can help. But remember, food first!"}]},doubts:{title:"Douts",questions:[{q:"How much water should I drink daily?",a:"A general rule is 3-4 liters per day, but it depends on your weight and activity level. If your urine is light yellow/clear, you're well hydrated!"},{q:"Why am I feeling tired all the time?",a:"Persistent fatigue can be due to many things found in blood tests: Low iron (Anemia), Vitamin D/B12 deficiency, or Thyroid issues. Check your latest report!"},{q:"How many hours of sleep do I need?",a:"Most adults need 7-9 hours of quality sleep. Sleep is when your body repairs muscle and regulates hormones. Consistent timing is just as important as duration."},{q:"Is daily exercise necessary?",a:"Aim for at least 30 minutes of moderate activity (like brisk walking) 5 days a week. For muscle building, 3-4 days of weight training is more effective."},{q:"How to reduce stress naturally?",a:"Regular exercise, 7+ hours of sleep, deep breathing exercises, and maintaining a healthy diet all contribute to lowering cortisol levels and reducing stress."}]}},Yte=({onBack:n,userProfile:e})=>{const[t,i]=xe.useState([{id:1,text:`Hello ${e!=null&&e.name?e.name.split(" ")[0]:""}! How can I help you today?`,sender:"bot",type:"choice",options:["Blood Report Help","Diet Help","Douts"]}]),[r,s]=xe.useState(""),[a,o]=xe.useState(!1),[l,u]=xe.useState(null),c=xe.useRef(null),[h,f]=xe.useState([]),[m,y]=xe.useState(null),_=()=>{var $;($=c.current)==null||$.scrollIntoView({behavior:"smooth"})};xe.useEffect(()=>{if(e!=null&&e.email){const $=JSON.parse(localStorage.getItem(`reports_${e.email}`)||"[]");f($)}_()},[t,e==null?void 0:e.email]);const x=($,L)=>{navigator.clipboard.writeText($),u(L),setTimeout(()=>u(null),2e3)},v=$=>{let L=null;if($==="Blood Report Help"?L="blood":$==="Diet Help"?L="diet":$==="Douts"&&(L="doubts"),L){const I={id:Date.now(),text:$,sender:"user"};i(C=>[...C,I]),o(!0),setTimeout(()=>{const C={id:Date.now()+1,text:`Great! Here are some common questions about ${bA[L].title}. Which one would you like to know more about?`,sender:"bot",type:"choice",options:bA[L].questions.map(N=>N.q)};i(N=>[...N,C]),o(!1),y(L)},800);return}if(m){const I=bA[m].questions.find(C=>C.q===$);if(I){const C={id:Date.now(),text:$,sender:"user"};i(N=>[...N,C]),o(!0),setTimeout(()=>{const N={id:Date.now()+1,text:I.a,sender:"bot",confidence:1,type:"post-flow"};i(O=>[...O,N]),o(!1),setTimeout(()=>{const O={id:Date.now()+2,text:"Would you like to ask something else? You can type any question below or choose a topic again.",sender:"bot",type:"choice",options:["Blood Report Help","Diet Help","Douts"]};i(V=>[...V,O])},1500)},800);return}}},w=async $=>{try{const L=await fetch(`${Kte}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:$,userProfile:e,bloodReports:h,conversationHistory:t.slice(-5).map(C=>({text:C.text,sender:C.sender}))})});if(!L.ok)throw new Error("Backend unavailable");const I=await L.json();return{text:I.response,confidence:I.confidence,intent:I.intent,metadata:I.metadata}}catch(L){return console.warn("Chat Error:",L),{text:"I'm having trouble connecting to my brain. Please make sure the backend is running and try again!",confidence:0}}},E=async($,L=null)=>{$&&$.preventDefault&&$.preventDefault();const I=L||r;if(!I.trim())return;const C={id:Date.now(),text:I,sender:"user"};i(N=>[...N,C]),s(""),o(!0);try{const N=await w(I);setTimeout(()=>{const O={id:Date.now()+1,text:N.text,sender:"bot",confidence:N.confidence||.8,intent:N.intent,followups:N.followups||[],visual_type:N.visual_type||"standard",mood:N.mood||"insightful"};i(V=>[...V,O]),o(!1)},800)}catch(N){console.error("Chat error:",N);const O={id:Date.now()+1,text:"Sorry, I encountered an error. Please try again!",sender:"bot",confidence:0};i(V=>[...V,O]),o(!1)}},k=$=>{if(!$)return null;const L=$.split(`
`);return L.map((I,C)=>{let N=I;if(N.includes("|")&&N.split("|").length>2){if(N.includes("---"))return null;const he=N.split("|").filter(te=>te.trim()!==""),me=C<L.length-1&&L[C+1].includes("---");return T.jsx("div",{className:"table-row",style:{display:"flex",borderBottom:"1px solid #e2e8f0",padding:"6px 0",fontWeight:me?"700":"400",background:me?"#f8fafc":"transparent",fontSize:"13px"},children:he.map((te,oe)=>T.jsx("div",{style:{flex:1,padding:"0 8px"},children:te.trim()},oe))},C)}if(N.startsWith("### "))return T.jsx("h4",{className:"md-header",children:N.replace("### ","")},C);const O=/\*\*(.*?)\*\*/g,V=[];let U=0,j;for(;(j=O.exec(N))!==null;)j.index>U&&V.push(N.substring(U,j.index)),V.push(T.jsx("strong",{children:j[1]},j.index)),U=O.lastIndex;return U<N.length&&V.push(N.substring(U)),N.trim().startsWith("* ")||N.trim().startsWith("- ")?T.jsxs("div",{className:"md-list-item",children:[T.jsx("span",{className:"bullet",children:""}),T.jsx("span",{children:V.length>0?V:N.replace(/^[*|-]\s/,"")})]},C):T.jsx("div",{className:"md-text",children:V.length>0?V:N},C)})};return T.jsxs("div",{className:"chat-container assistant-theme fade-in",children:[T.jsxs("div",{className:"header-crystal",children:[T.jsx("button",{onClick:n,className:"back-btn-blur",children:T.jsx(tl,{size:20})}),T.jsxs("div",{className:"bot-info",children:[T.jsx("h2",{children:" AI Assistant"}),T.jsxs("div",{className:"badge-proactive",children:[T.jsx("div",{className:"pulse"}),T.jsx("span",{children:"Grounding Active"})]})]}),T.jsx(mE,{size:22,className:"ai-glow"})]}),T.jsxs("div",{className:"chat-window-crystal",children:[t.map($=>T.jsxs("div",{className:`message-row ${$.sender}`,children:[$.sender==="bot"&&T.jsx("div",{className:`avatar-bot ${$.mood}`,children:T.jsx(mE,{size:16})}),T.jsxs("div",{className:"message-container",children:[T.jsx("div",{className:`message-bubble ${$.sender}-bubble glass`,children:k($.text)}),($.type==="choice"||$.followups&&$.followups.length>0)&&T.jsx("div",{className:"interactive-options",children:($.options||$.followups).map((L,I)=>T.jsx("button",{className:"assistant-choice-btn",onClick:()=>{$.type==="choice"?v(L):E(null,L)},disabled:a,children:L},I))}),$.sender==="bot"&&$.confidence&&T.jsxs("div",{className:"message-meta",children:[T.jsxs("div",{className:"expert-badge",children:[T.jsx(cQ,{size:12}),T.jsx("span",{children:"Medical Grounding: 100%"})]}),T.jsx("button",{onClick:()=>x($.text,$.id),className:"copy-mini",children:l===$.id?T.jsx(JX,{size:12}):T.jsx(tQ,{size:12})})]})]}),$.sender==="user"&&T.jsx("div",{className:"avatar-user",children:T.jsx(Iz,{size:16})})]},$.id)),a&&T.jsxs("div",{className:"message-row bot",children:[T.jsx("div",{className:"avatar-bot insightful",children:T.jsx(mE,{size:16})}),T.jsx("div",{className:"message-bubble glass typing-glass",children:T.jsxs("div",{className:"dot-wave",children:[T.jsx("span",{}),T.jsx("span",{}),T.jsx("span",{})]})})]}),T.jsx("div",{ref:c})]}),T.jsx("div",{className:"input-section-crystal",children:T.jsxs("form",{onSubmit:E,className:"input-form-glass",children:[T.jsx("input",{type:"text",value:r,onChange:$=>s($.target.value),placeholder:"Ask AI Assistant about health...",className:"chat-input-glass",disabled:a}),T.jsx("button",{type:"submit",className:"send-btn-gradient",disabled:a||!r.trim(),children:T.jsx(uQ,{size:20})})]})}),T.jsx("style",{children:`
                .chat-container.assistant-theme {
                    height: 100%;
                    display: flex;
                    flex-direction: column;
                    background: #fdfefe;
                    font-family: 'Inter', sans-serif;
                }

                .header-crystal {
                    background: linear-gradient(135deg, #7209B7 0%, #3F37C9 100%);
                    padding: 20px;
                    display: flex;
                    align-items: center;
                    gap: 15px;
                    color: white;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
                    z-index: 10;
                }

                .back-btn-blur {
                    background: rgba(255,255,255,0.15);
                    backdrop-filter: blur(5px);
                    border: 1px solid rgba(255,255,255,0.2);
                    padding: 8px;
                    border-radius: 12px;
                    color: white;
                }

                .bot-info h2 { font-size: 18px; font-weight: 700; margin: 0; }
                .badge-proactive {
                    display: flex;
                    align-items: center;
                    gap: 6px;
                    font-size: 11px;
                    opacity: 0.9;
                    margin-top: 4px;
                }
                .pulse {
                    width: 8px; height: 8px;
                    background: #4ade80;
                    border-radius: 50%;
                    box-shadow: 0 0 0 0 rgba(74, 222, 128, 0.7);
                    animation: pulse-green 2s infinite;
                }

                .chat-window-crystal {
                    flex: 1;
                    padding: 20px;
                    overflow-y: auto;
                    background: #f8fafc;
                    display: flex;
                    flex-direction: column;
                    gap: 24px;
                }

                .message-bubble.glass {
                    background: white;
                    border-radius: 20px;
                    padding: 16px;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.03);
                    border: 1px solid #eef2f6;
                    font-size: 14px;
                    line-height: 1.6;
                    color: #334155;
                }

                .bot-bubble.glass {
                    border-top-left-radius: 4px;
                    background: linear-gradient(to bottom right, #ffffff, #f1f5f9);
                }

                .user-bubble.glass {
                    background: linear-gradient(135deg, #7209B7 0%, #3F37C9 100%);
                    color: white;
                    border-top-right-radius: 4px;
                    box-shadow: 0 4px 15px rgba(114, 9, 183, 0.2);
                }

                .avatar-bot {
                    width: 32px; height: 32px;
                    border-radius: 10px;
                    display: flex; align-items: center; justify-content: center;
                    color: white;
                    background: #7209B7;
                }
                .avatar-bot.congratulatory { background: #10b981; }
                .avatar-bot.cautionary { background: #f59e0b; }

                .interactive-options {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 8px;
                    margin-top: 12px;
                }

                .assistant-choice-btn {
                    background: white;
                    border: 1.5px solid #e2e8f0;
                    padding: 10px 18px;
                    border-radius: 20px;
                    font-size: 12px;
                    font-weight: 600;
                    color: #7209B7;
                    transition: all 0.2s;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.02);
                }

                .assistant-choice-btn:hover {
                    border-color: #7209B7;
                    background: #f5f3ff;
                    transform: translateY(-2px);
                }

                .input-section-crystal {
                    padding: 20px;
                    background: white;
                    border-top: 1px solid #f1f5f9;
                }

                .input-form-glass {
                    display: flex;
                    gap: 12px;
                    background: #f1f5f9;
                    padding: 8px;
                    border-radius: 30px;
                }

                .chat-input-glass {
                    flex: 1;
                    background: transparent;
                    border: none;
                    padding: 10px 15px;
                    font-size: 14px;
                    color: #334155;
                }
                .chat-input-glass:focus { outline: none; }

                .send-btn-gradient {
                    width: 45px; height: 45px;
                    background: linear-gradient(135deg, #7209B7 0%, #3F37C9 100%);
                    color: white;
                    border-radius: 50%;
                    display: flex; align-items: center; justify-content: center;
                    transition: all 0.2s;
                }

                .md-header { margin: 15px 0 8px 0; color: #1e293b; font-size: 15px; }
                .md-list-item { display: flex; gap: 10px; margin-bottom: 6px; }
                .bullet { color: #7209B7; font-weight: bold; }
                
                .expert-badge {
                    display: flex;
                    align-items: center;
                    gap: 6px;
                    font-size: 10px;
                    color: #64748b;
                    margin-top: 8px;
                    font-weight: 600;
                    background: #f1f5f9;
                    padding: 4px 8px;
                    border-radius: 6px;
                    width: fit-content;
                }

                @keyframes pulse-green {
                    0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(74, 222, 128, 0.7); }
                    70% { transform: scale(1); box-shadow: 0 0 0 6px rgba(74, 222, 128, 0); }
                    100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(74, 222, 128, 0); }
                }

                .dot-wave { display: flex; gap: 4px; }
                .dot-wave span { width: 6px; height: 6px; background: #94a3b8; border-radius: 50%; animation: wave 1.3s infinite ease-in-out; }
                .dot-wave span:nth-child(2) { animation-delay: 0.1s; }
                .dot-wave span:nth-child(3) { animation-delay: 0.2s; }

                @keyframes wave {
                    0%, 60%, 100% { transform: translateY(0); }
                    30% { transform: translateY(-4px); }
                }
            `})]})},Xte=({message:n,onClose:e})=>(xe.useEffect(()=>{const t=setTimeout(()=>{e()},5e3);return()=>clearTimeout(t)},[e]),T.jsxs("div",{className:"toast-notification",children:[T.jsx("div",{className:"icon-bg",children:T.jsx(YX,{size:20})}),T.jsxs("div",{className:"content",children:[T.jsx("h4",{children:"Reminder"}),T.jsx("p",{children:n})]}),T.jsx("button",{onClick:e,className:"close-btn",children:""}),T.jsx("style",{children:`
         .toast-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            color: var(--color-text-main);
            padding: 12px 16px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            animation: slideIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            border-left: 4px solid var(--color-primary);
            max-width: 90vw;
         }
         
         .icon-bg {
            background: #FFF0F1;
            color: var(--color-primary);
            padding: 8px;
            border-radius: 50%;
            display: flex;
         }

         .content h4 {
            font-size: var(--font-size-sm);
            margin-bottom: 2px;
         }

         .content p {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
         }

         .close-btn {
            background: transparent;
            font-size: 20px;
            color: #999;
            margin-left: 8px;
         }

         @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
         }
       `})]})),v3=n=>{let e={breakfast:[{name:"Oatmeal with Walnuts & Apple",calories:350,carbs:"60g",protein:"12g",fat:"8g",benefits:["Heart Healthy","High Fiber"]},{name:"Egg Whites & Whole Wheat Toast",calories:300,carbs:"30g",protein:"20g",fat:"5g",benefits:["Muscle Repair"]}],lunch:[{name:"Grilled Chicken Salad with Quinoa",calories:500,carbs:"40g",protein:"40g",fat:"15g",benefits:["Lean Protein","Complete Meal"]},{name:"Lentil Soup (Dal) & Brown Rice",calories:450,carbs:"60g",protein:"18g",fat:"8g",benefits:["Plant Protein","Easy Digestion"]}],snacks:[{name:"Greek Yogurt with Berries",calories:150,carbs:"15g",protein:"12g",fat:"0g",benefits:["Probiotics","Antioxidants"]},{name:"Handful of Almonds",calories:160,carbs:"6g",protein:"6g",fat:"14g",benefits:["Healthy Fats"]}],dinner:[{name:"Baked Salmon with Steamed Broccoli",calories:550,carbs:"10g",protein:"45g",fat:"30g",benefits:["Omega-3","Light Dinner"]},{name:"Stir-Fried Tofu with Mixed Veggies",calories:400,carbs:"15g",protein:"25g",fat:"20g",benefits:["Vegan Option","Light"]}],recommendations:["Drink 3-4 liters of water daily.","Eat dinner at least 2 hours before sleep.","Include a serving of raw salad with lunch.","Limit processed sugar intake."],restrictions:[]};if(!n||!n.results)return e;const{results:t}=n,i=f=>t.find(m=>m.parameter===f),r=i("glucose_fasting"),s=i("glucose_pp");(r&&r.status==="High"||s&&s.status==="High")&&(e.recommendations.unshift(" STRICT LOW GLYCEMIC INDEX DIET RECOMMENDED"),e.restrictions.push("White bread, white rice, pasta","Sugary drinks & desserts","High-sugar fruits (mango, grapes)"),e.breakfast=[{name:"Steel-Cut Oats with Cinnamon (No Sugar)",calories:300,carbs:"50g",protein:"10g",fat:"6g",benefits:["Low GI","Cinnamon Helps Insulin"]},{name:"Vegetable Omelette (Double Spinach)",calories:320,carbs:"5g",protein:"22g",fat:"20g",benefits:["Keto-Friendly","Iron Boost"]}],e.snacks=[{name:"Roasted Chana (Chickpeas)",calories:180,carbs:"20g",protein:"10g",fat:"4g",benefits:["Complex Carbs","Satiety"]},{name:"Cucumber & Hummus Sticks",calories:150,carbs:"15g",protein:"6g",fat:"8g",benefits:["Hydrating","Low Carb"]}]);const a=i("cholesterol"),o=i("triglycerides"),l=i("ldl_cholesterol");(a&&a.status==="High"||o&&o.status==="High"||l&&l.status==="High")&&(e.recommendations.unshift(" HEART HEALTHY FATS ONLY (Avoid Saturated Fats)"),e.restrictions.push("Red meat","Butter/Ghee","Fried foods","Full-fat dairy"),e.dinner=[{name:"Grilled Mackerel/Salmon (No Butter)",calories:500,carbs:"0g",protein:"40g",fat:"25g",benefits:["High Omega-3","Lowers inflammation"]},{name:"Quinoa Bowl with Beans",calories:450,carbs:"60g",protein:"18g",fat:"8g",benefits:["Fiber lowers cholesterol"]}],e.breakfast.some(f=>f.name.includes("Oat"))||e.breakfast.unshift({name:"Bowl of Oatmeal with Flaxseeds",calories:350,carbs:"55g",protein:"12g",fat:"10g",benefits:["Soluble Fiber","Cholesterol Lowering"]}));const u=i("hemoglobin");u&&u.status==="Low"&&(e.recommendations.unshift(" IRON-RICH DIET (Consume Vitamin C for absorption)"),e.lunch.forEach(f=>{f.name.includes("Spinach")||(f.name+=" + Side Spinach Salad"),f.benefits.push("Iron Booster")}),e.snacks.push({name:"Dates & Walnuts",calories:200,carbs:"40g",protein:"4g",fat:"8g",benefits:["High Iron","Energy"]}),e.restrictions.push("Tea/Coffee within 1 hour of meals (Inhibits Iron absorption)"));const c=i("uric_acid");c&&c.status==="High"&&(e.recommendations.unshift(" LOW PURINE DIET (Manage Uric Acid)"),e.restrictions.push("Red meat","Shellfish","Spinach","Cauliflower","Alcohol"),["breakfast","lunch","dinner","snacks"].forEach(f=>{e[f]=e[f].map(m=>m.name.includes("Spinach")?{...m,name:m.name.replace("Spinach","Cucumber"),benefits:m.benefits.filter(y=>y!=="Iron Booster")}:m)}),e.snacks.push({name:"Bowl of Cherries / Berries",calories:100,carbs:"25g",protein:"1g",fat:"0g",benefits:["Lowers Uric Acid"]}));const h=i("tsh");return h&&h.status==="High"&&(e.recommendations.unshift(" THYROID SUPPORT (Limit Goitrogens raw)"),e.restrictions.push("Raw Cruciferous Veggies (Cabbage, Broccoli, Cauliflower) - Cook them well"),e.recommendations.push("Ensure iodized salt usage or eat seaweed."),e.breakfast.push({name:"Brazil Nuts (2-3) & Smoothie",calories:300,carbs:"40g",protein:"10g",fat:"15g",benefits:["Selenium for Thyroid"]})),e},Qte=({onBack:n,user:e})=>{const[t,i]=xe.useState(null),[r,s]=xe.useState(null),[a,o]=xe.useState(!0),[l,u]=xe.useState(!1),[c,h]=xe.useState("breakfast");xe.useEffect(()=>{f()},[e]);const f=()=>{e&&e.email?`${e.email}`:`${Date.now()}`;let y=null;if(e&&e.email){const _=localStorage.getItem(`reports_${e.email}`);if(_){const x=JSON.parse(_);x.length>0&&(y=x[0])}}else{const _=Object.keys(localStorage).filter(x=>x.startsWith("temp_reports_"));if(_.length>0){const x=localStorage.getItem(_[_.length-1]);if(x){const v=JSON.parse(x);v.length>0&&(y=v[0])}}}if(y){i(y);const _=v3(y);s(_)}o(!1)},m=async y=>{const _=y.target.files[0];if(_){u(!0);try{const{data:{text:x}}=await GT.recognize(_,"eng"),v=x.split(`
`),w={},E={hemoglobin:["hemoglobin","hb"],glucose_fasting:["glucose fasting","fbs"],cholesterol:["cholesterol"],uric_acid:["uric acid"],tsh:["tsh"]};if(v.forEach(C=>{const N=C.toLowerCase();Object.keys(E).forEach(O=>{if(E[O].some(V=>N.includes(V))){const V=C.match(/(\d+(\.\d+)?)/g);V&&(w[O]=parseFloat(V[0]))}})}),Object.keys(w).length===0){alert("Could not detect clear values. Please try a clearer image."),u(!1);return}const k=Nz(w);s(v3(k)),i(k);const $=e&&e.email?`reports_${e.email}`:`temp_reports_${Date.now()}`,L=JSON.parse(localStorage.getItem($)||"[]"),I=[k,...L];localStorage.setItem($,JSON.stringify(I))}catch(x){console.error(x),alert("Error scanning file.")}finally{u(!1)}}};return a?T.jsx("div",{className:"p-4",children:"Loading Diet Plan..."}):t?T.jsxs("div",{className:"diet-container fade-in",children:[T.jsxs("div",{className:"header-row",children:[T.jsx("button",{onClick:n,className:"back-btn",children:T.jsx(tl,{size:24})}),T.jsx("h2",{children:"Your Personalized Diet"})]}),T.jsx("div",{className:"health-summary",children:r.recommendations.some(y=>y.includes(""))?T.jsxs("div",{className:"alert-badge warning",children:[T.jsx(Az,{size:16}),T.jsx("span",{children:"Based on your report: Modifications applied for specific conditions."})]}):T.jsxs("div",{className:"alert-badge success",children:[T.jsx(eQ,{size:16}),T.jsx("span",{children:"Report looks balanced. Showing base healthy plan."})]})}),T.jsxs("div",{className:"recommendations-box",children:[T.jsx("h4",{children:"Key Guidelines"}),T.jsx("ul",{children:r.recommendations.slice(0,3).map((y,_)=>T.jsx("li",{className:y.includes("")?"high-priority":"",children:y},_))})]}),T.jsx("div",{className:"meal-tabs",children:["breakfast","lunch","snacks","dinner"].map(y=>T.jsx("button",{className:`tab-btn ${c===y?"active":""}`,onClick:()=>h(y),children:y.charAt(0).toUpperCase()+y.slice(1)},y))}),T.jsx("div",{className:"meal-content",children:r[c].map((y,_)=>T.jsxs("div",{className:"food-card slide-in",children:[T.jsxs("div",{className:"food-header",children:[T.jsx("h3",{children:y.name}),T.jsxs("span",{className:"cal-badge",children:[y.calories," kcal"]})]}),T.jsxs("div",{className:"macros-row",children:[T.jsxs("span",{className:"macro",children:["C: ",y.carbs]}),T.jsxs("span",{className:"macro",children:["P: ",y.protein]}),T.jsxs("span",{className:"macro",children:["F: ",y.fat]})]}),T.jsx("div",{className:"benefits-tags",children:y.benefits.map((x,v)=>T.jsx("span",{className:"tag",children:x},v))})]},_))}),r.restrictions.length>0&&T.jsxs("div",{className:"restrictions-box",children:[T.jsx("h4",{children:" Avoid / Limit"}),T.jsx("p",{children:r.restrictions.join(", ")})]}),T.jsx("style",{children:`
                .diet-container { padding: 20px; padding-bottom: 80px; }
                .header-row { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
                .back-btn { background: none; border: none; padding: 0; cursor: pointer; color: #333; }
                
                .health-summary { margin-bottom: 20px; }
                .alert-badge { 
                    padding: 10px 15px; border-radius: 8px; font-size: 13px; 
                    display: flex; align-items: center; gap: 8px; font-weight: 500;
                }
                .alert-badge.warning { background: #fff7ed; color: #c2410c; border: 1px solid #ffedd5; }
                .alert-badge.success { background: #f0fdf4; color: #15803d; border: 1px solid #dcfce7; }

                .recommendations-box { 
                    background: #f8fafc; padding: 15px; border-radius: 12px; margin-bottom: 20px;
                }
                .recommendations-box h4 { margin: 0 0 10px 0; font-size: 14px; color: #475569; }
                .recommendations-box ul { padding-left: 20px; margin: 0; font-size: 13px; color: #334155; }
                .recommendations-box li { margin-bottom: 5px; }
                .recommendations-box li.high-priority { color: #dc2626; font-weight: 600; }

                .meal-tabs { 
                    display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 10px; 
                    scrollbar-width: none;
                }
                .tab-btn {
                    padding: 8px 16px; border-radius: 20px; background: white; border: 1px solid #e2e8f0;
                    font-size: 13px; white-space: nowrap; cursor: pointer; transition: all 0.2s;
                }
                .tab-btn.active {
                    background: var(--color-primary); color: white; border-color: var(--color-primary);
                    box-shadow: 0 4px 6px -1px rgba(var(--color-primary-rgb), 0.4);
                }

                .food-card {
                    background: white; padding: 16px; border-radius: 12px; margin-bottom: 15px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.06); border-left: 4px solid var(--color-primary);
                }
                .food-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
                .food-header h3 { margin: 0; font-size: 15px; font-weight: 600; color: #1e293b; max-width: 70%; }
                .cal-badge { font-size: 11px; font-weight: bold; background: #f1f5f9; padding: 4px 8px; border-radius: 6px; color: #64748b; }
                
                .macros-row { display: flex; gap: 15px; margin-bottom: 10px; font-size: 12px; color: #64748b; }
                .macro { font-weight: 500; }
                
                .benefits-tags { display: flex; flex-wrap: wrap; gap: 6px; }
                .tag { font-size: 10px; background: #ecfdf5; color: #047857; padding: 3px 8px; border-radius: 4px; }

                .restrictions-box {
                    margin-top: 25px; padding: 15px; background: #fef2f2; border-radius: 12px;
                    border: 1px dashed #fecaca;
                }
                .restrictions-box h4 { color: #b91c1c; margin: 0 0 5px 0; font-size: 13px; }
                .restrictions-box p { color: #7f1d1d; font-size: 12px; margin: 0; line-height: 1.4; }

                .slide-in { animation: slideIn 0.3s ease-out forwards; }
                @keyframes slideIn {
                    from { opacity: 0; transform: translateY(10px); }
                    to { opacity: 1; transform: translateY(0); }
                }
            `})]}):T.jsxs("div",{className:"diet-container fade-in",children:[T.jsxs("div",{className:"header-row",children:[T.jsx("button",{onClick:n,className:"back-btn",children:T.jsx(tl,{size:24})}),T.jsx("h2",{children:"Specialized Diet"})]}),T.jsxs("div",{className:"no-report-state",children:[T.jsx("div",{className:"icon-box",children:T.jsx(Bg,{size:40,color:"var(--color-primary)"})}),T.jsx("h3",{children:"No Report Uploaded"}),T.jsx("p",{children:"Please upload your blood test report to get a personalized diet plan tailored to your body's needs."}),T.jsxs("label",{className:"btn-primary upload-btn-large",children:[l?"Scanning...":"Upload Report Now",T.jsx(Sz,{size:18,style:{marginLeft:8}}),T.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:m,disabled:l})]})]}),T.jsx("style",{children:`
                    .diet-container { padding: 20px; }
                    .header-row { display: flex; align-items: center; gap: 15px; margin-bottom: 30px; }
                    .back-btn { background: none; border: none; padding: 0; cursor: pointer; color: #333; }
                    .no-report-state { 
                        text-align: center; padding: 40px 20px; background: white; 
                        border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);
                        display: flex; flex-direction: column; align-items: center;
                    }
                    .icon-box { 
                        width: 80px; height: 80px; background: #e0f2fe; border-radius: 50%; 
                        display: flex; align-items: center; justify-content: center; margin-bottom: 20px;
                    }
                    .no-report-state h3 { margin-bottom: 10px; color: #0c4a6e; }
                    .no-report-state p { color: #64748b; margin-bottom: 30px; max-width: 300px; line-height: 1.5; }
                    .upload-btn-large { 
                        padding: 12px 24px; background: var(--color-primary); color: white; 
                        border-radius: 99px; display: inline-flex; align-items: center; cursor: pointer;
                        font-weight: 500;
                    }
                `})]})};/*! Capacitor: https://capacitorjs.com/ - MIT License */const Jte=n=>{const e=new Map;e.set("web",{name:"web"});const t=n.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:e},i=(s,a)=>{t.platforms.set(s,a)},r=s=>{t.platforms.has(s)&&(t.currentPlatform=t.platforms.get(s))};return t.addPlatform=i,t.setPlatform=r,t},Zte=n=>n.CapacitorPlatforms=Jte(n),m6=Zte(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});m6.addPlatform;m6.setPlatform;var Bp;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(Bp||(Bp={}));class xA extends Error{constructor(e,t,i){super(e),this.message=e,this.code=t,this.data=i}}const ene=n=>{var e,t;return n!=null&&n.androidBridge?"android":!((t=(e=n==null?void 0:n.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},tne=n=>{var e,t,i,r,s;const a=n.CapacitorCustomPlatform||null,o=n.Capacitor||{},l=o.Plugins=o.Plugins||{},u=n.CapacitorPlatforms,c=()=>a!==null?a.name:ene(n),h=((e=u==null?void 0:u.currentPlatform)===null||e===void 0?void 0:e.getPlatform)||c,f=()=>h()!=="web",m=((t=u==null?void 0:u.currentPlatform)===null||t===void 0?void 0:t.isNativePlatform)||f,y=I=>{const C=k.get(I);return!!(C!=null&&C.platforms.has(h())||v(I))},_=((i=u==null?void 0:u.currentPlatform)===null||i===void 0?void 0:i.isPluginAvailable)||y,x=I=>{var C;return(C=o.PluginHeaders)===null||C===void 0?void 0:C.find(N=>N.name===I)},v=((r=u==null?void 0:u.currentPlatform)===null||r===void 0?void 0:r.getPluginHeader)||x,w=I=>n.console.error(I),E=(I,C,N)=>Promise.reject(`${N} does not have an implementation of "${C}".`),k=new Map,$=(I,C={})=>{const N=k.get(I);if(N)return console.warn(`Capacitor plugin "${I}" already registered. Cannot register plugins twice.`),N.proxy;const O=h(),V=v(I);let U;const j=async()=>(!U&&O in C?U=typeof C[O]=="function"?U=await C[O]():U=C[O]:a!==null&&!U&&"web"in C&&(U=typeof C.web=="function"?U=await C.web():U=C.web),U),he=(K,H)=>{var Q,Y;if(V){const Z=V==null?void 0:V.methods.find(fe=>H===fe.name);if(Z)return Z.rtype==="promise"?fe=>o.nativePromise(I,H.toString(),fe):(fe,_e)=>o.nativeCallback(I,H.toString(),fe,_e);if(K)return(Q=K[H])===null||Q===void 0?void 0:Q.bind(K)}else{if(K)return(Y=K[H])===null||Y===void 0?void 0:Y.bind(K);throw new xA(`"${I}" plugin is not implemented on ${O}`,Bp.Unimplemented)}},me=K=>{let H;const Q=(...Y)=>{const Z=j().then(fe=>{const _e=he(fe,K);if(_e){const X=_e(...Y);return H=X==null?void 0:X.remove,X}else throw new xA(`"${I}.${K}()" is not implemented on ${O}`,Bp.Unimplemented)});return K==="addListener"&&(Z.remove=async()=>H()),Z};return Q.toString=()=>`${K.toString()}() { [capacitor code] }`,Object.defineProperty(Q,"name",{value:K,writable:!1,configurable:!1}),Q},te=me("addListener"),oe=me("removeListener"),G=(K,H)=>{const Q=te({eventName:K},H),Y=async()=>{const fe=await Q;oe({eventName:K,callbackId:fe},H)},Z=new Promise(fe=>Q.then(()=>fe({remove:Y})));return Z.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await Y()},Z},W=new Proxy({},{get(K,H){switch(H){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return V?G:te;case"removeListener":return oe;default:return me(H)}}});return l[I]=W,k.set(I,{name:I,proxy:W,platforms:new Set([...Object.keys(C),...V?[O]:[]])}),W},L=((s=u==null?void 0:u.currentPlatform)===null||s===void 0?void 0:s.registerPlugin)||$;return o.convertFileSrc||(o.convertFileSrc=I=>I),o.getPlatform=h,o.handleError=w,o.isNativePlatform=m,o.isPluginAvailable=_,o.pluginMethodNoop=E,o.registerPlugin=L,o.Exception=xA,o.DEBUG=!!o.DEBUG,o.isLoggingEnabled=!!o.isLoggingEnabled,o.platform=o.getPlatform(),o.isNative=o.isNativePlatform(),o},nne=n=>n.Capacitor=tne(n),nh=nne(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),KC=nh.registerPlugin;nh.Plugins;class g6{constructor(e){this.listeners={},this.retainedEventArguments={},this.windowListeners={},e&&(console.warn(`Capacitor WebPlugin "${e.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=e)}addListener(e,t){let i=!1;this.listeners[e]||(this.listeners[e]=[],i=!0),this.listeners[e].push(t);const s=this.windowListeners[e];s&&!s.registered&&this.addWindowListener(s),i&&this.sendRetainedArgumentsForEvent(e);const a=async()=>this.removeListener(e,t);return Promise.resolve({remove:a})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,i){const r=this.listeners[e];if(!r){if(i){let s=this.retainedEventArguments[e];s||(s=[]),s.push(t),this.retainedEventArguments[e]=s}return}r.forEach(s=>s(t))}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:i=>{this.notifyListeners(t,i)}}}unimplemented(e="not implemented"){return new nh.Exception(e,Bp.Unimplemented)}unavailable(e="not available"){return new nh.Exception(e,Bp.Unavailable)}async removeListener(e,t){const i=this.listeners[e];if(!i)return;const r=i.indexOf(t);this.listeners[e].splice(r,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(i=>{this.notifyListeners(e,i)}))}}const w3=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),b3=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class ine extends g6{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(i=>{if(i.length<=0)return;let[r,s]=i.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");r=b3(r).trim(),s=b3(s).trim(),t[r]=s}),t}async setCookie(e){try{const t=w3(e.key),i=w3(e.value),r=`; expires=${(e.expires||"").replace("expires=","")}`,s=(e.path||"/").replace("path=",""),a=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${i||""}${r}; path=${s}; ${a};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}KC("CapacitorCookies",{web:()=>new ine});const rne=async n=>new Promise((e,t)=>{const i=new FileReader;i.onload=()=>{const r=i.result;e(r.indexOf(",")>=0?r.split(",")[1]:r)},i.onerror=r=>t(r),i.readAsDataURL(n)}),sne=(n={})=>{const e=Object.keys(n);return Object.keys(n).map(r=>r.toLocaleLowerCase()).reduce((r,s,a)=>(r[s]=n[e[a]],r),{})},ane=(n,e=!0)=>n?Object.entries(n).reduce((i,r)=>{const[s,a]=r;let o,l;return Array.isArray(a)?(l="",a.forEach(u=>{o=e?encodeURIComponent(u):u,l+=`${s}=${o}&`}),l.slice(0,-1)):(o=e?encodeURIComponent(a):a,l=`${s}=${o}`),`${i}&${l}`},"").substr(1):null,one=(n,e={})=>{const t=Object.assign({method:n.method||"GET",headers:n.headers},e),r=sne(n.headers)["content-type"]||"";if(typeof n.data=="string")t.body=n.data;else if(r.includes("application/x-www-form-urlencoded")){const s=new URLSearchParams;for(const[a,o]of Object.entries(n.data||{}))s.set(a,o);t.body=s.toString()}else if(r.includes("multipart/form-data")||n.data instanceof FormData){const s=new FormData;if(n.data instanceof FormData)n.data.forEach((o,l)=>{s.append(l,o)});else for(const o of Object.keys(n.data))s.append(o,n.data[o]);t.body=s;const a=new Headers(t.headers);a.delete("content-type"),t.headers=a}else(r.includes("application/json")||typeof n.data=="object")&&(t.body=JSON.stringify(n.data));return t};class lne extends g6{async request(e){const t=one(e,e.webFetchExtra),i=ane(e.params,e.shouldEncodeUrlParams),r=i?`${e.url}?${i}`:e.url,s=await fetch(r,t),a=s.headers.get("content-type")||"";let{responseType:o="text"}=s.ok?e:{};a.includes("application/json")&&(o="json");let l,u;switch(o){case"arraybuffer":case"blob":u=await s.blob(),l=await rne(u);break;case"json":l=await s.json();break;case"document":case"text":default:l=await s.text()}const c={};return s.headers.forEach((h,f)=>{c[f]=h}),{data:l,headers:c,status:s.status,url:s.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}KC("CapacitorHttp",{web:()=>new lne});var x3;(function(n){n[n.Sunday=1]="Sunday",n[n.Monday=2]="Monday",n[n.Tuesday=3]="Tuesday",n[n.Wednesday=4]="Wednesday",n[n.Thursday=5]="Thursday",n[n.Friday=6]="Friday",n[n.Saturday=7]="Saturday"})(x3||(x3={}));const Gb=KC("LocalNotifications",{web:()=>cb(()=>import("./web-CEN2oPOO.js"),[]).then(n=>new n.LocalNotificationsWeb)}),une=async()=>{if(!nh.isNativePlatform())return console.log("Notifications only work on native platforms"),!1;try{return(await Gb.requestPermissions()).display==="granted"}catch(n){return console.error("Error requesting notification permissions:",n),!1}},cne=async()=>{if(nh.isNativePlatform())try{await Gb.cancel({notifications:[{id:1}]});const n=new Date;return n.setMonth(n.getMonth()+3),await Gb.schedule({notifications:[{title:" Blood Checkup Reminder",body:"It's been 3 months since your last blood test. Time for a health checkup!",id:1,schedule:{at:n},sound:"default",actionTypeId:"",extra:{type:"blood_checkup_reminder"}}]}),console.log("3-month reminder scheduled for:",n),n}catch(n){return console.error("Error scheduling 3-month reminder:",n),null}},dne=()=>{nh.isNativePlatform()&&Gb.addListener("localNotificationActionPerformed",n=>{console.log("Notification clicked:",n)})};function hne(){const n=localStorage.getItem("user_profile"),[e,t]=xe.useState(n?"dashboard":"login"),[i,r]=xe.useState(null),[s,a]=xe.useState(null),[o,l]=xe.useState(n?JSON.parse(n):null),[u,c]=xe.useState(null);M3.useEffect(()=>{(async()=>{if(await une()){console.log("Notifications enabled"),dne();const k=await cne();k&&console.log("Next blood checkup reminder:",k.toLocaleDateString())}})();const x=sg.onAuthStateChange(async E=>{if(E){console.log("User logged in:",E.email),a({email:E.email,id:E.uid});try{const k=await sg.getProfile();k.success&&k.profile?(l(k.profile),t("dashboard")):t("profile_setup")}catch(k){console.error("Error loading profile:",k),t("profile_setup")}}else console.log("User logged out"),a(null),l(null),t("login")}),v=["Drink a glass of water now! ","Time to stretch your legs! ","Don't forget to eat a fruit today! ","Stay motivated! You're doing great. ","Check your blood report regularly. ","Avoid sugary drinks for better health. "],w=setInterval(()=>{const E=v[Math.floor(Math.random()*v.length)];c(E)},12e4);return()=>{clearInterval(w),x()}},[]);const h=async(_,x=!1)=>{if(a(_),x){t("profile_setup");return}try{const v=await sg.getProfile();v.success&&v.profile?(console.log("Profile found:",v.profile),l(v.profile),localStorage.setItem("user_profile",JSON.stringify(v.profile)),t("dashboard")):(console.log("No profile found, redirecting to setup"),t("profile_setup"))}catch(v){console.error("Error fetching profile:",v);const w=localStorage.getItem("user_profile");if(w){const E=JSON.parse(w);E.email===_.email?(l(E),t("dashboard")):(console.log("Cached profile does not match current user. Redirecting to setup."),t("profile_setup"))}else t("profile_setup")}},f=_=>{const x={..._,email:s==null?void 0:s.email};l(x),localStorage.setItem("user_profile",JSON.stringify(x)),t("dashboard")},m=(_,x=null)=>{r(x),t(_)},y=async()=>{await sg.logout()};return T.jsxs("div",{className:"app-container",children:[u&&T.jsx(Xte,{message:u,onClose:()=>c(null)}),e==="login"&&T.jsx(JH,{onLogin:h}),e==="profile_setup"&&T.jsx(HX,{onComplete:f}),e==="dashboard"&&T.jsx(vQ,{userName:o==null?void 0:o.name,userProfile:o,onNavigate:m,onLogout:y}),e==="bmi"&&T.jsx(wQ,{userProfile:o,onBack:()=>t("dashboard")}),e==="blood"&&T.jsx(Ute,{user:o,onBack:()=>t("dashboard"),initialViewReport:i}),e==="fitness"&&T.jsx(Hte,{userProfile:o,onBack:()=>t("dashboard")}),e==="homeworkout"&&T.jsx(qte,{onBack:()=>t("dashboard")}),e==="weightprogress"&&T.jsx(Gte,{userProfile:o,onBack:()=>t("dashboard")}),e==="chat"&&T.jsx(Yte,{userProfile:o,onBack:()=>t("dashboard")}),e==="diet"&&T.jsx(Qte,{user:o,onBack:()=>t("dashboard")})]})}EA.createRoot(document.getElementById("root")).render(T.jsx(M3.StrictMode,{children:T.jsx(hne,{})}));export{g6 as W};
